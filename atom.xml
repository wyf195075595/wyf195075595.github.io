<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>myBlog</title>
  
  <subtitle>前端小趴菜</subtitle>
  <link href="https://wyf195075595.github.io/atom.xml" rel="self"/>
  
  <link href="https://wyf195075595.github.io/"/>
  <updated>2025-07-03T03:00:49.842Z</updated>
  <id>https://wyf195075595.github.io/</id>
  
  <author>
    <name>王不留行</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>android 反编译</title>
    <link href="https://wyf195075595.github.io/2025/06/23/programming/android/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    <id>https://wyf195075595.github.io/2025/06/23/programming/android/%E5%8F%8D%E7%BC%96%E8%AF%91/</id>
    <published>2025-06-23T02:23:10.000Z</published>
    <updated>2025-07-03T03:00:49.842Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/ZJ595/AndroidReverse/blob/main/Article/07%E7%AC%AC%E4%B8%83%E8%AF%BE%E3%80%81Sorry%EF%BC%8C%E4%BC%9AHook%E7%9C%9F%E7%9A%84%E5%8F%AF%E4%BB%A5%E4%B8%BA%E6%89%80%E6%AC%B2%E4%B8%BA-Xposed%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B(%E4%B8%8A)%E6%A8%A1%E5%9D%97%E7%BC%96%E5%86%99%EF%BC%8CApi%E8%AF%A6%E8%A7%A3.md">参考的学习教程</a>，已经fork到自己的github,课件资源存到百度云盘了</p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="LSPosed"><a href="#LSPosed" class="headerlink" title="LSPosed"></a>LSPosed</h3><p>LSPosed 是一款基于 <strong>Android 系统</strong> 的 <strong>Xposed 框架替代品</strong>，用于在不修改 APK 文件的情况下改变系统和应用行为。它通过 Hook（钩子）机制拦截方法调用，实现功能增强、修改或扩展。</p><p>主要特点</p><ol><li><strong>无需 Root</strong>：支持在 <strong>Magisk 环境</strong> 下无 Root 运行（需要设备已解锁 Bootloader）。</li><li><strong>广泛兼容性</strong>：兼容 Android 8.0 至 14 版本，对新系统支持更好。</li><li><strong>模块化设计</strong>：通过安装不同模块实现各种功能（如微信防撤回、游戏修改等）。</li><li><strong>性能优化</strong>：相比传统 Xposed 框架，内存占用更低，稳定性更高。</li></ol><h3 id="Magisk"><a href="#Magisk" class="headerlink" title="Magisk"></a>Magisk</h3><p>Magisk 是一款强大的 Android 开源工具，用于在不修改系统分区的情况下获取 <strong>Root 权限</strong> 并实现 <strong>系统功能定制</strong>。它通过独特的 “魔术修补” 技术，在不影响官方系统完整性的前提下提供高级权限，是目前 Android 自定义最受欢迎的工具之一。 <strong>LSPosed</strong> 是 Magisk 的一个强大的模块 </p><p>核心功能</p><ol><li><strong>Root 权限管理</strong>：安全获取 Root 权限，支持细粒度权限控制。</li><li><strong>模块系统</strong>：通过安装模块扩展功能（如字体替换、性能优化等）。</li><li><strong>系统分区隔离</strong>：避免直接修改系统文件，便于恢复和升级。</li><li><strong>隐藏 Root 状态</strong>：在需要时向应用隐藏 Root 权限（如游戏防封）。</li></ol><h3 id="核心破解"><a href="#核心破解" class="headerlink" title="核心破解"></a>核心破解</h3><p><strong>XAppDebug</strong></p><p>配合 <strong>jadx-gui</strong>（桌面端软件）可以调试 apk 包中的代码逻辑 </p><h3 id="jadx-gui"><a href="#jadx-gui" class="headerlink" title="jadx-gui"></a><strong>jadx-gui</strong></h3><p>将一个apk打开，解析成 Smail 代码 ，文件可转换成 可读 java 代码，并配合 <strong>XAppDebug</strong> 调试代码逻辑</p><h3 id="开发助手、算法助手"><a href="#开发助手、算法助手" class="headerlink" title="开发助手、算法助手"></a>开发助手、算法助手</h3><p>反编译的辅助工具软件</p><h3 id="Smail语法查询"><a href="#Smail语法查询" class="headerlink" title="Smail语法查询"></a>Smail语法查询</h3><p>寄存器语法查询</p><h3 id="MT-NP管理器"><a href="#MT-NP管理器" class="headerlink" title="MT/NP管理器"></a>MT/NP管理器</h3><p>非常实用的反编译工具。    </p><h3 id="LSPatch"><a href="#LSPatch" class="headerlink" title="LSPatch"></a>LSPatch</h3><p>将安卓hook模块注入到app重新打包，在无root环境运行</p><h3 id="SimpleHook"><a href="#SimpleHook" class="headerlink" title="SimpleHook"></a>SimpleHook</h3><p>提供界面化的 hook 注入，不需要手动编写 java hook，但是功能没手写hook 那样自由，支持修改变量，方法返回值，参数等</p><h3 id="IDA-PRO"><a href="#IDA-PRO" class="headerlink" title="IDA PRO"></a>IDA PRO</h3><p>Android 提供了 ndk 开发包，可将c/c++等汇编语言程序编译为 SO 文件（可在android环境运行），JNI(Java Native Interface)  <strong>可让 Java 代码能够调用 SO 文件中的原生函数</strong></p><p>java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java代码声明本地方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NativeHelper</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-lib&quot;</span>); <span class="comment">// 加载SO文件</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">stringFromJNI</span><span class="params">()</span>; <span class="comment">// 声明本地方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>c++</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++代码实现JNI方法</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">JNIEXPORT jstring JNICALL</span></span><br><span class="line"><span class="function"><span class="title">Java_com_example_myapp_NativeHelper_stringFromJNI</span><span class="params">(JNIEnv *env, jobject <span class="comment">/* this */</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> env-&gt;<span class="built_in">NewStringUTF</span>(<span class="string">&quot;Hello from C++&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用这种方式 可以 提高性能 （音视频编解码（如 FFmpeg）、游戏物理引擎），加密防止逆向，跨平台友好</p><p><strong>而 IDA PRO 就是用来 反编译 so 文件的</strong></p><h2 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h2><h3 id="Android-studio-连接雷电模拟器"><a href="#Android-studio-连接雷电模拟器" class="headerlink" title="Android studio 连接雷电模拟器"></a>Android studio 连接雷电模拟器</h3><p>在此之前需要设置 网络桥接模式 拥有独立的ip 在 我的平板查看 ip ，确保与电脑可以相互ping 通.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\# 进入雷电模拟器安装目录 cd D:\LDPlayer  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据实际路径修改</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看设备列表 可获取 adb 端口, 得到这个端口可以直接进行最后一步，不成功就手动设置端口</span></span><br><span class="line">adb devices</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置模拟器的 ADB 端口（例如 5554）</span> </span><br><span class="line">.\ldconsole.exe adb --index 0 --command &quot;tcpip 5554&quot; </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启模拟器</span> </span><br><span class="line">.\ldconsole.exe restart --index 0 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">尝试连接</span> </span><br><span class="line">adb connect 192.168.1.105:5554</span><br></pre></td></tr></table></figure><h3 id="Xposed-Hook"><a href="#Xposed-Hook" class="headerlink" title="Xposed Hook"></a>Xposed Hook</h3><p>Xposed是一款可以在不修改APK的情况下影响程序运行的框架，基于它可以制作出许多功能强大的模块，且在功能不冲突的情况下同时运作。在这个框架下，我们可以编写并加载自己编写的插件APP，实现对目标apk的注入拦截等。</p><p>配合 Android studio 新建一个 Android 项目 ，编写 Hook 通过 xposedBridgeApi.jar包 和 LSPosed 软件 可以 调试 hook (启动demo之前，记得关掉算法助手的开关，不然可能没有日志显示)</p><p>常用API</p><h4 id="1-Hook变量"><a href="#1-Hook变量" class="headerlink" title="1.Hook变量"></a>1.Hook变量</h4><p>静态变量与实例变量：</p><ul><li>静态变量（static）：类被初始化，同步进行初始化</li><li>非静态变量：类被实例化（产生一个对象的时候），进行初始化</li></ul><p>静态变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>, classLoader);  </span><br><span class="line">XposedHelpers.setStaticIntField(clazz, <span class="string">&quot;变量名&quot;</span>, <span class="number">999</span>);</span><br></pre></td></tr></table></figure><p>实例变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>, classLoader);  </span><br><span class="line">XposedBridge.hookAllConstructors(clazz, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);  </span><br><span class="line">        <span class="comment">//param.thisObject获取当前所属的对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ob</span> <span class="operator">=</span> param.thisObject;  </span><br><span class="line">        XposedHelpers.setIntField(ob,<span class="string">&quot;变量名&quot;</span>,<span class="number">9999</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-Hook构造函数"><a href="#2-Hook构造函数" class="headerlink" title="2.Hook构造函数"></a>2.Hook构造函数</h4><p>无参构造函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, classLoader, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>有参构造函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, classLoader, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="3-Hook-multiDex方法"><a href="#3-Hook-multiDex方法" class="headerlink" title="3.Hook multiDex方法"></a>3.Hook multiDex方法</h4><p>当方法超过 65536 个时 会生成新的 dex 文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(Application.class, <span class="string">&quot;attach&quot;</span>, Context.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        ClassLoader cl= ((Context)param.args[<span class="number">0</span>]).getClassLoader();  </span><br><span class="line">        Class&lt;?&gt; hookclass=<span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            hookclass=cl.loadClass(<span class="string">&quot;类名&quot;</span>);  </span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;  </span><br><span class="line">            Log.e(<span class="string">&quot;zj2595&quot;</span>,<span class="string">&quot;未找到类&quot;</span>,e);  </span><br><span class="line">            <span class="keyword">return</span>;        </span><br><span class="line">        &#125;  </span><br><span class="line">        XposedHelpers.findAndHookMethod(hookclass, <span class="string">&quot;方法名&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="4-主动调用"><a href="#4-主动调用" class="headerlink" title="4.主动调用"></a>4.主动调用</h4><p>静态方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>,lpparam.classLoader);</span><br><span class="line">XposedHelpers.callStaticMethod(clazz,<span class="string">&quot;方法名&quot;</span>,参数(非必须));</span><br></pre></td></tr></table></figure><p>实例方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;类名&quot;</span>,lpparam.classLoader);</span><br><span class="line">XposedHelpers.callMethod(clazz.newInstance(),<span class="string">&quot;方法名&quot;</span>,参数(非必须));</span><br></pre></td></tr></table></figure><h4 id="5-Hook内部类"><a href="#5-Hook内部类" class="headerlink" title="5.Hook内部类"></a>5.Hook内部类</h4><p>内部类:类里还有一个类class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo$InnerClass&quot;</span>, lpparam.classLoader, <span class="string">&quot;innerFunc&quot;</span>,String.class,  <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);  </span><br><span class="line"></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="6-反射大法"><a href="#6-反射大法" class="headerlink" title="6.反射大法"></a>6.反射大法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>, lpparam.classLoader);</span><br><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.Demo$InnerClass&quot;</span>, lpparam.classLoader, <span class="string">&quot;innerFunc&quot;</span>,String.class,  <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);  </span><br><span class="line">        <span class="comment">//第一步找到类</span></span><br><span class="line">        <span class="comment">//找到方法，如果是私有方法就要setAccessible设置访问权限</span></span><br><span class="line">        <span class="comment">//invoke主动调用或者set修改值(变量)</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">democlass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zj.wuaipojie.Demo&quot;</span>,<span class="literal">false</span>,lpparam.classLoader);  </span><br><span class="line">        <span class="type">Method</span> <span class="variable">demomethod</span> <span class="operator">=</span> democlass.getDeclaredMethod(<span class="string">&quot;refl&quot;</span>);  </span><br><span class="line">        demomethod.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">        demomethod.invoke(clazz.newInstance());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="7-遍历所有类下的所有方法"><a href="#7-遍历所有类下的所有方法" class="headerlink" title="7.遍历所有类下的所有方法"></a>7.遍历所有类下的所有方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(ClassLoader.class, <span class="string">&quot;loadClass&quot;</span>, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);  </span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> (Class) param.getResult();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">clazzName</span> <span class="operator">=</span> clazz.getName();  </span><br><span class="line">        <span class="comment">//排除非包名的类  </span></span><br><span class="line">        <span class="keyword">if</span>(clazzName.contains(<span class="string">&quot;com.zj.wuaipojie&quot;</span>))&#123;  </span><br><span class="line">            Method[] mds = clazz.getDeclaredMethods();  </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;mds.length;i++)&#123;  </span><br><span class="line">                <span class="keyword">final</span> <span class="type">Method</span> <span class="variable">md</span> <span class="operator">=</span> mds[i];  </span><br><span class="line">                <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> mds[i].getModifiers();  </span><br><span class="line">                <span class="comment">//去除抽象、native、接口方法  </span></span><br><span class="line">                <span class="keyword">if</span>(!Modifier.isAbstract(mod)  </span><br><span class="line">                    &amp;&amp; !Modifier.isNative(mod)  </span><br><span class="line">                    &amp;&amp;!Modifier.isAbstract(mod))&#123;  </span><br><span class="line">                    XposedBridge.hookMethod(mds[i], <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">                        <span class="meta">@Override</span>  </span><br><span class="line">                        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">                            <span class="built_in">super</span>.beforeHookedMethod(param);  </span><br><span class="line">                            Log.d(<span class="string">&quot;zj2595&quot;</span>,md.toString());  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;);  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">           &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="8-Xposed妙用"><a href="#8-Xposed妙用" class="headerlink" title="8.Xposed妙用"></a>8.Xposed妙用</h4><p>字符串赋值定位:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;android.widget.TextView&quot;</span>, lpparam.classLoader, <span class="string">&quot;setText&quot;</span>, CharSequence.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,param.args[<span class="number">0</span>].toString());  </span><br><span class="line"><span class="keyword">if</span>(param.args[<span class="number">0</span>].equals(<span class="string">&quot;已过期&quot;</span>))&#123;  </span><br><span class="line">    printStackTrace();  </span><br><span class="line">&#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printStackTrace</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">ex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Throwable</span>();  </span><br><span class="line">    StackTraceElement[] stackElements = ex.getStackTrace();  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; stackElements.length; i++) &#123;  </span><br><span class="line">        <span class="type">StackTraceElement</span> <span class="variable">element</span> <span class="operator">=</span> stackElements[i];  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,<span class="string">&quot;at &quot;</span> + element.getClassName() + <span class="string">&quot;.&quot;</span> + element.getMethodName() + <span class="string">&quot;(&quot;</span> + element.getFileName() + <span class="string">&quot;:&quot;</span> + element.getLineNumber() + <span class="string">&quot;)&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>点击事件监听:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> XposedHelpers.findClass(<span class="string">&quot;android.view.View&quot;</span>, lpparam.classLoader);</span><br><span class="line">XposedBridge.hookAllMethods(clazz, <span class="string">&quot;performClick&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">listenerInfoObject</span> <span class="operator">=</span> XposedHelpers.getObjectField(param.thisObject, <span class="string">&quot;mListenerInfo&quot;</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">mOnClickListenerObject</span> <span class="operator">=</span> XposedHelpers.getObjectField(listenerInfoObject, <span class="string">&quot;mOnClickListener&quot;</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">callbackType</span> <span class="operator">=</span> mOnClickListenerObject.getClass().getName();  </span><br><span class="line">        Log.d(<span class="string">&quot;zj2595&quot;</span>,callbackType);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>改写布局:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.zj.wuaipojie.ui.ChallengeSixth&quot;</span>, lpparam.classLoader,  </span><br><span class="line">        <span class="string">&quot;onCreate&quot;</span>, Bundle.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);  </span><br><span class="line">        <span class="type">View</span> <span class="variable">img</span> <span class="operator">=</span> (View)XposedHelpers.callMethod(param.thisObject,  </span><br><span class="line">                <span class="string">&quot;findViewById&quot;</span>, <span class="number">0x7f0800de</span>);  </span><br><span class="line">        img.setVisibility(View.GONE);  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/ZJ595/AndroidReverse/blob/main/Article/07%E7%AC%AC%E4%B8%83%E8%AF%BE%E3%80%81Sorry%EF%BC%8C%E4%BC%9AHook%E7%9</summary>
      
    
    
    
    <category term="反编译" scheme="https://wyf195075595.github.io/categories/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
    
    <category term="android" scheme="https://wyf195075595.github.io/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>js 实用技巧</title>
    <link href="https://wyf195075595.github.io/2025/05/14/programming/jsplugin/%E6%8B%93%E5%B1%95/"/>
    <id>https://wyf195075595.github.io/2025/05/14/programming/jsplugin/%E6%8B%93%E5%B1%95/</id>
    <published>2025-05-14T02:23:10.000Z</published>
    <updated>2025-05-23T03:42:21.467Z</updated>
    
    <content type="html"><![CDATA[<h3 id="js实现-ctrl-f-搜索-效果"><a href="#js实现-ctrl-f-搜索-效果" class="headerlink" title="js实现  ctrl+f  搜索 效果"></a>js实现  ctrl+f  搜索 效果</h3><p>可以实现跨标签，段落匹配</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>文本搜索高亮示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.tailwindcss.com&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    tailwind.<span class="property">config</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">theme</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">extend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">colors</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">primary</span>: <span class="string">&#x27;#165DFF&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">secondary</span>: <span class="string">&#x27;#FF7D00&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">neutral</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="number">100</span>: <span class="string">&#x27;#F5F7FA&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">200</span>: <span class="string">&#x27;#E5E6EB&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">300</span>: <span class="string">&#x27;#C9CDD4&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">400</span>: <span class="string">&#x27;#86909C&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">500</span>: <span class="string">&#x27;#4E5969&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">600</span>: <span class="string">&#x27;#272E3B&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="number">700</span>: <span class="string">&#x27;#1D2129&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">fontFamily</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">inter</span>: [<span class="string">&#x27;Inter&#x27;</span>, <span class="string">&#x27;system-ui&#x27;</span>, <span class="string">&#x27;sans-serif&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/tailwindcss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="keyword">@layer</span> utilities &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.content-auto</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">content-visibility</span>: auto;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.text-balance</span> &#123;</span></span><br><span class="line"><span class="language-css">        text-wrap: balance;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.highlight-current</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> bg-secondary text-white transition-all duration-<span class="number">300</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.highlight</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> bg-yellow-<span class="number">200</span> transition-all duration-<span class="number">300</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.search-container</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> fixed top-<span class="number">4</span> left-<span class="number">1</span>/<span class="number">2</span> -translate-x-<span class="number">1</span>/<span class="number">2</span> z-<span class="number">50</span> bg-white/<span class="number">90</span> backdrop-blur-sm shadow-lg rounded-lg p-<span class="number">3</span> flex items-center gap-<span class="number">3</span> w-full max-w-<span class="number">2</span>xl;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.search-input</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> flex-<span class="number">1</span> border border-neutral-<span class="number">200</span> rounded-md px-<span class="number">4</span> py-<span class="number">2</span> <span class="attribute">focus</span>:outline-none <span class="attribute">focus</span>:ring-<span class="number">2</span> <span class="attribute">focus</span>:ring-primary/<span class="number">50</span> transition-all;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.search-btn</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> px-<span class="number">4</span> py-<span class="number">2</span> bg-primary text-white rounded-md <span class="attribute">hover</span>:bg-primary/<span class="number">90</span> transition-all flex items-center justify-center gap-<span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.search-btn</span><span class="selector-pseudo">:disabled</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> bg-neutral-<span class="number">300</span> cursor-not-allowed;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.result-count</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> px-<span class="number">3</span> py-<span class="number">2</span> rounded-md bg-neutral-<span class="number">100</span> text-neutral-<span class="number">600</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.main-content</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@apply</span> max-w-<span class="number">4</span>xl mx-auto px-<span class="number">4</span> py-<span class="number">6</span> pt-<span class="number">24</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;font-inter bg-neutral-100 text-neutral-700 min-h-screen&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 搜索栏 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;flex items-center gap-2 flex-1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search text-neutral-400&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;search-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入文本进行搜索...&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">aria-label</span>=<span class="string">&quot;搜索文本&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;prev-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-btn&quot;</span> <span class="attr">disabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-chevron-up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;next-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-btn&quot;</span> <span class="attr">disabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-chevron-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;match-count&quot;</span> <span class="attr">class</span>=<span class="string">&quot;result-count&quot;</span>&gt;</span>0/0<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 主内容区 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;main-content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral-800 mb-6&quot;</span>&gt;</span>探索人工智能的未来<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-lg mb-4 text-balance&quot;</span>&gt;</span></span><br><span class="line">        人工智能（Artificial Intelligence, AI）正在改变我们生活的方方面面，从智能手机的语音助手到自动驾驶汽车，AI 技术的应用已经渗透到各个领域。随着深度学习和大数据的发展，人工智能正迎来前所未有的突破。</span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;mb-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;text-xl font-bold text-neutral-800 mb-3&quot;</span>&gt;</span>人工智能的发展历程<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">          人工智能的概念最早可以追溯到 20 世纪 50 年代，当时科学家们开始探索如何让计算机模拟人类的智能。经过几十年的发展，特别是在机器学习和神经网络领域的突破，AI 技术取得了显著进展。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          近年来，深度学习模型如 Transformer 架构的出现，使得自然语言处理和计算机视觉领域取得了革命性的进展。例如，GPT 系列模型已经能够生成高质量的文本内容，而图像生成模型如 DALL-E 和 Stable Diffusion 则可以根据文本描述创建逼真的图像。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;mb-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;text-xl font-bold text-neutral-800 mb-3&quot;</span>&gt;</span>AI 在各行业的应用<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-disc pl-6 space-y-2 mb-4&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>医疗保健<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>：AI 辅助诊断、药物研发和个性化治疗方案。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>金融<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>：风险评估、欺诈检测和算法交易。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>教育<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>：个性化学习平台和智能辅导系统。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>交通<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>：自动驾驶技术和智能交通管理。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>零售<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>：推荐系统、库存管理和客户服务。<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          这些应用不仅提高了效率，还为人们的生活带来了更多便利和可能性。例如，医疗 AI 系统可以分析医学影像，帮助医生更早地发现疾病；金融 AI 可以实时监控交易，识别潜在的欺诈行为。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;mb-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;text-xl font-bold text-neutral-800 mb-3&quot;</span>&gt;</span>挑战与未来展望<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">          尽管人工智能取得了巨大进步，但仍然面临一些挑战。其中包括数据隐私和安全问题、算法偏见、以及 AI 系统的可解释性。此外，AI 技术的广泛应用也可能导致一些工作岗位的自动化，需要社会做好相应的准备。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          未来，人工智能有望在更多领域发挥作用，如气候变化研究、量子计算和太空探索。随着技术的不断进步，我们有理由相信，AI 将为人类创造更加美好的未来。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">blockquote</span> <span class="attr">class</span>=<span class="string">&quot;border-l-4 border-primary pl-4 italic text-neutral-600 mb-8&quot;</span>&gt;</span></span><br><span class="line">        &quot;人工智能不是要取代人类，而是要增强人类的能力。我们应该关注如何让 AI 与人类协作，共同解决全球性挑战。&quot; —— 人工智能专家</span><br><span class="line">      <span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;text-xl font-bold text-neutral-800 mb-3&quot;</span>&gt;</span>如何准备 AI 时代<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">          为了适应人工智能时代的到来，个人和社会都需要做好准备。教育系统需要加强 STEM（科学、技术、工程、数学）教育，培养更多具备 AI 相关技能的人才。同时，公众也需要了解 AI 技术的潜力和风险，以便做出明智的决策。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          对于企业来说，拥抱 AI 技术可以提高竞争力和创新能力。通过将 AI 与业务流程相结合，企业可以实现更高效的运营和更好的客户体验。</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 搜索状态管理</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> searchState = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentIndex</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">matches</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">highlights</span>: []</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// DOM 元素</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> searchInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;search-input&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> prevBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;prev-btn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> nextBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;next-btn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> matchCount = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;match-count&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 绑定搜索事件</span></span></span><br><span class="line"><span class="language-javascript">      searchInput.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, handleSearch);</span></span><br><span class="line"><span class="language-javascript">      prevBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, navigatePrevious);</span></span><br><span class="line"><span class="language-javascript">      nextBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, navigateNext);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 添加键盘导航支持</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Ctrl/Cmd + F 聚焦搜索框</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> ((e.<span class="property">ctrlKey</span> || e.<span class="property">metaKey</span>) &amp;&amp; e.<span class="property">key</span> === <span class="string">&#x27;f&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">          searchInput.<span class="title function_">focus</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 搜索框聚焦时的导航</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">activeElement</span> === searchInput) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// Shift + Enter 导航到上一个</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (e.<span class="property">shiftKey</span> &amp;&amp; e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (searchState.<span class="property">matches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) <span class="title function_">navigatePrevious</span>();</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// Enter 导航到下一个</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (searchState.<span class="property">matches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) <span class="title function_">navigateNext</span>();</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 处理搜索</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">handleSearch</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> keyword = searchInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 清除之前的高亮</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">clearHighlights</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 更新搜索状态</span></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">keyword</span> = keyword;</span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">currentIndex</span> = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果关键词为空，重置 UI 并返回</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!keyword) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateUI</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 执行搜索并高亮匹配项</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">searchAndHighlight</span>(keyword);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 搜索并高亮匹配的文本</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">searchAndHighlight</span>(<span class="params">keyword</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建包含所有文本的大字符串</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> searchRoot = <span class="variable language_">document</span>.<span class="property">body</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> walker = <span class="variable language_">document</span>.<span class="title function_">createTreeWalker</span>(</span></span><br><span class="line"><span class="language-javascript">        searchRoot,</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">NodeFilter</span>.<span class="property">SHOW_TEXT</span>,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">acceptNode</span>: <span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> parent = node.<span class="property">parentElement</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (</span></span><br><span class="line"><span class="language-javascript">              !parent ||</span></span><br><span class="line"><span class="language-javascript">              parent.<span class="property">isContentEditable</span> ||</span></span><br><span class="line"><span class="language-javascript">              <span class="regexp">/^(script|style|textarea|input|select|noscript|canvas|svg)$/i</span>.<span class="title function_">test</span>(parent.<span class="property">tagName</span>) ||</span></span><br><span class="line"><span class="language-javascript">              parent.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;search-container&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            ) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span> <span class="title class_">NodeFilter</span>.<span class="property">FILTER_SKIP</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="title class_">NodeFilter</span>.<span class="property">FILTER_ACCEPT</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 收集所有文本节点及其位置信息</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> textNodes = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> currentNode;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> fullText = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">while</span> ((currentNode = walker.<span class="title function_">nextNode</span>())) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> nodeText = currentNode.<span class="property">nodeValue</span>;</span></span><br><span class="line"><span class="language-javascript">        textNodes.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">node</span>: currentNode,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">start</span>: fullText.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">end</span>: fullText.<span class="property">length</span> + nodeText.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">text</span>: nodeText</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        fullText += nodeText;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 使用正则表达式转义处理特殊字符</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> escapedKeyword = keyword.<span class="title function_">replace</span>(<span class="regexp">/[.*+?^$&#123;&#125;()|[\]\\]/g</span>, <span class="string">&#x27;\\$&amp;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 修复：添加对换行符的支持</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="title class_">RegExp</span>(escapedKeyword.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&#x27;\\s+&#x27;</span>), <span class="string">&#x27;gi&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> matches = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> match;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 查找所有匹配项</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">while</span> ((match = regex.<span class="title function_">exec</span>(fullText)) !== <span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> matchStart = match.<span class="property">index</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> matchEnd = match.<span class="property">index</span> + match[<span class="number">0</span>].<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 找出包含匹配部分的所有文本节点</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> nodesInMatch = textNodes.<span class="title function_">filter</span>(<span class="function"><span class="params">nodeInfo</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> nodeInfo.<span class="property">start</span> &lt; matchEnd &amp;&amp; nodeInfo.<span class="property">end</span> &gt; matchStart;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (nodesInMatch.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          matches.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">start</span>: matchStart,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">end</span>: matchEnd,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">text</span>: match[<span class="number">0</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">nodes</span>: nodesInMatch</span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">matches</span> = matches;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">highlightMatches</span>(matches);</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updateUI</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (matches.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">navigateToMatch</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 高亮匹配项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">highlightMatches</span>(<span class="params">matches</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> highlights = [];</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      matches.<span class="title function_">forEach</span>(<span class="function">(<span class="params">match, index</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> &#123; nodes, start, end &#125; = match;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        nodes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">nodeInfo, i</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> node = nodeInfo.<span class="property">node</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> nodeStart = nodeInfo.<span class="property">start</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> nodeEnd = nodeInfo.<span class="property">end</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 计算在当前文本节点中的偏移量</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> offsetStart = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, start - nodeStart);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> offsetEnd = <span class="title class_">Math</span>.<span class="title function_">min</span>(node.<span class="property">nodeValue</span>.<span class="property">length</span>, end - nodeStart);</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 如果当前节点包含匹配部分</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (offsetStart &lt; offsetEnd) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>();</span></span><br><span class="line"><span class="language-javascript">            range.<span class="title function_">setStart</span>(node, offsetStart);</span></span><br><span class="line"><span class="language-javascript">            range.<span class="title function_">setEnd</span>(node, offsetEnd);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 创建高亮元素</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> highlight = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;mark&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            highlight.<span class="property">className</span> = index === searchState.<span class="property">currentIndex</span> </span></span><br><span class="line"><span class="language-javascript">              ? <span class="string">&#x27;highlight highlight-current&#x27;</span> </span></span><br><span class="line"><span class="language-javascript">              : <span class="string">&#x27;highlight&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            highlight.<span class="property">dataset</span>.<span class="property">matchIndex</span> = index;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 将匹配的文本内容移入高亮元素</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> fragment = range.<span class="title function_">extractContents</span>();</span></span><br><span class="line"><span class="language-javascript">            highlight.<span class="title function_">appendChild</span>(fragment);</span></span><br><span class="line"><span class="language-javascript">            range.<span class="title function_">insertNode</span>(highlight);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 记录高亮元素</span></span></span><br><span class="line"><span class="language-javascript">            highlights.<span class="title function_">push</span>(highlight);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">highlights</span> = highlights;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 清除所有高亮</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">clearHighlights</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 递归处理嵌套的高亮元素</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">removeHighlights</span> = (<span class="params">parent</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> highlights = parent.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;mark.highlight&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        highlights.<span class="title function_">forEach</span>(<span class="function"><span class="params">highlight</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 将高亮元素内的文本直接放回文档中</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> parentNode = highlight.<span class="property">parentNode</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">while</span> (highlight.<span class="property">firstChild</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            parentNode.<span class="title function_">insertBefore</span>(highlight.<span class="property">firstChild</span>, highlight);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          parentNode.<span class="title function_">removeChild</span>(highlight);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 从主内容区域开始清除高亮</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> content = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.main-content&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">removeHighlights</span>(content);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 重置搜索状态</span></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">matches</span> = [];</span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">currentIndex</span> = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">highlights</span> = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updateUI</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 导航到上一个匹配项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">navigatePrevious</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (searchState.<span class="property">matches</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">currentIndex</span> =</span></span><br><span class="line"><span class="language-javascript">        (searchState.<span class="property">currentIndex</span> - <span class="number">1</span> + searchState.<span class="property">matches</span>.<span class="property">length</span>) % searchState.<span class="property">matches</span>.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">navigateToMatch</span>(searchState.<span class="property">currentIndex</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 导航到下一个匹配项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">navigateNext</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (searchState.<span class="property">matches</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      searchState.<span class="property">currentIndex</span> = (searchState.<span class="property">currentIndex</span> + <span class="number">1</span>) % searchState.<span class="property">matches</span>.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">navigateToMatch</span>(searchState.<span class="property">currentIndex</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 导航到指定匹配项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">navigateToMatch</span>(<span class="params">index</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 移除之前的当前高亮</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> prevHighlight = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;mark.highlight-current&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (prevHighlight) &#123;</span></span><br><span class="line"><span class="language-javascript">        prevHighlight.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;highlight-current&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 添加新的当前高亮</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> currentHighlight = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">`mark[data-match-index=&quot;<span class="subst">$&#123;index&#125;</span>&quot;]`</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (currentHighlight) &#123;</span></span><br><span class="line"><span class="language-javascript">        currentHighlight.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;highlight-current&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 平滑滚动到当前高亮</span></span></span><br><span class="line"><span class="language-javascript">        currentHighlight.<span class="title function_">scrollIntoView</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">behavior</span>: <span class="string">&#x27;smooth&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">block</span>: <span class="string">&#x27;center&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加闪烁动画效果</span></span></span><br><span class="line"><span class="language-javascript">        currentHighlight.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;animate-pulse&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          currentHighlight.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;animate-pulse&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updateUI</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 更新 UI 状态</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateUI</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; matches, currentIndex &#125; = searchState;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> hasMatches = matches.<span class="property">length</span> &gt; <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 更新按钮状态</span></span></span><br><span class="line"><span class="language-javascript">      prevBtn.<span class="property">disabled</span> = !hasMatches;</span></span><br><span class="line"><span class="language-javascript">      nextBtn.<span class="property">disabled</span> = !hasMatches;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 更新匹配计数</span></span></span><br><span class="line"><span class="language-javascript">      matchCount.<span class="property">textContent</span> = hasMatches</span></span><br><span class="line"><span class="language-javascript">        ? <span class="string">`<span class="subst">$&#123;currentIndex + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;matches.length&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">        : <span class="string">&#x27;0/0&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 搜索无结果时显示错误状态</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (searchInput.<span class="property">value</span>.<span class="title function_">trim</span>() &amp;&amp; !hasMatches) &#123;</span></span><br><span class="line"><span class="language-javascript">        searchInput.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;border-red-500&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        searchInput.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;focus:ring-red-500/50&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        searchInput.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;border-red-500&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        searchInput.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;focus:ring-red-500/50&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>  </span><br></pre></td></tr></table></figure><h3 id="通过开始结束标识点来设置选中蒙版效果"><a href="#通过开始结束标识点来设置选中蒙版效果" class="headerlink" title="通过开始结束标识点来设置选中蒙版效果"></a>通过开始结束标识点来设置选中蒙版效果</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>文本蒙版覆盖层演示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.overlay</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.3</span>); <span class="comment">/* 黄色半透明 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">pointer-events</span>: none; <span class="comment">/* 允许点击穿透覆盖层 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span>&gt;</span>这是开始节点。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是需要添加蒙版的中间文本内容。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;end&quot;</span>&gt;</span>这是结束节点。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;addOverlay()&quot;</span>&gt;</span>添加蒙版<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">addOverlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取开始和结束节点</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> startNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;start&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> endNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;end&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建 Range 对象并设置范围</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>();</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setStartBefore</span>(startNode);</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setEndAfter</span>(endNode);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取范围的边界框</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> rects = range.<span class="title function_">getClientRects</span>();</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 清除现有覆盖层</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.overlay&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">remove</span>());</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 为每个矩形区域创建覆盖层</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> rect <span class="keyword">of</span> rects) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> overlay = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">className</span> = <span class="string">&#x27;overlay&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置覆盖层位置和大小</span></span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">style</span>.<span class="property">left</span> = <span class="string">`<span class="subst">$&#123;rect.left + <span class="variable language_">window</span>.scrollX&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;rect.top + <span class="variable language_">window</span>.scrollY&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;rect.width&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;rect.height&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(overlay);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>    </span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>滚动文本蒙版演示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content-container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>: auto;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.overlay-container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">pointer-events</span>: none;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.overlay</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.highlight</span> &#123; <span class="attribute">background-color</span>: yellow; &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content-container&quot;</span> <span class="attr">id</span>=<span class="string">&quot;scrollContainer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;overlay-container&quot;</span> <span class="attr">id</span>=<span class="string">&quot;overlayContainer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;start&quot;</span>&gt;</span>这是<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;highlight&quot;</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">span</span>&gt;</span>节点。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是需要添加蒙版的中间文本内容。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是需要添加蒙版的中间文本内容。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是需要添加蒙版的中间文本内容。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是需要添加蒙版的中间文本内容。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;end&quot;</span>&gt;</span>这是<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;highlight&quot;</span>&gt;</span>结束<span class="tag">&lt;/<span class="name">span</span>&gt;</span>节点。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一段普通文本。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;addOverlay()&quot;</span>&gt;</span>添加蒙版<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> overlays = [];</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> scrollContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;scrollContainer&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> overlayContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;overlayContainer&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">addOverlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 清除现有覆盖层</span></span></span><br><span class="line"><span class="language-javascript">      overlays.<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">remove</span>());</span></span><br><span class="line"><span class="language-javascript">      overlays = [];</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取开始和结束节点</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> startNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;start&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> endNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;end&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建 Range 对象并设置范围</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>();</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setStartBefore</span>(startNode);</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setEndAfter</span>(endNode);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取范围的边界框（相对于视口）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> rects = range.<span class="title function_">getClientRects</span>();</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 为每个矩形区域创建覆盖层</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> rect <span class="keyword">of</span> rects) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> overlay = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        overlay.<span class="property">className</span> = <span class="string">&#x27;overlay&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置覆盖层位置和大小（相对于滚动容器）</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateOverlayPosition</span>(overlay, rect);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        overlayContainer.<span class="title function_">appendChild</span>(overlay);</span></span><br><span class="line"><span class="language-javascript">        overlays.<span class="title function_">push</span>(overlay);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 监听滚动事件，更新覆盖层位置</span></span></span><br><span class="line"><span class="language-javascript">      scrollContainer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, updateAllOverlays);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateOverlayPosition</span>(<span class="params">overlay, rect</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取滚动容器的位置和滚动偏移</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> containerRect = scrollContainer.<span class="title function_">getBoundingClientRect</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> scrollLeft = scrollContainer.<span class="property">scrollLeft</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> scrollTop = scrollContainer.<span class="property">scrollTop</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置覆盖层位置（相对于容器）</span></span></span><br><span class="line"><span class="language-javascript">      overlay.<span class="property">style</span>.<span class="property">left</span> = <span class="string">`<span class="subst">$&#123;rect.left - containerRect.left + scrollLeft&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">      overlay.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;rect.top - containerRect.top + scrollTop&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">      overlay.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;rect.width&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">      overlay.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;rect.height&#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateAllOverlays</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取开始和结束节点</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> startNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;start&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> endNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;end&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建 Range 对象并设置范围</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>();</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setStartBefore</span>(startNode);</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">setEndAfter</span>(endNode);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 获取新的边界框</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> rects = range.<span class="title function_">getClientRects</span>();</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 更新每个覆盖层位置</span></span></span><br><span class="line"><span class="language-javascript">      rects.<span class="title function_">forEach</span>(<span class="function">(<span class="params">rect, i</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (overlays[i]) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">updateOverlayPosition</span>(overlays[i], rect);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>    </span><br></pre></td></tr></table></figure><h3 id="js判断浏览器是否支持某个字体"><a href="#js判断浏览器是否支持某个字体" class="headerlink" title="js判断浏览器是否支持某个字体"></a>js判断浏览器是否支持某个字体</h3><p>其中<code>fontFamily</code>参数是必须的，为CSS中<code>font-family</code>设置的web可识别的字体名称，例如宋体<code>&#39;simsun&#39;</code>，微软雅黑<code>&#39;Microsoft Yahei&#39;</code>等。具体名称是什么可以参见文章：“<a href="http://www.zhangxinxu.com/wordpress/2017/03/css-font-family-chinese-english/">CSS font-family常见中文字体对应的英文名称</a>”。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">isSupportFontFamily</span>(fontFamily);</span><br></pre></td></tr></table></figure><h3 id="js获取点击位置元素及文本偏移量"><a href="#js获取点击位置元素及文本偏移量" class="headerlink" title="js获取点击位置元素及文本偏移量"></a>js获取点击位置元素及文本偏移量</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">onmousedown</span> = <span class="function"><span class="params">e</span>=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; clientX, clientY &#125; = e;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">caretPositionFromPoint</span>) &#123;</span><br><span class="line">        range = <span class="variable language_">document</span>.<span class="title function_">caretPositionFromPoint</span>(clientX, clientY);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new:&#x27;</span>, range)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">caretRangeFromPoint</span>) &#123;</span><br><span class="line">        <span class="comment">// 使用非标准的老的API代替</span></span><br><span class="line">        range = <span class="variable language_">document</span>.<span class="title function_">caretRangeFromPoint</span>(clientX, clientY);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old:&#x27;</span>,range)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;js实现-ctrl-f-搜索-效果&quot;&gt;&lt;a href=&quot;#js实现-ctrl-f-搜索-效果&quot; class=&quot;headerlink&quot; title=&quot;js实现  ctrl+f  搜索 效果&quot;&gt;&lt;/a&gt;js实现  ctrl+f  搜索 效果&lt;/h3&gt;&lt;p&gt;可以实现跨标</summary>
      
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="实用技巧" scheme="https://wyf195075595.github.io/tags/%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>python插件</title>
    <link href="https://wyf195075595.github.io/2024/12/30/programming/python/plugins/"/>
    <id>https://wyf195075595.github.io/2024/12/30/programming/python/plugins/</id>
    <published>2024-12-30T01:23:10.000Z</published>
    <updated>2024-12-30T01:15:43.796Z</updated>
    
    <content type="html"><![CDATA[<p>收集一些 有趣的 python 插件</p><h3 id="MarkItDown"><a href="#MarkItDown" class="headerlink" title="MarkItDown"></a><a href="https://github.com/microsoft/markitdown">MarkItDown</a></h3><p>微软官方推出的工具，将各种格式的文件（主要是 Office 文件）转成 Markdown 格式。标题是 GitHub 仓库链接，下面是<a href="https://markitdown.pro/">线上体验</a>。除了python 命令式，还支持api方式调用</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> markitdown <span class="keyword">import</span> MarkItDown</span><br><span class="line"></span><br><span class="line">md = MarkItDown()</span><br><span class="line">result = md.convert(<span class="string">&quot;test.xlsx&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result.text_content)</span><br></pre></td></tr></table></figure><p>支持的格式</p><ul><li>PDF</li><li>PowerPoint</li><li>Word</li><li>Excel</li><li>Images (EXIF metadata and OCR)</li><li>Audio (EXIF metadata and speech transcription)</li><li>HTML</li><li>Text-based formats (CSV, JSON, XML)</li><li>ZIP files (iterates over contents)</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;收集一些 有趣的 python 插件&lt;/p&gt;
&lt;h3 id=&quot;MarkItDown&quot;&gt;&lt;a href=&quot;#MarkItDown&quot; class=&quot;headerlink&quot; title=&quot;MarkItDown&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/microsoft/markitdown&quot;&gt;MarkItDown&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;微软官方推出的工具，将各种格式的文件（主要是 Office 文件）转成 Markdown 格式。标题是 GitHub 仓库链接，下面是&lt;a href=&quot;https://markitdown.pro/&quot;&gt;线上体验&lt;/a&gt;。除了python 命令式，还支持api方式调用&lt;/p&gt;</summary>
    
    
    
    <category term="python" scheme="https://wyf195075595.github.io/categories/python/"/>
    
    
    <category term="plugin" scheme="https://wyf195075595.github.io/tags/plugin/"/>
    
  </entry>
  
  <entry>
    <title>windows 系统相关知识</title>
    <link href="https://wyf195075595.github.io/2024/10/08/computer/windows/"/>
    <id>https://wyf195075595.github.io/2024/10/08/computer/windows/</id>
    <published>2024-10-08T01:23:10.000Z</published>
    <updated>2024-10-08T01:47:58.189Z</updated>
    
    <content type="html"><![CDATA[<p>收集在使用windows系统中遇到的问题及相关知识汇总</p><span id="more"></span><h3 id="创建软连接"><a href="#创建软连接" class="headerlink" title="创建软连接"></a>创建软连接</h3><p>使用软连接来解决软件使用时在C盘（系统盘）产生的大数据转移到其他盘符中。例如：vsCode 软件在安装插件时会默认缓存在 C:\Users\用户名.vscode\extensions 文件夹中，从而导致C盘爆满，需要通过软连接形式来解决这个问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c mklink /D 目标  源</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c mklink /D &quot;C:\Users\19507\.vscode\extensions&quot; &quot;D:\vsCode\.vscode\extensions&quot;</span><br></pre></td></tr></table></figure><p>我把C盘.vsCode 拷贝到 Vscode 安装的 D 盘目录中，在将 C盘中的 extensions 目录连接到D盘的 extensions ，cmd /c 是解决命令权限问题所需。</p><p>创建软连接时需将 目标链接存在的文件夹删除，<strong>不然会报错 链接目标文件已存在 类似错误提示</strong></p><p><strong>删除软连接</strong> 可以直接通过 直接删除 <strong>目标</strong> 实现，删除软连接不会影响 <strong>源</strong> 文件</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;收集在使用windows系统中遇到的问题及相关知识汇总&lt;/p&gt;</summary>
    
    
    
    <category term="windows" scheme="https://wyf195075595.github.io/categories/windows/"/>
    
    
    <category term="windows" scheme="https://wyf195075595.github.io/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>chrome 插件</title>
    <link href="https://wyf195075595.github.io/2024/07/19/programming/javascript/chomePlugin/"/>
    <id>https://wyf195075595.github.io/2024/07/19/programming/javascript/chomePlugin/</id>
    <published>2024-07-19T07:45:10.000Z</published>
    <updated>2024-10-10T03:51:55.655Z</updated>
    
    <content type="html"><![CDATA[<p>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个<a href="https://developer.chrome.com/extensions/crx">.crx</a>后缀的压缩包.</p><p>v2版本已经逐渐不在被支持，以v3语法为基础的简单笔记</p><p><img src="http://image.haoji.me/201707/20170710_222547_735_9922.png"></p><span id="more"></span><p>demo目录结构</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">demo</span><br><span class="line">├── css <span class="comment">-- 样式资源</span></span><br><span class="line">│   ├── ...</span><br><span class="line">├── image  <span class="comment">-- 图片资源</span></span><br><span class="line">│   ├── ...</span><br><span class="line">├── js   <span class="comment">-- 脚本资源</span></span><br><span class="line">│   ├── content-script.js  <span class="comment">-- 内容脚本</span></span><br><span class="line">│   ├── injected-script.js  <span class="comment">--  动态注入脚本</span></span><br><span class="line">│   ├── popup.js  <span class="comment">--  弹窗脚本</span></span><br><span class="line">│   └── service_worker.js  <span class="comment">-- 后台脚本</span></span><br><span class="line">├── popup.html   <span class="comment">-- 弹窗页面</span></span><br><span class="line">└── manifest.json  <span class="comment">-- 配置文件</span></span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span><span class="comment">// 配置文件v3版本写死3，2版本逐渐放弃支持</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chrome插件demo&quot;</span><span class="punctuation">,</span><span class="comment">// 插件名称</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span><span class="comment">// 插件版本</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;最简单的Chrome插件demo，需要快速做一个简单的插件时可以基于这个仓库开发&quot;</span><span class="punctuation">,</span><span class="comment">// 描述信息</span></span><br><span class="line"><span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sxei&quot;</span><span class="punctuation">,</span><span class="comment">// 作者信息</span></span><br><span class="line"><span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="comment">// 图标icon</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;48&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;128&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon.png&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;background&quot;</span><span class="punctuation">:</span><span class="comment">// 常驻后台js</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;service_worker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;js/service_worker.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="comment">// 只有使用 ES module （使用 import 关键字）时，才需要 &quot;type&quot; 字段。其值将始终为 &quot;module&quot;。</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="comment">// 浏览器上显示的图标及浮窗</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;default_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/icon.png&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;default_popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;popup.html&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">             <span class="comment">// &quot;&lt;all_urls&gt;&quot; 表示匹配所有地址</span></span><br><span class="line"><span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http://localhost:5173/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             <span class="comment">// 多个JS按顺序注入</span></span><br><span class="line"><span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js/content-script.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             <span class="comment">// css 注入，优先级很高需仅次于浏览器默认样式，注意 </span></span><br><span class="line">             <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;css/custom.css&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             <span class="comment">// 运行的时机</span></span><br><span class="line"><span class="attr">&quot;run_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;document_start&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line"><span class="attr">&quot;web_accessible_resources&quot;</span><span class="punctuation">:</span> </span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;js/injected-script.js&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;matches&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;*://*/*&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="popup-html"><a href="#popup-html" class="headerlink" title="popup.html"></a>popup.html</h3><p>页面在点击插件图标时显示，一般做临时交互用，此页面引用popup脚本</p><p><img src="https://image.haoji.me/201706/20170619_161102_335_9254.png" alt="博客园网摘插件popup效果"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>popup<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;min-height:100px;&quot;</span>&gt;</span></span><br><span class="line">这里是popup。</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/popup.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="popup-js"><a href="#popup-js" class="headerlink" title="popup.js"></a>popup.js</h3><p>​    在权限上，它和 background 非常类似，它们之间最大的不同是生命周期的不同，popup 中可以直接通过 chrome.extension.getBackgroundPage() 获取 background 的 window 对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你好，我是popup！&#x27;</span>, globalThis);</span><br></pre></td></tr></table></figure><p>与 background 通信</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取background的window对象。</span></span><br><span class="line">chrome.<span class="property">extension</span>.<span class="title function_">getBackgroundPage</span>()</span><br></pre></td></tr></table></figure><h3 id="content-script-js"><a href="#content-script-js" class="headerlink" title="content-script.js"></a>content-script.js</h3><p><strong>content-scripts</strong> <strong>和原始页面共享 DOM，但是不共享JS</strong>，如要访问页面JS（例如某个JS变量），只能通过 injected js 来实现。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">injectCustomJs</span>(<span class="params">jsPath</span>)</span><br><span class="line">&#123;</span><br><span class="line">jsPath = jsPath || <span class="string">&#x27;js/injected-script.js&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> temp = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">temp.<span class="title function_">setAttribute</span>(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;text/javascript&#x27;</span>);</span><br><span class="line"><span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">temp.<span class="property">src</span> = chrome.<span class="property">runtime</span>.<span class="title function_">getURL</span>(jsPath);</span><br><span class="line">temp.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;这是 simple-chrome-plugin-demo 的content-script！&#x27;</span>, globalThis);</span><br><span class="line"><span class="comment">// 注入脚本，注入脚本还需配置 web_accessible_resources 允许外部页面访问此脚本资源</span></span><br><span class="line"><span class="title function_">injectCustomJs</span>();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>与 background的 service-work.js，pupup.js(与background权限相同，仅生命周期不同) 通信 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 与 backgoundrd.js 通信</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;content-script收到来自background.js的消息：&#x27;</span>, request, sender, sendResponse);</span><br><span class="line">    <span class="comment">// 收到消息后回复</span></span><br><span class="line">    <span class="comment">// sendResponse()</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送消息给 background.js</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;getURL&quot;</span>, <span class="attr">value</span>: <span class="string">&#x27;js/injected-script.js&#x27;</span> &#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123; </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;content-script 主动发送消息响应：&quot;</span>, response); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="injected-script-js"><a href="#injected-script-js" class="headerlink" title="injected-script.js"></a>injected-script.js</h3><p>​    content-script 有一个很大的“缺陷”，也就是无法访问页面中的JS，虽然它可以操作DOM，但是DOM却不能调用它，也就是无法在DOM中通过绑定事件的方式调用content-script中的代码</p><p>此脚本是在 content-script.js 内容脚本动态注入的，它可以访问DOM和js ，可以通过 postMessage 方法 与 content-script 在同一页面通信</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;注入脚本成功:&quot;</span>, globalThis);</span><br></pre></td></tr></table></figure><p>postMessage 通信</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// injected-script中：</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="string">&quot;test&quot;</span>: <span class="string">&#x27;你好！&#x27;</span>&#125;, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// content script中：</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">e</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h3 id="service-worker-js"><a href="#service-worker-js" class="headerlink" title="service-worker.js"></a>service-worker.js</h3><p> background 的权限非常高，几乎可以调用所有的 Chrome扩展API（除了devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置<code>CORS</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你好，我是service_worker！&#x27;</span>, globalThis);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>与contentscript通信</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">request, sender, sendResponse</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;service_worker收到消息：&#x27;</span>, request, sender, sendResponse);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 发送消息给content_script</span></span><br><span class="line">chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="keyword">function</span>(<span class="params">tabs</span>) &#123; </span><br><span class="line">    chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(tabs[<span class="number">0</span>].<span class="property">id</span>, &#123;<span class="attr">greeting</span>: <span class="string">&quot;你好，我是service_worker！&quot;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;service_worker 主动发送消息响应：&#x27;</span>, response)</span><br><span class="line">    &#125;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>与popup.js 通信</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取background的window对象。</span></span><br><span class="line">chrome.<span class="property">extension</span>.<span class="title function_">getBackgroundPage</span>()</span><br></pre></td></tr></table></figure><h3 id="互相通信概览"><a href="#互相通信概览" class="headerlink" title="互相通信概览"></a>互相通信概览</h3><p>注：<code>-</code>表示不存在或者无意义，或者待验证。</p><table><thead><tr><th></th><th>injected-script</th><th>content-script</th><th>popup-js</th><th>background-js</th></tr></thead><tbody><tr><td>injected-script</td><td>-</td><td>window.postMessage</td><td>-</td><td>-</td></tr><tr><td>content-script</td><td>window.postMessage</td><td>-</td><td>chrome.runtime.sendMessage chrome.runtime.connect</td><td>chrome.runtime.sendMessage chrome.runtime.connect</td></tr><tr><td>popup-js</td><td>-</td><td>chrome.tabs.sendMessage chrome.tabs.connect</td><td>-</td><td>chrome.extension. getBackgroundPage()</td></tr><tr><td>background-js</td><td>-</td><td>chrome.tabs.sendMessage chrome.tabs.connect</td><td>chrome.extension.getViews</td><td>-</td></tr><tr><td>devtools-js</td><td>chrome.devtools. inspectedWindow.eval</td><td>-</td><td>chrome.runtime.sendMessage</td><td>chrome.runtime.sendMessage</td></tr></tbody></table><blockquote><p><a href="https://blog.haoji.me/chrome-plugin-develop.html#injected-script">参考文章</a></p><p><a href="https://segmentfault.com/a/1190000044555740#item-2-2">v2-&gt;v3版本变化</a></p><p><a href="https://github.com/GoogleChrome/chrome-extensions-samples?tab=readme-ov-file">代码示例</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件，它其实就是一个由HTML、CSS、JS、图片等资源组成的一个&lt;a href=&quot;https://developer.chrome.com/extensions/crx&quot;&gt;.crx&lt;/a&gt;后缀的压缩包.&lt;/p&gt;
&lt;p&gt;v2版本已经逐渐不在被支持，以v3语法为基础的简单笔记&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://image.haoji.me/201707/20170710_222547_735_9922.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="chrome" scheme="https://wyf195075595.github.io/tags/chrome/"/>
    
  </entry>
  
  <entry>
    <title>java plugins</title>
    <link href="https://wyf195075595.github.io/2024/07/05/programming/java/plugins/"/>
    <id>https://wyf195075595.github.io/2024/07/05/programming/java/plugins/</id>
    <published>2024-07-05T01:21:00.000Z</published>
    <updated>2024-08-09T01:12:44.240Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Vosk"><a href="#Vosk" class="headerlink" title="Vosk"></a><a href="https://alphacephei.com/vosk/install">Vosk</a></h3><blockquote><p>集成本地语音转文字服务，不依赖第三方</p><p>Vosk是言语识别工具包。Vosk最好的事情是：</p><ol><li>支持二十+种语言 - 中文，英语，印度英语，德语，法语，西班牙语，葡萄牙语，俄语，土耳其语，越南语，意大利语，荷兰人，加泰罗尼亚语，阿拉伯, 希腊语, 波斯语, 菲律宾语，乌克兰语, 哈萨克语, 瑞典语, 日语, 世界语, 印地语, 捷克语, 波兰语, 乌兹别克语, 韩国语, 塔吉克语</li><li>移动设备上脱机工作-Raspberry Pi，Android，iOS</li><li>使用简单的 pip3 install vosk 安装</li><li>每种语言的手提式模型只有是50Mb, 但还有更大的服务器模型可用</li><li>提供流媒体API，以提供最佳用户体验（与流行的语音识别python包不同）</li><li>还有用于不同编程语言的包装器-java / csharp / javascript等</li><li>可以快速重新配置词汇以实现最佳准确性</li><li>支持说话人识别</li></ol></blockquote><p><a href="https://github.com/Stirling-Tools/Stirling-PDF">Stirling-Tools</a></p><p>​    这是一个使用 Docker 的强大的、本地托管的基于 Web 的 PDF 操作工具。它使您能够对 PDF 文件执行各种操作，包括拆分、合并、转换、重新组织、添加图像、旋转、压缩等。这个本地托管的 Web 应用程序已经发展到包含一套全面的功能，可以满足您的所有 PDF 需求。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Vosk&quot;&gt;&lt;a href=&quot;#Vosk&quot; class=&quot;headerlink&quot; title=&quot;Vosk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://alphacephei.com/vosk/install&quot;&gt;Vosk&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;</summary>
      
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="plugins" scheme="https://wyf195075595.github.io/tags/plugins/"/>
    
  </entry>
  
  <entry>
    <title>nextjs基础</title>
    <link href="https://wyf195075595.github.io/2024/06/25/programming/react/nextjs/"/>
    <id>https://wyf195075595.github.io/2024/06/25/programming/react/nextjs/</id>
    <published>2024-06-25T00:23:10.000Z</published>
    <updated>2024-11-01T09:01:09.453Z</updated>
    
    <content type="html"><![CDATA[<p>​    Next.js是一个基于React的开源JavaScript框架，旨在简化React应用程序的开发流程，并提供更好的性能和开发体验。</p><p>​    它的诞生背景是基于开发者和企业对构建更快、更优化的Web应用程序的需求，特别是在服务端渲染（SSR）和搜索引擎优化（SEO）方面。</p><p><a href="https://nextjs.org/docs">官方文档</a></p><span id="more"></span><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#顶级文件夹 用于组织应用程序的代码和静态资产。</span><br><span class="line">app应用路由器</span><br><span class="line">pages页面路由器</span><br><span class="line">public要服务的静态资产</span><br><span class="line">src可选应用程序源文件夹</span><br><span class="line"></span><br><span class="line">#顶级文件 用于配置您的应用程序、管理依赖项、运行中间件、集成监控工具以及定义环境变量。</span><br><span class="line">next.<span class="property">config</span>.<span class="property">js</span><span class="title class_">Next</span>.<span class="property">js</span> 的配置文件</span><br><span class="line">package.<span class="property">json</span>项目依赖项和脚本</span><br><span class="line">instrumentation.<span class="property">ts</span><span class="title class_">OpenTelemetry</span> 和 <span class="title class_">Instrumentation</span> 文件</span><br><span class="line">middleware.<span class="property">ts</span><span class="title class_">Next</span>.<span class="property">js</span> 请求中间件</span><br><span class="line">.<span class="property">env</span>环境变量</span><br><span class="line">.<span class="property">env</span>.<span class="property">local</span>本地环境变量</span><br><span class="line">.<span class="property">env</span>.<span class="property">production</span>生产环境变量</span><br><span class="line">.<span class="property">env</span>.<span class="property">development</span>开发环境变量</span><br><span class="line">.<span class="property">eslintrc</span>.<span class="property">json</span><span class="title class_">ESLint</span> 的配置文件</span><br><span class="line">.<span class="property">gitignore</span>要忽略的 <span class="title class_">Git</span> 文件和文件夹</span><br><span class="line">next-env.<span class="property">d</span>.<span class="property">ts</span><span class="title class_">Next</span>.<span class="property">js</span> 的 <span class="title class_">TypeScript</span> 声明文件</span><br><span class="line">tsconfig.<span class="property">json</span><span class="title class_">TypeScript</span> 的配置文件</span><br><span class="line">jsconfig.<span class="property">json</span><span class="title class_">JavaScript</span> 的配置文件</span><br></pre></td></tr></table></figure><h2 id="路由约定"><a href="#路由约定" class="headerlink" title="路由约定"></a>路由约定</h2><h3 id="app路由"><a href="#app路由" class="headerlink" title="app路由"></a>app路由</h3><p>放置在app文件夹下的路由文件，此模式在nextjs13+版本支持</p><h4 id="路由文件"><a href="#路由文件" class="headerlink" title="路由文件"></a><a href="https://nextjs.org/docs/getting-started/project-structure#routing-files">路由文件</a></h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/layout"><code>layout</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>布局</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/page"><code>page</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>页</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/loading"><code>loading</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>加载界面</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/not-found"><code>not-found</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>未找到用户界面</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/error"><code>error</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>错误用户界面</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/error#global-errorjs"><code>global-error</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>全局错误用户界面</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/route"><code>route</code></a></td><td><code>.js</code> <code>.ts</code></td><td>API 端点</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/template"><code>template</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>重新渲染布局</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/default"><code>default</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>并行路由回退页面</td></tr></tbody></table><p>页面结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-app</span><br><span class="line">--testPage</span><br><span class="line">---layout</span><br><span class="line">---page</span><br><span class="line">...</span><br><span class="line">--otherPage</span><br><span class="line">---layout</span><br><span class="line">---page</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a><a href="https://nextjs.org/docs/getting-started/project-structure#nested-routes">嵌套路由</a></h4><p>文件夹嵌套方式自动形成路由</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing#route-segments"><code>folder</code></a></td><td>航段</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing#nested-routes"><code>folder/folder</code></a></td><td>嵌套路线段</td></tr></tbody></table><h4 id="动态路线"><a href="#动态路线" class="headerlink" title="动态路线"></a><a href="https://nextjs.org/docs/getting-started/project-structure#dynamic-routes">动态路线</a></h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>[folder]</code></td><td>动态路由</td></tr><tr><td><code>[...folder]</code></td><td>捕获所有路由</td></tr><tr><td>[<code>[...folder]</code>]</td><td>可选的路由</td></tr></tbody></table><ol><li><p>第一种动态路由：</p><p> 页面：app/testPage/[id].tsx</p><p> 路径： /testPage/15</p> <figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># params &#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TestPage</span>(<span class="params">&#123; params &#125;: &#123;params: &#123; id: <span class="built_in">string</span>|<span class="built_in">number</span> &#125;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Blog &#123;params.id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>第一种动态路由： </p><p> 页面：app/testPage/[…id].tsx</p><p> 路径： /testPage/15/16/17</p> <figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># params  &#123;<span class="string">&quot;id&quot;</span>:[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>]&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TestPage</span>(<span class="params">&#123; params &#125;: &#123;params: &#123; id: <span class="built_in">string</span>|<span class="built_in">number</span> &#125;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Blog &#123;params.id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>第三种动态路由： </p><p> 页面：app/testPage/[[…id]].tsx</p><p> 路径： /testPage、 /testPage/15、 /testPage/15/16/17 都能匹配</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span> <span class="comment">// GET `/testPage` (empty object)</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;15&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="comment">// `GET /testPage/15` (single-element array)</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;15&quot;</span><span class="punctuation">,</span> <span class="string">&quot;16&quot;</span>，<span class="string">&quot;17&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="comment">// `GET /testPage/15/16/17` (multi-element array)</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="路由组和私人文件夹"><a href="#路由组和私人文件夹" class="headerlink" title="路由组和私人文件夹"></a><a href="https://nextjs.org/docs/getting-started/project-structure#route-groups-and-private-folders">路由组和私人文件夹</a></h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/route-groups#convention"><code>(folder)</code></a></td><td>不影响路由的分组路由</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/colocation#private-folders"><code>_folder</code></a></td><td>选择文件夹和所有子段退出路由</td></tr></tbody></table><ol><li>分组路由 会生成根路由，不受主路由、主布局文件影响，一般用于多页面路由配置</li></ol><h4 id="平行和拦截路由"><a href="#平行和拦截路由" class="headerlink" title="平行和拦截路由"></a><a href="https://nextjs.org/docs/getting-started/project-structure#parallel-and-intercepted-routes">平行和拦截路由</a></h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/parallel-routes#slots"><code>@folder</code></a></td><td>命名槽</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes#convention"><code>(.)folder</code></a></td><td>拦截同级别</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes#convention"><code>(..)folder</code></a></td><td>拦截高一级</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes#convention"><code>(..)(..)folder</code></a></td><td>拦截两级以上</td></tr><tr><td><a href="https://nextjs.org/docs/app/building-your-application/routing/intercepting-routes#convention"><code>(...)folder</code></a></td><td>从根目录拦截</td></tr></tbody></table><h3 id="pages路由约定"><a href="#pages路由约定" class="headerlink" title="pages路由约定"></a><a href="https://nextjs.org/docs/getting-started/project-structure#pages-routing-conventions"><code>pages</code>路由约定</a></h3><p>以下文件约定用于定义<a href="https://nextjs.org/docs/pages"><code>pages</code>路由器</a>中的路由。</p><h4 id="特殊文件"><a href="#特殊文件" class="headerlink" title="特殊文件"></a><a href="https://nextjs.org/docs/getting-started/project-structure#special-files">特殊文件</a></h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/custom-app"><code>_app</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>自定义应用程序</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/custom-document"><code>_document</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>自定义文档</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/custom-error#more-advanced-error-page-customizing"><code>_error</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>自定义错误页面</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/custom-error#404-page"><code>404</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>404 错误页面</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/custom-error#500-page"><code>500</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>500 错误页面</td></tr></tbody></table><h4 id="路由文件-1"><a href="#路由文件-1" class="headerlink" title="路由文件"></a>路由文件</h4><table><thead><tr><th><strong>文件夹约定</strong></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/pages-and-layouts#index-routes"><code>index</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>主页</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/pages-and-layouts#index-routes"><code>folder/index</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>嵌套页面</td></tr><tr><td><strong>文件约定</strong></td><td></td><td></td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/pages-and-layouts#index-routes"><code>index</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>主页</td></tr><tr><td><a href="https://nextjs.org/docs/pages/building-your-application/routing/pages-and-layouts"><code>file</code></a></td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>嵌套页面</td></tr></tbody></table><h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>规则与app路由类似</p><table><thead><tr><th><strong>文件夹约定</strong></th><th></th><th></th></tr></thead><tbody><tr><td>[folder]/index</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>动态路线段</td></tr><tr><td>[…folder]/index</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>捕获所有路线段</td></tr><tr><td>[[…folder]]/index</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>可选的综合路线段</td></tr><tr><td><strong>文件约定</strong></td><td></td><td></td></tr><tr><td>[file]</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>动态路线段</td></tr><tr><td>[…file]</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>捕获所有路线段</td></tr><tr><td>[[…file]]</td><td><code>.js</code> <code>.jsx</code> <code>.tsx</code></td><td>可选的综合路线段</td></tr></tbody></table><h3 id="元数据文件约定"><a href="#元数据文件约定" class="headerlink" title="元数据文件约定"></a><a href="https://nextjs.org/docs/getting-started/project-structure#metadata-file-conventions">元数据文件约定</a></h3><h4 id="应用程序图标"><a href="#应用程序图标" class="headerlink" title="应用程序图标"></a><a href="https://nextjs.org/docs/getting-started/project-structure#app-icons">应用程序图标</a></h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#favicon"><code>favicon</code></a></td><td><code>.ico</code></td><td>网站图标文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#icon"><code>icon</code></a></td><td><code>.ico</code> <code>.jpg</code> <code>.jpeg</code> <code>.png</code> <code>.svg</code></td><td>应用程序图标文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#generate-icons-using-code-js-ts-tsx"><code>icon</code></a></td><td><code>.js</code> <code>.ts</code> <code>.tsx</code></td><td>生成的应用程序图标</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#apple-icon"><code>apple-icon</code></a></td><td><code>.jpg</code> <code>.jpeg</code>，<code>.png</code></td><td>苹果应用程序图标文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#generate-icons-using-code-js-ts-tsx"><code>apple-icon</code></a></td><td><code>.js</code> <code>.ts</code> <code>.tsx</code></td><td>生成的 Apple 应用程序图标</td></tr></tbody></table><h4 id="Open-Graph-和-Twitter-图片"><a href="#Open-Graph-和-Twitter-图片" class="headerlink" title="Open Graph 和 Twitter 图片"></a><a href="https://nextjs.org/docs/getting-started/project-structure#open-graph-and-twitter-images">Open Graph 和 Twitter 图片</a></h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/opengraph-image#opengraph-image"><code>opengraph-image</code></a></td><td><code>.jpg</code> <code>.jpeg</code> <code>.png</code> <code>.gif</code></td><td>打开 Graph 图像文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/opengraph-image#generate-images-using-code-js-ts-tsx"><code>opengraph-image</code></a></td><td><code>.js</code> <code>.ts</code> <code>.tsx</code></td><td>生成的 Open Graph 图像</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/opengraph-image#twitter-image"><code>twitter-image</code></a></td><td><code>.jpg</code> <code>.jpeg</code> <code>.png</code> <code>.gif</code></td><td>Twitter 图像文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/opengraph-image#generate-images-using-code-js-ts-tsx"><code>twitter-image</code></a></td><td><code>.js</code> <code>.ts</code> <code>.tsx</code></td><td>生成的 Twitter 图像</td></tr></tbody></table><h4 id="搜索引擎优化"><a href="#搜索引擎优化" class="headerlink" title="搜索引擎优化"></a><a href="https://nextjs.org/docs/getting-started/project-structure#seo">搜索引擎优化</a></h4><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/sitemap#sitemap-files-xml"><code>sitemap</code></a></td><td><code>.xml</code></td><td>网站地图文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/sitemap#generating-a-sitemap-using-code-js-ts"><code>sitemap</code></a></td><td><code>.js</code> <code>.ts</code></td><td>生成的网站地图</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/robots#static-robotstxt"><code>robots</code></a></td><td><code>.txt</code></td><td>机器人文件</td></tr><tr><td><a href="https://nextjs.org/docs/app/api-reference/file-conventions/metadata/robots#generate-a-robots-file"><code>robots</code></a></td><td><code>.js</code> <code>.ts</code></td><td>生成的 Robots 文件</td></tr></tbody></table><h3 id="loading状态"><a href="#loading状态" class="headerlink" title="loading状态"></a>loading状态</h3><p>组件数据加载时，展示loading状态</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># app/loading.<span class="property">tsx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Loading</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// You can add any UI inside Loading, including a Skeleton.</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># app/layout.<span class="property">tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Loading</span> <span class="keyword">from</span> <span class="string">&#x27;./loading&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        root layout</span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>​    组件页面中的错误捕获【只能处理客户端错误】，错误组件可以使用该<code>reset()</code>函数提示用户尝试从错误中恢复。执行时，该函数将尝试重新渲染错误边界的内容。如果成功，则后备错误组件将替换为重新渲染的结果。</p><p>app/testPage/error.tsx</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;use client&#x27;</span> <span class="comment">// Error components must be Client Components</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Error</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  error,</span></span><br><span class="line"><span class="params">  reset,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  error: <span class="built_in">Error</span> &amp; &#123; digest?: <span class="built_in">string</span> &#125;</span></span><br><span class="line"><span class="params">  reset: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Log the error to an error reporting service</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">  &#125;, [error])</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Something went wrong!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">Attempt</span> <span class="attr">to</span> <span class="attr">recover</span> <span class="attr">by</span> <span class="attr">trying</span> <span class="attr">to</span> <span class="attr">re-render</span> <span class="attr">the</span> <span class="attr">segment</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          () =&gt;</span> reset()</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        重试</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根<code>app/error.js</code>边界不会<strong>捕获</strong>根<code>app/layout.js</code>或<code>app/template.js</code>组件中引发的错误。</p><p>为了专门处理这些根组件中的错误，请使用位于根目录中<code>error.js</code>的变体。<code>app/global-error.js``app</code></p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;use client&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">GlobalError</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  error,</span></span><br><span class="line"><span class="params">  reset,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  error: <span class="built_in">Error</span> &amp; &#123; digest?: <span class="built_in">string</span> &#125;</span></span><br><span class="line"><span class="params">  reset: () =&gt; <span class="built_in">void</span></span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Something went wrong!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> reset()&#125;&gt;Try again<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>与根<code>error.js</code>不同，<code>global-error.js</code>错误边界包裹<strong>整个</strong>应用程序，其后备组件在活动时替换根布局。因此，需要注意的是<code>global-error.js</code> <strong>必须</strong>定义自己的<code>&lt;html&gt;</code>和<code>&lt;body&gt;</code>标签。</p><ul><li><code>global-error.js</code>仅在生产环境中启用。在开发环境中，将显示我们的错误覆盖。</li></ul><p><strong><a href="https://nextjs.org/docs/app/building-your-application/routing/error-handling#handling-server-errors">处理服务器错误</a></strong></p><p>如果服务器组件内部抛出错误，Next.js 会将一个<code>Error</code>对象（在生产中去除敏感错误信息）<code>error.js</code>作为<code>error</code>prop 转发到最近的文件。</p><h3 id="平行路由"><a href="#平行路由" class="headerlink" title="平行路由"></a>平行路由</h3><p>并行路由允许您同时或有条件地在同一布局中渲染一个或多个页面。它们对于应用程序中高度动态的部分非常有用，例如仪表板和社交网站上的提要。</p><p><strong>并行路由使用命名插槽</strong>创建。插槽按照惯例定义<code>@folder</code>。例如，以下文件结构定义了两个插槽：<code>@analytics</code>和<code>@team</code>：</p><p>app/@analytics/page.tsx</p><p>app/@team`/page.tsx</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">  team,</span></span><br><span class="line"><span class="params">  analytics,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode</span></span><br><span class="line"><span class="params">  analytics: React.ReactNode</span></span><br><span class="line"><span class="params">  team: React.ReactNode</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;team&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;analytics&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>插槽 default.tsx</strong> </p><p>如果访问的路由页面没有layout来继承 RootLayout ,则新页面无处安放插槽导致页面404，需要配置default,tsx</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Default</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>插槽路由不会影响其他路由</p><p><img src="https://nextjs.org/_next/image?url=/docs/light/parallel-routes-tab-groups.png&w=3840&q=75" alt="包含两个子页面和一个布局的分析槽"></p><p>app/analytics/layout 中可以切换 页面 page-view, visitory 不影响其他视图</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Layout</span>(<span class="params">&#123; children &#125;: &#123; children: React.ReactNode &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/page-views&quot;</span>&gt;</span>Page Views<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/visitors&quot;</span>&gt;</span>Visitors<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="拦截路由"><a href="#拦截路由" class="headerlink" title="拦截路由"></a>拦截路由</h3><p>例如，当点击 feed 中的照片时，您可以在模态框中显示该照片，覆盖 feed。在这种情况下，Next.js 会拦截路由<code>/photo/123</code>、屏蔽 URL，并将其覆盖在 feed 上<code>/feed</code>。</p><p><img src="https://nextjs.org/_next/image?url=/docs/light/intercepting-routes-soft-navigate.png&w=3840&q=75" alt="拦截路线软导航"></p><p>路由拦截与插槽可以实现弹窗效果</p><h3 id="路由处理与中间件"><a href="#路由处理与中间件" class="headerlink" title="路由处理与中间件"></a>路由处理与中间件</h3><p>这是 nextjs 内置的请求工具，与axios 功能类似</p><h2 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h2><h3 id="静态渲染"><a href="#静态渲染" class="headerlink" title="静态渲染"></a>静态渲染</h3><h3 id="动态渲染"><a href="#动态渲染" class="headerlink" title="动态渲染"></a>动态渲染</h3>]]></content>
    
    
    <summary type="html">&lt;p&gt;​    Next.js是一个基于React的开源JavaScript框架，旨在简化React应用程序的开发流程，并提供更好的性能和开发体验。&lt;/p&gt;
&lt;p&gt;​    它的诞生背景是基于开发者和企业对构建更快、更优化的Web应用程序的需求，特别是在服务端渲染（SSR）和搜索引擎优化（SEO）方面。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://nextjs.org/docs&quot;&gt;官方文档&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="react" scheme="https://wyf195075595.github.io/categories/react/"/>
    
    
    <category term="服务端渲染" scheme="https://wyf195075595.github.io/tags/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/"/>
    
  </entry>
  
  <entry>
    <title>计算机网络</title>
    <link href="https://wyf195075595.github.io/2024/06/22/computer/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    <id>https://wyf195075595.github.io/2024/06/22/computer/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</id>
    <published>2024-06-22T06:09:10.000Z</published>
    <updated>2024-03-22T07:37:33.066Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="计算机网络各类应用"><a href="#计算机网络各类应用" class="headerlink" title="计算机网络各类应用"></a>计算机网络各类应用</h3><ol><li>信息发布和浏览</li><li>通信和交流</li><li>休闲和娱乐</li><li>资源共享</li><li>电子商务</li><li>远程协作</li><li>网上办公</li><li>…</li></ol><span id="more"></span><h3 id="因特网的概述"><a href="#因特网的概述" class="headerlink" title="因特网的概述"></a>因特网的概述</h3><h4 id="网络、互连网-互联网-与因特网的区别与关系"><a href="#网络、互连网-互联网-与因特网的区别与关系" class="headerlink" title="网络、互连网(互联网)与因特网的区别与关系"></a>网络、互连网(互联网)与因特网的区别与关系</h4><ul><li>若干节点和链路互连形成<strong>网络</strong></li><li>若干网络通过路由器互连形成<strong>互连网</strong>(互联网)</li><li><strong>因特网</strong>是当今世界上最大的互联网</li></ul><h4 id="因特网发展阶段"><a href="#因特网发展阶段" class="headerlink" title="因特网发展阶段"></a>因特网发展阶段</h4><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122142020413.png" alt="image-20240122142020413"></p><h4 id="因特网的提供者-（Internet-Serveice-Provide-ISP）"><a href="#因特网的提供者-（Internet-Serveice-Provide-ISP）" class="headerlink" title="因特网的提供者 （Internet Serveice Provide, ISP）"></a>因特网的提供者 （Internet Serveice Provide, ISP）</h4><p>国内ISP主要 中国移动，中国联通、中国电信，中国广电</p><h4 id="ISP的多层级结构的互联网"><a href="#ISP的多层级结构的互联网" class="headerlink" title="ISP的多层级结构的互联网"></a>ISP的多层级结构的互联网</h4><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122142452504.png" alt="image-20240122142452504"></p><h4 id="因特网标准化"><a href="#因特网标准化" class="headerlink" title="因特网标准化"></a>因特网标准化</h4><p><a href="http://www.ietf.org/rfc.html">RFC文档</a>，记录了所有因特网标准，任何人都可以下载RFC文档并对某个RFC文档达标意见和建议</p><h3 id="电路交换、分组交换和报文交换"><a href="#电路交换、分组交换和报文交换" class="headerlink" title="电路交换、分组交换和报文交换"></a>电路交换、分组交换和报文交换</h3><p>电路交换模式例如以前的电话线方式,通信时会一直占线</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122144353482.png" alt="image-20240122144353482"></p><p><strong>三种交换方式对比</strong></p><ul><li>若要连续传送大量的数据，并且数据传送时间远大于建立连接的时间，则使用电路交换可以有较高的传输效率。然而计算机的数据传送往往是突发式的，采用电路交换时通信线路的利用率会很低。</li><li>报文交换和分组交换都不需要建立连接(即预先分配通信资源)，在传送计算机的突发数据时可以提高通信线路的利用率</li><li>将报文构造成若干个更小的分组进行分组交换，比将整个报文进行报文交换的时延要小，并且还可以避免太长的报文长时间占用链路，有利于差错控制，同时具有更好的灵活性。</li></ul><h3 id="计算机网络和定义"><a href="#计算机网络和定义" class="headerlink" title="计算机网络和定义"></a>计算机网络和定义</h3><blockquote><p>计算机网络主要是由一些通用的、可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的(例如，传送数据或视频信号)。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用.</p></blockquote><p>交换分类：上边提到的三种交换方式</p><p>使用者分类：公用网，专用网（内网）</p><p>传输介质分类：有线网络，无线网络</p><p>覆盖范围分类：广域网(WAN)，城域网，局域网(LAN)，个域网</p><p>拓扑结构分类：总线型、星型、环形网络、网状形</p><h3 id="互联网性能指标"><a href="#互联网性能指标" class="headerlink" title="互联网性能指标"></a>互联网性能指标</h3><h4 id="速率"><a href="#速率" class="headerlink" title="速率"></a>速率</h4><blockquote><p>速率是指数据的传送速率 (<strong>即每秒传送多少个比特</strong>)，也称为数据率 (Data Rate)或比特率 (Bit Rate)<br>(bit/s，可简记为b/s，有时也记为bps，即bit per second)速率的基本单位是比特/秒。速率的常用单位有干比特/秒 (kb/s或kbps)、兆比特/秒 (Mb/s或Mbps)、吉比特/秒 (Gb/s或Gbps) 以及太比特/秒(Tb/s或Tbps)</p><table><thead><tr><th>速率的单位</th><th>换算关系</th></tr></thead><tbody><tr><td>比特秒(b/s)</td><td>基本单位</td></tr><tr><td>千比特秒 (kb/s)</td><td>kb/s = 10^3 b/s</td></tr><tr><td>兆比特/(Mb/s)</td><td>Mb/s = kkb/s = 10^6 b/s</td></tr><tr><td>吉比特秒 (Gb/s)</td><td>Gb/s = k-Mb/s = 10^9 b/s</td></tr><tr><td>太比特秒(Tb/s)</td><td>Tb/s = kGb/s = 10^12 b/s</td></tr></tbody></table></blockquote><ul><li><p>比特 (bit，记为小写b)是计算机中数据量的基本单位，一个比特就是二进制数字中的一个1或0。</p></li><li><p>数据量的常用单位有字节(byte，记为大写B, 1字节=8bit) 、千字节(KB)、兆字节(MB)、吉字节(GB)以及字节(TB)。</p><table><thead><tr><th>数据量的单位</th><th>换算关系</th></tr></thead><tbody><tr><td>比特 (b)</td><td>基本单位</td></tr><tr><td>节(B)</td><td>1B = 8bit</td></tr><tr><td>千字节(KB)</td><td>KB = 210 B</td></tr><tr><td>兆字节(MB)</td><td>MB = K·KB = 220 B</td></tr><tr><td>吉字节(GB)</td><td>GB = K-MB = 230 B</td></tr><tr><td>节(TB)</td><td>TB = KGB = 240 B</td></tr></tbody></table></li></ul><p>​    </p><p>eg: 有一个待发送的数据块，大小为100MB，网卡的发送速率为100Mbps则网卡发送完该数据块需要多长时间?</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122150309210.png" alt="image-20240122150309210"></p><h4 id="宽带"><a href="#宽带" class="headerlink" title="宽带"></a>宽带</h4><p>带宽在模拟信号系统中的意义</p><ul><li>某个信号所包含的各种不同频率成分所占据的<strong>频率范围</strong></li><li>单位: Hz (kHz，MHz，GHz)。</li></ul><p>带宽在计算机网络中的意义</p><ul><li><p>用来表示网络的<strong>通信线路所能传送数据的能力</strong>，即在单位时间内从网络中的某一点到另一</p><p>  点所能通过的<strong>最高数据率</strong></p></li><li><p>单位: b/s (kb/s，Mb/s，Gb/s，Tb/s)。</p></li></ul><p><strong>数据传送速率 = min[主机接口速率，线路带宽，交换机或路由器的接口速率]</strong></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122151154742.png" alt="image-20240122151154742"></p><h4 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h4><p>上传速率+下载速率的总和</p><ul><li>吞吐量是指在<strong>单位时间内通过某个网络或接口的实际数据量</strong>。吞吐量常被用于对实际网络的测量以便获知到底有多少数据量通过了网络。</li><li>吞吐量受<strong>网络带宽的限制</strong></li></ul><h4 id="时延"><a href="#时延" class="headerlink" title="时延"></a>时延</h4><blockquote><p>时延是指数据从网络的一端传送到另一端所耗费的时间，也称为延迟或迟延。数据可由一个或多个分组、甚至是一个比特构成。</p></blockquote><p>客户端发送时延+路由器排队时延+传播时延+服务器处理时延</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122152547264.png" alt="image-20240122152547264"></p><h4 id="时延宽带积"><a href="#时延宽带积" class="headerlink" title="时延宽带积"></a>时延宽带积</h4><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122152714905.png" alt="image-20240122152714905"></p><h4 id="数据往返时间"><a href="#数据往返时间" class="headerlink" title="数据往返时间"></a>数据往返时间</h4><p>数据发送到目标服务器，到收到服务器接收数据所需时间</p><h4 id="利用率"><a href="#利用率" class="headerlink" title="利用率"></a>利用率</h4><ul><li><p>链路利用率</p><p>  链路利用率是指某条链路有百分之几的时间是被利用的 (即有数据通过)</p></li><li><p>网络利用率</p><p>  网络利用率是指网络中所有链路的链路利用率的加权平均。<br>  完全空闲的链路的利用率为零</p></li></ul><h4 id="丢包率"><a href="#丢包率" class="headerlink" title="丢包率"></a>丢包率</h4><p>丢包率是指在一定的时间范围内，传输过程中丢失的<strong>分组数量与总分组数量的比率</strong></p><p>丢包原因：</p><ol><li>传输过程中交换机自检出现误码，丢弃该包</li><li>节点交换机根据<strong>丢弃策略</strong>（网络拥塞，接收的包超过排队的长度）主动丢包<ul><li>丢包率 0，无拥塞</li><li>丢包率1-4%，轻度拥塞</li><li>丢包率5-15%，轻度拥塞</li></ul></li></ol><h3 id="计算机网络体系结构"><a href="#计算机网络体系结构" class="headerlink" title="计算机网络体系结构"></a>计算机网络体系结构</h3><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/iso-tcp.png"></p><p>OSI参考模型[<strong>法律标准</strong>]</p><p>没有的到广泛应用</p><ul><li>专家没有实际经验完成标准时没有商业驱动力</li><li>协议实现过分复杂运行效率很低</li><li>标准的制定周期太长产品无法及时进入市场</li><li>层次划分不太合理有些功能在多个层次中重复出现</li></ul><p>TCP/IP参考模型[<strong>事实标准</strong>]</p><ul><li>应用层</li><li>运输层</li><li>网际层</li><li>网络接口层</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122154512467.png" alt="image-20240122154512467"></p><p>由于上述两种协议，所以在教学时会采用重新划分的模型以便于更好的理解</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122154646330.png" alt="image-20240122154646330"></p><ul><li>应用层    解决通过应用进程的交互来实现特定网络应用的问题</li><li>运输层    解决进程之间基于网络的通信问题</li><li>网络层    解决数据包在多个网络之间传输和路由的问题</li><li>数据链路层    解决数据包在一个网络或一段链路上传输的问题</li><li>物理层    解决使用何种信号来表示比特0和1的问题</li></ul><h4 id="专业术语"><a href="#专业术语" class="headerlink" title="专业术语"></a>专业术语</h4><p>实体</p><ul><li>实体是指任何可发送或接收信息的硬件或软件进程对等</li><li>实体是指通信双方相同层次中的实体</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122161315062.png" alt="image-20240122161315062"></p><ul><li>对等层次之间传送的数据包称为该层的协议数据单元 (Protocol Data Unit，PDU)</li><li>同一系统内层与层之间交换的数据包称为服务数据单元(Service Data Unit，SDU)</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122161852721.png" alt="image-20240122161852721"></p><p><strong>协议</strong></p><ul><li>协议是控制两个对等实体在“水平方向”进行“逻辑通信”的规则的集合</li></ul><p><strong>协议的三要素</strong></p><ul><li>语法定义所交换信息的格式</li><li>语义 定义通信双方所要完成的操作</li><li>同步 定义通信双方的时序关系</li></ul><p>在协议的控制下<strong>两个对等实体在水平方向的逻辑通信使得本层能够向上一层提供服务.</strong></p><ul><li>要实现本层协议，还需要使用下面一层所提供的服务。</li><li>协议是“<strong>水平</strong>”的，而服务是“<strong>垂直</strong>”的。</li><li>实体看得见下层提供的服务，但并不知道实现该服务的具体协议。下层的协议对上层的实体是“透明”的。</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122161400141.png" alt="image-20240122161400141"></p><h2 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h2><p>物理层<strong>为数据链路层传输0和1的比特流数据</strong>，数据链路层“看不见”(也无需看见)物理层究竟使用的是什么方法来传输比特流。数据链路层只管“享受”物理层提供的比特流传输服务即可。</p><h3 id="物理层各种接口特性"><a href="#物理层各种接口特性" class="headerlink" title="物理层各种接口特性"></a>物理层各种接口特性</h3><ul><li><p>机械特性</p><p>  形状、尺寸，引脚数目和排序，固定和锁定装置等</p></li><li><p>电器特性</p><p>  信号电压范围、传输速率和距离限制等等</p></li><li><p>功能特性</p><p>  接口和电缆的各条信号线的作用</p></li><li><p>过程特性</p><p>  规定在信号线上传输比特流的一组操作过程，包括各信号间的时序关系</p></li></ul><h3 id="传输媒体分类"><a href="#传输媒体分类" class="headerlink" title="传输媒体分类"></a>传输媒体分类</h3><ul><li>传输媒体是计算机网络设备之间的物理通路，也称为传输介质或传输媒介</li><li>传输媒体并不包含在计算机网络体系结构中</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122163357325.png" alt="image-20240122163357325"></p><p>同轴电缆</p><ul><li>结构稳定、传输带宽较宽、传输距离长、抗电磁干扰能力强</li></ul><p>双绞线</p><ul><li>价格便宜、安装方便、传输距离长，且对外部电磁干扰具有较强的抵抗力。</li><li>双绞线的传输带宽相对较窄，且易受到外部干扰的影响。</li></ul><p>光纤</p><ul><li>光纤通信利用光脉冲在光纤中的传递来进行通信。由于可见光的频率非常高(约为108MHZ量级)因此一个光纤通信系统的传输带宽远大于目前其他各种传输媒体的带宽。</li></ul><p>多模光纤-多条光波在多模光纤中不断地全反射(只适合于建筑物内的近距离传输)</p><p>淡漠光纤-光在单模光纤中一直向前传播(适合长距离传输且衰减更小)</p><p>红外通信</p><p>电脑中取消了红外通信，手机上有应用</p><ul><li>点对点通信</li><li>传输距离短</li></ul><h3 id="传输方式"><a href="#传输方式" class="headerlink" title="传输方式"></a>传输方式</h3><p>串行传输</p><ul><li>远距离方式</li></ul><p>并行传输</p><ul><li>短距离方式</li></ul><p>同步传输</p><ul><li></li></ul><p>异步传输</p><ul><li></li></ul><p>单向通信</p><ul><li>单工通信</li></ul><p>双向交替通信</p><ul><li>半双工通信</li><li>不能同时进行</li></ul><p>双向同时通信</p><ul><li>全双工通信</li><li>可以同时进行</li></ul><h3 id="编码与调制"><a href="#编码与调制" class="headerlink" title="编码与调制"></a>编码与调制</h3><blockquote><p>在传输大量连续1或连续0的情况下，差分曼彻斯特编码信号比曼彻斯特编码信号的变化少在噪声干扰环境下，检测有无跳变比检测跳变方向更不容易出错，因此差分曼彻斯特编码信号比曼彻斯特编码信号更易于检测。<br>在传输介质接线错误导致高低电平翻转的情况下，差分曼彻斯特编码仍然有效.</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240122170500925.png" alt="image-20240122170500925"></p><p>曼彻斯特编码</p><blockquote><p>码元中间时刻的电平跳变既表示时钟信号，也表示数据正跳变表示1还是0，负跳变表示0还是1，可以自行定义。    </p></blockquote><p>差分曼斯特编码</p><blockquote><p>码元中间时刻的电平跳变仅表示时钟信号，而不表示数据。<br>数据的表示在于每一个码元开始处是否有电平跳变: 无跳变表示1，有跳变表示0.</p></blockquote><h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h2><p>可以理解物理层的比特流数据在对等链路层中以帧的形式传输</p><h4 id="链路"><a href="#链路" class="headerlink" title="链路"></a>链路</h4><p>链路(Link)是指从一个节点到邻节点的一段物理线路(有线或无线)，而中间没有任何其他的交换节点。</p><h4 id="数据链路"><a href="#数据链路" class="headerlink" title="数据链路"></a>数据链路</h4><p>数据链路(Data Link)是基于链路的。当在一条链路上传送数据时，除需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把实现这些协议的硬件和软件加到链路上，就构成了数据链路。</p><h4 id="帧"><a href="#帧" class="headerlink" title="帧"></a>帧</h4><p>帧(Frame)是数据链路层对等实体之间在水平方向进行<strong>逻辑通信的协议数据单元PDU</strong>。</p><h4 id="三个重要问题"><a href="#三个重要问题" class="headerlink" title="三个重要问题"></a>三个重要问题</h4><ul><li><p><strong>封装成帧和透明传输</strong></p><ul><li>数据链路层给上层交付下来的协议数据单元PDU添加<strong>顿首部和顿尾部</strong>，这称为封装成帧。</li><li>如果能够采取措施，使得数据链路层对上层交付的PDU的内容没有任何限制，就好像数据链路层不存在一样，就称其为透明传输。<br>  简单来说就是不管内容咋样，都不会影响帧的完整判断，可以准确区分帧开始到结束</li></ul></li><li><p><strong>差错检测</strong></p><p>  帧尾部存放一个差错检测码，拆包时将差错检测码用与成帧时一样的检错算法（如奇偶校验，循环冗余校验）去检测数据</p></li><li><p><strong>可靠传输</strong></p><p>  根据上层服务类型分为两种处理方式</p><ul><li><strong>不可靠传输服务</strong>:收到有误码的帧，<strong>直接丢弃</strong>，其他什么也不做;未收到发送方发送的顿，也不进行任何处理。</li><li><strong>可靠传输服务</strong>:实现发送方发送什么，接收方最终都能正确收到。</li></ul></li></ul><h4 id="点对点协议"><a href="#点对点协议" class="headerlink" title="点对点协议"></a>点对点协议</h4><p>点对点协议 (Point-to-Point Protocol，PPP)是目前使用最广泛的点对点数据链路层协议</p><p>PPP 帧格式</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240124160742576.png" alt="image-20240124160742576"></p><h4 id="共享式以太网"><a href="#共享式以太网" class="headerlink" title="共享式以太网"></a>共享式以太网</h4><ul><li><p>以太网 (Ethernet)以曾经被假想的电磁波传播介质-以太 (Ether) 来命名</p></li><li><p>以太网最初采用无源电缆(不包含电源线)作为共享总线来传输，属于基带总线局域网，传输速率为2.94Mb/s。</p></li></ul><p>以太网目前已经从传统的共享式以太网发展到交换式以太网，传输速率已经从10Mb/s提高到100Mb/s、 1Gb/s甚至10Gb/s。我们会首先介绍最早流行的传输速率为10Mb/s的共享式以太网的相关知识</p><h4 id="网络适配器"><a href="#网络适配器" class="headerlink" title="网络适配器"></a>网络适配器</h4><p>​    要将计算机连接到以太网，需要使用相应的网络适配器(Adapter)，网络适配器一般简称为<strong>“网卡</strong>”</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240124161418872.png" alt="image-20240124161418872"></p><ul><li>在计算机内部，网卡与CPU之间的通信，一般是通过计算机主板上的/0总线以并行传输方式进行.</li><li>网卡与外部以太网(局域网)之间的通信，一般是通过传输媒体(同轴电缆、双绞线电缆、光纤)以串行方式进行的。</li><li>网卡除要实现物理层和数据链路层功能，其另外一个重要功能就是要进行并行传输和串行传输的转换由于网络的传输速率和计算机内部总线上的传输速率并不相同，因此在网卡的核心芯片中都会包含用<br>  于缓存数据的存储器。</li><li>在确保网卡硬件正确的情况下，为了使网卡正常工作，还必须要在计算机的操作系统中为网卡安装相应的设备驱动程序。驱动程序负责驱动网卡发送和接收帧。</li></ul><h5 id="MAC-地址"><a href="#MAC-地址" class="headerlink" title="MAC 地址"></a>MAC 地址</h5><ol><li>当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个<strong>唯一的标识</strong>，即一个<strong>数据链路层地址</strong>。</li><li>在每个主机发送的<strong>帧的首部</strong>中，都携带有发送主机源主机)和接收主机(目的主机)的<strong>数据链路层地址</strong>。由于这类地址是用于<strong>媒体接入控制</strong> (Medium Access Control，MAC)的，因此被称为<strong>MAC地址</strong></li><li>MAC地址一般被固化在网卡的电可擦可编程只读存储器EEPROM中，因此MAC地址也被称为硬件地址MAC地址有时也被称为<strong>物理地址</strong></li></ol><p>一般情况下，普通用户计算机中往往会包含<strong>两块网卡</strong></p><ol><li><p>一块是用于接入<strong>有线局域网的以太网卡</strong></p></li><li><p>另一块是用于接入<strong>无线局域网的Wi-Fi网卡</strong></p><p> 每块网卡都有一个全球唯一的MAC地址交换机和路由器往往具有更多的网络接口，所以会拥有更多的MAC地址</p></li></ol><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240126161845179.png" alt="image-20240126161845179"></p><p>前三个字节对应的组织机构，可以在<a href="http://standards-oui.ieee.org/oui/oui.txt">此地址</a> 查看，网上也还有其他网站提供mac地址查询网络厂商</p><blockquote><p>全球单播MAC地址就如同身份证上的身份证号码，具有唯一性，它往往与用户个人信息绑定在一起。因此，<strong>用户应尽量确保自己拥有的全球单播MAC地址不被泄露</strong><br>为了避免用户设备连接Wi-Fi热点时MAC地址泄露的安全问题，目前大多数移动设备都已经采用了随机MAC地址技术</p></blockquote><h4 id="CSMA-CD协议的基本原理"><a href="#CSMA-CD协议的基本原理" class="headerlink" title="CSMA/CD协议的基本原理"></a>CSMA/CD协议的基本原理</h4><ul><li>在以太网的发展初期，人们普遍认为“无源的电缆线比有源器件可靠”，因此将多个站点连接在一条总线上来构建<strong>共享总线以太网</strong>。</li><li>共享总线以太网具有<strong>天然的广播特性</strong>，即使总线上某个站点给另一个站点发送单播帧，表示帧的信号也会沿着总线传播到总线上的其他各站点。</li><li>当某个站点在总线上发送帧时，总线资源会被该站点独占。此时，如果总线上的其他站点也要在总线上发送帧，就会产生<strong>信号碰撞</strong>。</li><li>当两个或多个站点同时使用总线发送帧时，就会产生信号碰撞</li><li>为了解决各站点争用总线的问题，共享总线以太网使用了一种专用协议CSMA/CD，它是<strong>载波监听多址接入/碰撞检测</strong> (Carrier Sense Multiple Access Collision Detection) 的英文缩写词。</li></ul><h4 id="使用集线器的共享式以太网"><a href="#使用集线器的共享式以太网" class="headerlink" title="使用集线器的共享式以太网"></a>使用集线器的共享式以太网</h4><p>背景</p><ul><li>早期的传统以太网是使用<strong>粗同轴电缆</strong>的共享总线以太网【已淘汰】，后来发展到使用价格相对便宜的<strong>细同轴电缆</strong>。</li><li>当初认为这种连接方法既简单又可靠，因为在那个时代普遍认为<strong>有源器件不可靠</strong>，而无源<strong>的电缆线才是最可靠的</strong>。<ul><li>然而，<br>  实践证明这种使用<strong>无源电缆线和大量机械接口</strong>的总线型以太网<strong>并不</strong>像人们想象的那么<strong>可靠</strong>.</li></ul></li></ul><p>集线器</p><ul><li>在使用细同轴电缆的共享总线以太网之后，以太网发展出来了一种使用大规模集成电路来替代总线、并且可靠性非常高的设备，叫作**集线器 (Hub)**。</li><li>站点连接到集线器的传输媒体也转而使用更便宜、更灵活的<strong>双绞线电缆.</strong></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240129165118126.png" alt="image-20240129165118126"></p><ul><li>EEE于1990年制定了10BASE·<strong>T</strong>【<strong>代表双绞线</strong>】星型以太网的标准802.3，这种以太网是局域网发展史上的一座非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。</li><li>10BASE-T以太网的通信距离较短，每个站点到集线器的距离不能超过100m。</li><li>EEE 802.3以太网还可<strong>使用光纤作为传输媒体</strong>，相应的标准为10BASE-<strong>F</strong>，<strong>“F”表示光纤。光纤主要用作集线器之间的远程连接</strong></li></ul><h4 id="物理层扩展以太网"><a href="#物理层扩展以太网" class="headerlink" title="物理层扩展以太网"></a>物理层扩展以太网</h4><h5 id="拓展站点与集线器的距离"><a href="#拓展站点与集线器的距离" class="headerlink" title="拓展站点与集线器的距离"></a>拓展站点与集线器的距离</h5><blockquote><p>根据上述的每个站点到集线器的距离不能超过100m限制</p></blockquote><ul><li><p>在10BASE-T星型以太网中，可使用<strong>光纤</strong>和一对<strong>光纤调制解调器</strong>来<strong>扩展站点与集线器之间的距离</strong>.</p><p>  这种扩展方法比较简单，所需付出的代价是: 为站点和集线器各增加一个用于电信号和光信号转换的光纤调制解调器，以及它们之间的一对通信光纤。</p></li><li><p>信号在光纤中的衰减和失真很小，因此使用这种方法可以很简单地<strong>将站点与集线器之间的距离扩展到1000m以上</strong> 【两个光纤调制调节器之间距离可突破1000m】</p></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240129170037160.png" alt="image-20240129170037160"></p><h5 id="扩展共享式以太网的覆盖范围和站点数量"><a href="#扩展共享式以太网的覆盖范围和站点数量" class="headerlink" title="扩展共享式以太网的覆盖范围和站点数量"></a>扩展共享式以太网的覆盖范围和站点数量</h5><ul><li><p>以太网集线器一般具有8-32个接口，如果要连接的站点数量超过了单个集线器能够提供的接口数量，就需要使用多个集线器，这样就可以连接成覆盖更大范围、连接更多站点的多级星型以太网。</p></li><li><p>采用多个集线器连接而成的多级星型以太网，在扩展了网络覆盖范围和站点数量的同时，也带来了一些负面因素。</p><p>  ​    在物理层扩展的共享式以太网仍然是一个碰撞域，不能连接太多的站点，否则可能会出现大量的碰撞，导致平均吞吐量太低。</p></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240129171108906.png" alt="image-20240129171108906"></p><h4 id="数据链路层拓展以太网"><a href="#数据链路层拓展以太网" class="headerlink" title="数据链路层拓展以太网"></a>数据链路层拓展以太网</h4><h5 id="使用网桥"><a href="#使用网桥" class="headerlink" title="使用网桥"></a>使用网桥</h5><ul><li>网桥 (bridge)工作在数据链路层(包含其下的物理层)，因此<strong>网桥具备属于数据链路层范的相关能力.</strong><ul><li>网桥可以<strong>识别顿的结构</strong>。</li><li>网桥可以根据帧首部中的<strong>目的MAC地址</strong>和网桥自身的<strong>帧转发表</strong>来转发或丢弃所收到的帧.</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240129171322347.png" alt="image-20240129171322347"></p><p>​    <strong>网桥的接口在向其连接的网段转发顿时会执行相应的媒体接入控制协议，对于共享式以太网就是CSMA/CD协议。</strong></p><h4 id="交换式以太网"><a href="#交换式以太网" class="headerlink" title="交换式以太网"></a>交换式以太网</h4><p>仅使用交换机(而不使用集线器)的以太网就是交换式以太网。<strong>现在网络交换机已经淘汰了网桥设备</strong></p><ul><li>网桥的接口数量很少，通常只有2~4个，一般只用来连接不同的网段</li><li>1990年面世的<strong>交换式集线器</strong> (Switching Hub)，实质上是<strong>具有多个接口的网桥</strong>，常称为<strong>以太网交换机</strong>(Switch)或二层交换机。<ul><li>“二层”是指以太网交换机工作在数据链路层(包括物理层)</li><li>交换机内部的转发表也是通过自学习算法，基于网络中各主机间的通信，自动地逐步与网桥相同，建立起来的。</li><li>另外，交换机也使用生成树协议STP，来产生能够连通全网但不产生环路的通信路径</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240129172617651.png" alt="image-20240129172617651"></p><h4 id="以太网交换机"><a href="#以太网交换机" class="headerlink" title="以太网交换机"></a>以太网交换机</h4><ul><li>以太网交换机 (以下简称交换机)本质上就是一个多接口的网桥<ul><li>交换机自学习和转发帧的流程与网桥是相同的。</li><li>另外，<strong>交换机也使用生成树协议STP</strong>，来产生能够连通全网但不产生环路的通信路径</li></ul></li><li>交换机的每个接口可以连接<strong>计算机</strong>，也可以连接<strong>集线器</strong>或另一个<strong>交换机</strong><ul><li>当<strong>交换机的接口与计算机或交换机连接时</strong>，可以工作在全双工方式，并能在<strong>自身内部同时连通多对接口</strong>，使每一对相互通信的计算机都能像独占传输媒体那样，无碰撞地传输数据，这样就<strong>不需要使用CSMA/CD协议了</strong>。</li><li>当<strong>交换机的接口连接的是集线器时</strong>，该接口就<strong>只能使用CSMA/CD协议</strong>并只能工作在<strong>半双工方式</strong></li><li>现在的交换机和计算机中的网卡都能自动识别上述两种情况，并自动切换到相应的工作方式</li></ul></li></ul><h4 id="对比共享式以太网和交换式以太网"><a href="#对比共享式以太网和交换式以太网" class="headerlink" title="对比共享式以太网和交换式以太网"></a>对比共享式以太网和交换式以太网</h4><p>主要就是对比集线器与交换机</p><p>集线器是全局广播发送给区域所有主机，交换机可以明确转发到目标主机</p><p>交换机脱胎于网桥，网桥又作用在数据链路层可以获取到 mac 地址，以实现明确目标转发</p><table><thead><tr><th align="center"></th><th align="center">隔离冲突域</th><th align="center">隔离广播域</th></tr></thead><tbody><tr><td align="center">集线器</td><td align="center">❌</td><td align="center">❌</td></tr><tr><td align="center">交换机</td><td align="center">✔</td><td align="center">❌</td></tr><tr><td align="center">路由器</td><td align="center">✔</td><td align="center">✔</td></tr></tbody></table><h5 id="以太网的MAC帧格式"><a href="#以太网的MAC帧格式" class="headerlink" title="以太网的MAC帧格式"></a>以太网的MAC帧格式</h5><p>​    现如今市面上<strong>流行的都是 DIX Tthernet V2 的帧格式</strong>，IEEE 802.3 的帧格式很少</p><h4 id="虚拟局域网vlan的诞生"><a href="#虚拟局域网vlan的诞生" class="headerlink" title="虚拟局域网vlan的诞生"></a>虚拟局域网vlan的诞生</h4><p>巨大的广播域会带来一系列问题</p><ul><li>广播风暴</li></ul><p><strong>虚拟局域网VLAN概述</strong></p><ul><li>虚拟局域网(VirtualLocal Area Network，<strong>VLAN</strong>)是一种将局域网内的站点划分成<strong>与物理位置无关的逻辑组</strong>的技术，一个逻辑组就是一个VLAN，VLAN中的各站点具有某些共同的应用需求。</li><li>属于同一VLAN的站点之间可以直接进行通信，而不同VLAN中的站点之间不能直接通信。</li><li>网络管理员可对局域网中的各交换机进行配置来建立多个逻辑上独立的VLAN。<ul><li>连接在同一交换机上的多个站点可以属于不同的VLAN，而属于同一VLAN的多个站点可以连接在不同的交换机上。</li></ul></li></ul><p><strong>虚拟局域网VLAN并不是一种新型网络，”它只是局域网能够提供给用户的一种服务.</strong></p><h4 id="虚拟局域网vlan的实现机制"><a href="#虚拟局域网vlan的实现机制" class="headerlink" title="虚拟局域网vlan的实现机制"></a>虚拟局域网vlan的实现机制</h4><p>不同vlan之间不能通信</p><ul><li>IEEE 802.1Q 帧</li><li>以太网交换机接口类型<ul><li>Access</li><li>Trunk</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240316111053270.png" alt="image-20240316111053270"></p><h4 id="以太网的发展"><a href="#以太网的发展" class="headerlink" title="以太网的发展"></a>以太网的发展</h4><ol><li>传统以太网 10Mb/s</li><li>高速以太网<ol><li>百兆以太网</li><li>千兆以太网（主流）</li><li>万兆以太网</li><li>十万兆以太网</li></ol></li></ol><h4 id="无线局域网"><a href="#无线局域网" class="headerlink" title="无线局域网"></a>无线局域网</h4><p>简称wifi，802.11无线局域网采用了 CSMA/CA协议</p><h5 id="无线局域网物理层"><a href="#无线局域网物理层" class="headerlink" title="无线局域网物理层"></a>无线局域网物理层</h5><p>无线网卡</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240316113251332.png" alt="image-20240316113251332"></p><p>局域网中的MAC帧</p><ul><li><p>数据帧</p><p>  用于在站点间传输数据</p></li><li><p>控制帧</p><p>  通常与数据搭配使用<br>  负责区域的清空、虚拟载波监听的维护以及信道的接入，并于收到数据帧时予以确认。<br>  ACK帧、RTS帧以及CTS等都属于控制帧。</p></li><li><p>管理帧</p><p>  用于加入或退出无线网络以及处理AP之间连接的转移事直。<br>  信标帧、关联请求帧以及身份认证帧等都属于管理帧。</p></li></ul><h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><p>​    网络层的主要任务就是将分组从源主机经过多个网络和多段链路传输到目的主机，可以将该任务划分为 <strong>分组转发和路由选择</strong> 两种重要的功能。</p><p>网络层向上提供两种服务</p><ol><li>面向连接的虚电路服务</li><li>无连接的数据报服务</li></ol><h3 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a>网际协议IP</h3><p>是TCP/IP体系 <strong>网际层中的核心协议</strong></p><h3 id="异构互联"><a href="#异构互联" class="headerlink" title="异构互联"></a>异构互联</h3><p>没有一种协议解决所有用户需求，不同设备之间使用不同协议连接。但是他们网络层都是用 相同的 IP协议，从网络层角度看好像是个统一的网络（IP网）</p><h3 id="ipv4"><a href="#ipv4" class="headerlink" title="ipv4"></a>ipv4</h3><p>IPv4地址是给因特网lntenet  上的每一个主机(或路由器)的每一个接口分配的一个在全世界范围内唯一的32比特的标识符。</p><p>ipv4 2012年就分配完毕了，ipv6 地址开始逐渐取代使用</p><p><strong>ipv4 与MAC 地址的关系</strong></p><p>因特网的网际层<strong>使用IP地址进行寻址</strong>，就可使因特网中各<strong>路由器</strong>的路由表中的路由记录的数量大大减少因为<strong>只需记录部分网络的网络地址</strong>，而不是记录每个网络中各通信设备的各接口的MAC地址。</p><h3 id="地址解析协议ARP"><a href="#地址解析协议ARP" class="headerlink" title="地址解析协议ARP"></a>地址解析协议ARP</h3><p>ARP协议的主要用途是从网际层使用的IP地址解析出在数据链路层使用的MAC地址。由于ARP协议很早就制定出来了 (1982年11月)当时并没有考虑网络安全问题。因此，ARP协议没有安全验证机制，存在ARP欺骗和攻击等问题</p><h3 id="静态路由配置"><a href="#静态路由配置" class="headerlink" title="静态路由配置"></a>静态路由配置</h3><p>静态路由配置是指用户或网络运维人员使用路由器的相关命令给路由器人工配置路由表人工配置</p><p>方式简单、开销小、但不能及时适应网络状态(流量、拓扑等)的变化，一般只在小规模网络中采用。</p><h3 id="虚拟专用网络与网络地址转换"><a href="#虚拟专用网络与网络地址转换" class="headerlink" title="虚拟专用网络与网络地址转换"></a>虚拟专用网络与网络地址转换</h3><p><strong>虚拟专用网</strong>(Virtual Private Network，VPN): 利用公用的因特网作为本机构各专用网之间的通信载体这样形成的网络又称为虚拟专用网(ip隧道技术)。</p><p>给专用网内各主机配置的IP地址应该是<strong>该专用网所在机构可以自行分配的IP地址</strong>，这类IP地址仅在机构内部有效，称为<strong>专用地址</strong> (Private Address)，不需要向因特网的管理机构申请。</p><p><strong>[RFC 1918]规定了以下三个CIDR地址块中的地址作为专用地址</strong></p><ul><li>10.0.0.0~10.255.255.255 (CIDR地址块10/8)</li><li>172.16.0.0~172.31.255.255 (CIDR地址块172.16/12)</li><li>192.168.0.0~192.168.255.255 (CIDR地址块192.168/16)</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240320110336425.png" alt="image-20240320110336425"></p><p>本例所示的是同一机构内不同部门的内部网络所构成的VPN，又称为<strong>内联网VPN</strong>。</p><p>有时，一个机构的虚拟专用网VPN需要某些外部机构 (通常是合作伙伴)参加进来，这样的VPN就称为<strong>外联网VPN</strong>。</p><p>在外地工作的员工需要访问公司内部的专用网时，只要在任何地点接入因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，就可以访问专用网中的资源，这种虚拟专用网又称<strong>为远程接入VPN。</strong></p><p><strong>网络地址转换技术</strong></p><p>网络地址转换(Network Address Translation，NAT)技术于1994年被提出，用来缓解IPv4地址空间即将耗尽的问题。<br><strong>NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源.</strong></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240320111525314.png" alt="image-20240320111525314"></p><p>由于目前绝大多数基于TCP/IP协议栈的网络应用，都使用运输层的传输控制协议TCP或用户数据报协议UDP，为了<strong>更加有效地利用NAT路由器中的全球IP地址</strong>，现在<strong>常将NAT转换和运输层端口号结合使用</strong>。</p><p>这样就可以使内部专用网中使用专用地址的大量主机，共用NAT路由器上的1个全球IP地址，因而可以同时与因特网中的不同主机进行通信。</p><p>将NAT和运输层端口号结合使用，称为<strong>网络地址与端口号转换</strong>(NAPT)</p><p>例如将家中所有智能设备接入因特网，这种路由器实际就是一个<strong>NAT路由器</strong>。NAT（NAPT）技术一个重要特点 <strong>通信必须由专用内部网络发起,因此拥有内部专用地址的主机不能直接充当因特网中的服务器。</strong></p><h3 id="IP多播技术"><a href="#IP多播技术" class="headerlink" title="IP多播技术"></a>IP多播技术</h3><p>多播 (Multicast，也称为组播)是一种实现“一对多”通信的技术，与传统单播“一对一”通信相比，多播可以极大地节省网络资源。在英特网上进行的多播称之为 IP多播</p><p>在IPv4中，D类地址被作为多播地址</p><p>多播地址只能用作目的地址，而不能用作源地址。</p><p>用每一个D类地址来标识一个多播组，使用同一个IP多播地址接收IP多播数据报的所有主机就构成了多播组。</p><p>局域网多播通过MAC地址，因特网多播使用IP地址</p><h3 id="移动IP技术"><a href="#移动IP技术" class="headerlink" title="移动IP技术"></a>移动IP技术</h3><p>移动IP (Mobile P)是因特网工程任务组IETF开发的一种技术IRFC 3344]，该技术使得<strong>移动主机在各网络之间漫游时，仍然能够保持其原来的IP地址不变</strong>。</p><h3 id="ipv6"><a href="#ipv6" class="headerlink" title="ipv6"></a>ipv6</h3><p>还在草案阶段。</p><ul><li>ipv6 采用128 biit ,大小 2^128，可预见的未来基本上用不完</li></ul><h2 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a>运输层</h2><p>​    计算机网络体系结构中的物理层、数据链路层和网络层，它们共同解决了将主机通过异构网络互联起来所面临的问题，<strong>实现了主机到主机的通信</strong>。<br>​    然而在计算机网络中<strong>实际进行通信的真正实体，是位于通信两端主机中的进程</strong>。如何为运行在<strong>不同主机上的应用进程提供直接的逻辑通信服务，就是运输层的主要任务</strong>。运输层协议又称为端到端协议。</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240320114900813.png" alt="image-20240320114900813"></p><p>运输层主要传输协议，TCP，UDP</p><h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h2><p>​    应用层是计算机网络体系结构的最顶层，是设计和建立计算机网络的最终目的，也是计算机网络中发展最快的部分。</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240322144715988.png" alt="image-20240322144715988"></p><p>开发一种新的网络应用首先要考虑的问题就是网络应用程序在各种端系统上的组织方式和它们之间的关系。</p><p>目前流行的主要有以下两种:</p><ol><li><p>客户/服务器 (Client/Server，C/S) 方式</p><p> C/S方式是因特网上传统的、同时也是最成熟的方式，很多我们熟悉的网络应用采用的都是C/S方式包括万维网WWW、电子邮件、文件传输FTP等。</p></li><li><p>对等(Peer-to-Peer，P2P) 方式</p><p> 在P2P方式中，<strong>没有固定的服务请求者和服务提供者</strong>，分布在网络边缘各端系统中的应用进程是对等的，被称为<strong>对等方。对等方相互之间直接通信</strong>，每个对等方既是服务的请求者，又是服务的提供者。</p></li></ol><h3 id="动态主机配置协议"><a href="#动态主机配置协议" class="headerlink" title="动态主机配置协议"></a>动态主机配置协议</h3><p>动态分配子网中计算机的ip地址</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20240322145735991.png" alt="image-20240322145735991"></p><h3 id="域名系统DNS"><a href="#域名系统DNS" class="headerlink" title="域名系统DNS"></a>域名系统DNS</h3><p>为了方便记忆服务器地址，用域名代替ip地址。而将域名解析成ip的服务器就是DNS域名服务器。</p><p>域名的结构由若干个分量组成，各分量之间用“点”隔开，分别代表不同级别的域名。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...三级域名.二级域名.顶级域名</span><br></pre></td></tr></table></figure><ul><li>每一级的域名都由英文字母和数字组成，不超过63个字符，不区分大小写字母</li><li>级别最低的域名写在最左边，而级别最高的顶级域名写在最右边。</li><li>完整的域名不超过255个字符。</li></ul><p>顶级域名TLD(Top Level Domain)分为以下三类:</p><ol><li><p>国家顶级域名nTLD</p><p> 采用ISO 3166的规定。如cn表示中国，us表示美国，uk表示英国、等等</p></li><li><p>通用顶级域名gTLD</p><p> 最常见的通用顶级域名有七个，即: com (公司企业)、net (网络服务机构)、org (非营利性组织)、int (际组织)、edu (美国教育结构)、gov (美国政府部门)、mil (美国军事部门)。</p></li><li><p>反向域 arpa</p><p> 用于反向域名解析，即IP地址反向解析为域名</p></li></ol><p>在国家顶级域名下注册的二级域名均由该国家自行确定。</p><p>​    例如，顶级域名为ip的日本，将其教育和企业机构的二级域名定为ac和co，而不用edu和com。<br><strong>我国则将二级域名划分为以下两类</strong></p><ol><li><p>类别域名</p><p> 共七个: ac (科研机构)、com (工、商、金融等企业)、edu (教育机构)、gov (政府部门)、net (提供网络服务的机构)、mil (军事机构)和org (非营利性组织)</p></li><li><p>行政区域名</p><p> 共34个，适用于我国的各省、自治区、直辖市。例如: bj为北京市、sh为上海市、js为江苏省，等等。</p></li></ol><h3 id="文件传送协议FTP"><a href="#文件传送协议FTP" class="headerlink" title="文件传送协议FTP"></a>文件传送协议FTP</h3><p>​    将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，是一项基本的网络应用，即文件传送。<br>​    文件传送协议FTP (File Transfer Protocol) 是因特网上使用得最广泛的文件传送协议。</p><h3 id="电子邮件"><a href="#电子邮件" class="headerlink" title="电子邮件"></a>电子邮件</h3><p>​    电子邮件(E-mail)是因特网上最早流行的一种应用，并且仍然是当今因特网上最重要、最实用的应用之一。</p><ul><li>电子邮件系统采用客户/服务器方式</li><li>电子邮件系统的三个主要组成构件: 用户代理，邮件服务器，以及电子邮件所需的协议</li></ul><p>用户端使用SMTP协议向邮件服务器发送信息，邮件服务器使用相同协议向接收方右键服务器发送信息。接收方则通过POP3协议向邮件服务器取回邮件</p><h3 id="万维网"><a href="#万维网" class="headerlink" title="万维网"></a>万维网</h3><p>为了方便地访问在世界范围的文档，万维网使用<strong>统一资源定位符</strong>URL来指明因特网上任何种类“资源”的位置。</p><p>URL的一般形式由以下四个部分组成:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;协议&gt;://&lt;主机&gt;:&lt;端口&gt;/&lt;路径&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;h3 id=&quot;计算机网络各类应用&quot;&gt;&lt;a href=&quot;#计算机网络各类应用&quot; class=&quot;headerlink&quot; title=&quot;计算机网络各类应用&quot;&gt;&lt;/a&gt;计算机网络各类应用&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;信息发布和浏览&lt;/li&gt;
&lt;li&gt;通信和交流&lt;/li&gt;
&lt;li&gt;休闲和娱乐&lt;/li&gt;
&lt;li&gt;资源共享&lt;/li&gt;
&lt;li&gt;电子商务&lt;/li&gt;
&lt;li&gt;远程协作&lt;/li&gt;
&lt;li&gt;网上办公&lt;/li&gt;
&lt;li&gt;…&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="computer" scheme="https://wyf195075595.github.io/categories/computer/"/>
    
    
    <category term="网络" scheme="https://wyf195075595.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>h5开发</title>
    <link href="https://wyf195075595.github.io/2024/05/28/programming/htmlcss/h5/h5plus/"/>
    <id>https://wyf195075595.github.io/2024/05/28/programming/htmlcss/h5/h5plus/</id>
    <published>2024-05-28T07:40:10.000Z</published>
    <updated>2024-05-28T06:54:16.982Z</updated>
    
    <content type="html"><![CDATA[<p>最近开发了app项目。使用的h5项目然后套壳成app。记录下过程</p><p>h5项目采用的 vite+vue3+vant</p><p><a href="https://www.html5plus.org/doc/zh_cn/webview.html">h5文档</a></p><p>套壳方式：</p><p>1、hbuildX 云打包</p><p><code>window.plus</code> 是 HBuilderX 和 uni-app 提供的 API 对象，用于访问设备的原生功能。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">plus</span>)&#123; </span><br><span class="line">    <span class="title function_">plusReady</span>(); </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>( <span class="string">&quot;plusready&quot;</span>, plusReady, <span class="literal">false</span> ); </span><br><span class="line">&#125; <span class="comment">// 扩展API准备完成后要执行的操作 </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusReady</span>(<span class="params"></span>)&#123; </span><br><span class="line">    plus.<span class="property">android</span>.<span class="title function_">requestPermissions</span>([<span class="string">&#x27;android.permission.RECORD_AUDIO&#x27;</span>], <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(e.<span class="property">deniedAlways</span>.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;<span class="comment">//权限被永久拒绝</span></span><br><span class="line">            <span class="comment">// 弹出提示框解释为何需要定位权限，引导用户打开设置页面开启</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;限被永久拒绝!!! &#x27;</span>+e.<span class="property">deniedAlways</span>.<span class="title function_">toString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(e.<span class="property">deniedPresent</span>.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;<span class="comment">//权限被临时拒绝</span></span><br><span class="line">            <span class="comment">// 弹出提示框解释为何需要定位权限，可再次调用plus.android.requestPermissions申请权限</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;权限被临时拒绝!!! &#x27;</span>+e.<span class="property">deniedPresent</span>.<span class="title function_">toString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(e.<span class="property">granted</span>.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;<span class="comment">//权限被允许</span></span><br><span class="line">            <span class="comment">//调用依赖获取定位权限的代码</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;权限被允许!!! &#x27;</span>+e.<span class="property">granted</span>.<span class="title function_">toString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、<a href="https://blog.csdn.net/lf21qp/article/details/133277438">hbuildX本地打包</a></p><p>3、capacitorjs + Android Studio 打包</p><p>4、<a href="https://cordova.yoqi.me/docs/zh-cn/9.x/guide/cli/index.html">cordova</a> 打包</p><span id="more"></span><p>套壳方式1的话就是按正常的h5项目开发。打包借助HbuildX工具就行了<a href="https://blog.csdn.net/dhp1994/article/details/134128719">参考</a></p><p>方式2引入 capacitorjs </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add @capacitor/core</span><br><span class="line">yarn add -D @capacitor/cli</span><br></pre></td></tr></table></figure><p>初始化配置文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx cap init</span><br></pre></td></tr></table></figure><p>修改配置文件 webDir 就是h5项目路径文件夹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;appId&quot;: &quot;com.example.app&quot;,</span><br><span class="line">  &quot;appName&quot;: &quot;my-vue-capacitor-app&quot;,</span><br><span class="line">  &quot;webDir&quot;: &quot;dist&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>引入Android / ios</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add @capacitor/android</span><br><span class="line">yarn add @capacitor/ios</span><br><span class="line"></span><br><span class="line">npx cap add android</span><br><span class="line">npx cap add ios</span><br></pre></td></tr></table></figure><p>打开项目用 andriod studio</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx cap  open android</span><br></pre></td></tr></table></figure><p>在 Android studio 中构建 apps</p><h3 id="安装-Android-studio"><a href="#安装-Android-studio" class="headerlink" title="安装 Android studio"></a>安装 Android studio</h3><ol><li><p><a href="https://developer.android.google.cn/studio?hl=zh-cn">下载</a></p><p> 开发工具免费使用，不需要破解</p></li><li><p>安装中文插件</p><p> 查看安装的编辑器版本信息，AI-<strong>222</strong>.4459.24.2221.10121639,built on May 12,2023…,关键信息就是 222</p><p> <img src="https://img-blog.csdnimg.cn/direct/b19fde22dc514ac0ae9d24cfd60fa5dd.png"></p><p> <a href="https://plugins.jetbrains.com/plugin/13710-chinese-simplified-language-pack----/versions">汉化包地址</a> 根据关键信息下载对应版本 zip 包。</p><p> 然后打开设置 install Plugin from Disk….,选择我们下载的包，重启即可</p></li></ol><blockquote><p>不想安装到默认位置C盘，<a href="https://www.cnblogs.com/progress2022/p/16648008.html">参考</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近开发了app项目。使用的h5项目然后套壳成app。记录下过程&lt;/p&gt;
&lt;p&gt;h5项目采用的 vite+vue3+vant&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.html5plus.org/doc/zh_cn/webview.html&quot;&gt;h5文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;套壳方式：&lt;/p&gt;
&lt;p&gt;1、hbuildX 云打包&lt;/p&gt;
&lt;p&gt;&lt;code&gt;window.plus&lt;/code&gt; 是 HBuilderX 和 uni-app 提供的 API 对象，用于访问设备的原生功能。&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;plus&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title function_&quot;&gt;plusReady&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;variable language_&quot;&gt;document&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;addEventListener&lt;/span&gt;( &lt;span class=&quot;string&quot;&gt;&amp;quot;plusready&amp;quot;&lt;/span&gt;, plusReady, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; ); &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;comment&quot;&gt;// 扩展API准备完成后要执行的操作 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;plusReady&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    plus.&lt;span class=&quot;property&quot;&gt;android&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;requestPermissions&lt;/span&gt;([&lt;span class=&quot;string&quot;&gt;&amp;#x27;android.permission.RECORD_AUDIO&amp;#x27;&lt;/span&gt;], &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;e&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(e.&lt;span class=&quot;property&quot;&gt;deniedAlways&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;&amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;	&lt;span class=&quot;comment&quot;&gt;//权限被永久拒绝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 弹出提示框解释为何需要定位权限，引导用户打开设置页面开启&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;限被永久拒绝!!! &amp;#x27;&lt;/span&gt;+e.&lt;span class=&quot;property&quot;&gt;deniedAlways&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;toString&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(e.&lt;span class=&quot;property&quot;&gt;deniedPresent&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;&amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;	&lt;span class=&quot;comment&quot;&gt;//权限被临时拒绝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// 弹出提示框解释为何需要定位权限，可再次调用plus.android.requestPermissions申请权限&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;权限被临时拒绝!!! &amp;#x27;&lt;/span&gt;+e.&lt;span class=&quot;property&quot;&gt;deniedPresent&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;toString&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(e.&lt;span class=&quot;property&quot;&gt;granted&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;&amp;gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;	&lt;span class=&quot;comment&quot;&gt;//权限被允许&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//调用依赖获取定位权限的代码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;权限被允许!!! &amp;#x27;&lt;/span&gt;+e.&lt;span class=&quot;property&quot;&gt;granted&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;toString&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;, &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;2、&lt;a href=&quot;https://blog.csdn.net/lf21qp/article/details/133277438&quot;&gt;hbuildX本地打包&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;3、capacitorjs + Android Studio 打包&lt;/p&gt;
&lt;p&gt;4、&lt;a href=&quot;https://cordova.yoqi.me/docs/zh-cn/9.x/guide/cli/index.html&quot;&gt;cordova&lt;/a&gt; 打包&lt;/p&gt;</summary>
    
    
    
    <category term="h5" scheme="https://wyf195075595.github.io/categories/h5/"/>
    
    
  </entry>
  
  <entry>
    <title>高性能网站建设指南</title>
    <link href="https://wyf195075595.github.io/2024/05/11/programming/javascript/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%AB%99%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97/"/>
    <id>https://wyf195075595.github.io/2024/05/11/programming/javascript/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%AB%99%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97/</id>
    <published>2024-05-11T03:38:25.000Z</published>
    <updated>2024-05-13T09:44:54.231Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>​    性能黄金法则(Performance Golden Rule)揭示了<strong>只有10%<del>20%的最终用户响应时间花在接收所请求的HTML文档上剩下的80%</del>90%时间花在为HTML文档所引用的所有组件(图片、脚本、样式表Flash 等)进行的HTTP 请求上。</strong>因此，改善响应时间的最简单途径就是减少组件的数量，并由此减少 HTTP 请求的数量</p></blockquote><h2 id="减少http请求"><a href="#减少http请求" class="headerlink" title="减少http请求"></a>减少http请求</h2><span id="more"></span><ol><li><p>图片地图</p><p> 将一张图片做几张图片用，减少图片使用</p></li></ol><pre><code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./img/qqline.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">usemap</span>=<span class="string">&quot;#mymap1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span> <span class="attr">name</span>=<span class="string">&quot;mymap1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;rect&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;47,36,209,275&quot;</span> <span class="attr">href</span>=<span class="string">&quot;a.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;rect&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;271,36,433,275&quot;</span> <span class="attr">href</span>=<span class="string">&quot;b.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;rect&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;487,36,668,275&quot;</span> <span class="attr">href</span>=<span class="string">&quot;c.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></code></pre><ol start="2"><li><p>css Sprites</p><p> 雪碧图(图片精灵)，将一张多素材图片通过定位【background-position】方式，展示其中某一部分来模拟多张图片的效果。减少图片请求</p><p> <a href="https://code-nav.top/spritesmith">雪碧图在线生成工具</a></p></li><li><p>内联图片</p><p> ​    通过使用 dataLURL 模式 在web页面包含图片且无需额外http请求.Data URL协议中，图片被转换成<a href="https://so.csdn.net/so/search?q=base64&spm=1001.2101.3001.7020">base64</a>编码的字符串形式，并存储在URL中，冠以mime-type。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line"> <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/gif;base64,R0lGODlhAwADAIAAAP///8zMzCH5BAAAAAAALAAAAAADAAMAAAIEBHIJBQA7&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/gif;base64,R0lGODlhAwADAIAAAP///8zMzCH5BAAAAAAALAAAAAADAAMAAAIEBHIJBQA7&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p> ​    使用Data URL方式的Demo在渲染时会比不使用 多消耗53%左右的CPU资源，内存多出4倍左右，耗时平均高出24.6倍 。由此可见，使用Data URl方式还是需要更多的考量，在可接受的范围内适量使用。</p></li><li><p>合并脚本样式表</p><p> 减少 js,css 文件数量</p></li></ol><h2 id="使用内容发布网络"><a href="#使用内容发布网络" class="headerlink" title="使用内容发布网络"></a>使用内容发布网络</h2><p>就是使用 cdn 加速，减少打包体积</p><h2 id="添加-Expries-头"><a href="#添加-Expries-头" class="headerlink" title="添加 Expries 头"></a>添加 Expries 头</h2><p>图片资源浏览器默认会进行缓存，非首次访问时会触发.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 设置缓存存储的最大周期，超过这个时间缓存被认为过期 (单位秒)。与Expires相反，时间是相对于请求的时间。</span><br><span class="line">Cache-Control: max-age=&lt;seconds&gt;</span><br><span class="line">// 响应标头包含响应应被视为过期的日期/时间。无效的日期（比如 0）代表过去的日期，即该资源已经过期。</span><br><span class="line">Expires: Wed, 21 Oct 2015 07:28:00 GMT</span><br></pre></td></tr></table></figure><p>添加长的 Expires 头可以将后续页面浏览的响应时间从 600秒降低到260毫秒这是在900Kbps的DSL 上测试的，减少了57%。页面中的组件越多，响应时间改善得越多。如果你的页面平均超过6个图片、3个脚本和1个样式表，页面的速度提升就会超过这个例子中的57%。</p><h2 id="压缩组件"><a href="#压缩组件" class="headerlink" title="压缩组件"></a>压缩组件</h2><p>可以用于向浏览器发布压缩的 web页面，从HTTP请求中的<strong>Accept-Encoding</strong>头来标识对压缩的 web 页面 。http从 1.1开始 对压缩标识支持</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Encoding:gzip</span><br></pre></td></tr></table></figure><p>gzip 是目前最流行最有效的压缩方式，这是GNU项目开发的一种免费的格式</p><p>启用方式参考 <strong>nignx 配置 gzip</strong></p><p><strong>vite vue3项目</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> compressPlugin <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-compression&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        ...,</span><br><span class="line">        <span class="title function_">compressPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">threshold</span>: <span class="number">3072</span>, <span class="comment">//3KB 仅压缩文件大小大于此阈值的文件</span></span><br><span class="line">          <span class="attr">deleteOriginFile</span>: <span class="literal">false</span>, <span class="comment">// 是否删除原始文件</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>vue cli 项目</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compressionWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;compression-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="comment">// 开启gzip</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">compressionWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[path][base].gz&quot;</span>,</span><br><span class="line">        <span class="attr">algorithm</span>: <span class="string">&quot;gzip&quot;</span>,</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.js$|.css$|.html$/</span>,</span><br><span class="line">        <span class="attr">threshold</span>: <span class="number">10240</span>, <span class="comment">// 对超过10k的数据压缩</span></span><br><span class="line">        <span class="attr">minRatio</span>: <span class="number">0.8</span> <span class="comment">// 压缩率小于0.8才会压缩</span></span><br><span class="line">      &#125;),</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当浏览器直接访问服务器时，一切都正常。如果浏览器通过代理来发送请求时，就可能出现问题。由于正向代理服务端缓存会根据第一次请求来决定，如果第一次请求URL，浏览器不支持gzip,那么第二次支持gzip浏览器请求URL 服务端会按不支持gzip 处理，反之浏览器不会解压.gz 文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: Accept-Encoding, User-Agent</span><br></pre></td></tr></table></figure><p>在服务端响应头 新增如上，就能避免问题，添加 user-Agent nginx可以根据浏览器是否支持gzip 判断是否返回 压缩的文件。</p><p>2024了 现在浏览器基本都支持，不需要考虑这个问题</p><h2 id="外联-js-css"><a href="#外联-js-css" class="headerlink" title="外联 js, css"></a>外联 js, css</h2><p>不使用内联 js,css, 将js,css 放置外部文件中</p><h2 id="减少-DNS-查找"><a href="#减少-DNS-查找" class="headerlink" title="减少 DNS 查找"></a>减少 DNS 查找</h2><p>浏览器对级存的 DNS 记录的数也有限制，而不管缓存记录的时间。如果用户在短时间内访问了很多具有不同域名的网站，较早的 DNS 记录将被丢弃，必须重新查找该域名。</p><h2 id="压缩精简代码"><a href="#压缩精简代码" class="headerlink" title="压缩精简代码"></a>压缩精简代码</h2><p>打包压缩</p><h2 id="避免重定向"><a href="#避免重定向" class="headerlink" title="避免重定向"></a>避免重定向</h2><ul><li><p>300Multiple Choices(基于 Content-Type)</p></li><li><p>301 Moved Permancently.</p><p>  客户请求的文档在其他地方，新的URL在 Location 头中给出，浏览器应该自动地访问新的URL。</p></li><li><p>302MovedTemporarily亦称Found)</p><p>  类似于301，但新的URL应该被视为临时性的替代，而不是永久性的。</p></li><li><p>303 See Oier 对302的说明)</p><p>  类似于301/302，不同之处在于，如果原来的请求是POST，Location头指定的重定向目标文档应该通过GET提取（HTTP 1.1新）。</p></li><li><p>304 Not Modified</p><p>  客户端有缓冲的文档并发出了一个条件性的请求（一般是提供If-Modified-Since头表示客户只想比指定日期更新的文档）。服务器告诉客户，原来缓冲的文档还可以继续使用。<br>   如果客户端发送了一个带条件的 GET 请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个状态码。<strong>304响应禁止包含消息体（因此304请求可以借助浏览器缓存来节省资源请求）</strong></p></li><li><p>305 Use Proxy</p></li><li><p>306(不使用)</p></li><li><p>307Temporary Redifeot(对302的说明)</p><p>   如果这不是一个GET或者HEAD请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。对于307，使用POST请求的话，重定向的请求应该是POST请求。 </p></li></ul><p><a href="https://kebingzao.com/2018/10/05/http-status-code/">浅谈之-http的状态码以及使用场景</a></p><h2 id="配置或移除eTag"><a href="#配置或移除eTag" class="headerlink" title="配置或移除eTag"></a>配置或移除eTag</h2><p><strong>条件get请求</strong></p><p>当缓存的组件过期了或重新加载页面，浏览器重用它们之前必须要确认它们是否任然有效。这称作一个条件请求。然而浏览器要产生一个get请求。如有效get返回状态304 Not Modified</p><p>向不同服务器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">  A[Capture] --&gt; B(Document) --&gt; C&#123;&#123;Review and&lt;br/&gt;Approve&#125;&#125; --&gt; D(Publish)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;​    性能黄金法则(Performance Golden Rule)揭示了&lt;strong&gt;只有10%&lt;del&gt;20%的最终用户响应时间花在接收所请求的HTML文档上剩下的80%&lt;/del&gt;90%时间花在为HTML文档所引用的所有组件(图片、脚本、样式表Flash 等)进行的HTTP 请求上。&lt;/strong&gt;因此，改善响应时间的最简单途径就是减少组件的数量，并由此减少 HTTP 请求的数量&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;减少http请求&quot;&gt;&lt;a href=&quot;#减少http请求&quot; class=&quot;headerlink&quot; title=&quot;减少http请求&quot;&gt;&lt;/a&gt;减少http请求&lt;/h2&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="js" scheme="https://wyf195075595.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>开发WangEditor插件</title>
    <link href="https://wyf195075595.github.io/2024/04/25/programming/jsplugin/wangEditorPlugin/"/>
    <id>https://wyf195075595.github.io/2024/04/25/programming/jsplugin/wangEditorPlugin/</id>
    <published>2024-04-25T00:23:10.000Z</published>
    <updated>2024-07-24T06:41:47.510Z</updated>
    
    <content type="html"><![CDATA[<p>插件开发请阅读<a href="https://www.wangeditor.com/v5/development.html#%E6%B3%A8%E5%86%8C%E6%8F%92%E4%BB%B6%E5%88%B0-wangeditor">官方文档</a>，本次示例为 为 编辑器 拓展 <a href="https://mermaid.nodejs.cn/intro/">mermaid</a> 流程图。本示例参考官方 <a href="https://github.com/wangeditor-team/wangEditor-plugin-formula">公式插件</a> 代码</p><p><img src="https://github.com/wangeditor-team/wangEditor-plugin-formula/blob/main/_img/demo.png?raw=true" alt="wangEditor-plugin-formula"></p><span id="more"></span><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-RemaindFlow</span><br><span class="line"></span><br><span class="line">--MyModalMenu.js   #插入流程图弹窗</span><br><span class="line"></span><br><span class="line">--editFlow.js  #流程图点击浮窗编辑</span><br><span class="line"></span><br><span class="line">--renderElem.js    #通过json数据渲染“流程图”元素到编辑器</span><br><span class="line"></span><br><span class="line">--elemToHtml.js   #生成“流程图”元素的 HTML</span><br><span class="line"></span><br><span class="line">--parseElemHtml.js #解析 HTML 字符串，生成“流程图”元素 json 数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--withAttachment.js#重写元素在编辑器中的inline【是否块级元素】 和 void【为空判断】</span><br><span class="line"></span><br><span class="line">--index.js  #导出整体模块</span><br><span class="line"></span><br><span class="line">--registerCustomElem.js #没有用</span><br></pre></td></tr></table></figure><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;katex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.16.10&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mermaid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^10.9.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;@wangeditor/editor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.23&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;@wangeditor/editor-for-vue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.12&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"># 将 json 字符串渲染成 dom</span><br><span class="line">yarn add snabbdom --peer</span><br></pre></td></tr></table></figure><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p><strong>MyModalMenu.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyModalMenu</span> &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;My menu&#x27;</span>;</span><br><span class="line"><span class="comment">// this.iconSvg = &#x27;&lt;svg &gt;...&lt;/svg&gt;&#x27;</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tag</span> = <span class="string">&#x27;button&#x27;</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">showModal</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">modalWidth</span> = <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 菜单是否需要激活（如选中加粗文本，“加粗”菜单会激活），用不到则返回 false</span></span><br><span class="line"><span class="title function_">isActive</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取菜单执行时的 value ，用不到则返回空 字符串或 false</span></span><br><span class="line"><span class="title function_">getValue</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 菜单是否需要禁用（如选中 H1 ，“引用”菜单被禁用），用不到则返回 false</span></span><br><span class="line"><span class="title function_">isDisabled</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击菜单时触发的函数</span></span><br><span class="line"><span class="title function_">exec</span>(<span class="params">editor, value</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="comment">// Modal menu ，这个函数不用写，空着即可</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹出框 modal 的定位：1. 返回某一个 SlateNode； 2. 返回 null （根据当前选区自动定位）</span></span><br><span class="line"><span class="title function_">getModalPositionNode</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// modal 依据选区定位</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 modal 内部的 DOM Element</span></span><br><span class="line"><span class="title function_">getModalContentElem</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="keyword">let</span> content = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">btn.<span class="property">innerText</span> = <span class="string">&#x27;确认&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;textarea&#x27;</span>);</span><br><span class="line"></span><br><span class="line">content.<span class="title function_">appendChild</span>(text);</span><br><span class="line">content.<span class="title function_">appendChild</span>(btn);</span><br><span class="line">btn.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> node = &#123; <span class="attr">type</span>: <span class="string">&#x27;remaindFlow&#x27;</span>, <span class="attr">code</span>: text.<span class="property">value</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span> &#125;] &#125;;</span><br><span class="line">editor.<span class="title function_">restoreSelection</span>(); <span class="comment">// 恢复选区</span></span><br><span class="line">editor.<span class="title function_">insertNode</span>(node);</span><br><span class="line"><span class="comment">// mermaid.initialize(&#123; startOnLoad: true &#125;);</span></span><br><span class="line"><span class="comment">// mermaid.init();</span></span><br><span class="line">editor.<span class="title function_">insertBreak</span>();</span><br><span class="line">editor.<span class="title function_">move</span>(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">return</span> content; <span class="comment">// 返回 DOM Element 类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// PS：也可以把 $content 缓存下来，这样不用每次重复创建、重复绑定事件，优化性能</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>editFlow.js</strong></p><p>还没写好测试，跟<strong>MyModalMenu.js</strong>结构差不多    </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">    <span class="title class_">DomEditor</span>,</span><br><span class="line">    <span class="title class_">SlateTransforms</span>,</span><br><span class="line">    <span class="title class_">SlateRange</span>,</span><br><span class="line">    t,</span><br><span class="line">    genModalTextareaElems,</span><br><span class="line">    genModalButtonElems, </span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@wangeditor/editor&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EditFlowMenu</span> &#123; </span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&#x27;编辑流程&#x27;</span>;</span><br><span class="line"><span class="comment">// this.iconSvg = &#x27;&lt;svg &gt;...&lt;/svg&gt;&#x27;</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tag</span> = <span class="string">&#x27;button&#x27;</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">showModal</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">modalWidth</span> = <span class="number">500</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">modalHeight</span> = <span class="number">400</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">buttonId</span> = <span class="title class_">String</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">target</span> = <span class="literal">null</span>;<span class="comment">// 编辑的目标</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="title function_">getSelectedElem</span>(<span class="params">editor</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="title class_">DomEditor</span>.<span class="title function_">getSelectedNodeByType</span>(editor, <span class="string">&#x27;remaindFlow&#x27;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getSelectedElem&quot;</span>, node);</span><br><span class="line">      <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">target</span> = node;</span><br><span class="line">      <span class="keyword">return</span> node</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取公式 value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> editor editor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getValue</span>(<span class="params">editor</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> flowElem = <span class="variable language_">this</span>.<span class="title function_">getSelectedElem</span>(editor)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getValue:&quot;</span>, flowElem);</span><br><span class="line">      <span class="keyword">if</span> (flowElem) &#123;</span><br><span class="line">        <span class="keyword">return</span> flowElem.<span class="property">code</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">isActive</span>(<span class="params">editor</span>) &#123;</span><br><span class="line">      <span class="comment">// 无需 active</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">exec</span>(<span class="params">editor, value</span>) &#123;</span><br><span class="line">      <span class="comment">// 点击菜单时，弹出 modal 之前，不需要执行其他代码</span></span><br><span class="line">      <span class="comment">// 此处空着即可</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">isDisabled</span>(<span class="params">editor</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; selection &#125; = editor</span><br><span class="line">      <span class="keyword">if</span> (selection == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">SlateRange</span>.<span class="title function_">isExpanded</span>(selection)) <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 选区非折叠，禁用</span></span><br><span class="line">  </span><br><span class="line">      <span class="comment">// 未匹配到 flow node 则禁用</span></span><br><span class="line">      <span class="keyword">const</span> flowElem = <span class="variable language_">this</span>.<span class="title function_">getSelectedElem</span>(editor)</span><br><span class="line">      <span class="keyword">if</span> (flowElem == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// modal 定位</span></span><br><span class="line">    <span class="title function_">getModalPositionNode</span>(<span class="params">editor</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getSelectedElem</span>(editor)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">getModalContentElem</span>(<span class="params">editor</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; textareaId, buttonId &#125; = <span class="variable language_">this</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getModalContentElem!&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> [textareaContainerElem, textareaElem] = <span class="title function_">genModalTextareaElems</span>(</span><br><span class="line">        <span class="title function_">t</span>(<span class="string">&#x27;编辑流程&#x27;</span>),</span><br><span class="line">        textareaId,</span><br><span class="line">        <span class="title function_">t</span>(<span class="string">`flowchart LR</span></span><br><span class="line"><span class="string">        A[节点A] --&gt;|开始| B(节点B)</span></span><br><span class="line"><span class="string">        B --&gt; C(节点C)`</span>)</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">const</span> $textarea = textareaElem</span><br><span class="line">      <span class="keyword">const</span> [buttonContainerElem] = <span class="title function_">genModalButtonElems</span>(buttonId, <span class="title function_">t</span>(<span class="string">&#x27;确认&#x27;</span>))</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$content</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 第一次渲染</span></span><br><span class="line">        <span class="keyword">const</span> $content = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>($content);</span><br><span class="line">        <span class="comment">// 绑定事件（第一次渲染时绑定，不要重复绑定）</span></span><br><span class="line">        $content.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">          e.<span class="title function_">preventDefault</span>();</span><br><span class="line">          <span class="keyword">if</span>( e.<span class="property">target</span>.<span class="property">id</span> === buttonId) &#123;</span><br><span class="line">            <span class="comment">// 点击确定按钮 `#$&#123;buttonId&#125;`</span></span><br><span class="line">            <span class="keyword">const</span> value = <span class="title class_">String</span>($content.<span class="title function_">querySelector</span>(<span class="string">`#<span class="subst">$&#123;textareaId&#125;</span>`</span>).<span class="property">value</span>).<span class="title function_">trim</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateflow</span>(editor, value)</span><br><span class="line">            editor.<span class="title function_">hidePanelOrModal</span>() <span class="comment">// 隐藏 modal</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 记录属性，重要</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$content</span> = $content</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">const</span> $content = <span class="variable language_">this</span>.<span class="property">$content</span></span><br><span class="line">      $content.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 先清空内容</span></span><br><span class="line">  </span><br><span class="line">      <span class="comment">// append textarea and button</span></span><br><span class="line">      $content.<span class="title function_">append</span>(textareaContainerElem)</span><br><span class="line">      $content.<span class="title function_">append</span>(buttonContainerElem)</span><br><span class="line">  </span><br><span class="line">      <span class="comment">// 设置 input val</span></span><br><span class="line">      <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="title function_">getValue</span>(editor)</span><br><span class="line">      $textarea.<span class="property">value</span> = value</span><br><span class="line">  </span><br><span class="line">      <span class="comment">// focus 一个 input（异步，此时 DOM 尚未渲染）</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        $textarea.<span class="title function_">focus</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> $content</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="title function_">updateflow</span>(<span class="params">editor, value</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!value) <span class="keyword">return</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;updateflow:&quot;</span>, <span class="variable language_">this</span>.<span class="property">target</span>);</span><br><span class="line">      <span class="comment">// 还原选区</span></span><br><span class="line">      editor.<span class="title function_">restoreSelection</span>()</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isDisabled</span>(editor)) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">const</span> selectedElem = <span class="variable language_">this</span>.<span class="title function_">getSelectedElem</span>(editor)</span><br><span class="line">      <span class="keyword">if</span> (selectedElem == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">const</span> path = <span class="title class_">DomEditor</span>.<span class="title function_">findPath</span>(editor, selectedElem)</span><br><span class="line">      <span class="keyword">const</span> props = &#123; <span class="attr">code</span>: value &#125;</span><br><span class="line">      <span class="title class_">SlateTransforms</span>.<span class="title function_">setNodes</span>(editor, props, &#123; <span class="attr">at</span>: path &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">EditFlowMenu</span></span><br></pre></td></tr></table></figure><p><strong>renderElem.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DomEditor</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@wangeditor/editor&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 渲染“附件”元素到编辑器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> elem 附件元素，即上文的 myResume</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> children 元素子节点，void 元素可忽略</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> editor 编辑器实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> vnode 节点（通过 snabbdom.js 的 h 函数生成）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderFlow</span>(<span class="params">elem, children, editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;renderFlow:&quot;</span>, elem);</span><br><span class="line"><span class="comment">// 获取“附件”的数据，参考上文 myResume 数据结构</span></span><br><span class="line"><span class="keyword">const</span> &#123; code &#125; = elem;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前节点是否选中</span></span><br><span class="line"><span class="keyword">const</span> selected = <span class="title class_">DomEditor</span>.<span class="title function_">isNodeSelected</span>(editor, elem);</span><br><span class="line"><span class="keyword">const</span> formulaVnode = <span class="title function_">h</span>(</span><br><span class="line"><span class="string">&#x27;w-e-flow-card&#x27;</span>,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">dataset</span>: &#123; code &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建容器 vnode</span></span><br><span class="line"><span class="keyword">const</span> containerVnode = <span class="title function_">h</span>(</span><br><span class="line"><span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line"><span class="attr">contentEditable</span>: <span class="literal">false</span>, <span class="comment">// 不可编辑</span></span><br><span class="line"><span class="attr">className</span>: <span class="string">&#x27;mermaid&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">style</span>: &#123;</span><br><span class="line"><span class="attr">display</span>: <span class="string">&#x27;inline-block&#x27;</span>, <span class="comment">// inline</span></span><br><span class="line"><span class="attr">marginLeft</span>: <span class="string">&#x27;3px&#x27;</span>,</span><br><span class="line"><span class="attr">marginRight</span>: <span class="string">&#x27;3px&#x27;</span>,</span><br><span class="line"><span class="attr">border</span>: selected <span class="comment">// 选中/不选中，样式不一样</span></span><br><span class="line">? <span class="string">&#x27;2px solid var(--w-e-textarea-selected-border-color)&#x27;</span></span><br><span class="line">: <span class="string">&#x27;2px solid transparent&#x27;</span>,</span><br><span class="line"><span class="attr">borderRadius</span>: <span class="string">&#x27;3px&#x27;</span>,</span><br><span class="line"><span class="attr">padding</span>: <span class="string">&#x27;3px 3px&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">[code]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> containerVnode</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&#x27;remaindFlow&#x27;</span>, <span class="comment">// 节点 type ，重要！！！</span></span><br><span class="line"><span class="attr">renderElem</span>: renderFlow,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>elemToHtml.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成“附件”元素的 HTML</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> elem 附件元素，即上文的 myResume</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> childrenHtml 子节点的 HTML 代码，void 元素可忽略</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> “附件”元素的 HTML 字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">flowToHtml</span>(<span class="params">elem, childrenHtml</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;flowToHtml:&#x27;</span>, elem);</span><br><span class="line"><span class="comment">// 获取附件元素的数据</span></span><br><span class="line"><span class="keyword">const</span> &#123; code &#125; = elem;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成 HTML 代码</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">`&lt;span class=&quot;mermaid&quot; data-w-e-type=&quot;remaindFlow&quot; data-w-e-is-void data-w-e-is-inline data-code=&quot;<span class="subst">$&#123;code&#125;</span>&quot; &gt;&lt;/span&gt;`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&#x27;remaindFlow&#x27;</span>, <span class="comment">// 节点 type ，重要！！！</span></span><br><span class="line"><span class="attr">elemToHtml</span>: flowToHtml,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>parseElemHtml.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析 HTML 字符串，生成“附件”元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> domElem HTML 对应的 DOM Element</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> children 子节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> editor editor 实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> “附件”元素，如上文的 myResume</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseFlowHtml</span>(<span class="params">domElem, children, editor</span>) &#123;</span><br><span class="line"><span class="comment">// JS 语法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;parseFlowHtml:&quot;</span>, domElem);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从 DOM element 中获取“附件”的信息</span></span><br><span class="line"><span class="keyword">const</span> code = domElem.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-code&#x27;</span>) || <span class="string">&#x27;&#x27;</span>; <span class="comment">//domElem.innerText</span></span><br><span class="line"><span class="comment">// 生成“附件”元素（按照此前约定的数据结构）</span></span><br><span class="line"><span class="keyword">const</span> myResume = &#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&#x27;remaindFlow&#x27;</span>,</span><br><span class="line">code,</span><br><span class="line"><span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span> &#125;], <span class="comment">// void node 必须有 children ，其中有一个空字符串，重要！！！</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> myResume;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">selector</span>: <span class="string">&#x27;span[data-w-e-type=&quot;remaindFlow&quot;]&#x27;</span>,</span><br><span class="line"><span class="attr">parseElemHtml</span>: parseFlowHtml,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>withAttachment.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DomEditor</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@wangeditor/editor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withAttachment</span>(<span class="params">editor</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; isInline, isVoid &#125; = editor;</span><br><span class="line"><span class="keyword">const</span> newEditor = editor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 isInline</span></span><br><span class="line">newEditor.<span class="property">isInline</span> = <span class="function">(<span class="params">elem</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> type = <span class="title class_">DomEditor</span>.<span class="title function_">getNodeType</span>(elem);</span><br><span class="line"><span class="keyword">if</span> (type === <span class="string">&#x27;remaindFlow&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">isInline</span>(elem);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 isVoid</span></span><br><span class="line">newEditor.<span class="property">isVoid</span> = <span class="function">(<span class="params">elem</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> type = <span class="title class_">DomEditor</span>.<span class="title function_">getNodeType</span>(elem);</span><br><span class="line"><span class="keyword">if</span> (type === <span class="string">&#x27;remaindFlow&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">isVoid</span>(elem);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> newEditor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withAttachment;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">RemaindFlow</span> <span class="keyword">from</span> <span class="string">&#x27;./MyModalMenu&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> renderElemConf <span class="keyword">from</span> <span class="string">&#x27;./renderElem&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> elemToHtmlConf <span class="keyword">from</span> <span class="string">&#x27;./elemToHtml&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> parseHtmlConf <span class="keyword">from</span> <span class="string">&#x27;./parseElemHtml&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> withAttachment <span class="keyword">from</span> <span class="string">&#x27;./withAttachment&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> editFlowMenu <span class="keyword">from</span> <span class="string">&#x27;./editFlow&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> flowConf = &#123;</span><br><span class="line"><span class="attr">key</span>: <span class="string">&#x27;remaindFlow&#x27;</span>, <span class="comment">// 定义 menu key ：要保证唯一、不重复（重要）</span></span><br><span class="line"><span class="title function_">factory</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RemaindFlow</span>(); <span class="comment">// 把 `YourMenuClass` 替换为你菜单的 class</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> editFlowMenuConf = &#123;</span><br><span class="line"><span class="attr">key</span>: <span class="string">&#x27;editRemaindFlow&#x27;</span>, <span class="comment">// 定义 menu key ：要保证唯一、不重复（重要）</span></span><br><span class="line"><span class="title function_">factory</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">editFlowMenu</span>(); <span class="comment">// 把 `YourMenuClass` 替换为你菜单的 class</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">menus</span>: [flowConf],</span><br><span class="line"><span class="attr">editorPlugin</span>: withAttachment,</span><br><span class="line"><span class="attr">renderElems</span>: [renderElemConf],</span><br><span class="line"><span class="attr">elemsToHtml</span>: [elemToHtmlConf],</span><br><span class="line"><span class="attr">parseElemsHtml</span>: [parseHtmlConf],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>registerCustomElem.js</strong></p><p>这个方案失败了，原因是 <strong>mermaid.render</strong> 方法会使用document查找获取元素，但是影子dom中元素无法通过 document访问。导致 流程图，渲染不上去。像 marked 那种方式渲染的才方便封装 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newText = marked.<span class="title function_">render</span>(text);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mermaid <span class="keyword">from</span> <span class="string">&quot;mermaid&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WangEditorFlowCard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="keyword">const</span> shadow = <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">document</span> = shadow.<span class="property">ownerDocument</span>;</span><br><span class="line">        <span class="keyword">const</span> pre = <span class="variable language_">this</span>.<span class="property">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;pre&#x27;</span>);</span><br><span class="line">        pre.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline-block&#x27;</span></span><br><span class="line">        pre.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;mermaid&#x27;</span>)</span><br><span class="line">        pre.<span class="property">id</span> = <span class="string">&#x27;mermaid&#x27;</span>;</span><br><span class="line">        shadow.<span class="title function_">appendChild</span>(pre);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pre</span> = pre;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 监听的 attr</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">observedAttributes</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;data-code&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">attributeChangedCallback</span>(<span class="params">name, oldValue, newValue</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;attributeChangedCallback:&quot;</span>, name, oldValue, newValue);</span><br><span class="line">        <span class="keyword">if</span> (name === <span class="string">&#x27;data-code&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (oldValue == newValue) <span class="keyword">return</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">render</span>(newValue || <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> shadowRoot = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>;</span><br><span class="line">        <span class="comment">// 设置 Mermaid 图表代码  </span></span><br><span class="line">        <span class="keyword">const</span> element = shadowRoot.<span class="title function_">getElementById</span>(<span class="string">&#x27;mermaid&#x27;</span>);  </span><br><span class="line">        element.<span class="property">textContent</span> = value;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(element.<span class="title function_">getBoundingClientRect</span>());</span><br><span class="line">        <span class="keyword">if</span> (element) &#123;  </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;初始化&quot;</span>, mermaid);</span><br><span class="line">            mermaid.<span class="title function_">initialize</span>(&#123; <span class="attr">startOnLoad</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            mermaid.<span class="title function_">render</span>(element.<span class="property">id</span>, value, element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">customElements</span>.<span class="title function_">get</span>(<span class="string">&#x27;w-e-flow-card&#x27;</span>)) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">customElements</span>.<span class="title function_">define</span>(<span class="string">&#x27;w-e-flow-card&#x27;</span>, <span class="title class_">WangEditorFlowCard</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="引入使用"><a href="#引入使用" class="headerlink" title="引入使用"></a>引入使用</h3><p>在 main.js 中引用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册 wangEditor 插件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Boot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@wangeditor/editor&#x27;</span>;</span><br><span class="line"><span class="comment">// import &#x27;@/plugins/RemaindFlow/registerCustomElem.js&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> flowModuleConf <span class="keyword">from</span> <span class="string">&#x27;@/plugins/RemaindFlow&#x27;</span>;</span><br><span class="line"><span class="title class_">Boot</span>.<span class="title function_">registerModule</span>(flowModuleConf);</span><br></pre></td></tr></table></figure><p>编辑器配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toolbarConfig = &#123;</span><br><span class="line"><span class="attr">insertKeys</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: <span class="number">1</span>, <span class="comment">// 插入的位置，基于当前的 toolbarKeys</span></span><br><span class="line">        <span class="attr">keys</span>: [<span class="string">&#x27;remaindFlow&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editorConfig = &#123;</span><br><span class="line"><span class="attr">placeholder</span>: <span class="string">&#x27;请输入内容...&#x27;</span>,</span><br><span class="line"><span class="attr">hoverbarKeys</span>: &#123;</span><br><span class="line">        <span class="attr">formula</span>: &#123;</span><br><span class="line">            <span class="attr">menuKeys</span>: [<span class="string">&#x27;editFormula&#x27;</span>], <span class="comment">// “编辑公式”菜单</span></span><br><span class="line">        &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>编辑器更新内容时初始化流程图, </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mermaid <span class="keyword">from</span> <span class="string">&#x27;mermaid&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># @onChange=<span class="string">&quot;handleChanged&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleChanged</span> = (<span class="params">editor</span>) =&gt; &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(editor);</span><br><span class="line">mermaid.<span class="title function_">initialize</span>(&#123; <span class="attr">startOnLoad</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">mermaid.<span class="title function_">init</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>为啥不在插件代码中写这部分逻辑呢，formula 插件 </p><p>katex 可以直接渲染这个元素为 公式，所以使用的自定义元素在影子dom中渲染，但 mermaid 不能这么搞，他对影子DOM无效。暂时没想到更优雅的姿势</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">katex.<span class="title function_">render</span>(value, <span class="variable language_">this</span>.<span class="property">span</span>, &#123;</span><br><span class="line">  <span class="attr">throwOnError</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;插件开发请阅读&lt;a href=&quot;https://www.wangeditor.com/v5/development.html#%E6%B3%A8%E5%86%8C%E6%8F%92%E4%BB%B6%E5%88%B0-wangeditor&quot;&gt;官方文档&lt;/a&gt;，本次示例为 为 编辑器 拓展 &lt;a href=&quot;https://mermaid.nodejs.cn/intro/&quot;&gt;mermaid&lt;/a&gt; 流程图。本示例参考官方 &lt;a href=&quot;https://github.com/wangeditor-team/wangEditor-plugin-formula&quot;&gt;公式插件&lt;/a&gt; 代码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/wangeditor-team/wangEditor-plugin-formula/blob/main/_img/demo.png?raw=true&quot; alt=&quot;wangEditor-plugin-formula&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="插件" scheme="https://wyf195075595.github.io/tags/%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>项目中遇到的问题</title>
    <link href="https://wyf195075595.github.io/2024/01/24/programming/others/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://wyf195075595.github.io/2024/01/24/programming/others/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2024-01-24T07:23:10.000Z</published>
    <updated>2025-05-23T03:48:00.496Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在此记录一些杂七杂八的遇到的神奇的问题</p></blockquote><h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><h3 id="访问阿里云oss图片文件跨域"><a href="#访问阿里云oss图片文件跨域" class="headerlink" title="访问阿里云oss图片文件跨域"></a>访问阿里云oss图片文件跨域</h3><p>项目中 <strong>canvas</strong> 使用 toDataURL() 方法<strong>导出图片</strong>base64信息</p><p>图片设置 <strong>img.crossOrigin = ‘Anonymous’;</strong> 【为啥图片要设置这个，canvas跨域渲染图片会导致画布污染，无法导出图片】结果报错跨域</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to image at xxx from origin xxx has been blocked by CORS policy: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource.</span><br></pre></td></tr></table></figure><p>原因：在网上查询问题原因是由于cdn缓存问题导致。通过控制台 network中的 disabled chache 选项打开就好了，可以确定是这个问题</p><p><img src="https://img-blog.csdnimg.cn/ca9a2ee3f010402696cc9cddc5a64907.png" alt="img"></p><p>解决方法</p><p>在图片路径后边加上时间戳</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://rongdao.oss-cn-beijing.aliyuncs.com/2023/12/19/20231219174004_20231219094008A824.jpg?1706081125760</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_17686345/article/details/127997757">参考文章</a></p><h2 id="环境问题"><a href="#环境问题" class="headerlink" title="环境问题"></a>环境问题</h2><h3 id="window-crypto-randomUUID-无法使用"><a href="#window-crypto-randomUUID-无法使用" class="headerlink" title="window.crypto.randomUUID 无法使用"></a>window.crypto.randomUUID 无法使用</h3><p>原因是 http部署环境下不能使用这个方法，如同 拉取媒体设备，webrtc 也是同样的问题</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="将网站缓存至本地在将其制作成-chm-文档-教程"><a href="#将网站缓存至本地在将其制作成-chm-文档-教程" class="headerlink" title="将网站缓存至本地在将其制作成 .chm 文档 教程"></a>将网站缓存至本地在将其制作成 .chm 文档 教程</h3><p><strong>准备环境和工具</strong>（软件联想应用商店都有，英文版本）</p><ol><li>系统环境：<strong>WIN10</strong>系统</li><li>制作工具：<strong>Teleport Ultra</strong>;<strong>EasyCHM</strong></li></ol><p>制作步骤</p><p><strong>扒目标站点</strong></p><p>启动<strong>Teleport_Ultra.exe</strong>（免费版不能缓存超过500个文件夹），依次选择：文件–&gt;新建项目向导–&gt;复制一个网站，包含该网站的目录结构–&gt;复制网站地址–&gt;下一步–&gt;所有文件–&gt;下一步–&gt;完成</p><p>选择文件保存位置，然后选择保存，最后点击蓝色的小三角形开始下载，等待下载完成整个网站资源</p><p><strong>CHM离线文件制作</strong></p><ol><li>等待文件全部下载完成之后打开<strong>EasyCHM</strong>软件，依次选择：新建–&gt;选择所下载的那个文件夹–&gt;确定，然后等待加载完成所有文件</li><li>搜索完成之后，点击编译按钮即可进行编译环节，CHM设置是生成CHM的手册的配置，默认即可，也可以根据自己的需要进行设置</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;在此记录一些杂七杂八的遇到的神奇的问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;跨域问题&quot;&gt;&lt;a href=&quot;#跨域问题&quot; class=&quot;headerlink&quot; title=&quot;跨域问题&quot;&gt;&lt;/a&gt;跨域问题&lt;/h2&gt;&lt;h3 id=&quot;访问阿</summary>
      
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="杂七杂八" scheme="https://wyf195075595.github.io/tags/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/"/>
    
  </entry>
  
  <entry>
    <title>webrtc 基础</title>
    <link href="https://wyf195075595.github.io/2023/11/08/programming/%E9%9F%B3%E8%A7%86%E9%A2%91/webrtc/"/>
    <id>https://wyf195075595.github.io/2023/11/08/programming/%E9%9F%B3%E8%A7%86%E9%A2%91/webrtc/</id>
    <published>2023-11-08T06:23:10.000Z</published>
    <updated>2023-12-28T01:29:31.379Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>WebRTC是一项实时通讯技术，它允许网络应用或者站点，在不借助中间媒介的情况下，建立浏览器之间点对点的（Peer-to-Peer）的连接，实现视频流和（或）音频流或者其他任意数据的传输。它包括的这些标准使用户在无需安装任何插件或者第三方的软件的情况下，创建点对点（Peer-to-Peer）的数据分享和电话会议成为可能。</p></blockquote><h2 id="理论知识"><a href="#理论知识" class="headerlink" title="理论知识"></a>理论知识</h2><h3 id="媒体协商（sdp）"><a href="#媒体协商（sdp）" class="headerlink" title="媒体协商（sdp）"></a><strong>媒体协商（sdp）</strong></h3><p>​    彼此了解对方支持的媒体格式，这是两个不同网络环境浏览器要实现语音视频通话的首要解决问题</p><h3 id="网络协商（candidate）"><a href="#网络协商（candidate）" class="headerlink" title="网络协商（candidate）"></a><strong>网络协商（candidate）</strong></h3><p>​    了解对方的网络情况</p><ol><li><p>获取外网IP地址映射</p></li><li><p>通信服务器交换网络信息</p></li></ol><p>实际情况是：我们电脑和电脑之间或大或小都是在某个局域网里面，需要NAT(网络地址转换)</p><span id="more"></span><h4 id="STUN"><a href="#STUN" class="headerlink" title="STUN"></a><strong>STUN</strong></h4><p>​    外网映射通信</p><p>STUN是一种网络协议，它允许NAT后的客户端找出自己的公网地址，查出自己位于哪种类型的NAT为某一个本端口绑定的Internel（外网）端端口，外网就可以通过UDP通信。</p><h4 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a><strong>TURN</strong></h4><p>​    中继服务通信</p><p>如果上述外网映射通信不通的话，这时候需要公网作为一个中继，对来网的数据转发，这个转发的协议被定义为TURN</p><p>服务网络（200kbps单向通信一对一带宽为良好的通信）</p><h3 id="信令服务器"><a href="#信令服务器" class="headerlink" title="信令服务器"></a>信令服务器</h3><blockquote><p>两个不同网络环境下的应用程序可以通过信令服务器交换信息，如websocket ,信令服务器一般都是部署到公网，它要求能被两端的应用程序访问到</p></blockquote><h3 id="webrtc-参考示例"><a href="#webrtc-参考示例" class="headerlink" title="webrtc 参考示例"></a><a href="https://juejin.cn/post/7170767923005358094?searchId=20231225153409EC2088B072A98A89F72A">webrtc 参考示例</a></h3><h2 id="Linux-安装-coturn"><a href="#Linux-安装-coturn" class="headerlink" title="Linux 安装 coturn"></a>Linux 安装 coturn</h2><blockquote><p><a href="https://blog.csdn.net/lepaitianshi/article/details/123778506">参考链接</a> stun 服务</p></blockquote><ol><li><p>下载源码</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/coturn/coturn.git</span><br></pre></td></tr></table></figure></li><li><p>下载相关库文件(安装依赖)</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libssl-dev libevent-dev</span><br></pre></td></tr></table></figure></li><li><p>进入源码目录，编译</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/coturn</span><br></pre></td></tr></table></figure></li><li><p>安装</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make -j 4 </span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></li><li><p>配置环境变量</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export coturn_home=/usr/local/coturn</span><br><span class="line">export PATH=$PATH:$coturn_home/bin</span><br></pre></td></tr></table></figure></li><li><p>测试</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nohup turnserver -L 0.0.0.0 -a -u lqf:123456 -v -f -r &gt; /usr/local/coturn/logs &amp;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;WebRTC是一项实时通讯技术，它允许网络应用或者站点，在不借助中间媒介的情况下，建立浏览器之间点对点的（Peer-to-Peer）的连接，实现视频流和（或）音频流或者其他任意数据的传输。它包括的这些标准使用户在无需安装任何插件或者第三方的软件的情况下，创建点对点（Peer-to-Peer）的数据分享和电话会议成为可能。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;理论知识&quot;&gt;&lt;a href=&quot;#理论知识&quot; class=&quot;headerlink&quot; title=&quot;理论知识&quot;&gt;&lt;/a&gt;理论知识&lt;/h2&gt;&lt;h3 id=&quot;媒体协商（sdp）&quot;&gt;&lt;a href=&quot;#媒体协商（sdp）&quot; class=&quot;headerlink&quot; title=&quot;媒体协商（sdp）&quot;&gt;&lt;/a&gt;&lt;strong&gt;媒体协商（sdp）&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;​    彼此了解对方支持的媒体格式，这是两个不同网络环境浏览器要实现语音视频通话的首要解决问题&lt;/p&gt;
&lt;h3 id=&quot;网络协商（candidate）&quot;&gt;&lt;a href=&quot;#网络协商（candidate）&quot; class=&quot;headerlink&quot; title=&quot;网络协商（candidate）&quot;&gt;&lt;/a&gt;&lt;strong&gt;网络协商（candidate）&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;​    了解对方的网络情况&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;获取外网IP地址映射&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;通信服务器交换网络信息&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;实际情况是：我们电脑和电脑之间或大或小都是在某个局域网里面，需要NAT(网络地址转换)&lt;/p&gt;</summary>
    
    
    
    <category term="音视频" scheme="https://wyf195075595.github.io/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
    <category term="webrtc" scheme="https://wyf195075595.github.io/tags/webrtc/"/>
    
  </entry>
  
  <entry>
    <title>虚拟机安装Ubuntu ssh 连接</title>
    <link href="https://wyf195075595.github.io/2023/11/01/programming/linux/ubuntu/"/>
    <id>https://wyf195075595.github.io/2023/11/01/programming/linux/ubuntu/</id>
    <published>2023-11-01T02:23:10.000Z</published>
    <updated>2024-01-11T03:54:10.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Ubuntu 与 conteos 最大区别就是 Ubuntu 安装后自带操作界面。很流畅，虽然conteos 也能安装界面但是不好用，卡的一批。然后就是包管理工具，编辑 等一些命令不一样</p></blockquote><p>下载好 Ubuntu ISO镜像后，在虚拟机上安装好。登录后发现 连接工具 无法访问 Ubuntu</p><p>​    ubuntu18.04中只默认安装了openssh-client,所以如果想用ssh远程登录ubuntu，需要下载安装openssh-server，并启动ssh服务</p><span id="more"></span><h3 id="安装-openssh-server"><a href="#安装-openssh-server" class="headerlink" title="安装 openssh-server"></a>安装 openssh-server</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><h4 id="编辑配置文件-sshd-config"><a href="#编辑配置文件-sshd-config" class="headerlink" title="编辑配置文件 sshd_config"></a>编辑配置文件 sshd_config</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>找到：PermitRootLogin prohibit-password 禁用</p><p>添加：PermitRootLogin yes</p><p>配置重启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启</span></span><br><span class="line">sudo service ssh restart</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置自启动</span></span><br><span class="line">sudo systemctl enable ssh</span><br></pre></td></tr></table></figure><h4 id="防火墙管理"><a href="#防火墙管理" class="headerlink" title="防火墙管理"></a>防火墙管理</h4><p>安装 ufw 系统自带的防火墙管理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ufw</span><br></pre></td></tr></table></figure><p>常用命令</p><ul><li>启用/关闭</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw enable(开启)/disable(关闭)</span><br><span class="line">sudo ufw default deny</span><br></pre></td></tr></table></figure><ul><li>打开或关闭某个端口打开或关闭某个端口</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow smtp　//允许所有的外部IP访问本机的25/tcp (smtp)端口</span><br><span class="line">sudo ufw allow 22/tcp //允许所有的外部IP访问本机的22/tcp (ssh)端口</span><br><span class="line">sudo ufw allow 53 //允许外部访问53端口(tcp/udp)</span><br><span class="line">sudo ufw allow from 192.168.1.100 //允许此IP访问所有的本机端口</span><br><span class="line">sudo ufw allow proto tcp from 192.168.0.1 to 192.168.0.2 port 22 //允许192.168.0.1访问192.168.0.2的22/tcp（ssh）端口</span><br><span class="line">sudo ufw deny smtp //禁止外部访问smtp服务</span><br><span class="line">sudo ufw delete allow smtp //删除上面建立的某条规则</span><br></pre></td></tr></table></figure><ul><li><p>查看防火墙状态</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure></li></ul><p>一般用户，只需如下设置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ufw</span><br><span class="line">sudo ufw enable</span><br><span class="line">sudo ufw default deny</span><br></pre></td></tr></table></figure><p>以上三条命令已经足够安全了，如果你需要开放某些服务，再使用sudo ufw allow开启。</p><h3 id="Ubuntu-18-04关于version-GLIBC-2-28‘-not-found-的问题-https-blog-csdn-net-weixin-46706926-article-details-143070343"><a href="#Ubuntu-18-04关于version-GLIBC-2-28‘-not-found-的问题-https-blog-csdn-net-weixin-46706926-article-details-143070343" class="headerlink" title="[Ubuntu 18.04关于version `GLIBC_2.28‘ not found 的问题](https://blog.csdn.net/weixin_46706926/article/details/143070343)"></a>[Ubuntu 18.04关于version `GLIBC_2.28‘ not found 的问题](<a href="https://blog.csdn.net/weixin_46706926/article/details/143070343">https://blog.csdn.net/weixin_46706926/article/details/143070343</a>)</h3><p>安装node后，输入node命名出现报错</p><p>如果输出中没有<code>GLIBC_2.28</code>，则说明版本不足（例如 Ubuntu 18.04 默认仅支持到 GLIBC 2.27）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">strings /lib/x86_64-linux-gnu/libc.so.6 | grep GLIBC_</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">ldd --version</span><br></pre></td></tr></table></figure><p>安装  GLIBC_2.28 逐行输入即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo su -c &#x27;echo &quot;deb http://security.debian.org/debian-security buster/updates main&quot; &gt;&gt; /etc/apt/sources.list&#x27; root</span><br><span class="line"> </span><br><span class="line">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 112695A0E562B32A 54404762BBB6E853</span><br><span class="line"> </span><br><span class="line">sudo apt update</span><br><span class="line"> </span><br><span class="line">sudo apt install libc6 libc6-dev -y</span><br></pre></td></tr></table></figure><h3 id="电脑vpn共享到虚拟机"><a href="#电脑vpn共享到虚拟机" class="headerlink" title="电脑vpn共享到虚拟机"></a><a href="https://blog.csdn.net/qq_27462573/article/details/130484723#:~:text=%E6%AD%A5%E9%AA%A4%E5%8C%85%E6%8B%AC%E5%B0%86VM%E8%AE%BE,%E5%92%8C%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F%E3%80%82">电脑vpn共享到虚拟机</a></h3><p>vm使用桥接模式，clash 打开允许局域网连接。将本机代理地址填入到 ubuntu http代理</p><h3 id="vi-常用命令"><a href="#vi-常用命令" class="headerlink" title="vi 常用命令"></a>vi 常用命令</h3><blockquote><p>进入vi之后，是处于「命令行模式（command mode）」，您要切换到「插入模式（Insert mode）」才能够输入文字。初次使用vi的人都会想先用上下左右键移动光标，结果电脑一直哔哔叫，把自己气个半死，所以进入vi后，先不要乱动，转换到「插入模式（Insert mode）」再说吧！</p></blockquote><h4 id="插入模式"><a href="#插入模式" class="headerlink" title="插入模式"></a>插入模式</h4><blockquote><p>ESC 可从插入模式回到命令模式</p></blockquote><ol><li>i    光标当前位置插入</li><li>a   光标位置后面追加</li><li>o   换行追加，插入新的一行</li></ol><h4 id="保存退出"><a href="#保存退出" class="headerlink" title="保存退出"></a>保存退出</h4><p>在命令模式下输入 : 开头</p><ul><li>「w」：在冒号输入字母「w」就可以将文件保存起来。</li><li>「 E」 离开vi</li><li>「q」：按「q」就是退出，如果无法离开vi，可以在「q」后跟一个「!」强制离开vi。</li><li>「qw」：一般建议离开时，搭配「w」一起使用，这样在退出的时候还可以保存文件。</li></ul><h4 id="移动光标"><a href="#移动光标" class="headerlink" title="移动光标"></a>移动光标</h4><blockquote><p>vi可以直接用键盘上的光标来上下左右移动，但正规的vi是用小写英文字母「h」、「j」、「k」、「l」，分别控制光标左、下、上、右移一格。</p></blockquote><ul><li>按「ctrl」+「b」：屏幕往“后”移动一页。</li><li>按「ctrl」+「f」：屏幕往“前”移动一页。</li><li>按「ctrl」+「u」：屏幕往“后”移动半页。</li><li>按「ctrl」+「d」：屏幕往“前”移动半页。</li><li>按数字「0」：移到文章的开头。</li><li>按「G」：移动到文章的最后。</li><li>按「$」：移动到光标所在行的“行尾”。</li><li>按「^」：移动到光标所在行的“行首”</li><li>按「w」：光标跳到下个字的开头</li><li>按「e」：光标跳到下个字的字尾</li><li>按「b」：光标回到上个字的开头</li><li>按「#l」：光标移到该行的第#个位置，如：5l,56l</li></ul><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><ul><li>「x」：每按一次，删除光标所在位置的“后面”一个字符。</li><li>「#x」：例如，「6x」表示删除光标所在位置的“后面”6个字符。</li><li>「X」：大写的X，每按一次，删除光标所在位置的“前面”一个字符。</li><li>「#X」：例如，「20X」表示删除光标所在位置的“前面”20个字符。</li><li>「dd」：删除光标所在行。</li><li>「#dd」：从光标所在行开始删除#行</li></ul><h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h4><ul><li>「yw」：将光标所在之处到字尾的字符复制到缓冲区中。</li><li>「#yw」：复制#个字到缓冲区</li><li>「yy」：复制光标所在行到缓冲区。</li><li>「#yy」：例如，「6yy」表示拷贝从光标所在的该行“往下数”6行文字。</li><li>「p」：将缓冲区内的字符贴到光标所在位置。注意：所有与“y”有关的复制命令都必须与“p”配合才能完成复制与粘贴功能。</li></ul><h4 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h4><ul><li>「r」：替换光标所在处的字符。</li><li>「R」：替换光标所到之处的字符，直到按下「ESC」键为止</li></ul><h4 id="恢复-撤消-还原上一次操作"><a href="#恢复-撤消-还原上一次操作" class="headerlink" title="恢复/撤消/还原上一次操作"></a>恢复/撤消/还原上一次操作</h4><p>「u」：如果误执行一个命令，可以马上按下「u」，撤消上一个操作。按多次“u”可以执行多次撤消。</p><h4 id="更改"><a href="#更改" class="headerlink" title="更改"></a>更改</h4><ul><li>「cw」：更改光标所在处的字到字尾处</li><li>「c#w」：例如，「c3w」表示更改3个字</li></ul><h4 id="跳至指定的行"><a href="#跳至指定的行" class="headerlink" title="跳至指定的行"></a>跳至指定的行</h4><ul><li>「ctrl」+「g」列出光标所在行的行号。</li><li>「#G」：例如，「15G」，表示移动光标至文章的第15行行首。</li></ul><h4 id="列出行号"><a href="#列出行号" class="headerlink" title="列出行号"></a>列出行号</h4><p>「set nu」：输入「set nu」后，会在文件中的每一行前面列出行号。</p><h4 id="跳到文件中的某一行"><a href="#跳到文件中的某一行" class="headerlink" title="跳到文件中的某一行"></a>跳到文件中的某一行</h4><p>「#」：「#」号表示一个数字，在冒号后输入一个数字，再按回车键就会跳到该行了，如输入数字15，再回车，就会跳到文章的第15行。</p><h4 id="查找字符"><a href="#查找字符" class="headerlink" title="查找字符"></a>查找字符</h4><ul><li>「/关键字」：先按「/」键，再输入您想寻找的字符，如果第一次找的关键字不是您想要的，可以一直按「n」会往后寻找到您要的关键字为止。</li><li>「?关键字」：先按「?」键，再输入您想寻找的字符，如果第一次找的关键字不是您想要的，可以一直按「n」会往前寻找到您要的关键字为止。</li></ul><h4 id="vi命令列表"><a href="#vi命令列表" class="headerlink" title="vi命令列表"></a>vi命令列表</h4><ul><li>h    左移光标一个字符</li><li>l    右移光标一个字符</li><li>k    光标上移一行</li><li>j    光标下移一行</li><li>^    光标移动至行首</li><li>0    数字“0”，光标移至文章的开头</li><li>G    光标移至文章的最后</li><li>$    光标移动至行尾</li><li>Ctrl+f    向前翻屏</li><li>Ctrl+b    向后翻屏</li><li>Ctrl+d    向前翻半屏</li><li>Ctrl+u    向后翻半屏</li><li>wq filename    储存正在编辑的文件为filename，并退出vi</li></ul><h3 id="安装-ffmpeg"><a href="#安装-ffmpeg" class="headerlink" title="安装 ffmpeg"></a>安装 ffmpeg</h3><blockquote><p><a href="https://www.myfreax.com/how-to-install-ffmpeg-on-ubuntu-18-04/">参考链接</a></p></blockquote><p>ubuntu 18.04 版本 安装 4.x版本 ffmpeg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:jonathonf/ffmpeg-4</span><br><span class="line"></span><br><span class="line">sudo apt install ffmpeg</span><br><span class="line"></span><br><span class="line">// 下载到多少，突然报网络问题断联，补全下载</span><br><span class="line">sudo apt install ffmpeg --prefix</span><br></pre></td></tr></table></figure><p>如果安装ppa 失败，那么要安装这个</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install software-properties-common</span><br></pre></td></tr></table></figure><h3 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h3><blockquote><p>默认安装的 nodejs 是8版本，连npm都不带，不大行。</p><p><a href="https://nodejs.org/dist/">查询nodejs版本</a>,下载 linux-x64.tar.gz 后缀文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v10.16.0/node-v10.16.0-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><p>安装后解压，放到 /usr/local/nodejs-xxx 目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nodejs-xxx </span><br></pre></td></tr></table></figure><h3 id="安装-PM2"><a href="#安装-PM2" class="headerlink" title="安装 PM2"></a>安装 PM2</h3><blockquote><p>PM2是node进程管理工具，可以利用它来简化很多node应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pm2 -g</span><br></pre></td></tr></table></figure><h3 id="设置全局变量"><a href="#设置全局变量" class="headerlink" title="设置全局变量"></a>设置全局变量</h3><ol><li><p>临时设置</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/home/yan/share/usr/local/arm/3.4.1/bin:$PATH</span><br></pre></td></tr></table></figure></li><li><p>当前用户全局</p><p> 打开 ~/.bashrc,添加下面配置</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/home/yan/share/usr/local/arm/3.4.1/bin:$PATH</span><br></pre></td></tr></table></figure></li><li><p>所有用户的全局配置</p><p> 修改 /etc/profile</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/home/yan/share/usr/local/arm/3.4.1/bin:$PATH</span><br></pre></td></tr></table></figure></li><li><p>配置修改生效</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source profile</span><br></pre></td></tr></table></figure></li></ol><h3 id="生成自签证书"><a href="#生成自签证书" class="headerlink" title="生成自签证书"></a>生成自签证书</h3><p><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04">openssl 生成自签证书</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo openssl req \</span><br><span class="line">  -x509 \</span><br><span class="line">  -nodes \</span><br><span class="line">  -days 365 \</span><br><span class="line">  -newkey rsa:2048 \</span><br><span class="line">  -keyout example.key \</span><br><span class="line">  -out example.crt</span><br></pre></td></tr></table></figure><ul><li><code>req</code>：处理证书签署请求。</li><li><code>-x509</code>：生成自签名证书。</li><li><code>-nodes</code>：跳过为证书设置密码的阶段，这样 Nginx 才可以直接打开证书。</li><li><code>-days 365</code>：证书有效期为一年。</li><li><code>-newkey rsa:2048</code>：生成一个新的私钥，采用的算法是2048位的 RSA。</li><li><code>-keyout</code>：新生成的私钥文件为当前目录下的<code>example.key</code>。</li><li><code>-out</code>：新生成的证书文件为当前目录下的<code>example.crt</code>。</li></ul><p>执行后，命令行会跳出一堆问题要你回答，比如你在哪个国家、你的 Email 等等。</p><p><img src="https://www.ruanyifeng.com/blogimg/asset/2018/bg2018022702.png" alt="img"></p><p>其中最重要的一个问题是 Common Name，正常情况下应该填入一个域名，这里可以填 127.0.0.2。</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Common Name (e.g. server FQDN or YOUR name) []:127.0.0.2</span><br></pre></td></tr></table></figure></blockquote><p>回答完问题，当前目录应该会多出两个文件：<code>example.key</code>和<code>example.crt</code>。</p><h3 id="mkcert-exe生成证书"><a href="#mkcert-exe生成证书" class="headerlink" title="mkcert.exe生成证书"></a>mkcert.exe生成证书</h3><blockquote><p>自己给自己签发一个ssl证书,可用于本地生成 ssl 证书</p><p><a href="https://blog.csdn.net/weixin_44692055/article/details/131489771">ubuntu 上使用</a></p></blockquote><ol><li><p><a href="https://dl.filippo.io/mkcert/latest?for=linux/amd64">下载</a></p></li><li><p>将下载二进制文件移动至系统路径</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv mkcert-v1.4.3-linux-amd64 /usr/bin/mkcert</span><br></pre></td></tr></table></figure></li><li><p>设置执行权限</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/bin/mkcert</span><br></pre></td></tr></table></figure></li><li><p>验证 Mkcert 版本</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert --version</span><br></pre></td></tr></table></figure></li><li><p>生成本地 CA 证书</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkcert -install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看证书路径</span></span><br><span class="line">mkcert -CAROOT</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>为本地托管的网站生成证书和密钥文件</p><p> 生成的文件在执行命令目录下</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkcert localhost</span><br></pre></td></tr></table></figure></li><li><p>在nginx 中使用证书</p> <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">   <span class="attribute">listen</span>       <span class="number">443</span> ssl;</span><br><span class="line">   <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">   <span class="attribute">ssl_certificate</span>    /home/ubuntu/.local/share/mkcert/localhost.pem;</span><br><span class="line">   <span class="attribute">ssl_certificate_key</span> /home/ubuntu/.local/share/mkcert/localhost-key.pem;</span><br><span class="line"></span><br><span class="line">   <span class="attribute">ssl_session_cache</span>    shared:SSL:<span class="number">1m</span>;</span><br><span class="line">   <span class="attribute">ssl_session_timeout</span>  <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">   <span class="attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class="line">   <span class="attribute">ssl_prefer_server_ciphers</span>  <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">   <span class="section">location</span> / &#123;</span><br><span class="line">       <span class="attribute">root</span>   html;</span><br><span class="line">       <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>重启 nginx 访问地址</p></li></ol><h3 id="安装软件失败"><a href="#安装软件失败" class="headerlink" title="安装软件失败"></a><strong>安装软件失败</strong></h3><blockquote><p>Could not get lock /var/lib/dpkg/lock-frontend - open (11: Resource temporarily unavailable</p><p><a href="https://blog.csdn.net/weixin_41712499/article/details/130681042">参考</a></p></blockquote><p>这个错误通常意味着有另一个进程正在使用apt命令或dpkg命令，因此无法获得对dpkg锁的访问权限。以下是解决步骤：</p><ol><li><p>确认是否有其他apt或dpkg进程正在运行。可以使用以下命令：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -i apt</span><br><span class="line">ps aux | grep -i dpkg</span><br><span class="line">12</span><br></pre></td></tr></table></figure><p> 如果有其他进程正在运行，请等待它完成并退出。或者杀掉进程</p></li><li><p>如果没有其他进程正在运行，则需要清理锁定文件。可以使用以下命令：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /var/lib/dpkg/lock-frontend</span><br><span class="line">sudo rm /var/lib/dpkg/lock</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 这将删除apt和dpkg使用的所有锁定文件。</p></li><li><p>然后，强制重新配置dpkg数据库：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --configure -a</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>最后，更新软件包列表：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></li></ol><p>然后应该就可以安装或更新软件包了。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Ubuntu 与 conteos 最大区别就是 Ubuntu 安装后自带操作界面。很流畅，虽然conteos 也能安装界面但是不好用，卡的一批。然后就是包管理工具，编辑 等一些命令不一样&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;下载好 Ubuntu ISO镜像后，在虚拟机上安装好。登录后发现 连接工具 无法访问 Ubuntu&lt;/p&gt;
&lt;p&gt;​    ubuntu18.04中只默认安装了openssh-client,所以如果想用ssh远程登录ubuntu，需要下载安装openssh-server，并启动ssh服务&lt;/p&gt;</summary>
    
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/categories/linux/"/>
    
    
    <category term="ubuntu" scheme="https://wyf195075595.github.io/tags/ubuntu/"/>
    
  </entry>
  
  <entry>
    <title>c基础</title>
    <link href="https://wyf195075595.github.io/2023/10/31/programming/c/base/"/>
    <id>https://wyf195075595.github.io/2023/10/31/programming/c/base/</id>
    <published>2023-10-31T06:23:10.000Z</published>
    <updated>2023-11-06T03:09:00.584Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在vscode 中运行c++</p></blockquote><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><a href="https://blog.csdn.net/Winda_shi/article/details/129463163">环境搭建</a></h2><span id="more"></span><ol><li><p><strong>搜索安装 C/C++ 和 code runner 插件</strong></p></li><li><p>下载mingb64,解压，配置环境变量</p></li><li><p>在这个 .vscode 文件夹下新建2个文件作为配置文件（launch.json和tasks.json）</p><p> launch.json</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 使用 IntelliSense 了解相关属性。 </span></span><br><span class="line">    <span class="comment">// 悬停以查看现有属性的描述。</span></span><br><span class="line">    <span class="comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        </span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(gdb) Launch&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/$&#123;fileBasenameNoExtension&#125;.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\Program Files\\mingw64\bin\\gdb.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">//**********要修改为自己的编译器所在的bin路径，形如 c:\\***\\bin\\gdb.exe</span></span><br><span class="line">            <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gc&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p> tasks.json</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gcc&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-g&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-o&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$&#123;fileBasenameNoExtension&#125;.exe&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;owner&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fileLocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;relative&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;line&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>按ctrl+shit+p，搜索找到编辑配置（JSON）文件，并打开检查自己的“includePath”</strong></p><p> 搜索 c/c++, 编辑配置文件</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Win32&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/include/c++&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/include/c++/x86_64-w64-mingw32&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/include/c++/backward&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/include&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/include-fixed&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;D:/Program Files/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/8.1.0/../../../../x86_64-w64-mingw32/include&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;defines&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;_DEBUG&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;UNICODE&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;_UNICODE&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>g++ -v -E -x c++ -，进行查看路径并复制下来</strong></p><p> 上边里面D盘路径都是这个命令查出来的</p></li><li><p>重启vscode</p></li><li><p>编写示例 hello.c</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行 runCode</p></li></ol><h2 id="常用基本类型"><a href="#常用基本类型" class="headerlink" title="常用基本类型"></a>常用基本类型</h2><ul><li>short,int,long  整形</li><li>float,double 浮点型</li><li>char 字符串</li><li>void</li></ul><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><blockquote><p>有序的元素序列</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符数组</span></span><br><span class="line"><span class="type">char</span> arr[<span class="number">2</span>]</span><br><span class="line"><span class="comment">// 整形数组</span></span><br><span class="line"><span class="type">int</span> <span class="built_in">array</span>[<span class="number">10</span>]</span><br></pre></td></tr></table></figure><h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><blockquote><p>类似于对象的概念</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">char</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">em</span> &#123;</span></span><br><span class="line">    red_color = <span class="number">0</span>,</span><br><span class="line">    green_color, <span class="comment">// 1</span></span><br><span class="line">    black_color <span class="comment">// 2</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>储存地址的变量</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义指针</span></span><br><span class="line">type* var</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 使用指针</span></span><br><span class="line">*var</span><br></pre></td></tr></table></figure><h3 id="堆内存的分配于释放"><a href="#堆内存的分配于释放" class="headerlink" title="堆内存的分配于释放"></a>堆内存的分配于释放</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分配内存</span></span><br><span class="line"><span class="type">void</span>* mem = <span class="built_in">malloc</span>(size)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放内存</span></span><br><span class="line"><span class="built_in">free</span>(mem)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line"><span class="type">char</span>* p = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 给内存位置1赋值</span></span><br><span class="line">    *p = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="comment">// 给内存位置2赋值</span></span><br><span class="line">    *(p+<span class="number">1</span>) = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&#x27;%s&#x27;</span>, p);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放内存</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="comment">// 不设置为 Null, 依然可以通过 p 操作内存。类似于bug一样</span></span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><blockquote><p>函数定义没有提升，只能写在调用之前</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">func</span> <span class="params">(<span class="type">int</span> a)</span> &#123; ...&#125;</span><br></pre></td></tr></table></figure><h3 id="函数指针"><a href="#函数指针" class="headerlink" title="函数指针"></a>函数指针</h3><blockquote><p>返回值类型(*<strong>指针变量</strong>名)([<strong>形参</strong>列表])</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明函数指针</span></span><br><span class="line"><span class="type">void</span> (*f) (<span class="type">int</span> a) &#123; ...&#125;</span><br><span class="line"><span class="comment">// 将函数地址赋值给函数指针，可通过f调用函数</span></span><br><span class="line">f = func;</span><br></pre></td></tr></table></figure><h2 id="操作文件"><a href="#操作文件" class="headerlink" title="操作文件"></a>操作文件</h2><blockquote><p>通过 FILE* file;</p></blockquote><p>打开文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FILE* <span class="title function_">fopen</span><span class="params">(path, mode)</span>;</span><br></pre></td></tr></table></figure><p>关闭文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fclose(FILE*);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;在vscode 中运行c++&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://blog.csdn.net/Winda_shi/article/details/129463163&quot;&gt;环境搭建&lt;/a&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="c" scheme="https://wyf195075595.github.io/categories/c/"/>
    
    
    <category term="c" scheme="https://wyf195075595.github.io/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>音视频基础</title>
    <link href="https://wyf195075595.github.io/2023/10/31/programming/%E9%9F%B3%E8%A7%86%E9%A2%91/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <id>https://wyf195075595.github.io/2023/10/31/programming/%E9%9F%B3%E8%A7%86%E9%A2%91/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</id>
    <published>2023-10-31T01:23:10.000Z</published>
    <updated>2025-04-08T10:21:32.915Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>需要了解下Linux和c语言基础，主要用到的工具 ffmpeg</p></blockquote><h3 id="安装-ffmpeg"><a href="#安装-ffmpeg" class="headerlink" title="安装  ffmpeg"></a>安装  ffmpeg</h3><p>mac 环境下推荐 brew 方式， 其他环境推荐使用源码方式下载安装</p><ol><li><p><a href="http://ffmpeg.org/download.html">下载 ffmpeg</a></p><p> 可以选择 git 下载，慢的话用 http方式下载快照版本</p></li><li><p>编译 ffmpeg</p><p> 如果出现操作权限不够，可以同过在命令前面加 sudo 提高权限</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 指定安装目录 /usr/local/ffmpeg，设置debug模式3</span><br><span class="line">./configure -prefix=/usr/local/ffmpeg -enable-debug=3</span><br><span class="line">// 指定 4核模式</span><br><span class="line">make -j 4</span><br><span class="line">// 安装</span><br><span class="line">make install</span><br></pre></td></tr></table></figure> <span id="more"></span></li></ol><h3 id="直播客户端处理流程"><a href="#直播客户端处理流程" class="headerlink" title="直播客户端处理流程"></a>直播客户端处理流程</h3><p>共享端</p><ol><li>音视频采集</li><li>音视频编码</li></ol><p>观管端</p><ol><li>音视频解码</li><li>音视频渲染</li></ol><h3 id="音频"><a href="#音频" class="headerlink" title="音频"></a>音频</h3><h4 id="音频数据流"><a href="#音频数据流" class="headerlink" title="音频数据流"></a>音频数据流</h4><blockquote><p>采集的音视频数据为 PCM 数据</p></blockquote><ol><li>PCM  原始数据</li><li>acc/mp3  编码</li><li>mp4/flv  封装生成多媒体文件</li></ol><h4 id="声音的三要素"><a href="#声音的三要素" class="headerlink" title="声音的三要素"></a>声音的三要素</h4><ol><li>音调  由震动的频率快慢决定</li><li>音量  由振幅的高低决定</li><li>音色  影响的决定因素是谐波</li></ol><h4 id="音频的原始数据格式"><a href="#音频的原始数据格式" class="headerlink" title="音频的原始数据格式"></a>音频的原始数据格式</h4><ol><li>PCM</li><li>WAV  此格式是在PCM数据套上指定格式头部信息</li></ol><h4 id="量化基本概念"><a href="#量化基本概念" class="headerlink" title="量化基本概念"></a>量化基本概念</h4><ol><li>采样大小：一个采样放置多少bit数据。通常16bit</li><li>采样率：采样频率8k,16k,44.1k,48k（1s钟采样次数）</li><li>声道数：单声道，双声道，多声道</li></ol><h4 id="码率计算"><a href="#码率计算" class="headerlink" title="码率计算"></a>码率计算</h4><p>要算一个PCM音频流的码率是一件很轻松的事情，采样率x采样大小x声道数。</p><p>例如:<strong>采样率</strong>为44.1KHz，<strong>采样大小</strong>为16bit，<strong>双声道</strong>的 PCM 编码的<strong>WAV文件</strong>，它的码率为44.1Kx16x2=1411.2Kb/s.</p><h4 id="音频采集"><a href="#音频采集" class="headerlink" title="音频采集"></a>音频采集</h4><blockquote><p>通过 ffmpeg 封装的api对Android，ios,pc 等端 采集，不需要了解各端的具体api</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 通过avfoundation库对 mac 端音频采集，不同端采集命令会有所不同</span><br><span class="line">ffmpeg -f avfoundation -i :0 out.wav</span><br><span class="line"></span><br><span class="line">ffplay out.wav</span><br></pre></td></tr></table></figure><h4 id="音频压缩"><a href="#音频压缩" class="headerlink" title="音频压缩"></a>音频压缩</h4><ol><li><p>有损压缩：压缩后去除冗余信息（人类听觉范围之外的频段），并且无法恢复成未压缩前的状态</p></li><li><p>无损压缩：编码压缩后，可以通过解码还原会压缩前的状态</p><p> 熵编码</p><ul><li>哈夫曼编码</li><li>算数编码</li><li>香浓编码</li></ul></li></ol><h4 id="常见的音频编码器"><a href="#常见的音频编码器" class="headerlink" title="常见的音频编码器"></a>常见的音频编码器</h4><p>OPUS&gt;AAC&gt;Ogg&gt;other</p><ul><li>OPUS 较新,比较强</li><li>AAC  直播应用，成熟应用范围广（取代mp3）</li><li>Ogg</li><li>Speex</li><li>iLBC</li><li>AMR</li><li>G.711 固话应用</li></ul><h4 id="AAC规格描术"><a href="#AAC规格描术" class="headerlink" title="AAC规格描术"></a>AAC规格描术</h4><ul><li>AAC LC :(Low Complexity) 低复杂度规格,码流是<strong>128k</strong>，音质好。</li><li>AAC HE:等于 AAC LC + SBR (Spectral Band Replication)。其核心思相是按频谱分保存。低频编码保存主要成分，高频单独放大编码保存音质。码流在<strong>64k左右</strong></li><li>AAC HE V2:等于 AAC LC + SBR + PS(Parametric Stereo)。其核心思相是双声道中的声音存在某种相似性，只需存储一个声道的全部信息，然后，花很少的字节用参数描述另一个声道和它不同的地方。</li></ul><h4 id="AAC格式"><a href="#AAC格式" class="headerlink" title="AAC格式"></a>AAC格式</h4><ul><li>ADIF ( Audio Data Interchange Format )<br>  这种格式的特征是可以确定的找到这个音频数据的开始，<strong>只能从头开始解码</strong>，不能在音频数据流中间开始。这种格式常用在磁盘文件中</li><li>ADTS( Audio Data Transport Stream<br>  这种格式的特征是每一帧都有一个同步字，所以<strong>可以在音频流的任何位置开始解码</strong>。它类似于数据流格式。</li></ul><h4 id="ffmpeg-生成-AAC-文件"><a href="#ffmpeg-生成-AAC-文件" class="headerlink" title="ffmpeg 生成 AAC 文件"></a>ffmpeg 生成 AAC 文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//-vn 没有视频 指定音频编码器 libfdk_aac,-profile 设置编码器参数,  采样率 44100</span><br><span class="line">ffmpeg -i xxx.mp4</span><br><span class="line">-vn -c:a libfdk_aac</span><br><span class="line">-ar 44100 -channels 2 -profile:a aac_he_v2 3.aac</span><br><span class="line"></span><br><span class="line">// libfdk_aac 这玩意额还需要重新编译ffmpeg, 换 acc</span><br><span class="line">ffmpeg -i jjjr.mp4 -vn -c:a aac -ar 44100 -channels 2   1.aac</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="什么是音频重采样"><a href="#什么是音频重采样" class="headerlink" title="什么是音频重采样 ?"></a>什么是音频重采样 ?</h4><p>将<strong>音频三元组</strong>(采样率，采样大小和通道数)的值转成另外一组值<br>例如:将 44100/16/2 转成 48000/16/2. 三要素任何一个或多个发生变化，都叫做重采样</p><h4 id="为什么要重采样"><a href="#为什么要重采样" class="headerlink" title="为什么要重采样"></a>为什么要重采样</h4><ul><li>从设备<strong>采集的音频数据与编码器要求的数据不一致</strong>、</li><li><strong>扬声器要求的音频数据与要播放的音频数据不一致</strong></li></ul><h3 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h3><ul><li>由一组图像组成</li><li>为了传输/占用更小的空间而被压缩</li><li>最终在显示设备上展示(未被压缩)</li></ul><h4 id="图像"><a href="#图像" class="headerlink" title="图像"></a>图像</h4><ul><li><p>像素</p><p>  位深</p><ul><li>RGB24位</li><li>RGBA32位</li></ul></li><li><p>RGB</p><p>  每个像素由红绿蓝三个发光二极管组成</p></li><li><p>分辨率</p><p>  屏幕的横向像素与纵向像素比</p></li></ul><h4 id="图像与屏幕的关系"><a href="#图像与屏幕的关系" class="headerlink" title="图像与屏幕的关系"></a>图像与屏幕的关系</h4><ul><li>图像是数据</li><li>屏幕是显示设备</li><li>图像数据经过驱动程序让屏幕显示图像</li></ul><h4 id="RGB的色彩问题"><a href="#RGB的色彩问题" class="headerlink" title="RGB的色彩问题"></a>RGB的色彩问题</h4><blockquote><p>图片会展示色彩不一致问题</p></blockquote><ul><li>RGB 与 BGR</li><li>BMP 使用的是 BGR格式，需要进行转换</li></ul><h4 id="屏幕指标"><a href="#屏幕指标" class="headerlink" title="屏幕指标"></a>屏幕指标</h4><ul><li><p>PPI ( pixels per inch )</p><p>  每英寸的像素数</p></li><li><p>DPI ( Dots pen inch )</p><p>  每英寸的而点数（每个点对应指定像素）</p></li><li><p>PPI &gt;300 就属于视网膜级别</p></li></ul><h4 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h4><ul><li>X轴的像素个数xY轴的像素个数</li><li>常见的宽高比 16:9 /4:3 （屏比不同需要转换）</li><li>370p,720p,1k,2k</li></ul><h4 id="帧率"><a href="#帧率" class="headerlink" title="帧率"></a>帧率</h4><ul><li>每秒钟采集/播放图像的个数</li><li>动画的帧率是25帧/s</li><li>常见的帧率:15帧/s(可满足视频通话)，30/s,60帧/s</li></ul><h4 id="未编码视频的RGB码流"><a href="#未编码视频的RGB码流" class="headerlink" title="未编码视频的RGB码流"></a>未编码视频的RGB码流</h4><p>RGB码流 = 分变率(宽x高)x 3(Byte) x 率(25帧)<br>例如:1280x720x3x25 =69120000  约 69M</p><h4 id="图像的显示"><a href="#图像的显示" class="headerlink" title="图像的显示"></a>图像的显示</h4><ul><li>图像大小等于显示区域大小</li><li>图像小于显示区域(拉伸/留白)</li><li>图像大于显示区域(缩小/截断)</li></ul><h4 id="YUV"><a href="#YUV" class="headerlink" title="YUV"></a>YUV</h4><p>电视图像格式</p><ul><li>YUV(也称YCbCr):Y 表示明亮度，UV 的作用是描述影像色彩及饱和度<ul><li>主要的采样格式有YUV4:2:0、YUV4:2:2和YUV4:4:4 （可能需要转为前面两种格式）</li></ul></li></ul><h4 id="RGB与YUV的关系"><a href="#RGB与YUV的关系" class="headerlink" title="RGB与YUV的关系"></a>RGB与YUV的关系</h4><ul><li>RGB用于屏幕图像的展示</li><li>YUV用于采集与编码</li></ul><h4 id="RGB转YUV"><a href="#RGB转YUV" class="headerlink" title="RGB转YUV"></a>RGB转YUV</h4><ul><li><p>Y=0.299*R +0.587*G+0.114*B</p></li><li><p>U=-0.147*R-0.289*G+0.436*B =0.492*(B-Y)</p></li><li><p>V=0.615*R-0.515*G-0.100*B =0.877*(R-Y)</p></li></ul><h4 id="YUV转RGB"><a href="#YUV转RGB" class="headerlink" title="YUV转RGB"></a>YUV转RGB</h4><ul><li><p>R=Y+1.140*V</p></li><li><p>G=Y-0.394*U-.581*V</p></li><li><p>B=Y+2.032*U</p></li></ul><h4 id="YUV常见格式"><a href="#YUV常见格式" class="headerlink" title="YUV常见格式"></a>YUV常见格式</h4><ul><li><p>YUV4:4:4</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231106164714713.png" alt="image-20231106164714713"></p></li><li><p>YUV4:2:2</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231106164727599.png" alt="image-20231106164727599"></p></li><li><p>YUV4:2:0(最广泛)</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231106164747605.png" alt="image-20231106164747605"></p><p>  4:2:0并不意味着只有Y、Cb两个分量，而没有Cr分量。它实际指得是对每行扫描线来说，只有一种色度分量，它以2:1的抽样率存储相邻的扫描行存储不同的色度分量，也就是说，如果一行是4:2:0的话，下一行就是4:0:2，再下一行是4:2:0…以此类推</p></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231106165308303.png" alt="image-20231106165308303"></p><h4 id="数据量的计算"><a href="#数据量的计算" class="headerlink" title="数据量的计算"></a>数据量的计算</h4><p>电视从黑白电视（YUV）发展到彩色电视(RGB)，为了兼容以前的格式。所以要使用YUV</p><ul><li>YUV =Y*1.5</li><li>YUV = RGB/2</li></ul><h4 id="未编码视频的YUV码流"><a href="#未编码视频的YUV码流" class="headerlink" title="未编码视频的YUV码流"></a>未编码视频的YUV码流</h4><ul><li>RGB码流 =分辩率(宽x高)x 3x 率</li><li>YUV码流 =分辩率(宽x高)x 1.5x 率</li></ul><blockquote><p><a href="https://en.wikipedia.org/wiki/YUV">YUV拓展</a></p></blockquote><h3 id="生成YUV"><a href="#生成YUV" class="headerlink" title="生成YUV"></a>生成YUV</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i jjjr.mp4 -an -c:v rawvideo -pix_fmt yuv420p out.yuv</span><br></pre></td></tr></table></figure><h4 id="播放YUV"><a href="#播放YUV" class="headerlink" title="播放YUV"></a>播放YUV</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 需要指定生成时的清晰度和分辨率</span><br><span class="line">ffplay -pix_fmt yuv420p -s 1280x720 out.yuv</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="播放Y-分量"><a href="#播放Y-分量" class="headerlink" title="播放Y 分量"></a>播放Y 分量</h4><p>y分量存储的是黑白视频信息，单独播放U，V 分量播放没有显示颜色</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffplay -pix_fmt yuv420p -s 1280x720</span><br><span class="line">-vf extractplanes= &#x27;y&#x27; out.yuv</span><br></pre></td></tr></table></figure><h3 id="h264编码"><a href="#h264编码" class="headerlink" title="h264编码"></a>h264编码</h3><h4 id="H264压缩比"><a href="#H264压缩比" class="headerlink" title="H264压缩比"></a>H264压缩比</h4><p>条件:</p><ul><li>YUV格式为 YUV420</li><li>分辨率为 640x480</li><li>帧率为 15</li></ul><p>建议码流:500kpbs<br>结果:约1/100</p><p><a href="https://docs.agora.io/cn">码流参考值</a></p><h4 id="GOP"><a href="#GOP" class="headerlink" title="GOP"></a>GOP</h4><blockquote><p>强相关视频帧分组，GOP中帧与帧之间的差别小</p></blockquote><h4 id="编码帧分类"><a href="#编码帧分类" class="headerlink" title="编码帧分类"></a>编码帧分类</h4><ul><li><strong>I</strong>(intraframe frame)，关键帧，采用内压缩技术。<strong>IDR帧</strong>属于I帧</li><li><strong>P</strong> (forward Predicted frame)，前参考。压缩时，只参考前面已经处理的帧，采用帧间压缩技术。它占顿的一半大小</li><li><strong>B</strong> (Bidirectionally predicted frame)，双向参考。压缩时既参考前面已经处理的帧，也参考后面的帧，间压缩技术。它占I帧1/4大小</li></ul><p><strong>IDR帧与I顿的区别与联系</strong></p><ul><li>IDR(Instantaneous Decoder Refresh)解码器立即刷新</li><li>每当遇到IDR 帧时，解码器就会清空解码器参考buffer中的内容每个 </li><li>GOP 中的第一帧就是 IDR </li><li>IDR 帧是一种特殊的I帧</li></ul><h4 id="H264压缩技术"><a href="#H264压缩技术" class="headerlink" title="H264压缩技术"></a>H264压缩技术</h4><ul><li>帧内压缩，解决的是空域数据几余问题</li><li>帧间压缩，解决的是时域数据几徐问题</li><li>整数离散余弦变换(DCT)，将空间上的相关性变为频域上无关的数据然后进行量化</li><li>CABAC压缩</li></ul><h4 id="Profile与Level"><a href="#Profile与Level" class="headerlink" title="Profile与Level"></a>Profile与Level</h4><ul><li>H264 Profile<br>  对视频压缩特性的描述，Profile越高，就说明采用了越高级的压缩特性</li><li>H264 Level<br>  Level是对视频的描述,Level越高，视频的码率、分辨率、fps越高</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231107114030959.png" alt="image-20231107114030959"></p><h3 id="RTMP协议"><a href="#RTMP协议" class="headerlink" title="RTMP协议"></a>RTMP协议</h3><h3 id="FLV协议"><a href="#FLV协议" class="headerlink" title="FLV协议"></a>FLV协议</h3><p>就是RTMP协议加上了 flv header</p><h3 id="Nginx-搭建流媒体服务器"><a href="#Nginx-搭建流媒体服务器" class="headerlink" title="Nginx 搭建流媒体服务器"></a>Nginx 搭建流媒体服务器</h3><ol><li>下载 <a href="http://nginx.org/en/download.html">nginx 源码</a></li><li>下载<a href="https://github.com/arut/nginx-rtmp-module.git">nginx-rtmp-module</a></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/arut/nginx-rtmp-module/archive/v1.2.1.zip</span><br><span class="line">unzip v1.2.1.zip</span><br><span class="line"></span><br><span class="line">wget http://nginx.org/download/nginx-1.19.3.tar.gz</span><br><span class="line">tar -zxvf nginx-1.19.3.tar.gz</span><br><span class="line">cd nginx-1.19.3/</span><br><span class="line"></span><br><span class="line">// 指定安装目录 -prefix=/usr/local/nginx，--add-module添加rtmp模块</span><br><span class="line">./configure --add-module=../nginx-rtmp-module-1.2.1/</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h4 id="安装踩坑总结"><a href="#安装踩坑总结" class="headerlink" title="安装踩坑总结"></a>安装踩坑总结</h4><p><a href="https://www.cnblogs.com/always-chen/articles/11320975.html">./configure 报错</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: C compiler cc is not found</span><br><span class="line"> </span><br><span class="line">解决办法 apt install g++</span><br><span class="line"> </span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line"> </span><br><span class="line">解决办法 apt install libpcre3 libpcre3-dev</span><br><span class="line"> </span><br><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line"> </span><br><span class="line">解决办法 apt install openssl libssl-dev</span><br><span class="line"> </span><br><span class="line">./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class="line"> </span><br><span class="line">解决办法 下载zlib-1.2.8.tar.gz 解压，./configure  &amp;&amp; make &amp;&amp; make install安装</span><br><span class="line"> </span><br><span class="line">./configure: error: the HTTP XSLT module requires the libxml2/libxslt</span><br><span class="line"> </span><br><span class="line">解决办法 apt-get install libxml2 libxml2-dev libxslt-dev</span><br></pre></td></tr></table></figure><p>make 命令报错</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install make</span><br></pre></td></tr></table></figure><p><a href="https://zhuanlan.zhihu.com/p/655809776">下载 zlib</a></p><h4 id="nginx配置文件"><a href="#nginx配置文件" class="headerlink" title="nginx配置文件"></a>nginx配置文件</h4><p>与http 同层级</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rtmp <span class="punctuation">&#123;</span></span><br><span class="line">    server <span class="punctuation">&#123;</span></span><br><span class="line">    # ffmpeg 默认推流到<span class="number">1935</span>端口</span><br><span class="line">        listen <span class="number">1935</span>;</span><br><span class="line">        chunk_size <span class="number">4096</span>;</span><br><span class="line">    # 应用名称</span><br><span class="line">        application live <span class="punctuation">&#123;</span></span><br><span class="line">            live on;</span><br><span class="line">            record off;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="检测nginx"><a href="#检测nginx" class="headerlink" title="检测nginx"></a>检测nginx</h4><p>访问nginx 地址 会出现 welcome 界面</p><p>查看 1935 端口是否在监听</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an |grep 1935</span><br></pre></td></tr></table></figure><h4 id="推流与拉流"><a href="#推流与拉流" class="headerlink" title="推流与拉流"></a>推流与拉流</h4><p>ubuntu 系统下可以直接拉流播放</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">推</span></span><br><span class="line">ffmpeg -re -i /home/ubuntu/Videos/jjjr.mp4 -c copy -f flv rtmp://localhost/live/room</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉</span></span><br><span class="line">ffplay rtmp://localhost/live/room</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231107170654669.png" alt="image-20231107170654669"></p><h3 id="SRS介绍"><a href="#SRS介绍" class="headerlink" title="SRS介绍"></a>SRS介绍</h3><blockquote><p>SRS( Simple Rtmp Server)，它是单进程实现的。在同一台服务器上可以起动多个进程同时提供服务。</p><p>它的定位是运营级的互联网直播服务器集群，它提供了非常丰富的接入方案，支持 RTMP、HLS、HTTP-FLV等。</p><p>国内开源项目</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231107163821132.png" alt="image-20231107163821132"></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231107163943349.png" alt="image-20231107163943349"></p><p><a href="https://ossrs.io/lts/zh-cn/docs/v5/doc/getting-started-build">官方文档</a></p><h4 id="VHost"><a href="#VHost" class="headerlink" title="VHost"></a>VHost</h4><ul><li>支持多客户</li><li>支持多配置</li><li>域名调度</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20231107170847041.png" alt="image-20231107170847041"></p><h4 id="Vhost配置"><a href="#Vhost配置" class="headerlink" title="Vhost配置"></a>Vhost配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">listen <span class="number">1935</span>;</span><br><span class="line">vhost show.cctv.cn <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">vhost show.wasu.cn <span class="punctuation">&#123;</span> </span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><a href="https://support.dahuatech.com/tools/sdkExploit/267">大华web无插件开发包</a></p><blockquote><p><strong>功能说明：</strong></p><p>1、WEB无插件开发包是基于标准HTML5技术开发，在不使用插件的情况下，为大华各类网络摄像机、球机、NVR等产品提供音视频播放二次开发服务。</p><p>2、该方案使用<strong>Websocket+RTSP/RTP</strong>推流，WASM解码方式进行音视频的解码播放，具有高安全性、可扩展性和跨平台等特点；支持<strong>H264,H265</strong>等视频编码模式；适用于谷歌、火狐、safari、Edge浏览器。</p><p>3、支持搭建nginx代理服务实现云台、录像查询等业务。</p></blockquote><p><a href="https://open.hikvision.com/download/5cda567cf47ae80dd41a54b3?type=10&id=4c945d18fa5f49638ce517ec32e24e24">海康WEB无插件开发包</a></p><blockquote><p>WEB3.3控件开发包 V3.3,登陆后下载</p><p>HCWebSDK，以 JavaScript 接口形式提供用户集成，支持网页上实现预览、回放、云台控制等功能。支持Win32&amp;Win64，支持的浏览器：Chrome57+、Firefox52+。</p></blockquote><p><strong>给你推荐两个毫秒级方案：<br>\1. github搜webrtc-streamer，拉rtsp流转webrtc播放<br>\2. ffmpeg转flv rtmp推到SRS流媒体服务器，从SRS上拉webrtc流播放</strong></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;需要了解下Linux和c语言基础，主要用到的工具 ffmpeg&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;安装-ffmpeg&quot;&gt;&lt;a href=&quot;#安装-ffmpeg&quot; class=&quot;headerlink&quot; title=&quot;安装  ffmpeg&quot;&gt;&lt;/a&gt;安装  ffmpeg&lt;/h3&gt;&lt;p&gt;mac 环境下推荐 brew 方式， 其他环境推荐使用源码方式下载安装&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://ffmpeg.org/download.html&quot;&gt;下载 ffmpeg&lt;/a&gt;&lt;/p&gt;
&lt;p&gt; 可以选择 git 下载，慢的话用 http方式下载快照版本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;编译 ffmpeg&lt;/p&gt;
&lt;p&gt; 如果出现操作权限不够，可以同过在命令前面加 sudo 提高权限&lt;/p&gt;
 &lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// 指定安装目录 /usr/local/ffmpeg，设置debug模式3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure -prefix=/usr/local/ffmpeg -enable-debug=3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 指定 4核模式&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make -j 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 安装&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="音视频" scheme="https://wyf195075595.github.io/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
    
    <category term="音视频" scheme="https://wyf195075595.github.io/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
  </entry>
  
  <entry>
    <title>GeoServer</title>
    <link href="https://wyf195075595.github.io/2023/10/09/programming/java/geoserver/"/>
    <id>https://wyf195075595.github.io/2023/10/09/programming/java/geoserver/</id>
    <published>2023-10-09T03:00:00.000Z</published>
    <updated>2023-11-29T09:14:15.598Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>GeoServer 是一个优秀得开源的GIS服务器，它相较于商用的GIS软件 ArcGIS Server\SuperMap iServer 等服务器软件，它能实现大多数场景下项目对GIS的功能要求，而且有活跃的社区支持，在实际生产中也越来越受到开发者的青睐。</p></blockquote><h3 id="GeoServer的诞生历史"><a href="#GeoServer的诞生历史" class="headerlink" title="GeoServer的诞生历史"></a><strong>GeoServer的诞生历史</strong></h3><blockquote><p>GeoServer于2001年由总部位于纽约的非盈利技术孵化器open planning project (TOPP),启动TOPP正在创建一套工具，以实现开放民主，并帮助政府更加透明。第一个是GeoServer，这是因为人们认识到，共享空间数据的能力将(成为) 大大增强公民参与政府和城市规划的一套工具。</p><p>GeoServer的创始人设想了一个类似于万维网的地理空间网。通过万维网，人们可以搜索和下载文本。通过地理空间网，人们可以搜索和下载空问数据。数据提供者将能够直接将他们的数据发布到这个网站上，用户可以直接访问它，而不是现在存在的间接和繁琐的数据共享方法。</p><p>GeoServer的相关人员创建了<strong>GeoTools</strong>项目，这是一个开源的GIS Java工具包。通过GeoTools，增加了对shapefile、Oracle数据库、ArcSDE集成等的支持</p><p>其他项目变得相互关联。Refractions Research创建了一个免费开放的空间数据库<strong>PostGIS</strong>，使GeoServer能够连接到一个免费的数据库。另外，MetaCarta最初创建了<strong>OpenLayers</strong>.一个基于开源浏览器的地图查看工具。这些工具一起增强了GeoServer的功能。</p><p><strong>这使得使用开源技术路线构建GIS工作流成为可能，数据可以从PostGIS流入GeoServer、再应用OpenLayers将GeoServer发布的地图服务在前端进行展现和互操作。</strong></p></blockquote><h3 id="WebGIS开发环境搭建"><a href="#WebGIS开发环境搭建" class="headerlink" title="WebGIS开发环境搭建"></a>WebGIS开发环境搭建</h3><p><a href="https://pan.baidu.com/s/19pQDJzOeI_-7VtA-JVtwHQ">下载</a>完成后可参考b站视频<a href="https://www.bilibili.com/video/BV1vk4y127P8/?spm_id_from=333.337.search-card.all.click&vd_source=727712d64f5d5487bf0a89c7b9de461d">教程</a></p><span id="more"></span><h3 id="安装-GeoServer"><a href="#安装-GeoServer" class="headerlink" title="安装 GeoServer"></a>安装 GeoServer</h3><p><a href="https://geoserver.org/download/">下载地址</a>: 选择stable 稳定的版本。此软件不需要安装，解压后进入 bin 目录，找到 startup.bat/sh。 windows,linux，ios都行，执行对应脚本即可。</p><blockquote><p>提示：选择jdk11+版本环境，低版本不支持</p></blockquote><p>启动</p><blockquote><p><a href="http://ip:8080/geoserver">http://ip:8080/geoserver</a></p><p>找到对应ip然后访问</p><p>系统默认账户密码</p><p>admin    geoserver</p></blockquote><h3 id="发布-shapefile"><a href="#发布-shapefile" class="headerlink" title="发布 shapefile"></a>发布 shapefile</h3><ol><li><p>准备shapefile文件数据</p><p> <a href="https://docs.geoserver.org/stable/en/user/_downloads/30e405b790e068c43354367cb08e71bc/nyc_roads.zip">测试数据链接</a></p></li><li><p>创建工作区</p></li><li><p>创建数据存储</p></li><li><p>发布图层</p></li><li><p>图层预览，客户端调用</p></li></ol><h3 id="发布GeoTIFF-影像文件"><a href="#发布GeoTIFF-影像文件" class="headerlink" title="发布GeoTIFF 影像文件"></a>发布GeoTIFF 影像文件</h3><blockquote><p><strong>TIFF</strong>(Tag Image File Format) 图像文件是图形图像处理中常用的格式之一,其图像格式很复杂,但由于它对图像信息的存放灵活多变,可以支持很多色彩系统,而且独立于操作系统<br>因此得到了广泛应用。在各种地理信息系统、摄影测量与遥感等应用中,要求图像具有地理编码信息,例如图像所在的坐标系、比例尺、图像上点的坐标、经纬度、长度单位及角度单位等等。对于存储和读取这些信息,纯TIFF 格式的图像文件是很难做到的,而GeOTIFF 作为TIFF 的一种扩展,在TIFF 的基础上定义了一些GeoTag (地理标签),来对各种坐标系统、椭球基准、投影信息等进行定义和存储,使图像数据和地理数据存储在同一图像文件中,这样就为广大用户制作和使用带有地理信息的图像提供了方便的途径。</p></blockquote><p>发布步骤和上面基本一致，只是在创建数据存储时选择 TIFF 格式文件</p><h3 id="使用-postgreSQL-创建-postgis-数据库"><a href="#使用-postgreSQL-创建-postgis-数据库" class="headerlink" title="使用 postgreSQL 创建 postgis 数据库"></a>使用 postgreSQL 创建 postgis 数据库</h3><blockquote><p>储存空间数据的数据库</p></blockquote><ol><li><p>安装 postgreSQL 数据库管理系统</p></li><li><p>安装 postgis 数据库</p></li><li><p>使用postgreSQL 创建 postgis 数据库</p><p> postgreSQL  创建数据库后执行下面语句创建一个 postgis 数据库</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTENSION postgis;</span><br><span class="line">CREATE EXTENSION postgis_topology;</span><br><span class="line">CREATE EXTENSION postgis_sfcgal;</span><br><span class="line">CREATE EXTENSION fuzzystrmatch;</span><br><span class="line">CREATE EXTENSION address_standardizer;</span><br><span class="line">CREATE EXTENSION address_standardizer_data_us;</span><br><span class="line">CREATE EXTENSION postgis_tiger_geocoder;</span><br></pre></td></tr></table></figure><p> <a href="https://docs.geoserver.org/stable/en/user/_downloads/bbd4b941ceb36074c9d19feab3f57609/nyc_buildings.zip">测试数据</a>，下载后是一个sql文件。导入数据库</p></li><li><p>GeoServer 访问 postgreSQL 数据库</p></li></ol><h3 id="使用-openlayer-访问wms服务"><a href="#使用-openlayer-访问wms服务" class="headerlink" title="使用 openlayer  访问wms服务"></a>使用 openlayer  访问wms服务</h3><p>下边的参数配置可以去图层预览页面，openlayer 预览页面可以查看请求信息找到下面的参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.<span class="property">layer</span>.<span class="title class_">Tile</span>(&#123;</span><br><span class="line">    <span class="attr">source</span>: <span class="keyword">new</span> ol.<span class="property">source</span>.<span class="title class_">TileWMS</span>(&#123;</span><br><span class="line">        <span class="attr">ratio</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;http://192.168.94.128:8080/geoserver/test/wms&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;FORMAT&#x27;</span>: <span class="string">&#x27;image/png8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;VERSION&#x27;</span>: <span class="string">&#x27;1.1.1&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;LAYERS&quot;</span>: <span class="string">&#x27;test:nyc_roads&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;exceptions&quot;</span>: <span class="string">&#x27;application/vnd.ogc.se_inimage&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;SRS&quot;</span>: <span class="string">&quot;EPSG:2908&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>重要的一点，要配置好正确的坐标系，不然显示不出来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">view</span>: <span class="keyword">new</span> ol.<span class="title class_">View</span>(&#123;</span><br><span class="line">    <span class="attr">center</span>: [<span class="number">984018.1663741902</span> , <span class="number">207673.09513056703</span>], <span class="comment">//地图初始中心点</span></span><br><span class="line">    <span class="attr">zoom</span>: <span class="number">7</span>,  <span class="comment">//地图初始显示级别</span></span><br><span class="line">    <span class="attr">projection</span>: <span class="keyword">new</span> ol.<span class="property">proj</span>.<span class="title class_">Projection</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;EPSG:2908&#x27;</span>,</span><br><span class="line">        <span class="attr">units</span>: <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">        <span class="attr">global</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><h3 id="使用geoserver生产wmts瓦片"><a href="#使用geoserver生产wmts瓦片" class="headerlink" title="使用geoserver生产wmts瓦片"></a>使用geoserver生产wmts瓦片</h3><ol><li><p>发布一个wms服务</p></li><li><p>在wms服务器基础上，生产wmts瓦片</p><p> 瓦片缓存地址可以在geoserver目录下的 web.xml 文件中修改</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>GEOSERVER_DATA_DIR<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>C:\eclipse\workspace\geoserver_trunk\cite\confCiteWFSPostGIS<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 瓦片生成可以在选择 切图策略，在 gridsets 中设置。添加策略需要在图层中的 瓦片策略中添加</p></li><li><p>发布wmts 服务</p></li></ol><h3 id="瓦片的迁移使用"><a href="#瓦片的迁移使用" class="headerlink" title="瓦片的迁移使用"></a>瓦片的迁移使用</h3><ol><li>在目标GIS服务器上发布wms服务，不生产瓦片。(或者发布空服务，只是为了构建bbox )</li><li>在其他GeoServer服务器上创建wms服务，生产wmts瓦片。</li><li>将所有其他GeoServer服务器上生产的wmts瓦片复制到目标GeoServer服务器对应服务瓦片目录下。</li></ol><h3 id="geoserver进行属性和几何要素的增删改查"><a href="#geoserver进行属性和几何要素的增删改查" class="headerlink" title="geoserver进行属性和几何要素的增删改查"></a><a href="https://zhuanlan.zhihu.com/p/381601300">geoserver进行属性和几何要素的增删改查</a></h3><blockquote><p>通过操作，影响图层数据</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;GeoServer 是一个优秀得开源的GIS服务器，它相较于商用的GIS软件 ArcGIS Server\SuperMap iServer 等服务器软件，它能实现大多数场景下项目对GIS的功能要求，而且有活跃的社区支持，在实际生产中也越来越受到开发者的青睐。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;GeoServer的诞生历史&quot;&gt;&lt;a href=&quot;#GeoServer的诞生历史&quot; class=&quot;headerlink&quot; title=&quot;GeoServer的诞生历史&quot;&gt;&lt;/a&gt;&lt;strong&gt;GeoServer的诞生历史&lt;/strong&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;GeoServer于2001年由总部位于纽约的非盈利技术孵化器open planning project (TOPP),启动TOPP正在创建一套工具，以实现开放民主，并帮助政府更加透明。第一个是GeoServer，这是因为人们认识到，共享空间数据的能力将(成为) 大大增强公民参与政府和城市规划的一套工具。&lt;/p&gt;
&lt;p&gt;GeoServer的创始人设想了一个类似于万维网的地理空间网。通过万维网，人们可以搜索和下载文本。通过地理空间网，人们可以搜索和下载空问数据。数据提供者将能够直接将他们的数据发布到这个网站上，用户可以直接访问它，而不是现在存在的间接和繁琐的数据共享方法。&lt;/p&gt;
&lt;p&gt;GeoServer的相关人员创建了&lt;strong&gt;GeoTools&lt;/strong&gt;项目，这是一个开源的GIS Java工具包。通过GeoTools，增加了对shapefile、Oracle数据库、ArcSDE集成等的支持&lt;/p&gt;
&lt;p&gt;其他项目变得相互关联。Refractions Research创建了一个免费开放的空间数据库&lt;strong&gt;PostGIS&lt;/strong&gt;，使GeoServer能够连接到一个免费的数据库。另外，MetaCarta最初创建了&lt;strong&gt;OpenLayers&lt;/strong&gt;.一个基于开源浏览器的地图查看工具。这些工具一起增强了GeoServer的功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这使得使用开源技术路线构建GIS工作流成为可能，数据可以从PostGIS流入GeoServer、再应用OpenLayers将GeoServer发布的地图服务在前端进行展现和互操作。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;WebGIS开发环境搭建&quot;&gt;&lt;a href=&quot;#WebGIS开发环境搭建&quot; class=&quot;headerlink&quot; title=&quot;WebGIS开发环境搭建&quot;&gt;&lt;/a&gt;WebGIS开发环境搭建&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://pan.baidu.com/s/19pQDJzOeI_-7VtA-JVtwHQ&quot;&gt;下载&lt;/a&gt;完成后可参考b站视频&lt;a href=&quot;https://www.bilibili.com/video/BV1vk4y127P8/?spm_id_from=333.337.search-card.all.click&amp;vd_source=727712d64f5d5487bf0a89c7b9de461d&quot;&gt;教程&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="WebGIS" scheme="https://wyf195075595.github.io/categories/WebGIS/"/>
    
    
    <category term="WebGIS" scheme="https://wyf195075595.github.io/tags/WebGIS/"/>
    
  </entry>
  
  <entry>
    <title>vue反编译</title>
    <link href="https://wyf195075595.github.io/2023/08/11/programming/vue/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    <id>https://wyf195075595.github.io/2023/08/11/programming/vue/%E5%8F%8D%E7%BC%96%E8%AF%91/</id>
    <published>2023-08-11T08:18:10.000Z</published>
    <updated>2023-08-12T02:05:28.638Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近遇到一个需求，将一个打包的vue项目反编译回源代码模式。以下就是探索过程</p></blockquote><h4 id="使用-vue反编译库-reverse-sourcemap"><a href="#使用-vue反编译库-reverse-sourcemap" class="headerlink" title="使用  vue反编译库 reverse-sourcemap"></a>使用  <strong>vue反编译库 reverse-sourcemap</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global reverse-sourcemap</span><br></pre></td></tr></table></figure><h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>将源码映射文件 xxx.js.map 编译到 src目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reverse-sourcemap --output-dir src xxx.js.map</span><br></pre></td></tr></table></figure><span id="more"></span><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230811163011325.png" alt="image-20230811163011325"></p><h4 id="1、执行反编译"><a href="#1、执行反编译" class="headerlink" title="1、执行反编译"></a>1、执行反编译</h4><blockquote><p>执行反编译的前提：打包文件有 映射的 map 文件</p></blockquote><p>如上面的打包文件有5个map文件 我们需要执行5次 命令，都解压到src文件夹，结果如下图所示：</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230811163434584.png" alt="image-20230811163434584"></p><p>此时反编译结果就出现了项目的目录及文件信息，展开的 src 目录就是我们需要的。（其中的public 是自己建的,不要管）</p><h4 id="2、获取package-json"><a href="#2、获取package-json" class="headerlink" title="2、获取package.json"></a>2、获取package.json</h4><p>此时我们需要反编译生成 package.json，到 node_modules 目录下，执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm shrinkwrap</span><br></pre></td></tr></table></figure><p>得到 npm-shrinkwrap.json 文件</p><p>这个json文件有所有依赖信息，但是没有版本（版本信息取node_modules 目录下查看依赖信息）。那我们怎么还原package.json 呢？</p><blockquote><p>我的办法是拉取一个完整vue-cli项目,或vite项目，看你反编译项目的的vue版本而定（2版本就vue-cli,3就vite）,然后把脚手架项目的package.json拿来，基础依赖就有了，只要把第三方的包添加进去就行了。</p></blockquote><h4 id="3、补全静态文件及相关文件"><a href="#3、补全静态文件及相关文件" class="headerlink" title="3、补全静态文件及相关文件"></a>3、补全静态文件及相关文件</h4><p>这就是为啥前面自建了 public 文件夹，里边就是 index.html(用脚手架里的，然后对照反编译的文件看要不要修改（一般不需要)，补全后大致如下</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230812095910538.png" alt="image-20230812095910538"></p><h4 id="4、最后"><a href="#4、最后" class="headerlink" title="4、最后"></a>4、最后</h4><p>就是执行脚手架运行命令如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn serve</span><br></pre></td></tr></table></figure><p>可能会出现依赖缺失，静态文件确实等问题，需要自己还原或配置 vue.config.js.项目越复杂配置问题越多。解决完后就大功告成</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/625650481?utm_id=0">参考链接</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近遇到一个需求，将一个打包的vue项目反编译回源代码模式。以下就是探索过程&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;使用-vue反编译库-reverse-sourcemap&quot;&gt;&lt;a href=&quot;#使用-vue反编译库-reverse-sourcemap&quot; class=&quot;headerlink&quot; title=&quot;使用  vue反编译库 reverse-sourcemap&quot;&gt;&lt;/a&gt;使用  &lt;strong&gt;vue反编译库 reverse-sourcemap&lt;/strong&gt;&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install --global reverse-sourcemap&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;使用方式&quot;&gt;&lt;a href=&quot;#使用方式&quot; class=&quot;headerlink&quot; title=&quot;使用方式&quot;&gt;&lt;/a&gt;使用方式&lt;/h4&gt;&lt;p&gt;将源码映射文件 xxx.js.map 编译到 src目录&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;reverse-sourcemap --output-dir src xxx.js.map&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="反编译" scheme="https://wyf195075595.github.io/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>mixin 实战</title>
    <link href="https://wyf195075595.github.io/2023/07/20/programming/vue/mixin/"/>
    <id>https://wyf195075595.github.io/2023/07/20/programming/vue/mixin/</id>
    <published>2023-07-20T00:23:10.000Z</published>
    <updated>2025-05-21T01:54:20.483Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一个简单的mixin 使用示例，用于管理 项目中的 字典，下拉数据. 下边代码仅为参考，主要思路就是 通过mixin 加载 字典存储到 store ，将 store 中字典 共享到data中</p></blockquote><h3 id="通用字典"><a href="#通用字典" class="headerlink" title="通用字典"></a>通用字典</h3><span id="more"></span><p>vuex 准备</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const state = <span class="punctuation">&#123;</span></span><br><span class="line">  dict<span class="punctuation">:</span> new Array()<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line">const mutations = <span class="punctuation">&#123;</span></span><br><span class="line">  SET_DICT<span class="punctuation">:</span> (state<span class="punctuation">,</span> <span class="punctuation">&#123;</span> key<span class="punctuation">,</span> value <span class="punctuation">&#125;</span>) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    if (key !== <span class="keyword">null</span> &amp;&amp; key !== <span class="string">&quot;&quot;</span>) <span class="punctuation">&#123;</span></span><br><span class="line">      state.dict.push(<span class="punctuation">&#123;</span></span><br><span class="line">        key<span class="punctuation">:</span> key<span class="punctuation">,</span></span><br><span class="line">        value<span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span>);</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  REMOVE_DICT<span class="punctuation">:</span> (state<span class="punctuation">,</span> key) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    try <span class="punctuation">&#123;</span></span><br><span class="line">      for (let i = <span class="number">0</span>; i &lt; state.dict.length; i++) <span class="punctuation">&#123;</span></span><br><span class="line">        if (state.dict<span class="punctuation">[</span>i<span class="punctuation">]</span>.key == key) <span class="punctuation">&#123;</span></span><br><span class="line">          state.dict.splice(i<span class="punctuation">,</span> i);</span><br><span class="line">          return <span class="keyword">true</span>;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span> catch (e) <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  CLEAN_DICT<span class="punctuation">:</span> (state) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    state.dict = new Array();</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line">const actions = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 设置字典</span></span><br><span class="line">  setDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span><span class="punctuation">,</span> data) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;SET_DICT&quot;</span><span class="punctuation">,</span> data);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 删除字典</span></span><br><span class="line">  removeDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span><span class="punctuation">,</span> key) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;REMOVE_DICT&quot;</span><span class="punctuation">,</span> key);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 清空字典</span></span><br><span class="line">  cleanDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span>) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;CLEAN_DICT&quot;</span>);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line">export default <span class="punctuation">&#123;</span></span><br><span class="line">  namespaced<span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  state<span class="punctuation">,</span></span><br><span class="line">  mutations<span class="punctuation">,</span></span><br><span class="line">  actions<span class="punctuation">,</span></span><br><span class="line">  getters<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    getDict(state) <span class="punctuation">&#123;</span></span><br><span class="line">        return state.dict;</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1、编写组件 dict.js </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> options = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="keyword">function</span> (<span class="params">Vue, options </span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(options) &#123;</span><br><span class="line">        options = options</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//全局注册组件 component-name</span></span><br><span class="line">    <span class="comment">// Vue.component(&#x27;component-name&#x27;,&#123;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">//添加实例方法 $Notice</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$Notice</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加全局方法或属性</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property">globalMethod</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加全局混合</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span> === <span class="literal">undefined</span> || <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> === <span class="literal">undefined</span> || <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> dict = <span class="keyword">new</span> <span class="title class_">Dict</span>()</span><br><span class="line">            dict.<span class="property">owner</span> = <span class="variable language_">this</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                dict</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="variable language_">this</span>.<span class="property">dict</span> <span class="keyword">instanceof</span> <span class="title class_">Dict</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">dict</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dict</span>.<span class="title function_">init</span>(<span class="variable language_">this</span> ,<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> , options).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classdesc</span> 字典</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Object</span>&#125; label 标签对象，内部属性名为字典类型名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Object</span>&#125; dict 字段数组，内部属性名为字典类型名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Array.&lt;DictMeta&gt;</span>&#125; _dictMetas 字典元数据数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dict</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 当前组件实例</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">owner</span> = <span class="literal">null</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * 用于将 code 回显成值</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         &#123;</span></span><br><span class="line"><span class="comment">            sys_normal_disable: &#123;</span></span><br><span class="line"><span class="comment">                0: &quot;正常&quot;,</span></span><br><span class="line"><span class="comment">                1: &quot;异常&quot;,</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         *  */</span> </span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">label</span> = &#123;&#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * DictData</span></span><br><span class="line"><span class="comment">         * 用于下拉框展示</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         &#123;</span></span><br><span class="line"><span class="comment">            sys_normal_disable: [</span></span><br><span class="line"><span class="comment">                &#123; labelName: &quot;异常&quot;, labelValue: 0&#125;</span></span><br><span class="line"><span class="comment">            ]</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         *  */</span> </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params">Vue ,dicts, options</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> rs = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> dictType <span class="keyword">of</span> dicts) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> d = <span class="keyword">await</span> options.<span class="title function_">request</span>(dictType);</span><br><span class="line">                rs.<span class="title function_">push</span>(d)</span><br><span class="line">                d.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title class_">Vue</span>.$set(<span class="title class_">Vue</span>.<span class="property">dict</span>.<span class="property">label</span>, [item.<span class="property">dictValue</span>], item.<span class="property">dictLabel</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// 将每一项字典添加到 Vue.dict 这个属性上</span></span><br><span class="line">                <span class="title class_">Vue</span>.$set(<span class="title class_">Vue</span>.<span class="property">dict</span>.<span class="property">type</span>, dictType, d)</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`load faild <span class="subst">$&#123;dictType&#125;</span>,`</span>,error);         </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(rs)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、dictData 组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">DataDict</span> <span class="keyword">from</span> <span class="string">&#x27;@/utils/dict&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getDicts <span class="keyword">as</span> getDicts &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">searchDictByKey</span>(<span class="params">dict, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key == <span class="literal">null</span> &amp;&amp; key == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dict.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dict[i].<span class="property">key</span> == key) &#123;</span><br><span class="line">        <span class="keyword">return</span> dict[i].<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">DataDict</span>, &#123;</span><br><span class="line">    <span class="attr">metas</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">labelField</span>: <span class="string">&#x27;dictLabel&#x27;</span>,</span><br><span class="line">        <span class="attr">valueField</span>: <span class="string">&#x27;dictValue&#x27;</span>,</span><br><span class="line">        <span class="title function_">request</span>(<span class="params">dictMeta</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> storeDict = <span class="title function_">searchDictByKey</span>(store.<span class="property">getters</span>.<span class="property">dict</span>, dictMeta.<span class="property">type</span>)</span><br><span class="line">          <span class="keyword">if</span> (storeDict) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="title function_">resolve</span>(storeDict) &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title function_">getDicts</span>(dictMeta.<span class="property">type</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                store.<span class="title function_">dispatch</span>(<span class="string">&#x27;dict/setDict&#x27;</span>, &#123; <span class="attr">key</span>: dictMeta.<span class="property">type</span>, <span class="attr">value</span>: res.<span class="property">data</span> &#125;)</span><br><span class="line">                <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">              &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(error)</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、main.js 注册 组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局组件挂载</span></span><br><span class="line"><span class="title class_">DictData</span>.<span class="title function_">install</span>()</span><br></pre></td></tr></table></figure><p>4、在页面使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">      &lt;el-select v-model=&quot;val&quot; placeholder=&quot;系统内置&quot; clearable&gt;</span><br><span class="line">          &lt;el-option</span><br><span class="line">              v-for=&quot;dict in dict.type.sys_yes_no&quot;</span><br><span class="line">              :key=&quot;dict.dictValue&quot;</span><br><span class="line">              :label=&quot;dict.dictLabel&quot;</span><br><span class="line">              :value=&quot;dict.dictValue&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  dicts: [&#x27;sys_normal_disable&#x27;,&#x27;sys_yes_no&#x27;],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      val: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(&quot;输出mixin 中的 dict&quot;, this.dict);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>dicts 在组件 dict 中 通过 $options 获取，然后在 created 函数中 初始化 对应的字典，然后在 mixin 中 暴露 dict 变量，存放字典数据</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;一个简单的mixin 使用示例，用于管理 项目中的 字典，下拉数据. 下边代码仅为参考，主要思路就是 通过mixin 加载 字典存储到 store ，将 store 中字典 共享到data中&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;通用字典&quot;&gt;&lt;a href=&quot;#通用字典&quot; class=&quot;headerlink&quot; title=&quot;通用字典&quot;&gt;&lt;/a&gt;通用字典&lt;/h3&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue-cli 实践与优化</title>
    <link href="https://wyf195075595.github.io/2023/06/15/programming/vue/vue-cli%E5%AE%9E%E8%B7%B5%E4%BC%98%E5%8C%96%E9%A1%B9/"/>
    <id>https://wyf195075595.github.io/2023/06/15/programming/vue/vue-cli%E5%AE%9E%E8%B7%B5%E4%BC%98%E5%8C%96%E9%A1%B9/</id>
    <published>2023-06-15T02:23:10.000Z</published>
    <updated>2024-12-19T03:34:25.928Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>收集一些常见的基于vue-cli的优化项</p><p>vue-cli 配置项结构</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&quot;@vue/cli-service&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><h3 id="设置全局样式"><a href="#设置全局样式" class="headerlink" title="设置全局样式"></a>设置全局样式</h3><span id="more"></span><p>依赖插件 style-resources-loader, vue-cli-plugin-style-resources-loader</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&quot;style-resources-loader&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&quot;less&quot;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src/styles/variable.less&quot;</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="css样式抽取"><a href="#css样式抽取" class="headerlink" title="css样式抽取"></a>css样式抽取</h3><blockquote><p>vue-cli5 默认配置 生产环境抽取组件的 style 样式为css文件放在 dist/css 文件夹中，还可以设置</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="comment">// 是否生成映射文件，方便调试</span></span><br><span class="line">    <span class="attr">sourceMap</span>: isProduction ? <span class="literal">false</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">extract</span>: &#123;</span><br><span class="line">      <span class="comment">// 输出的每个 CSS 文件的名称</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">      <span class="comment">// 非入口的 chunk 文件名称 </span></span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.thinbug.com/q/54267580">关于 chunkFilename</a>  作用：不在<code>output.entry</code>中的文件，但是需要单独打包的文件名配置。（<br>设置使用<code>require.ensure</code>或者<code>import</code>异步加载模块打包后的名称。）</p></blockquote><h3 id="js组件打包"><a href="#js组件打包" class="headerlink" title="js组件打包"></a>js组件打包</h3><blockquote><p>vue-cli5 默认组件打包后输出到 /dist/js下， 文件名格式 <code>文件夹名-文件名.hash值.后缀</code>, 也可以手动配置。</p><p>eg:defectControlConfiguration-consumptionUnit.2e496dd8.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、方式<span class="number">1</span></span><br><span class="line"><span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">config.<span class="property">output</span>.<span class="title function_">filename</span>(</span><br><span class="line">      <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">chunkFilename</span>(</span><br><span class="line">      <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、方式<span class="number">2</span></span><br><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">output</span>.<span class="property">filename</span> = <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span>;</span><br><span class="line">    config.<span class="property">output</span>.<span class="property">chunkFilename</span> = <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="资源压缩"><a href="#资源压缩" class="headerlink" title="资源压缩"></a>资源压缩</h3><p>对静态资源的压缩，一般只在生产模式下配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|jpeg|jpg|png|svg|gif|json|txt|ico)$/i</span>,</span><br><span class="line">      <span class="attr">threshold</span>: <span class="number">10240</span>, <span class="comment">// 单位字节 只有大小大于10k的资源会被处理</span></span><br><span class="line">      <span class="attr">minRatio</span>: <span class="number">0.8</span>, <span class="comment">// 只有压缩率小于这个值的资源才会被处理</span></span><br><span class="line">      <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span>, <span class="comment">// 删除原文件</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="开启gzip压缩"><a href="#开启gzip压缩" class="headerlink" title="开启gzip压缩"></a>开启gzip压缩</h3><p>vue.config.js</p><p>安装压缩插件，注意：不用安装太高版本，不用安装太高版本，不用安装太高版本，最新版本安装后打包回出错，我这是选择5.0.2。可能跟你项目的webpack版本有关吧</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="attr">--save-dev</span> compression-webpack-plugin<span class="keyword">@5</span>.0.2</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="title function_">chainWebpack</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 生产模式下启用gzip压缩 需要配置nginx支持gzip</span></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      config.<span class="title function_">plugin</span>(<span class="string">&#x27;CompressionWebpackPlugin&#x27;</span>).<span class="title function_">use</span>(<span class="title class_">CompressionWebpackPlugin</span>, [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;[path][base].gz&#x27;</span>,</span><br><span class="line">          <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">          <span class="attr">test</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\\.(js|css)$&#x27;</span>),</span><br><span class="line">          <span class="comment">// 只处理大于xx字节 的文件，默认：0</span></span><br><span class="line">          <span class="attr">threshold</span>: <span class="number">10240</span>,</span><br><span class="line">          <span class="comment">// 示例：一个1024b大小的文件，压缩后大小为768b，minRatio : 0.75</span></span><br><span class="line">          <span class="attr">minRatio</span>: <span class="number">0.8</span>, <span class="comment">// 默认: 0.8</span></span><br><span class="line">          <span class="comment">// 是否删除源文件，默认: false</span></span><br><span class="line">          <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginx 配置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_static</span> <span class="literal">on</span>;    </span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">    <span class="attribute">gzip_proxied</span>  any;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span> <span class="number">16</span> <span class="number">8k</span>;</span><br><span class="line">    </span><br><span class="line">    //找到nginx的这个文件 /usr/local/nginx/conf/nginx.<span class="attribute">conf</span> 然后配置</span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">4300</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span> /home/static/web/wechat;</span><br><span class="line">            <span class="attribute">index</span> /index.html;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">            <span class="attribute">gzip_static</span> <span class="literal">on</span>; <span class="comment">#开启压缩</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="公共代码抽离"><a href="#公共代码抽离" class="headerlink" title="公共代码抽离"></a>公共代码抽离</h3><p>将第三方模块,样式抽离成单个文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">optimization</span> = &#123;</span><br><span class="line">      <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">minSize</span>: <span class="number">1024</span> * <span class="number">5</span>,</span><br><span class="line">        <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;~&quot;</span>,</span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vuex</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vuex&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vuex[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;vue-router&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vue-router&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue-router[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;element-ui&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]element-ui[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">echarts</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;echarts&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]echarts[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">dayjs</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;dayjs&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]dayjs[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">jquery</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]jquery[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;chunk-vendors&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk-vendors&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">styles</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;styles&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(le|c)ss$/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">0</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码拆分功能</span></span><br><span class="line">config.<span class="property">optimization</span>.<span class="property">splitChunks</span> = &#123;</span><br><span class="line">  <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 表示选择哪些 chunks 进行分割，可选值有：async，initial和all</span></span><br><span class="line">  <span class="attr">maxInitialRequests</span>: <span class="number">10</span>, <span class="comment">// </span></span><br><span class="line">  <span class="attr">minSize</span>: <span class="number">30000</span>, <span class="comment">// 依赖包超过30KB将被单独打包</span></span><br><span class="line">  <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;-&quot;</span>,<span class="comment">// 抽取出来的文件的自动生成名字的分割符，默认为 ~；</span></span><br><span class="line">  <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">    <span class="attr">vendor</span>: &#123; <span class="comment">// vendors用于提取所有node_modules中符合条件的模块</span></span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">      <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> packageNames = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(</span><br><span class="line">          <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(packageNames) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">`chunk.<span class="subst">$&#123;packageNames[<span class="number">1</span>].replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">priority</span>: <span class="number">10</span> <span class="comment">// 当一个模块同时符合多个cacheGroups时，则根据其中的priority配置项确定优先级</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="性能提示优化"><a href="#性能提示优化" class="headerlink" title="性能提示优化"></a>性能提示优化</h3><p>但项目越来越大，资源越来越多时，打包可能会报错。此时可能需要调整性能提示。</p><blockquote><p>原因： node编译的<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA&spm=1001.2101.3001.7020">内存溢出</a>了。原因就是打包文件过大，超出了内存的限制大小造成了编译中断。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">performance</span> = &#123;</span><br><span class="line">      <span class="attr">hints</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      <span class="comment">// 入口起点的最大体积</span></span><br><span class="line">      <span class="attr">maxEntrypointSize</span>: <span class="number">30000000</span>,</span><br><span class="line">      <span class="comment">// 生成文件的最大体积</span></span><br><span class="line">      <span class="attr">maxAssetSize</span>: <span class="number">30000000</span>,</span><br><span class="line">      <span class="comment">// 只给出 js 文件的性能提示</span></span><br><span class="line">      <span class="attr">assetFilter</span>: <span class="keyword">function</span> (<span class="params">assetFilename</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> assetFilename.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;serve2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --max_old_space_size=4096 node_modules/@vue/cli-service/bin/vue-cli-service.js serve --open&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --max_old_space_size=4096 node_modules/@vue/cli-service/bin/vue-cli-service.js build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/Tiger_lin1/article/details/125634867">相关解决方法</a></p></blockquote><h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><blockquote><p>这样就优雅了不少</p></blockquote><p>普通懒加载，打包后名称</p><p>chunk_59de86678e4fdfa6_1.0.0_1686820955003.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;</span><br><span class="line">    <span class="attr">keepAlive</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&quot;opacity-scale&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="string">&quot;@/views/pmsLogin/index.vue&quot;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>升级版, 这种方式注册的路由打包后名称</p><p>pmsLogin_59de86678e4fdfa6_1.0.0_1686820955003.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;</span><br><span class="line">    <span class="attr">keepAlive</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&quot;opacity-scale&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;pmsLogin&quot; */</span> <span class="string">&quot;@/views/pmsLogin/index.vue&quot;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="懒加载动态路由打包时的问题"><a href="#懒加载动态路由打包时的问题" class="headerlink" title="懒加载动态路由打包时的问题"></a>懒加载动态路由打包时的问题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loadView</span> = (<span class="params">view</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>`</span>], resolve)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 import 实现生产环境的路由懒加载 </span></span><br><span class="line">    <span class="comment">// import(`/* webpackChunkName: &quot;$&#123;name&#125;&quot; */ @/views/$&#123;view&#125;.vue`), 这种写法不行</span></span><br><span class="line">    <span class="comment">// 从 webpack 2.6.0 开始，占位符 [index] 和 [request] 被支持为递增的数字或实际解析的文件名。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;[request]&quot; */</span> <span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>.vue`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用cdn加速"><a href="#使用cdn加速" class="headerlink" title="使用cdn加速"></a>使用cdn加速</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cdn = &#123;</span><br><span class="line">  <span class="attr">css</span>: [</span><br><span class="line">    <span class="comment">//雪碧图样式</span></span><br><span class="line">    <span class="string">&quot;https://**/**/icon.css&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">js</span>: [</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vue/3.2.33/vue.cjs.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vuex/4.0.2/vuex.cjs.min.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vue-router/4.0.14/vue-router.cjs.min.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/axios/0.26.1/axios.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/core-js/3.22.0/minified.js&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断是否是生产环境</span></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span></span><br><span class="line">cdn = isProd ? cdn : &#123;<span class="attr">css</span>:[],<span class="attr">js</span>:[]&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">configureWebpack</span>: &#123;</span><br><span class="line"> <span class="comment">// 采用cdn的方式,所以将以下这些文件配置不打包</span></span><br><span class="line">    <span class="attr">externals</span>:&#123;</span><br><span class="line">       <span class="attr">vue</span>:<span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">      <span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>,</span><br><span class="line">       <span class="attr">vuex</span>: <span class="string">&#x27;Vuex&#x27;</span>,</span><br><span class="line">       <span class="attr">axios</span>:<span class="string">&#x27;axios&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;core-js&#x27;</span>:<span class="string">&#x27;core-js&#x27;</span>,</span><br><span class="line">       <span class="attr">vant</span>:<span class="string">&#x27;vant&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">chainWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="comment">// 注入cdn</span></span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&quot;html&quot;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">cdn</span> = cdn</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>index.html 模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-Hans&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的CSS文件 --&gt;</span></span><br><span class="line">    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.css) &#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt; &quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but app doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的JS文件 --&gt;</span></span><br><span class="line">    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.js) &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;&quot;</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="查看性能分析报告"><a href="#查看性能分析报告" class="headerlink" title="查看性能分析报告"></a>查看性能分析报告</h3><p>通过查看性能分析报告确定哪些大模块使用cdn加速</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build --report --mode production&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="去除-console-log"><a href="#去除-console-log" class="headerlink" title="去除 console.log"></a>去除 console.log</h3><p>1、方式1</p><p>npm i terser-webpack-plugin -D</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"> <span class="attr">chainWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>)&#123;</span><br><span class="line">      <span class="comment">// 去除console.log输出</span></span><br><span class="line">      config.<span class="property">optimization</span></span><br><span class="line">      .<span class="title function_">minimizer</span>(<span class="string">&#x27;terser&#x27;</span>)</span><br><span class="line">      .<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(args[<span class="number">0</span>].<span class="property">terserOptions</span>.<span class="property">compress</span>, &#123; </span><br><span class="line">          <span class="comment">// 生产模式去除console.log</span></span><br><span class="line">          <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、方式2</p><p>安装  babel-plugin-transform-remove-console</p><p>.babel.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [];</span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">  plugins.<span class="title function_">push</span>([<span class="string">&quot;transform-remove-console&quot;</span>, &#123; <span class="attr">exclude</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;warn&quot;</span>] &#125;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">  <span class="attr">plugins</span>: plugins,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="浏览器js兼容性配置"><a href="#浏览器js兼容性配置" class="headerlink" title="浏览器js兼容性配置"></a>浏览器js兼容性配置</h3><ol><li><p>配置 <code>browserslist</code></p><p> <strong>在根目录创建 <code>.browserslistrc</code> 文件</strong> 或者在 <code>package.json</code> 中配置 <code>browserslist</code> 字段。</p> <figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># .browserslistrc</span><br><span class="line">&gt; 0.5%</span><br><span class="line">last 2 versions</span><br><span class="line">not dead</span><br></pre></td></tr></table></figure> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;browserslist&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;&gt; 0.5%&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;last 2 versions&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;not dead&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>启用自动 Polyfill</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="comment">// 默认情况下 babel-loader 会忽略所有 node_modules 中的文件。你可以启用本选项，以避免构建后的代码中出现未转译的第三方依赖。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不过，对所有的依赖都进行转译可能会降低构建速度。如果对构建性能有所顾虑，你可以只转译部分特定的依赖：给本选项传一个数组，列出需要转译的第三方包包名或正则表达式即可。</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: [<span class="string">&#x27;core-js&#x27;</span>, <span class="string">&#x27;regenerator-runtime&#x27;</span>], <span class="comment">// 确保这些库被正确转译</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>使用 Polyfill 方式</p><ul><li><code>useBuiltIns: &#39;usage&#39;</code>（按需按文件加载 polyfill）</li></ul><p> Babel 会根据每个文件中使用的 JavaScript 特性，自动选择需要 polyfill 的部分，避免将所有 polyfill 引入到每个文件中。此时不需要在入口文件中显式地引入 polyfill。此模式下main.js不需要引入东西</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>, <span class="comment">// (按需按文件加载 polyfill)</span></span><br><span class="line">        <span class="attr">corejs</span>: <span class="number">3</span>,          <span class="comment">// 使用 core-js 版本 3</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>useBuiltIns: &#39;entry&#39;</code></li></ul><p> Vue CLI 会根据 <code>browserslist</code> 自动引入所需的 polyfill，并且你需要在项目的入口文件（如 <code>src/main.js</code>）中手动引入 <code>core-js</code>：</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/stable&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;regenerator-runtime/runtime&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>配置 Vue CLI 来启用自动 Polyfill</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: [<span class="string">&#x27;core-js&#x27;</span>, <span class="string">&#x27;regenerator-runtime&#x27;</span>], <span class="comment">// 确保这些库被正确转译</span></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;js&#x27;</span>)</span><br><span class="line">      .<span class="title function_">test</span>(<span class="regexp">/\.js$/</span>)</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;babel-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;babel-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">options</span>(&#123;</span><br><span class="line">        <span class="attr">presets</span>: [</span><br><span class="line">          [</span><br><span class="line">            <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">useBuiltIns</span>: <span class="string">&#x27;entry&#x27;</span>, <span class="comment">// 按需加载 polyfills</span></span><br><span class="line">              <span class="attr">corejs</span>: <span class="number">3</span>,             <span class="comment">// 使用 core-js 版本 3</span></span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        ],</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="浏览器-css-兼容性配置"><a href="#浏览器-css-兼容性配置" class="headerlink" title="浏览器 css 兼容性配置"></a>浏览器 css 兼容性配置</h3></li></ol><p>Vue CLI 支持通过 <strong>postcss.config.js</strong> 来配置 <strong>PostCSS</strong> 插件或<strong>package.json</strong>。你可以在项目根目录创建 <code>postcss.config.js</code> 文件，或者修改该文件以确保样式兼容。</p><p>3选1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: &#123;</span><br><span class="line">    <span class="attr">autoprefixer</span>: &#123;</span><br><span class="line">      <span class="attr">overrideBrowserslist</span>: [</span><br><span class="line">        <span class="string">&#x27;last 2 versions&#x27;</span>, <span class="comment">// 支持最新两个版本的浏览器</span></span><br><span class="line">        <span class="string">&#x27;IE 10&#x27;</span>,           <span class="comment">// 支持 IE10 及以上版本</span></span><br><span class="line">        <span class="string">&#x27;Safari &gt;= 9&#x27;</span>,      <span class="comment">// 支持 Safari 9 及以上版本</span></span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">loaderOptions</span>: &#123;</span><br><span class="line">      <span class="attr">postcss</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [</span><br><span class="line">          <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)(&#123;</span><br><span class="line">            <span class="attr">overrideBrowserslist</span>: [</span><br><span class="line">              <span class="string">&#x27;last 2 versions&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;IE 10&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;Safari &gt;= 9&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">          &#125;),</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>package.json 中配置browserslist后会自动触发 css后缀样式添加，如果配置了 js垫片添加，css可以不用配置了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;last 2 versions&quot;</span>,</span><br><span class="line">  <span class="string">&quot;&gt; 1%&quot;</span>,</span><br><span class="line">  <span class="string">&quot;not dead&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="webpack-chain-语法"><a href="#webpack-chain-语法" class="headerlink" title="webpack-chain 语法"></a>webpack-chain 语法</h3><blockquote><p><a href="https://blog.51cto.com/feng/5289791">参考链接</a></p></blockquote><h3 id="完整示例参考"><a href="#完整示例参考" class="headerlink" title="完整示例参考"></a>完整示例参考</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 打包配置</span></span><br><span class="line"><span class="comment"> * @Author:  wyf</span></span><br><span class="line"><span class="comment"> * @Date: 2023-07-03 08:48:44</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2023-08-29 11:01:04</span></span><br><span class="line"><span class="comment"> * @LastEditors:  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; type &#125; = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>);</span><br><span class="line"><span class="comment">// 是否为生产环境</span></span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="comment">// 时间戳</span></span><br><span class="line"><span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// const &#123; config &#125; = require(&#x27;process&#x27;);</span></span><br><span class="line"><span class="comment">// console.log(&quot;process.config&quot;, config);</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">publicPath</span>: isProduction ? <span class="string">&quot;/&quot;</span> : <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment">// target: &quot;http://192.18.1.12:8080/&quot;, // 我们要代理的真实接口地址</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://60.173.195.163:18000/&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">performance</span> = &#123;</span><br><span class="line">      <span class="attr">hints</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      <span class="comment">// 入口起点的最大体积</span></span><br><span class="line">      <span class="attr">maxEntrypointSize</span>: <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 生成文件的最大体积</span></span><br><span class="line">      <span class="attr">maxAssetSize</span>: <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 只给出 js 文件的性能提示</span></span><br><span class="line">      <span class="attr">assetFilter</span>: <span class="keyword">function</span> (<span class="params">assetFilename</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> assetFilename.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;preload&#x27;</span>) <span class="comment">// <span class="doctag">TODO:</span> need test</span></span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;prefetch&#x27;</span>) <span class="comment">// <span class="doctag">TODO:</span> need test</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isProduction)&#123;</span><br><span class="line">      <span class="comment">// 去除console.log输出</span></span><br><span class="line">      config.<span class="property">optimization</span></span><br><span class="line">      .<span class="title function_">minimizer</span>(<span class="string">&#x27;terser&#x27;</span>)</span><br><span class="line">      .<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(args[<span class="number">0</span>].<span class="property">terserOptions</span>.<span class="property">compress</span>, &#123; </span><br><span class="line">          <span class="comment">// 生产模式去除console.log</span></span><br><span class="line">          <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// set svg-sprite-loader</span></span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">      .<span class="property">exclude</span>.<span class="title function_">add</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icons&#x27;</span>))</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;icons&#x27;</span>)</span><br><span class="line">      .<span class="title function_">test</span>(<span class="regexp">/\.svg$/</span>)</span><br><span class="line">      .<span class="property">include</span>.<span class="title function_">add</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icons&#x27;</span>))</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">options</span>(&#123;</span><br><span class="line">        <span class="attr">symbolId</span>: <span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line"></span><br><span class="line">    config.<span class="property">optimization</span>.<span class="title function_">splitChunks</span>(&#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 表示选择哪些 chunks 进行分割，可选值有：async，initial和all</span></span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="number">10</span>, <span class="comment">// </span></span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">30000</span>, <span class="comment">// 依赖包超过30KB将被单独打包</span></span><br><span class="line">      <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;-&quot;</span>,<span class="comment">// 抽取出来的文件的自动生成名字的分割符，默认为 ~；</span></span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">vendor</span>: &#123; <span class="comment">// vendors用于提取所有node_modules中符合条件的模块</span></span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> packageNames = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(</span><br><span class="line">              <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span>(packageNames) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">`chunk.<span class="subst">$&#123;packageNames[<span class="number">1</span>].replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">priority</span>: <span class="number">10</span> <span class="comment">// 当一个模块同时符合多个cacheGroups时，则根据其中的priority配置项确定优先级</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    config.<span class="property">output</span></span><br><span class="line">      .<span class="title function_">filename</span>(</span><br><span class="line">        <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">chunkFilename</span>(</span><br><span class="line">        <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">      );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 系统名称</span></span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">title</span> = <span class="string">&quot;智慧营业厅管理平台&quot;</span></span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">sourceMap</span>: isProduction ? <span class="literal">false</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">extract</span>: &#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&quot;style-resources-loader&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&quot;less&quot;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src/styles/variable.less&quot;</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;收集一些常见的基于vue-cli的优化项&lt;/p&gt;
&lt;p&gt;vue-cli 配置项结构&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123; defineConfig &amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;@vue/cli-service&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;exports&lt;/span&gt; = &lt;span class=&quot;title function_&quot;&gt;defineConfig&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;/blockquote&gt;
&lt;h3 id=&quot;设置全局样式&quot;&gt;&lt;a href=&quot;#设置全局样式&quot; class=&quot;headerlink&quot; title=&quot;设置全局样式&quot;&gt;&lt;/a&gt;设置全局样式&lt;/h3&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="vue-cli" scheme="https://wyf195075595.github.io/tags/vue-cli/"/>
    
  </entry>
  
</feed>
