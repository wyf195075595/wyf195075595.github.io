<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>myBlog</title>
  
  <subtitle>前端小趴菜</subtitle>
  <link href="https://wyf195075595.github.io/atom.xml" rel="self"/>
  
  <link href="https://wyf195075595.github.io/"/>
  <updated>2023-08-12T02:05:28.638Z</updated>
  <id>https://wyf195075595.github.io/</id>
  
  <author>
    <name>王不留行</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vue反编译</title>
    <link href="https://wyf195075595.github.io/2023/08/11/programming/vue/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    <id>https://wyf195075595.github.io/2023/08/11/programming/vue/%E5%8F%8D%E7%BC%96%E8%AF%91/</id>
    <published>2023-08-11T08:18:10.000Z</published>
    <updated>2023-08-12T02:05:28.638Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近遇到一个需求，将一个打包的vue项目反编译回源代码模式。以下就是探索过程</p></blockquote><h4 id="使用-vue反编译库-reverse-sourcemap"><a href="#使用-vue反编译库-reverse-sourcemap" class="headerlink" title="使用  vue反编译库 reverse-sourcemap"></a>使用  <strong>vue反编译库 reverse-sourcemap</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global reverse-sourcemap</span><br></pre></td></tr></table></figure><h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>将源码映射文件 xxx.js.map 编译到 src目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reverse-sourcemap --output-dir src xxx.js.map</span><br></pre></td></tr></table></figure><span id="more"></span><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230811163011325.png" alt="image-20230811163011325"></p><h4 id="1、执行反编译"><a href="#1、执行反编译" class="headerlink" title="1、执行反编译"></a>1、执行反编译</h4><blockquote><p>执行反编译的前提：打包文件有 映射的 map 文件</p></blockquote><p>如上面的打包文件有5个map文件 我们需要执行5次 命令，都解压到src文件夹，结果如下图所示：</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230811163434584.png" alt="image-20230811163434584"></p><p>此时反编译结果就出现了项目的目录及文件信息，展开的 src 目录就是我们需要的。（其中的public 是自己建的,不要管）</p><h4 id="2、获取package-json"><a href="#2、获取package-json" class="headerlink" title="2、获取package.json"></a>2、获取package.json</h4><p>此时我们需要反编译生成 package.json，到 node_modules 目录下，执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm shrinkwrap</span><br></pre></td></tr></table></figure><p>得到 npm-shrinkwrap.json 文件</p><p>这个json文件有所有依赖信息，但是没有版本（版本信息取node_modules 目录下查看依赖信息）。那我们怎么还原package.json 呢？</p><blockquote><p>我的办法是拉取一个完整vue-cli项目,或vite项目，看你反编译项目的的vue版本而定（2版本就vue-cli,3就vite）,然后把脚手架项目的package.json拿来，基础依赖就有了，只要把第三方的包添加进去就行了。</p></blockquote><h4 id="3、补全静态文件及相关文件"><a href="#3、补全静态文件及相关文件" class="headerlink" title="3、补全静态文件及相关文件"></a>3、补全静态文件及相关文件</h4><p>这就是为啥前面自建了 public 文件夹，里边就是 index.html(用脚手架里的，然后对照反编译的文件看要不要修改（一般不需要)，补全后大致如下</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230812095910538.png" alt="image-20230812095910538"></p><h4 id="4、最后"><a href="#4、最后" class="headerlink" title="4、最后"></a>4、最后</h4><p>就是执行脚手架运行命令如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn serve</span><br></pre></td></tr></table></figure><p>可能会出现依赖缺失，静态文件确实等问题，需要自己还原或配置 vue.config.js.项目越复杂配置问题越多。解决完后就大功告成</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/625650481?utm_id=0">参考链接</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近遇到一个需求，将一个打包的vue项目反编译回源代码模式。以下就是探索过程&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;使用-vue反编译库-reverse-sourcemap&quot;&gt;&lt;a href=&quot;#使用-vue反编译库-reverse-sourcemap&quot; class=&quot;headerlink&quot; title=&quot;使用  vue反编译库 reverse-sourcemap&quot;&gt;&lt;/a&gt;使用  &lt;strong&gt;vue反编译库 reverse-sourcemap&lt;/strong&gt;&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install --global reverse-sourcemap&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;使用方式&quot;&gt;&lt;a href=&quot;#使用方式&quot; class=&quot;headerlink&quot; title=&quot;使用方式&quot;&gt;&lt;/a&gt;使用方式&lt;/h4&gt;&lt;p&gt;将源码映射文件 xxx.js.map 编译到 src目录&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;reverse-sourcemap --output-dir src xxx.js.map&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="反编译" scheme="https://wyf195075595.github.io/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>mixin 实战</title>
    <link href="https://wyf195075595.github.io/2023/07/20/programming/vue/mixin/"/>
    <id>https://wyf195075595.github.io/2023/07/20/programming/vue/mixin/</id>
    <published>2023-07-20T00:23:10.000Z</published>
    <updated>2023-07-20T01:09:39.323Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>一个简单的mixin 使用示例，用于管理 项目中的 字典，下拉数据</p></blockquote><h3 id="通用字典"><a href="#通用字典" class="headerlink" title="通用字典"></a>通用字典</h3><span id="more"></span><p>vuex 准备</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">const state = <span class="punctuation">&#123;</span></span><br><span class="line">  dict<span class="punctuation">:</span> new Array()<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line">const mutations = <span class="punctuation">&#123;</span></span><br><span class="line">  SET_DICT<span class="punctuation">:</span> (state<span class="punctuation">,</span> <span class="punctuation">&#123;</span> key<span class="punctuation">,</span> value <span class="punctuation">&#125;</span>) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    if (key !== <span class="keyword">null</span> &amp;&amp; key !== <span class="string">&quot;&quot;</span>) <span class="punctuation">&#123;</span></span><br><span class="line">      state.dict.push(<span class="punctuation">&#123;</span></span><br><span class="line">        key<span class="punctuation">:</span> key<span class="punctuation">,</span></span><br><span class="line">        value<span class="punctuation">:</span> value<span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span>);</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  REMOVE_DICT<span class="punctuation">:</span> (state<span class="punctuation">,</span> key) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    try <span class="punctuation">&#123;</span></span><br><span class="line">      for (let i = <span class="number">0</span>; i &lt; state.dict.length; i++) <span class="punctuation">&#123;</span></span><br><span class="line">        if (state.dict<span class="punctuation">[</span>i<span class="punctuation">]</span>.key == key) <span class="punctuation">&#123;</span></span><br><span class="line">          state.dict.splice(i<span class="punctuation">,</span> i);</span><br><span class="line">          return <span class="keyword">true</span>;</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span> catch (e) <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  CLEAN_DICT<span class="punctuation">:</span> (state) =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    state.dict = new Array();</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line">const actions = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 设置字典</span></span><br><span class="line">  setDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span><span class="punctuation">,</span> data) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;SET_DICT&quot;</span><span class="punctuation">,</span> data);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 删除字典</span></span><br><span class="line">  removeDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span><span class="punctuation">,</span> key) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;REMOVE_DICT&quot;</span><span class="punctuation">,</span> key);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 清空字典</span></span><br><span class="line">  cleanDict(<span class="punctuation">&#123;</span> commit <span class="punctuation">&#125;</span>) <span class="punctuation">&#123;</span></span><br><span class="line">    commit(<span class="string">&quot;CLEAN_DICT&quot;</span>);</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line">export default <span class="punctuation">&#123;</span></span><br><span class="line">  namespaced<span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  state<span class="punctuation">,</span></span><br><span class="line">  mutations<span class="punctuation">,</span></span><br><span class="line">  actions<span class="punctuation">,</span></span><br><span class="line">  getters<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    getDict(state) <span class="punctuation">&#123;</span></span><br><span class="line">        return state.dict;</span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1、编写组件 dict.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> options = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="keyword">function</span> (<span class="params">Vue, options </span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(options) &#123;</span><br><span class="line">        options = options</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//全局注册组件 component-name</span></span><br><span class="line">    <span class="comment">// Vue.component(&#x27;component-name&#x27;,&#123;</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">//添加实例方法 $Notice</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$Notice</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加全局方法或属性</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property">globalMethod</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加全局混合</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$options</span> === <span class="literal">undefined</span> || <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> === <span class="literal">undefined</span> || <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> dict = <span class="keyword">new</span> <span class="title class_">Dict</span>()</span><br><span class="line">            dict.<span class="property">owner</span> = <span class="variable language_">this</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                dict</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="variable language_">this</span>.<span class="property">dict</span> <span class="keyword">instanceof</span> <span class="title class_">Dict</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">dict</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dict</span>.<span class="title function_">init</span>(<span class="variable language_">this</span> ,<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">dicts</span> , options).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classdesc</span> 字典</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Object</span>&#125; label 标签对象，内部属性名为字典类型名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Object</span>&#125; dict 字段数组，内部属性名为字典类型名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Array.&lt;DictMeta&gt;</span>&#125; _dictMetas 字典元数据数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dict</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 当前组件实例</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">owner</span> = <span class="literal">null</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * 用于将 code 回显成值</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         &#123;</span></span><br><span class="line"><span class="comment">            sys_normal_disable: &#123;</span></span><br><span class="line"><span class="comment">                0: &quot;正常&quot;,</span></span><br><span class="line"><span class="comment">                1: &quot;异常&quot;,</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         *  */</span> </span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">label</span> = &#123;&#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * DictData</span></span><br><span class="line"><span class="comment">         * 用于下拉框展示</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         &#123;</span></span><br><span class="line"><span class="comment">            sys_normal_disable: [</span></span><br><span class="line"><span class="comment">                &#123; labelName: &quot;异常&quot;, labelValue: 0&#125;</span></span><br><span class="line"><span class="comment">            ]</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         *  */</span> </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params">Vue ,dicts, options</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> rs = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> dictType <span class="keyword">of</span> dicts) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> d = <span class="keyword">await</span> options.<span class="title function_">request</span>(dictType);</span><br><span class="line">                rs.<span class="title function_">push</span>(d)</span><br><span class="line">                d.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title class_">Vue</span>.$set(<span class="title class_">Vue</span>.<span class="property">dict</span>.<span class="property">label</span>, [item.<span class="property">dictValue</span>], item.<span class="property">dictLabel</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="title class_">Vue</span>.$set(<span class="title class_">Vue</span>.<span class="property">dict</span>.<span class="property">type</span>, dictType, d)</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`load faild <span class="subst">$&#123;dictType&#125;</span>,`</span>,error);         </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(rs)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、main.js 注册 组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 store 中查询此字典是否已加载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">searchDictByKey</span>(<span class="params">dict, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key == <span class="literal">null</span> &amp;&amp; key == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dict.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dict[i].<span class="property">key</span> == key) &#123;</span><br><span class="line">        <span class="keyword">return</span> dict[i].<span class="property">value</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(dict, &#123;</span><br><span class="line">  <span class="attr">labelField</span>: <span class="string">&#x27;dictLabel&#x27;</span>,</span><br><span class="line">  <span class="attr">valueField</span>: <span class="string">&#x27;dictValue&#x27;</span>,</span><br><span class="line">  <span class="title function_">request</span>(<span class="params">dictType</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> storeDict = <span class="title function_">searchDictByKey</span>(store.<span class="property">getters</span>[<span class="string">&quot;dictModule/getDict&quot;</span>], dictType)</span><br><span class="line">    <span class="keyword">if</span> (storeDict) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="title function_">resolve</span>(storeDict) &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fetch</span>(<span class="string">`http://localhost:8081/api/system/dict/data/type/<span class="subst">$&#123;dictType&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">headers</span>: &#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">`Bearer eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VyX2tleSI6IjFhZWNjYmM2LTJmNDItNDMyNS05ZTkxLTViNGEyZTc1MmUxMCIsInVzZXJuYW1lIjoiYWRtaW4ifQ.c8w0X5ydwbxBFANwfykVC3WjDS-0X6LCBXd_5nnc05I25YLxmkIyRRsR9fAaitkuNYqUHkcQXca99ZWbNxPKyw`</span>&#125;</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span> res.<span class="title function_">json</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;dictModule/setDict&#x27;</span>, &#123; <span class="attr">key</span>: dictType, <span class="attr">value</span>: res.<span class="property">data</span> &#125;)</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>)</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>3、在页面使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">      &lt;el-select v-model=&quot;val&quot; placeholder=&quot;系统内置&quot; clearable&gt;</span><br><span class="line">          &lt;el-option</span><br><span class="line">              v-for=&quot;dict in dict.type.sys_yes_no&quot;</span><br><span class="line">              :key=&quot;dict.dictValue&quot;</span><br><span class="line">              :label=&quot;dict.dictLabel&quot;</span><br><span class="line">              :value=&quot;dict.dictValue&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;HomeView&#x27;,</span><br><span class="line">  dicts: [&#x27;sys_normal_disable&#x27;,&#x27;sys_yes_no&#x27;],</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      val: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    console.log(&quot;输出mixin 中的 dict&quot;, this.dict);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>dicts 在组件 dict 中 通过 $options 获取，然后在 created 函数中 初始化 对应的字典，然后在 mixin 中 暴露 dict 变量，存放字典数据</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;一个简单的mixin 使用示例，用于管理 项目中的 字典，下拉数据&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;通用字典&quot;&gt;&lt;a href=&quot;#通用字典&quot; class=&quot;headerlink&quot; title=&quot;通用字典&quot;&gt;&lt;/a&gt;通用字典&lt;/h3&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue-cli 实践与优化</title>
    <link href="https://wyf195075595.github.io/2023/06/15/programming/vue/vue-cli%E5%AE%9E%E8%B7%B5%E4%BC%98%E5%8C%96%E9%A1%B9/"/>
    <id>https://wyf195075595.github.io/2023/06/15/programming/vue/vue-cli%E5%AE%9E%E8%B7%B5%E4%BC%98%E5%8C%96%E9%A1%B9/</id>
    <published>2023-06-15T02:23:10.000Z</published>
    <updated>2023-09-05T01:35:40.520Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>收集一些常见的基于vue-cli的优化项</p><p>vue-cli 配置项结构</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&quot;@vue/cli-service&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><h3 id="设置全局样式"><a href="#设置全局样式" class="headerlink" title="设置全局样式"></a>设置全局样式</h3><span id="more"></span><p>依赖插件 style-resources-loader, vue-cli-plugin-style-resources-loader</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&quot;style-resources-loader&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&quot;less&quot;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src/styles/variable.less&quot;</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="css样式抽取"><a href="#css样式抽取" class="headerlink" title="css样式抽取"></a>css样式抽取</h3><blockquote><p>vue-cli5 默认配置 生产环境抽取组件的 style 样式为css文件放在 dist/css 文件夹中，还可以设置</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="comment">// 是否生成映射文件，方便调试</span></span><br><span class="line">    <span class="attr">sourceMap</span>: isProduction ? <span class="literal">false</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">extract</span>: &#123;</span><br><span class="line">      <span class="comment">// 输出的每个 CSS 文件的名称</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">      <span class="comment">// 非入口的 chunk 文件名称 </span></span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.thinbug.com/q/54267580">关于 chunkFilename</a>  作用：不在<code>output.entry</code>中的文件，但是需要单独打包的文件名配置。（<br>设置使用<code>require.ensure</code>或者<code>import</code>异步加载模块打包后的名称。）</p></blockquote><h3 id="js组件打包"><a href="#js组件打包" class="headerlink" title="js组件打包"></a>js组件打包</h3><blockquote><p>vue-cli5 默认组件打包后输出到 /dist/js下， 文件名格式 <code>文件夹名-文件名.hash值.后缀</code>, 也可以手动配置。</p><p>eg:defectControlConfiguration-consumptionUnit.2e496dd8.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、方式<span class="number">1</span></span><br><span class="line"><span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">config.<span class="property">output</span>.<span class="title function_">filename</span>(</span><br><span class="line">      <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">chunkFilename</span>(</span><br><span class="line">      <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、方式<span class="number">2</span></span><br><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">output</span>.<span class="property">filename</span> = <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span>;</span><br><span class="line">    config.<span class="property">output</span>.<span class="property">chunkFilename</span> = <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="资源压缩"><a href="#资源压缩" class="headerlink" title="资源压缩"></a>资源压缩</h3><p>对静态资源的压缩，一般只在生产模式下配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CompressionPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(js|css|jpeg|jpg|png|svg|gif|json|txt|ico)$/i</span>,</span><br><span class="line">      <span class="attr">threshold</span>: <span class="number">10240</span>, <span class="comment">// 单位字节 只有大小大于10k的资源会被处理</span></span><br><span class="line">      <span class="attr">minRatio</span>: <span class="number">0.8</span>, <span class="comment">// 只有压缩率小于这个值的资源才会被处理</span></span><br><span class="line">      <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span>, <span class="comment">// 删除原文件</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="开启gzip压缩"><a href="#开启gzip压缩" class="headerlink" title="开启gzip压缩"></a>开启gzip压缩</h3><p>vue.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;compression-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="title function_">chainWebpack</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 生产模式下启用gzip压缩 需要配置nginx支持gzip</span></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      config.<span class="title function_">plugin</span>(<span class="string">&#x27;CompressionWebpackPlugin&#x27;</span>).<span class="title function_">use</span>(<span class="title class_">CompressionWebpackPlugin</span>, [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&#x27;[path][base].gz&#x27;</span>,</span><br><span class="line">          <span class="attr">algorithm</span>: <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">          <span class="attr">test</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\\.(js|css)$&#x27;</span>),</span><br><span class="line">          <span class="comment">// 只处理大于xx字节 的文件，默认：0</span></span><br><span class="line">          <span class="attr">threshold</span>: <span class="number">10240</span>,</span><br><span class="line">          <span class="comment">// 示例：一个1024b大小的文件，压缩后大小为768b，minRatio : 0.75</span></span><br><span class="line">          <span class="attr">minRatio</span>: <span class="number">0.8</span>, <span class="comment">// 默认: 0.8</span></span><br><span class="line">          <span class="comment">// 是否删除源文件，默认: false</span></span><br><span class="line">          <span class="attr">deleteOriginalAssets</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nginx 配置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_static</span> <span class="literal">on</span>;    </span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">    <span class="attribute">gzip_proxied</span>  any;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span> <span class="number">16</span> <span class="number">8k</span>;</span><br><span class="line">    </span><br><span class="line">    //找到nginx的这个文件 /usr/local/nginx/conf/nginx.<span class="attribute">conf</span> 然后配置</span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">4300</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span> /home/static/web/wechat;</span><br><span class="line">            <span class="attribute">index</span> /index.html;</span><br><span class="line">            <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">            <span class="attribute">gzip_static</span> <span class="literal">on</span>; <span class="comment">#开启压缩</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="公共代码抽离"><a href="#公共代码抽离" class="headerlink" title="公共代码抽离"></a>公共代码抽离</h3><p>将第三方模块,样式抽离成单个文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">optimization</span> = &#123;</span><br><span class="line">      <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">minSize</span>: <span class="number">1024</span> * <span class="number">5</span>,</span><br><span class="line">        <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;~&quot;</span>,</span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vuex</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vuex&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vuex[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;vue-router&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;vue-router&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue-router[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;element-ui&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]element-ui[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">echarts</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;echarts&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]echarts[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">dayjs</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;dayjs&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]dayjs[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">jquery</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]jquery[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;chunk-vendors&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk-vendors&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">styles</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;styles&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(le|c)ss$/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">0</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码拆分功能</span></span><br><span class="line">config.<span class="property">optimization</span>.<span class="property">splitChunks</span> = &#123;</span><br><span class="line">  <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 表示选择哪些 chunks 进行分割，可选值有：async，initial和all</span></span><br><span class="line">  <span class="attr">maxInitialRequests</span>: <span class="number">10</span>, <span class="comment">// </span></span><br><span class="line">  <span class="attr">minSize</span>: <span class="number">30000</span>, <span class="comment">// 依赖包超过30KB将被单独打包</span></span><br><span class="line">  <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;-&quot;</span>,<span class="comment">// 抽取出来的文件的自动生成名字的分割符，默认为 ~；</span></span><br><span class="line">  <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">    <span class="attr">vendor</span>: &#123; <span class="comment">// vendors用于提取所有node_modules中符合条件的模块</span></span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">      <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> packageNames = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(</span><br><span class="line">          <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(packageNames) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">`chunk.<span class="subst">$&#123;packageNames[<span class="number">1</span>].replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">priority</span>: <span class="number">10</span> <span class="comment">// 当一个模块同时符合多个cacheGroups时，则根据其中的priority配置项确定优先级</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="性能提示优化"><a href="#性能提示优化" class="headerlink" title="性能提示优化"></a>性能提示优化</h3><p>但项目越来越大，资源越来越多时，打包可能会报错。此时可能需要调整性能提示。</p><blockquote><p>原因： node编译的<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA&spm=1001.2101.3001.7020">内存溢出</a>了。原因就是打包文件过大，超出了内存的限制大小造成了编译中断。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">performance</span> = &#123;</span><br><span class="line">      <span class="attr">hints</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      <span class="comment">// 入口起点的最大体积</span></span><br><span class="line">      <span class="attr">maxEntrypointSize</span>: <span class="number">30000000</span>,</span><br><span class="line">      <span class="comment">// 生成文件的最大体积</span></span><br><span class="line">      <span class="attr">maxAssetSize</span>: <span class="number">30000000</span>,</span><br><span class="line">      <span class="comment">// 只给出 js 文件的性能提示</span></span><br><span class="line">      <span class="attr">assetFilter</span>: <span class="keyword">function</span> (<span class="params">assetFilename</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> assetFilename.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;serve2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --max_old_space_size=4096 node_modules/@vue/cli-service/bin/vue-cli-service.js serve --open&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --max_old_space_size=4096 node_modules/@vue/cli-service/bin/vue-cli-service.js build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/Tiger_lin1/article/details/125634867">相关解决方法</a></p></blockquote><h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><blockquote><p>这样就优雅了不少</p></blockquote><p>普通懒加载，打包后名称</p><p>chunk_59de86678e4fdfa6_1.0.0_1686820955003.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;</span><br><span class="line">    <span class="attr">keepAlive</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&quot;opacity-scale&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="string">&quot;@/views/pmsLogin/index.vue&quot;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>升级版, 这种方式注册的路由打包后名称</p><p>pmsLogin_59de86678e4fdfa6_1.0.0_1686820955003.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;/pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;pmsLogin&quot;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;</span><br><span class="line">    <span class="attr">keepAlive</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">transitionName</span>: <span class="string">&quot;opacity-scale&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;pmsLogin&quot; */</span> <span class="string">&quot;@/views/pmsLogin/index.vue&quot;</span>),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="懒加载动态路由打包时的问题"><a href="#懒加载动态路由打包时的问题" class="headerlink" title="懒加载动态路由打包时的问题"></a>懒加载动态路由打包时的问题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loadView</span> = (<span class="params">view</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">require</span>([<span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>`</span>], resolve)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 import 实现生产环境的路由懒加载 </span></span><br><span class="line">    <span class="comment">// import(`/* webpackChunkName: &quot;$&#123;name&#125;&quot; */ @/views/$&#123;view&#125;.vue`), 这种写法不行</span></span><br><span class="line">    <span class="comment">// 从 webpack 2.6.0 开始，占位符 [index] 和 [request] 被支持为递增的数字或实际解析的文件名。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;[request]&quot; */</span> <span class="string">`@/views/<span class="subst">$&#123;view&#125;</span>.vue`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用cdn加速"><a href="#使用cdn加速" class="headerlink" title="使用cdn加速"></a>使用cdn加速</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cdn = &#123;</span><br><span class="line">  <span class="attr">css</span>: [</span><br><span class="line">    <span class="comment">//雪碧图样式</span></span><br><span class="line">    <span class="string">&quot;https://**/**/icon.css&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">js</span>: [</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vue/3.2.33/vue.cjs.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vuex/4.0.2/vuex.cjs.min.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/vue-router/4.0.14/vue-router.cjs.min.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/axios/0.26.1/axios.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/core-js/3.22.0/minified.js&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断是否是生产环境</span></span><br><span class="line"><span class="keyword">const</span> isProd = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span></span><br><span class="line">cdn = isProd ? cdn : &#123;<span class="attr">css</span>:[],<span class="attr">js</span>:[]&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">configureWebpack</span>: &#123;</span><br><span class="line"> <span class="comment">// 采用cdn的方式,所以将以下这些文件配置不打包</span></span><br><span class="line">    <span class="attr">externals</span>:&#123;</span><br><span class="line">       <span class="attr">vue</span>:<span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">      <span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>,</span><br><span class="line">       <span class="attr">vuex</span>: <span class="string">&#x27;Vuex&#x27;</span>,</span><br><span class="line">       <span class="attr">axios</span>:<span class="string">&#x27;axios&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;core-js&#x27;</span>:<span class="string">&#x27;core-js&#x27;</span>,</span><br><span class="line">       <span class="attr">vant</span>:<span class="string">&#x27;vant&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">chainWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="comment">// 注入cdn</span></span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&quot;html&quot;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">cdn</span> = cdn</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>index.html 模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-Hans&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的CSS文件 --&gt;</span></span><br><span class="line">    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.css) &#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.css[i] %&gt; &quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but app doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用CDN的JS文件 --&gt;</span></span><br><span class="line">    &lt;% for (var i in htmlWebpackPlugin.options.cdn &amp;&amp; htmlWebpackPlugin.options.cdn.js) &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= htmlWebpackPlugin.options.cdn.js[i] %&gt;&quot;</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="查看性能分析报告"><a href="#查看性能分析报告" class="headerlink" title="查看性能分析报告"></a>查看性能分析报告</h3><p>通过查看性能分析报告确定哪些大模块使用cdn加速</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build --report --mode production&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="去除-console-log"><a href="#去除-console-log" class="headerlink" title="去除 console.log"></a>去除 console.log</h3><p>1、方式1</p><p>npm i terser-webpack-plugin -D</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"> <span class="attr">chainWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>)&#123;</span><br><span class="line">      <span class="comment">// 去除console.log输出</span></span><br><span class="line">      config.<span class="property">optimization</span></span><br><span class="line">      .<span class="title function_">minimizer</span>(<span class="string">&#x27;terser&#x27;</span>)</span><br><span class="line">      .<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(args[<span class="number">0</span>].<span class="property">terserOptions</span>.<span class="property">compress</span>, &#123; </span><br><span class="line">          <span class="comment">// 生产模式去除console.log</span></span><br><span class="line">          <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、方式2</p><p>安装  babel-plugin-transform-remove-console</p><p>.babel.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [];</span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (isProduction) &#123;</span><br><span class="line">  plugins.<span class="title function_">push</span>([<span class="string">&quot;transform-remove-console&quot;</span>, &#123; <span class="attr">exclude</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;warn&quot;</span>] &#125;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">  <span class="attr">plugins</span>: plugins,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="webpack-chain-语法"><a href="#webpack-chain-语法" class="headerlink" title="webpack-chain 语法"></a>webpack-chain 语法</h3><blockquote><p><a href="https://blog.51cto.com/feng/5289791">参考链接</a></p></blockquote><h3 id="完整示例参考"><a href="#完整示例参考" class="headerlink" title="完整示例参考"></a>完整示例参考</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 打包配置</span></span><br><span class="line"><span class="comment"> * @Author:  wyf</span></span><br><span class="line"><span class="comment"> * @Date: 2023-07-03 08:48:44</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2023-08-29 11:01:04</span></span><br><span class="line"><span class="comment"> * @LastEditors:  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; type &#125; = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>);</span><br><span class="line"><span class="comment">// 是否为生产环境</span></span><br><span class="line"><span class="keyword">const</span> isProduction = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"><span class="comment">// 时间戳</span></span><br><span class="line"><span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// const &#123; config &#125; = require(&#x27;process&#x27;);</span></span><br><span class="line"><span class="comment">// console.log(&quot;process.config&quot;, config);</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">publicPath</span>: isProduction ? <span class="string">&quot;/&quot;</span> : <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment">// target: &quot;http://192.18.1.12:8080/&quot;, // 我们要代理的真实接口地址</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://60.173.195.163:18000/&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">configureWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">performance</span> = &#123;</span><br><span class="line">      <span class="attr">hints</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      <span class="comment">// 入口起点的最大体积</span></span><br><span class="line">      <span class="attr">maxEntrypointSize</span>: <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 生成文件的最大体积</span></span><br><span class="line">      <span class="attr">maxAssetSize</span>: <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 只给出 js 文件的性能提示</span></span><br><span class="line">      <span class="attr">assetFilter</span>: <span class="keyword">function</span> (<span class="params">assetFilename</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> assetFilename.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;preload&#x27;</span>) <span class="comment">// <span class="doctag">TODO:</span> need test</span></span><br><span class="line">    config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;prefetch&#x27;</span>) <span class="comment">// <span class="doctag">TODO:</span> need test</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isProduction)&#123;</span><br><span class="line">      <span class="comment">// 去除console.log输出</span></span><br><span class="line">      config.<span class="property">optimization</span></span><br><span class="line">      .<span class="title function_">minimizer</span>(<span class="string">&#x27;terser&#x27;</span>)</span><br><span class="line">      .<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(args[<span class="number">0</span>].<span class="property">terserOptions</span>.<span class="property">compress</span>, &#123; </span><br><span class="line">          <span class="comment">// 生产模式去除console.log</span></span><br><span class="line">          <span class="attr">pure_funcs</span>: [<span class="string">&#x27;console.log&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// set svg-sprite-loader</span></span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">      .<span class="property">exclude</span>.<span class="title function_">add</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icons&#x27;</span>))</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;icons&#x27;</span>)</span><br><span class="line">      .<span class="title function_">test</span>(<span class="regexp">/\.svg$/</span>)</span><br><span class="line">      .<span class="property">include</span>.<span class="title function_">add</span>(path.<span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icons&#x27;</span>))</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">options</span>(&#123;</span><br><span class="line">        <span class="attr">symbolId</span>: <span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line"></span><br><span class="line">    config.<span class="property">optimization</span>.<span class="title function_">splitChunks</span>(&#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 表示选择哪些 chunks 进行分割，可选值有：async，initial和all</span></span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="number">10</span>, <span class="comment">// </span></span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">30000</span>, <span class="comment">// 依赖包超过30KB将被单独打包</span></span><br><span class="line">      <span class="attr">automaticNameDelimiter</span>: <span class="string">&quot;-&quot;</span>,<span class="comment">// 抽取出来的文件的自动生成名字的分割符，默认为 ~；</span></span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">vendor</span>: &#123; <span class="comment">// vendors用于提取所有node_modules中符合条件的模块</span></span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="title function_">name</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> packageNames = <span class="variable language_">module</span>.<span class="property">context</span>.<span class="title function_">match</span>(</span><br><span class="line">              <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span>(packageNames) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">`chunk.<span class="subst">$&#123;packageNames[<span class="number">1</span>].replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">priority</span>: <span class="number">10</span> <span class="comment">// 当一个模块同时符合多个cacheGroups时，则根据其中的priority配置项确定优先级</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    config.<span class="property">output</span></span><br><span class="line">      .<span class="title function_">filename</span>(</span><br><span class="line">        <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">chunkFilename</span>(</span><br><span class="line">        <span class="string">`js/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.js`</span></span><br><span class="line">      );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 系统名称</span></span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">tap</span>(<span class="function"><span class="params">args</span> =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].<span class="property">title</span> = <span class="string">&quot;智慧营业厅管理平台&quot;</span></span><br><span class="line">        <span class="keyword">return</span> args</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">sourceMap</span>: isProduction ? <span class="literal">false</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">extract</span>: &#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">`css/[name]_[hash]_<span class="subst">$&#123;process.env.VUE_APP_VERSION&#125;</span>_<span class="subst">$&#123;timestamp&#125;</span>.css`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="string">&quot;style-resources-loader&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">preProcessor</span>: <span class="string">&quot;less&quot;</span>,</span><br><span class="line">      <span class="attr">patterns</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src/styles/variable.less&quot;</span>)],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;收集一些常见的基于vue-cli的优化项&lt;/p&gt;
&lt;p&gt;vue-cli 配置项结构&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123; defineConfig &amp;#125; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;@vue/cli-service&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;exports&lt;/span&gt; = &lt;span class=&quot;title function_&quot;&gt;defineConfig&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;


&lt;/blockquote&gt;
&lt;h3 id=&quot;设置全局样式&quot;&gt;&lt;a href=&quot;#设置全局样式&quot; class=&quot;headerlink&quot; title=&quot;设置全局样式&quot;&gt;&lt;/a&gt;设置全局样式&lt;/h3&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="vue-cli" scheme="https://wyf195075595.github.io/tags/vue-cli/"/>
    
  </entry>
  
  <entry>
    <title>低代码平台</title>
    <link href="https://wyf195075595.github.io/2023/06/02/programming/others/%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0/"/>
    <id>https://wyf195075595.github.io/2023/06/02/programming/others/%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0/</id>
    <published>2023-06-02T10:23:10.000Z</published>
    <updated>2023-07-31T01:04:25.081Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>通过低代码开发（apaas）——<strong>研发人员可以通过低代码平台为企业快速构建应用程序，非技术人员也可以通过低代码平台，使用简单的“拖、拉、拽”来创建应用。</strong></p><p>简单来说，低代码开发（apaas）<strong>面向每个人，让我们（不管是否懂编程、不管是何职业）都能快速的设计出一个管理应用。</strong></p></blockquote><h3 id="Appsmith-pageplug-cn"><a href="#Appsmith-pageplug-cn" class="headerlink" title="Appsmith / pageplug.cn/"></a><a href="https://link.juejin.cn/?target=https://www.appsmith.com/">Appsmith</a> / <a href="https://link.juejin.cn/?target=https://pageplug.cn/">pageplug.cn/</a></h3><blockquote><p>Appsmith 是一款开源低代码框架，主要用于构建管理面板、内部工具和仪表板等，允许拖放 UI 组件来构建页面，通过连接到任何 API、数据库或 GraphQL 源，并使用 JavaScript 语言编写逻辑，可以在短时间内创建内部应用程序。</p><p>PagePlug是Appsmith 的中国化项目，基于Appsmith做了整体性能优化及汉化，也集合了特色表单解决方案Formily组件、图表解决方案Echarts组件、低代码小程序开发等，是面向研发使用的一个开源的、声明式的、可视化的、符合开发者直觉的前端低代码框架。</p></blockquote><h3 id="阿里低代码平台"><a href="#阿里低代码平台" class="headerlink" title="阿里低代码平台"></a><a href="https://lowcode-engine.cn/index">阿里低代码平台</a></h3><p><a href="https://docs-cn.nocobase.com/welcome/introduction">nocobase</a></p><blockquote><p>NocoBase 是一个极易扩展的开源无代码开发平台。 无需编程，使用 NocoBase 搭建自己的协作平台、管理系统，只需要数小时时间。</p><p>NocoBase 正处在早期开发阶段，可能变动频繁，请谨慎用于生产环境。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;通过低代码开发（apaas）——&lt;strong&gt;研发人员可以通过低代码平台为企业快速构建应用程序，非技术人员也可以通过低代码平台，使用简单的“拖、拉、拽”来创建应用。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;简单来说，低代码开发（apaas）&lt;strong</summary>
      
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="低代码" scheme="https://wyf195075595.github.io/tags/%E4%BD%8E%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>RPA 流程自动化机器人</title>
    <link href="https://wyf195075595.github.io/2023/05/29/programming/others/RPA/"/>
    <id>https://wyf195075595.github.io/2023/05/29/programming/others/RPA/</id>
    <published>2023-05-29T00:23:10.000Z</published>
    <updated>2023-05-29T01:15:21.638Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>软件的流程自动化并不是一个新概念，比如微软的Office办公软件中，早在二十多年前就自带了“宏”（Macro）的功能，可以自动化操作Office来工作。</p><p>但是，RPA和早期的软件流程自动化有所不同，RPA强调对已有系统的“无侵入”，这是什么意思呢？就是说，如果一个软件本身不支持自动化的功能，那么RPA就可以大显身手了。RPA不需要对这个软件进行任何修改，而是通过模拟人的阅读和操作软件的方式，让这个软件实现自动化。不仅如此，如果有两个、三个甚至更多的软件需要一起工作，如果采用传统的Office“宏”的方式，那就必须让这些软件都进行修改，实现一套统一的接口才行。有一个不改，流程就不能自动化，这显然有点儿强人所难，毕竟这些软件很可能不是同一个厂商开发的！但是，如果采用RPA，这些软件 <strong>全部</strong> 都不需要经过任何修改，RPA会制造一个“软件机器人”，模拟人的阅读和操作，让“软件机器人”自动完成这个流程，这种“无侵入”的特点是RPA的核心魅力之一。</p></blockquote><h3 id="RPA产品"><a href="#RPA产品" class="headerlink" title="RPA产品"></a>RPA产品</h3><p><a href="https://zhuanlan.zhihu.com/p/275757075">参考连接</a></p><p><strong>国内产品</strong></p><p>影刀,艺赛旗,容智,弘玑,Uibot,云扩,阿里云RPA,达观,英诺森</p><p><strong>国外产品</strong></p><p>UiPath,Blue Prism,Automation Anywhere,Power Automation,Pega,WorkFusion,Jacada,WinAutomation,NICE,Contextor</p><blockquote><p>2022年8月更新</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;软件的流程自动化并不是一个新概念，比如微软的Office办公软件中，早在二十多年前就自带了“宏”（Macro）的功能，可以自动化操作Office来工作。&lt;/p&gt;
&lt;p&gt;但是，RPA和早期的软件流程自动化有所不同，RPA强调对已有系统的“无侵入”，这</summary>
      
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="RPA" scheme="https://wyf195075595.github.io/tags/RPA/"/>
    
  </entry>
  
  <entry>
    <title>免费的在线数据库</title>
    <link href="https://wyf195075595.github.io/2023/05/29/programming/others/freeOnlineDB/"/>
    <id>https://wyf195075595.github.io/2023/05/29/programming/others/freeOnlineDB/</id>
    <published>2023-05-29T00:23:10.000Z</published>
    <updated>2023-06-19T06:49:59.865Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>收集一些白嫖的平台资源</p></blockquote><h2 id="1-db4free"><a href="#1-db4free" class="headerlink" title="1.db4free"></a>1.db4free</h2><p><a href="https://link.zhihu.com/?target=https://db4free.net/">db4free.net - 免费的 MySQL 数据库db4free.net/</a></p><blockquote><p>mysql数据库，基本最新版本，服务器在国外，可能比较慢但是是稳定的。</p><p>无需注册账号，不定时清空超过200MB的资料库。</p></blockquote><span id="more"></span><h2 id="2-sqlpub"><a href="#2-sqlpub" class="headerlink" title="2.sqlpub"></a>2.sqlpub</h2><p><a href="https://link.zhihu.com/?target=http://sqlpub.com/">SQLPub - 免费的MySQL数据库sqlpub.com/</a></p><blockquote><p>mysql数据库，基本最新版本，服务器在国内。</p><p>无需注册账号，最大36000次/小时的请求、同时10个连接和500M存储空间。</p></blockquote><h2 id="3-memfire"><a href="#3-memfire" class="headerlink" title="3. memfire"></a>3. memfire</h2><p><a href="https://link.zhihu.com/?target=https://cloud.memfiredb.com/">MemFireDBcloud.memfiredb.com/</a></p><blockquote><p>只支持PostgreSQL,不支持mysql，服务器在国内。</p><p>需要注册账号，每个账号限一个。 每月读写100万读额度，10万写，1G内存限制</p></blockquote><h2 id="4-SQL-Online"><a href="#4-SQL-Online" class="headerlink" title="4.SQL Online"></a>4.<a href="https://sqliteonline.com/">SQL Online</a></h2><blockquote><p>这个只能学习使用练习 SQL 语句，不能在应用上使用</p><p>SQL Online 提供了 MariaDB、PostgreSQL、SQLite 以及 SQL Server 数据库环境，Oracle 数据库正在计划中。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;收集一些白嫖的平台资源&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;1-db4free&quot;&gt;&lt;a href=&quot;#1-db4free&quot; class=&quot;headerlink&quot; title=&quot;1.db4free&quot;&gt;&lt;/a&gt;1.db4free&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https://db4free.net/&quot;&gt;db4free.net - 免费的 MySQL 数据库db4free.net/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;mysql数据库，基本最新版本，服务器在国外，可能比较慢但是是稳定的。&lt;/p&gt;
&lt;p&gt;无需注册账号，不定时清空超过200MB的资料库。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="db" scheme="https://wyf195075595.github.io/tags/db/"/>
    
  </entry>
  
  <entry>
    <title>kettle基础</title>
    <link href="https://wyf195075595.github.io/2023/05/10/programming/java/kettle/"/>
    <id>https://wyf195075595.github.io/2023/05/10/programming/java/kettle/</id>
    <published>2023-05-10T13:00:00.000Z</published>
    <updated>2023-05-29T00:30:21.888Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>ETL</strong>(Extract-Transform-Load 的缩写，即<strong>数据抽取、转换、装载的过程)<strong>，对于企业或行业应用来说，我们经常会遇到各种</strong>数据的处理，转换，迁移</strong>，所以了解并掌握一种 ETL 工具的使用，必不可少。“<br>市面上常用的 ETL 工具有很多，比如 <strong>Sqoop，Daax，Kettle，Talend 等</strong>，作为一个大数据工程师，我们最好要掌握其中的两到三种，这里我们要学习的 ETL 工具是 Kettle!“</p><p>**Kettle (新名字PDI，但大家都叫老名字)**是一款国外开源的 ETL 工具，纯java 编写，可以在Window、Linux、Unix 上运行，绿色无需安装，数据抽取高效稳定。</p></blockquote><span id="more"></span><h3 id="输入控件"><a href="#输入控件" class="headerlink" title="输入控件"></a>输入控件</h3><h3 id="输出控件"><a href="#输出控件" class="headerlink" title="输出控件"></a>输出控件</h3><h4 id="Excel输出"><a href="#Excel输出" class="headerlink" title="Excel输出"></a>Excel输出</h4><blockquote><p>将输入格式转为Excel输出</p></blockquote><h4 id="文本文件输出"><a href="#文本文件输出" class="headerlink" title="文本文件输出"></a>文本文件输出</h4><blockquote><p>将输入格式转为 txt 输出</p></blockquote><h4 id="更新-amp-插入-更新"><a href="#更新-amp-插入-更新" class="headerlink" title="更新&amp;插入/更新"></a>更新&amp;插入/更新</h4><blockquote><p><strong>更新</strong></p><p>将表输入进行 更新操作，要求输入表与输出表数量一致</p><h4 id="插入-更新"><a href="#插入-更新" class="headerlink" title="插入/更新"></a>插入/更新</h4><p>将表输入进行 插入/更新操作，输出表数量少时会自动插入</p></blockquote><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><blockquote><p>以输入表数据为依据 删除输出表中的数据</p></blockquote><h4 id="表输出"><a href="#表输出" class="headerlink" title="表输出"></a>表输出</h4><blockquote><p>将输入表数据输出道 输出表</p></blockquote><h3 id="转换控件"><a href="#转换控件" class="headerlink" title="转换控件"></a>转换控件</h3><h4 id="Concat-fields"><a href="#Concat-fields" class="headerlink" title="Concat fields"></a>Concat fields</h4><blockquote><p>将多个字段拼接成新的字段</p></blockquote><h4 id="值映射"><a href="#值映射" class="headerlink" title="值映射"></a>值映射</h4><blockquote><p>值映射就是把字段的一个值映射成其他的值。在数据质量规范上使用非常多，比如很多系统对应性别 sex 字段的定义不同。所以我们需要利用此控件，将同一个字段的不同的值映射转换成我们需要的值。“</p><ol><li>选择映射的字段“</li><li>还可以自定义映射完以后的新字段名</li><li>可以设置不匹配时的默认值</li><li>设置映射的值“</li></ol></blockquote><h4 id="增加常量-amp-增加序列"><a href="#增加常量-amp-增加序列" class="headerlink" title="增加常量&amp;增加序列"></a>增加常量&amp;增加序列</h4><blockquote><p>增加常量就是在本身的数据流里面添加一列数据，该列的数据都是相同的值。</p><p>增加序列是给数据流添加一个序列字段，可以自定义该序列字段的递增步长。“</p></blockquote><h4 id="字段选择"><a href="#字段选择" class="headerlink" title="字段选择"></a>字段选择</h4><blockquote><p>可以删除字段，修改字段名称，数据类型等等</p></blockquote><h4 id="字符串剪切-操作-替换"><a href="#字符串剪切-操作-替换" class="headerlink" title="字符串剪切/操作/替换"></a>字符串剪切/操作/替换</h4><blockquote><p>字符串的剪切替换，字符串操作可以操作转大小写</p></blockquote><h4 id="去重-排序"><a href="#去重-排序" class="headerlink" title="去重/排序"></a>去重/排序</h4><blockquote><p>去重前必须排序</p></blockquote><p><strong>唯一行（哈希值）</strong></p><blockquote><p>唯一行(哈希值)是给每一行的数据建立哈希值，通过哈希值来比较数据是否重复，因此唯一行(哈希值) 去重效率比较高，也更建议大家使用。</p></blockquote><p><strong>拆分字段</strong></p><blockquote><p>例如将 名字 拆分成 firstName,lastName.注意：<strong>拆分字段后原字段就没有了</strong></p></blockquote><h4 id="列拆分为多行"><a href="#列拆分为多行" class="headerlink" title="列拆分为多行"></a>列拆分为多行</h4><blockquote><p>列拆分为多行就是把指定字段按指定分隔符进行拆分为多行，然后其他字段直接复制。</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230516112232376.png" alt="image-20230516112232376"></p><h4 id="列扁平化"><a href="#列扁平化" class="headerlink" title="列扁平化"></a>列扁平化</h4><blockquote><p>相当于 列拆分为多行 的反向操作。操作前请先排序。用的少</p></blockquote><h4 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h4><blockquote><p><strong>注意:列转行之前数据流必须按照分组字段进行排序，否则数据会错乱!</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230516115235973.png" alt="image-20230516115235973"></p><ol><li>关键字段:从数据内容变成列名的字段、</li><li>分组字段:列转行，转变以后的分组字段</li><li>目标字段:增加的列的列名字段</li><li>数据字段:目标字段的数据字段</li><li>关键字值:数据字段查询时的关键字，也可以理解为 key</li></ol><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230516120412862.png" alt="image-20230516120412862"></p><h4 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h4><blockquote><p>与列转行相反</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230516120342116.png" alt="image-20230516120342116"></p><ol><li>Key 字段:行转列，生成的列名字段名“</li><li>字段名称: 原本数据流中的字段名“</li><li>Key 值: Key 字段的值，这个是自己自定义的，一般都跟前面的字段名称一样</li><li>Value 字段:对应的 Key 值的数据列的列名“</li></ol><h3 id="应用控件"><a href="#应用控件" class="headerlink" title="应用控件"></a>应用控件</h3><h4 id="替换NULL值"><a href="#替换NULL值" class="headerlink" title="替换NULL值"></a>替换NULL值</h4><blockquote><p>可以将NULL值替换成其他默认值，全局替换和针对某个字段</p></blockquote><h4 id="写日志"><a href="#写日志" class="headerlink" title="写日志"></a>写日志</h4><blockquote><p>将日志输出道kettle控制台</p></blockquote><h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="Switch-case"><a href="#Switch-case" class="headerlink" title="Switch/case"></a>Switch/case</h4><blockquote><p>根据不同的条件<strong>跳</strong>到不同的操作</p></blockquote><h4 id="过滤记录"><a href="#过滤记录" class="headerlink" title="过滤记录"></a>过滤记录</h4><blockquote><p>和 Switch/case 做对比的话，过滤记录相当于 if-else，可以自定义输入一个判断条件，然后将数据流中的数据一路分为两路。</p></blockquote><h4 id="空操作"><a href="#空操作" class="headerlink" title="空操作"></a>空操作</h4><blockquote><p>一般设置为数据流终点，啥也不做。会在控制台输出报错信息</p></blockquote><h3 id="查询控件"><a href="#查询控件" class="headerlink" title="查询控件"></a>查询控件</h3><blockquote><p>查询是转换里面的第九个分类，查询控件是用来查询数据源里面的数据，并合并到主数据流中。</p></blockquote><h4 id="数据库查询"><a href="#数据库查询" class="headerlink" title="数据库查询"></a>数据库查询</h4><blockquote><p>将表输入的数据，与数据库查询的数据经行左连接</p></blockquote><h4 id="流查询"><a href="#流查询" class="headerlink" title="流查询"></a>流查询</h4><blockquote><p>将两个表输入经行连接查询，设置 lookup 的表为次表，另一个为主表</p></blockquote><h3 id="连接控件"><a href="#连接控件" class="headerlink" title="连接控件"></a>连接控件</h3><h4 id="合并记录"><a href="#合并记录" class="headerlink" title="合并记录"></a>合并记录</h4><blockquote><p>​    合并记录是用于将两个不同来源的数据合并，这两个来源的数据分别为旧数据和新数据，该步骤将旧数据和新数据按照指定的关键字匹配、比较、合并。注意旧数据和新数据需要事先按照关键字段排序，并且旧数据和新数据要有相同的字段名称。“<br>​    合并后的数据将包括旧数据来源和新数据来源里的所有数据，对于变化的数据，使用新数据代替旧数据，同时在结果里用一个标示字段，来指定新旧数据的比较结果。</p></blockquote><p>合并操作前先排序记录    主要是用作两个文件的对比</p><h4 id="记录集连接"><a href="#记录集连接" class="headerlink" title="记录集连接"></a>记录集连接</h4><blockquote><p>记录集连接可以对两个步骤中的数据流进行左连接，右连接，内连接，外连接。此控件功能比较强大，企业做 ETL 开发会经常用到此控件，但是需要注意在<strong>进行记录集连接之前需要对记录集的数据进行排序</strong>，<strong>并且排序的字段还一定要选两个表关联的字段，否则数据错乱，出现null 值</strong>。</p></blockquote><h3 id="kettle-统计控件"><a href="#kettle-统计控件" class="headerlink" title="kettle 统计控件"></a>kettle 统计控件</h3><p>提供数据采样和统计功能</p><h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><p>按什么字段分组，就需要按什么字段排序</p><h3 id="kettle映射控件"><a href="#kettle映射控件" class="headerlink" title="kettle映射控件"></a>kettle映射控件</h3><h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><blockquote><p>映射类似于Java中的方法，在另一个转换中调用我们的映射</p></blockquote><h3 id="kettle脚本控件"><a href="#kettle脚本控件" class="headerlink" title="kettle脚本控件"></a>kettle脚本控件</h3><h4 id="执行SQL脚本"><a href="#执行SQL脚本" class="headerlink" title="执行SQL脚本"></a>执行SQL脚本</h4><blockquote><p>跟连接工具差不多，没啥用</p></blockquote><h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h3><p>作业项是作业的基本构成部分。如同转换的步骤，作业项也可以使用图标的方式图形化展示。但是，作业项和转换步骤有下面几点不同:</p><ol><li>转换步骤与步骤之间是数据流，作业项之间是步骤流。</li><li>转换启动以后，所有步骤一起并行启动等待数据行的输入，而作业项是严格按照执行顺序启动，一个作业项执行完以后，再执行下一个作业项。</li><li>“在作业项之间可以传递一个结果对象 (result object)。这个结果对象里面包含了数3据行，它们不是以数据流的方式来传递的。而是等待一个作业项执行完了，再传递个下一个作业项。“</li><li>因为作业顺序执行作业项，所以必须定义一个起点。有一个叫“开始”的作业项就定义了这个点。一个作业只能定一个开始作业项</li></ol><p><strong>作业跳</strong></p><blockquote><p>分三种类型</p><ol><li>无论上次执行结果成功失败都继续执行下一跳，图标🔒</li><li>运行当前结果为true时才执行下一个作业，图标，✔</li><li>当前运行结果失败才执行下一个作业，图标，❌</li></ol></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ETL&lt;/strong&gt;(Extract-Transform-Load 的缩写，即&lt;strong&gt;数据抽取、转换、装载的过程)&lt;strong&gt;，对于企业或行业应用来说，我们经常会遇到各种&lt;/strong&gt;数据的处理，转换，迁移&lt;/strong&gt;，所以了解并掌握一种 ETL 工具的使用，必不可少。“&lt;br&gt;市面上常用的 ETL 工具有很多，比如 &lt;strong&gt;Sqoop，Daax，Kettle，Talend 等&lt;/strong&gt;，作为一个大数据工程师，我们最好要掌握其中的两到三种，这里我们要学习的 ETL 工具是 Kettle!“&lt;/p&gt;
&lt;p&gt;**Kettle (新名字PDI，但大家都叫老名字)**是一款国外开源的 ETL 工具，纯java 编写，可以在Window、Linux、Unix 上运行，绿色无需安装，数据抽取高效稳定。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="kettle基础" scheme="https://wyf195075595.github.io/tags/kettle%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>linux命令</title>
    <link href="https://wyf195075595.github.io/2023/05/04/programming/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
    <id>https://wyf195075595.github.io/2023/05/04/programming/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</id>
    <published>2023-05-04T02:57:10.000Z</published>
    <updated>2023-06-16T09:55:50.154Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>linux 由 unix 演化而来</p><p>基于Linux 开源的内核，不同厂商开发出了不同名称的系统: 如 Redhat,CentOSE, Ubuntu,Suse,红旗等。</p></blockquote><p><strong>虚拟机的网络连接形式</strong></p><ul><li><p>桥连接</p><p>  Linux 可以和其他的通信，但是可能造成IP冲突</p></li><li><p>NAT</p><p>  网络地址转换方式，linux 可以访问外网，不会造成IP冲突</p></li><li><p>主机模式</p><p>  你的Linux是一个独立的主机，不能访问外网</p></li></ul><p><strong>Vmtools</strong></p><blockquote><p>此工具可以让 centOS 与主机共享文件，剪切板</p></blockquote><span id="more"></span><h4 id="Linux-目录结构"><a href="#Linux-目录结构" class="headerlink" title="Linux 目录结构"></a>Linux 目录结构</h4><blockquote><p>采用层级式树状目录结构。Linux中一切皆文件，usb,摄像头，网卡等硬件，都会映射成一个文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-/# 根目录</span><br><span class="line">-bin#指令</span><br><span class="line">-dev#设备管理,硬件的映射文件</span><br><span class="line">-home#创建用户会生成对应文件</span><br><span class="line">-lib64#静态库</span><br><span class="line">-mnt#挂载目录</span><br><span class="line">-proc#内核相关，虚拟目录，内存映射</span><br><span class="line">-run</span><br><span class="line">-srv#存放服务启动之后所需数据</span><br><span class="line">-tmp#临时文件</span><br><span class="line">-var#变量</span><br><span class="line">-boot#启动Linux的核心文件</span><br><span class="line">-etc#配置文件</span><br><span class="line">-lib#动态连接共享库</span><br><span class="line">-media#如dvd</span><br><span class="line">-opt#要安装的软件</span><br><span class="line">-root#root相关</span><br><span class="line">-sbin#高级权限指令</span><br><span class="line">-sys#该目录安装了linux2.6内核中新出现的文件系统ysfs</span><br><span class="line">-usr#用户，用户很多应用程序和文件都放在这个目录</span><br><span class="line">--local#给主机额外安装软件所安装的目录</span><br><span class="line">-selinux#安全子系统，控制程序只能访问特定文件</span><br></pre></td></tr></table></figure><h4 id="Linux-编辑器-Vi、Vim"><a href="#Linux-编辑器-Vi、Vim" class="headerlink" title="Linux 编辑器 Vi、Vim"></a>Linux 编辑器 Vi、Vim</h4><p>三种模式：</p><ol><li><p>正常模式</p><p> 只能查看</p></li><li><p>插入编辑模式</p><p> 按下 i,I,o,O,a,A,r，R 任意字母进入</p></li><li><p>命令行模式</p><p> 通过上面方式切换VI到VIM 模式， 命令 :wq, :q, :q! </p><p> 查找命令：/关键字，回车查找, 按n查找下一个</p><p> 拷贝当前行：yy</p><p> 拷贝当前行向下5行：5yy</p><p> 粘贴：p, 拷贝后使用</p><p> 删除当前行：dd</p><p> 删除当前行向下5行：5dd</p><p> 光标回到顶部：gg</p><p> 光标回到底部：G</p><p> 撤销操作：u</p></li></ol><h4 id="开-关-重启"><a href="#开-关-重启" class="headerlink" title="开/关/重启"></a>开/关/重启</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">立马关机</span></span><br><span class="line">shutdowm -h now </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">定时1分钟后关机</span></span><br><span class="line">shoutdown -h 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">立即重启</span></span><br><span class="line">shoutdown -r now</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接使用 ，等价于关机</span></span><br><span class="line">half</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启</span></span><br><span class="line">reboot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把内存数据写入到磁盘，重启关机前建议执行一次</span></span><br><span class="line">sync</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="用户的登录和注销"><a href="#用户的登录和注销" class="headerlink" title="用户的登录和注销"></a>用户的登录和注销</h4><blockquote><p>由于管理员账户权限较高，为避免操作失误。一般采用普通用户登录，在切换管理员权限。</p><p>注销命令 logout ，在图形界面级别无效。在级别3下有效</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出远程连接,注销登陆</span></span><br><span class="line">logout</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换用户</span></span><br><span class="line">su -用户名</span><br></pre></td></tr></table></figure><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><blockquote><p>用户，用户组（可理解为角色）概念。用户被分配给某个组。组不同权限不同。</p><p>/home/ ： 目录下有各个创建的用户对于家目录，当用户登陆时，会自动进入到自己的家目录</p></blockquote><h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a><strong>创建用户</strong></h4><blockquote><p>Linux用户需要向管理员申请，并被分配到某个组</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">useradd [选项] 用户名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建用户小明，默认会创建一个组 xm,并把小明放进去</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建用户后，会自动创建和用户同名的家目录，也可以通过 `useradd -d 指定目录名称 新用户名` ,为用户指定家目录</span></span><br><span class="line">useradd xm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给新用户设置密码， 注意要在root权限下</span></span><br><span class="line">passwd 用户名</span><br></pre></td></tr></table></figure><h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除用户，保留家目录</span></span><br><span class="line">userdel 用户名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除用户及家目录</span></span><br><span class="line">userdel -r 用户名</span><br></pre></td></tr></table></figure><h4 id="查询用户信息"><a href="#查询用户信息" class="headerlink" title="查询用户信息"></a>查询用户信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法， 没有信息返回 提示</span></span><br><span class="line">id 用户名</span><br></pre></td></tr></table></figure><h4 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换用户， 高权限切换低权限不需要密码</span></span><br><span class="line">su - 切换的用户名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回到切换之前用户</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h4 id="查看当前用户-登录用户"><a href="#查看当前用户-登录用户" class="headerlink" title="查看当前用户/登录用户"></a>查看当前用户/登录用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami/ who am i</span><br></pre></td></tr></table></figure><h4 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h4><blockquote><p>每个用户都有一个组，通过组来控制用户权限管理</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加组</span></span><br><span class="line">groupadd 组名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除组</span></span><br><span class="line">groupdel 组名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加用户时直接加上组</span></span><br><span class="line">useradd -g 用户组 用户名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将用户 zwj 改到 wudang</span></span><br><span class="line">usermod -g wudang zwj</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改变该用户初始的登录目录</span></span><br><span class="line">usermod -d 目录名 用户名</span><br></pre></td></tr></table></figure><h4 id="用户和组的相关文件"><a href="#用户和组的相关文件" class="headerlink" title="用户和组的相关文件"></a>用户和组的相关文件</h4><ul><li><p>/etc/passwd</p><p>  用户user配置文件，记录用户的各种信息</p></li><li><p>/etc/shadow</p><p>  口令（密码）配置文件【信息会加密】，每行的意义</p><p>  登录名:加密口令:最后修改时间:最小使劲啊间隔:最大时间间隔:告警时间:不活动时间:失效时间:标志</p></li><li><p>/etc/group</p><p>  组配置文件，每行含义</p><p>  组名:口令:组标识号:组内用户列表</p></li></ul><h3 id="组管理、权限管理"><a href="#组管理、权限管理" class="headerlink" title="组管理、权限管理"></a>组管理、权限管理</h3><blockquote><p>在Linux中每个用户必须属于一个组，不能独立于组外。</p><p>Linux中的文件：</p><ul><li>所有者</li><li>所在组</li><li>其他组</li><li>改变用户所在组</li></ul></blockquote><h4 id="查看文件所有者，目录所在组"><a href="#查看文件所有者，目录所在组" class="headerlink" title="查看文件所有者，目录所在组"></a>查看文件所有者，目录所在组</h4><blockquote><p>当前用户创建文件时，这个文件所有者是当前用户，所在组为当前用户所在组</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -ahl</span><br></pre></td></tr></table></figure><h4 id="修改文件所有者"><a href="#修改文件所有者" class="headerlink" title="修改文件所有者"></a>修改文件所有者</h4><p>改变所有者不会修改文件所有组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chown 用户名 文件名</span><br><span class="line"></span><br><span class="line">chowm root test.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改变用户所有者和所有组</span></span><br><span class="line">chowm newowner:newgroup file</span><br><span class="line">-R如果是目录，则使其下所有子文件或目录递归生效</span><br></pre></td></tr></table></figure><h4 id="文件目录所在组"><a href="#文件目录所在组" class="headerlink" title="文件目录所在组"></a>文件目录所在组</h4><blockquote><p>当某个用户创建一个文件内后，这个文件的所在组就是该用户的所在组</p></blockquote><h5 id="修改文件所在组"><a href="#修改文件所在组" class="headerlink" title="修改文件所在组"></a>修改文件所在组</h5><p>改变文件所在组不会影响文件所有者</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chgrp 组名 文件名</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件 test.txt 所有组改为 class1</span></span><br><span class="line">chgrp class1 test.txt</span><br><span class="line">-R如果是目录，则使其下所有子文件或目录递归生效</span><br></pre></td></tr></table></figure><h4 id="权限基本介绍"><a href="#权限基本介绍" class="headerlink" title="权限基本介绍"></a>权限基本介绍</h4><blockquote><p>文件的类型</p><p><strong>对于文件来说</strong>：</p><p>r：读 cat</p><p>w：写 vim echo</p><p>x：执行 运行命名或者脚本</p><p><strong>对于目录来说</strong>：</p><p>r：读（看到目录里面有什么） ls</p><p>w：在目录里面新建文件，删除，移动 touch mkdir rm mv cp</p><p>x：目录是不能直接运行的，对目录赋予 x 权限，代表用户可以进入目录，也就是说，赋予 x 权限的用户或群组可以使用 cd 命令。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ls -l</span><br><span class="line">drwxr-xr-x.  2 jysp class1    6 6月  24 2020 音乐</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第一个字母判断文件的类型</span></span><br><span class="line">-:普通文件</span><br><span class="line">d:目录</span><br><span class="line">l: 软链接 </span><br><span class="line">c: 字符设备[键盘，鼠标]</span><br><span class="line">b:块文件，硬盘</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rwx,2-4字母为一组：表示文件所有者拥有的权限</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">r-x,5-7字母为一组：文件所在组的用户的权限</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">r-x，8-10字母为一组：表示文件其他组的用户的权限</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2， 这个数字。如果是文件-表示硬链接数量，如果是目录-表示子目录数量</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jysp, 用户名</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">class1，用户所在组名</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6，表示文件大小，如果是目录则是4096</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6月  24 2020，问件最后修改时间</span></span><br></pre></td></tr></table></figure><h5 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h5><blockquote><p>通过chmod命令，可以修改文件或者目录的权限</p></blockquote><p><strong>方式1：+，-，=</strong></p><p>​    u：所有者</p><p>​    g：所有组</p><p>​    o：其他人</p><p>​    a：所有人（u,g,o的总和）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全部重新复制</span></span><br><span class="line">chmod u=rwx,g=rx,o=x</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基础上加</span></span><br><span class="line">chmod a+w</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基础上减</span></span><br><span class="line">chmod a-x</span><br></pre></td></tr></table></figure><p><strong>方式2：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">例如 将文件 /home/abc.txt 赋值权限：rwxr-xr-x</span><br><span class="line">rwx = 4 + 2 + 1 = 7</span><br><span class="line">r-x = 4 + 1 = 5</span><br><span class="line">r-x = 4 + 1 = 5</span><br><span class="line"></span><br><span class="line">chmod 755 /home/abc.txt</span><br></pre></td></tr></table></figure><h3 id="实用指令"><a href="#实用指令" class="headerlink" title="实用指令"></a>实用指令</h3><blockquote><p>一定情况下可以找回丢失root密码：</p><p>重启进入按 enter键（回车）（6及一下 enter, 7版本按e键）</p><p>进入单用户模式以root用户（root不需要密码</p><p>改密码</p></blockquote><p>系统运行级别 配置文件： /etc/inittab</p><table><thead><tr><th>级别</th><th>环境</th></tr></thead><tbody><tr><td>0</td><td>关机</td></tr><tr><td>1</td><td>单用户（找回丢失root密码</td></tr><tr><td>2</td><td>多用户无网络服务</td></tr><tr><td>3</td><td>多用户有网络服务</td></tr><tr><td>4</td><td>保留</td></tr><tr><td>5</td><td>图形界面</td></tr><tr><td>6</td><td>重启</td></tr></tbody></table><p>切换运行级别</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init [0/1/2/3/4/5/6]</span><br></pre></td></tr></table></figure><h3 id="指令帮助"><a href="#指令帮助" class="headerlink" title="指令帮助"></a>指令帮助</h3><blockquote><p>都是英文，看不明白就百度</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man 命令</span><br><span class="line"></span><br><span class="line">help 命令</span><br></pre></td></tr></table></figure><h3 id="文件目录类"><a href="#文件目录类" class="headerlink" title="文件目录类"></a>文件目录类</h3><h4 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h4><blockquote><p>显示当前工作目录绝对路径</p></blockquote><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法：</span></span><br><span class="line">ls [选项] [目录或是文件]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用选项</span></span><br><span class="line">-a: 显示所有文件及目录，包括隐藏</span><br><span class="line">-l: 以列表方式展示</span><br></pre></td></tr></table></figure><h4 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回到自己的家目录</span></span><br><span class="line">cd ~ / cd :</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回上一级</span></span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h4 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> 指令用于创建目录</span></span><br><span class="line"></span><br><span class="line">mkdir [选项] 要创建的目录</span><br><span class="line">-p: 创建多级目录</span><br><span class="line"></span><br><span class="line">mkdir -p /home/www/html</span><br></pre></td></tr></table></figure><h4 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除空目录， 非空目录无法删除，需要用到 <span class="built_in">rm</span> -rf 要删除的目录</span></span><br><span class="line">rmdir [选项] 要删除的空白目录</span><br></pre></td></tr></table></figure><h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建空文件</span></span><br><span class="line">touch 文件名称</span><br></pre></td></tr></table></figure><h4 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝文件到指定目录</span></span><br><span class="line">cp [选项] source dest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用选项</span></span><br><span class="line">-r: 递归复制整个文件夹</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">细节： 强制覆盖不提示</span></span><br><span class="line">\cp</span><br><span class="line"></span><br><span class="line">---------------</span><br><span class="line">cp a.text bbb/</span><br></pre></td></tr></table></figure><h4 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">移出文件或目录</span></span><br><span class="line">rm [选项] 要删除的文件或目录</span><br><span class="line"></span><br><span class="line">常用指令</span><br><span class="line">-r: 递归整个文件夹</span><br><span class="line">-f: 强制删除不提示</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删库跑路</span></span><br><span class="line">rm -rf *</span><br></pre></td></tr></table></figure><h4 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">移动文件或重命名</span></span><br><span class="line"></span><br><span class="line">mv oldFilaName newFileName</span><br><span class="line">mv /temp/moveFile /targetFloder</span><br></pre></td></tr></table></figure><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件内容，</span></span><br><span class="line">cat [选项] 要查看的文件</span><br><span class="line"></span><br><span class="line">常用命令</span><br><span class="line">-n: 显示行号</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方便查看都会带上管道符| more</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">more指令是一个基于VI编辑器的文本过滤器，它以全屏的方式按页显示文本文件内容。more指令中内置了若干快捷键</span></span><br><span class="line">more 吞噬星空.txt</span><br></pre></td></tr></table></figure><table><thead><tr><th>操作</th><th>功能说明</th></tr></thead><tbody><tr><td>空格</td><td>下一页</td></tr><tr><td>enter</td><td>下一行</td></tr><tr><td>q</td><td>立刻离开，退出预览</td></tr><tr><td>ctrl+F</td><td>滚下一屏</td></tr><tr><td>ctrl+B</td><td>返回上一屏</td></tr><tr><td>=</td><td>输出当前行号</td></tr><tr><td>:f</td><td>输出文件名和当前行的行号</td></tr></tbody></table><h4 id="less"><a href="#less" class="headerlink" title="less"></a>less</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">less 指令用来显示分屏查看文件内容，与more类似，按需加载显示内容，效率高</span></span><br><span class="line">less 吞噬星空.txt</span><br></pre></td></tr></table></figure><table><thead><tr><th>操作</th><th>功能说明</th></tr></thead><tbody><tr><td>空格</td><td>向下翻一页</td></tr><tr><td>pagedown</td><td>下一页</td></tr><tr><td>pageup</td><td>上一页</td></tr><tr><td>/字串</td><td>向下搜索【字串】，n：下找，N：上找</td></tr><tr><td>?字串</td><td>向上搜索【字串】，n：下找，N：上找</td></tr><tr><td>q</td><td>离开查看</td></tr></tbody></table><h4 id="输出重定向（-gt-）和追加-gt-gt"><a href="#输出重定向（-gt-）和追加-gt-gt" class="headerlink" title="输出重定向（&gt;）和追加(&gt;&gt;)"></a>输出重定向（&gt;）和追加(&gt;&gt;)</h4><blockquote><p>重定向会覆盖原先内容，追加不会</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列表中的内容写入文件a.txt</span></span><br><span class="line">ls -l &gt;文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列表内容追加到文件末尾</span></span><br><span class="line">ls -al &gt;&gt;文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件1覆盖到文件2</span></span><br><span class="line">cat 文件1&gt;文件2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;内容&#x27;</span>&gt;&gt;文件</span></span><br></pre></td></tr></table></figure><h4 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h4><blockquote><p>输出内容到控制台</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">echo [选项] [输出内容]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出当前环境变量</span></span><br><span class="line">echo $PATH</span><br></pre></td></tr></table></figure><h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><blockquote><p>head用于显示文件的开头部分内容，默认显示文件前10行内容</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件前10行</span></span><br><span class="line">head 文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件前5行</span></span><br><span class="line">head -n 5 文件</span><br></pre></td></tr></table></figure><h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h4><blockquote><p>用于输出文件中尾部的内容，默认情况下tail指令显示文件的后10行内容</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件后10行</span></span><br><span class="line">tail 文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件后5行</span></span><br><span class="line">tail -n 5 文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时追踪改文档所有更新，工作中常用于监听日志文件</span></span><br><span class="line">tail -f 文件</span><br></pre></td></tr></table></figure><h4 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h4><blockquote><p>软李艾i你姐也叫符号连接，类似于windows里的快捷方式，主要是存放了链接其他文件的路径</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">　基本语法</span></span><br><span class="line">ln -s [源文件或目录] [软链接名]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建软连接</span></span><br><span class="line">ln -s /home/jysp/test/hello.txt test_link</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除软连接,路径不要带/</span></span><br><span class="line">rm -rm test_link</span><br></pre></td></tr></table></figure><h4 id="history"><a href="#history" class="headerlink" title="history"></a>history</h4><blockquote><p>查看已执行过的历史命令，也可以执行历史指令</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">history</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示所有历史命令</span></span><br><span class="line">history</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示最近使用过的10个指令</span></span><br><span class="line">history 10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行历史编号为5的指令</span></span><br><span class="line">!5</span><br></pre></td></tr></table></figure><h3 id="时间日期类的指令"><a href="#时间日期类的指令" class="headerlink" title="时间日期类的指令"></a>时间日期类的指令</h3><blockquote><p>date 指令-显示当前日期</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基础语法</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前时间</span></span><br><span class="line">date</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前年份</span></span><br><span class="line">date +%Y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前月份</span></span><br><span class="line">date +%m</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示当前哪一天</span></span><br><span class="line">date +%d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示年月日时分秒</span></span><br><span class="line">date &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br></pre></td></tr></table></figure><h4 id="设置时间"><a href="#设置时间" class="headerlink" title="设置时间"></a>设置时间</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">date -s 字符串时间</span><br></pre></td></tr></table></figure><h4 id="cal"><a href="#cal" class="headerlink" title="cal"></a>cal</h4><blockquote><p>查看日历指令</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">cal [选项]</span><br><span class="line">-h  查看帮助</span><br></pre></td></tr></table></figure><h3 id="搜索查找类"><a href="#搜索查找类" class="headerlink" title="搜索查找类"></a>搜索查找类</h3><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><blockquote><p>将指令从指定目录向下递归遍历其个个子目录，将满足条件的文件或者目录 显示在终端</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">find [搜索范围] [选项]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选项</span></span><br><span class="line">-name按照文件名查找模式</span><br><span class="line">-user查找指定用户所有文件</span><br><span class="line">-size按照指定文件大小查找文件</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 /home/jysp 目录下 login.html 文件</span></span><br><span class="line">find /home/jysp/ -name login.html</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 /home/jysp 目录下 gif 文件</span></span><br><span class="line">find /home/jysp/ -name *.gif</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 / 目录下 大小超过20M的 文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-20M小于20M</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">20M等于20M</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单位 k,M,G,T...</span></span><br><span class="line"></span><br><span class="line">find / -size +20M</span><br></pre></td></tr></table></figure><h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h4><blockquote><p>locaate指令可以<strong>快速定位文件路径</strong>。locate指令利用事先建立的系统中所有文件名称及路径的locate数据库实现快速定位给定的文件。Locate指令无需遍历整个文件系统，查询速度较快。为了保证查询结果的准确度，管理员必须定期更新locate时刻。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">locate 搜索文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">应用实例</span></span><br><span class="line">案例1:请使用locate 指令快速定位 hello.txt 文件所在目录</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>特别说明<br><strong>由于locate指今基于数据库进行查询，所以第一次运行前，必须使用updatedb指令创建locate数据库。</strong></p></blockquote><h4 id="grep-和"><a href="#grep-和" class="headerlink" title="grep 和 |"></a>grep 和 |</h4><blockquote><p>grep 过滤查找，管道符 “|”, 表示将前一个命令的处理结果输出传递给后面的命令处理</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">grep [选项] 查找内容 源文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选项</span></span><br><span class="line">-n显示匹配及行号</span><br><span class="line">-i忽略字母大小</span><br><span class="line"></span><br><span class="line">----------------------</span><br><span class="line">请在hello.txt 文件中，查找 31，并显示行号</span><br><span class="line">grep -ni 30 hello.txt</span><br><span class="line"></span><br><span class="line">cat hello.txt |grep -n 30</span><br></pre></td></tr></table></figure><h3 id="压缩和解压类"><a href="#压缩和解压类" class="headerlink" title="压缩和解压类"></a>压缩和解压类</h3><h4 id="gzip-gunzip"><a href="#gzip-gunzip" class="headerlink" title="gzip/gunzip"></a>gzip/gunzip</h4><blockquote><p>gzip 用于压缩文件，gunzip 用于解压</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩，只能将文件压缩为 *.gz 文件，支持多文件，空格分开</span></span><br><span class="line">gzip 文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压文件命令</span></span><br><span class="line">gunzip 文件.gz</span><br></pre></td></tr></table></figure><h4 id="zip-unzip"><a href="#zip-unzip" class="headerlink" title="zip/unzip"></a>zip/unzip</h4><blockquote><p>zip 用于压缩文件，unzip用于解压文件。项目发包中常用</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">zip [选项] xxx.zip 要压缩的内容</span><br><span class="line">-r:递归压缩，即压缩目录</span><br><span class="line"></span><br><span class="line">unzip [选项] xxx.zip</span><br><span class="line">-d&lt;目录&gt;：指定压缩后文件存放目录</span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line">1、将/test 下所有文件压缩成 test.zip</span><br><span class="line">zip -r test.zip test</span><br><span class="line">2、将 test.zip 解压到 test/zip 目录下</span><br><span class="line">unzip -d /test/zip test.zip </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><blockquote><p>tar 是打包指令，最后打包文件是 .tar.gz的文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line"></span><br><span class="line">tar [选项] XXX.tar.gz 打包内容</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选项</span></span><br><span class="line">-x：解压.tar文件</span><br><span class="line">-z：打包同时压缩</span><br><span class="line">-v：显示所有过程</span><br><span class="line">-f：指定压缩文件名</span><br><span class="line">-j：有bz2属性的</span><br><span class="line">-c：产生.tar打包文件，用于压缩文件</span><br></pre></td></tr></table></figure><p>1、压缩多个文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf a.tar.gz a1.txt a2.txt</span><br></pre></td></tr></table></figure><p>2、压缩目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf myhome.tar.gz /home/</span><br></pre></td></tr></table></figure><p>3、解压到当前目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf a.tar.gz</span><br></pre></td></tr></table></figure><p>4、解压到指定目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定目录必须已存在</span></span><br><span class="line">tar -zxvf myhome.tar,gz -C /test/gz</span><br></pre></td></tr></table></figure><h3 id="定时任务调度"><a href="#定时任务调度" class="headerlink" title="定时任务调度"></a>定时任务调度</h3><blockquote><p>crontab 进行定时任务的设置。</p><p>系统在某个时间执行的特定的命令或程序。</p><p>分类：</p><p>1、系统工作，如病毒扫描 </p><p>2、个别用户工作，比如 MySQL数据库备份</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基本语法</span></span><br><span class="line">contab [选项]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用选项</span></span><br><span class="line">-e编辑crontab定时任务</span><br><span class="line">-l查询crontab任务</span><br><span class="line">-r删除当前用户所有的crontab任务</span><br></pre></td></tr></table></figure><h4 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h4><p>设置任务调度文件： /etc/crontab</p><p>设置个人任务调度： crontab -e</p><p>输入任务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">每小时的每分钟执行 ls-l /etc/&gt;&gt; /tmp/to.txt</span></span><br><span class="line">*/1**** ls -l  /etc/&gt; /tmp/to.txt</span><br></pre></td></tr></table></figure><table><thead><tr><th>项目</th><th>含义</th><th>范围</th></tr></thead><tbody><tr><td>第1个*</td><td>1h中的第几分钟</td><td>0-59</td></tr><tr><td>第2个*</td><td>一天中的第几个小时</td><td>0-23</td></tr><tr><td>第3个*</td><td>一个月当中的第几天</td><td>1-31</td></tr><tr><td>第4个*</td><td>一年中的地几个月</td><td>1-12</td></tr><tr><td>第5个*</td><td>一周当中的星期几</td><td>0-7（0,7都代表星期日）</td></tr></tbody></table><p><strong>特殊参数说明</strong></p><table><thead><tr><th>特殊符号</th><th>含义</th></tr></thead><tbody><tr><td>*</td><td>任意时间</td></tr><tr><td>,</td><td>代表不连续时间。如”0 6,8 * * * 命令”,每天6:00,8:00执行一次</td></tr><tr><td>-</td><td>代表连续时间范围。如”0 5 * * 1-6 命令”,代表周一到周6凌晨5点0分执行</td></tr><tr><td>*/n</td><td>代表隔多久执行一次。如”*/10 * * * * 命令”，每隔10分钟执行一次</td></tr></tbody></table><h4 id="调度任务实例"><a href="#调度任务实例" class="headerlink" title="调度任务实例"></a><strong>调度任务实例</strong></h4><blockquote><p>每个一分钟，就将当前日期信息，追加到 /xxx/mydate 文件中</p></blockquote><ol><li><p>编写一个文件 mytask1.sh</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date &gt;&gt; /xxx/mydate</span><br></pre></td></tr></table></figure></li><li><p>给脚本可执行权限</p></li><li><p>crontab -e</p></li><li><p>*/1 * * * *   /xxx/mytask1.sh</p></li></ol><h4 id="相关指令"><a href="#相关指令" class="headerlink" title="相关指令"></a>相关指令</h4><ol><li>contab -r  终止任务调度</li><li>contab -l  列出当前有哪些任务调度</li><li>service contab restart  重启任务调度</li></ol><h3 id="磁盘分区、挂载"><a href="#磁盘分区、挂载" class="headerlink" title="磁盘分区、挂载"></a>磁盘分区、挂载</h3><blockquote><p>分区方式：</p><ol><li>mbr分区<ul><li>最多支持4个主分区</li><li>系统只能安装在主分区</li><li>扩展分区要占一个主分区</li><li>MBR最大只支持2TB，但拥有最好兼容性</li></ul></li><li>gpt分区<ol><li>支持无限多个分区（操作系统可能会限制，如windows下最多128个）</li><li>支持最大18EB的大容量（EB=1024PB,pb=1024TB）</li><li>windows7 64位以后才支持gpt</li></ol></li></ol></blockquote><p>硬盘说明：</p><p>对于Linux硬盘分为 IDE硬盘和SCSI硬盘，目前基本上是SCSI硬盘</p><p>对于IDE硬盘：驱动标识符 “hdx~”</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hd 表名分区类型就是IDE</span><br><span class="line">X 为盘号，a基本盘，b基本从属盘，c为辅助主盘，d为辅助从属盘</span><br><span class="line">~ 代表分区，主分区、拓展分区（1-4），从5开始为逻辑分区</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hda3</span></span><br><span class="line">IDE硬盘上第三个主分区或拓展分区</span><br></pre></td></tr></table></figure><p>对于SCSI硬盘使用 “sd”表示分区所在设备的类型，其余跟 IDE硬盘一样</p><h4 id="查看系统分区和挂载"><a href="#查看系统分区和挂载" class="headerlink" title="查看系统分区和挂载"></a>查看系统分区和挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk -f</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230508112227249.png" alt="image-20230508112227249"></p><h4 id="Linux挂载今典案例"><a href="#Linux挂载今典案例" class="headerlink" title="Linux挂载今典案例"></a>Linux挂载今典案例</h4><blockquote><p>在Linux中增加一个新的硬盘 sdb1(2G)，并挂载到/home/newdisk</p></blockquote><p><strong>如何增加一块硬盘</strong></p><ol><li><p>虚拟机添加硬盘（需重启）</p></li><li><p>分区  fdisk /dev/sdb</p><p> 输入 n 新增分区，然后输入p,分区类型为主分区,然后输入w,保存退出</p></li><li><p>格式化  mkfs -t ext4 /dev/sdb1</p></li><li><p>挂载 先创建一个 /home/newdisk,挂载 mount /dev/sdb1 /home/newdisk</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount 设备名称 挂载名录</span><br><span class="line">umount 设备名称 挂载名录</span><br></pre></td></tr></table></figure></li><li><p>设置永久挂载（重启后任然生效）</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line">添加</span><br><span class="line">/dev/sdb1/home/newdiskext4defaults0 0</span><br></pre></td></tr></table></figure></li></ol><h3 id="磁盘情况查询"><a href="#磁盘情况查询" class="headerlink" title="磁盘情况查询"></a>磁盘情况查询</h3><h4 id="查询系统磁盘使用情况"><a href="#查询系统磁盘使用情况" class="headerlink" title="查询系统磁盘使用情况"></a>查询系统磁盘使用情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br><span class="line">df -l</span><br></pre></td></tr></table></figure><h4 id="查询指定目录的磁盘占用情况"><a href="#查询指定目录的磁盘占用情况" class="headerlink" title="查询指定目录的磁盘占用情况"></a>查询指定目录的磁盘占用情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认当前目录</span></span><br><span class="line">du -ach /目录</span><br><span class="line">-s 指定目录占用大小汇总</span><br><span class="line">-h带计量单位</span><br><span class="line">-a含文件</span><br><span class="line">--max-depth=1子目录深度</span><br><span class="line">-c汇总值</span><br></pre></td></tr></table></figure><h4 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h4><ol><li><p>统计/home 文件夹下文件个数</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /home | grep &quot;^-&quot; | wc -l</span><br></pre></td></tr></table></figure></li><li><p>统计/home 文件夹下目录个数</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /home | grep &quot;^d&quot; | wc -l</span><br></pre></td></tr></table></figure></li><li><p>统计/home 文件夹下文件个数，包括子文件</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lR /home | grep &quot;^-&quot; | wc -l</span><br></pre></td></tr></table></figure></li><li><p>统计/home 文件夹下目录个数，包括文件夹里的</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lR /home | grep &quot;^d&quot; | wc -l</span><br></pre></td></tr></table></figure></li><li><p>以树状显示目录结构</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br></pre></td></tr></table></figure></li></ol><h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><h4 id="查看虚拟网络IP和网关"><a href="#查看虚拟网络IP和网关" class="headerlink" title="查看虚拟网络IP和网关"></a>查看虚拟网络IP和网关</h4><p>VMware 编辑-&gt; 虚拟网络编辑器</p><p>为防止IP每次登录动态分配，设置静态IP</p><p>修改配置文件来指定IP，并可连接到外网</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">eth0 代表第一块网卡，eth1代表第二块</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure><h3 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h3><h4 id="显示系统执行的进程"><a href="#显示系统执行的进程" class="headerlink" title="显示系统执行的进程"></a>显示系统执行的进程</h4><blockquote><p>ps命令是用来查看目前系统中，有哪些正在执行，以及他们执行的情况，可不加任何参数。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">| grep nginx 过滤查询进程信息</span></span><br><span class="line">ps -aux | grep nginx</span><br><span class="line">-a显示当前终端的所有进程信息</span><br><span class="line">-u以用户的格式显示进程信息</span><br><span class="line">-x显示后台进程运行的参数</span><br><span class="line">-e显示所有进程。</span><br><span class="line">-f全格式</span><br></pre></td></tr></table></figure><table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>PID</td><td>进程识别号</td></tr><tr><td>TTY</td><td>终端机号</td></tr><tr><td>TIME</td><td>此进程所消CPU时间</td></tr><tr><td>CMD</td><td>正在执行的命令或进程号</td></tr><tr><td>TT</td><td>终端名称</td></tr><tr><td>STAT</td><td>S-睡眠，s-先导进程，N-优先级低，R-正在运行，D-短期等待，Z-僵死进程，T-被跟踪或者停止</td></tr><tr><td>CPU</td><td>cpu 进程占用</td></tr><tr><td>RSS</td><td>物理内存占用</td></tr><tr><td>VSZ</td><td>虚拟内存占用大小</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230508152858498.png" alt="image-20230508152858498"></p><h4 id="查询某进程父进程"><a href="#查询某进程父进程" class="headerlink" title="查询某进程父进程"></a>查询某进程父进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用户进程<span class="built_in">id</span>  父进程<span class="built_in">id</span></span></span><br><span class="line">root       1602   1569  0 12:13 ?        00:00:00 nginx: master process nginx -g daemon off;</span><br><span class="line">101        1690   1602  0 12:13 ?        00:00:00 nginx: worker process</span><br><span class="line">root      40487   2197  0 15:43 pts/0    00:00:00 grep --color=auto nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="终止进程"><a href="#终止进程" class="headerlink" title="终止进程"></a>终止进程</h4><p>基本语法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过进程号杀死进程</span></span><br><span class="line">kill  [选项] 进程号</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过进程名杀死进程，支持通配符</span></span><br><span class="line">killall 进程名字</span><br><span class="line">-9：强迫进程立即停止</span><br></pre></td></tr></table></figure><p><strong>实践案例</strong></p><ol><li><p>踢掉某个非法登录用户</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep sshd</span><br><span class="line">kill xxx_id(第二列参数)</span><br></pre></td></tr></table></figure></li><li><p>终止远程登录服务sshd,在适当时候重启sshd服务</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep sshd</span><br><span class="line">kill xxx_id(第二列参数)</span><br></pre></td></tr></table></figure></li><li><p>终止多个gedit编辑器</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall gedit</span><br></pre></td></tr></table></figure></li><li><p>强制杀掉一个终端</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 gedit</span><br></pre></td></tr></table></figure></li><li><p>查看进程树</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br><span class="line">-p: 显示进程PID</span><br><span class="line">-u: 显示进程的所属用户</span><br></pre></td></tr></table></figure></li></ol><h4 id="查看CPU、内存和硬盘详细信息"><a href="#查看CPU、内存和硬盘详细信息" class="headerlink" title="查看CPU、内存和硬盘详细信息"></a>查看CPU、内存和硬盘详细信息</h4><blockquote><p><a href="https://blog.csdn.net/lishiyu93/article/details/120951677">参考链接</a></p></blockquote><h3 id="服务管理"><a href="#服务管理" class="headerlink" title="服务管理"></a>服务管理</h3><blockquote><p>服务本质就是进程，但是运行在后台的，通常都会监听某个端口，等待其他程序知识。比如 mysql,sshd防火墙等，又称为守护进程，是Linux中非常重要的知识点。</p></blockquote><h4 id="管理指令"><a href="#管理指令" class="headerlink" title="管理指令"></a>管理指令</h4><blockquote><p>service/systemctl 命令设置后立马生效，但是重启后修改会重置。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service 服务名 start| stop | restart | reload | status</span><br><span class="line">systemctl （&gt;=7.0）</span><br></pre></td></tr></table></figure><h4 id="查看关闭重启防火墙情况"><a href="#查看关闭重启防火墙情况" class="headerlink" title="查看关闭重启防火墙情况"></a>查看关闭重启防火墙情况</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><p>1.查看防火墙此时运行状态。方式有两种具体如下:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# firewall-cmd --state</span><br><span class="line">[root@localhost student]# systemctl status firewalld</span><br></pre></td></tr></table></figure><p>2.查看防火墙是否开机自启。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# systemctl is-enabled</span><br></pre></td></tr></table></figure><p>3.查看接口区域，这里以ens33为例。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# firewall-cmd --get-zone-of-interface=ens33</span><br><span class="line">public</span><br></pre></td></tr></table></figure><p>4.查看绑定区域的接口。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# firewall-cmd --get-active-zones</span><br><span class="line">docker</span><br><span class="line">  interfaces: docker0</span><br><span class="line">public</span><br><span class="line">  interfaces: ens33</span><br></pre></td></tr></table></figure><p>5.查看所有开放端口。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@zq-virtual-machine:/home/zq# netstat -aptn</span><br></pre></td></tr></table></figure><p>2.1 开启防火墙</p><p>1.执行<strong>systemctl start firewalld.service</strong>命令开启防火墙，默认是开启的。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# systemctl start firewalld.service</span><br></pre></td></tr></table></figure><p>2.2 关闭防火墙</p><p>1.执行<strong>systemctl stop firewalld.service</strong>命令关闭防火墙。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure><p>2.3 重启防火墙</p><p>1.执行<strong>systemctl restart firewalld.service</strong>命令重启防火墙。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure><p>2.4 开机自启防火墙</p><p>1.执行<strong>systemctl enable firewalld.service</strong>命令设置防火墙开机自启。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable firewalld.service</span><br></pre></td></tr></table></figure><h4 id="打开端口-服务"><a href="#打开端口-服务" class="headerlink" title="打开端口/服务"></a>打开端口/服务</h4><p><strong>3.1 打开端口</strong></p><p><strong>临时打开端口</strong></p><p>1.执行<strong>firewall-cmd –zone=public –add-port=80/tcp</strong>命令打开80/tcp。这里需要注意，这是临时的打开端口，重启后无效。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# firewall-cmd --zone=public --add-port=80/tcp</span><br></pre></td></tr></table></figure><p>2.执行<strong>systemctl restart firewalld.service</strong>命令重启防火墙。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost student]# systemctl restart firewalld.service</span><br></pre></td></tr></table></figure><p><strong>注意:当开放端口设置完成后必须要重启，否则不生效！！！</strong></p><p><strong>永久打开端口</strong></p><p>1.执行<strong>firewall-cmd –permanent –zone=public –add-port=80/tcp</strong>命令永久打开80/tcp。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-port=80/tcp</span><br></pre></td></tr></table></figure><p>2.执行<strong>systemctl restart firewalld.service</strong>命令重启防火墙。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure><p><strong>注意:当开放端口设置完成后必须要重启，否则不生效！！！</strong></p><p><strong>3.2 打开服务</strong></p><p><strong>临时打开服务</strong></p><p>1.执行<strong>firewall-cmd –zone=public –add-service=http</strong>命令公共区域中临时打开服务HTTP。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-service=http</span><br></pre></td></tr></table></figure><p><strong>永久打开服务</strong></p><p>1.执行<strong>firewall-cmd –permanent –zone=public –add-service=http</strong>命令公共区域中临时打开服务HTTP。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-service=http </span><br></pre></td></tr></table></figure><h4 id="查看系统服务"><a href="#查看系统服务" class="headerlink" title="查看系统服务"></a>查看系统服务</h4><p>方式1：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&lt;7</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统服务</span></span><br><span class="line">setup</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&gt;=7</span></span><br><span class="line">nmtui</span><br></pre></td></tr></table></figure><p>方式2：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;7</span></span><br><span class="line">ls -l /etc/init.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&gt;=7</span></span><br><span class="line">ls -l /usr/lib/systemd/</span><br></pre></td></tr></table></figure><h4 id="进程监控"><a href="#进程监控" class="headerlink" title="进程监控"></a>进程监控</h4><blockquote><p>top 命令，与ps相似，不同的是top会隔一段时间跟新正在运行的进程</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">top [选项]</span><br><span class="line">-d指定几秒后更新，默认3s</span><br><span class="line">-i使top 不显示任何闲置或者僵死进程</span><br><span class="line">-p通过指定监控进程ID来仅仅监控某个进程的状态</span><br></pre></td></tr></table></figure><p>快捷键</p><table><thead><tr><th>操作</th><th>功能</th></tr></thead><tbody><tr><td>P</td><td>以CPU使用率排序，默认值</td></tr><tr><td>M</td><td>以内存使用率排序</td></tr><tr><td>N</td><td>以PID排序</td></tr><tr><td>q</td><td>退出</td></tr></tbody></table><p><strong>终止指定索引</strong></p><p>top指令后，输入k,回车，在输入要结束的进程ID号</p><h4 id="监控网络状态"><a href="#监控网络状态" class="headerlink" title="监控网络状态"></a>监控网络状态</h4><p>查看系统网络情况 netstat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">基本用法</span></span><br><span class="line">netstat [选项]</span><br><span class="line"></span><br><span class="line">-an 按一定顺序排列输出</span><br><span class="line">-p显示哪个进程在调用</span><br></pre></td></tr></table></figure><p>查看服务名为 sshd 的服务信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp | grep sshd</span><br></pre></td></tr></table></figure><h4 id="chkconfig-指令"><a href="#chkconfig-指令" class="headerlink" title="chkconfig 指令"></a>chkconfig 指令</h4><blockquote><p>通过 chkconfig  命令可以给每个服务器各运行级别设置自启动/关闭</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务</span></span><br><span class="line">chkconfig 服务名 --list|grep xxx</span><br><span class="line"></span><br><span class="line">chkconfig 服务名 --list</span><br><span class="line"></span><br><span class="line">chkconfig --level 5 服务名 on/off</span><br></pre></td></tr></table></figure><h3 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h3><p>RPM和YUM</p><p>rpm包的管理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询已安装包 XX</span></span><br><span class="line">rpm -qa|grep xx</span><br></pre></td></tr></table></figure><p>一个rpm包名: firefox-45.0.1-1.el6.centos.x86_64.rpm</p><p>名称:firefox版本号: 45.0.1-1</p><p>适用操作系统: el6.centos</p><p>.x86 64表示centos6.x的64位系统。如果是i686、i386表示32位系统，noarch表示通用。</p><h4 id="rpm-包管理的其他查询命令"><a href="#rpm-包管理的其他查询命令" class="headerlink" title="rpm 包管理的其他查询命令"></a>rpm 包管理的其他查询命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rpm-qa :查询所安装的所有rpm软件包</span><br><span class="line"></span><br><span class="line">rpm -ql软件包名：查询软件包中文件</span><br><span class="line"></span><br><span class="line">rpm -qf 文件全路径名：查询文件所属软件包</span><br><span class="line"></span><br><span class="line">rpm -q 软件包名：查询软件包是否安装</span><br><span class="line"></span><br><span class="line">rpm -qi 软件包名：查询软件包信息</span><br></pre></td></tr></table></figure><h4 id="yum-包管理"><a href="#yum-包管理" class="headerlink" title="yum 包管理"></a>yum 包管理</h4><blockquote><p>Yum 是一个 shell 前端软件包管理器。基于 RPM 包管理，能够从指定的服务器自动下载 RPM 包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看yum仓库中所有可以安装的rpm包</span></span><br><span class="line">yum list|grep &#x27;^zip&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据命令查找该命令属于哪个安装包，最好写命令的绝对路径，如果不知道绝对路径可以在命令前用*匹配</span></span><br><span class="line">yum provides 命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum 本地安装</span></span><br><span class="line">yum localinstall -y 包名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum 源安装</span></span><br><span class="line">yum install -y 软件名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">网络安装</span></span><br><span class="line">yum install -y 网址</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新安装该软件，可以用来恢复之前误删除该服务的重要文件，但是恢复的是最初始的配置</span></span><br><span class="line">yum reinstall -y 包名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前系统中，有哪些软件可以进行更新</span></span><br><span class="line">yum check-update</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加软件名就是更新指定的软件包，不加软件名就是更新该系统中全部可以更新的软件<span class="string">&#x27;(不加软件名的更新很危险，它会将你的内核更新到最新版本，会导致很多命令不同，有些服务可能会失效)&#x27;</span></span></span><br><span class="line">yum update -y [软件名]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载指定的软件</span></span><br><span class="line">yum erase -y 软件名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载指定的软件</span></span><br><span class="line">yum remove -y 软件名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除所有的缓存，也可以清除默认路径下yum下载的包</span></span><br><span class="line">yum clean all(Packages)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统中还有哪些组可以安装</span></span><br><span class="line">yum group list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装包组</span></span><br><span class="line">yum groups install 包组名字</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">：卸载包组</span> </span><br><span class="line">yum groups remove 包组名字</span><br></pre></td></tr></table></figure><p>包的默认yum下载的路径：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.conf </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">cachedir=/var/cache/yum/$basearch/$releasever</span><br><span class="line">keepcache=0</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将keepcache改成1就可以吧rpm包下载到本地</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可以用选项来下载rpm包到本地：</span></span><br><span class="line">--downloadonly：仅下载，不安装</span><br><span class="line">--downloaddir：指定下载的目录</span><br></pre></td></tr></table></figure><h3 id="Linux-安装JDK"><a href="#Linux-安装JDK" class="headerlink" title="Linux 安装JDK"></a>Linux 安装JDK</h3><blockquote><p>上传解压到 /usr/java/jdk1.8_131。 配置环境变量 </p></blockquote><p>/etc/profile</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># jdk</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">JAVA_HOME</span>=<span class="regexp">/usr/</span>java/jdk1<span class="number">.8</span><span class="number">.0_281</span></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">JRE_HOME</span>=$&#123;<span class="variable constant_">JAVA_HOME</span>&#125;/jre</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">CLASSPATH</span>=.:$&#123;<span class="variable constant_">JAVA_HOME</span>&#125;/<span class="attr">lib</span>:$&#123;<span class="variable constant_">JRE_HOME</span>&#125;/lib</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">PATH</span>=$&#123;<span class="variable constant_">JAVA_HOME</span>&#125;/<span class="attr">bin</span>:$PATH</span><br><span class="line"></span><br><span class="line"># nodejs</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">NODE_PATH</span>=<span class="regexp">/home/</span>jysp/workspace/node-v16<span class="number">.17</span><span class="number">.0</span>/lib/node_modules</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置完成需要注销重新登录</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;linux 由 unix 演化而来&lt;/p&gt;
&lt;p&gt;基于Linux 开源的内核，不同厂商开发出了不同名称的系统: 如 Redhat,CentOSE, Ubuntu,Suse,红旗等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;虚拟机的网络连接形式&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;桥连接&lt;/p&gt;
&lt;p&gt;  Linux 可以和其他的通信，但是可能造成IP冲突&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;NAT&lt;/p&gt;
&lt;p&gt;  网络地址转换方式，linux 可以访问外网，不会造成IP冲突&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;主机模式&lt;/p&gt;
&lt;p&gt;  你的Linux是一个独立的主机，不能访问外网&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Vmtools&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;此工具可以让 centOS 与主机共享文件，剪切板&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>shell 脚本</title>
    <link href="https://wyf195075595.github.io/2023/04/23/programming/linux/shell/"/>
    <id>https://wyf195075595.github.io/2023/04/23/programming/linux/shell/</id>
    <published>2023-04-23T07:23:10.000Z</published>
    <updated>2023-05-08T03:27:48.887Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>shell 脚本开头的两个字符叫做 shebang “#!”。在unix系统中，程序会分析 shebang 后面内容，作为解析器的指令。相当于告诉系统用那种解析器去解读脚本。yarn 就是python 开发的</p></blockquote><ul><li>以 #!/bin/sh 开头的文件，程序在执行的时候会调用 /bin/sh，也就是bash解释器</li><li>以 #!/usr/bin/python 开头的文件，代表指定python解释器去执行</li><li>以 #!/usr/bin/env 解释器名称，是一种在不同平台上都能正确找到解释器的办法</li></ul><span id="more"></span><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><h4 id="新建一个shell脚本-test-sh"><a href="#新建一个shell脚本-test-sh" class="headerlink" title="新建一个shell脚本, test.sh"></a>新建一个shell脚本, test.sh</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">echo &#x27;我是一行shell 脚本文件&#x27;</span><br></pre></td></tr></table></figure><h4 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">test.sh # 找不到目录</span><br><span class="line"></span><br><span class="line">./test.sh # 权限不够</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加权限,就可以运行上边代码</span></span><br><span class="line">chmod +x hello.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定解析器运行</span></span><br><span class="line">/bin/sh ./test.sh</span><br><span class="line"></span><br><span class="line">. ./test.sh # . 等于 source </span><br><span class="line">source ./test.sh</span><br></pre></td></tr></table></figure><h4 id="查看当前解析器"><a href="#查看当前解析器" class="headerlink" title="查看当前解析器"></a>查看当前解析器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><h3 id="脚本注释"><a href="#脚本注释" class="headerlink" title="脚本注释"></a>脚本注释</h3><blockquote><p>为了方便阅读，要有写注释的习惯。</p><p>当行注释： #</p></blockquote><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><p>history </p><p>  查看历史命名，echo $HISTSIZE 命令历史条数</p><p>  打开会话历史文件 ~/.bash_history</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">history #命令以及参数</span><br><span class="line">-c:清空内存中命令历史;</span><br><span class="line">-r:从文件中恢复历史命令</span><br><span class="line">数字 :显示最近n条命令 history 10</span><br><span class="line"></span><br><span class="line">执行指定历史命令 !id：!502</span><br><span class="line">执行上一条命令： !!</span><br></pre></td></tr></table></figure></li><li><p>echo</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-n 不换行输出</span><br><span class="line">-e 解析字符串特殊符号</span><br><span class="line"></span><br><span class="line">\r 回车</span><br><span class="line">\t 制表</span><br><span class="line">\n 换行</span><br><span class="line">\b 退格</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>eval</p><p>  执行多个命令</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval ls; cd /tmp</span><br></pre></td></tr></table></figure></li><li><p>exec</p><p>  不创建子进程，执行后续命令，执行完毕自动 exit</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec date</span><br></pre></td></tr></table></figure></li><li><p>export</p></li><li><p>read</p></li><li><p>shift</p></li></ul><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ctrl + l # 清屏</span><br><span class="line">ctrl + a # 把光标移动到命令行开头 </span><br><span class="line">ctrl + e # 把光标移动到命令行结尾</span><br><span class="line">ctrl + u # 删除或剪切光标之前的命令</span><br><span class="line">ctrl + k # 删除或剪贴光标之后的内容</span><br><span class="line">ctrl + R # 搜索历史 </span><br><span class="line">ctrl + S # 暂停屏幕输出</span><br><span class="line">ctrl + D # 退出当前终端</span><br><span class="line">tab 补全</span><br></pre></td></tr></table></figure><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><blockquote><p>临时存放，shell 进程是一个作用域，弱类型跟js一样。</p><p>变量与赋值之间不能空格</p><p>单引号不识别特殊语法，双引号识别</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=&#x27;aaa&#x27;</span><br><span class="line"></span><br><span class="line">echo $name</span><br></pre></td></tr></table></figure><h4 id="特殊变量"><a href="#特殊变量" class="headerlink" title="特殊变量"></a>特殊变量</h4><blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">0  获取she11脚本文件名，以及脚本路</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">n  获取shel1脚本的第n个参数,n在1~9之间，如<span class="variable">$1</span>,<span class="variable">$2</span>，..<span class="variable">$9</span> ，大于9则需要写，<span class="variable">$10</span>，参数空格隔开</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="comment">#  获取执行的she11脚本后面的参数总个数</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">*  获取shel1脚本所有参数，不加引号等同于<span class="variable">$@</span>作用，加上引号<span class="string">&quot;$*&quot;</span>作用是 接收所有参数为单个字符串<span class="string">&quot;<span class="variable">$1</span> <span class="variable">$2</span>...</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">@  不加引号，效果同上，加引号，是接收所有参数为独立字符串，如”<span class="variable">$1</span>”“<span class="variable">$2</span>” “<span class="variable">$3</span>”...，空格保留</span></span></span><br></pre></td></tr></table></figure><p><em><em>$@ 与 $</em> 的区别</em>*</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &quot;print each param fromfor var in \&quot;\$*\&quot;&quot;</span><br><span class="line">for var in &quot;$*&quot;</span><br><span class="line">do</span><br><span class="line">echo &quot;$var&quot; # 输出一行</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;print each param fromfor var in \&quot;\$@\&quot;&quot;</span><br><span class="line">for var in &quot;$@&quot;</span><br><span class="line">do</span><br><span class="line">echo &quot;$var&quot; # 输出多行</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h4 id="特殊状态变量"><a href="#特殊状态变量" class="headerlink" title="特殊状态变量"></a>特殊状态变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">? 上一次命令执行状态返回值，0正确，非0失败</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">$ 当前she11脚本的进程号</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">! 上一次后台进程的PID</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">_ 上次之前执行的命令，最后一个参数</span></span><br></pre></td></tr></table></figure><p><strong>source 是在当前shell环境加载脚本，因此保留当前变量。bash都会开启一个子shell,不会保留当前shell变量</strong></p><p><strong>脚本控制返回值玩法</strong></p><p>test.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$#</span>获取参数个数-ne 不等于的情况 &amp;&amp; 并且</span></span><br><span class="line"><span class="meta prompt_">[$</span><span class="language-bash"><span class="comment"># -ne 2] &amp;&amp; &#123;</span></span></span><br><span class="line">echo &quot;must be two args&#x27;</span><br><span class="line">exit 119 #终止程序运行，且返回119状态码，提供给当前shelL的S?变量，若是在函数里 可以return 119用法</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出当前进程pid</span></span><br><span class="line">echo $$</span><br><span class="line"></span><br><span class="line">echo ok</span><br></pre></td></tr></table></figure><p>执行完上边脚本，$? 会保存 119</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时会提示 must be two args</span></span><br><span class="line">bash test.sh params1 params2 params3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">119</span></span><br><span class="line">echao $?</span><br></pre></td></tr></table></figure><p><strong>让程序后台执行</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台执行 ping baidu.com 并将日志输出到黑洞文件中.命令产生一个pid</span></span><br><span class="line">nohup ping baidu.com &amp; 1&gt; /dev/null</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出前面pid</span></span><br><span class="line">echo $!</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><blockquote><p>个人变量优先于全局</p><p>用户个人配置文件 ~/.bash_profile</p><p>远程用户特有文件 ~/.bashrc</p><p>全局配置文件  /etc/profile, /etc/bashrc. 系统建议不要直接修改主文件而是创建 /etc/profile.d/</p></blockquote><p>set : 检索变量 name开头</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set |grep ^name</span><br></pre></td></tr></table></figure><p>env : 只显示全局变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env |wc -l # 显示输出条数</span><br></pre></td></tr></table></figure><p>declare: 输出所有的变量，如同set</p><p>export: 显示和设置环境变量值</p><p>unset 变量名: 撤销环境变量</p><p>readonly：只有shell结束，只读便变量失效。只对当前shell生效</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230424102750297.png" alt="image-20230424102750297"></p><h4 id="子串玩法"><a href="#子串玩法" class="headerlink" title="子串玩法"></a>子串玩法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&#123;变量)返回变量值</span><br><span class="line">$&#123;#变量)返回变量长度，字符长度</span><br><span class="line">$&#123;变量:start&#125;返回变量start数值之后的字符</span><br><span class="line">$&#123;变量:start:length&#125;提取start之后的length限制的字符</span><br><span class="line">$&#123;变量#word&#125;从变量开头删除最短匹配的word子串</span><br><span class="line">$&#123;变量##word)从变量开头，删除最长匹配的word</span><br><span class="line">$&#123;变量%word&#125;从变量结尾删除最短的word</span><br><span class="line">$&#123;变量%%word&#125;从变量结尾开始删除最长匹配的word</span><br><span class="line">$&#123;变量/pattern/string&#125;用string代替第一个匹配的pattern</span><br><span class="line">$&#123;变量//pattern/string&#125;用string代替所有的pattern</span><br></pre></td></tr></table></figure><p>统计字符串长度的其他方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">expr length &quot;$&#123;name&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回行数</span></span><br><span class="line">cat test.txt| wc -l</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回最长行数的字符数量</span></span><br><span class="line">cat test.txt| wc -L</span><br><span class="line"></span><br><span class="line">echo &quot;$&#123;name&#125;&quot; | awk &#x27;&#123;print length($0)&#125;&#x27;</span><br></pre></td></tr></table></figure><p>子串拓展</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果parameter变量值为空，返回word字符串$&#123;parameter:-word&#125;</span><br><span class="line"></span><br><span class="line">如果para变量为空，则word替代变量值，且返回其值$&#123;parameter:=word&#125;</span><br><span class="line"></span><br><span class="line">如果para变量为空，word当作stderr输出，否则输出变量值用于设置变量为空导致错误时，返回的错误信息$&#123;parameter:?word&#125;</span><br><span class="line"></span><br><span class="line">如果para变量为空，什么都不做，否则word返回$&#123;parameter:+word&#125;</span><br></pre></td></tr></table></figure><p>删除7天以上的过期数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find xargs 搜索，且删除</span><br><span class="line"></span><br><span class="line">find 需要搜索的目录-name 你要搜索的文件名字-type 文件类型-mtime +7 xargs rm -f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除指定目录，超过7天的.tar.gz 压缩包</span> </span><br><span class="line">find $&#123;dir_path:=/data/mysql_back_data/&#125; -name &#x27;*.tar.gz&#x27; -type f -mtime +7 xargs rm </span><br></pre></td></tr></table></figure><h4 id="linux-特殊符号"><a href="#linux-特殊符号" class="headerlink" title="linux 特殊符号"></a>linux 特殊符号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;vars&#125;取出变量结果</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">()再括号中执行命令，且拿到命令的执行结果</span></span><br><span class="line">``再括号中执行命令，且拿到命令的执行结果</span><br><span class="line">()开启子she11执行命令结果</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">vars取出变量结果</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="父子shell"><a href="#父子shell" class="headerlink" title="父子shell"></a>父子shell</h3><blockquote><p>开启子shell去做其他事情不会耽误我去做其他事情，类似于于多进程</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230424143608565.png" alt="image-20230424143608565"></p><blockquote><p>-</p><ol><li>source和点执行脚本，只在当前的shell环境中执行生效</li><li>指定bash sh解释器运行脚本，是开启subshell ,开启shell运行脚本命令</li><li>./script,都会指定shebang, 通过解释器运行，也是开启subshell 运行命令</li></ol></blockquote><h4 id="父子-shell-查看方式"><a href="#父子-shell-查看方式" class="headerlink" title="父子 shell 查看方式"></a>父子 shell 查看方式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 sshd 项</span></span><br><span class="line"></span><br><span class="line">ps -ef --forest</span><br></pre></td></tr></table></figure><h4 id="创建进程列表"><a href="#创建进程列表" class="headerlink" title="创建进程列表"></a>创建进程列表</h4><blockquote><p>使用小括号</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(cd ~; pwd;ls; cd /tmp/; pwd; ls)</span><br></pre></td></tr></table></figure><h4 id="判断父子shell"><a href="#判断父子shell" class="headerlink" title="判断父子shell"></a>判断父子shell</h4><blockquote><p>通过内置变量 $BASH_SUBSHELL, 值为0 则是当前shell,否者就是可开启了子shell</p></blockquote><h3 id="内置命令，外置命令"><a href="#内置命令，外置命令" class="headerlink" title="内置命令，外置命令"></a>内置命令，外置命令</h3><blockquote><p>内置命令：在系统启动时就在载入内存，常驻内存，执行效率高但是占用资源。如 cd,</p><p>外置命令：用户需要从硬盘中读取，在写入内存加载.如 nginx</p></blockquote><p>判断命令是否内置，外置命令</p><ul><li>通过Linux的 【type 命令 】验证（输出此命令是shell内嵌），不会开启子进程</li><li>外置命令执行肯定会开启子进程</li><li>查询所有内置命令：compgen -b</li></ul><h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for n in &#123;1..100&#125;</span><br><span class="line">do</span><br><span class="line">echo $n</span><br><span class="line">done</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计循环时间</span></span><br><span class="line">time for n in &#123;1..10000&#125;</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">生成1-100数字中间用 change分割的字符串</span></span><br><span class="line">  char= `seq -s &quot;change&quot; 100`</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">输出打印到黑洞文件，不在控制台打印</span></span><br><span class="line">  echo $&#123;#char&#125; &amp;&gt;/dev/null</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结果</span></span><br><span class="line">real    0m43.783s实际时间</span><br><span class="line">user    0m8.716s用户时间</span><br><span class="line">sys     0m32.445s内核时间</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>批量修改文件名</p><p>将所欲后缀 _finished.jpg 图片名称去除 _finished</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找出所有图片名包含 xxx_finished.jpg</span></span><br><span class="line">ls *fin*.jpg</span><br><span class="line"></span><br><span class="line">for file in `ls *fin*.jpg`</span><br><span class="line">do</span><br><span class="line">mv $file `echo $&#123;file//_finished/&#125;`</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="数值运算"><a href="#数值运算" class="headerlink" title="数值运算"></a>数值运算</h3><blockquote><p>linux 大多运算不持支小数。 大多数运算符与js,java 类似</p></blockquote><h4 id="双小括号"><a href="#双小括号" class="headerlink" title="双小括号"></a>双小括号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这总反式不能取值</span></span><br><span class="line">((i + 1))</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以取值</span></span><br><span class="line">echo $((i + 1))</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2的3次方</span></span><br><span class="line">((2**3))</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算 1-10 相加</span></span><br><span class="line">echo $((`seq -s + 10`))</span><br></pre></td></tr></table></figure><p>比较运算中 真为1 ，假为0</p><p><strong>运算脚本</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">print_usage()&#123;</span><br><span class="line">  printf &quot;请输入一个数字\n&quot;</span><br><span class="line">  exit 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">接收用户输入</span></span><br><span class="line"></span><br><span class="line">read -p &quot;请输入数字：&quot; firstnum</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-n 判断字符串是否为空，空-不成立，反之-成立</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sed 作用，将 输入的值，把所有数字替换为空，剩下的就是非数字</span></span><br><span class="line">if [ -n &quot;`echo $firstnum|sed &#x27;s/[0-9]//g&#x27;`&quot; ]</span><br><span class="line">  then</span><br><span class="line">    print_usage</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">read -p &quot;输入 运算符&quot; operator</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">限制在 +-*/</span></span><br><span class="line"></span><br><span class="line">if [ -n &quot;`echo $operator|sed &#x27;s/[+-\*\/]//g&#x27;`&quot; ]</span><br><span class="line">  then</span><br><span class="line">    echo &#x27;只允许输入 +,-,*,/&#x27;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入第二个数字</span></span><br><span class="line">read -p &quot;请输入数字：&quot; secondnum</span><br><span class="line">if [ -n &quot;`echo $secondnum|sed &#x27;s/[0-9]//g&#x27;`&quot; ]</span><br><span class="line">  then</span><br><span class="line">    print_usage</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最后计算</span></span><br><span class="line"></span><br><span class="line">echo &#x27;运算结果是：&#x27;$(($&#123;firstnum&#125;$&#123;operator&#125;$&#123;secondnum&#125;))</span><br></pre></td></tr></table></figure><h4 id="let-命令"><a href="#let-命令" class="headerlink" title="let 命令"></a>let 命令</h4><blockquote><p>let 命令等同于双括号计算，((赋值表达式))。但是双括号效率更高</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rs=5</span><br><span class="line"></span><br><span class="line">let rs=rs*2</span><br><span class="line"></span><br><span class="line">echo $rs # 10</span><br></pre></td></tr></table></figure><h3 id="expr-命令"><a href="#expr-命令" class="headerlink" title="expr 命令"></a>expr 命令</h3><blockquote><p>expr 命令允许在命令处理数学表达式。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">expr 1 + 1</span><br><span class="line">expr 1 - 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要转义字符</span></span><br><span class="line">expr 1 \* 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分母大于分子则结果为0</span></span><br><span class="line">expr 1 / 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算 1-10 相加</span></span><br><span class="line">expr `seq -s &#x27; + &#x27; 10`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">xargs 管道命令</span></span><br><span class="line">seq -s &#x27; + &#x27; 10| xargs expr</span><br></pre></td></tr></table></figure><p><strong>模式匹配</strong></p><ol><li>:， 计算字符串中的字符数</li><li>.*，任意字符串重复0次或多次</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">expr yc.jpg &quot;:&quot; &quot;.*&quot; # 6</span><br><span class="line"></span><br><span class="line">expr yc.jpg234 &quot;:&quot; &quot;.*\.jpg&quot; # 6</span><br><span class="line"></span><br><span class="line">expr yc.jpeg234 &quot;:&quot; &quot;.*\.jpg&quot; # 0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>应用</strong></p><blockquote><p>通过是否匹配的上来判断文件格式，返回长度0 不能匹配，长度&gt;0匹配</p></blockquote><h3 id="bc-管道命令"><a href="#bc-管道命令" class="headerlink" title="bc 管道命令"></a>bc 管道命令</h3><blockquote><p>整数计算，双小括号，let,expr。带小数计算使用 bc</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo 4*4|bc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算 1-10 相加</span></span><br><span class="line">echo &#123;1..10&#125;|tr &quot; &quot; &quot;+&quot; |bc</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="中括号运算"><a href="#中括号运算" class="headerlink" title="中括号运算[]"></a>中括号运算[]</h3><blockquote><p>$[表达式]语法如此，加减乘除</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rs=10</span><br><span class="line">rs=$[rs+8]</span><br><span class="line">echo $rs # 18</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="awk计算"><a href="#awk计算" class="headerlink" title="awk计算"></a>awk计算</h3><blockquote><p>支持小数，if 条件判断</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;3.2 3.2&quot; | awk &#x27;&#123;print ($1+4*$2)&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="用户输入"><a href="#用户输入" class="headerlink" title="用户输入"></a>用户输入</h3><blockquote><p>read 内置命令</p><p>-p    设置提示信息</p><p>-t    等待用户输入超时, timeout</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">read -p &quot;给你5s中，时间输入密码：&quot; pwd</span><br><span class="line">echo $pwd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入多个变量时，注意空格</span></span><br><span class="line">read -p &quot;请输入账户和密码&quot; zh mm</span><br><span class="line">echo $zh $mm</span><br></pre></td></tr></table></figure><h3 id="if-then-语句"><a href="#if-then-语句" class="headerlink" title="if-then 语句"></a>if-then 语句</h3><blockquote><p>编程语言中 if 条件语句要求 结果是 false,true.而shell中并不是，bash 的if 语句会直接运行后边的命令，如果其执行正确则进入 then 否则不进入</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if command</span><br><span class="line">then</span><br><span class="line">command</span><br><span class="line">fi</span><br><span class="line">--------</span><br><span class="line">if pwd</span><br><span class="line">then</span><br><span class="line">echo &#x27;i am ok&#x27;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="if-then-else-语句"><a href="#if-then-else-语句" class="headerlink" title="if-then-else 语句"></a>if-then-else 语句</h3><blockquote><p>增加了一个判断条件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if command</span><br><span class="line">then</span><br><span class="line">command</span><br><span class="line">else</span><br><span class="line">command</span><br><span class="line">fi</span><br><span class="line">------------------</span><br><span class="line"> if [ 1 -eq 1 ]</span><br><span class="line"> then</span><br><span class="line"> echo ok</span><br><span class="line"> else</span><br><span class="line"> echo nono</span><br><span class="line"> fi</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="elif"><a href="#elif" class="headerlink" title="elif"></a>elif</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if command</span><br><span class="line">then</span><br><span class="line">command</span><br><span class="line">elif command</span><br><span class="line">then</span><br><span class="line">command</span><br><span class="line">else</span><br><span class="line">command</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><blockquote><p>用于评估一个表达式；如果条件为真，则返回一个0， 非0则为假。判断结果通过 $? 访问</p></blockquote><ol><li><p>文件类型侦测</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test -e filename</span><br></pre></td></tr></table></figure><p> -e 该文件名] 是否存在?(常用)</p><p> -f 该文件名是否为文件(file)?(常用)</p><p> -d 该文件名 是否为目录(directory)? (常用)</p><p> -b 该文件名是否为一个 block device 装置?</p><p> -c 该[文件名是否为一个 character device 装置?</p><p> -s 该文件名是否为一个 Socket 文件?</p><p> -p 该文件名是否为一个 FIFO (pipe) 文件?</p><p> -L 该文件名是否为一个连结档?</p></li><li><p>文件权限侦测</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test -r filename</span><br></pre></td></tr></table></figure><p> -r 侦测该文件名是否具有可读。的属性?</p><p> -w 侦测该文件名是否具有可写。的属性?</p><p> -x 侦测该文件名是否具有 可执行， 的属性?</p><p> -u 测该文件名是否具有 SUID 的属性?</p><p> -g 侦测该文件名是否具有 SGID 的属性?</p><p> -k 侦测该文件名是否具有 sticky bit 的属性?</p><p> -s 测该文件名是否为非空白文件。?</p></li><li><p>两个文件之间比较</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test file -nt file2</span><br></pre></td></tr></table></figure><p> -nt (newer than)判断 file1 是否比 file2 新</p><p> -ot (older than)判断 file1 是否比 file2 旧</p><p> -ef 判断 file2与 file2是否为同一文件，可用在判断 hard link 的判定</p></li><li><p>两整数之间判断</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test n1 -eq n2</span><br></pre></td></tr></table></figure><p> -eq 两数值相等(equal)</p><p> -ne 两数值不等 (not equal)</p><p> -gt n1 大于 n2 (greater than)</p><p> -lt n1 小于 n2 (less than)</p><p> -ge n1 大于等于 n2 (greater than or equal)</p><p> -le n1 小于等于 n2 (less than or equal)</p></li><li><p>判断字符串的数据</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test -z string # 字符串为0？true: false</span><br><span class="line">test -n string # 判断字符串是否为0？false: true, -n 可省略</span><br><span class="line"></span><br><span class="line">test str1 = str2 # 相等 true, 反之 false</span><br><span class="line">test str1 != str2 # 相等 返回false, 反之 true</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>多重判断</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test -r filename -a -x filename</span><br></pre></td></tr></table></figure><p> -a 两种状况同时成立</p><p> -o 两种状况任意成立</p><p> !  反相状态</p></li></ol><h4 id="简洁的测试方式"><a href="#简洁的测试方式" class="headerlink" title="简洁的测试方式"></a><strong>简洁的测试方式</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意空格</span></span><br><span class="line">if [ 条件 ]</span><br><span class="line">then</span><br><span class="line">cammands</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">--------判断目录是否存在---------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">target_dir=/home/ccc</span><br><span class="line">if [ -d $target_dir ]</span><br><span class="line">then</span><br><span class="line">echo &quot;这个目录 $target_dir exists&quot;</span><br><span class="line">cd $target_dir</span><br><span class="line">ls</span><br><span class="line">else</span><br><span class="line">echo &quot;这个目录 $target_dir 不存在&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="Linux-内存监控"><a href="#Linux-内存监控" class="headerlink" title="Linux 内存监控"></a>Linux 内存监控</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FreeMem=`free -m |awk &#x27;NR==2&#x27; &#123;print $NF&#125;`</span><br><span class="line">CHARS=&quot;Current memory is $FreeMem&quot;</span><br><span class="line"></span><br><span class="line">if [ &quot;$FreeMem&quot; -lt &quot;2000&quot; ]</span><br><span class="line">then</span><br><span class="line">echo $CHARS|tee /tmp/messages.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mail -s <span class="string">&quot;主题&quot;</span> 收件人 &lt;</span></span><br><span class="line">mail -s &quot;`date +%F-%T$CHARS`&quot; xxx.qq.com &lt; /tmp/messages.txt</span><br><span class="line">echo &quot;内存不足，抓紧维护服务器！&quot;</span><br></pre></td></tr></table></figure><h4 id="符合条件测试"><a href="#符合条件测试" class="headerlink" title="符合条件测试"></a><strong>符合条件测试</strong></h4><blockquote><p>[ 条件1 ] &amp;&amp; [ 条件2 ]</p><p>[ 条件1 ] || [ 条件2 ]</p><p>布尔运算符</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">target_dir=/home/ccc</span><br><span class="line">if [ -d $target_dir ] &amp;&amp; [ -w $target_dir/testing ]</span><br><span class="line">then</span><br><span class="line">echo &quot;文件不存在，不能写入&quot;</span><br><span class="line">cd $target_dir</span><br><span class="line">ls</span><br><span class="line">else</span><br><span class="line">echo &quot;文件存在，可以写入&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>测试 nginx 服务是否存在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">版本变量</span></span><br><span class="line">CheckUrl() &#123;</span><br><span class="line">  timeout=5</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">相当于定义一个计数器</span></span><br><span class="line">  fails=0</span><br><span class="line">  success=0</span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">循环检测，循环执行一些命令</span></span><br><span class="line">  while true</span><br><span class="line">    do</span><br><span class="line">      wget --timeout=$&#123;timeout&#125; --tries=1 https://wyf195075595.github.io -q -O /dev/null</span><br><span class="line">      </span><br><span class="line">      # 命令执行结果 $?</span><br><span class="line">      if [ $? -ne 0 ]</span><br><span class="line">        then</span><br><span class="line">          let fails=fails+1 # 失败次数加一</span><br><span class="line">        else</span><br><span class="line">          let success+=1 # 成功次数加一</span><br><span class="line">      fi</span><br><span class="line">      </span><br><span class="line">      # 判断成功次数大于等于1，可以访问</span><br><span class="line">      if [ $success -ge 1 ]</span><br><span class="line">        then</span><br><span class="line">          echo &quot;该网站运行健康&quot;</span><br><span class="line">          # 返回状态码</span><br><span class="line">          exit 0</span><br><span class="line">      fi</span><br><span class="line">      </span><br><span class="line">      # 当错误次数大于等于2，警告</span><br><span class="line">      if [ $&#123;fails&#125; -ge 2 ]</span><br><span class="line">        then</span><br><span class="line">          echo &quot;网站挂掉了,尽快检查&quot;</span><br><span class="line">          exit 2</span><br><span class="line">      fi</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CheckUrl</span><br></pre></td></tr></table></figure><h3 id="双小括号-1"><a href="#双小括号-1" class="headerlink" title="双小括号"></a>双小括号</h3><blockquote><p>前面计算时就用到了这个语法，它支持数值运算，逻辑运算。还能在if 条件中使用</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val=10</span><br><span class="line">if (( $val ** 2 &gt; 90 ))</span><br><span class="line">  then</span><br><span class="line">    echo &quot;xxx&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="双方括号"><a href="#双方括号" class="headerlink" title="双方括号"></a>双方括号</h3><blockquote><p>双方括号提供了针对字符串的高级特性，模式匹配，正则表达式的匹配。双括号中字符不需要转义。一般不用，特殊场景使用</p><p>双括号中可以使用 &amp;&amp;,||,!</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在双中括号里，进行了 == 双等号，进行字符串匹配 r*，也就找到了 root 。</span></span><br><span class="line">if [[ $USER == r* ]]</span><br><span class="line">then</span><br><span class="line">  echo &quot;xxx&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;xxx&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------测试变量在【1，3】之间--------------</span><br><span class="line"></span><br><span class="line">[[ $num =~ [1-3] ]]</span><br></pre></td></tr></table></figure><h3 id="中括号"><a href="#中括号" class="headerlink" title="中括号"></a>中括号</h3><blockquote><p>也可以做一些数值字符比较，但是中括号中 字符需要 添加转义符，很常用</p><p>中括号中不能使用逻辑运算符 ||，&amp;&amp;, 要使用 -a ,-o 代替</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230504103754885.png" alt="image-20230504103754885"></p><h3 id="case-语句"><a href="#case-语句" class="headerlink" title="case 语句"></a>case 语句</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">case &quot;变量&quot; in</span><br><span class="line">值1)</span><br><span class="line">  command1</span><br><span class="line">  ;;</span><br><span class="line">值2)</span><br><span class="line">  command2</span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  command3</span><br><span class="line">esac</span><br><span class="line">-------------------</span><br><span class="line">case $car_type in</span><br><span class="line">自行车)</span><br><span class="line">  echo &quot;自行车也不错哦!&quot;</span><br><span class="line">  ;;</span><br><span class="line">摩托车)</span><br><span class="line">  echo &quot;摩托车泰库拉！&quot;</span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  echo &quot;我是谁？我在哪儿？我在干什么？&quot;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while test command</span><br><span class="line">do</span><br><span class="line">  other command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;shell 脚本开头的两个字符叫做 shebang “#!”。在unix系统中，程序会分析 shebang 后面内容，作为解析器的指令。相当于告诉系统用那种解析器去解读脚本。yarn 就是python 开发的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;以 #!/bin/sh 开头的文件，程序在执行的时候会调用 /bin/sh，也就是bash解释器&lt;/li&gt;
&lt;li&gt;以 #!/usr/bin/python 开头的文件，代表指定python解释器去执行&lt;/li&gt;
&lt;li&gt;以 #!/usr/bin/env 解释器名称，是一种在不同平台上都能正确找到解释器的办法&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="shell" scheme="https://wyf195075595.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>vercel 部署koa项目</title>
    <link href="https://wyf195075595.github.io/2023/04/21/programming/others/vercel/"/>
    <id>https://wyf195075595.github.io/2023/04/21/programming/others/vercel/</id>
    <published>2023-04-21T00:23:10.000Z</published>
    <updated>2023-07-20T00:36:29.731Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>vercel 不仅能够部署静态网站，还能部署node项目。这次就部署koa项目作为尝试。</p></blockquote><h3 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h3><blockquote><p>新建koa项目，目录如下</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230421090353337.png" alt="image-20230421090353337"></p><span id="more"></span><h4 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h4><blockquote><p>入口文件一定要是index.js,如果改写其他如 app.js,main.js 等等 vercel 均无法识别，这是一个大坑.</p><p>koa 监听端口不能是 3000 ,因为vercel 默认是 3000 端口</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跨域处理</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;koa-cors&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置静态资源</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">static</span>(__dirname+ <span class="string">&#x27;/static&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置响应格式</span></span><br><span class="line"><span class="keyword">const</span> routerResponse = <span class="built_in">require</span>(<span class="string">&#x27;./middleware/routerResponse&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">routerResponse</span>(&#123;</span><br><span class="line">    <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取post请求参数</span></span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyparser</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册路由</span></span><br><span class="line"><span class="keyword">const</span> controller = <span class="built_in">require</span>(<span class="string">&#x27;./middleware/controllers&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">controller</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3030</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;port 3030 is running!&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="路由文件"><a href="#路由文件" class="headerlink" title="路由文件"></a>路由文件</h4><blockquote><p>因为没有数据库，路由中使用axios请求了接口获取数据</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;../utils/http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">fn_index</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">`&lt;h1&gt;Index&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;/signin&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Name: &lt;input name=&quot;name&quot; value=&quot;koa&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Password: &lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;`</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">fn_signin</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> name = ctx.<span class="property">request</span>.<span class="property">body</span>.<span class="property">name</span> || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        password = ctx.<span class="property">request</span>.<span class="property">body</span>.<span class="property">password</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&#x27;koa&#x27;</span> &amp;&amp; password === <span class="string">&#x27;12345&#x27;</span>) &#123;</span><br><span class="line">        ctx.<span class="title function_">success</span>(&#123;</span><br><span class="line">            <span class="attr">ok</span>:<span class="string">&#x27;xxxxx&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = <span class="string">`&lt;h1&gt;Login failed!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Try again&lt;/a&gt;&lt;/p&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">fetchData</span> = <span class="keyword">async</span> (<span class="params">ctx, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> rs = <span class="keyword">await</span> http.<span class="title function_">get</span>(<span class="string">&quot;https://www.fastmock.site/mock/cc1aeeec1b278c3c30ec60eeaf462247/front/getPicList&quot;</span>)</span><br><span class="line">    ctx.<span class="title function_">success</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: rs</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="string">&#x27;GET /login&#x27;</span>: fn_index,</span><br><span class="line">    <span class="string">&#x27;GET /getData&#x27;</span>: fetchData,</span><br><span class="line">    <span class="string">&#x27;POST /signin&#x27;</span>: fn_signin</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>koa项目搭建好后可以在本地运行，访问静态资源，接口没有问题后。就开始改造</p></blockquote><h3 id="部署准备"><a href="#部署准备" class="headerlink" title="部署准备"></a>部署准备</h3><blockquote><p>部署到 vercel 需要做一些配置</p></blockquote><ol><li><p>package.json 新增 script</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vercel 部署时会用到</span><br><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;node index.js&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>安装 @vercel/node</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">必备</span></span><br><span class="line">yarn add @vercel/node</span><br></pre></td></tr></table></figure></li><li><p>新建vercel.json</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 覆盖 vercel 默认行为</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&quot;builds&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;src&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;use&quot;</span>: <span class="string">&quot;@vercel/node&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>安装vercel 并登录</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装 vercel</span></span><br><span class="line">npm i vercel -g</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录 Vercel 账号。</span></span><br><span class="line">vercel login</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------其他命令----------------------</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地开启服务。</span></span><br><span class="line">vercel dev</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地开启服务并打印日志。</span></span><br><span class="line">vercel dev --bug</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">部署本地资源到 Vercel 上。</span></span><br><span class="line">vercel</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新本地网页。</span></span><br><span class="line">vercel --prod</span><br><span class="line"></span><br><span class="line">vercel 可以用 vc 来代替，vc 是 Vercel 的缩写。</span><br></pre></td></tr></table></figure></li></ol><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vercel</span><br></pre></td></tr></table></figure><p><img src="https://s9.51cto.com/oss/202205/10/d78f532685481bcc147866bb9c8a2276277074.png" alt="vercel"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 更新资源</span><br><span class="line">vercel --prod</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.51cto.com/article/708495.html">此处参考文章</a></p><p>此处操作vercel生成vercel-koa2 但是操作后代码并没有上传至 vercel, 还是得将代码提交到 github 再关联到 vercel</p></blockquote><h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">访问地址，默认会访问到 static 中得 index,而不是根目录得index.html</span></span><br><span class="line">https://vercel-koa-three.vercel.app/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看获取数据得接口</span></span><br><span class="line">https://vercel-koa-three.vercel.app/getData</span><br></pre></td></tr></table></figure><blockquote><p>注意接口 注册时不要使用 /, 因为/ 会默认访问 static/index.html</p><p><a href="https://github.com/wyf195075595/koa-vercel">项目源码</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;vercel 不仅能够部署静态网站，还能部署node项目。这次就部署koa项目作为尝试。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;项目目录&quot;&gt;&lt;a href=&quot;#项目目录&quot; class=&quot;headerlink&quot; title=&quot;项目目录&quot;&gt;&lt;/a&gt;项目目录&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;新建koa项目，目录如下&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230421090353337.png&quot; alt=&quot;image-20230421090353337&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="other" scheme="https://wyf195075595.github.io/categories/other/"/>
    
    
    <category term="vercel" scheme="https://wyf195075595.github.io/tags/vercel/"/>
    
  </entry>
  
  <entry>
    <title>手机端搭建linux环境</title>
    <link href="https://wyf195075595.github.io/2023/04/17/programming/linux/%E6%89%8B%E6%9C%BA%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://wyf195075595.github.io/2023/04/17/programming/linux/%E6%89%8B%E6%9C%BA%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2023-04-17T00:23:10.000Z</published>
    <updated>2023-04-17T10:08:33.065Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>将手机作为Linux服务器</p><p>在手机端安装 Linux 系统,通过一个名为<a href="(https://f-droid.org/packages/com.termux/)"><strong>Termux</strong></a>的软件。Termux 是适用于 Android 的终端仿真器和 Linux 环境。它在 Google Play 商店中可用。安装后无需额外配置。</p></blockquote><p>安装完成后运行就可以得到Linux 环境，接下来设置 ssh 连接。通过一个名为<strong>Dropbear</strong>的软件</p><span id="more"></span><p><strong># <a href="https://blog.csdn.net/qq_45704640/article/details/110398165">安装 dropbear</a></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pkg update <span class="comment">// 更新 Termux 包。</span></span><br><span class="line">pkg upgrade  <span class="comment">// 更新 包数据</span></span><br><span class="line">pkg install dropbear<span class="comment">// 安装</span></span><br><span class="line">dropbear <span class="comment">// 开启， 每次启动都需要手动chong&#x27;qi</span></span><br></pre></td></tr></table></figure><p>设置 <strong>termux密码</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd <span class="comment">// 两次输入确认</span></span><br></pre></td></tr></table></figure><p><strong>远程连接</strong></p><blockquote><p><a href="https://lbrito1.github.io/blog/2020/02/repurposing-android.html">参考文章</a></p><p><a href="http://www.xbhp.cn/news/8058.html">Termux基础教程</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;将手机作为Linux服务器&lt;/p&gt;
&lt;p&gt;在手机端安装 Linux 系统,通过一个名为&lt;a href=&quot;(https://f-droid.org/packages/com.termux/)&quot;&gt;&lt;strong&gt;Termux&lt;/strong&gt;&lt;/a&gt;的软件。Termux 是适用于 Android 的终端仿真器和 Linux 环境。它在 Google Play 商店中可用。安装后无需额外配置。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;安装完成后运行就可以得到Linux 环境，接下来设置 ssh 连接。通过一个名为&lt;strong&gt;Dropbear&lt;/strong&gt;的软件&lt;/p&gt;</summary>
    
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/categories/linux/"/>
    
    
    <category term="nginx" scheme="https://wyf195075595.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>csrf 跨站点请求伪造</title>
    <link href="https://wyf195075595.github.io/2023/04/13/programming/javascript/csrf/"/>
    <id>https://wyf195075595.github.io/2023/04/13/programming/javascript/csrf/</id>
    <published>2023-04-13T07:23:10.000Z</published>
    <updated>2023-04-13T07:47:19.568Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>CSRF概念：</strong><a href="https://so.csdn.net/so/search?q=CSRF&spm=1001.2101.3001.7020">CSRF</a>跨站点请求伪造(Cross—Site Request Forgery)，跟XSS攻击一样，存在巨大的危害性，你可以这样来理解：<br>    攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中Web A为存在CSRF漏洞的网站，Web B为攻击者构建的恶意网站，User C为Web A网站的合法用户。</p></blockquote><h3 id="CSRF攻击攻击原理及过程如下："><a href="#CSRF攻击攻击原理及过程如下：" class="headerlink" title="CSRF攻击攻击原理及过程如下："></a><strong>CSRF攻击攻击原理及过程如下：</strong></h3><ol><li>用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；</li><li>在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；</li><li> 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；</li><li>. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；</li><li>浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。 </li></ol><span id="more"></span><h3 id="CSRF攻击实例"><a href="#CSRF攻击实例" class="headerlink" title="CSRF攻击实例"></a>CSRF攻击实例</h3><p>受害者 Bob 在银行有一笔存款，通过对银行的网站发送请求</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=bob2 </span></span><br></pre></td></tr></table></figure><p>可以使 Bob 把 1000000 的存款转到 bob2 的账号下。通常情况下，该请求发送到网站后，服务器会先验证该请求是否来自一个合法的 session，并且该 session 的用户 Bob 已经成功登陆。</p><p>​    黑客 Mallory 自己在该银行也有账户，他知道上文中的 URL 可以把钱进行转帐操作。Mallory 可以自己发送一个请求给银行：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory</span></span><br></pre></td></tr></table></figure><p>。但是这个请求来自 Mallory 而非 Bob，他不能通过安全认证，因此该请求不会起作用。</p><p>​    这时，Mallory 想到使用 CSRF 的攻击方式，他先自己做一个网站，在网站中放入如下代码： </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=<span class="string">&quot;http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory&quot;</span></span><br></pre></td></tr></table></figure><p>，并且通过广告等诱使 Bob 来访问他的网站。当 Bob 访问该网站时，上述 url 就会从 Bob 的浏览器发向银行，而这个请求会附带 Bob 浏览器中的 cookie 一起发向银行服务器。大多数情况下，该请求会失败，因为他要求 Bob 的认证信息。但是，如果 Bob 当时恰巧刚访问他的银行后不久，他的浏览器与银行网站之间的 session 尚未过期，浏览器的 cookie 之中含有 Bob 的认证信息。这时，悲剧发生了，这个 url 请求就会得到响应，钱将从 Bob 的账号转移到 Mallory 的账号，而 Bob 当时毫不知情。等以后 Bob 发现账户钱少了，即使他去银行查询日志，他也只能发现确实有一个来自于他本人的合法请求转移了资金，没有任何被攻击的痕迹。而 Mallory 则可以拿到钱后逍遥法外。 </p><h3 id="CSRF漏洞检测："><a href="#CSRF漏洞检测：" class="headerlink" title="CSRF漏洞检测："></a><strong>CSRF漏洞检测：</strong></h3><p>检测CSRF漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉Referer字段后再重新提交，如果该提交还有效，那么基本上可以确定存在CSRF漏洞。</p><p>​    随着对CSRF漏洞研究的不断深入，不断涌现出一些专门针对CSRF漏洞进行检测的工具，如CSRFTester，CSRF Request Builder等。</p><p>​    以CSRFTester工具为例，CSRF漏洞检测工具的测试原理如下：使用CSRFTester进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在CSRFTester中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。如果修改后的测试请求成功被网站服务器接受，则说明存在CSRF漏洞，当然此款工具也可以被用来进行CSRF攻击。</p><h3 id="防御CSRF攻击："><a href="#防御CSRF攻击：" class="headerlink" title="防御CSRF攻击："></a><strong>防御CSRF攻击：</strong></h3><blockquote><p>目前防御 CSRF 攻击主要有三种策略：验证 HTTP Referer 字段；在请求地址中添加 token 并验证；在 HTTP 头中自定义属性并验证。</p></blockquote><h4 id="（1）验证-HTTP-Referer-字段"><a href="#（1）验证-HTTP-Referer-字段" class="headerlink" title="（1）验证 HTTP Referer 字段"></a><strong>（1）验证 HTTP Referer 字段</strong></h4><p>​    根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限页面的请求来自于同一个网站，比如需要访问 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory</span></span><br></pre></td></tr></table></figure><p>，用户必须先登陆 bank.example，然后通过点击页面上的按钮来触发转账事件。这时，该转帐请求的 Referer 值就会是转账按钮所在的页面的 URL，通常是以 bank.example 域名开头的地址。而如果黑客要对银行网站实施 CSRF 攻击，他只能在他自己的网站构造请求，当用户通过黑客的网站发送请求到银行时，该请求的 Referer 是指向黑客自己的网站。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值，如果是以 bank.example 开头的域名，则说明该请求是来自银行网站自己的请求，是合法的。如果 Referer 是其他网站的话，则有可能是黑客的 CSRF 攻击，拒绝该请求。</p><p>​    这种方法的显而易见的好处就是简单易行，网站的普通开发人员不需要操心 CSRF 的漏洞，只需要在最后给所有安全敏感的请求统一增加一个拦截器来检查 Referer 的值就可以。特别是对于当前现有的系统，不需要改变当前系统的任何已有代码和逻辑，没有风险，非常便捷。</p><p>​    然而，这种方法并非万无一失。Referer 的值是由浏览器提供的，虽然 HTTP 协议上有明确的要求，但是每个浏览器对于 Referer 的具体实现可能有差别，并不能保证浏览器自身没有安全漏洞。使用验证 Referer 值的方法，就是把安全性都依赖于第三方（即浏览器）来保障，从理论上来讲，这样并不安全。事实上，对于某些浏览器，比如 IE6 或 FF2，目前已经有一些方法可以篡改 Referer 值。如果 bank.example 网站支持 IE6 浏览器，黑客完全可以把用户浏览器的 Referer 值设为以 bank.example 域名开头的地址，这样就可以通过验证，从而进行 CSRF 攻击。</p><p>即便是使用最新的浏览器，黑客无法篡改 Referer 值，这种方法仍然有问题。因为 Referer 值会记录下用户的访问来源，有些用户认为这样会侵犯到他们自己的隐私权，特别是有些组织担心 Referer 值会把组织内网中的某些信息泄露到外网中。因此，用户自己可以设置浏览器使其在发送请求时不再提供 Referer。当他们正常访问银行网站时，网站会因为请求没有 Referer 值而认为是 CSRF 攻击，拒绝合法用户的访问。</p><h4 id="（2）在请求地址中添加-token-并验证"><a href="#（2）在请求地址中添加-token-并验证" class="headerlink" title="（2）在请求地址中添加 token 并验证"></a><strong>（2）在请求地址中添加 token 并验证</strong></h4><p>​     CSRF 攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于 cookie 中，因此黑客可以在不知道这些验证信息的情况下直接利用用户自己的 cookie 来通过安全验证。要抵御 CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于 cookie 之中。可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这个 token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。</p><p>​    这种方法要比检查 Referer 要安全一些，token 可以在用户登陆后产生并放于 session 之中，然后在每次请求时把 token 从 session 中拿出，与请求中的 token 进行比对，但这种方法的难点在于如何把 token 以参数的形式加入请求。对于 GET 请求，token 将附在请求地址之后，这样 URL 就变成 <a href="http://url/?csrftoken=tokenvalue%E3%80%82">http://url?csrftoken=tokenvalue。</a> 而对于 POST 请求来说，要在 form 的最后加上 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;csrftoken&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tokenvalue&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>，这样就把 token 以参数的形式加入请求了。但是，在一个网站中，可以接受请求的地方非常多，要对于每一个请求都加上 token 是很麻烦的，并且很容易漏掉，通常使用的方法就是在每次页面加载时，使用 javascript 遍历整个 dom 树，对于 dom 中所有的 a 和 form 标签后加入 token。这样可以解决大部分的请求，但是对于在页面加载之后动态生成的 html 代码，这种方法就没有作用，还需要程序员在编码时手动添加 token。</p><p>​     该方法还有一个缺点是难以保证 token 本身的安全。特别是在一些论坛之类支持用户自己发表内容的网站，黑客可以在上面发布自己个人网站的地址。由于系统也会在这个地址后面加上 token，黑客可以在自己的网站上得到这个 token，并马上就可以发动 CSRF 攻击。为了避免这一点，系统可以在添加 token 的时候增加一个判断，如果这个链接是链到自己本站的，就在后面添加 token，如果是通向外网则不加。不过，即使这个 csrftoken 不以参数的形式附加在请求之中，黑客的网站也同样可以通过 Referer 来得到这个 token 值以发动 CSRF 攻击。这也是一些用户喜欢手动关闭浏览器 Referer 功能的原因。</p><p>   <strong>（3）在 HTTP 头中自定义属性并验证</strong></p><p>​    这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。</p><p>​    然而这种方法的局限性非常大。XMLHttpRequest 请求通常用于 Ajax 方法中对于页面局部的异步刷新，并非所有的请求都适合用这个类来发起，而且通过该类请求得到的页面不能被浏览器所记录下，从而进行前进，后退，刷新，收藏等操作，给用户带来不便。另外，对于没有进行 CSRF 防护的遗留系统来说，要采用这种方法来进行防护，要把所有请求都改为 XMLHttpRequest 请求，这样几乎是要重写整个网站，这代价无疑是不能接受的。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;CSRF概念：&lt;/strong&gt;&lt;a href=&quot;https://so.csdn.net/so/search?q=CSRF&amp;spm=1001.2101.3001.7020&quot;&gt;CSRF&lt;/a&gt;跨站点请求伪造(Cross—Site Request Forgery)，跟XSS攻击一样，存在巨大的危害性，你可以这样来理解：&lt;br&gt;    攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中Web A为存在CSRF漏洞的网站，Web B为攻击者构建的恶意网站，User C为Web A网站的合法用户。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;CSRF攻击攻击原理及过程如下：&quot;&gt;&lt;a href=&quot;#CSRF攻击攻击原理及过程如下：&quot; class=&quot;headerlink&quot; title=&quot;CSRF攻击攻击原理及过程如下：&quot;&gt;&lt;/a&gt;&lt;strong&gt;CSRF攻击攻击原理及过程如下：&lt;/strong&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；&lt;/li&gt;
&lt;li&gt;在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；&lt;/li&gt;
&lt;li&gt; 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；&lt;/li&gt;
&lt;li&gt;. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；&lt;/li&gt;
&lt;li&gt;浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。 &lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="拓展" scheme="https://wyf195075595.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>雪中悍刀行</title>
    <link href="https://wyf195075595.github.io/2023/04/01/note/essayNote/index/"/>
    <id>https://wyf195075595.github.io/2023/04/01/note/essayNote/index/</id>
    <published>2023-04-01T01:23:10.000Z</published>
    <updated>2023-03-08T14:41:22.577Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/imgs/hello-world/0df431adcbef76091bf6bb1c23dda3cc7dd99eb7.jpg"></p><h3 id="初始版"><a href="#初始版" class="headerlink" title="初始版"></a>初始版</h3><p>有个白狐脸儿，佩双刀绣冬春雷，要做那天下第一；</p><p>湖底有白发老魁爱吃荤；</p><p>缺门牙老仆背剑匣；</p><p>山上有个骑青牛的年轻师叔祖，不敢下山；</p><p>有个骑大猫扛向日葵不太冷的少女杀手；</p><span id="more"></span><h3 id="收官版"><a href="#收官版" class="headerlink" title="收官版"></a>收官版</h3><p>江湖是一张珠帘。大人物小人物，是珠子，大故事小故事，是串线。情义二字，则是那些珠子的精气神。开始收官中。最终章将以那一声“小二上酒”结尾。</p><h3 id="春秋九国"><a href="#春秋九国" class="headerlink" title="春秋九国"></a>春秋九国</h3><p>离阳，西楚，西蜀，北汉，大魏，后宋、后隋，东越，南唐。徐骁灭六国，后隋，西楚，后宋，西蜀，北汉，大魏。顾剑棠灭东越，南唐。</p><p>离阳王朝：原有六州，灭春秋八国添十三州，共计十九州。</p><p>北莽王朝：占地八州，分别是姑塞，龙腰，东锦，西河，金蝉，玉蝉，宝瓶，橘子。</p><p>西蜀：举国兵卒不过十二万，战死九万。被徐骁两个月灭国。西蜀曾凿开石壁挂了三条铁索拦江试图阻拦北凉临时拼凑出的水师，不曾想那场水战尚未开启便落幕，大江沿岸天险就被北凉军悉数摧破。</p><p>西楚皇都一战：离皇宫十里，赵军师病死。徐骁率军投鞭断江，死战西蜀皇都。西蜀国破，徐骁顺势灭去数个反复无常的南蛮豪强。</p><p>西楚：地方五千里持戟百万人。</p><h3 id="春秋战争"><a href="#春秋战争" class="headerlink" title="春秋战争"></a>春秋战争</h3><p>西楚景河之战：十二万大戟士对阵北凉铁骑，全军覆没，死战不屈。</p><p>西楚襄樊守城战：春秋第一守将王明阳坐镇死守。二十万襄樊人只剩下不到一万。襄樊攻守，北凉军精锐折损大半，其中就有三百名精于钻地的穴师，死亡殆尽。</p><p>西楚西垒壁之战：西楚亡国之战。春秋国战最后一战。北凉军与西楚军对峙两年。北凉旧部马岭等十四人以死替徐骁表忠。王妃一袭白衣缟素亲自敲响战鼓，鼓声如雷，不破西楚鼓不绝。“死战第一”千人鱼鼓营死战不退，最终只活下来十六人，为“骑战第一”三千大雪龙骑兵开辟出一条直插叶白夔大戟军腹地的坦荡血路。陈芝豹坐镇中军，运筹帷幄；王妃亲自擂鼓；徐骁舍弃头盔，持矛首当其冲；三千白马白甲，一路奔雷踏去。其中便有鱼鼓营千余人的袍泽尸体。小人屠陈芝豹与叶白夔死战。叶白夔战死。此战后，杨太岁曾力劝徐骁不杀硕儒方孝梨，最终无果。</p><p>西楚灭国后，徐骁受封大柱国，隔天被封北凉王。</p><p>老皇帝要将以武乱禁的江湖掀翻，徐骁一人请命马踏江湖，不曾开战，便有两万名百战老卒请辞还家，更有无数出身江湖的猛将对徐骁心生怨恨，转投其它军伍。</p><h2 id="境界划分"><a href="#境界划分" class="headerlink" title="境界划分"></a>境界划分</h2><p><a href="javascript:;">编辑</a><a href="javascript:;"> 播报</a></p><p><strong>九品制</strong>（从小到大，九品至一品）</p><p>伤甲而不破，是下三品</p><p>破六甲以下，中三品</p><p>破甲八九，上三品</p><p>二品为小宗师</p><p>一品四境：金刚境，指玄境，天象境，陆地神仙（皆有大小真伪之分，上品为大，最次是伪）。</p><p>金刚境喻释家，金刚境的主要特点就是熬炼体魄，这是四境当中最适合熬炼体魄的时候，也就是提高防御力和体质。金刚境在早年是不被划入高手体系内的，直到高树露以这个境界代表佛家，才被划入了一品境。而金刚境之上还有大金刚境，可锻造真正的金刚不败之身，比如三教中的李当心、当年四大宗师的符将红甲。</p><p>指玄境喻道家，指玄境的主要特点一个是有类似于未卜先知、料敌于先的能力。另一个则是可以悟得一些五花八门的指玄秘术，这些秘术千奇百怪，指玄境之间对上基本上谁也不敢称自己必胜，因为你不知道他悟出的是什么秘术。像江斧丁悟出的是“直指天心”的照镜之法，看到别人的武学可以过目不忘，撷取其中的精华，而天猫韩生宣悟出的是可以截断天象境天人感应的指玄秘术，因此可以指玄杀天象。</p><p>天象境喻儒家，天象境的特点就是天人感应，与天地共鸣，可以借法天地，可以与敏锐的直觉趋利避害。指玄境要晋升天象境难度不比二品境晋升一品境容易。而且因为天象境需要天人感应，如果滥造杀业的话，会受气数影响，所以像韩生宣是可以入天象境而不愿意入。天象境完美即为大天象境，距离地仙只有一步之遥，例如柳蒿师、轩辕大磐、程白霜等人。</p><p>陆地神仙，为三家殊途同归。含有气数在身，陆地神仙位格是有数的，只有其他陆地神仙死了或者飞升了，才能有新的陆地神仙诞生。</p><p>一般而言，佛门入一品为金刚，道门入一品为指玄，儒门入一品为天象，只修单境。而江湖武夫则大多循境而进，金刚-指玄-天象-地仙（融会贯通），多境叠加，故三教中人同境界对打不如武夫。当然，除了三教中人，江湖武夫也有越境升级者，其中多是以术入武，对体魄要求不大，故而入一品则指玄。</p><p>一品往上，则是破碎虚空，剑开天门，或举霞飞升，或驾鹤而起，或御剑而行。一入天门，飞升上界，则为天仙，可得长生，但是如果出了天门，就会成为谪仙人，不再长生。过天门而不入，停留下界，则为天人。有无瑕之分。</p><p>天人大长生为天人圆满，拥有大金刚境的天人体魄（无垢之体）、道教大长生的指玄、儒家圣人的天象，在天上都难寻敌手。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/imgs/hello-world/0df431adcbef76091bf6bb1c23dda3cc7dd99eb7.jpg&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;初始版&quot;&gt;&lt;a href=&quot;#初始版&quot; class=&quot;headerlink&quot; title=&quot;初始版&quot;&gt;&lt;/a&gt;初始版&lt;/h3&gt;&lt;p&gt;有个白狐脸儿，佩双刀绣冬春雷，要做那天下第一；&lt;/p&gt;
&lt;p&gt;湖底有白发老魁爱吃荤；&lt;/p&gt;
&lt;p&gt;缺门牙老仆背剑匣；&lt;/p&gt;
&lt;p&gt;山上有个骑青牛的年轻师叔祖，不敢下山；&lt;/p&gt;
&lt;p&gt;有个骑大猫扛向日葵不太冷的少女杀手；&lt;/p&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://wyf195075595.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随笔" scheme="https://wyf195075595.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>h5播放rtsp格式视频</title>
    <link href="https://wyf195075595.github.io/2023/03/27/programming/jsplugin/rtsp/"/>
    <id>https://wyf195075595.github.io/2023/03/27/programming/jsplugin/rtsp/</id>
    <published>2023-03-27T10:53:10.000Z</published>
    <updated>2023-04-18T04:00:52.387Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://www.jianshu.com/p/e16a453bbfcc">Linux下载和安装yasm、FFmpeg、流媒体服务SRS4.0</a></p><p><a href="http://www.ffmpeg.org/releases/">FFmpeg下载</a></p></blockquote><h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><p>前端：</p><ul><li>jsmpeg.js (连接wbesocket，绘制视频图像)</li></ul><p>服务端（node）：</p><ul><li>express（静态服务，接口处理）</li><li>body-parser（处理接口接收数据）</li><li>node-rtsp-stream-jsmpeg （下发FFmpeg指令，创建websocke服务端）</li><li>child_process（启动shell脚本指令）</li></ul><p>其他：</p><ul><li>FFmpeg(视频流转码)</li><li>pm2(node进程守护)</li><li>云台控制程序（通过视频厂家提供的sdk二次开发，通过ajax调用）</li></ul><blockquote><p><a href="https://juejin.cn/post/6844903949309313037">参考链接</a></p></blockquote><hr><span id="more"></span><h3 id="zlmediakit搭建和配合ffmpeg使用"><a href="#zlmediakit搭建和配合ffmpeg使用" class="headerlink" title="zlmediakit搭建和配合ffmpeg使用"></a>zlmediakit搭建和配合ffmpeg使用</h3><blockquote><p><a href="https://github.com/ZLMediaKit/ZLMediaKit">zlmediakit</a> 是一个基于C++11的高性能运营级流媒体服务框架，可以推送各种视频，音频流。</p><p>ffmpeg 推流视频，zlmediakit 流媒体服务器经行转发，转发后的地址有多种视频格式</p></blockquote><ul><li>zlmediakit linux 环境搭建：<br>  <a href="https://zhuanlan.zhihu.com/p/366774975">这篇文章</a>写得已经非常详细了，就不再拾人牙慧了</li><li>ffmpeg安装：<br>  虽然上面的搭建文档说不用安装ffmpeg，但是如果使用命令的话，肯定还是要安装的(不安装指的是在项目中调用api)，这种方式只能安装低版本，高版本参考上面<br>  1).sudo apt-get update<br>  2).sudo apt-get install ffmpeg</li><li>测试(；推流路径格式是：rtsp://ip/…（后面可随意命名）)：<br>  例：把test文件推到某个rtsp地址上去<br>  ffmpeg -re -i test.mp4 -vcodec h264 -acodec aac -f rtsp -rtsp_transport tcp rtsp://ip/live/test<br>  注意事项：<br>  1）要推的视频路径写绝对路径；<br>  2）推流地址格式为: rtsp://ip/…（后面可随意定义）<br>  3）zlmediakit的默认路径是554，如果改了端口号，ip后要加上。<br>  4）如果使用docker安装zlmediakit，那么要注意映射的端口不是554的话，端口号也得写上</li><li><a href="https://github.com/ZLMediaKit/ZLMediaKit/wiki/ZLMediaKit%E6%8E%A8%E6%B5%81%E6%B5%8B%E8%AF%95">附带推流测试地址(附带右边列表很多相关资料)：</a></li></ul><blockquote><p><a href="https://blog.csdn.net/weixin_43248279/article/details/124734505">参考地址</a></p></blockquote><p><a href="https://qiteecom/xia-chu/ZIMediaKit">ZIMediaKit源地址</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// rtsp推流(文件推流)</span><br><span class="line">ffmpeg -re -i test.mp4 -rtsp transport tcp -c copy -f rtsp rtsp://127.0.0.1:554/live/test</span><br><span class="line">// rtsp推流(文件循环推流)</span><br><span class="line">ffmpeg -re -stream_loop -1 -i test.mp4 -rtsp_transport tcp -c copy -f rtsp rtsp://127.0.0.1:554/live/test</span><br><span class="line">// rtmp推流(文件推流)</span><br><span class="line">Ffmpeg -re -i test.mp4 -vcodec h264_nvenc -acodec aac -f flv rtmp://127.0.0.1:1935/live/test</span><br><span class="line">// rtmp推流(文件循环推流)</span><br><span class="line">ffmpeg -re -stream_loop -1 -i test.mp4 -vcodec h264 -acodec aac -f flv rtmp://127.0.0.1:1935/live/test</span><br><span class="line"></span><br><span class="line">// 推流笔记本摄像头</span><br><span class="line">ffmpeg -i /dev/video0 -vcodec libx264 -acodec copy -preset:v ultrafast -tune:v zerolatency -f flv rtmp://192.168.94.128:1935/live/test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ZIMediaKit支持多种流媒体协议的转换，协议转换后的播放地址</span></span><br><span class="line">// rtsp播放</span><br><span class="line">rtsp://127.0.0.1:554/live/test</span><br><span class="line"></span><br><span class="line">//rtmp播放</span><br><span class="line">rtmp://127.0.0.1:1935/live/test</span><br><span class="line"></span><br><span class="line">// hls播放</span><br><span class="line">http://127.0.0.1:80/live/test/hls.m3u8</span><br><span class="line"></span><br><span class="line">// http-flv播放</span><br><span class="line">http://127.0.0.1:80/live/test.live.flv</span><br><span class="line"></span><br><span class="line">// http-ts播放</span><br><span class="line">http://127.0.0.1:80/live/test.live.ts</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/qq_37429313/article/details/116201062">ffplay ffmpeg快速检验摄像头</a></p><p><a href="https://blog.csdn.net/YellowShite/article/details/120367738">ZLMediaKit 推/拉流</a></p></blockquote><h3 id="ffmpeg-基础"><a href="#ffmpeg-基础" class="headerlink" title="ffmpeg 基础"></a>ffmpeg 基础</h3><blockquote><p>Fmpeg 是领先的多媒体框架，能够解码、编码、转码、混合、解密、流媒体、过滤和播放人类和机器创造的几乎所有东西。它支持最晦涩的古老格式，直到最尖端的格式。</p><p>简单来说可以将浏览器不支持的流转换为支持的流供页面展示.</p><p>除了视频文件，还能处理 摄像头，声卡，网络直播，电脑桌面进行数据采集</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-i 表示输入a.mov</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-c 表示为输出文件指定编码格式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">copy 表示从输入文件a.mov中直接拷贝音频和视频数据</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将输入的 a.mov 转化为 mp4 格式 输出 a.mp4</span></span><br><span class="line">ffmpeg -i a.mov -c copy a.mp4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-c:v  code video 指定视频编码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-c:a  code audio 指定音频编码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 video.avi 输出为 视频编码246，音频编码 acc 格式 的mp4文件</span></span><br><span class="line">ffmpeg -i video.avi -c:v h246 -c:a aac video.mp4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看支持的格式</span></span><br><span class="line">ffmpeg -c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用参数选项</span></span><br><span class="line">ffmpeg -h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示一些高级参数</span></span><br><span class="line">ffmpeg -h -long</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示更多</span></span><br><span class="line">ffmpeg -h full</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出参数</span></span><br><span class="line"></span><br><span class="line">-r 24 # 指定输出视频帧率 24</span><br><span class="line">-s 1920X1080 # 指定输出视频分辨率</span><br><span class="line">-vb 5000k 将输出文件视频码率限制在 5000k左右</span><br><span class="line">-ab 320k 将输出音频码率设置限制在320k左右</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将视频音频拆分，输出生成多个文件</span></span><br><span class="line">ffmpeg -i hello.avi -c:v h264 video.map -c:a aac audio.acc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将4k视频同时生成 不同分辨率视频输出</span></span><br><span class="line">ffmpeg -i video4k.avi -c:v h264 -s 1280x720 720p.map -c:v h264 -s 1920x1080 1080p.mp4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主要参数</span></span><br><span class="line">-i 设定输入流 </span><br><span class="line">-f 设定输出格式 </span><br><span class="line">-ss 开始时间 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">视频参数：</span></span><br><span class="line">-b 设定视频流量(码率)，默认为200Kbit/s </span><br><span class="line">-r 设定帧速率，默认为25 </span><br><span class="line">-s 设定画面的宽与高 </span><br><span class="line">-aspect 设定画面的比例 </span><br><span class="line">-vn 不处理视频 </span><br><span class="line">-vcodec 设定视频编解码器，未设定时则使用与输入流相同的编解码器</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">音频参数：</span></span><br><span class="line">-ar 设定采样率 </span><br><span class="line">-ac 设定声音的Channel数 </span><br><span class="line">-acodec 设定声音编解码器，未设定时则使用与输入流相同的编解码器 </span><br><span class="line">-an 不处理音频</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.jianshu.com/p/ddafe46827b7">基础使用参考链接</a></p><p><a href="https://zhuanlan.zhihu.com/p/67878761">简单示例</a></p></blockquote><h3 id="ffplay"><a href="#ffplay" class="headerlink" title="ffplay"></a>ffplay</h3><blockquote><p>继承了 ffmpeg 的编解码能力，支持格式最全的播放器</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">播放文件，左右方向键控制快进快退，q退出</span></span><br><span class="line">ffplay video.mp4</span><br></pre></td></tr></table></figure><p>在安装 ffmpeg 时 本来时默认会 安装好 ffplay,ffprobe。 但是如果缺少依赖会导致安装不成功</p><p>ffplay 依赖 <a href="https://github.com/libsdl-org/SDL/releases/tag/release-2.26.4">SDL2</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 设置 ffmpeg   --enable-libx264，此设置依赖x264。不然报错 libx264 not found</span><br><span class="line">./configure --enable-shared --enable-libx264 --enable-gpl --prefix=/usr/local/ffmpeg</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p><strong>5. 安装x264</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http://www.videolan.org/developers/x264.html，下载</span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">git clone https://code.videolan.org/videolan/x264.git</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">git clone http://git.videolan.org/git/x264.git</span><br><span class="line"></span><br><span class="line">cd x264</span><br><span class="line"></span><br><span class="line">./configure --enable-shared</span><br><span class="line"></span><br><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure><p><strong>libx264 not found</strong></p><blockquote><ol><li>将使用到的库路径添加至环境变量中</li></ol><p>export PATH=/usr/local/x264/bin:$PATH</p><p>export PATH=/usr/local/x264/include:$PATH</p><p>export PATH=/usr/local/x264/lib:$PATH</p></blockquote><p><strong>手动编译安装ffmpeg会出现的问题</strong></p><blockquote><p>在跑视频流程序或命令时出现这个问题。<br> 跟这个报错：ffmpeg: error while loading shared libraries: libx264.so.164: cannot open shared object file: No such file or directory</p><p> ffmpeg 时使用到了 libx264，而在实际的编译式安装过程中没有指定编译 libx264 参数，从而产生报错。</p></blockquote><p><strong>缺失依赖</strong></p><p>ffmpeg 命令报错 xxxx =&gt; not found</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ffmpeg bin名录下</span></span><br><span class="line">ldd ffmpeg</span><br></pre></td></tr></table></figure><p>查找目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /usr -name &#x27;libavdevice.so.58&#x27;</span><br></pre></td></tr></table></figure><p>将 目录export 出来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=/usr/local/lib/</span><br></pre></td></tr></table></figure><h3 id="AKStream"><a href="#AKStream" class="headerlink" title="AKStream"></a>AKStream</h3><blockquote><p>​    AKStream是一套全功能的软NVR接口平台，软NVR指的是软件定义的NVR（Network Video Recoder）。</p><p>​    AKStream集成了ZLMediaKit作为其流媒体服务器，AKStream支持对ZLMediaKit的集群管理（通过AKStreamKeeper-流媒体治理组件），可以将分布在不同服务器的多个ZLMediaKit集群起来，统一管理，统一调度。</p></blockquote><p><strong>AKStream生态圈开源Web管理平台</strong></p><ul><li><p>基于React的纯前端AKStream Web UI</p></li><li><p>非常简单的部署方式，非常简单的运行方式</p></li><li><p><a href="https://gitee.com/sscboshi/AKStreamNVR">https://gitee.com/sscboshi/AKStreamNVR</a></p></li><li><p><a href="https://github.com/langmansh/AKStreamNVR">https://github.com/langmansh/AKStreamNVR</a></p></li><li><p>基于.net 5和vue2</p></li><li><p><a href="https://github.com/langmansh/AKStreamUI">https://github.com/langmansh/AKStreamUI</a></p></li><li><p><a href="https://gitee.com/sscboshi/AKStreamUI">https://gitee.com/sscboshi/AKStreamUI</a></p></li></ul><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><blockquote><p>安装 Nginx,nginx-http-flv-module插件</p></blockquote><p>配置文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> </span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"> </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80; #http-flv的拉流端口</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        # http-flv的相关配置</span><br><span class="line">        location /test &#123;</span><br><span class="line">            flv_live on; #打开HTTP播放FLV直播流功能</span><br><span class="line">            chunked_transfer_encoding on; #支持&#x27;Transfer-Encoding: chunked&#x27;方式回复</span><br><span class="line"> </span><br><span class="line">            add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;; #添加额外的HTTP头</span><br><span class="line">            add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;; #添加额外的HTTP头</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rtmp_auto_push on;</span><br><span class="line">rtmp_auto_push_reconnect 1s;</span><br><span class="line">rtmp_socket_dir /tmp;</span><br><span class="line"> </span><br><span class="line">rtmp &#123;</span><br><span class="line">    out_queue           4096;</span><br><span class="line">    out_cork            8;</span><br><span class="line">    max_streams         128;</span><br><span class="line">    timeout             15s;</span><br><span class="line">    drop_idle_publisher 15s;</span><br><span class="line"> </span><br><span class="line">    log_interval 5s; #log模块在access.log中记录日志的间隔时间，对调试非常有用</span><br><span class="line">    log_size     1m; #log模块用来记录日志的缓冲区大小</span><br><span class="line"> </span><br><span class="line">    server &#123;</span><br><span class="line">        listen 1935;</span><br><span class="line">        chunk_size: 4096;</span><br><span class="line">        # server_name www.test.*; #用于虚拟主机名后缀通配</span><br><span class="line"> </span><br><span class="line">        #ffmpeg推流的application </span><br><span class="line">        application live &#123;</span><br><span class="line">            live on; # 启用实时流应用程序监听</span><br><span class="line">            allow publish 127.0.0.1;</span><br><span class="line">            allow play all;</span><br><span class="line">            record off; # 不要录制流</span><br><span class="line">            meta copy; # 复制传出元数据的传入元数据</span><br><span class="line">            gop_cache on; #打开GOP缓存，减少首屏等待时间 on时第一帧加载快，off时第一帧加载慢 </span><br><span class="line">            # @StringKai 在博客https://blog.csdn.net/string_kai/article/details/100598268提到on时延高，off时延低，不过我在测试时并没有感觉出时延的差别</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 ffmpeg 推流</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f v4l2 -framerate 10 -i /dev/video0 -g 10 -f flv rtmp://127.0.0.1/live/wei</span><br></pre></td></tr></table></figure><p>播放：</p><p>RTMP协议拉流:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtmp:192.168.94.128/live/wei</span><br></pre></td></tr></table></figure><p>HTTL FLV 协议拉流</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.94.128/test?app=live&amp;stream=wei</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230409153038364.png" alt="image-20230409153038364"></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/e16a453bbfcc&quot;&gt;Linux下载和安装yasm、FFmpeg、流媒体服务SRS4.0&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.ffmpeg.org/releases/&quot;&gt;FFmpeg下载&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;方案&quot;&gt;&lt;a href=&quot;#方案&quot; class=&quot;headerlink&quot; title=&quot;方案&quot;&gt;&lt;/a&gt;方案&lt;/h3&gt;&lt;p&gt;前端：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jsmpeg.js (连接wbesocket，绘制视频图像)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;服务端（node）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;express（静态服务，接口处理）&lt;/li&gt;
&lt;li&gt;body-parser（处理接口接收数据）&lt;/li&gt;
&lt;li&gt;node-rtsp-stream-jsmpeg （下发FFmpeg指令，创建websocke服务端）&lt;/li&gt;
&lt;li&gt;child_process（启动shell脚本指令）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其他：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FFmpeg(视频流转码)&lt;/li&gt;
&lt;li&gt;pm2(node进程守护)&lt;/li&gt;
&lt;li&gt;云台控制程序（通过视频厂家提供的sdk二次开发，通过ajax调用）&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://juejin.cn/post/6844903949309313037&quot;&gt;参考链接&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="rtsp" scheme="https://wyf195075595.github.io/tags/rtsp/"/>
    
  </entry>
  
  <entry>
    <title>开发自己的js plugin</title>
    <link href="https://wyf195075595.github.io/2023/03/22/programming/jsplugin/newnpm/"/>
    <id>https://wyf195075595.github.io/2023/03/22/programming/jsplugin/newnpm/</id>
    <published>2023-03-22T10:53:10.000Z</published>
    <updated>2023-08-04T07:44:01.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>工欲善其事，必先利其器。首先去找适合写插件的项目包管理工具。对比了webpack,rollup,gulp,parcel</p><p>经过一通对比就选中了 <strong>rollup</strong>，具体请自行了解。简单说一下我们熟知的<strong>vue</strong>,<strong>react</strong>,<strong>taro-ui</strong> 等 就是使用的 rolluojs 打包的</p><p>自己写了一个很简单的插件上传发布到npm。具体步骤如下：</p></blockquote><span id="more"></span><ol><li><p>首先 新建一个文件夹 npm init 初始化 得到package.json</p></li><li><p>引入 rollup</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用了 yarn 因为 yarn 打包 可以自己找到 (yarn rollup) 命令可执行文件</span></span><br><span class="line">yarn add rollup -D</span><br></pre></td></tr></table></figure></li><li><p>增加配置文件 rollup.config.js, 跟package.json 同级</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持 导入 josn 文件</span></span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-json&#x27;</span></span><br><span class="line"><span class="comment">// 支持导入 npm 第三方模块</span></span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-node-resolve&#x27;</span></span><br><span class="line"><span class="comment">// 兼容 commonJs 模块</span></span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-commonjs&#x27;</span></span><br><span class="line"><span class="comment">// 大小写转换</span></span><br><span class="line"><span class="keyword">import</span> changeCase <span class="keyword">from</span> <span class="string">&#x27;change-case&#x27;</span></span><br><span class="line"><span class="comment">// 创建作者，日期，库名等注释</span></span><br><span class="line"><span class="keyword">import</span> createBanner <span class="keyword">from</span> <span class="string">&#x27;create-banner&#x27;</span></span><br><span class="line"><span class="comment">// 语法降级,@babel/preset-env,@babel/core</span></span><br><span class="line"><span class="keyword">import</span> &#123; babel &#125; <span class="keyword">from</span> <span class="string">&#x27;@rollup/plugin-babel&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pkg <span class="keyword">from</span> <span class="string">&#x27;./package.json&#x27;</span> assert &#123; <span class="attr">type</span>: <span class="string">&quot;json&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = changeCase.<span class="title function_">pascalCase</span>(pkg.<span class="property">name</span>)</span><br><span class="line"><span class="keyword">const</span> banner = <span class="title function_">createBanner</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">`<span class="subst">$&#123;name&#125;</span>.js`</span>,</span><br><span class="line">      <span class="attr">year</span>: <span class="string">&#x27;2023-present&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 入口文件</span></span><br><span class="line">    <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">    <span class="comment">// input: [&quot;src/index.js&quot;, &quot;src/album.js&quot;],</span></span><br><span class="line">    <span class="comment">// input: &#123;</span></span><br><span class="line">    <span class="comment">//     foo: &quot;src/index.js&quot;,</span></span><br><span class="line">    <span class="comment">//     bar: &quot;src/album.js&quot;</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// 输出路径</span></span><br><span class="line">    <span class="attr">output</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">file</span>: <span class="string">`dist/<span class="subst">$&#123;pkg.name&#125;</span>.amd.js`</span>,</span><br><span class="line">            banner,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&quot;amd&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            banner,</span><br><span class="line">            name,</span><br><span class="line">            <span class="attr">file</span>: <span class="string">`dist/<span class="subst">$&#123;pkg.name&#125;</span>.js`</span>,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            banner,</span><br><span class="line">            <span class="attr">file</span>: <span class="string">`dist/<span class="subst">$&#123;pkg.name&#125;</span>.common.js`</span>,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&#x27;cjs&#x27;</span>,</span><br><span class="line">            <span class="attr">exports</span>: <span class="string">&#x27;auto&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            banner,</span><br><span class="line">            <span class="attr">file</span>: <span class="string">`dist/<span class="subst">$&#123;pkg.name&#125;</span>.esm.js`</span>,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&#x27;esm&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            banner,</span><br><span class="line">            <span class="attr">file</span>: <span class="string">`dist/<span class="subst">$&#123;pkg.name&#125;</span>.iife.js`</span>,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&#x27;iife&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">json</span>(),</span><br><span class="line">        <span class="comment">// resolve(),</span></span><br><span class="line">        <span class="title function_">babel</span>(&#123;</span><br><span class="line">            <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>],</span><br><span class="line">            <span class="attr">babelHelpers</span>: <span class="string">&#x27;bundled&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">                [</span><br><span class="line">                    <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                    <span class="string">&quot;modules&quot;</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;test&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;istanbul&quot;</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title function_">commonjs</span>(),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建 src 文件夹放置源码，dist 文件夹放置打包文件，src/index.js</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Progress</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 调用超类的构造器</span></span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="comment">// 创建一个影子 DOM 树并将其附加到这个元素</span></span><br><span class="line">        <span class="comment">// 设置为 this.shadowRoot 的值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123;<span class="attr">mode</span>:<span class="string">&#x27;open&#x27;</span>&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 克隆模板，定义自定义组件的后代及样式</span></span><br><span class="line">        <span class="comment">// 然后把内容追加到影子根节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createTemplate</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">template</span>.<span class="property">content</span>.<span class="title function_">cloneNode</span>(<span class="literal">true</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 内容模板</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">contentTemplate</span> = <span class="string">`正在安装 #percentage %`</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取得对影子DOM中重要元素的引用</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progress</span> = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.progress&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progressContent</span> = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.progress-content&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progressWrapper</span> = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.progress-wrapper&#x27;</span>);</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化进度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">start</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">max</span> = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 钩子函数： 自定义元素增加、删除、修改属性时 ，调用。</span></span><br><span class="line">    <span class="comment">// 触发此回调函数，必须监听变化的属性static get observedAttributes() ,返回监听的属性。</span></span><br><span class="line">    <span class="title function_">attributeChangedCallback</span>(<span class="params">name, oldValue, newValue</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(name, oldValue, newValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建一个 template 元素，用于保存样式和元素树,可以在每个 元素的实例中使用它门</span></span><br><span class="line">    <span class="title function_">createTemplate</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> template = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">        template.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;style&gt;</span></span><br><span class="line"><span class="string">              .progress-wrapper &#123;</span></span><br><span class="line"><span class="string">                position: relative;</span></span><br><span class="line"><span class="string">                overflow: hidden;</span></span><br><span class="line"><span class="string">                width: 300px;</span></span><br><span class="line"><span class="string">                height: 20px;</span></span><br><span class="line"><span class="string">                text-align: center;</span></span><br><span class="line"><span class="string">                border-radius: 10px;</span></span><br><span class="line"><span class="string">                background-color: #cdeee3;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">              .progress &#123;</span></span><br><span class="line"><span class="string">                width: 0%;</span></span><br><span class="line"><span class="string">                height: 100%;</span></span><br><span class="line"><span class="string">                transition: all 200ms;</span></span><br><span class="line"><span class="string">                background-color: #3da985;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">              p &#123;</span></span><br><span class="line"><span class="string">                font-size: 12px;</span></span><br><span class="line"><span class="string">                font-weight: bolder;</span></span><br><span class="line"><span class="string">                position: absolute;</span></span><br><span class="line"><span class="string">                z-index: 10;</span></span><br><span class="line"><span class="string">                top: 0;</span></span><br><span class="line"><span class="string">                left: 0;</span></span><br><span class="line"><span class="string">                width: 100%;</span></span><br><span class="line"><span class="string">                height: 100%;</span></span><br><span class="line"><span class="string">                margin: 0;</span></span><br><span class="line"><span class="string">                transition: all 200ms;</span></span><br><span class="line"><span class="string">                background-image: linear-gradient(to right, #cdeee3 0%, #3da985 0%);</span></span><br><span class="line"><span class="string">                -webkit-background-clip: text;</span></span><br><span class="line"><span class="string">                -webkit-text-fill-color: transparent;</span></span><br><span class="line"><span class="string">                display: flex;</span></span><br><span class="line"><span class="string">                align-items: center;</span></span><br><span class="line"><span class="string">                justify-content: center;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &lt;/style&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;progress-wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;progress&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;p class=&quot;progress-content&quot;&gt;正在安装 0%&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">template</span> = template;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新进度条</span></span><br><span class="line">    <span class="title function_">updateProgress</span>(<span class="params">percentage</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progress</span>.<span class="property">style</span>.<span class="property">width</span> = percentage + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progressContent</span>.<span class="property">innerText</span> = <span class="variable language_">this</span>.<span class="property">contentTemplate</span>.<span class="title function_">replace</span>(<span class="string">&quot;#percentage&quot;</span>, percentage);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">progressContent</span>.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">`linear-gradient(to right, #cdeee3 <span class="subst">$&#123;percentage&#125;</span>%, #3da985 <span class="subst">$&#123;percentage&#125;</span>%)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 常用属性读写</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">percentage</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">start</span> &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">width</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">progressWrapper</span>.<span class="property">style</span>.<span class="property">width</span> &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">height</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">progressWrapper</span>.<span class="property">style</span>.<span class="property">height</span> &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">fontSize</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">progressContent</span>.<span class="property">style</span>.<span class="property">fontSize</span> &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">percentage</span>(<span class="params">pt</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">String</span>(pt).<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(pt &gt;= <span class="variable language_">this</span>.<span class="property">max</span>) pt = <span class="variable language_">this</span>.<span class="property">max</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">start</span> = pt;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateProgress</span>(pt);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setAttribute</span>(<span class="string">&quot;data-percentage&quot;</span>, pt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">height</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(val) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">progressWrapper</span>.<span class="property">style</span>.<span class="property">height</span> = val;</span><br><span class="line">            <span class="keyword">let</span> fontSize = <span class="built_in">parseInt</span>(<span class="number">1</span>/<span class="number">3</span> * (+<span class="title class_">String</span>(val).<span class="title function_">replace</span>(<span class="string">&quot;px&quot;</span>, <span class="string">&quot;&quot;</span>)))</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">fontSize</span> = fontSize + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">width</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(val) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">progressWrapper</span>.<span class="property">style</span>.<span class="property">width</span> = val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">fontSize</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(val) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">progressContent</span>.<span class="property">style</span>.<span class="property">fontSize</span> = val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这个静态属性对 attributeChangedCallback 方法是必须的，只有在这个数组中列出的属性名才会触发对该方法的调用</span></span><br><span class="line"><span class="title class_">Progress</span>.<span class="property">observedAttributes</span> = [<span class="string">&#x27;innerText&#x27;</span>, <span class="string">&#x27;value&#x27;</span>,<span class="string">&#x27;data-percentage&#x27;</span>];</span><br><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;my-progress&#x27;</span>, <span class="title class_">Progress</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Progress</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>运行打包</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-c 表示使用配置文件，不加默认不使用</span></span><br><span class="line">yarn rollup -c</span><br></pre></td></tr></table></figure></li><li><p>上传至npm</p><blockquote><p>准备：注册npm账号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消淘宝镜像，设置npm官方地址，否则发布不了</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看npm配置</span></span><br><span class="line">npm config list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果设置了淘宝镜像，执行以下命令,一定要是https 否则会报错</span></span><br><span class="line">npm config set registry=https://registry.npmjs.org</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录 npm 账户，提示🔗跳转至网页登录</span></span><br><span class="line">npm adduser</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查是否登录，登录成功会显示你的用户名</span></span><br><span class="line">npm who am i</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发布, 此处如果报错403，重名错误。修改package.json name 属性。应为全网name不能重复。提交时可以增加 忽略文件 .gitignore</span></span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure></blockquote></li></ol><blockquote><p>结语： 插件写的很拉，主要是体验一把过程</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;工欲善其事，必先利其器。首先去找适合写插件的项目包管理工具。对比了webpack,rollup,gulp,parcel&lt;/p&gt;
&lt;p&gt;经过一通对比就选中了 &lt;strong&gt;rollup&lt;/strong&gt;，具体请自行了解。简单说一下我们熟知的&lt;strong&gt;vue&lt;/strong&gt;,&lt;strong&gt;react&lt;/strong&gt;,&lt;strong&gt;taro-ui&lt;/strong&gt; 等 就是使用的 rolluojs 打包的&lt;/p&gt;
&lt;p&gt;自己写了一个很简单的插件上传发布到npm。具体步骤如下：&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="npm" scheme="https://wyf195075595.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>打包工具对比</title>
    <link href="https://wyf195075595.github.io/2023/03/21/programming/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/%E6%8B%93%E5%B1%95/"/>
    <id>https://wyf195075595.github.io/2023/03/21/programming/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/%E6%8B%93%E5%B1%95/</id>
    <published>2023-03-21T08:10:10.000Z</published>
    <updated>2023-03-26T06:13:06.685Z</updated>
    
    <content type="html"><![CDATA[<h3 id="webpack、gulp、rollup-使用对比和适用场景"><a href="#webpack、gulp、rollup-使用对比和适用场景" class="headerlink" title="webpack、gulp、rollup 使用对比和适用场景"></a><a href="https://my.oschina.net/nieyao/blog/5506339">webpack、gulp、rollup 使用对比和适用场景</a></h3><h4 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h4><blockquote><p>打包工具，根据我们的资源依赖树，分不同类型打包成静态资源，支持热更新，代码模块切分，three-shaking、异步加载等、</p></blockquote><p><strong>特性：</strong></p><blockquote><p>不同资源的模块打包 热更新 代码分割 静态资源压缩 异步加载 three-shaking</p></blockquote><p><strong>适用场景</strong></p><blockquote><p>应用程序打包</p></blockquote><h4 id="rollup"><a href="#rollup" class="headerlink" title="rollup"></a><a href="https://www.oschina.net/action/GoToLink?url=https://www.rollupjs.com/guide/faqs">rollup</a></h4><blockquote><p>Rollup 是一个<strong>模块</strong>打包工具，可以将我们按照 ESM (ES2015 Module) 规范编写的源码构建输出如下格式:</p></blockquote><ul><li>IIFE: 自执行函数，可通过 &lt;script&gt; 标签加载</li><li>AMD: 通过 RequireJS 加载</li><li>CommonJS: Node 默认的模块规范，可通过 Webpack 加载</li><li>UMD: 兼容 IIFE, AMD, CJS 三种模块规范</li><li>ESM: ES2015 Module 规范，可用 Webpack, Rollup 加载 -</li></ul><p><strong>特性：</strong></p><blockquote><p>支持动态导入。</p><p>支持 tree shaking。仅加载模块里用得到的函数以减小文件大小。</p><p>Scope Hoisting。 rollup 可以将所有小文件生成到一个大文件中，所有代码都在同一个函数作用域里:， 不会像 Webpack 那样用很多函数来包装模块。</p><p>没有其他冗余代码，执行很快。除了必要的 cjs, umd 头外，bundle 代码基本和源码差不多，也没有奇怪的 <strong>webpack_require</strong>, Object.defineProperty 之类的东西，</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>不支持热更新功能；对于 commonjs 模块，需要额外的插件将其转化为 es2015 供 rollup 处理；无法进行公共代码拆分。 运行时态的动态导入 dynamic imports at runtime.</p><p>rollup 通过插件来编译处理各类静态资源：</p></blockquote><ul><li>rollup-plugin-typescript2</li><li>rollup-plugin-babel</li><li>rollup-plugin-uglify</li><li>rollup-plugin-commonjs</li><li>rollup-plugin-postcss</li><li>rollup-plugin-img</li><li>rollup-plugin-json</li></ul><p><strong>适用场景：</strong></p><blockquote><p>由纯 js 开发的第三方库； 需要生成单一的 umd 文件的场景</p></blockquote><h4 id="gulp"><a href="#gulp" class="headerlink" title="gulp"></a><a href="https://www.oschina.net/action/GoToLink?url=https://www.gulpjs.com.cn/docs/getting-started/quick-start/">gulp</a></h4><blockquote><p>自动化构建工具，把项目工作抽象成自动化任务 用 gulp 构建自动化工作流，处理项目中的资源，基于流式操作。</p></blockquote><p><strong>特性</strong> </p><blockquote><p>gulp 文档简单，学习成本低，使用简单；对大量源文件可以进行流式处理，借助插件，可以对文件类型进行多种操作处理。</p></blockquote><p><strong>适用场景</strong> </p><blockquote><p>静态资源密集操作型场景，主要用于 css、图片等静态资源的处理操作。 文件处理：</p></blockquote><p>gulp 通过各种中间件处理静态资源的编译：</p><ul><li>gulp-load-plugins：自动加载 package.json 中的 gulp 插件</li><li>gulp-rename： 重命名</li><li>gulp-uglify：文件压缩</li><li>gulp-concat：文件合并</li><li>gulp-less：编译 less</li><li>gulp-sass：编译 sass</li><li>gulp-clean-css：压缩 CSS 文件</li><li>gulp-htmlmin：压缩 HTML 文件</li><li>gulp-babel: 使用 babel 编译 JS 文件</li><li>gulp-jshint：jshint 检查</li><li>gulp-imagemin：压缩 jpg、png、gif 等图片</li><li>gulp-livereload：当代码变化时，它可以帮我们自动刷新页面</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;webpack、gulp、rollup-使用对比和适用场景&quot;&gt;&lt;a href=&quot;#webpack、gulp、rollup-使用对比和适用场景&quot; class=&quot;headerlink&quot; title=&quot;webpack、gulp、rollup 使用对比和适用场景&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="webpack" scheme="https://wyf195075595.github.io/categories/webpack/"/>
    
    
    <category term="eslint" scheme="https://wyf195075595.github.io/tags/eslint/"/>
    
  </entry>
  
  <entry>
    <title>Linux 安装 redis</title>
    <link href="https://wyf195075595.github.io/2023/03/09/programming/linux/redis/"/>
    <id>https://wyf195075595.github.io/2023/03/09/programming/linux/redis/</id>
    <published>2023-03-09T00:23:10.000Z</published>
    <updated>2023-03-09T01:25:43.194Z</updated>
    
    <content type="html"><![CDATA[<h3 id="linux-安装-redis"><a href="#linux-安装-redis" class="headerlink" title="linux 安装 redis"></a>linux 安装 redis</h3><p>1、去<a href="redis.io">官网</a>下载 redis ,上传解压。</p><p>然后会发现 文件夹中有 MakeFile 文件，这是编译所需文件</p><p>2、编译</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p>3、安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><p>安装后得命令在 /usr/local/bin 目录下</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;linux-安装-redis&quot;&gt;&lt;a href=&quot;#linux-安装-redis&quot; class=&quot;headerlink&quot; title=&quot;linux 安装 redis&quot;&gt;&lt;/a&gt;linux 安装 redis&lt;/h3&gt;&lt;p&gt;1、去&lt;a href=&quot;redis.io&quot;&gt;</summary>
      
    
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/categories/linux/"/>
    
    
    <category term="redis" scheme="https://wyf195075595.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>浏览器知识</title>
    <link href="https://wyf195075595.github.io/2023/03/08/computer/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    <id>https://wyf195075595.github.io/2023/03/08/computer/%E6%B5%8F%E8%A7%88%E5%99%A8/</id>
    <published>2023-03-08T05:23:10.000Z</published>
    <updated>2023-03-08T05:29:33.102Z</updated>
    
    <content type="html"><![CDATA[<h3 id="在浏览器中找到拓展程序位置"><a href="#在浏览器中找到拓展程序位置" class="headerlink" title="在浏览器中找到拓展程序位置"></a>在浏览器中找到拓展程序位置</h3><blockquote><p>地址栏输入chrome:version 回车，用资源管理器打开”个人资料路径”栏的路径,该路径下的Extensions文件夹即默认的扩展安装路径</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;在浏览器中找到拓展程序位置&quot;&gt;&lt;a href=&quot;#在浏览器中找到拓展程序位置&quot; class=&quot;headerlink&quot; title=&quot;在浏览器中找到拓展程序位置&quot;&gt;&lt;/a&gt;在浏览器中找到拓展程序位置&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;地址栏输入chrome:v</summary>
      
    
    
    
    <category term="computer" scheme="https://wyf195075595.github.io/categories/computer/"/>
    
    
    <category term="浏览器" scheme="https://wyf195075595.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>springboot基础</title>
    <link href="https://wyf195075595.github.io/2023/03/02/programming/java/springboot/"/>
    <id>https://wyf195075595.github.io/2023/03/02/programming/java/springboot/</id>
    <published>2023-03-02T08:40:00.000Z</published>
    <updated>2023-03-21T06:52:26.065Z</updated>
    
    <content type="html"><![CDATA[<h3 id="配置容器"><a href="#配置容器" class="headerlink" title="配置容器"></a>配置容器</h3><ul><li><p>xml配置容器</p><p>  就是spring 的 xml文件中那样的写法</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> = <span class="string">&quot;createStudent&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.Student&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>javaConfig配置容器</p><p>  采用java类的方式来配置</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 表示当前类是作为配置文件使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    创建方法，方法的返回值是对象。在方法上加上@Bean</span></span><br><span class="line"><span class="comment">    方法的返回值对象就注入到容器中。方法名是默认的Bean id</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">createStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        stu.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> stu;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  把XML文件住的的Bean导入到容器</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  引入外部属性配置文件</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:comfig.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  扫描组件注解</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackage=&quot;com.xxx.service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="spring-boot"><a href="#spring-boot" class="headerlink" title="spring boot"></a>spring boot</h3><blockquote><p>它是spring中的一个成员，可以简化Spring MVC的使用，他的核心还是IOC容器。</p></blockquote><p>特点：</p><ol><li>内嵌 tomcat，jetty，Undertow</li><li>提供起步依赖，简化配置</li><li>自动配置spring和第三方库</li><li>健康检查，统计，外部化配置</li><li>不同生成代码，不用使用xml做配置</li></ol><span id="more"></span><h3 id="创建springboot项目"><a href="#创建springboot项目" class="headerlink" title="创建springboot项目"></a>创建springboot项目</h3><ul><li><p>通过 IDEA 方式</p></li><li><p>浏览器访问 start.springboot.io</p></li><li><p>创建一个普通maven项目然后在<strong>pom</strong>文件中加入parent</p></li></ul><h3 id="spring注解"><a href="#spring注解" class="headerlink" title="spring注解"></a>spring注解</h3><p>@SpringBootApplication</p><blockquote><p>此注解由 3 个注解组成</p><ul><li><p>@SpringBootConfiguration 注解标注类 可作为配置文件使用，注册Bean</p><ul><li>@Configuration  </li></ul></li><li><p>@EnableAutoConfiguration 启用自动配置</p></li><li><p>@ComponentScan  组件扫描器，从主文件位置扫描</p></li></ul></blockquote><h3 id="spring-boot-的配置文件"><a href="#spring-boot-的配置文件" class="headerlink" title="spring boot 的配置文件"></a>spring boot 的配置文件</h3><blockquote><p>配置文件名： application</p><p>拓展名：（properties(k:v), yml(k: v)）</p><p>两种格式同时存在系统默认读取 application.properties</p></blockquote><p>application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">uri-encoding:</span>  <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">dzi:</span></span><br><span class="line">    <span class="attr">install:</span></span><br><span class="line">      <span class="attr">path:</span>  <span class="string">/home/image2dzi/</span></span><br><span class="line">  <span class="attr">enable:</span></span><br><span class="line">    <span class="attr">gpu:</span>  <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">charset:</span> <span class="string">UTF-8</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10240MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">11000MB</span></span><br><span class="line">      <span class="attr">file-size-threshold:</span> <span class="string">512KB</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">labelSystem</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">dbajydw1234</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.1.232:3306/labelsystem_test?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></span><br><span class="line">      <span class="attr">driver-class-name:</span>  <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">initial-size:</span>  <span class="number">5</span></span><br><span class="line">  <span class="comment">#devtools:</span></span><br><span class="line">  <span class="comment">#  restart:</span></span><br><span class="line">  <span class="comment">#    enabled: true  #设置开启热部署</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">com.pcl.pojo</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">labelsystem.log</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">logs/</span></span><br><span class="line"><span class="attr">minio:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://192.168.1.245:9000/</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">minioadmin</span></span><br><span class="line">  <span class="attr">password:</span>  <span class="string">minioadmin</span></span><br><span class="line"><span class="comment">#  存储上传的zip文件以供备份/label-zip/xx.zip</span></span><br><span class="line">  <span class="attr">zipBucketName:</span> <span class="string">label-zip</span></span><br><span class="line"><span class="comment">#  存储解压的图片/label-img/datasetName/xx.jpg</span></span><br><span class="line">  <span class="attr">imgBucketName:</span> <span class="string">label-img</span></span><br><span class="line"><span class="comment">#  存储自动标注后的xml文件/label-xml/datasetName/xx.xml</span></span><br><span class="line">  <span class="attr">xmlBucketName:</span> <span class="string">label-xml</span></span><br><span class="line"><span class="comment">#  存储自动标注后的预览图片base64编码/label-baseCode/datasetName/xx.txt</span></span><br><span class="line">  <span class="attr">baseCodeBucketName:</span> <span class="string">label-basecode</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#算法有关参数配置</span></span><br><span class="line"><span class="attr">alogrithom:</span></span><br><span class="line">  <span class="comment">#算法访问链接</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://36.7.72.75:9148/Upload</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#直接访问的minio存储位置/home</span></span><br><span class="line"><span class="attr">pictureURL:</span> <span class="string">http://192.168.1.245:18088</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程访问服务器配置</span></span><br><span class="line"><span class="attr">sftp:</span></span><br><span class="line">  <span class="comment">#服务器ip</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.245</span></span><br><span class="line">  <span class="comment">#ssh端口</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">  <span class="comment">#用户名</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">zkrd</span></span><br><span class="line">  <span class="comment">#密码</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">zkrd12#$</span></span><br><span class="line">  <span class="comment"># 上传标注文件服务器路径</span></span><br><span class="line">  <span class="comment">#  uploadAnnotateFile: /home/zkrd/label_system/</span></span><br><span class="line">  <span class="attr">uploadAnnotateFile:</span> <span class="string">F:/sampleManagement/</span></span><br><span class="line">  <span class="comment">#连接池参数</span></span><br><span class="line">  <span class="attr">pool:</span></span><br><span class="line">    <span class="comment">#对象池中管理的最多对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-total:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最大的空闲对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最小的空闲对象个数。默认值是0</span></span><br><span class="line">    <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 分页配置</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="attr">helper-dialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">reasonable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">support-methods-arguments:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">params:</span> <span class="string">count=countsql</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="配置文件多环境配置"><a href="#配置文件多环境配置" class="headerlink" title="配置文件多环境配置"></a>配置文件多环境配置</h4><p>application-dev.yml    开发环境</p><p>application-prod.yml    生产环境</p><p>application.properties/application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活使用按个配置文件</span></span><br><span class="line"><span class="string">spring.profiles.active=dev</span></span><br></pre></td></tr></table></figure><h4 id="配置文件数据映射为Java对象"><a href="#配置文件数据映射为Java对象" class="headerlink" title="配置文件数据映射为Java对象"></a>配置文件数据映射为Java对象</h4><p>自定义属性</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sftp:</span></span><br><span class="line">  <span class="comment">#服务器ip</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.245</span></span><br><span class="line">  <span class="comment">#ssh端口</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">  <span class="comment">#用户名</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">zkrd</span></span><br><span class="line">  <span class="comment">#密码</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">zkrd12#$</span></span><br></pre></td></tr></table></figure><p>Java对象中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;sftp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="spring-中获取容器"><a href="#spring-中获取容器" class="headerlink" title="spring 中获取容器"></a>spring 中获取容器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line"></span><br><span class="line">app.getBean(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="CommandLineRunner"><a href="#CommandLineRunner" class="headerlink" title="CommandLineRunner"></a>CommandLineRunner</h4><blockquote><p>开发中可能会有这样的情景。需要在容器启动后执行一些内容。比如读取配置文件，数据库连接之类的。SpringBoot 给我们提供了两个接口来帮助我们实现这种需求。这两个接口分别为 <strong>CommandLineRunner</strong> 和 <strong>ApplicationRunner</strong>。他们的执行时机为容器启动完成的时候这两个接口中有一个 run 方法，我们只需要实现这个方法即可。这两个接口的不同之处而在于:ApplicationRunner 中 run 方法的参数为 ApplicationArguments，CommandLineRunner<br>接口中run 方法的参数为 String 数组</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我的 Runner run 方法调用了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此组件会在主方法之前调用</p><h3 id="web组件"><a href="#web组件" class="headerlink" title="web组件"></a>web组件</h3><h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><blockquote><p>能拦截 Control 的接口请求</p></blockquote><p>创建 MyInterceptor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"><span class="comment">// 返回 true 放行，返回false 拦截</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> HandlerInterceptor.<span class="built_in">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注册拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">// 添加拦截器对象，注入到容器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line"><span class="comment">//        WebMvcConfigurer.super.addInterceptors(registry);</span></span><br><span class="line">        <span class="comment">// 创建过滤器，使用自己的 Filter</span></span><br><span class="line">        <span class="type">MyInterceptor</span> <span class="variable">myInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyInterceptor</span>();</span><br><span class="line">        <span class="type">InterceptorRegistration</span> <span class="variable">interceptor</span> <span class="operator">=</span> registry.addInterceptor(myInterceptor);</span><br><span class="line">        <span class="comment">// 指定拦截的URL地址</span></span><br><span class="line">        String[] path  = &#123;<span class="string">&quot;/*&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">// 指定不拦截的地址</span></span><br><span class="line">        String[] excludePath  = &#123;<span class="string">&quot;/login&quot;</span>&#125;;</span><br><span class="line">        interceptor.addPathPatterns()</span><br><span class="line">                .addPathPatterns(path)</span><br><span class="line">                .excludePathPatterns(excludePath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="springboot-中使用-servlet"><a href="#springboot-中使用-servlet" class="headerlink" title="springboot 中使用 servlet"></a>springboot 中使用 servlet</h4><p>新建servlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        res.setContentType(<span class="string">&quot;text/html;charset=utf-8;&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> res.getWriter();</span><br><span class="line">        writer.println(<span class="string">&quot;servlet 请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注册servlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistorServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">ServletRegistrationBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ServletRegistrationBean bean = new ServletRegistrationBean&lt;&gt;(new TestService(), &quot;/servlet&quot;);</span></span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>());</span><br><span class="line">        bean.setServlet(<span class="keyword">new</span> <span class="title class_">TestService</span>());</span><br><span class="line">        bean.setUrlMappings(<span class="string">&quot;/servlet1&quot;</span>,<span class="string">&quot;/servlet2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p>创建 MyFilter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器启动&quot;</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注册 Filter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">filterRegisterBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">        bean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加字符集过滤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">filterEncoding</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">    <span class="comment">// 框架内置的过滤器 CharacterEncodingFilter</span></span><br><span class="line">    <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">    <span class="comment">// 指定编码方式</span></span><br><span class="line">    filter.setEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">// 让 req,res 对象都使用 utf-8</span></span><br><span class="line">    filter.setForceEncoding(<span class="literal">true</span>);</span><br><span class="line">    bean.setFilter(filter);</span><br><span class="line">    bean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启用字符集过滤器</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">encoding:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span> <span class="comment"># springboot 默认启用配置了字符集 IOS-8859-1</span></span><br></pre></td></tr></table></figure><p>其实我没可以使用spring boot默认的字符集配置，只需要改变默认字符集</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servlet:</span></span><br><span class="line">  <span class="attr">encoding:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># springboot 默认配置了字符集 IOS-8859-1</span></span><br><span class="line">    <span class="attr">charset:</span> <span class="string">utf-8</span></span><br><span class="line">    <span class="attr">force:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="集成mybatis"><a href="#集成mybatis" class="headerlink" title="集成mybatis"></a>集成mybatis</h3><p>依赖：创建项目时选择 springWeb, MybaatisFragment, Mysql-Driver</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置数据库</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123465</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/mydb01?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">initial-size:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><p>创建 model，control，service, mapper</p><h4 id="Mapper-注解"><a href="#Mapper-注解" class="headerlink" title="@Mapper 注解"></a>@Mapper 注解</h4><blockquote><p>放在 mapper 接口上。每个mapper 都要加。它会自动生成 实现类</p></blockquote><h4 id="MapperScan"><a href="#MapperScan" class="headerlink" title="@MapperScan"></a>@MapperScan</h4><blockquote><p>配置扫描，可以给指定目录下文件添加 @Mapper注解。通常配置在项目主类上</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.xxx.mapper&quot;, &quot;com.xxx.dao&quot;&#125;)</span></span><br></pre></td></tr></table></figure><h4 id="指定-xml-文件所在文件目录位置"><a href="#指定-xml-文件所在文件目录位置" class="headerlink" title="指定 xml 文件所在文件目录位置"></a>指定 xml 文件所在文件目录位置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># 指定mapper文件位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><h4 id="指定日志输出格式"><a href="#指定日志输出格式" class="headerlink" title="指定日志输出格式"></a>指定日志输出格式</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">configuration:</span></span><br><span class="line">  <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.log4j.Log4jImpl</span></span><br></pre></td></tr></table></figure><h3 id="springboot事务管理"><a href="#springboot事务管理" class="headerlink" title="springboot事务管理"></a>springboot事务管理</h3><blockquote><p>在入口类使用注解 @EnableTransactionManagement 开启事务支持</p><p>在业务方法中 加入 @transactional 表示事务支持。</p></blockquote><h3 id="接口架构风格"><a href="#接口架构风格" class="headerlink" title="接口架构风格"></a>接口架构风格</h3><blockquote><p>API：可以指访问servlet，controller的url，调用其他程序的函数</p></blockquote><p>RESTful 风格</p><blockquote><p>Representational State Trasfer 【表现层状态转移】</p><p>它是一种架构风格和设计的理念，不是标准</p><p>优点：更简洁，更又层次</p><p><strong>使用url表示资源，使用http动作操作资源</strong></p></blockquote><p>相关注解：</p><p>@PathVariable: 从url中获取数据</p><p>@GetMapper: 支持get请求</p><p>@PostMapping：支持post请求方式’</p><p>@PutMapper: 支持put请求</p><p>@DeleteMapping：支持delete请求</p><p>@RestController: 符合注解，是@Controller和@ResponseBody组合</p><p>​    表示当前类的所有方法都加入 @ResponseBody</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@PathVariable</span> 获取url中数据</span></span><br><span class="line"><span class="comment"> &#123;id&#125; 定义路径变量</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryStudent/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">queryStudent</span><span class="params">(<span class="meta">@PathVariable(value=&quot;id&quot;)</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id=&quot;</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解总结"><a href="#注解总结" class="headerlink" title="注解总结"></a>注解总结</h3><h4 id="Spring-SpringMVC-SpringBoot"><a href="#Spring-SpringMVC-SpringBoot" class="headerlink" title="Spring + SpringMVC + SpringBoot"></a>Spring + SpringMVC + SpringBoot</h4><p><strong>创建对象的:</strong><br>@Contro1ler: 放在类的上面，创建控制器对象，注入到容器中</p><p>@RestContro11er: 放在类的上面，创建控制器对象，注入到容器中。<br>作用: 复合注解是</p><p>@Contro1ler ，@ResponseBody，使用这个注解类的，里面的控制器方法的返回值都是数据</p><p>@Service :放在业务层的实现类上面，创建service对象，注入到容器</p><p>@Repository : 放在dao层的实现类上面，创建dao对象，放入到容器。 没有使用这个注解，是因为现在使用MyBatis梅架，dao对象是MyBatis通过代理生成的。 不需要使用</p><p>@Component: 所以没有使用。放在类的上面，创建此类的对象，放入到容器中。</p><p><strong>赋值的:</strong></p><p>@Value: 简单类型的赋值， 例如 在属性的上面使用@Value(“李四”) private string name@vaTue :还可以使用@Value,获取配置文件者的数据(properties或ym])。@Value(“sfserver .port}”) private Integer port</p><p>@Autowired: 引用类型赋值自动注入的，支持byName，byType.默认是byType 。放在属性的上面，也可以放在构造方法的上面。 推荐是放在构造方法的上面给引用类型赋值，使用byName方式。</p><p>@Qualifer: @Qualifer都是Spring框架提供的。</p><p>@Resource :来自idk中的定义， javax.annotation。 实现引用类型的自动注入， 支持byName，byType.黑认是byWame，如果byName失败， 再使用byType注入。 在属性上面使用</p><p><strong>其他</strong></p><p>@Configuration :放在类的上面，表示这是个配置类，相当于xml配置文件</p><p>@Bean: 放在方法的上面， 把方法的返回值对象，注入到spring容器中。</p><p>@ImportResource :加载其他的xm配置文件， 把文件中的对象注入到spring容器中</p><p>@PropertySource :读取其他的properties属性配置文件</p><p>@ComponentScan :扫描器，指定包名，扫描注解的</p><p>@ResponseBody: 放在方法的上面，表示方法的返回值是数据，不是视图</p><p>@RequestBody : 把请求体中的数据，读取出来， 转为iava对象使用。</p><p>@ControlTerAdvice:控制器增强， 放在类的上面， 表示此类提供了方法，可以对controller增强功能。</p><p>@ExceptionHandler : 处理异常的，放在方法的上面</p><p><strong>SpringBoot中使用的注解</strong></p><p>@SpringBootConfiguration: 放在启动类上面， 包含了@SpringBootApplication :@EnabTeAutoConfiguration, @ComponentScan</p><p><strong>MyBatis相关的注解</strong></p><p>@Mapper : 放在类的上面 ， 让MyBatis找到接口，创建他的代理对象(MapperScan :放在主类的上面 ， 指定扫描的包， 把这个包中的所有接口都创建代理对象。 对象注入到容器中</p><p>@Param :放在dao接口的方法的形参前面，作为命名参数使用的。</p><p><strong>Dubbo注解</strong></p><p>@Dubboservice: 在提供者端使用的，暴露服务的， 放在接口的实现类上面@DubboReference: 在消费者端使用的， 引用远程服务， 放在属性上面使用。@EnableDubbo : 放在主类上面， 表示当前引用启用Dubbo功能。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;配置容器&quot;&gt;&lt;a href=&quot;#配置容器&quot; class=&quot;headerlink&quot; title=&quot;配置容器&quot;&gt;&lt;/a&gt;配置容器&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;xml配置容器&lt;/p&gt;
&lt;p&gt;  就是spring 的 xml文件中那样的写法&lt;/p&gt;
  &lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&amp;quot;createStudent&amp;quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;com.xxx.Student&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;bean&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;li&gt;&lt;p&gt;javaConfig配置容器&lt;/p&gt;
&lt;p&gt;  采用java类的方式来配置&lt;/p&gt;
  &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Configuration&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// 表示当前类是作为配置文件使用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;SpringConfig&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;    	创建方法，方法的返回值是对象。在方法上加上@Bean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;    	方法的返回值对象就注入到容器中。方法名是默认的Bean id&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;    */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Bean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Student &lt;span class=&quot;title function_&quot;&gt;createStudent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;Student&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;stu&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Student&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        stu.setName(&lt;span class=&quot;string&quot;&gt;&amp;quot;张三&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; stu;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;  把XML文件住的的Bean导入到容器&lt;/p&gt;
  &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Configuration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@ImportResource(&amp;quot;classpath:applicationContext.xml&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;SpringConfig&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;  引入外部属性配置文件&lt;/p&gt;
  &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Configuration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@PropertySource(&amp;quot;classpath:comfig.properties&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;SpringConfig&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;  扫描组件注解&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Configuration&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@ComponentScan(basePackage=&amp;quot;com.xxx.service&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;SpringConfig&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h3 id=&quot;spring-boot&quot;&gt;&lt;a href=&quot;#spring-boot&quot; class=&quot;headerlink&quot; title=&quot;spring boot&quot;&gt;&lt;/a&gt;spring boot&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;它是spring中的一个成员，可以简化Spring MVC的使用，他的核心还是IOC容器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;特点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;内嵌 tomcat，jetty，Undertow&lt;/li&gt;
&lt;li&gt;提供起步依赖，简化配置&lt;/li&gt;
&lt;li&gt;自动配置spring和第三方库&lt;/li&gt;
&lt;li&gt;健康检查，统计，外部化配置&lt;/li&gt;
&lt;li&gt;不同生成代码，不用使用xml做配置&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="springboot基础" scheme="https://wyf195075595.github.io/tags/springboot%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>拓展</title>
    <link href="https://wyf195075595.github.io/2023/02/22/programming/java/other/"/>
    <id>https://wyf195075595.github.io/2023/02/22/programming/java/other/</id>
    <published>2023-02-22T08:00:00.000Z</published>
    <updated>2023-05-24T06:46:06.913Z</updated>
    
    <content type="html"><![CDATA[<h3 id="扫描远程文件"><a href="#扫描远程文件" class="headerlink" title="扫描远程文件"></a>扫描远程文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接sftp服务器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host     主机</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port     端口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ChannelSftp <span class="title function_">connect</span><span class="params">(String host, <span class="type">int</span> port, String username,String password)</span> &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line">            <span class="comment">//jsch.getSession(username, host, port);</span></span><br><span class="line">            <span class="type">Session</span> <span class="variable">sshSession</span> <span class="operator">=</span> jsch.getSession(username, host, port);</span><br><span class="line">            System.out.println(<span class="string">&quot;Session created.&quot;</span>);</span><br><span class="line">            sshSession.setPassword(password);</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">sshConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            sshConfig.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">            sshSession.setConfig(sshConfig);</span><br><span class="line">            sshSession.connect();</span><br><span class="line">            System.out.println(<span class="string">&quot;Session connected.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Opening Channel.&quot;</span>);</span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> sshSession.openChannel(<span class="string">&quot;sftp&quot;</span>);</span><br><span class="line">            channel.connect();</span><br><span class="line">            sftp = (ChannelSftp) channel;</span><br><span class="line">            System.out.println(<span class="string">&quot;Connected to &quot;</span> + host + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sftp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列出目录下的文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> directory 要列出的目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sftp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SftpException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Vector <span class="title function_">listFiles</span><span class="params">(String directory, ChannelSftp sftp)</span> <span class="keyword">throws</span> SftpException &#123;</span><br><span class="line">        <span class="keyword">return</span> sftp.ls(directory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：</span></span><br><span class="line"></span><br><span class="line"><span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> connect(HOST, PORT, USER, PWD);</span><br></pre></td></tr></table></figure><h3 id="本地文件扫描"><a href="#本地文件扫描" class="headerlink" title="本地文件扫描"></a>本地文件扫描</h3><blockquote><p><a href="https://blog.csdn.net/codeLife1993/article/details/81906996">参考</a></p></blockquote><span id="more"></span><h3 id="解析JSON文件"><a href="#解析JSON文件" class="headerlink" title="解析JSON文件"></a>解析JSON文件</h3><blockquote><p>我们用来解析json格式的jar包有很多，jackson，<a href="https://so.csdn.net/so/search?q=fastjson&spm=1001.2101.3001.7020">fastjson</a>，gson都行。但本人喜欢用fastjson。所以本篇都是以fastjson来解析json文件。</p><p><a href="https://blog.csdn.net/Jeck_wu/article/details/118755971">参考</a></p></blockquote><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:18080/api/upload-test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">webkitdirectory</span> <span class="attr">mozdirectory</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件夹&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:18080/api/upload-test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">multiple</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="保存到本地"><a href="#保存到本地" class="headerlink" title="保存到本地"></a>保存到本地</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/upload-test&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadTest</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file: files) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/Download/&quot;</span> + file.getOriginalFilename()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="保存至远程服务器"><a href="#保存至远程服务器" class="headerlink" title="保存至远程服务器"></a>保存至远程服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/upload-test&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadTest</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file: files) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] strings = file.getOriginalFilename().split(<span class="string">&quot;\\/&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> strings[strings.length - <span class="number">1</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">newPath</span> <span class="operator">=</span> file.getOriginalFilename().replace(fileName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            sftpUtil.upload(uploadAnnotateFile + newPath, fileName , file.getInputStream());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;上传结束&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="远程连接配置"><a href="#远程连接配置" class="headerlink" title="远程连接配置"></a>远程连接配置</h4><blockquote><p><a href="https://github.com/fengfangithub/study-sftp">参考</a></p></blockquote><ol><li><p>pom.xml 引入依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sftp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.55<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>application-xxx.yml 文件配置参数</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 远程访问服务器配置</span></span><br><span class="line"><span class="attr">sftp:</span></span><br><span class="line">  <span class="comment">#服务器ip</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.245</span></span><br><span class="line">  <span class="comment">#ssh端口</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">  <span class="comment">#用户名</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">zkrd</span></span><br><span class="line">  <span class="comment">#密码</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">zkrd12#$</span></span><br><span class="line">  <span class="comment"># 上传标注文件服务器路径</span></span><br><span class="line">  <span class="attr">uploadAnnotateFile:</span> <span class="string">/home/zkrd/label_system/</span></span><br><span class="line">  <span class="comment">#连接池参数</span></span><br><span class="line">  <span class="attr">pool:</span></span><br><span class="line">    <span class="comment">#对象池中管理的最多对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-total:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最大的空闲对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最小的空闲对象个数。默认值是0</span></span><br><span class="line">    <span class="attr">min-idle:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></li><li><p>封装类</p><p> SftpFactory.java</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.JSch;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.JSchException;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.BasePooledObjectFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.PooledObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.DefaultPooledObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpFactory</span> <span class="keyword">extends</span> <span class="title class_">BasePooledObjectFactory</span>&lt;ChannelSftp&gt; &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChannelSftp <span class="title function_">create</span><span class="params">()</span> <span class="keyword">throws</span> JSchException &#123;</span><br><span class="line">        <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">sshSession</span> <span class="operator">=</span> jsch.getSession(username, host, port);</span><br><span class="line">        sshSession.setPassword(password);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">sshConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        sshConfig.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        sshSession.setConfig(sshConfig);</span><br><span class="line">        sshSession.connect();</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channel</span> <span class="operator">=</span> (ChannelSftp) sshSession.openChannel(<span class="string">&quot;sftp&quot;</span>);</span><br><span class="line">        channel.connect();</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PooledObject&lt;ChannelSftp&gt; <span class="title function_">wrap</span><span class="params">(ChannelSftp channelSftp)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultPooledObject</span>&lt;&gt;(channelSftp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fengfan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/1/14 15:26</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyObject</span><span class="params">(PooledObject&lt;ChannelSftp&gt; p)</span> &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channelSftp</span> <span class="operator">=</span> p.getObject();</span><br><span class="line">        channelSftp.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 激活连接池里面的sftp连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">activateObject</span><span class="params">(PooledObject&lt;ChannelSftp&gt; p)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channelSftp</span> <span class="operator">=</span> p.getObject();</span><br><span class="line">        <span class="keyword">if</span>(!channelSftp.isConnected())&#123;</span><br><span class="line">            channelSftp.connect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> SftpGenericObjectPool.java </p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPool;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpGenericObjectPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GenericObjectPool&lt;ChannelSftp&gt; genericObjectPool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SftpGenericObjectPool</span><span class="params">(SftpFactory sftpFactory, GenericObjectPoolConfig&lt;ChannelSftp&gt; sftpPoolConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.genericObjectPool = <span class="keyword">new</span> <span class="title class_">GenericObjectPool</span>&lt;&gt;(sftpFactory, sftpPoolConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ChannelSftp <span class="title function_">borrowObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> genericObjectPool.borrowObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnObject</span><span class="params">(ChannelSftp obj)</span> &#123;</span><br><span class="line">        genericObjectPool.returnObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> SftpUtil.java</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.SftpException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpUtil</span> &#123;</span><br><span class="line">    <span class="comment">//连接池</span></span><br><span class="line">    <span class="keyword">private</span> SftpGenericObjectPool pool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SftpUtil</span><span class="params">(SftpGenericObjectPool pool)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pool = pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件字节数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">download</span><span class="params">(String dir, String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            <span class="keyword">return</span> sftp.get(name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in   输入流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(String dir, String name, InputStream in)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mkdirs(sftp, dir);</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            sftp.put(in, name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String dir, String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            sftp.rm(name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归创建多级目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir 多级目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">mkdirs</span><span class="params">(ChannelSftp sftp, String dir)</span> <span class="keyword">throws</span> SftpException &#123;</span><br><span class="line">        String[] folders = dir.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        sftp.cd(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String folder : folders) &#123;</span><br><span class="line">            <span class="keyword">if</span> (folder.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sftp.cd(folder);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    sftp.mkdir(folder);</span><br><span class="line">                    sftp.cd(folder);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SftpGenericObjectPool <span class="title function_">getPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPool</span><span class="params">(SftpGenericObjectPool pool)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pool = pool;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册实例化 sftpUtil</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> SftpUtil sftpUtil;</span><br></pre></td></tr></table></figure></li></ol><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><blockquote><p>java在response中设置文件流，在浏览器中直接显示或直接下载</p><p>在浏览器地址栏输入文件请求url，能在浏览器上直接显示文件，而不直接下载</p><p>解决方式设置文件ContentType类型</p><p>当设置了ContentType为“image/jpg”时，浏览器可以直接显示图片；</p><p>没设置ContentType时，浏览器会直接下载图片到本地。</p><p>备注：不能设置<a href="https://so.csdn.net/so/search?q=header&spm=1001.2101.3001.7020">header</a>，否则当设置了ContentType时也是直接下载图片</p><p><a href="https://blog.csdn.net/q289658763/article/details/125928198">参考</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应体加入文件流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath文件从盘符开始的完整路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">responseFileStream</span><span class="params">(HttpServletResponse response, String filePath)</span>&#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream imgPath:&quot;</span>+filePath);</span><br><span class="line"><span class="keyword">if</span>(filePath.contains(<span class="string">&quot;%&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">filePath = URLDecoder.decode(filePath,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream decode error:&quot;</span>+e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(filePath.contains(<span class="string">&quot;%&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">filePath = URLDecoder.decode(filePath,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream decode error:&quot;</span>+e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">in = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">String[] dir = filePath.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> dir[dir.length-<span class="number">1</span>];</span><br><span class="line">String[] array = fileName.split(<span class="string">&quot;[.]&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> array[array.length-<span class="number">1</span>].toLowerCase();</span><br><span class="line"><span class="comment">//设置文件ContentType类型</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;jpg,jepg,gif,png&quot;</span>.contains(fileType))&#123;<span class="comment">//图片类型</span></span><br><span class="line">response.setContentType(<span class="string">&quot;image/&quot;</span>+fileType);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;pdf&quot;</span>.contains(fileType))&#123;<span class="comment">//pdf类型</span></span><br><span class="line">response.setContentType(<span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">//自动判断下载文件类型 </span></span><br><span class="line">response.setContentType(<span class="string">&quot;multipart/form-data&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置文件头：最后一个参数是设置下载文件名</span></span><br><span class="line">        <span class="comment">//response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;fileName=&quot;+fileName);   </span></span><br><span class="line">out = response.getOutputStream();</span><br><span class="line"><span class="comment">// 读取文件流</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">10</span>];</span><br><span class="line"><span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line">out.flush();</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream error:FileNotFoundException&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream error:&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">out.close();</span><br><span class="line">in.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream stream close() error:NullPointerException&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream stream close() error:&quot;</span> + e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端图片预览"><a href="#前端图片预览" class="headerlink" title="前端图片预览"></a>前端图片预览</h3><blockquote><p>通过访问地址，在img 标签 src中 渲染</p></blockquote><p>后端：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">viewPicture</span><span class="params">(HttpServletResponse response, String filePath)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> filePath.substring(filePath.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>( filePath);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.exists() &amp;&amp; file.isFile()) &#123;</span><br><span class="line">            <span class="comment">//读取图片文件流</span></span><br><span class="line">            <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> ImageIO.read(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file));</span><br><span class="line">            <span class="comment">//将图片写到输出流</span></span><br><span class="line">            ImageIO.write(image, format, response.getOutputStream());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;文件不存在&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;预览失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// uploadAnnotateFile 是上传根路径</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/viewPicture&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> ResponseBean <span class="title function_">viewPicture</span><span class="params">(HttpServletResponse res,String path)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> FolderUtil.viewPicture(res, uploadAnnotateFile + path);</span><br><span class="line">    <span class="keyword">return</span> ResponseBean.success(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前端：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;http:xxx:xxx/api/viewPicture?path=/xxx.jpg&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="跨域cookie共享"><a href="#跨域cookie共享" class="headerlink" title="跨域cookie共享"></a>跨域cookie共享</h3><blockquote><p>主域 <a href="http://www.xxx.com,/">www.xxx.com，</a> iframe 嵌入子页面 22.56.128.50:8888,子页面调用接口歇尔代主页面 的cookie。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;www.xxx.com/config/xxxLogin?target=page1&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><p>iframe 中的地址是主页面的地址，利用 nginx  匹配 <strong>/config</strong> 转发 到 <strong>22.56.128.50:8888</strong> 这样一来 内嵌页面与主页面不跨域了。可以访问主页面的cookie。</p><p>但是有个问题，子页面跨域自动携带 cookie 失败了（暂时不大明白原因）。只能通过 js读取cookie 作为参数传递给后端</p><h3 id="Mysql-查询表字段结构注释"><a href="#Mysql-查询表字段结构注释" class="headerlink" title="Mysql 查询表字段结构注释"></a>Mysql 查询表字段结构注释</h3><blockquote><p>数据库名 是需要修改的</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">a.table_name 表名,</span><br><span class="line">a.table_comment 表说明,</span><br><span class="line">b.COLUMN_NAME 字段名,</span><br><span class="line">b.column_comment 字段说明,</span><br><span class="line">b.column_type 字段类型,</span><br><span class="line">b.column_key 约束</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">information_schema. TABLES a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> information_schema. COLUMNS b <span class="keyword">ON</span> a.table_name <span class="operator">=</span> b.TABLE_NAME</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">a.table_schema <span class="operator">=</span> <span class="string">&#x27;数据库名&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">a.table_name</span><br></pre></td></tr></table></figure><blockquote><p>原文链接：<a href="https://blog.csdn.net/LQZ8888/article/details/127879597">https://blog.csdn.net/LQZ8888/article/details/127879597</a></p></blockquote><h3 id="查询某数据库下的所有表名-表注释"><a href="#查询某数据库下的所有表名-表注释" class="headerlink" title="查询某数据库下的所有表名 表注释"></a><strong>查询某数据库下的所有表名 表注释</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">table_name 表名,</span><br><span class="line">table_comment 表说明</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">information_schema.TABLES</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">table_schema <span class="operator">=</span> <span class="string">&#x27;数据库名&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">table_name</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;扫描远程文件&quot;&gt;&lt;a href=&quot;#扫描远程文件&quot; class=&quot;headerlink&quot; title=&quot;扫描远程文件&quot;&gt;&lt;/a&gt;扫描远程文件&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 连接sftp服务器&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; host     主机&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; port     端口&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; username 用户名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; password 密码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; ChannelSftp &lt;span class=&quot;title function_&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String host, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; port, String username,String password)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;ChannelSftp&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sftp&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;JSch&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;jsch&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;JSch&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//jsch.getSession(username, host, port);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;Session&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sshSession&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; jsch.getSession(username, host, port);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Session created.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshSession.setPassword(password);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;Properties&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sshConfig&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Properties&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshConfig.put(&lt;span class=&quot;string&quot;&gt;&amp;quot;StrictHostKeyChecking&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;no&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshSession.setConfig(sshConfig);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sshSession.connect();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Session connected.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Opening Channel.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;Channel&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;channel&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; sshSession.openChannel(&lt;span class=&quot;string&quot;&gt;&amp;quot;sftp&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            channel.connect();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            sftp = (ChannelSftp) channel;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Connected to &amp;quot;&lt;/span&gt; + host + &lt;span class=&quot;string&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sftp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 列出目录下的文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; directory 要列出的目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; sftp&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@throws&lt;/span&gt; SftpException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; Vector &lt;span class=&quot;title function_&quot;&gt;listFiles&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String directory, ChannelSftp sftp)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; SftpException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; sftp.ls(directory);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 测试：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;ChannelSftp&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sftp&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; connect(HOST, PORT, USER, PWD);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;本地文件扫描&quot;&gt;&lt;a href=&quot;#本地文件扫描&quot; class=&quot;headerlink&quot; title=&quot;本地文件扫描&quot;&gt;&lt;/a&gt;本地文件扫描&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/codeLife1993/article/details/81906996&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="拓展" scheme="https://wyf195075595.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
</feed>
