<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>myBlog</title>
  
  <subtitle>白小纯</subtitle>
  <link href="https://wyf195075595.github.io/atom.xml" rel="self"/>
  
  <link href="https://wyf195075595.github.io/"/>
  <updated>2023-03-02T09:03:24.766Z</updated>
  <id>https://wyf195075595.github.io/</id>
  
  <author>
    <name>王不留行</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>springboot基础</title>
    <link href="https://wyf195075595.github.io/2023/03/02/programming/java/springboot/"/>
    <id>https://wyf195075595.github.io/2023/03/02/programming/java/springboot/</id>
    <published>2023-03-02T08:40:00.000Z</published>
    <updated>2023-03-02T09:03:24.766Z</updated>
    
    <content type="html"><![CDATA[<h3 id="配置容器"><a href="#配置容器" class="headerlink" title="配置容器"></a>配置容器</h3><ul><li><p>xml配置容器</p><p>  就是spring 的 xml文件中那样的写法</p></li><li><p>javaConfig配置容器</p><p>  采用java类的方式来配置</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    创建方法，方法的返回值是对象。在方法上加上@Bean</span></span><br><span class="line"><span class="comment">    方法的返回值对象就注入到容器中。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;配置容器&quot;&gt;&lt;a href=&quot;#配置容器&quot; class=&quot;headerlink&quot; title=&quot;配置容器&quot;&gt;&lt;/a&gt;配置容器&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;xml配置容器&lt;/p&gt;
&lt;p&gt;  就是spring 的 xml文件中那样的写法&lt;/p&gt;
&lt;/li&gt;
&lt;li</summary>
      
    
    
    
    <category term="java配置" scheme="https://wyf195075595.github.io/categories/java%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="springboot基础" scheme="https://wyf195075595.github.io/tags/springboot%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>拓展</title>
    <link href="https://wyf195075595.github.io/2023/02/22/programming/java/other/"/>
    <id>https://wyf195075595.github.io/2023/02/22/programming/java/other/</id>
    <published>2023-02-22T08:00:00.000Z</published>
    <updated>2023-02-23T09:09:13.901Z</updated>
    
    <content type="html"><![CDATA[<h3 id="扫描远程文件"><a href="#扫描远程文件" class="headerlink" title="扫描远程文件"></a>扫描远程文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接sftp服务器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host     主机</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port     端口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ChannelSftp <span class="title function_">connect</span><span class="params">(String host, <span class="type">int</span> port, String username,String password)</span> &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line">            <span class="comment">//jsch.getSession(username, host, port);</span></span><br><span class="line">            <span class="type">Session</span> <span class="variable">sshSession</span> <span class="operator">=</span> jsch.getSession(username, host, port);</span><br><span class="line">            System.out.println(<span class="string">&quot;Session created.&quot;</span>);</span><br><span class="line">            sshSession.setPassword(password);</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">sshConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            sshConfig.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">            sshSession.setConfig(sshConfig);</span><br><span class="line">            sshSession.connect();</span><br><span class="line">            System.out.println(<span class="string">&quot;Session connected.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Opening Channel.&quot;</span>);</span><br><span class="line">            <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> sshSession.openChannel(<span class="string">&quot;sftp&quot;</span>);</span><br><span class="line">            channel.connect();</span><br><span class="line">            sftp = (ChannelSftp) channel;</span><br><span class="line">            System.out.println(<span class="string">&quot;Connected to &quot;</span> + host + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sftp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列出目录下的文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> directory 要列出的目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sftp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SftpException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Vector <span class="title function_">listFiles</span><span class="params">(String directory, ChannelSftp sftp)</span> <span class="keyword">throws</span> SftpException &#123;</span><br><span class="line">        <span class="keyword">return</span> sftp.ls(directory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试：</span></span><br><span class="line"></span><br><span class="line"><span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> connect(HOST, PORT, USER, PWD);</span><br></pre></td></tr></table></figure><h3 id="本地文件扫描"><a href="#本地文件扫描" class="headerlink" title="本地文件扫描"></a>本地文件扫描</h3><blockquote><p><a href="https://blog.csdn.net/codeLife1993/article/details/81906996">参考</a></p></blockquote><h3 id="解析JSON文件"><a href="#解析JSON文件" class="headerlink" title="解析JSON文件"></a>解析JSON文件</h3><blockquote><p>我们用来解析json格式的jar包有很多，jackson，<a href="https://so.csdn.net/so/search?q=fastjson&spm=1001.2101.3001.7020">fastjson</a>，gson都行。但本人喜欢用fastjson。所以本篇都是以fastjson来解析json文件。</p><p><a href="https://blog.csdn.net/Jeck_wu/article/details/118755971">参考</a></p></blockquote><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:18080/api/upload-test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">webkitdirectory</span> <span class="attr">mozdirectory</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件夹&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:18080/api/upload-test&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">multiple</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="保存到本地"><a href="#保存到本地" class="headerlink" title="保存到本地"></a>保存到本地</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/upload-test&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadTest</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file: files) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/Download/&quot;</span> + file.getOriginalFilename()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="保存至远程服务器"><a href="#保存至远程服务器" class="headerlink" title="保存至远程服务器"></a>保存至远程服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/upload-test&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadTest</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file: files) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] strings = file.getOriginalFilename().split(<span class="string">&quot;\\/&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> strings[strings.length - <span class="number">1</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">newPath</span> <span class="operator">=</span> file.getOriginalFilename().replace(fileName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            sftpUtil.upload(uploadAnnotateFile + newPath, fileName , file.getInputStream());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;上传结束&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="远程连接配置"><a href="#远程连接配置" class="headerlink" title="远程连接配置"></a>远程连接配置</h4><blockquote><p><a href="https://github.com/fengfangithub/study-sftp">参考</a></p></blockquote><ol><li><p>pom.xml 引入依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sftp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.55<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>application-xxx.yml 文件配置参数</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 远程访问服务器配置</span></span><br><span class="line"><span class="attr">sftp:</span></span><br><span class="line">  <span class="comment">#服务器ip</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.245</span></span><br><span class="line">  <span class="comment">#ssh端口</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">  <span class="comment">#用户名</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">zkrd</span></span><br><span class="line">  <span class="comment">#密码</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">zkrd12#$</span></span><br><span class="line">  <span class="comment"># 上传标注文件服务器路径</span></span><br><span class="line">  <span class="attr">uploadAnnotateFile:</span> <span class="string">/home/zkrd/label_system/</span></span><br><span class="line">  <span class="comment">#连接池参数</span></span><br><span class="line">  <span class="attr">pool:</span></span><br><span class="line">    <span class="comment">#对象池中管理的最多对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-total:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最大的空闲对象个数。默认值是8</span></span><br><span class="line">    <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">    <span class="comment">#对象池中最小的空闲对象个数。默认值是0</span></span><br><span class="line">    <span class="attr">min-idle:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure></li><li><p>封装类</p><p> SftpFactory.java</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.JSch;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.JSchException;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.BasePooledObjectFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.PooledObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.DefaultPooledObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpFactory</span> <span class="keyword">extends</span> <span class="title class_">BasePooledObjectFactory</span>&lt;ChannelSftp&gt; &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;sftp.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChannelSftp <span class="title function_">create</span><span class="params">()</span> <span class="keyword">throws</span> JSchException &#123;</span><br><span class="line">        <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">sshSession</span> <span class="operator">=</span> jsch.getSession(username, host, port);</span><br><span class="line">        sshSession.setPassword(password);</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">sshConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        sshConfig.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        sshSession.setConfig(sshConfig);</span><br><span class="line">        sshSession.connect();</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channel</span> <span class="operator">=</span> (ChannelSftp) sshSession.openChannel(<span class="string">&quot;sftp&quot;</span>);</span><br><span class="line">        channel.connect();</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PooledObject&lt;ChannelSftp&gt; <span class="title function_">wrap</span><span class="params">(ChannelSftp channelSftp)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultPooledObject</span>&lt;&gt;(channelSftp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> fengfan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/1/14 15:26</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyObject</span><span class="params">(PooledObject&lt;ChannelSftp&gt; p)</span> &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channelSftp</span> <span class="operator">=</span> p.getObject();</span><br><span class="line">        channelSftp.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 激活连接池里面的sftp连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">activateObject</span><span class="params">(PooledObject&lt;ChannelSftp&gt; p)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">channelSftp</span> <span class="operator">=</span> p.getObject();</span><br><span class="line">        <span class="keyword">if</span>(!channelSftp.isConnected())&#123;</span><br><span class="line">            channelSftp.connect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> SftpGenericObjectPool.java </p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPool;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpGenericObjectPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GenericObjectPool&lt;ChannelSftp&gt; genericObjectPool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SftpGenericObjectPool</span><span class="params">(SftpFactory sftpFactory, GenericObjectPoolConfig&lt;ChannelSftp&gt; sftpPoolConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.genericObjectPool = <span class="keyword">new</span> <span class="title class_">GenericObjectPool</span>&lt;&gt;(sftpFactory, sftpPoolConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ChannelSftp <span class="title function_">borrowObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> genericObjectPool.borrowObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnObject</span><span class="params">(ChannelSftp obj)</span> &#123;</span><br><span class="line">        genericObjectPool.returnObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> SftpUtil.java</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.jcraft.jsch.ChannelSftp;</span><br><span class="line"><span class="keyword">import</span> com.jcraft.jsch.SftpException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SftpUtil</span> &#123;</span><br><span class="line">    <span class="comment">//连接池</span></span><br><span class="line">    <span class="keyword">private</span> SftpGenericObjectPool pool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SftpUtil</span><span class="params">(SftpGenericObjectPool pool)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pool = pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件字节数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">download</span><span class="params">(String dir, String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            <span class="keyword">return</span> sftp.get(name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in   输入流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upload</span><span class="params">(String dir, String name, InputStream in)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mkdirs(sftp, dir);</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            sftp.put(in, name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir  远程目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 远程文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String dir, String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelSftp</span> <span class="variable">sftp</span> <span class="operator">=</span> pool.borrowObject();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sftp.cd(dir);</span><br><span class="line">            sftp.rm(name);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            pool.returnObject(sftp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归创建多级目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dir 多级目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">mkdirs</span><span class="params">(ChannelSftp sftp, String dir)</span> <span class="keyword">throws</span> SftpException &#123;</span><br><span class="line">        String[] folders = dir.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        sftp.cd(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String folder : folders) &#123;</span><br><span class="line">            <span class="keyword">if</span> (folder.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sftp.cd(folder);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    sftp.mkdir(folder);</span><br><span class="line">                    sftp.cd(folder);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SftpGenericObjectPool <span class="title function_">getPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPool</span><span class="params">(SftpGenericObjectPool pool)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pool = pool;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册实例化 sftpUtil</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> SftpUtil sftpUtil;</span><br></pre></td></tr></table></figure></li></ol><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><blockquote><p>java在response中设置文件流，在浏览器中直接显示或直接下载</p><p>在浏览器地址栏输入文件请求url，能在浏览器上直接显示文件，而不直接下载</p><p>解决方式设置文件ContentType类型</p><p>当设置了ContentType为“image/jpg”时，浏览器可以直接显示图片；</p><p>没设置ContentType时，浏览器会直接下载图片到本地。</p><p>备注：不能设置<a href="https://so.csdn.net/so/search?q=header&spm=1001.2101.3001.7020">header</a>，否则当设置了ContentType时也是直接下载图片</p><p><a href="https://blog.csdn.net/q289658763/article/details/125928198">参考</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应体加入文件流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath文件从盘符开始的完整路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">responseFileStream</span><span class="params">(HttpServletResponse response, String filePath)</span>&#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream imgPath:&quot;</span>+filePath);</span><br><span class="line"><span class="keyword">if</span>(filePath.contains(<span class="string">&quot;%&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">filePath = URLDecoder.decode(filePath,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream decode error:&quot;</span>+e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(filePath.contains(<span class="string">&quot;%&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">filePath = URLDecoder.decode(filePath,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;responseFileStream decode error:&quot;</span>+e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">in = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">String[] dir = filePath.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> dir[dir.length-<span class="number">1</span>];</span><br><span class="line">String[] array = fileName.split(<span class="string">&quot;[.]&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> array[array.length-<span class="number">1</span>].toLowerCase();</span><br><span class="line"><span class="comment">//设置文件ContentType类型</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;jpg,jepg,gif,png&quot;</span>.contains(fileType))&#123;<span class="comment">//图片类型</span></span><br><span class="line">response.setContentType(<span class="string">&quot;image/&quot;</span>+fileType);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;pdf&quot;</span>.contains(fileType))&#123;<span class="comment">//pdf类型</span></span><br><span class="line">response.setContentType(<span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">//自动判断下载文件类型 </span></span><br><span class="line">response.setContentType(<span class="string">&quot;multipart/form-data&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置文件头：最后一个参数是设置下载文件名</span></span><br><span class="line">        <span class="comment">//response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;fileName=&quot;+fileName);   </span></span><br><span class="line">out = response.getOutputStream();</span><br><span class="line"><span class="comment">// 读取文件流</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">10</span>];</span><br><span class="line"><span class="keyword">while</span> ((len = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line">out.flush();</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream error:FileNotFoundException&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream error:&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">out.close();</span><br><span class="line">in.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream stream close() error:NullPointerException&quot;</span> + e.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">logger.error(<span class="string">&quot;responseFileStream stream close() error:&quot;</span> + e.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;扫描远程文件&quot;&gt;&lt;a href=&quot;#扫描远程文件&quot; class=&quot;headerlink&quot; title=&quot;扫描远程文件&quot;&gt;&lt;/a&gt;扫描远程文件&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="拓展" scheme="https://wyf195075595.github.io/tags/%E6%8B%93%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>spring基础</title>
    <link href="https://wyf195075595.github.io/2023/02/17/programming/java/spring/"/>
    <id>https://wyf195075595.github.io/2023/02/17/programming/java/spring/</id>
    <published>2023-02-17T08:00:00.000Z</published>
    <updated>2023-03-02T08:21:59.207Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>什么是OCP？</strong></p><p>OCP是软件开发的七大开发原则：开闭原则</p><p>核心：其他6个原则的基础</p></blockquote><blockquote><p><strong>OCP开闭原则核心是什么？</strong></p><p>只要你在扩展功能的时候，没有修改以前写好的代码，那么就是符合OCP原则的，反之则违背了OCP原则    </p><p>当系统功能拓展时，如果动了之前稳定的程序，修改了之前的程序。之前所有程序都需要测试，这是不想看到的</p></blockquote><blockquote><p><strong>违背依赖倒置原则（DIP原则）</strong></p><p><strong>上依赖下就是违背</strong>：如：表示层依赖服务层，服务层依赖持久层</p></blockquote><blockquote><p><strong>控制反转</strong></p><p>一种编程思想。或设计模式</p><ul><li>不在程序中采用硬编码方式来 new 对象</li><li>不在程序中采用硬编码方式来 维护对象关系</li></ul></blockquote><h2 id="Spring框架"><a href="#Spring框架" class="headerlink" title="Spring框架"></a>Spring框架</h2><ul><li>Spring框架实现了控制反转IoC这种思想<ul><li>spring帮你new对象</li><li>spring帮你维护对象关系</li></ul></li><li>Spring 时一个实现了IoC思想的容器<ul><li>依赖注入的两种方式（依赖注入时现实IoC的具体实现: XML解析+工厂模式+反射机制）<ul><li>set 注入(执行set给属性赋值)</li><li>构造方法 注入(执行构造方法给属性赋值)</li></ul></li></ul></li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230217170739281.png" alt="image-20230217170739281"></p><span id="more"></span><h3 id="创建一个spring6项目"><a href="#创建一个spring6项目" class="headerlink" title="创建一个spring6项目"></a>创建一个spring6项目</h3><ol><li><p>创建一个普通maven项目</p></li><li><p>添加spring6的依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--  当你引入 Spring Context依赖后，表示将Spring的基础依赖引入  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置spring 配置文件 xml</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  IDE工具提供了这个模板  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  配置bean,这样spring会帮我们管理这个对象</span></span><br><span class="line"><span class="comment">        bean标签的两个重要属性</span></span><br><span class="line"><span class="comment">        id: 全局唯一</span></span><br><span class="line"><span class="comment">        class: 需要关系的类的全路径</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bran.User&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>新建 com.spring.bran.User 类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.spring.bran;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 第一步：获取spring 容器对象</span></span><br><span class="line">    <span class="comment">// ApplicationContext 有很多实现类 ClassPathXmlApplicationContext用来专门加载spring 配置文件</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二步：根据bean id 从 spring 容器中获取这个对象</span></span><br><span class="line">    <span class="comment">// 返回值是一个对象，可以传第二个参数设置类型</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">userBean</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;userBean&quot;</span>, <span class="string">&quot;User.class&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;userBean = &quot;</span> + userBean);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非类路径下获取配置文件</span></span><br><span class="line"><span class="type">FileSystemXmlApplicationContext</span> <span class="variable">fs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;d://xxx.xml&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="spring-启用-Log42-日志框架"><a href="#spring-启用-Log42-日志框架" class="headerlink" title="spring 启用 Log42 日志框架"></a>spring 启用 Log42 日志框架</h3><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    log4j依赖    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件名字必须是-log4j2-xml"><a href="#配置文件名字必须是-log4j2-xml" class="headerlink" title="配置文件名字必须是 log4j2.xml"></a>配置文件名字必须是 log4j2.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;spring6log&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--    输出日志信息到控制台  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">&quot;spring6log&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 控制台日志输出格式 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:SSS&#125; [t%] %-3level %logger&#123;1024&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时已经启用</p><h4 id="自己怎么使用log4j2记录日志？"><a href="#自己怎么使用log4j2记录日志？" class="headerlink" title="自己怎么使用log4j2记录日志？"></a>自己怎么使用log4j2记录日志？</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">useLog4j2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(UserTest.class);</span><br><span class="line">    logger.info(<span class="string">&quot;我是一条信息&quot;</span>);</span><br><span class="line">    logger.debug(<span class="string">&quot;我是一条调试信息&quot;</span>);</span><br><span class="line">    logger.error(<span class="string">&quot;我是一条错误信息&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><blockquote><p>service 层引用了 Dao层对象，怎么配置让spring自动生成</p></blockquote><h4 id="基于set方法的依赖注入"><a href="#基于set方法的依赖注入" class="headerlink" title="基于set方法的依赖注入"></a>基于set方法的依赖注入</h4><p>dao.UserDao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(UserDao.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;数据库正在保存&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service.UserService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">// 此处为要注入Dao层 的set方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.insert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置 bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- userServiceBean 中注入 UserDao  ，</span></span><br><span class="line"><span class="comment">name其实是根据 set方法的名字来生成的，eg:setuserDao</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoBean&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app 为spring容器对象</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">uerService</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;userServiceBean&quot;</span>, UserService.class);</span><br><span class="line">uerService.saveUser();</span><br></pre></td></tr></table></figure><h4 id="基于构造方法的依赖注入"><a href="#基于构造方法的依赖注入" class="headerlink" title="基于构造方法的依赖注入"></a>基于构造方法的依赖注入</h4><p>service.UserService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">// 此处为要注入Dao层 的构造方法</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.insert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- userServiceBean 中注入 UserDao  ，</span></span><br><span class="line"><span class="comment">可以是</span></span><br><span class="line"><span class="comment">-index:其是参数的位置，从0开始 eg: 0</span></span><br><span class="line"><span class="comment">-name: 参数的名字eg: userDao</span></span><br><span class="line"><span class="comment">-不指定 ：自动匹配，实际是根据参数类型来判断</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="内-外部注入-bean"><a href="#内-外部注入-bean" class="headerlink" title="内/外部注入 bean"></a>内/外部注入 bean</h4><blockquote><p>内部 bean 就是在 property 里面使用 bean标签的方式，效果跟上面一样, 一般不用</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="简单类型注入"><a href="#简单类型注入" class="headerlink" title="简单类型注入"></a>简单类型注入</h4><blockquote><p>UserDao 中提供成员属性 username,password 的set,get方法</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zs&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>哪些类型被认为是简单类型？</p><p>BeanTuils.java 中的isSimpleValueType 方法 中经行了描述</p><ol><li>8中基本类型及其包装类</li><li>字符串</li><li>枚举</li><li>class</li><li>日期 Date,Temporal</li><li></li></ol></blockquote><p>日期直接传字符串会导致报错，它要求指定的日期格式字符串。比较麻烦，一般不把它当作简单类型处理</p><p><strong>经典应用场景</strong></p><blockquote><p>数据源 都实现了 DAtaSource 接口，其中的获取 connection 对象时要传入 driver,url,username,password 时可以采用配置 注入</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password &quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="级联属性赋值"><a href="#级联属性赋值" class="headerlink" title="级联属性赋值"></a>级联属性赋值</h4><blockquote><p>使用级联属性必须要有 get方法，在一个bean中给另一个bean赋值属性</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 学生bean中给班级类注入数据</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;xxx.Student&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zs&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;16&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;clazzBean&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;高二1班&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazzBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;xxx.clazz&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="数组注入"><a href="#数组注入" class="headerlink" title="数组注入"></a>数组注入</h4><ol><li><p>数组简单数组</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;strArray&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>值1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>值2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>值3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>值4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>数组 引用类型</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;girlFriends&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;girlFriend1&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;girlFriend2&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;girlFriend3&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;girlFriend1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.Woman&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小花&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;girlFriend2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.Woman&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小丽&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;girlFriend3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.Woman&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小婉&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="注入集合"><a href="#注入集合" class="headerlink" title="注入集合"></a>注入集合</h4><blockquote><p>list 集合有序可重复，无需不可重复。元素时基本类型用value,引用类型用&lt;ref bean=”” /&gt;</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;names&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--List集合有序可重复--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>王五<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vaLue</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vaLue</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;addrs&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--set集合无序不可重复--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vaLue</span>&gt;</span>北京大兴区<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>北京大兴区<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>北京海淀区<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">vaLue</span>&gt;</span>北京海淀区<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>北京大兴区<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>map 集合</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;addrs&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--map集合简单类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;110&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;120&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;130&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--map集合引用类型</span></span><br><span class="line"><span class="comment">&lt;entry key-ref=&quot;3&quot; value-ref=&quot;130&quot; /&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--注入Properties俩性类对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;addrs&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;driver&quot;</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>jdbc:mysql:// ocalhost:3306/spring6<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="注入一个-null-空字符串"><a href="#注入一个-null-空字符串" class="headerlink" title="注入一个 null, 空字符串"></a>注入一个 null, 空字符串</h4><blockquote><p>要注入一个 null. 要不就不写这条属性注入，要不就如下：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p> 注入空字符串</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="注入-特殊字符"><a href="#注入-特殊字符" class="headerlink" title="注入 特殊字符"></a>注入 特殊字符</h4><blockquote><p>使用实体符号：如 </p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 报错</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;rs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2 &lt; 3&quot;</span> /&gt;</span></span><br><span class="line">// 正常</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;rs&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2 <span class="symbol">&amp;lt;</span> 3&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>使用 &lt;![CDATA[]]&gt;</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;rs&quot;</span>&gt;</span></span><br><span class="line">// 只能使用 value 标签</span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[2 &lt; 3]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="基于p命名空间的注入"><a href="#基于p命名空间的注入" class="headerlink" title="基于p命名空间的注入"></a>基于p命名空间的注入</h4><blockquote><p>p命名空间注入基于 set 方法，用来简化传值操作</p><p>c命名空间注入基于构造 方法，用来简化传值操作</p><p>1、在spring 的配置文件头部添加p命名空间。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br></pre></td></tr></table></figure><p>2、使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dogBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;xxx.Dog&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">p:birth-ref</span>=<span class="string">&quot;birthBean&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 将日期对象作为引用类型传入</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;birthBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Ddate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="util-命名空间注入"><a href="#util-命名空间注入" class="headerlink" title="util 命名空间注入"></a>util 命名空间注入</h4><blockquote><p>让配置复用，主要针对集合</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 引入 util 命名空间</span><br><span class="line">xmlns:util=&quot;http://www.springframework.org/schema/util&quot;</span><br><span class="line"></span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;ml&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>王五<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;anyList&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="基于XML自动装配"><a href="#基于XML自动装配" class="headerlink" title="基于XML自动装配"></a>基于XML自动装配</h4><ul><li><p>根据名字自动装配</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 之前写法</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDaoBean&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">// 自动装配</span><br><span class="line">// 此处bean的名字应是set方法名不带set的小驼峰，此外自动装配是set注入，不要重写有参构造方法</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>根据类型自动装配</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.dao.UserDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">// 这也是 set注入的方式，同种类型参数不要超过两个</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.UserService&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="spring-引入外部属性文件"><a href="#spring-引入外部属性文件" class="headerlink" title="spring 引入外部属性文件"></a>spring 引入外部属性文件</h4><blockquote><p>以前 mybatis 通过 配置文件 设置properties.resource引入外部属性文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>现在spring中：</p></blockquote><p>1、先引入 context 命名空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line"></span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">                    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure><p>2、使用标签引入</p><blockquote><p>注意，xxx.properties 文件的属性在命名时 加上前缀 如：jdbc.username=root. 否则可能会优先读取电脑全局属性username:结果是 Administrator</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 使用</span><br><span class="line">$&#123;变量名&#125;</span><br></pre></td></tr></table></figure><h3 id="bean-作用域"><a href="#bean-作用域" class="headerlink" title="bean 作用域"></a>bean 作用域</h3><blockquote><p>spring 默认情况下如何管理这个Bean的？</p><p>默认情况下 Bean是单例的，在Spring初始化的时候实例化，所以每次调用getBean(),都返回那个单例对象</p></blockquote><p>我们可以通过设置Bean标签的属性scope来改变Bean是否为单例（singleton）/多例（prototype）。web项目会有更多配置</p><p><strong>自定义 scope</strong> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置我们自定义的作用城--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;scopes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;threadScope&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 这个Scope接口的实现类使用的是Spring框架内置的。也可以自定义。--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;threadScope&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>效果：在不同线程下，getBean 获取的对象不一样。是线程安全的</p><h3 id="Bean-的实例化（获取）方式"><a href="#Bean-的实例化（获取）方式" class="headerlink" title="Bean 的实例化（获取）方式"></a>Bean 的实例化（获取）方式</h3><ol><li><p>通过构造方法实例化</p><p> 在文件中写 Bean 标签，spring 会自动调用该类构造函数实例化 Bean</p></li><li><p>通过简单工厂模式实例化</p><p> 通过简单工厂模式。spring会到 StarFactory 类中 调用 get 获取实例对象</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;startBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.bean.StarFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;get&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StarFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Star <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 返回Star 对象实例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Star</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过factory-bean实例化</p><p> 通过工厂方法模式。通过 factory-bean,factory-method 属性共同完成</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;gunFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.bean.GunFactory&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;gun&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;gunFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;get&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p> GunFactory</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GunFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="keyword">public</span> Gun <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 实际上 new 这个对象还是我们程序员自己 new 的</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Gun</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> Gun</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Gun</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Gun</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Gun的无参构造方法执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过 FactoryBean 接口实例化</p><p> 实际上是第三种方法的简化</p><p> PersonFactory</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 是否单例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> Person</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行构造函数！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> spring.xml</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.PersonFactory&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ol><blockquote><p>FactoryBean与BeanFactory区别？</p><p>FactoryBean 是 Bean 它是辅助spring创建其他bean的，而BeanFactory 是创建Bean的工厂，负责创建Bean对象</p></blockquote><h4 id="FeatoryBean-注入-Date-类型"><a href="#FeatoryBean-注入-Date-类型" class="headerlink" title="FeatoryBean 注入 Date 类型"></a>FeatoryBean 注入 Date 类型</h4><blockquote><p>Date 在 spring中被当作简单类型，</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Date&gt; &#123;</span><br><span class="line">    String strDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DateFactory</span><span class="params">(String strDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strDate = strDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> format.parse(strDate);</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dateBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.DateFactory&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1970-10-12&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.bean.service.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;date&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dateBean&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Bean-的声明周期"><a href="#Bean-的声明周期" class="headerlink" title="Bean 的声明周期"></a>Bean 的声明周期</h3><blockquote><p>​    粗略的五步走</p><ol><li>实例化Bean，调用无参构造方法</li><li>给Bean属性赋值，set方法</li><li>初始化Bean。会调用Bean的init方法，这个方法需要自己写</li><li>使用Bean</li><li>销毁Bean，调用Bean的destroy 方法，这个方法也需要自己写</li></ol></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 指定生命周期函数</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dateBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xx.DateFactory&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initBean&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zs&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>生命周期的七步。就是在第三步增加 before，after。怎么加呢？</p><p>编写一个类实现 BeanPostProcessor 类并重写 after，before方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SevenStep</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 作用域配置文件中所有Bean</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.SevenStep&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>生命周期十步走</p><p>在BeanBefore 前后增加，和销毁之前增加</p><ul><li><p>before前检查Bean是否实现了Aware相关接口，并设置相关依赖</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可获取Bean 名字，Bean这个类的加载器，生产这个Bean的工厂对象</span></span><br><span class="line"><span class="keyword">implements</span> <span class="title class_">BeanNameAware</span>,BeanClassLoaderAware, BeanFactoryAware</span><br></pre></td></tr></table></figure></li><li><p>before后检查Bean是否实现了InitialzingBean接口，并调用方法</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">implements</span> <span class="title class_">InitializingBean</span></span><br></pre></td></tr></table></figure></li><li><p>销毁前检查Bean是否实现了DisposableBean接口，并调用方法</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">implements</span> <span class="title class_">DisposableBean</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><blockquote><p><strong>Spring容器只对singLeton的Bean进行完整的生命周期管理</strong><br>如果是scope = <strong>porototype 作用域的Bean，Spring容器只负责将bean初始化完</strong>，等客户端程序一旦获取到Bean之后，Spring容器就不再营理该对象的生命周期了.</p></blockquote><h3 id="将自己new的对象纳入spring容器管理"><a href="#将自己new的对象纳入spring容器管理" class="headerlink" title="将自己new的对象纳入spring容器管理"></a>将自己new的对象纳入spring容器管理</h3><blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自己 new 的对象</span></span><br><span class="line"><span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line"><span class="comment">// 注册管理</span></span><br><span class="line"><span class="type">DefaultListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">factory.registerSingleton(<span class="string">&quot;stuBean&quot;</span>,stu);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从容器获取 Bean</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">stuBean</span> <span class="operator">=</span> factory.getBean(<span class="string">&quot;stuBean&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Bean-的循环依赖"><a href="#Bean-的循环依赖" class="headerlink" title="Bean 的循环依赖"></a>Bean 的循环依赖</h3><blockquote><p>A对象引用B属性，B对象引用A属性。相互引用</p></blockquote><p>singleton + setter模式下的循环依赖是没有问题的。</p><p>本质原因：任意一个Bean实例化时，马上经行曝光，其他Bean可以引用它了，此时属性可能还没有注入。因为是单例，全局只有一个</p><p><strong>prototype + setter 模式下循环依赖出现问题</strong>。当其中一个类型是 singleton 时就没问题</p><p><strong>基于构造方法的注入模式下循环依赖会出现问题</strong></p><h3 id="spring-IoC注解式开发"><a href="#spring-IoC注解式开发" class="headerlink" title="spring IoC注解式开发"></a>spring IoC注解式开发</h3><blockquote><p>用来简写配置，避免编写xml文件</p></blockquote><h4 id="声明Bean的注解"><a href="#声明Bean的注解" class="headerlink" title="声明Bean的注解"></a>声明Bean的注解</h4><blockquote><p>1、使用注解需要AOP的依赖</p><p>2、配置<strong>context命名空间</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure><p>3、给spring框架开启扫描哪些包中的类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xxx.bean&quot;</span> /&gt;</span></span><br><span class="line">多个包用,隔开。也可以使用父包名</span><br></pre></td></tr></table></figure><p>4、在bean上使用注解</p></blockquote><ol><li>@Component</li><li>@Controller</li><li>@Service</li><li>@Repository</li></ol><h4 id="选择性实例化"><a href="#选择性实例化" class="headerlink" title="选择性实例化"></a>选择性实例化</h4><p>方式1</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 让所有属性失效</span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xxx.bean&quot;</span>  <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">// 只让Component注解生效</span><br><span class="line"><span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Component&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p>方式2</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xxx.bean&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 除了Component注解其他都生效</span><br><span class="line"><span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Component&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="负责注入的注解"><a href="#负责注入的注解" class="headerlink" title="负责注入的注解"></a>负责注入的注解</h3><ol><li>@Value</li><li>@Autowired</li><li>@Qualifier</li><li>@Resource</li></ol><h4 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h4><blockquote><p>要注入属性类型是简单类型时，可以使用。</p><p>此方式注入不依赖set方法。可以用在属性上，构造方法形参上，set方法上</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;张三&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="meta">@Value(&quot;张三&quot;)</span> String name, <span class="meta">@Value(&quot;42&quot;)</span><span class="type">int</span> age)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value(&quot;张三&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Autowired-与-Qualifier"><a href="#Autowired-与-Qualifier" class="headerlink" title="@Autowired 与 @Qualifier"></a>@Autowired 与 @Qualifier</h4><blockquote><p>@Autowired 可以注入<strong>非简单类型</strong>， 自动装配【默认是ByType】</p><p>如需按 名字注入需和  @Qualifier一起使用</p><p>此方式注入也不依赖set方法。可以使用在 <strong>成员属性</strong>，<strong>构造方法</strong>，<strong>构造方法形参</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OrderDao.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderDaoImpl.java</span></span><br><span class="line"><span class="meta">@Component(&quot;orderDaoImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在插入...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderTest.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTest</span> &#123;</span><br><span class="line">    <span class="comment">// 自动将 OrderDao 实现类 OrderDaoImpl 注入， 但是如果有多个类实现OrderDao就不能自动类型装配需要联合@Qualifier一起使用</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;orderDaoImpl&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        orderDao.insert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果此时还有一个类实现了 OrderDao</span></span><br><span class="line"><span class="comment">// OrderDaoImpl.java</span></span><br><span class="line"><span class="meta">@Component(&quot;orderDaoImpl1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDaoImpl1</span> <span class="keyword">implements</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在插入1...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h4><blockquote><p>可以完成非简单类型注入。存在于<strong>jdk拓展包中（所以使用时需要额外引入）</strong>，可理解为标准注解。而@Autowired 是spring框架自己的。</p><p>Resource注解可用在 属性上，setter方法上。</p><p>现根据类型装配，找不到就根据名字</p></blockquote><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// spring5</span><br><span class="line">javax.annotation-api</span><br><span class="line"></span><br><span class="line">// spring6</span><br><span class="line">jakarta.annotation-api</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name=&quot;orderDaoImpl&quot;)</span></span><br><span class="line"><span class="keyword">private</span> OrderDao orderDao;</span><br></pre></td></tr></table></figure><h3 id="全注解开发"><a href="#全注解开发" class="headerlink" title="全注解开发"></a>全注解开发</h3><blockquote><p>不使用配置文件，通过其他方式获取XML返回值</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 现在 用一个java配置类代替xml</span></span><br><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConf.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SpringConf.java</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.xxx.dao&quot;,&quot;com.xxx.service&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConf</span> () &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><blockquote><p>@Configuration用于定义配置类，可替换xml配置文件，被注解的类内部包含有一个或多个被@Bean注解的方法，这些方法将会被AnnotationConfigApplicationContext或AnnotationConfigWebApplicationContext类进行扫描，并用于构建bean定义，初始化Spring容器。</p><p><strong>注意</strong>：@Configuration注解的配置类有如下要求：</p><ol><li>@Configuration不可以是final类型；</li><li>@Configuration不可以是匿名类；</li><li>嵌套的configuration必须是静态类。</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">myBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// instantiate, configure and return bean ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结论:</p><p>@Configuation等价于&lt;Beans&gt;&lt;/Beans&gt;</p><p>@Bean等价于&lt;Bean&gt;&lt;/Bean&gt;</p><p>@ComponentScan等价于&lt;context:component-scan base-package=”com.ahies.ija.management”/&gt;</p></blockquote><h3 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h3><blockquote><p>spring内置的对jdbc的简化操作方式。但实际项目中一般会使用mybatis</p></blockquote><p>配置 JdbcTemplate</p><p>依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    德鲁伊连接池    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>spring.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  配置数据源  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置 jdbcTemplate --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;jdbcTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">selectByActno</span><span class="params">(String actno)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select actno,balance from t_act where actno = ?&quot;</span>;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Account.class), actno);</span><br><span class="line">        <span class="keyword">return</span> account;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Account act)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = ? where actno = ?&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.update(sql, act.getBalance(), act.getActno());</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GoF之代理模式"><a href="#GoF之代理模式" class="headerlink" title="GoF之代理模式"></a>GoF之代理模式</h3><h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><blockquote><p>需求：检测出所有Service业务方法的耗时时间</p><p>-硬编码：每个业务方法中直接添加计时代码</p><p>​    违背OCP开闭原则</p><p>-编写业务子类，继承业务类，对每个业务方法重写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SubService <span class="keyword">extends</span> <span class="title class_">FatherService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXXX</span><span class="params">(id)</span> &#123;</span><br><span class="line">        <span class="comment">// 开启计时</span></span><br><span class="line">        <span class="built_in">super</span>(id);</span><br><span class="line">        <span class="comment">// 结束计时</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    代码耦合度高，没有复用</p><p>-代理对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> FatherServiceProxy <span class="keyword">implements</span> <span class="title class_">FatherService</span> &#123;</span><br><span class="line">    <span class="comment">// 代理目标,代理接口，不要代理实现类</span></span><br><span class="line">    <span class="keyword">private</span> FatherService target;</span><br><span class="line">    <span class="comment">// 构造赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FatherServiceProxy</span><span class="params">(FatherService targrt)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = targrt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteXXX</span><span class="params">(id)</span> &#123;</span><br><span class="line">        <span class="comment">// 开启计时</span></span><br><span class="line">        target.deleteXXX(id);</span><br><span class="line">        <span class="comment">// 结束计时</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建目标</span></span><br><span class="line"><span class="type">FatherService</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FatherServiceImpl</span>();</span><br><span class="line"><span class="comment">// 创建代理对象</span></span><br><span class="line"><span class="type">FatherServiceProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FatherServiceProxy</span>(target);</span><br><span class="line"><span class="comment">// 调用代理方法</span></span><br><span class="line">proxy.deleteXXX(<span class="string">&quot;1&quot;</span>);</span><br></pre></td></tr></table></figure><p>​    符合OCP原则，耦合度低.但是没有复用每个类都要新增一个代理类，类多</p></blockquote><h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><blockquote><p>还是代理模式，只是新增了字节码生成技术，动态生成代理对象。减少代理类的数量</p></blockquote><p>动态代理技术：</p><ul><li>jdk内置动态代理 Proxy,只能代理接口</li><li>CGLIB动态代理技术，是一个开源库，底层是继承方式继承。性能比jdk动态代理好（底层有个小儿快的字节码处理框架 ASM）</li><li>javassist </li></ul><h5 id="jdk-动态代理"><a href="#jdk-动态代理" class="headerlink" title="jdk 动态代理"></a>jdk 动态代理</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要代理的接口 OrderService</span></span><br><span class="line"><span class="comment">// 实现类 OrderServiceImpl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建代理对象</span></span><br><span class="line"><span class="type">OrderService</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderServiceImpl</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建代理对象</span></span><br><span class="line"><span class="comment">// 参数1：类加载器，和目标加载器一致</span></span><br><span class="line"><span class="comment">// 参数2：代理类要实现的接口</span></span><br><span class="line"><span class="comment">// 参数3：调用处理器，传入要增强的程序</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),target.getClass.getInterfaces(), <span class="keyword">new</span> <span class="title class_">TimerInvocationHandle</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用代理对象方法</span></span><br><span class="line">proxy.xxx();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimerInvocationHandle</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">// 参数1：代理对象</span></span><br><span class="line">    <span class="comment">// 参数2：代理目标对象方法</span></span><br><span class="line">    <span class="comment">// 参数3：代理目标对象方法接收的参数</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> <span class="title function_">Throwable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Object</span> <span class="variable">retValue</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="CGLIB动态代理"><a href="#CGLIB动态代理" class="headerlink" title="CGLIB动态代理"></a>CGLIB动态代理</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建字节码增强对象</span></span><br><span class="line"><span class="type">Enhancer</span> <span class="variable">enhacer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line"><span class="comment">// 设置目标类</span></span><br><span class="line">enhacer.setSuperclass(UserService.class);</span><br><span class="line"><span class="comment">// 设置回调</span></span><br><span class="line">enhacer.setCallback(<span class="keyword">new</span> <span class="title class_">TimerMethodInterceptor</span>());</span><br><span class="line"><span class="comment">// 创建代理</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> enhancer.create();</span><br><span class="line"><span class="comment">// 调用代理方法</span></span><br><span class="line">proxy.login();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimerMethodInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object targrt, Method method, Object[] objcts, MethodProxy methodProxy)</span> <span class="keyword">throw</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">retValue</span> <span class="operator">=</span> methodProxy.invokeSuper(target, objects);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> retValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="面向切面编程"><a href="#面向切面编程" class="headerlink" title="面向切面编程"></a>面向切面编程</h3><blockquote><p>切面编程（AOP）底层就是通过动态代理来实现的，是OOP的补充和延申。</p><p>spring 的AOP 使用的代理是：jdk 的动态代理是+CGLIB动态代理技术。jdk代理接口，CGLIB代理类，自由切换，也可以设置只是用 CGLIB</p><p>具体使用场景，项目中日志模块，安全模块，事务模块，这些服务被称为交叉业务。它们都使用面向切面来实现</p></blockquote><h4 id="连接点-Joinpe"><a href="#连接点-Joinpe" class="headerlink" title="连接点 Joinpe"></a>连接点 Joinpe</h4><blockquote><p>在程序的整个执行流程中，可以织入切面的位置。方法的执行前后，异常抛出之后等位置</p></blockquote><h4 id="切点-Pointcut"><a href="#切点-Pointcut" class="headerlink" title="切点 Pointcut"></a>切点 Pointcut</h4><blockquote><p>在程序执行流程中，真正织入切面的方法。本质就是方法。一个切点对应多个连接点</p></blockquote><h4 id="通知-Advice"><a href="#通知-Advice" class="headerlink" title="通知 Advice"></a>通知 Advice</h4><blockquote><p>通知就是增强代码，就是具体要织入的代码。根据放置的位置有不同名字</p><ul><li>前置通知</li><li>后置通知</li><li>环绕通知</li><li>异常通知</li><li>最终通知</li></ul></blockquote><h4 id="切面-Aspect"><a href="#切面-Aspect" class="headerlink" title="切面 Aspect"></a>切面 Aspect</h4><blockquote><p>切点 + 通知 就是 切面</p></blockquote><h4 id="织入"><a href="#织入" class="headerlink" title="织入"></a>织入</h4><blockquote><p>把通知应用到目标对象的过程</p></blockquote><h4 id="代理对象-proxy"><a href="#代理对象-proxy" class="headerlink" title="代理对象 proxy"></a>代理对象 proxy</h4><blockquote><p>一个目标对象被织入通知后产生的新对象</p></blockquote><h3 id="目标对象-Target"><a href="#目标对象-Target" class="headerlink" title="目标对象 Target"></a>目标对象 Target</h3><blockquote><p>被织入通知的对象</p></blockquote><h4 id="切点表达式"><a href="#切点表达式" class="headerlink" title="切点表达式"></a>切点表达式</h4><blockquote><p>切点表达式用来定义通知往哪些方法上切入</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution([访问控制权限修饰符] 返回值类型 [全限定类名]方法名(形式参数列表) [异常])</span><br></pre></td></tr></table></figure><p><strong>访问控制权限修饰符</strong></p><ul><li>可选项</li><li>没写，就是4个权限都包括。</li><li>写public就表示只包括公开的方法</li></ul><p><strong>返回值类型</strong></p><ul><li>必填项。</li><li>*表示返回值类型任意</li></ul><p><strong>全限定类名</strong>:</p><ul><li>可选项</li><li>两个点”..”代表当前包以及子包下的所有类</li><li>省略时表示所有的类</li></ul><p><strong>方法名</strong></p><ul><li>必填项。</li><li>*表示所有方法</li><li>set*表示所有的set方法</li></ul><p><strong>形式参数列表</strong></p><ul><li>必填项</li><li>0表示没有参数的方法</li><li>(..)参数类型和个数随意的方法</li><li>(*)只有一个参数的方法</li><li>(*,String)第一个参数类型随意，第二个参数是String的。</li></ul><p><strong>异常</strong></p><ul><li>可选项。</li><li>省略时表示任意异常类型</li></ul><p><strong>service包下所有的类以delete开始的所有方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> * com.xxx.service.*.delete*(..))</span><br></pre></td></tr></table></figure><h4 id="使用spring-的AOP"><a href="#使用spring-的AOP" class="headerlink" title="使用spring 的AOP"></a>使用spring 的AOP</h4><ol><li>spring 框架结合Aspectj 框架 实现的AOP，基于注解方式</li><li>spring 框架结合Aspectj 框架 实现的AOP，基于XML方式</li><li>spring 框架自己实现的AOP（基本不用）</li></ol><blockquote><p>准备依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring-context</span><br><span class="line">spring-aop</span><br><span class="line">spring-aspects</span><br></pre></td></tr></table></figure><p>spring 配置context，aop命名空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line"></span><br><span class="line">xsi:schemaLocation=&quot;</span><br><span class="line">http://www.springframework.org/schema/beans http://www.springframework.org/beans/spring-beans.xsd</span><br><span class="line">http://www.springframework.org/schema/context http://www.springframework.org/context/spring-context.xsd</span><br><span class="line">http://www.springframework.org/schema/aop http://www.springframework.org/aop/spring-aop.xsd</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.spring.bean.service&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  开启aspectj 的自动代理</span></span><br><span class="line"><span class="comment">    proxy-target-class: true 表示CGLIB动态代理，反之jdk动态代理</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>目标对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在登录！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>切面通知：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// 切面 = 通知 + 切点</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.spring.bean.service.LoginService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeLogin</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">LoginService</span> <span class="variable">loginService</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;loginService&quot;</span>, LoginService.class);</span><br><span class="line">loginService.login();</span><br></pre></td></tr></table></figure></blockquote><p>前置通知: @Before 目标方法执行之前的通知</p><p>后置通知:@AfterReturning 目标方法执行之后的通知</p><p>环绕通知: @Around 目标方法之前添加通知，同时目标方法执行之后添加通知</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(* com.powernode.spring6.service..*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;前环绕&quot;</span>);</span><br><span class="line">joinPoint.proceed();</span><br><span class="line">System.out.println(<span class="string">&quot;后环绕&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>异常通知:@AfterThrowing 发生异常之后执行的通知</p><p>最终通知: @After 放在finally语句块中的通知</p><h4 id="多个切面的执行顺序"><a href="#多个切面的执行顺序" class="headerlink" title="多个切面的执行顺序"></a>多个切面的执行顺序</h4><blockquote><p>给切面类添加注解 @Order(1)。 其中数字越小，执行越靠前</p></blockquote><h4 id="通用切点"><a href="#通用切点" class="headerlink" title="通用切点"></a>通用切点</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commomPoint</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 代码复用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before(&quot;commomPoint()&quot;)</span></span><br></pre></td></tr></table></figure><h4 id="AOP-之连接点"><a href="#AOP-之连接点" class="headerlink" title="AOP 之连接点"></a>AOP 之连接点</h4><blockquote><p>除了 环绕通知外，其他通知都可以接受 ( JoinPoint joinPoint ){}.\</p><p>通过 joinPoint 可以拿到 joinPoint签名 获取目标方法的信息</p></blockquote><h4 id="全注解方式开发"><a href="#全注解方式开发" class="headerlink" title="全注解方式开发"></a>全注解方式开发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.powernode.spring6.service&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spring6Config</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="基于XML的方式开发"><a href="#基于XML的方式开发" class="headerlink" title="基于XML的方式开发"></a>基于XML的方式开发</h4><blockquote><p>了解一下配置文件方式开发</p></blockquote><p>配置文件：添加 aop,context 命名空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loginService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.LoginService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xxx.LogAspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aop配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--切点表达式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;mypointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.powernode.spring6.service..*(..))&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--切面： 通知+切点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;logAspect&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeLogin&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;mypointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>目标对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在登录！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>切面通知：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// 切面 = 通知 + 切点</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.spring.bean.service.LoginService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeLogin</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="编程式事务解决方法"><a href="#编程式事务解决方法" class="headerlink" title="编程式事务解决方法"></a>编程式事务解决方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(* com.spring.bean.service.LoginService.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">arroundAdvice</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 前环绕</span></span><br><span class="line">        System.out.println(<span class="string">&quot;开启事务&quot;</span>);</span><br><span class="line">        <span class="comment">// 执行目标</span></span><br><span class="line">        joinPoint.proceed();</span><br><span class="line">        <span class="comment">// 后环绕</span></span><br><span class="line">        System.out.println(<span class="string">&quot;提交事务&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;回滚事务&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AOP的实际案例：安全日志"><a href="#AOP的实际案例：安全日志" class="headerlink" title="AOP的实际案例：安全日志"></a>AOP的实际案例：安全日志</h4><blockquote><p>项目开发结束，上线了。运行正常。客户提出新需求，凡是在系统中经行增删改操作的，都要把这个人的记录下来。因为这几个操作是危险的</p></blockquote><p>切面</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.log.service.UserService.save*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">savePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.log.service.UserService.delete*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deletePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.log.service.UserService.modify*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modifyPointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;savePointcut()||deletePointcut()||modifyPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">nowTime</span> <span class="operator">=</span> format.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        System.out.println(nowTime + <span class="string">&quot;张三&quot;</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="string">&quot;.&quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>目标类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUSer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新增用户信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUSer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除用户信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modifyUSer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改用户信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUSer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取用户信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="spring事务"><a href="#spring事务" class="headerlink" title="spring事务"></a>spring事务</h3><p>编程式事务：通过编写代码的方式来实现</p><p>声明式事务：基于注解，基于XML两种方式</p><blockquote><p>spring 底层通过AOP方式对事务进行了封装。所以spring专门针对事务开发了一套API</p><p>spring6中有他的两个实现</p><ul><li>DataSourceTransactionManager： 支持jdbcTemplate,Mybatis,Hibenate等事务管理</li><li>JtaTransactionManager: 支持分布式事务管理</li></ul></blockquote><h4 id="基于注解的事务管理："><a href="#基于注解的事务管理：" class="headerlink" title="基于注解的事务管理："></a>基于注解的事务管理：</h4><p>配置任务管理器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    创建事务管理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  注入数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置<strong>tx</strong>命名空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;</span><br><span class="line">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</span><br></pre></td></tr></table></figure><p>开启事务注解</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在类上，方法上使用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Transaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfor</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注解参数详情（声明式事务管理参数配置）</p><p>1、propagation：事务的传播行为<br>    当一个事务方法被另一个事务方法调用的时候，这个事务方法如何进行<br>    事务的传播行为可以由传播属性指定，spring定义了7种类传播行为</p><ul><li>REQUIRED: 支持当前事务，如果不存在就新建一个默认)[<strong>没有就新建，有就加入</strong>]</li><li>SUPPORTS: 支持当前事务，如果当前没有事务，就以非事务方式执行[<strong>有就加入，没有就不管了</strong>]</li><li>MANDATORY:必须运行在一个事务中，如果当前没有事务正在发生，将抛出一个异常[<strong>有就加入，没有就抛异常</strong>]</li><li>REQUIRES NEW:开启一个的务，如果一个事务已经存在，则将这存在的事务挂起[<strong>不营有没有，直接开启一新务，开启的新事务和之前的事务不存在套关系，之前事务按起</strong>]</li><li>NOT_SUPPORTED: 以非事务方式运行，如果有事务存在，挂起当前事务[<strong>不支持事务，存在就挂起</strong>]</li><li>NEVER: 以非事务方式运行，如果有事务存在，抛出异常[<strong>不支持事务，存在就抛异常]如果外层事务不存在，行为就像REQUIRED一样</strong>]</li><li>NESTED:如果当前正有一个事务在进行中，则该方法应当运行在一个嵌套式事务中。被嵌套的事务可以独立于外层事务进行提交或回滚。样。[<strong>有事务的话，就在这个事务里再嵌套一个完全独立的事务，嵌套的事务可以独立的提交和回滚。没有事务就和REQUIRED一样。</strong>]</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br></pre></td></tr></table></figure><p>2、ioslation:事务隔离级别<br>    （1）事务有特性称为隔离性，多事务操作之间不会产生影响，不考虑隔离性产生很多问题<br>    （2）不考虑隔离性则存在三个问题：脏读、不可重复读、虚（幻）读<br>    （3）脏读：一个未提交事务读取到另一个未提交事务的数据<br>    （4）不可重复读：一个未提交事务读取到另一个提交事务修改数据<br>    （5）幻读：一个未提交事务读取到另一提交事务添加数据<br>    （6）通过设置事务隔离性，解决读问题</p><p>3、timeout：超时时间<br>    （1）事务需要在一定时间内（<strong>代码最后一条DML方法执行完加上之前的时间</strong>）进行提交，如果不提交则进行回滚<br>    （2）默认值是-1，设定时间以秒为单位计算</p><p>4、readOnly：是否只读【里面不会执行增删改操作，设置后spring会启动优化策略，提高select语句执行效率】<br>    （1）读：查询操作，写：添加修改删除操作<br>    （2）readOnly默认设置为false，表示可以查询，可以添加修改删除操作<br>    （3）设置为true后，只能查询</p><p>5、rollbackFor：回滚<br>    （1）设置出现哪些异常进行事务回滚</p><p>6、norollbackFor：不回滚<br>    （1）设置出现哪些异常不进行事务回滚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 出现 RuntimeException 异常或子类异常不回滚</span></span><br><span class="line"><span class="meta">@Transaction(norollbackFor = RuntimeException.clas)</span></span><br></pre></td></tr></table></figure><h4 id="全注解式事务开发"><a href="#全注解式事务开发" class="headerlink" title="全注解式事务开发"></a>全注解式事务开发</h4><p>xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--  开启aspectj 的自动代理</span></span><br><span class="line"><span class="comment">        proxy-target-class: true 表示CGLIB动态代理，反之jdk动态代理</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 主要下面配置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  开启bean自动扫描注册  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.bank&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--  配置数据源  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb01&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置 jdbcTemplate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    创建事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  注入数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注解驱动器 对应注解 EnableTransactionManagement--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注解文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 代spring.xml配置文件，在这个类当中完成配置</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.powernode.bank&quot;)</span> <span class="comment">// 组件打描</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">// 开启事务注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spring6Config</span> &#123;</span><br><span class="line"><span class="comment">// Spring框架，看到这个Bean注解后，会调用这个被标注的方法，这个方法的返回值是一个java对象，这个java对象会自动的入IOC容器管理返回的对象就是Spring容器当中的一个Bean 了。并且这个bean的名字是: dataSource</span></span><br><span class="line">    <span class="meta">@Bean(name =&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">getDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverclassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/spring6&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="meta">@Bean(name=&quot;jdbcTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JdbcTemplate <span class="title function_">getJdbcTemplate</span><span class="params">(DataSource dataSource)</span> &#123;<span class="comment">// spring 在调用此方法时会自动注入</span></span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>();</span><br><span class="line">        jt.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> tj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(name=&quot;transactionManager&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceTransactionManager <span class="title function_">getDataSourceTransactionManager</span><span class="params">(DataSource dataSource)</span> &#123;<span class="comment">// spring 在调用此方法时会自动注入</span></span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        dt.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dj;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Spring6Config.class):</span><br><span class="line"><span class="type">JdbcTemplate</span> <span class="variable">jt</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;jdbcTemplate&quot;</span>, JdbcTemplate.class);</span><br></pre></td></tr></table></figure><h4 id="基于XML的事务管理"><a href="#基于XML的事务管理" class="headerlink" title="基于XML的事务管理"></a>基于XML的事务管理</h4><blockquote><p>但实际开发一般都是注解</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  开启aspectj 的自动代理</span></span><br><span class="line"><span class="comment">    proxy-target-class: true 表示CGLIB动态代理，反之jdk动态代理</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 主要下面配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  开启bean自动扫描注册  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.bank&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  配置数据源  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置 jdbcTemplate --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置事务管理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManagen&quot;</span><span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc .datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置通知，具体的增强代码。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManagen&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置通知的相关属件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--之前所讲的所有的事务属性都可以在以下标签中配置。--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transfer&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Throwable&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Throwable&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;uodate*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Throwable&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;add*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Throwable&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置切面--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;txPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.powernode.bank.service..*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切面 = 通知 + 切点--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Spring对Junit4-的支持"><a href="#Spring对Junit4-的支持" class="headerlink" title="Spring对Junit4 的支持"></a>Spring对Junit4 的支持</h3><h4 id="注解加载指定spring-xml"><a href="#注解加载指定spring-xml" class="headerlink" title="注解加载指定spring.xml"></a>注解加载指定spring.xml</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从类路径加载</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:spring.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTestJUnit4</span>() &#123;</span><br><span class="line">    <span class="comment">// 自动从配置文件注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代替下面代码</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> app.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br></pre></td></tr></table></figure><p>Spring对Junit5 的支持</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// spring 对junit支持的依赖</span><br><span class="line">spring-test</span><br><span class="line"></span><br><span class="line">// junit5</span><br><span class="line">junit-jupiter</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从类路径加载</span></span><br><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:spring.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTestJUnit4</span>() &#123;</span><br><span class="line">    <span class="comment">// 自动从配置文件注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="spring-集成-myBatis"><a href="#spring-集成-myBatis" class="headerlink" title="spring 集成 myBatis"></a>spring 集成 myBatis</h3><p>1、依赖</p><ul><li>spring-context</li><li>spring-jdbc</li><li>mysq驱动</li><li>mybatis</li><li>mybatis-spring: mybatis提供的与spring框架集成的依赖</li><li>德鲁伊连接池</li><li>junit</li></ul><p>2、建包</p><ul><li>service <ul><li>AccountService</li></ul></li><li>service .impl<ul><li>AccountServiceImpl</li></ul></li><li>mapper<ul><li>AccountMapper</li></ul></li><li>pojo<ul><li>Account</li></ul></li></ul><p>3、配置 spring.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  开启bean自动扫描注册  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;bank1.service&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  开启aspectj 的自动代理</span></span><br><span class="line"><span class="comment">        proxy-target-class: true 表示CGLIB动态代理，反之jdk动态代理</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  引入外部属性文件  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  配置数据源  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  配置 SqlSessionFactoryBean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定mybatis 核心配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mybatis.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;bank1.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  开启Mapper 扫描配置  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;bank1.mapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    创建事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  注入数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    注解驱动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>jdbc.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mydb01</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p>mybatis.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>AccountMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;bank1.mapper.AccountMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_act set  balance=#&#123;balance&#125; where actno=#&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByActno&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Account&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM t_act where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="XML配置文件中引入外部XML"><a href="#XML配置文件中引入外部XML" class="headerlink" title="XML配置文件中引入外部XML"></a>XML配置文件中引入外部XML</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;common.xml&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;什么是OCP？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;OCP是软件开发的七大开发原则：开闭原则&lt;/p&gt;
&lt;p&gt;核心：其他6个原则的基础&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;OCP开闭原则核心是什么？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;只要你在扩展功能的时候，没有修改以前写好的代码，那么就是符合OCP原则的，反之则违背了OCP原则    &lt;/p&gt;
&lt;p&gt;当系统功能拓展时，如果动了之前稳定的程序，修改了之前的程序。之前所有程序都需要测试，这是不想看到的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;违背依赖倒置原则（DIP原则）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;上依赖下就是违背&lt;/strong&gt;：如：表示层依赖服务层，服务层依赖持久层&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;控制反转&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;一种编程思想。或设计模式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不在程序中采用硬编码方式来 new 对象&lt;/li&gt;
&lt;li&gt;不在程序中采用硬编码方式来 维护对象关系&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Spring框架&quot;&gt;&lt;a href=&quot;#Spring框架&quot; class=&quot;headerlink&quot; title=&quot;Spring框架&quot;&gt;&lt;/a&gt;Spring框架&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Spring框架实现了控制反转IoC这种思想&lt;ul&gt;
&lt;li&gt;spring帮你new对象&lt;/li&gt;
&lt;li&gt;spring帮你维护对象关系&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Spring 时一个实现了IoC思想的容器&lt;ul&gt;
&lt;li&gt;依赖注入的两种方式（依赖注入时现实IoC的具体实现: XML解析+工厂模式+反射机制）&lt;ul&gt;
&lt;li&gt;set 注入(执行set给属性赋值)&lt;/li&gt;
&lt;li&gt;构造方法 注入(执行构造方法给属性赋值)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230217170739281.png&quot; alt=&quot;image-20230217170739281&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="spring基础" scheme="https://wyf195075595.github.io/tags/spring%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>maven基础</title>
    <link href="https://wyf195075595.github.io/2023/02/14/programming/java/maven/"/>
    <id>https://wyf195075595.github.io/2023/02/14/programming/java/maven/</id>
    <published>2023-02-14T03:20:00.000Z</published>
    <updated>2023-02-17T08:35:11.877Z</updated>
    
    <content type="html"><![CDATA[<h3 id="项目管理器，可以帮我们做什么？"><a href="#项目管理器，可以帮我们做什么？" class="headerlink" title="项目管理器，可以帮我们做什么？"></a>项目管理器，可以帮我们做什么？</h3><blockquote><ul><li>管理jar 文件</li><li>自动下载jar和他的文档源码</li><li>管理jar直接的依赖，a.jar 依赖b.jar 他会自动下载b.jar</li><li>帮你管理jar的版本</li><li>帮你编译程序： java-&gt; class</li><li>帮你测试代码</li><li>帮你打包，形成jar/war 文件</li><li>帮你部署项目</li></ul></blockquote><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ol><li><p>POM</p><p> 把一个项目当作模型使用。控制maven构建项目的过程</p></li><li><p>约定的目录结构</p><p> maven项目的目录和文件和位置都是规范的</p></li><li><p>依赖仓库</p><p> 管理项目可以使用的jar</p></li><li><p>仓库管理</p><p> 资源存放的位置</p></li><li><p>生命周期</p></li><li><p>插件和木比爱哦</p></li><li><p>继承</p></li><li><p>聚合</p></li></ol><h3 id="修改本机资源存放目录位置"><a href="#修改本机资源存放目录位置" class="headerlink" title="修改本机资源存放目录位置"></a>修改本机资源存放目录位置</h3><p>修改maven的配置文件，maven的安装目录/conf/settings.xml</p><p>为啥要改？因为默认放在C盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;localRepository&gt;D://maven//localSpace&lt;/localRepository&gt;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="仓库"><a href="#仓库" class="headerlink" title="仓库"></a>仓库</h3><blockquote><p>本地仓库：就是存放maven使用的jar和我们项目使用的jar</p><p>远程仓库：</p><p>中央仓库【mvenrepository.com】：所有开发人员共享的    集中仓库，为了避免服务器压力过大，出现了很多镜像仓库，分布在世界各个位置。我们最好访问离自己近的仓库，访问会比较快</p><p>私服：</p><p>在公司内部，局域网中使用，不对外使用</p></blockquote><h3 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h3><blockquote><p>项目对象模型</p></blockquote><ol><li><p>坐标：唯一值，标识项目唯一</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>公司域名倒写<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>自定义项目名称<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>自定义版本号<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>dependencies 依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 里面存放所有依赖</span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>公司域名倒写<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>自定义项目名称<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>自定义版本号<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>properties: 设置属性</p></li><li><p>build: 构建相关</p></li></ol><h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><ol><li>mvn clean 清理打包文件</li><li>mvn package  打包</li><li>mvn install   安装主程序</li><li>mvn deploy  部署主程序</li><li>mvn compile  编译主程序</li></ol><h3 id="编译插件配置"><a href="#编译插件配置" class="headerlink" title="编译插件配置"></a>编译插件配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        // 插件名</span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        // 插件版本</span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            // jdk1.8 环境写的代码</span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            // 运行环境 jdk 1.8</span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;项目管理器，可以帮我们做什么？&quot;&gt;&lt;a href=&quot;#项目管理器，可以帮我们做什么？&quot; class=&quot;headerlink&quot; title=&quot;项目管理器，可以帮我们做什么？&quot;&gt;&lt;/a&gt;项目管理器，可以帮我们做什么？&lt;/h3&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;管理jar 文件&lt;/li&gt;
&lt;li&gt;自动下载jar和他的文档源码&lt;/li&gt;
&lt;li&gt;管理jar直接的依赖，a.jar 依赖b.jar 他会自动下载b.jar&lt;/li&gt;
&lt;li&gt;帮你管理jar的版本&lt;/li&gt;
&lt;li&gt;帮你编译程序： java-&amp;gt; class&lt;/li&gt;
&lt;li&gt;帮你测试代码&lt;/li&gt;
&lt;li&gt;帮你打包，形成jar/war 文件&lt;/li&gt;
&lt;li&gt;帮你部署项目&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;核心概念&quot;&gt;&lt;a href=&quot;#核心概念&quot; class=&quot;headerlink&quot; title=&quot;核心概念&quot;&gt;&lt;/a&gt;核心概念&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;POM&lt;/p&gt;
&lt;p&gt; 把一个项目当作模型使用。控制maven构建项目的过程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;约定的目录结构&lt;/p&gt;
&lt;p&gt; maven项目的目录和文件和位置都是规范的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;依赖仓库&lt;/p&gt;
&lt;p&gt; 管理项目可以使用的jar&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;仓库管理&lt;/p&gt;
&lt;p&gt; 资源存放的位置&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;生命周期&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;插件和木比爱哦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;继承&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;聚合&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;修改本机资源存放目录位置&quot;&gt;&lt;a href=&quot;#修改本机资源存放目录位置&quot; class=&quot;headerlink&quot; title=&quot;修改本机资源存放目录位置&quot;&gt;&lt;/a&gt;修改本机资源存放目录位置&lt;/h3&gt;&lt;p&gt;修改maven的配置文件，maven的安装目录/conf/settings.xml&lt;/p&gt;
&lt;p&gt;为啥要改？因为默认放在C盘&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;localRepository&amp;gt;D://maven//localSpace&amp;lt;/localRepository&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="maven" scheme="https://wyf195075595.github.io/categories/maven/"/>
    
    
    <category term="maven基础" scheme="https://wyf195075595.github.io/tags/maven%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>mybatis 基础</title>
    <link href="https://wyf195075595.github.io/2023/02/14/programming/java/myBatis/"/>
    <id>https://wyf195075595.github.io/2023/02/14/programming/java/myBatis/</id>
    <published>2023-02-13T17:20:00.000Z</published>
    <updated>2023-02-17T08:34:16.353Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><blockquote><p>O (Object) jvm中的对象</p><p>R (Relational) 关系型数据库</p><p>M (Mapping) 映射</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230214134743208.png" alt="image-20230214134743208"></p><ol><li>支持定制化 SQL、存储过程、基本映射以及高级映射</li><li>避免了几乎所有的JDBC代码中手动设置参数以及获取结果集</li><li>支持XML开发，也支持注解式开发。[为了保证sql语句的灵活，所以mybatis大部分是采用XML方式开发。]</li><li>将接口和Java 的 POJOs(Plain rdinary Java Object，简单普通的Java对象)映射成数据库中的记录体积小好学: </li><li>两个jar包，两个XML配置文件。</li><li>完全做到sal解耦合</li><li>提供了基本映射标签</li><li>提供了高级映射标签</li><li>提供了XML标签，支持动态SQL的编写</li></ol><span id="more"></span><h3 id="开发第一个-Mybatis-程序"><a href="#开发第一个-Mybatis-程序" class="headerlink" title="开发第一个 Mybatis 程序"></a>开发第一个 Mybatis 程序</h3><ol><li><p>resources目录:<br> 放在这个目录当中的，一般都是资源文件，配置文件，直接放到resources目录下的资源，等同于放到了类的根路径下。</p></li><li><p>开发步骤</p><ul><li><p>第一步:打包方式jar</p></li><li><p>第二步:引入依赖</p><ul><li>mybatis依赖</li><li>mysgl驱动依赖</li></ul></li><li><p>第三步:编写mybatis核心配置文件: mybatis-config.xml大</p><blockquote><p>注意:</p><ul><li>第一: 这个文件名不是必须叫做mybatis-config.xml，可以用其他的名字。只是大家都采用这个名字.</li><li>第二:这个文件存放的位置也不是固定的，可以随意，但一般情况下，会放到类的根路径下。</li></ul></blockquote></li></ul></li><li><p>从XML 中构建 SglSessionFactory通过官方的这句话，</p><blockquote><p>你能想到什么呢?</p><p>​    第一:在MyBatis中一定是有一个很重要的对象，这个对象是: SqlSessionFactory对象。</p><p>​    第二: SqlSessionFactory对象的创建需要XML。XML是什么?<br>它一定是一个配置文件</p></blockquote></li><li><p>mybatis中有两个主要的配置文件:</p><blockquote><p>其中一个是: <strong>mybatis-config.xml</strong>，这是核心配置文件，主要配置连接数据库的信息等。（一个）</p><p>另一个是: <strong>XxxxMapper.xml</strong>，这个文件是专门用来编写SQL语句的配置文件。（每个表一个）</p><p>在resources 目录下新建，前者引用后者</p></blockquote></li></ol><h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a><strong>mybatis-config.xml</strong></h3><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>), <span class="string">&quot;指定的环境&quot;</span>);</span><br></pre></td></tr></table></figure><p>事务管理：transactionManager.type = “JDBC” / “MANAGED”</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb01&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   resource从类的根路径查找     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CatMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="数据源-dataSource"><a href="#数据源-dataSource" class="headerlink" title="数据源(dataSource)"></a>数据源(dataSource)</h4><blockquote><p>为程序提供 Connection 对象。此规范是jdk规定的（要实现 javax.sql.DataSource）</p><p>​        dataSource.type=”POOLED” 实际是在指定数据库的连接池。 此外还有（druid,c3p0,dbcp…）</p><p><a href="https://mybatis.net.cn/configuration.html#environments">官方中文文档</a></p></blockquote><h4 id="mybatis-自带的数据源："><a href="#mybatis-自带的数据源：" class="headerlink" title="mybatis 自带的数据源："></a><strong>mybatis 自带的数据源</strong>：</h4><ul><li>UNPOOLED：不使用数据库连接池技术，每次请求都是创建新的Connection对象</li><li>POOLED：使用mybatis自己实现的数据库连接池</li><li>JNDI：集成其他第三方数据库连接池</li></ul><h4 id="JNDI-是一套规范，谁实现了它？"><a href="#JNDI-是一套规范，谁实现了它？" class="headerlink" title="JNDI 是一套规范，谁实现了它？"></a>JNDI 是一套规范，谁实现了它？</h4><blockquote><p>大部分web容器都实现了它，如 tomcat, webLogic, Jetty, WebSphare</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initial_context&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="连接池的配置"><a href="#连接池的配置" class="headerlink" title="连接池的配置"></a>连接池的配置</h4><ul><li><code>poolMaximumActiveConnections</code> – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li><li><code>poolMaximumIdleConnections</code> – 任意时间可能存在的空闲连接数。</li><li><code>poolMaximumCheckoutTime</code> – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li><li><code>poolTimeToWait</code> – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。</li><li><code>poolMaximumLocalBadConnectionTolerance</code> – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 <code>poolMaximumIdleConnections</code> 与 <code>poolMaximumLocalBadConnectionTolerance</code> 之和。 默认值：3（新增于 3.4.5）</li><li><code>poolPingQuery</code> – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息。</li><li><code>poolPingEnabled</code> – 是否启用侦测查询。若开启，需要设置 <code>poolPingQuery</code> 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false。</li><li><code>poolPingConnectionsNotUsedFor</code> – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 配置最大连接数</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolMaximumActiveConnections&quot;</span> <span class="attr">calue</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">// 每隔两秒打印日志，并尝试获取连接对象</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolTimeToWait&quot;</span> <span class="attr">calue</span>=<span class="string">&quot;2000&quot;</span>/&gt;</span></span><br><span class="line">// 强行让某个连接空闲，超时10s设置为空闲状态</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolMaximumCheckoutTime&quot;</span> <span class="attr">calue</span>=<span class="string">&quot;10000&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">空闲连接数5, 如果有6个空闲连接，会真正关闭一个空闲连接</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;poolMaximumIdleConnections&quot;</span> <span class="attr">calue</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="properties-属性配置"><a href="#properties-属性配置" class="headerlink" title="properties 属性配置"></a>properties 属性配置</h4><blockquote></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 设置</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;home&quot;</span> <span class="attr">value</span>=<span class="string">&quot;D://mybatis/resource/&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 使用</span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   resource从类的根路径查找     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">path</span>=<span class="string">&quot;$&#123;home&#125;CatMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用 properties 文件方式配置</p><p>在resource 目录下新建 jdbc.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/mydb01</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p>映射到 mybatis-config.xml 中 property 中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;123456&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CatMapper-xml"><a href="#CatMapper-xml" class="headerlink" title="CatMapper.xml"></a><strong>CatMapper.xml</strong></h3><blockquote><p>namespace 指定命名空间，那么多个mapper 文件出现相同的id也不会冲突了</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCar&quot;</span>&gt;</span></span><br><span class="line">        insert into t_car(id, car_num,brand,guide_price, produce_time, car_type)</span><br><span class="line">        values(null, &#x27;1003&#x27;, &#x27;丰田霸道&#x27;,30.0,&#x27;2000-10-11&#x27;,&#x27;燃油车&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="程序-CatMapper-xml-中的-insert-语句"><a href="#程序-CatMapper-xml-中的-insert-语句" class="headerlink" title="程序 CatMapper.xml 中的 insert 语句"></a>程序 CatMapper.xml 中的 insert 语句</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span>  <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 获取 sqlSessionFactoryBuilder</span></span><br><span class="line">    <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">    <span class="comment">// 获取 SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory1</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">    <span class="comment">// 获取 SqlSession 对象</span></span><br><span class="line">    sqlSession = sqlSessionFactory1.openSession();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;insertCar&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">    <span class="comment">// 手动提交</span></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    sqlSession.rollback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>细节：</p><p>mybatis 中sql语句可以省略 ”；“</p><p>Resource.getResourceAsStream() 是从 类路径下查找，大部分resource都是这样的</p><p>Resource.getResourceAsStream 底层实际上调用的是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Classloader.getSystemClassLoader().getResourceAsStream(<span class="string">&quot;xxx.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>核心配置文件名字不一定非的是 mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 类路径</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CatMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">// 绝对路径</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">utl</span>=<span class="string">&quot;file:///d:/CatMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="mybatis-事务管理机制"><a href="#mybatis-事务管理机制" class="headerlink" title="mybatis 事务管理机制"></a>mybatis 事务管理机制</h3><blockquote><p>配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// mybatis自己采用原生JDBC方式管理事务</span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">// mybatis 不在负责事务，交给其他容器管理。如：spring</span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="封装-SqlSession-对象"><a href="#封装-SqlSession-对象" class="headerlink" title="封装 SqlSession 对象"></a>封装 SqlSession 对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="comment">// 防止 new 对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SqlSessionUtil</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类加载时，解析mtbatis-config.xml 文件。创建 SqlSessionFactory 对象</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 获取会话对象</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Mybatis-日志"><a href="#Mybatis-日志" class="headerlink" title="Mybatis 日志"></a>Mybatis 日志</h3><blockquote><p>settings 标签要出现在 environments 标签之前，STDOUT_LOGGING 为 mybatis 自己实现的日志格式，其他格式需要引入第三方库 如 SLF4J</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="集成logback-日志框架"><a href="#集成logback-日志框架" class="headerlink" title="集成logback 日志框架"></a>集成logback 日志框架</h4><ol><li><p>pom 中引入依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置文件 logback.xml/logback-test.xml</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  控制台输出  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">        %msg: 日志消息，%n 换行符  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg %n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  mybatis log configure  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.apache.ibatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.Statement&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.PreparedStatement&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.Connection&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  日志输出级别， TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="使用-mybatis-完成CRUD"><a href="#使用-mybatis-完成CRUD" class="headerlink" title="使用 mybatis 完成CRUD"></a>使用 mybatis 完成CRUD</h3><blockquote></blockquote><ol><li><p>C：Create 增</p><p> 使用 #{} 代价 ？占位符。 执行 sqlSessqion.insert() 时可传入一个Map集合,此时 #{map集合的key}</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCar&quot;</span>&gt;</span></span><br><span class="line">    insert into t_car(id, car_num,brand,guide_price, produce_time, car_type)</span><br><span class="line">    values(null, #&#123;&#125;, #&#123;&#125;,#&#123;&#125;,#&#123;&#125;,#&#123;&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 建立 pojo类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="comment">// 建议使用包装类，防止NULL问我呢提</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String carNum;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Double guidePrice;</span><br><span class="line">    <span class="keyword">private</span> String produceTime;</span><br><span class="line">    <span class="keyword">private</span> String carType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(Long id, String carNum, String brand, Double guidePrice, String produceTime, String carType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.carNum = carNum;</span><br><span class="line">        <span class="built_in">this</span>.brand = brand;</span><br><span class="line">        <span class="built_in">this</span>.guidePrice = guidePrice;</span><br><span class="line">        <span class="built_in">this</span>.produceTime = produceTime;</span><br><span class="line">        <span class="built_in">this</span>.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Car&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, carNum=&#x27;&quot;</span> + carNum + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, brand=&#x27;&quot;</span> + brand + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, guidePrice=&quot;</span> + guidePrice +</span><br><span class="line">                <span class="string">&quot;, produceTime=&#x27;&quot;</span> + produceTime + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, carType=&#x27;&quot;</span> + carType + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCarNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCarNum</span><span class="params">(String carNum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.carNum = carNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrand</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getGuidePrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGuidePrice</span><span class="params">(Double guidePrice)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.guidePrice = guidePrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProduceTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProduceTime</span><span class="params">(String produceTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.produceTime = produceTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCarType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCarType</span><span class="params">(String carType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.carType = carType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> pojo 类实例化</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;3333&quot;</span>, <span class="string">&quot;保时捷&quot;</span>,<span class="number">40.0</span>,<span class="string">&quot;2020-10-12&quot;</span>,<span class="string">&quot;新能源&quot;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">执行 sqlSessqion.insert() 时传入 car ,#&#123;&#125;中写pojo类的属性名</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li><li><p>R:Retrieve 查</p><p> 单个查询</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCar&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">    select * from t_car where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// sqlSession.selectOne(&quot;selectCar&quot;, 37)</span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">老版本 mybatis 好像会有 字段对应问题 如 pojo 类中的小驼峰命名与数据库的下划线命名会导致查询不到字段的值， 查询时需要用 as 语法赋值别名与 pojo类中的一致</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><p> 列表查询</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCarAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.pojo.Car&quot;</span>&gt;</span></span><br><span class="line">    select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">List<span class="tag">&lt;<span class="name">Car</span>&gt;</span> rs = sqlSession.selectList(&quot;selectCarAll&quot;);</span><br></pre></td></tr></table></figure></li><li><p>U:Update 改</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateCar&quot;</span>&gt;</span></span><br><span class="line">update t_car set car_num=#&#123;carNum&#125;,brand=#&#123;brand&#125;,guide_price=#&#123;guidePrice&#125;,produce_time=#&#123;produceTime&#125;,car_type=#&#123;carType&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// sqlSession.update(&quot;updateCar&quot;, car)</span><br></pre></td></tr></table></figure></li><li><p>D：Delete 删</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteCar&quot;</span>&gt;</span></span><br><span class="line">    delete from t_car where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 如果#&#123;&#125; 只有一个，那么中间的属性可以随便写，最好见名知意</span><br><span class="line">sqlSession.delete(&quot;deleteCar&quot;, 37)</span><br></pre></td></tr></table></figure></li></ol><h3 id="dom4j-解析xml文件"><a href="#dom4j-解析xml文件" class="headerlink" title="dom4j 解析xml文件"></a>dom4j 解析xml文件</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   dom4j缺少的依赖包     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    &lt;settings&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        &lt;setting name=&quot;logImpl&quot; value=&quot;SLF4J&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;/settings&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;production&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    一个环境对应一个 SqlSessionFactory 对象    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   resource从类的根路径查找     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;CatMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="解析xml配置文件"><a href="#解析xml配置文件" class="headerlink" title="解析xml配置文件"></a>解析xml配置文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadXMLTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> DocumentException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title function_">getDocument</span><span class="params">(String url)</span> <span class="keyword">throws</span> DocumentException &#123;</span><br><span class="line">        <span class="type">SAXReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">        <span class="keyword">return</span>  reader.read(ClassLoader.getSystemClassLoader().getResourceAsStream(url));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parseXML</span><span class="params">()</span> <span class="keyword">throws</span> DocumentException &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> getDocument(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="type">Element</span> <span class="variable">environments</span> <span class="operator">=</span> (Element) document.selectSingleNode(<span class="string">&quot;/configuration/environments&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">defaultId</span> <span class="operator">=</span> environments.attributeValue(<span class="string">&quot;default&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">xPath</span> <span class="operator">=</span> <span class="string">&quot;/configuration/environments/environment[@id=&#x27;&quot;</span>+defaultId+<span class="string">&quot;&#x27;]&quot;</span>;</span><br><span class="line">        <span class="comment">// 获取 environments 中id == environments default 值 environment</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">environment</span> <span class="operator">=</span> (Element) document.selectSingleNode(xPath);</span><br><span class="line">        System.out.println(<span class="string">&quot;environment id = &quot;</span> + environment.attributeValue(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取事务类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">transactionType</span> <span class="operator">=</span> environment.element(<span class="string">&quot;transactionManager&quot;</span>).attributeValue(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;transactionType = &quot;</span> + transactionType);</span><br><span class="line">        <span class="comment">// 获取 dataSource</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">dataSource</span> <span class="operator">=</span> environment.element(<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">dataSourceType</span> <span class="operator">=</span> dataSource.attributeValue(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;dataSourceType = &quot;</span> + dataSourceType);</span><br><span class="line">        <span class="comment">// 获取所有 property</span></span><br><span class="line">        List&lt;Element&gt; properties = dataSource.elements(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        properties.forEach(property -&gt; &#123;</span><br><span class="line">            System.out.println(property.attributeValue(<span class="string">&quot;name&quot;</span>)+<span class="string">&quot;-&quot;</span>+property.attributeValue(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 获取所有 mapper</span></span><br><span class="line">        List&lt;Node&gt; nodes = document.selectNodes(<span class="string">&quot;//mapper&quot;</span>);</span><br><span class="line">        nodes.forEach(node -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> ((Element) node).attributeValue(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;resource = &quot;</span> + resource);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取某节点所有元素 某节点元素.elements();</span></span><br><span class="line">        <span class="comment">// 获取元素中的文本  element.getTextTrim();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="javassist"><a href="#javassist" class="headerlink" title="javassist"></a>javassist</h3><blockquote><p>可以在内存中生成类，接口，添加方法。。。</p><p>Dao 层的接口实现类 代码非常固定，简单。可以使用 javassist 生成实现类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 获取类池，用来生成class</span></span><br><span class="line"><span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"><span class="comment">// 制造类，传入类名</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;com.javassist.Test.Math&quot;</span>);</span><br><span class="line"><span class="comment">// 制造方法</span></span><br><span class="line"><span class="type">String</span> <span class="variable">methodCode</span> <span class="operator">=</span> <span class="string">&quot;public void insert() &#123;System.out.print(111);&#125;&quot;</span>;</span><br><span class="line"><span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtMethod.make(methodCode, ctClass);</span><br><span class="line"><span class="comment">// 将方法加入到类</span></span><br><span class="line">ctClass.addMethod(ctMethod);</span><br><span class="line"><span class="comment">// 内存中生产 class, 返回类加载</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">classMath</span> <span class="operator">=</span> ctClass.toClass();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类加载</span></span><br><span class="line"><span class="comment">// Class classMath = Class.forName(&quot;com.javassist.Test.Math&quot;);</span></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">cm</span> <span class="operator">=</span> classMath.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">md</span> <span class="operator">=</span> classMath.getDeclaredMethod(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line">md.invoke(cm,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><p>为 接口 Delete 添加 实现类 DeleteImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类池</span></span><br><span class="line"><span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"><span class="comment">// 制造类</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.makeClass(<span class="string">&quot;com.javassist.impl,DeleteImpl&quot;</span>);</span><br><span class="line"><span class="comment">// 制造接口</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">anInterface</span> <span class="operator">=</span> classPool.makeInterface(<span class="string">&quot;com.javassist.Delete&quot;</span>);</span><br><span class="line"><span class="comment">// 添加接口到类  DeleteImpl implements Delete</span></span><br><span class="line">ctClass.addInterface(anInterface);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现方法</span></span><br><span class="line"><span class="comment">// 制造方法</span></span><br><span class="line"><span class="type">CtMethod</span> <span class="variable">method</span> <span class="operator">=</span> CtMethod.make(<span class="string">&quot;public void delete()&#123;System.out.println(\&quot;delete\&quot;);&#125;&quot;</span>,ctClass);</span><br><span class="line"><span class="comment">// 将方法添加到类</span></span><br><span class="line">ctClass.addMethod(method);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在内存中生成类，加载到JVM</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">classzz</span> <span class="operator">=</span> ctClass.toClass();</span><br><span class="line"><span class="type">Delete</span> <span class="variable">deleteDao</span> <span class="operator">=</span> (Delete)classzz.newInstance();</span><br><span class="line">deleteDao.delete();</span><br></pre></td></tr></table></figure><p>mybatis 底层使用这个方式帮我们自动生成 DAO 接口的代理类，然后实现这个类的实现类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--要想使用mapper机制，namespace 必须是对应DAO接口的包名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.bank.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  要想使用mapper 机制， 语句id 必须是DAO接口的方法名  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByActno&quot;</span>&gt;</span></span><br><span class="line">        update t_act set balance=#&#123;balance&#125; where actno = #&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByActno&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bank.pojo.Account&quot;</span>&gt;</span></span><br><span class="line">        select * from t_act where actno=#&#123;actno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><blockquote><p>每一个线程都有属于自己的 SqlSession ,改造 SqlSessionUtils</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="comment">// 全局的，服务器级别的，一个服务器当中定义一个即可</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SqlSession&gt; local = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 防止 new 对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SqlSessionUtil</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类加载时，解析mtbatis-config.xml 文件。创建 SqlSessionFactory 对象</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取会话对象, 使用 ThreadLocal   全局唯一</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> local.get();</span><br><span class="line">        <span class="keyword">if</span> (sqlSession == <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            <span class="comment">// 绑定线程，同一线程拿到对象一样</span></span><br><span class="line">            local.set(sqlSession);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭SqlSession 对象，从当前线程移出SqlSession 对象</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(SqlSession sqlSession)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">            <span class="comment">// 移出SqlSession 对象和当前线程的绑定， 因为mysql有线程池</span></span><br><span class="line">            local.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mybatis-小技巧"><a href="#mybatis-小技巧" class="headerlink" title="mybatis 小技巧"></a>mybatis 小技巧</h3><h4 id="，-区别"><a href="#，-区别" class="headerlink" title="#{}，${} 区别"></a>#{}，${} 区别</h4><blockquote><p>#{}：底层使用 PreparedStatement。先编译再给SQL语句？传值。避免SQL注入</p><p>${}：底层使用 Statement。先精选SQL语句拼接，然后再对SQL 语句进行白泥一。存在SQL注入风险</p></blockquote><p>查询排序时会用到 ${}</p><p>分表查询拼接表名查询，如：t_log20201012，前端传日期，后端拼接</p><h4 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h4><ol><li><p>or</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">or</span> id<span class="operator">=</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure></li><li><p>int</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> deleteBatch(String ids);<span class="operator">/</span><span class="operator">/</span> 多id,分割</span><br></pre></td></tr></table></figure></li></ol><h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> brand <span class="keyword">like</span> <span class="string">&#x27;%比亚迪%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、</span><br><span class="line"><span class="string">&#x27;%#&#123;brand&#125;%&#x27;</span></span><br><span class="line"><span class="number">2</span>、concat函数，mysql 数据库中的函数，专门字符拼接</span><br><span class="line">concat(<span class="string">&#x27;%&#x27;</span>,#&#123;brand&#125;, <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line"><span class="number">3</span>、</span><br><span class="line">brand <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>,#&#123;brand&#125;, <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line"><span class="number">4</span>、</span><br><span class="line">&quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br><span class="line"></span><br><span class="line">List<span class="operator">&lt;</span>Car<span class="operator">&gt;</span> selectByBrandLike(Sreing brand);</span><br></pre></td></tr></table></figure><h4 id="别名配置"><a href="#别名配置" class="headerlink" title="别名配置"></a>别名配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    mybatis-config.xml</span></span><br><span class="line"><span class="comment">别名不区分大小写， namespace不能使用别名</span></span><br><span class="line"><span class="comment">type: 指定给哪个类型起别名</span></span><br><span class="line"><span class="comment"> alias：指定别名，省略这个属性，别名就是类的简明</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如：下面这个简明 Car</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    // package可以将此包下所有类自动起别名，默认都是类简名</span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.java.bank&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.java.bank.Car&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;aaa&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">使用</span></span><br><span class="line"><span class="comment">CaeMapper.xml</span></span><br><span class="line"><span class="comment">--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCarType&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Aaa&quot;</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="mapper配置"><a href="#mapper配置" class="headerlink" title="mapper配置"></a>mapper配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 类的根路径下查找资源</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;xxx.xml&quot;</span> /&gt;</span></span><br><span class="line">// 绝对路径</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///xxx.xml&quot;</span> /&gt;</span></span><br><span class="line">// 全限定接口名，必须带有包名。然后从接口名同路径查找,并且和接口名一致 (Transfer.xml)</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.java.bank.Transfer&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">// 将包下所有xml文件自动配置。【xml文件与接口同包下且名字相同】</span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.java.bank.mapper&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置模板文件"><a href="#配置模板文件" class="headerlink" title="配置模板文件"></a>配置模板文件</h4><blockquote><p>去 settings -》 FIle and code Template 新增模板</p><p>alt+insert 新建快捷键</p></blockquote><h4 id="使用自动生成的主键"><a href="#使用自动生成的主键" class="headerlink" title="使用自动生成的主键"></a>使用自动生成的主键</h4><blockquote><p>自动生成一条自增数据，id自增我们就不知道生成的是多少。如果我们要用到id，难道还要再查一次么？</p></blockquote><p>配置生成主键</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// useGeneratedKeys: 开启使用自动生成主键</span><br><span class="line">// keyProperty：将自增主键赋值给 id 属性</span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCarUseGeneratedKeys&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">insert into t_car values(null, #&#123;carNum&#125;, #&#123;brand&#125;, #&#123;guidePrice&#125;, #&#123;produceTime&#125;, #&#123;carType&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p>获取主键值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line"><span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line"><span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="literal">null</span>, <span class="string">&quot;9911&quot;</span>, <span class="string">&quot;凯美瑞&quot;</span>, <span class="number">30.0</span>, <span class="string">&quot;2020-10-10&quot;</span>);</span><br><span class="line">mapper.insertCarUseGenneratedKey(car);</span><br><span class="line"></span><br><span class="line">System.out.println(car);<span class="comment">// 会输出id xxx</span></span><br><span class="line"></span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure><h4 id="mybatis-参数处理"><a href="#mybatis-参数处理" class="headerlink" title="mybatis 参数处理"></a>mybatis 参数处理</h4><h5 id="简单类型参数"><a href="#简单类型参数" class="headerlink" title="简单类型参数"></a>简单类型参数</h5><blockquote><p>7中基本类型＋包装类+String+两种时间类型</p><p>byte,short,int,long,float,double,char</p><p>Byte,Short,Integer,Long,Float,Double,Character</p><p>String</p><p>java,util.Date, java.sql.Date</p></blockquote><p>当接口中方法参数只有一个，并且都是简单类型时。此时mybatis 可以自动推断，不用指定参数类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByName</span><span class="params">(String name)</span>;</span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectByTime</span><span class="params">(Date time)</span>;</span><br><span class="line">    List&lt;Student&gt; <span class="title function_">selectById</span><span class="params">(<span class="type">boolean</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.openSession();</span><br><span class="line"><span class="type">CarMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CarMapper.class);</span><br><span class="line">mapper.selectById(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">parameterType 指定参数类型，可以省略 mybatis可以自动推断。关于类型 mtbatis 内置了很多类型的别名，可以参考中文文档</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">select * from t_student where id= #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 可以这样写，指定参数类型和字段在数据库的类型</span><br><span class="line">id=#&#123;id, javaType=String,jdbcType=VARCHAR&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="参数是-Map-类型"><a href="#参数是-Map-类型" class="headerlink" title="参数是 Map 类型"></a>参数是 Map 类型</h5><blockquote><p>mybatis 也能自动类型推断</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list&lt;Map&gt; <span class="title function_">insertStudentByMap</span><span class="params">(Map map)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Map&lt;Stirng&gt; map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.add(<span class="string">&quot;xx&quot;</span>);</span><br><span class="line">mapper.insertStudentByMap(map);</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudentByMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> &gt;</span></span><br><span class="line">insert into t_student(id, name,age,sex,birth,height) values(null,#&#123;&#125;,#&#123;&#125;,#&#123;&#125;,#&#123;&#125;,#&#123;&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="参数是实体"><a href="#参数是实体" class="headerlink" title="参数是实体"></a>参数是实体</h5><blockquote><p>参数是一个 pojo 实体类,此时mybatis 也可以自动类型推断</p></blockquote><h4 id="参数之多参数"><a href="#参数之多参数" class="headerlink" title="参数之多参数"></a>参数之多参数</h4><blockquote><p>mybatis 会创建一个数组把多个参数放进去</p><p>map.put(“arg0”, name);</p><p>map.put(“arg1”, sex);</p><p>map.put(“arg2”, xxx);</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectByNameAndSex</span><span class="params">(String name, Chaecter sex)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultTpet</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    // param1,param2也行，低版本可能使用的是 #&#123;0&#125;#&#123;1&#125;</span><br><span class="line">select * from t_student where name=#&#123;arg0&#125; and sex=#&#123;arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="参数之-params-注解"><a href="#参数之-params-注解" class="headerlink" title="参数之 @params 注解"></a>参数之 @params 注解</h4><blockquote><p>底层实现</p><p>map.put(“name”, “xxx”);</p><p>map.put(“sex”, “男”)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; <span class="title function_">selectByNameAndSex</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;sex&quot;)</span> Chaecter sex)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNameAndSex&quot;</span> <span class="attr">resultTpet</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">     // param1,param2也行</span><br><span class="line">select * from t_student where name=#&#123;name&#125; and sex=#&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Mybatis-查询专题"><a href="#Mybatis-查询专题" class="headerlink" title="Mybatis 查询专题"></a>Mybatis 查询专题</h3><h4 id="返回Car"><a href="#返回Car" class="headerlink" title="返回Car"></a>返回Car</h4><blockquote><p>查询返回pojo实体 Car。 模糊查询返回必须采用List 集合接收，因为可能返回多个结果。 如果单个查询用List 集合接收，这样是可以的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Car <span class="title function_">selectById</span><span class="params">(String id)</span>;</span><br><span class="line">List&lt;Car&gt;selectAll();</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 数据库的下划线命名与pojo类的小驼峰命名冲突可能返回null 值</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">select * from t_car where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="返回Map"><a href="#返回Map" class="headerlink" title="返回Map"></a>返回Map</h4><blockquote><p>返回map, key 是表字段名，值是对应属性值</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个map</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">selectByIdRetMap</span><span class="params">(Long id)</span>;</span><br><span class="line"><span class="comment">// 返回多个map</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectByIdRetListMap</span><span class="params">(Long id)</span>;</span><br><span class="line"><span class="comment">// 返回map套map,大map键是小map的key</span></span><br><span class="line">Map&lt;Long,Map&lt;String, Object&gt;&gt; <span class="title function_">selectByIdRetBigMap</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">select * from t_car where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 这个resultType还是map</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetListMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdRetBigMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="结果映射"><a href="#结果映射" class="headerlink" title="结果映射"></a>结果映射</h4><blockquote><p>当数据库的下划线命名与pojo类的小驼峰命名冲突可能返回null 值的情况，</p><p>普通就是在查询是添加别名，当时字段多时比较麻烦</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; <span class="title function_">selectAllByResultMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">专门定义一个结果映射指定数据库中字段名对应java pojo类的属性名对应关系</span></span><br><span class="line"><span class="comment">type: 用来指定pojo类类名</span></span><br><span class="line"><span class="comment">id: 指定resultMap的唯一标识。在select标签carResultMap中使用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;carResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;car&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">// 如果有主键用此标签配置，可以提高mybatis执行效率</span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">// property pojo类中字段名</span><br><span class="line">// column 数据库字段名</span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">     // 如果两个属性值相同可以省略</span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;carType&quot;</span> <span class="attr">column</span>=<span class="string">&quot;car_type&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllByResultMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;carResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="开启驼峰命名自动映射"><a href="#开启驼峰命名自动映射" class="headerlink" title="开启驼峰命名自动映射"></a><strong>开启驼峰命名自动映射</strong></h4><blockquote><p>java命名：小驼峰   eg: myMethodPost</p><p>mysql命名：将小驼峰改为 下划线：my_method_post</p></blockquote><p>mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUndersourceToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="返回总记录条数"><a href="#返回总记录条数" class="headerlink" title="返回总记录条数"></a>返回总记录条数</h4><blockquote><p>查询所有，但是要返回总记录条数</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTotal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">select count(*) from t_car</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h3><blockquote><p>需要拼接sql  如批量删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> id 数组是动态的</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_car <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3.</span>..)</span><br></pre></td></tr></table></figure></blockquote><h4 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Car&gt; <span class="title function_">selectByMultiCondition</span> <span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;brand&quot;)</span> String brand, </span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;guidePrice&quot;)</span> Double guidePrice, </span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;carType&quot;)</span> String carType</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- test 属性是必须的， true拼接，false不拼接</span></span><br><span class="line"><span class="comment">不能使用 &amp;&amp; 使用 and </span></span><br><span class="line"><span class="comment">加上 1=1 为了防止where 后边没有东西sql报错</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    select * from t_car where 1=1</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand !=&#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">        and brand like &quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">    and guide_price like &quot;%&quot;#&#123;guidePrice&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">        and car_type like &quot;%&quot;#&#123;carType&#125;&quot;%&quot;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="where-标签"><a href="#where-标签" class="headerlink" title="where 标签"></a>where 标签</h4><blockquote><p>where标签的作用: 让where子句更加动态智能所有条件都为空时，where标签保证不会生成where子句.<strong>自动去除某些条件前面多余的and或or</strong>。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    select * from t_car</span><br><span class="line">    <span class="comment">&lt;!-- 专门负责where子语句动态生成--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand !=&#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            brand like &quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            and guide_price like &quot;%&quot;#&#123;guidePrice&#125;&quot;%&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            and car_type like &quot;%&quot;#&#123;carType&#125;&quot;%&quot;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="trim标签"><a href="#trim标签" class="headerlink" title="trim标签"></a>trim标签</h4><blockquote><p>trim标签的属性</p><ul><li>prefix:在trim标签中的语句前添加前缀</li><li>suffix: 在trim标签中的语句后添加后缀</li><li>prefixOverrides: 去掉前缀</li><li>suffixOverrides: 去掉后缀</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByMultiCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Car&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    select * from t_car</span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">prefix=&quot;where&quot;：所有子语句加前缀 where</span></span><br><span class="line"><span class="comment">    suffixOverrides=&quot;and|or&quot;：所有子语句去掉后缀 and / or</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand !=&#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            brand like &quot;%&quot;#&#123;brand&#125;&quot;%&quot; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            guide_price = #&#123;guidePrice&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            car_type = #&#123;carType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="set-标签"><a href="#set-标签" class="headerlink" title="set 标签"></a>set 标签</h4><blockquote><p><strong>主要使用在update语句当中</strong>，用来生成set关键字，同时去掉最后多余的 “,” 比如我们只更新提交的不为空的字段，如果提交的数据是空或者 null，那么这个字段我们将不更新。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;updateid=&quot;updateWithSet&quot;</span><br><span class="line">    update t car</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carlum != null and carNum != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            car num = #&#123;carlum&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand != null and brand != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            brand = #&#123;fbrand&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;guidePrice != null and guidePrice != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            guide_price = #&#123;guidePrice&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;produceTime != null and produceTime != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            produce_time = #&#123;produceTimel&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;carType != null and carType != &#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            car_type = #&#123;fcarTypel&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose when otherwise"></a>choose when otherwise</h4><blockquote><p>三个标签通常一起使用，相当于if else, 只要有一个条件成立，就结束</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">select * from t_car</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        // 只会选择一个分支</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;brand !=null and brand!=&#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            brand like &quot;%&quot;#&#123;brand&#125;&quot;%&quot;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;carType !=null and carType!=&#x27; &#x27;&quot;</span>&gt;</span></span><br><span class="line">            car_type like &quot;%&quot;#&#123;carType&#125;&quot;%&quot;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            produce_time = #&#123;produceTimel&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="批量删除-1"><a href="#批量删除-1" class="headerlink" title="批量删除"></a>批量删除</h4><blockquote><p>使用 foreach 标签 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String[] ids)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1</span></span><br><span class="line"><span class="comment">collection: 指定数组/集合</span></span><br><span class="line"><span class="comment">item: 数组活集合中的元素</span></span><br><span class="line"><span class="comment">separator: 循环之间的分隔符</span></span><br><span class="line"><span class="comment">直接使用 ids 会报错，提示可以使用 array/arg, 配置@Params可以使用别名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">delete from t_car where id in(</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">    #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--2--&gt;</span></span><br><span class="line">    delete from t_car where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span></span></span><br><span class="line"><span class="tag">        #&#123;<span class="attr">id</span>&#125;</span></span><br><span class="line"><span class="tag">    &lt;/<span class="attr">foreach</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--3--&gt;</span></span><br><span class="line">    delete from t_car where id</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">#&#123;id&#125;</span></span></span><br><span class="line"><span class="tag">    &lt;/<span class="attr">foreach</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">insertBatch</span><span class="params">(<span class="meta">@Param(&quot;cars&quot;)</span> List&lt;Car&gt; cars)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span>&gt;</span></span><br><span class="line">insert into t_car(&quot;id&quot;, &quot;brand&quot;, &quot;product_price&quot;) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;cars&quot;</span> <span class="attr">item</span>=<span class="string">&quot;car&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">        (null, #&#123;car.brand&#125;, #&#123;car.productPrice&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="sql标签，include标签"><a href="#sql标签，include标签" class="headerlink" title="sql标签，include标签"></a>sql标签，include标签</h4><blockquote><p>sql标签用来声明sql片段，include标签用来将声明的sql片段包含到某个sql语句中</p><p>提高代码复用性</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;yy&quot;</span> &gt;</span></span><br><span class="line">brand,productPrice</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;xx&quot;</span>&gt;</span></span><br><span class="line">select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;yy&quot;</span>&gt;</span> from t_car where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="数据库高级映射"><a href="#数据库高级映射" class="headerlink" title="数据库高级映射"></a>数据库高级映射</h3><h4 id="多对一映射"><a href="#多对一映射" class="headerlink" title="多对一映射"></a>多对一映射</h4><p>t_stu</p><table><thead><tr><th>sid</th><th>sname</th><th>cid</th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>1000</td></tr><tr><td>2</td><td>李四</td><td>1000</td></tr><tr><td>3</td><td>王五</td><td>1001</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer sid;</span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">    <span class="keyword">private</span> Clazz clazz</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>t_class</p><table><thead><tr><th>cid</th><th>cname</th></tr></thead><tbody><tr><td>1000</td><td>高三一班</td></tr><tr><td>1001</td><td>高三二班</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">查询学生带出对应的班级信息</span></span><br><span class="line"><span class="comment">1、一条SQL，级联属性映射</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;stuRsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;clazz.cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;stuRsMap&quot;</span>&gt;</span></span><br><span class="line">select s.sid, s.sname, c.cid, c.cname</span><br><span class="line">    from t_stu</span><br><span class="line">    left join t_clazz c</span><br><span class="line">    on s.cid = c.cid</span><br><span class="line">    where s.sid = #&#123;sid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">查询学生带出对应的班级信息</span></span><br><span class="line"><span class="comment">2、一条SQL，association</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;stuAssociationRsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line">    // sname同名省略</span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">association:关联，一个student对象关联一个Clazz最小</span></span><br><span class="line"><span class="comment">property： 提供要映射的POJO类</span></span><br><span class="line"><span class="comment">javaType: 用来指定要映射的java类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;claszz&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;stuAssociationRsMap&quot;</span>&gt;</span></span><br><span class="line">select s.sid, s.sname, c.cid, c.cname</span><br><span class="line">    from t_stu</span><br><span class="line">    left join t_clazz c</span><br><span class="line">    on s.cid = c.cid</span><br><span class="line">    where s.sid = #&#123;sid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">查询学生带出对应的班级信息</span></span><br><span class="line"><span class="comment">3、两条SQL，多对一分布查询（可复用，支持懒加载）</span></span><br><span class="line"><span class="comment">开启懒加载：fetchType=&quot;lazy&quot;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;stuStepRsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;claszz&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Clazz&quot;</span> <span class="attr">select</span>=<span class="string">&quot;xxx.selectStep2&quot;</span> <span class="attr">clumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStepById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;stuStepRsMap&quot;</span>&gt;</span></span><br><span class="line">select sid,sname,cid from t_stu where sid=#&#123;sid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 另一个xml文件中的 查询方法</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStep2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="启用全局懒加载"><a href="#启用全局懒加载" class="headerlink" title="启用全局懒加载"></a>启用全局懒加载</h4><blockquote><p>信息</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h4><blockquote><p>一对多，一在前，一是主表，多是副表</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; stus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">查询班级带出对应的学生信息</span></span><br><span class="line"><span class="comment">1、</span></span><br><span class="line"><span class="comment">collection </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;clazzRsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Clazz&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">ofType: 指定集合当中的元素类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCollection&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">select c.id,c.name,s.sid,s.sname </span><br><span class="line">    from t_clazz</span><br><span class="line">    left join t_stu s</span><br><span class="line">    on c.cid = s.cid</span><br><span class="line">    where c.cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">查询班级带出对应的学生信息</span></span><br><span class="line"><span class="comment">2、</span></span><br><span class="line"><span class="comment">分布查询</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;stuStepRsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;stus&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">select</span>=<span class="string">&quot;selectStep2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStepById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;stuStepRsMap&quot;</span>&gt;</span></span><br><span class="line">select cname,cid from t_clazz where cid=#&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 另一个xml文件中的 查询方法</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStep2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    select * from t_stu where cid=#&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mybatis-缓存"><a href="#mybatis-缓存" class="headerlink" title="mybatis 缓存"></a>mybatis 缓存</h3><blockquote><p>执行SQL 查询的时候，将查询结果放到缓存中。如果下次还是执行完全相同的sql语句。直接从缓存拿，不从硬盘找数据</p></blockquote><p>mybatis 缓存包括</p><ol><li><p>一级缓存：将查询数据存到SqlSession 对象 , 针对当前会话，默认开启</p><p> 只要两次调用相同sql查询。</p><p> <strong>啥时候以及缓存失败？</strong></p><p> 第一次DQL和第二次DQL之间做了下面任意一件事，都会清空一级缓存</p><ul><li>执行　sqlSession,cleanChache()</li><li>执行 insert,delete,update 任意一个语句</li></ul></li><li><p>二级缓存: 将查询数据存到SqlSessionFactory  针对所有会话</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//1、 默认就是 true 无需全局配置</span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;chachceEnable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">//2、 使用二级缓存的mapper.xml文件需局部配置 <span class="tag">&lt;<span class="name">cache</span> /&gt;</span></span><br><span class="line">//3、 使用二级缓存的实体类必须是可序列化，既必须实现 java.io.Serializable</span><br><span class="line">//4、 Sqlsession 对象关闭或提交后，一级缓存数据在会被写到二级缓存</span><br></pre></td></tr></table></figure></li><li><p>第三方缓存，三级缓存：三级缓存是用来代替mybatis 自带的二级缓存</p><p> 常见：EhCache,Memcache</p></li></ol><h3 id="myBatis-逆向工程"><a href="#myBatis-逆向工程" class="headerlink" title="myBatis 逆向工程"></a>myBatis 逆向工程</h3><blockquote><p>所谓的逆向工程是: <strong>根据数据库表</strong>逆向生成<strong>Java的pojo类</strong>，<strong>SalMapperxml文件</strong>，以及<strong>Mapper接口类</strong>等.</p><p>要完成这个工作，需要借助别人写好的逆向工程插件。</p><p>思考:使用这个插件的话，需要给这个插件配置哪些信息?</p><ul><li>·pojo类名、包名以及生成位置.</li><li>SglMapper.xml文件名以及生成位置<br>  ·</li><li>Mapper接口名以及生成位置。</li><li>连接数据库的信息。</li><li>指定哪些表参与逆向工程</li></ul></blockquote><p>新建一个maven项目</p><p>修改 pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--定制构建过程--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可配置多个插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--其中的一个插件: mybatis逆向工程插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--插件的GAV坐标--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--允许覆盖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--插件的依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--mysgl驱动依赖--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysgl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>新增 generatorConfig.xml，放在类的根路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0” encoding=&quot;</span>UTF-8<span class="string">&quot;?&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span></span><br><span class="line"><span class="string"><span class="meta">PUBLIC&quot;</span>-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">&quot;</span>http://mybatis.org/dtd/mybatis-generator-config 1 0.dtd<span class="string">&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;generatorConfiguration&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;!--</span></span></span><br><span class="line"><span class="string"><span class="meta">    targetRuntime有两个值 :</span></span></span><br><span class="line"><span class="string"><span class="meta">    MyBatis3simple:生成的是基础版，只有基本的增删改查。</span></span></span><br><span class="line"><span class="string"><span class="meta">    MyBatis3: 生成的是增强版，除了基本的增删改查之外还有复杂的增删改查。</span></span></span><br><span class="line"><span class="string"><span class="meta">--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">    &lt;context id=&quot;</span>DB2Tables<span class="string">&quot; targetRuntime=&quot;</span>MyBatis3<span class="string">&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;!--防止生成重复代码--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;plugin type=&quot;</span>org.mybatis.generator.plugins.UnmergeableXmlMappersPlugin<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;commentGenerator&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;!--是否去掉生成日期--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;property name=&quot;</span>suppressDate<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;!--是否去除注释--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;property name=&quot;</span>suppressAl1Comments<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;/commentGenerator&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;!--连接数据库信息--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;jdbcConnection </span></span></span><br><span class="line"><span class="string"><span class="meta">            driverclass=&quot;</span>com.mysql.cj.jdbc.Driver<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">            connectionURL=&quot;</span>jdbc:mysql://Tocathost:3306/powernode<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">             userId=&quot;</span>root<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">             password=&quot;</span>root<span class="string">&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;/jdbcConnection&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">    &lt;!-- 生成pojo包名和位置 --&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">         &lt;javaModelGenerator </span></span></span><br><span class="line"><span class="string"><span class="meta">              targetPackage=&quot;</span>com.powernode.mybatis.pojo<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">              targetProject=&quot;</span>src/main/java<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;!--是否开启子包--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;property name=&quot;</span>enableSubPackages<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;!--是否去除字段名的前后空白--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">            &lt;property name=&quot;</span>trimStrings<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;/javaModelGenerator&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">          &lt;!-- 生成SQL映射文件的包名和位置 --&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">          &lt;sqlMapGenerator </span></span></span><br><span class="line"><span class="string"><span class="meta">              targetPackage=&quot;</span>com.powernode.mybatis.mappen<span class="string">&quot; </span></span></span><br><span class="line"><span class="string"><span class="meta">              targetProject=&quot;</span>src/main/resources<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">           &gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">               &lt;!--是否开启子包--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">               &lt;property name=&quot;</span>enableSubPackages<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">           &lt;/sqlMapGenerator&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;!-- 生成Mapper接口的包名和位置--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;javaClientGenerator</span></span></span><br><span class="line"><span class="string"><span class="meta">            type=&quot;</span>xmIMapper<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">            targetPackage=&quot;</span>com.powernode.mybatis .mapper<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">            targetProject=&quot;</span>src/main/java<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;property name=&quot;</span>enableSubPackages<span class="string">&quot; value=&quot;</span>true<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;/javaClientGenerator&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">        &lt;!-- 表名和对应的实体类名--&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">         &lt;table tableName=&quot;</span>t_car<span class="string">&quot; domainObjectName=&quot;</span>Car<span class="string">&quot;/&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta">    &lt;/context&gt;</span></span></span><br><span class="line"><span class="string"><span class="meta"></span></span></span><br><span class="line"><span class="string"><span class="meta">&lt;/generatorConfiguration&gt;</span></span></span><br></pre></td></tr></table></figure><p>从maven找到插件 mybatis-generator,展开。 双击mybatis-generator:generate</p><h3 id="PAgeHelper-分页插件"><a href="#PAgeHelper-分页插件" class="headerlink" title="PAgeHelper 分页插件"></a>PAgeHelper 分页插件</h3><h4 id="limit-分页"><a href="#limit-分页" class="headerlink" title="limit 分页"></a>limit 分页</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">起始位置(从0开始),每页条数</span></span><br><span class="line"><span class="comment">1页n 页</span></span><br><span class="line"><span class="comment">startIndex 0(n-1)*page</span></span><br><span class="line"><span class="comment">page 10page</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> defect_alarm LIMIT <span class="number">0</span>,<span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="使用-pageHelper"><a href="#使用-pageHelper" class="headerlink" title="使用 pageHelper"></a>使用 pageHelper</h4><blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>mybatis-conf.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">intercepetor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="注解是开发"><a href="#注解是开发" class="headerlink" title="注解是开发"></a>注解是开发</h3><blockquote><p>可以不用写 mapper.xml 文件了。但只是针对简单的语句</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into t_car values(null, #&#123;carNum&#125;,#&#123;brand&#125;)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertCar</span><span class="params">(Car car)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;delete from t_car where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;update t_car set car_num=#&#123;carNum&#125;,brand=#&#123;brand&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span> <span class="params">(Car car)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没有配置小驼峰匹配时，可以这样加映射</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from t_car where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@results(&#123;</span></span><br><span class="line"><span class="meta">    @Result(property=&quot;&quot;, column=&quot;&quot;),</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line">Car <span class="title function_">selectById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ORM&quot;&gt;&lt;a href=&quot;#ORM&quot; class=&quot;headerlink&quot; title=&quot;ORM&quot;&gt;&lt;/a&gt;ORM&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;O (Object) jvm中的对象&lt;/p&gt;
&lt;p&gt;R (Relational) 关系型数据库&lt;/p&gt;
&lt;p&gt;M (Mapping) 映射&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230214134743208.png&quot; alt=&quot;image-20230214134743208&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;支持定制化 SQL、存储过程、基本映射以及高级映射&lt;/li&gt;
&lt;li&gt;避免了几乎所有的JDBC代码中手动设置参数以及获取结果集&lt;/li&gt;
&lt;li&gt;支持XML开发，也支持注解式开发。[为了保证sql语句的灵活，所以mybatis大部分是采用XML方式开发。]&lt;/li&gt;
&lt;li&gt;将接口和Java 的 POJOs(Plain rdinary Java Object，简单普通的Java对象)映射成数据库中的记录体积小好学: &lt;/li&gt;
&lt;li&gt;两个jar包，两个XML配置文件。&lt;/li&gt;
&lt;li&gt;完全做到sal解耦合&lt;/li&gt;
&lt;li&gt;提供了基本映射标签&lt;/li&gt;
&lt;li&gt;提供了高级映射标签&lt;/li&gt;
&lt;li&gt;提供了XML标签，支持动态SQL的编写&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="mybatis 基础" scheme="https://wyf195075595.github.io/tags/mybatis-%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>jdbc基础</title>
    <link href="https://wyf195075595.github.io/2023/02/10/programming/java/jdbc/"/>
    <id>https://wyf195075595.github.io/2023/02/10/programming/java/jdbc/</id>
    <published>2023-02-10T13:00:00.000Z</published>
    <updated>2023-02-17T08:35:05.840Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>JDBC 是SUN公司制定的一套接口</p></blockquote><h3 id="JDBC-准备工作，加载jar-驱动包，然后配置到环境变量-classpath-当中"><a href="#JDBC-准备工作，加载jar-驱动包，然后配置到环境变量-classpath-当中" class="headerlink" title="JDBC 准备工作，加载jar 驱动包，然后配置到环境变量 classpath 当中"></a>JDBC 准备工作，加载jar 驱动包，然后配置到环境变量 classpath 当中</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classpath=.;xxx/mysql-connector-java-<span class="number">5.1</span><span class="number">.23</span>-bin.jar</span><br></pre></td></tr></table></figure><blockquote><p>其中配置了两个路径，一个是当前路径，一个是mysql驱动架包路径。这里的配置在集成工具中不需要配</p></blockquote><h3 id="jdbc-编程6步"><a href="#jdbc-编程6步" class="headerlink" title="jdbc 编程6步"></a>jdbc 编程6步</h3><ol><li><p>注册驱动　（连接哪个数据库）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.jdbc.Driver();</span><br><span class="line">DriverManager.registerDriver(driver);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二, 应为参数是字符串可以提出配置，类加载时自动执行静态代码 自动注册</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>)</span><br></pre></td></tr></table></figure></li><li><p>获取连接　（JVM进程与数据库连接，重量级通信）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">coon</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pwd);</span><br><span class="line">System.out.println(<span class="string">&quot;数据库连接对象&quot;</span> + coon);</span><br></pre></td></tr></table></figure></li><li><p>获取数据库操作对象（专门执行SQL）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> coon.createStatement();</span><br></pre></td></tr></table></figure></li><li><p>执行SQL语句</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete * from tb_emp&quot;</span>;</span><br><span class="line">        <span class="comment">// executeUpdate 专门执行DML语句（insert、delete、update）,返回影响数据库中记录的条数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure></li><li><p>处理查询结果集</p></li><li><p>释放资源（关闭连接）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从小到大关闭</span></span><br><span class="line">stmt.close();</span><br><span class="line">coon.close();</span><br></pre></td></tr></table></figure></li></ol><span id="more"></span><h3 id="使用资源绑定器绑定属性配置文件"><a href="#使用资源绑定器绑定属性配置文件" class="headerlink" title="使用资源绑定器绑定属性配置文件"></a>使用资源绑定器绑定属性配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;jdbc&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">db</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;db&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">Class.forName(db);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">coon</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pwd);</span><br><span class="line"><span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> coon.createStatement();</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from defect_alarm&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">list</span> <span class="operator">=</span>  stmt.executeQuery(sql);</span><br><span class="line">      <span class="keyword">while</span> (list.next()) &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> list.getString(<span class="string">&quot;occurrence_time&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">alarmName</span> <span class="operator">=</span> list.getString(<span class="string">&quot;alarm_name&quot;</span>);</span><br><span class="line">        System.out.println(time+<span class="string">&quot;-&quot;</span>+alarmName);</span><br><span class="line">    &#125;</span><br><span class="line">stmt.close();</span><br><span class="line">coon.close();</span><br></pre></td></tr></table></figure><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><blockquote><p>例如：用户登录功能</p></blockquote><p>登录的 sql 语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> loginName <span class="operator">=</span> #&#123;username&#125; <span class="keyword">and</span> password <span class="operator">=</span> #&#123;password&#125;</span><br></pre></td></tr></table></figure><p>sql 注入： 知道用户名 zs，但不知道密码。输入 用户名: zs</p><p>输入密码： zs’ or ‘1’ =’1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> loginName <span class="operator">=</span> <span class="string">&#x27;zs&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;zs&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="解决-sql-注入"><a href="#解决-sql-注入" class="headerlink" title="解决 sql 注入"></a>解决 sql 注入</h3><blockquote><p>只要是用户提供的信息不参与SQL语句的编译过程，问题就解决了。那么就必须使用 java.sql.Preparedstatement</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;jdbc&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">db</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;db&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">Class.forName(db);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">coon</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pwd);</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from defect_alarm where username=? and pwd=?&quot;</span>;</span><br><span class="line"><span class="comment">// 预编译的数据库操作对象</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> coon.prepareStatement(sql);</span><br><span class="line"><span class="comment">// 传值</span></span><br><span class="line">ps.setString(<span class="number">1</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">ps.setString(<span class="number">2</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">list</span> <span class="operator">=</span>  ps.executeQuery();</span><br><span class="line"><span class="keyword">while</span> (list.next()) &#123;</span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br><span class="line">stmt.close();</span><br><span class="line">coon.close();</span><br></pre></td></tr></table></figure><blockquote><p>Preparedstatement 与 Statement 区别？</p><p>Statement  编译一个执行一次，只有在业务要求需要用到SQL注入时才用，例如列表升序降序，需要注入 desc asc 关键字（关键字不能用引号包裹）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 不行</span><br><span class="line">String <span class="keyword">sql</span> <span class="operator">=</span> &quot;select ename from emp order by ename=?&quot;;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 可以</span><br><span class="line">String <span class="keyword">sql</span> <span class="operator">=</span> &quot;select ename from emp order by ename&quot; <span class="operator">+</span> keyword;</span><br></pre></td></tr></table></figure><p>Preparedstatement 编译一次可执行N次，编译阶段进行类型检查，效率高于Statement  </p></blockquote><h3 id="jdbc-事务"><a href="#jdbc-事务" class="headerlink" title="jdbc 事务"></a>jdbc 事务</h3><blockquote><p>多个操作数据库动作，要么全部成功，要么全部失败</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(db);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">coon</span> <span class="operator">=</span> DriverManager.getConnection(url, user, pwd);</span><br><span class="line"><span class="comment">// 关闭事件自动提交</span></span><br><span class="line">coon.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 程序正常，提交事务</span></span><br><span class="line">coon.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    <span class="comment">// 程序出错，事务回滚</span></span><br><span class="line">    coon.rollback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h4><blockquote><p>（悲观锁）：当我们查询某些数据时，为了得到真实数据，不允许其他线程对这些数据进项操作，可以加上行级锁</p><p>（乐观锁）：支持并发，事务也不需要排队，只不过需要一个版本号。如果在操作过程中有其他线程修改我访问的数据，那么我提交事务时会发现版本号根之前的不一样的，于是我回滚操作</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 此时这条 id<span class="operator">=</span><span class="number">111</span> 的数据，被锁定</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id<span class="operator">=</span><span class="number">111</span> <span class="keyword">for</span> <span class="keyword">update</span> </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;JDBC 是SUN公司制定的一套接口&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;JDBC-准备工作，加载jar-驱动包，然后配置到环境变量-classpath-当中&quot;&gt;&lt;a href=&quot;#JDBC-准备工作，加载jar-驱动包，然后配置到环境变量-classpath-当中&quot; class=&quot;headerlink&quot; title=&quot;JDBC 准备工作，加载jar 驱动包，然后配置到环境变量 classpath 当中&quot;&gt;&lt;/a&gt;JDBC 准备工作，加载jar 驱动包，然后配置到环境变量 classpath 当中&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;classpath=.;xxx/mysql-connector-java-&lt;span class=&quot;number&quot;&gt;5.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.23&lt;/span&gt;-bin.jar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;blockquote&gt;
&lt;p&gt;其中配置了两个路径，一个是当前路径，一个是mysql驱动架包路径。这里的配置在集成工具中不需要配&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;jdbc-编程6步&quot;&gt;&lt;a href=&quot;#jdbc-编程6步&quot; class=&quot;headerlink&quot; title=&quot;jdbc 编程6步&quot;&gt;&lt;/a&gt;jdbc 编程6步&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;注册驱动　（连接哪个数据库）&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Driver&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;driver&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;com&lt;/span&gt;.mysql.jdbc.Driver();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DriverManager.registerDriver(driver);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 方式二, 应为参数是字符串可以提出配置，类加载时自动执行静态代码 自动注册&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Class.forName(&lt;span class=&quot;string&quot;&gt;&amp;quot;com.mysql.jdbc.Driver&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;li&gt;&lt;p&gt;获取连接　（JVM进程与数据库连接，重量级通信）&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;pwd&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Connection&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;coon&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; DriverManager.getConnection(url, user, pwd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;数据库连接对象&amp;quot;&lt;/span&gt; + coon);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;li&gt;&lt;p&gt;获取数据库操作对象（专门执行SQL）&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;Statement&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; coon.createStatement();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;li&gt;&lt;p&gt;执行SQL语句&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;sql&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;delete * from tb_emp&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// executeUpdate 专门执行DML语句（insert、delete、update）,返回影响数据库中记录的条数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; stmt.executeUpdate(sql);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;li&gt;&lt;p&gt;处理查询结果集&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;释放资源（关闭连接）&lt;/p&gt;
 &lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 从小到大关闭&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;stmt.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;coon.close();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="jdbc基础" scheme="https://wyf195075595.github.io/tags/jdbc%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>jdbcweb基础</title>
    <link href="https://wyf195075595.github.io/2023/02/10/programming/java/javaweb/"/>
    <id>https://wyf195075595.github.io/2023/02/10/programming/java/javaweb/</id>
    <published>2023-02-10T05:00:00.000Z</published>
    <updated>2023-02-17T08:34:52.766Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>servlet 是JavaEE 规范之一。</p><p>javaEE 目前最高版本时javaEE8,它被Oracle捐献给Apache。之后被改名为 Jakarta EE。从此没有javaEE 了</p><p>javaEE8中的Servlet类名：javax.servlet.Servlet</p><p>javaEE9中的Servlet类名：jakarta.servlet.Servlet</p></blockquote><h3 id="关于系统架构"><a href="#关于系统架构" class="headerlink" title="关于系统架构"></a>关于系统架构</h3><ol><li><p>系统架构包括</p><ul><li><p>C/S 架构</p><p>  就是需要安装的软件</p></li><li><p>B/S 架构</p><p>  就是运行在浏览器的页面</p></li></ul></li></ol><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><blockquote><p>开源免费的轻量级ＷＥＢ服务器</p></blockquote><h4 id="tomcat-目录"><a href="#tomcat-目录" class="headerlink" title="tomcat 目录"></a>tomcat 目录</h4><ul><li>bin：存放命令文件<ul><li>.bat 文件，批量执行windows DOS命令</li><li>.sh 文件，批量执行 Linux 命令</li><li></li></ul></li><li>conf：配置文件</li><li>lib：tomcat核心程序目录</li><li>logs：日志目录</li><li>temp：临时目录</li><li>webapps：存放web应用</li><li>work：存放jsp文件翻译之后的Java文件以及编译之后的class文件</li></ul><p>配置tomcat环境</p><ol><li>CATALINA_HOME=D:\tomcat\apache-tomcat-10.0.27</li><li>JAVA＿HOME=C:\Program Files\Java\jdk1.8.0_321</li><li>JRE_HOME=%JAVA＿HOME%\jre</li></ol><h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.bat</span><br></pre></td></tr></table></figure><p><strong>出现中文乱码</strong></p><blockquote><p>修改conf/logging.properties</p><p>java.util.logging.ConsoleHandler.encoding = GBK</p></blockquote><span id="more"></span><h3 id="开发一个带有servlet的webapp"><a href="#开发一个带有servlet的webapp" class="headerlink" title="开发一个带有servlet的webapp"></a>开发一个带有servlet的webapp</h3><ol><li><p>在webapps 目录下，创建一个目录project，这就是web根目录</p></li><li><p>根目录下新建 WEB-INF 文件夹</p></li><li><p>WEB-INF目录下传创建 classes 目录：放置字节码文件</p></li><li><p>WEB-INF下新建 lib文件夹：webapp需要第三方jar包时，就放置到此处</p></li><li><p>WEB-INF新建 web.xml 文件：配置文件，描述了路径与类的对应关系</p></li><li><p>编写Java程序，程序必须实现servlet接口。接口规范不在javaSE，javaEE文档可查看，在tomcat包中  /lib/servlet-api.jar. 解压后 /jakarta/servlet/Servlet.class 就是我们要实现的接口</p></li><li><p>编写 servlet 编译问题：</p><blockquote><p>jakarta包不存在，需要配置环境变量</p><p>classpath=.;…/tomcat/lib\servlet.jar</p></blockquote></li><li><p>将编译后的Java文件放到 classes 下</p></li><li><p>配置webxml 文件，让路径与类名关联（注册servlet类）</p></li></ol><h3 id="IDE中开发一个servlet"><a href="#IDE中开发一个servlet" class="headerlink" title="IDE中开发一个servlet"></a>IDE中开发一个servlet</h3><blockquote><p><strong>新建 maven webapp 项目不生成 sec目录？</strong></p><p>找到Build, Execution, Deployment，选中Build Tools–&gt;Maven–&gt;Runner，在右侧 VM Options框中写上 -Darchetype=Internal 即可。</p><p>建议使用 tomcat 9，10 可能出现问题</p></blockquote><ol><li><p>创建空项目 project</p></li><li><p>添加模块 servlet01</p></li><li><p>为模块添加框架支持</p></li><li><p>编写 servlet （studentServlet），发现Servlet 类不存在</p><p> 将tomcat lib 文件夹下的 servlet-api.jar 和 jsp-api.jar 加入。在 service方法中连接数据库</p></li><li><p>在WEB-INF 下新建 lib,并把 jdbc驱动架包放入</p></li><li><p>在web.xml 文件完成 servlet子类的注册</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>studentServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>javaweb.StudentServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>studentServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet/student<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>给一个HTML页面，在HTML页面中编写超链接，点击执行后台的servlet程序。文件放在WEB-INF 上一级目录</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   // 项目名无法动态获取 /project</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/project/servlet/student&quot;</span>&gt;</span> student list<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>让IDE工具去关联Tomcat服务器，关联的过程中将webapp部署到Tomcat服务器当中</p><ul><li>IDEA工具右上角，绿色小锤子右边有一个: Add Configuration</li><li>左上角加号，点击Tomcat Server –&gt; local<br>  在弹出的界面中设置服务器Server的参数 (基本上不用动)</li><li>在当前窗口中有一个Deployment (点击这个用来部署webapp)，:继续点击加号，部署即可<br>  修改 Application context为: /project</li></ul></li><li><p>访问：<a href="http://localhost:8080/project/student.html">http://localhost:8080/project/student.html</a></p></li></ol><h3 id="servlet-对象生命周期"><a href="#servlet-对象生命周期" class="headerlink" title="servlet 对象生命周期"></a>servlet 对象生命周期</h3><blockquote><p>从创建到销毁的过程</p></blockquote><p>在Servlet中提供一个无参的构造函数，启动服务器的时候看构造函数是否执行。经过测试得出结论：<strong>默认情况下，服务器在启动Servlet对象并不会实例化</strong></p><p>如果我们在配置文件给 servlet 增加</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时，这个我们自己编写的servlet会在启动服务时实例化</p><p><strong>用户第一次请求</strong></p><blockquote><p>此时路径对应的servlet对象会在被实例化，此时tomcat 调用 servlet 对象的 init 方法。servlet 构造函数会执行</p></blockquote><p><strong>用户第二次及n次请求</strong></p><blockquote><p>此时路径对应的servlet对象init方法没有调用，构造函数也没有调用</p></blockquote><p>用户发送一次请求，service方法就会被调用一次。</p><p>关闭服务器的时候，回调 distory 方法</p><h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><blockquote><p>这个初始化操作指挥执行一次，这里我们看可以做：初始化数据库连接池，初始化线程池</p></blockquote><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><blockquote><p>用户每次请求都会调用一次</p></blockquote><h4 id="destory"><a href="#destory" class="headerlink" title="destory"></a>destory</h4><blockquote><p>进行资源关闭，马上要销毁对象时调用</p></blockquote><h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><blockquote><p>由于Servlet 接口我们通常只要service 方法，其他方法用不到。但是又必须的重写。如果我们想省略那些用不着的代码，该怎么办？</p></blockquote><p>ServiceAdapter</p><p>这个适配器实现Servlet接口，并把service作为抽象方法.</p><p>但实际上这个适配器方法已经有现成的了：GenericServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.javaweb.servlet.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ServiceAdapter</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">// 配置项</span></span><br><span class="line">    <span class="keyword">private</span> ServletConfig config;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init execute&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.config = servletConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy execute&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>StudentServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentServlet</span> <span class="keyword">extends</span> <span class="title class_">ServiceAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet service start!&quot;</span>);</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span>  <span class="operator">=</span> servletResponse.getWriter();</span><br><span class="line"></span><br><span class="line">        out.println(<span class="string">&quot;欢迎访问本页面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="servletConfig"><a href="#servletConfig" class="headerlink" title="servletConfig"></a>servletConfig</h3><blockquote><p>ServletConfig 对象中封装了servlet 标签中的配置信息（web.xml 下的servlet配置）</p></blockquote><h3 id="servletContext"><a href="#servletContext" class="headerlink" title="servletContext"></a>servletContext</h3><blockquote><p>servletContext 接口时 Servlet 规范中的一员，对应其实就是整个Web.xml 文件。</p><p>servletContext 比作教室，servlet 就是学生</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取上下文对象的方式</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="type">ServletConfig</span> <span class="variable">s</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletConfig();</span><br><span class="line"><span class="type">servletContext</span> <span class="variable">application</span> <span class="operator">=</span> config.getServletContext();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、</span></span><br><span class="line"><span class="built_in">this</span>.getServletContext()</span><br></pre></td></tr></table></figure><h4 id="配置共有的参数"><a href="#配置共有的参数" class="headerlink" title="配置共有的参数"></a>配置共有的参数</h4><blockquote><p>在 web.xml 文件中，与servlet 平级,一般是公共的数据，数据量小且几乎不会再修改（应用域）</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>pageSize<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存 map.put(k, value)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object value)</span>;</span><br><span class="line"><span class="comment">// 取 map.get(k)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAttribute</span><span class="params">(String name)</span>;</span><br><span class="line"><span class="comment">// 删 map.remove(k)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAttribute</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">application.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><ol><li>public String getInitParameter(String name)  通过初始化参数的name获取value</li><li>public Enumeration&lt;String&gt; getInitparameterNames()  通过初始化参数的name</li><li>public ServletContext getServletContext()</li><li>public String getServletName()</li><li>getContextPath()  获取上下文的根</li><li>getRealPath()  获取文件的绝对路径</li><li>public void log(String message)</li><li>public void log(String message, Throawble t);</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 获取上下文初始化参数</span></span><br><span class="line">Enuumeration&lt;Stirng&gt; initParameterNames = application.getInitParameterNames();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(initParameterNames.hasMoreElements()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> initParameterNames.getInitParameter(name);</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> application.getInitparmeter(name);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文件路径</span></span><br><span class="line"><span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> application.getRealPath(<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录日志, 存储在 Tamcat 根目录下的 logs 文件夹下.如果用的时IDE，则实在IDE中的小猫咪文件夹下（IDE中可以有多个小猫咪服务）</span></span><br><span class="line">application.log(<span class="string">&quot;日志&quot;</span>);</span><br><span class="line">application.log(<span class="string">&quot;日志&quot;</span>,  Throawble t);</span><br></pre></td></tr></table></figure><blockquote><p>以后取编写 Servlet 类的时候，实际上不会直接继承 GenericServlet 类的，因为我们是B/S 架构。这种系统基于Http 超文本传输协议的，在Servlet规范中提供了一个类叫做 HttpServlet ，专门为Http协议准备的一个Servlet类，所以我们编写时要继承HttpServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jakarta.servlet.Servlet(接口) 【爷爷】</span><br><span class="line">jakarte.servlet.GenaricServlet imlements  <span class="title function_">Servlet</span><span class="params">(抽象类)</span>【儿子】</span><br><span class="line">jakarta.servlet.HttpServelt <span class="keyword">extends</span> <span class="title class_">GenaricServlet</span>(抽象类)【孙子】</span><br><span class="line">    </span><br><span class="line">我们以后编写 Servlet 需要继承 HttpServlet</span><br></pre></td></tr></table></figure></blockquote><p><strong>接触到的缓存机制</strong></p><ol><li><p>常量池</p><p> ”abc“现在字符串常量池找，有，直接用，没有新建放入常量池</p></li><li><p>整数型常量池</p><p> [-127, 127] 共256个Integer类型引用可以直接使用</p></li><li><p>连接池</p><p> 连接数据库的连接对象，新建n个连接对象。每次用户连接时省去新建环节</p></li><li><p>线程池</p></li><li><p>redis</p></li><li><p>SerevletContext 应用域中存储数据</p></li></ol><h3 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h3><h4 id="URL与URI"><a href="#URL与URI" class="headerlink" title="URL与URI"></a>URL与URI</h4><blockquote><p>URL：统一资源定位符</p><p>​    <a href="https://rank.kkj.cn/Phone74.shtml">https://rank.kkj.cn/Phone74.shtml</a></p><p>URI：统一资源标识符</p><p>​    /Phone74.shtml</p></blockquote><h4 id="get与post请求"><a href="#get与post请求" class="headerlink" title="get与post请求"></a>get与post请求</h4><ul><li><p>get 请求是绝对安全的，应为get是从服务器获取资源。</p><ul><li><p>get请求支持缓存</p></li><li><p>如果希望get请求有缓存怎么办？</p><p>  get请求路径不同即可，如路径添加系统毫秒数</p></li></ul></li><li><p>post 请求是危险的，因为post是向服务器发送数据</p><ul><li>post 响应结果不会被缓存</li></ul></li></ul><h3 id="HttpServlet-源码分析"><a href="#HttpServlet-源码分析" class="headerlink" title="HttpServlet 源码分析"></a>HttpServlet 源码分析</h3><h4 id="http-包下都有哪些类的接口"><a href="#http-包下都有哪些类的接口" class="headerlink" title="http 包下都有哪些类的接口"></a>http 包下都有哪些类的接口</h4><ul><li>jakarta.servlet.http.HttpServlet (Http协议专用的请求对象)</li><li>jakarta.servlet.http.HttpServletRequest (Http协议专用请求对象)</li><li>jakarta.servlet.http.HttpServletResPonse (Http协议专用响应对象)</li></ul><h3 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h3><ul><li><p>HttpServletRequest </p><ul><li><p>getMethod() 获取请求方式</p></li><li><p>getRemoteAddr() 获取用户IP</p></li><li><p>setCharacterEncoding(String env)  设置请求体字符集，获取用户中文输入可能出现乱码，此时需要这个方法设置 “UTF-8”</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">res.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">res.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get 方法请求乱码问题</span></span><br><span class="line">tomcat <span class="number">8</span>开始默认字符集是UTF-<span class="number">8</span></span><br><span class="line"> 修改 tomcathome/ conf/server.xml</span><br><span class="line">    Connector 增加 属性 URIEncoding=<span class="string">&quot;UTF-8&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>getContextPath  获取应用根路径</p></li><li><p>getRequestURL  获取请求方式</p></li><li><p>getServletPath  获取 servlet path</p></li><li><p>获取浏览器用户提交信息</p><ul><li>String getParameter(String name)【几乎不用】</li><li>Map&lt;String,string[]&gt;getParameterMap() 【几乎不用】</li><li>Enumeration&lt;String&gt;  getParameterNames() 【用的少】</li><li>String[] getParameterValues(String name) 【常用】</li></ul></li><li><p>如何存储用户提交的数据</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为避免键值重复</span></span><br><span class="line">Map&lt;String, String[]&gt;</span><br><span class="line"></span><br><span class="line">keyvalue</span><br><span class="line">-----------------</span><br><span class="line">username  &#123;<span class="string">&quot;abc&quot;</span>&#125;</span><br><span class="line">userpwd    &#123;<span class="string">&quot;111&quot;</span>&#125;</span><br><span class="line">aihao  &#123;<span class="string">&quot;s&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;w&quot;</span>&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="设置-javaweb-项目欢迎页面"><a href="#设置-javaweb-项目欢迎页面" class="headerlink" title="设置 javaweb 项目欢迎页面"></a>设置 javaweb 项目欢迎页面</h3><blockquote><p>就是相当于设置默认的主页面,路径不需要以/开始。如果不设置，默认找index.html</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>login.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="WEB-INF-目录"><a href="#WEB-INF-目录" class="headerlink" title="WEB-INF 目录"></a>WEB-INF 目录</h3><blockquote><p>此目录是受保护的，浏览器通过地址不能访问</p></blockquote><h3 id="请求域-对象"><a href="#请求域-对象" class="headerlink" title="请求域 对象"></a>请求域 对象</h3><blockquote><p>根应用域一样，也有这三个方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存 map.put(k, value)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object value)</span>;</span><br><span class="line"><span class="comment">// 取 map.get(k)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAttribute</span><span class="params">(String name)</span>;</span><br><span class="line"><span class="comment">// 删 map.remove(k)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAttribute</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">application.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="转发机制"><a href="#转发机制" class="headerlink" title="转发机制"></a>转发机制</h3><blockquote><p>执行了 A servlet 后跳转到 B servlet</p></blockquote><ol><li><p>获取请求转发器对象</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数是 web.xml 配置的路径</span></span><br><span class="line"><span class="type">RequestDispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> request.getRequestDispatcher(<span class="string">&#x27;/b&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>调用请求转发器的 forword 方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatcher.forword(request, response);</span><br></pre></td></tr></table></figure></li></ol><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><blockquote><p>重定向请求两次，转发请求一次</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">&quot;/project/dept/list&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="两个Servlet-数据怎么共享？"><a href="#两个Servlet-数据怎么共享？" class="headerlink" title="两个Servlet 数据怎么共享？"></a>两个Servlet 数据怎么共享？</h3><ol><li>将数据放到ServletContext 应用域中</li><li>将数据放到 request域中，然后转发到另一个servlet</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> dept;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">deptno <span class="type">int</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">dname <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">loc <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept(deptno, dname, loc) <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept(deptno, dname, loc) <span class="keyword">values</span>(<span class="number">20</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>); </span><br><span class="line">    </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept(deptno, dname, loc) <span class="keyword">values</span>(<span class="number">30</span>,<span class="string">&#x27;技术部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>); </span><br><span class="line">  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept(deptno, dname, loc) <span class="keyword">values</span>(<span class="number">40</span>,<span class="string">&#x27;媒体部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>); </span><br><span class="line">    </span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept;</span><br></pre></td></tr></table></figure><h3 id="使用注解方式注册-servlet"><a href="#使用注解方式注册-servlet" class="headerlink" title="使用注解方式注册 servlet"></a>使用注解方式注册 servlet</h3><blockquote><p>每次配置 web.xml 文件，过于繁琐。可以使用 @WebServlet 注解。</p><p>如果参数不需要变化的建议使用注解，如果参数需要频繁变更建议写在配置文件</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(name = &quot;studentServlet&quot;, urlPatterns = &quot;/servlet/student&quot;,</span></span><br><span class="line"><span class="meta">initParams = &#123; @WebInitParam(name = &quot;username&quot;, value=&quot;root&quot;), @WebInitParam(name = &quot;password&quot;, value=&quot;123456&quot;)&#125; ,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentServlet</span> <span class="keyword">extends</span> <span class="title class_">ServiceAdapter</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取注解上的参数"><a href="#获取注解上的参数" class="headerlink" title="获取注解上的参数"></a>获取注解上的参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取Servlet Name</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">servletName</span> <span class="operator">=</span> getServletName();</span><br><span class="line">    <span class="comment">// 获取Servlet path</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> resuest.getServletPath();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取初始化参数 initParams</span></span><br><span class="line">    Enumeration&lt;String&gt; names = getInitParameterNames();</span><br><span class="line">    <span class="keyword">while</span>(names.hasMoreElements()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> names.nextElement();</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> getInitParameter(name);</span><br><span class="line">        System.out.println(name + value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用反射获取类上的注解"><a href="#使用反射获取类上的注解" class="headerlink" title="使用反射获取类上的注解"></a>使用反射获取类上的注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; welcomeServletClass = Class.forName(<span class="string">&quot;com.xxxxx.servlet.WelcomeServlet&quot;</span>);</span><br><span class="line"><span class="comment">// 判断类是否有注解对象，有就获取</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">annotationPresent</span> <span class="operator">=</span> welcomeServletClass.isAnnotationPresent(WebServlet.class);</span><br><span class="line"><span class="keyword">if</span>(annotationPresent) &#123;</span><br><span class="line">    <span class="type">WebServlet</span> <span class="variable">webServletAnnotation</span> <span class="operator">=</span> welcomeServletClass.getAnnitation(WebServlet.class);</span><br><span class="line">    Stirng[] value = webServletAnnotation.value();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">        System.out.println(value[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模板方法设计模式"><a href="#模板方法设计模式" class="headerlink" title="模板方法设计模式"></a>模板方法设计模式</h3><blockquote><p>某个问题的固定解决方案（可以被重复使用）</p></blockquote><p><strong>什么是模板方法设计模式?</strong></p><blockquote><p>在模板类的模板方法当中定义核心算法骨架，具体的实现步骤可以延迟到子类当中完成。模板类通常是一个抽象类，模板类当中的模板方法定义核心算法，这个方法通常是final的(但也可以不是final的)</p><p>模板类当中的抽象方法就是不确定实现的方法，这个不确定怎么实现的事儿交给子类去做。</p></blockquote><p><strong>之前我们是一个请求一个Servlet ，这样会导致我们创建多个Servlet。我们想把多个Servlet 合并成一个Servlet，怎么做？</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&#123;&quot;/list&quot;, &quot;/add&quot;, &quot;/save&quot;, &quot;/delete&quot;, &quot;/update&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="comment">//        super.service(req, resp);</span></span><br><span class="line">        <span class="comment">// 获取请求路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> req.getServletPath();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;/list&quot;</span>.equals(servletPath)) &#123;</span><br><span class="line">            doList(req, res);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;/add&quot;</span>.equals(servletPath)) &#123;</span><br><span class="line">            doAdd(req, res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAdd</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span>  <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="built_in">this</span>.getWriter(res);</span><br><span class="line">        out.println(<span class="string">&quot;doAdd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doList</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span>  <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="built_in">this</span>.getWriter(res);</span><br><span class="line">        out.println(<span class="string">&quot;doList&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> PrintWriter <span class="title function_">getWriter</span><span class="params">(ServletResponse res)</span> &#123;</span><br><span class="line">        res.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span>  <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = res.getWriter();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h3><blockquote><p>访问 index.jsp 文件实际上是访问 tomcat 翻译生成的 index_jsp.class</p></blockquote><blockquote><p><strong>]SP实际上就是一个Servlet。</strong><br><strong>i</strong>ndex.sp访问的时候，会自动翻译生成index isp.java，会自动编译生成index isp.cass，那么index isp 这就是一个类。</p><p>indexjsp类继承HttplspBase，而HttplspBase类继承的是HttpServlet。所以index jsp类就是一个Servlet类。isp的生命周期和Servlet的生命周期完全相同。完全就是一个东西。没有任何区别。</p><p>普通servlet 对象注重业务，jsp 则更注重页面展示</p></blockquote><p><strong>在 jsp 文件中编写Java代码时就相当于在 Servlet 中的 service 方法中编写代码</strong></p><h4 id="jsp语法"><a href="#jsp语法" class="headerlink" title="jsp语法"></a>jsp语法</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line"> ... 这里的代码会被放到servlet 的service方法中渲染</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%!</span><br><span class="line"> ... 这里的代码会被放置到servlet 的类体中   </span><br><span class="line"> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%=xxx%&gt; 翻译成 out.print(xxx);</span><br><span class="line"></span><br><span class="line">xzxz  普通字符串会被翻译到out.print(<span class="string">&quot;xzxz&quot;</span>) 参数中</span><br></pre></td></tr></table></figure><h4 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h4><blockquote><p>只能在 &lt;%%&gt; service方法中使用</p></blockquote><ol><li>out   输出流对象</li></ol><h3 id="session-会话机制（B-S系统结构）"><a href="#session-会话机制（B-S系统结构）" class="headerlink" title="session 会话机制（B/S系统结构）"></a>session 会话机制（B/S系统结构）</h3><blockquote><p>用户从打开浏览器到关闭浏览器就是一次会话。</p><p>为啥需要session来保存会话状态？因为Http协议是一种无状态协议</p><p>session 对象是存储在服务端的，一个session对应一个请求对象。</p><p>session的销毁是通过设置过期时间，就是登录后你的最后一次操作后超过多长时间没有操作，后端会判断这个会话过期</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只获取 session</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession(fasle);</span><br><span class="line"><span class="comment">// 获取不到创建一个</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line"><span class="comment">// 向会话中绑定数据</span></span><br><span class="line">session.setAttribute();</span><br><span class="line"><span class="comment">// 从会话域中取数据</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> session.getAttribute();</span><br><span class="line"><span class="comment">// 将session对象响应到浏览器</span></span><br><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="为啥不用-request-servletContext-存储？"><a href="#为啥不用-request-servletContext-存储？" class="headerlink" title="为啥不用 request,servletContext 存储？"></a>为啥不用 request,servletContext 存储？</h4><blockquote><p>作用域大小：request &lt; session &lt; servletContext</p><p>request 对象每次请求都会创建新的对象</p><p>servletContext 是所有用户共享的</p></blockquote><h4 id="session的实现原理"><a href="#session的实现原理" class="headerlink" title="session的实现原理"></a>session的实现原理</h4><blockquote><p>​    在web服务器中有一个session列表。类似于map集合。这个map集合的key存储的是sessionid这个map集合的value存储的是对应的session对象</p><p>​    用户发送第一次请求的时候: 服务器会创建一个新的session对象，同时给session对象生成一个id，然后web服务器会将session的id发送给浏览器，浏览器将session的id保存在浏览器的缓存中</p><p>​    用户发送第二次请求的时候: 会自动将浏览器缓存中的sessionid自动发送给服务器，服务器获取到sessionid然后从session列表中查找到对应的session对象</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230214084004466.png" alt="image-20230214084004466"></p><h4 id="为啥关闭浏览器，会话结束？"><a href="#为啥关闭浏览器，会话结束？" class="headerlink" title="为啥关闭浏览器，会话结束？"></a>为啥关闭浏览器，会话结束？</h4><blockquote><p>关闭浏览器后，浏览器中保存的sessionID小艾是，下次重新打开后缓存中没有这个sessionID，自然在服务端找不到对应的session对象</p></blockquote><h4 id="web-xml-设置session-过期时间"><a href="#web-xml-设置session-过期时间" class="headerlink" title="web.xml 设置session 过期时间"></a>web.xml 设置session 过期时间</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="cookie禁止了，怎么传递sessionID？"><a href="#cookie禁止了，怎么传递sessionID？" class="headerlink" title="cookie禁止了，怎么传递sessionID？"></a>cookie禁止了，怎么传递sessionID？</h4><blockquote><p>可以使用URL重写机制:<a href="http://xxxx.com;jsessionid=sessionid/">http://xxxx.com;jsessionid=sessionID</a></p><p>但是成本高：所以企业常用策略是：你爱用不用</p></blockquote><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;515616&quot;</span>);</span><br><span class="line"><span class="comment">// 设置1小时后过期</span></span><br><span class="line">cookie.setMaxage(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line"><span class="comment">// 设置过期时间0，表示删除次cookie</span></span><br><span class="line">cookie.setMaxage(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 关联路径,此路径才提交cookie</span></span><br><span class="line">cookie.setPath();</span><br><span class="line"><span class="comment">// 发送到浏览器</span></span><br><span class="line">res.addCookie(cookie);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器获取cookie</span></span><br><span class="line">Cookie[]  cookies = req.getCookies();</span><br><span class="line"><span class="keyword">if</span> (cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie: cookies) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;cookie = &quot;</span> + cookie.getName() + cookie.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10天免登录"><a href="#10天免登录" class="headerlink" title="10天免登录"></a>10天免登录</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Cookie对象存储用户名</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>( name: <span class="string">&quot;username&quot;</span>, username);</span><br><span class="line"><span class="comment">// 创建Cookie对象存储密码</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>( name:<span class="string">&quot;password&quot;</span>，password); </span><br><span class="line"><span class="comment">// 真实情况下是加密的// 设置cookie的有效期为十天</span></span><br><span class="line">cookie1.setMaxAge(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">10</span>):</span><br><span class="line">cookie2.setMaxAge(<span class="number">60</span> * <span class="number">60</span> *<span class="number">24</span> * <span class="number">10</span>);</span><br><span class="line"><span class="comment">// 设置cookie的path (只要访问这个应用，浏览器就一定要携带这两个cookie)</span></span><br><span class="line">cookie1.setPath(request.getContextPath()):</span><br><span class="line">cookie2.setPath(request.getContextPath()):</span><br><span class="line"><span class="comment">// 响应cookie给浏览器</span></span><br><span class="line">response.addCookie(cookie1);</span><br><span class="line">response.addCookie(cookie2):</span><br></pre></td></tr></table></figure><h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><blockquote><p>就是说我们项目中很多模块都是需要验证登录的，每次执行对应servlet时，先获取session，cookie经行校验然后根据情况经行跳转。所以说我么给能不能把校验这一块提取成共用的方式</p></blockquote><p>编写过滤器</p><blockquote><p>Filter默认情况下，在服务器启动时就会新建对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册，匹配/list 路径 @WebFilter(&quot;/user/*&quot;) 可以使用模糊匹配</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterLogin</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">// 第一次创建之后调用，只执行一侧</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 每次请求都会拦截</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 放行</span></span><br><span class="line">        filterChain.doFilter(req, res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 销毁时执行一次</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>FilterLogin<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.javaweb.servlet.FilterLogin<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>FilterLogin<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/list<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>执行顺序</strong></p><blockquote><p>在xml文件中配置，则从上到下执行，使用注解方式，则比较类名。如：Filter1,Filter2,先执行Filter1. FilterA,FilterB先执行FilterB</p></blockquote><p>责任链模式：可以在配置文件中更改顺序，来改变执行。不需要改Java代码</p><h3 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h3><blockquote><p>Servlet 留给Java 程序员的特殊时机.</p><p>监听器的方法不需要程序员主动调用，而是被web服务器自动调用</p></blockquote><ul><li>Jakarta.servlet<ul><li>ServletContextListener</li><li>ServletContextAttributeListener</li><li>ServletRequestListener</li><li>ServletRequestListener</li></ul></li><li>jakata.servlet.http<ul><li>HttpSessionListener</li><li>HttpSessionAttributeListener</li><li>HttpSessionBindingListener</li><li>HttpSessionIdListener</li><li>HttpSessionActivetionListener</li></ul></li></ul><p>创建一个监听器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="comment">// servletContext  对象被创建时调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        ServletContextListener.<span class="built_in">super</span>.contextInitialized(sce);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// servletContext 对象被销毁时执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        ServletContextListener.<span class="built_in">super</span>.contextDestroyed(sce);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里可以使用配置文件或注解 @WebListener</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.javaweb.servlet.MyServletContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;servlet 是JavaEE 规范之一。&lt;/p&gt;
&lt;p&gt;javaEE 目前最高版本时javaEE8,它被Oracle捐献给Apache。之后被改名为 Jakarta EE。从此没有javaEE 了&lt;/p&gt;
&lt;p&gt;javaEE8中的Servlet类名：javax.servlet.Servlet&lt;/p&gt;
&lt;p&gt;javaEE9中的Servlet类名：jakarta.servlet.Servlet&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;关于系统架构&quot;&gt;&lt;a href=&quot;#关于系统架构&quot; class=&quot;headerlink&quot; title=&quot;关于系统架构&quot;&gt;&lt;/a&gt;关于系统架构&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;系统架构包括&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;C/S 架构&lt;/p&gt;
&lt;p&gt;  就是需要安装的软件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;B/S 架构&lt;/p&gt;
&lt;p&gt;  就是运行在浏览器的页面&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;Tomcat&quot;&gt;&lt;a href=&quot;#Tomcat&quot; class=&quot;headerlink&quot; title=&quot;Tomcat&quot;&gt;&lt;/a&gt;Tomcat&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;开源免费的轻量级ＷＥＢ服务器&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;tomcat-目录&quot;&gt;&lt;a href=&quot;#tomcat-目录&quot; class=&quot;headerlink&quot; title=&quot;tomcat 目录&quot;&gt;&lt;/a&gt;tomcat 目录&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;bin：存放命令文件&lt;ul&gt;
&lt;li&gt;.bat 文件，批量执行windows DOS命令&lt;/li&gt;
&lt;li&gt;.sh 文件，批量执行 Linux 命令&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;conf：配置文件&lt;/li&gt;
&lt;li&gt;lib：tomcat核心程序目录&lt;/li&gt;
&lt;li&gt;logs：日志目录&lt;/li&gt;
&lt;li&gt;temp：临时目录&lt;/li&gt;
&lt;li&gt;webapps：存放web应用&lt;/li&gt;
&lt;li&gt;work：存放jsp文件翻译之后的Java文件以及编译之后的class文件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;配置tomcat环境&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CATALINA_HOME=D:\tomcat\apache-tomcat-10.0.27&lt;/li&gt;
&lt;li&gt;JAVA＿HOME=C:\Program Files\Java\jdk1.8.0_321&lt;/li&gt;
&lt;li&gt;JRE_HOME=%JAVA＿HOME%\jre&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;运行&quot;&gt;&lt;a href=&quot;#运行&quot; class=&quot;headerlink&quot; title=&quot;运行&quot;&gt;&lt;/a&gt;运行&lt;/h4&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;startup.bat&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;出现中文乱码&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;修改conf/logging.properties&lt;/p&gt;
&lt;p&gt;java.util.logging.ConsoleHandler.encoding = GBK&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="jdbcweb基础" scheme="https://wyf195075595.github.io/tags/jdbcweb%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>jsconfig.json</title>
    <link href="https://wyf195075595.github.io/2023/02/08/programming/javascript/jsconfig/"/>
    <id>https://wyf195075595.github.io/2023/02/08/programming/javascript/jsconfig/</id>
    <published>2023-02-08T14:11:10.000Z</published>
    <updated>2023-02-08T14:28:44.324Z</updated>
    
    <content type="html"><![CDATA[<h3 id="vue项目中-jsconfig-json-文件是什么-有啥用？"><a href="#vue项目中-jsconfig-json-文件是什么-有啥用？" class="headerlink" title="vue项目中 jsconfig.json 文件是什么?有啥用？"></a><a href="https://so.csdn.net/so/search?q=vue%E9%A1%B9%E7%9B%AE&spm=1001.2101.3001.7020">vue项目</a>中 jsconfig.json 文件是什么?有啥用？</h3><blockquote><p>当您在工作空间中有一个定义项目上下文的jsconfig.json文件时，JavaScript体验会得到改进。</p></blockquote><p>目录中存在tsconfig.json文件表明该目录是 TypeScript 项目的根目录。该tsconfig.json文件指定编译项目所需的根文件和编译器选项。</p><p>JavaScript 项目可以使用jsconfig.json文件来代替，它的作用几乎相同，但默认启用了一些与 JavaScript 相关的编译器标志。</p><blockquote><p>jsconfig.json源于tsconfig.json，是TypeScript的配置文件。</p><p> jsconfig.json相当于tsconfig.json的“allowJs”属性设置为true</p></blockquote><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* 主要作用是vscode导入使用别名时可以自动化提示文件路径 */</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@/*&quot;</span>: [<span class="string">&quot;src&quot;</span>],</span><br><span class="line">      <span class="string">&quot;components/*&quot;</span>: [<span class="string">&quot;src/components/*&quot;</span>],</span><br><span class="line">      <span class="string">&quot;pages/*&quot;</span>: [<span class="string">&quot;src/pages/*&quot;</span>],</span><br><span class="line">      <span class="string">&quot;assets/*&quot;</span>: [<span class="string">&quot;src/assets/*&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 解决 prettier 对装饰器语法警告</span></span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;dist&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230208222816154.png" alt="image-20230208222816154"></p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;vue项目中-jsconfig-json-文件是什么-有啥用？&quot;&gt;&lt;a href=&quot;#vue项目中-jsconfig-json-文件是什么-有啥用？&quot; class=&quot;headerlink&quot; title=&quot;vue项目中 jsconfig.json 文件是什么?有啥用？&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://so.csdn.net/so/search?q=vue%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020&quot;&gt;vue项目&lt;/a&gt;中 jsconfig.json 文件是什么?有啥用？&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;当您在工作空间中有一个定义项目上下文的jsconfig.json文件时，JavaScript体验会得到改进。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;目录中存在tsconfig.json文件表明该目录是 TypeScript 项目的根目录。该tsconfig.json文件指定编译项目所需的根文件和编译器选项。&lt;/p&gt;
&lt;p&gt;JavaScript 项目可以使用jsconfig.json文件来代替，它的作用几乎相同，但默认启用了一些与 JavaScript 相关的编译器标志。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;jsconfig.json源于tsconfig.json，是TypeScript的配置文件。&lt;/p&gt;
&lt;p&gt; jsconfig.json相当于tsconfig.json的“allowJs”属性设置为true&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="js" scheme="https://wyf195075595.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>mysql基础</title>
    <link href="https://wyf195075595.github.io/2023/01/31/programming/java/mysql/"/>
    <id>https://wyf195075595.github.io/2023/01/31/programming/java/mysql/</id>
    <published>2023-01-31T13:00:00.000Z</published>
    <updated>2023-02-06T00:28:59.310Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装与删除"><a href="#安装与删除" class="headerlink" title="安装与删除"></a>安装与删除</h3><blockquote><p>通过exe 文件安装</p><p>卸载时再点击安装程序，选择 remove 即可卸载。卸载后还需删除两个地方文件。</p><ul><li>C:/ProgrameData/mySQL</li><li>C:/program Files(x86)/mySQL</li></ul><p>如果不删除干净，下次会安装不上</p></blockquote><h3 id="sql-DB-DBMS分别是什么？啥关系？"><a href="#sql-DB-DBMS分别是什么？啥关系？" class="headerlink" title="sql,DB,DBMS分别是什么？啥关系？"></a>sql,DB,DBMS分别是什么？啥关系？</h3><ul><li><p>DB: </p><p>  DataBase (数据库，数据库实际再电脑上以文件形式存在)</p></li><li><p>DBMS： </p><p>  DataBase Management System(数据库管理系统，常见 MYSQL，Oracle，DB2,SqlServer…)</p></li><li><p>SQL: </p><p>  结构化查询语句，是一门标准化通用语言。标准的sql适用于所有数据库产品</p></li></ul><p>关系： DBMS 执行 SQL 操作 DB</p><span id="more"></span><h3 id="什么是表？"><a href="#什么是表？" class="headerlink" title="什么是表？"></a>什么是表？</h3><blockquote><p>table 是数据库的基本组成单元，所欲数据仪表的形式组织，目的时可读性强</p><p>一个表包括行，列</p><ul><li>行： 数据</li><li>列：字段 【字段包括 字段名，数据类型，相关约束】</li></ul></blockquote><h3 id="SQL-语句分类"><a href="#SQL-语句分类" class="headerlink" title="SQL 语句分类"></a>SQL 语句分类</h3><ul><li>DQL：【查询】查询语句 select</li><li>DML：【操作】insert delete update 表数据增删改</li><li>DDL：【定义】create drop alter，表结构增删发</li><li>TCL： 【事务控制】commit，rollback 事务</li><li>DCL： 【数据控制】grant授权，revoke撤销权限</li></ul><!--more--><h3 id="DOS窗口命令"><a href="#DOS窗口命令" class="headerlink" title="DOS窗口命令"></a>DOS窗口命令</h3><ul><li><p>登录MySQL</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123</span><br></pre></td></tr></table></figure></li><li><p>数据库操作</p><p>  命令结束最好带; 号，否则可能判断语句未结束，不执行</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查看数据库</span></span><br><span class="line">show databases</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建数据库</span></span><br><span class="line">create database xxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 删除数据库</span></span><br><span class="line">drop database xxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 使用数据库</span></span><br><span class="line">use xxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 查看表</span></span><br><span class="line">show tables</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 查看表结构</span></span><br><span class="line">desc xxxprint</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 查看创建表的语句</span></span><br><span class="line">show create table emp</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 查看使用的是哪一个数据库</span></span><br><span class="line">select <span class="title function_">database</span><span class="params">()</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 查看版本</span></span><br><span class="line">select <span class="title function_">version</span><span class="params">()</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 初始化数据,执行外部sql 脚本文件创建表</span></span><br><span class="line">source D/xxxxx.sql</span><br></pre></td></tr></table></figure></li></ul><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><h4 id="简单查询（DQL）"><a href="#简单查询（DQL）" class="headerlink" title="简单查询（DQL）"></a>简单查询（DQL）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意，分号结尾，不区分大小写</span></span><br><span class="line">select 字段名<span class="number">1</span>,字段名<span class="number">2</span>,字段名<span class="number">3</span> ... from 表名;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询列别名, as 关键字可以省略</span></span><br><span class="line">select ename,sal * <span class="number">12</span> as <span class="string">&#x27;年薪&#x27;</span> from emp;</span><br></pre></td></tr></table></figure><h4 id="单表条件查询"><a href="#单表条件查询" class="headerlink" title="单表条件查询"></a>单表条件查询</h4><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230202222207356.png" alt="image-20230202222207356"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select 字段... <span class="number">5</span></span><br><span class="line">    from 表名 <span class="number">1</span></span><br><span class="line">    where 条件 <span class="number">2</span></span><br><span class="line">    group by 条件 <span class="number">3</span></span><br><span class="line">    having 条件 <span class="number">4</span></span><br><span class="line">    order by 关键字 <span class="number">6</span></span><br><span class="line">    limit ; <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序 asc 升序,desc 降序</span></span><br><span class="line">    <span class="comment">// 查询 ename 字段 从 emp 表 排序 以 sal 字段 升序  sal1 降序 </span></span><br><span class="line">    <span class="comment">// z只有前面字段无法排序时才会启用后面字段</span></span><br><span class="line">select ename from emp order by sal asc, sal1 desc;</span><br></pre></td></tr></table></figure><h5 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h5><p><strong>不可直接使用在where 语句</strong>，因为 group by 实在where 执行之后才会执行</p><p><strong>分组函数在group by 之后执行</strong></p><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>count</td><td>取得记录</td></tr><tr><td>sum</td><td>求和，自动忽略null数据</td></tr><tr><td>avg</td><td>取平均值</td></tr><tr><td>max</td><td>取最大值</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 对某字段求和</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 统计</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(ename) <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">所有数据库规定，只要与null 参与的运算结果一定是null.</span></span><br><span class="line"><span class="comment">使用 ifnull函数</span></span><br><span class="line"><span class="comment">ifnull(可能时null的字段, 被当作什么处理)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> enamr, ifnull(comn, <span class="number">0</span>) <span class="keyword">as</span> comm <span class="keyword">from</span> emp;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="count-与-count-某个字段的区别？"><a href="#count-与-count-某个字段的区别？" class="headerlink" title="count * 与 count 某个字段的区别？"></a><strong>count * 与 count 某个字段的区别？</strong></h5><blockquote><p>count * 统计所欲条数， count 字段名统计该字段不为空的条数</p></blockquote><h5 id="group-by-和-having"><a href="#group-by-和-having" class="headerlink" title="group by 和 having"></a><strong>group by 和 having</strong></h5><blockquote><p>**group by  后 才能使用 having</p><p>group by: 按照某个字段或者某些字段进行分组</p><p>having： 对分组之后的数据经行筛选</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每个工作岗位的最高工资</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出工资高于平均工资的员工</span><br><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure><h5 id="having-和-group-by-如何选择？"><a href="#having-和-group-by-如何选择？" class="headerlink" title="having 和 group by 如何选择？"></a><strong>having 和 group by 如何选择？</strong></h5><p>eg: 找出每个部门最高薪资，要求显示薪资大于2900的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每个部门最大薪资、</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sal) ,deptno <span class="keyword">from</span> emp <span class="keyword">by</span> deptno;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出薪资大于 <span class="number">2900</span> 【效率低】</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(sal) ,deptno <span class="keyword">from</span> emp <span class="keyword">by</span> deptno <span class="keyword">having</span> <span class="built_in">max</span>(sal) <span class="operator">&gt;</span> <span class="number">2900</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 最佳方案</span><br><span class="line"><span class="keyword">select</span>  <span class="built_in">max</span>(sal) ,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2900</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure><p><strong>但是，当where 条件满足不了？</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 要求平均薪资大于<span class="number">2000</span></span><br><span class="line"><span class="keyword">select</span>  <span class="built_in">max</span>(sal) ,deptno <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="built_in">avg</span>(sal) <span class="keyword">by</span> deptno; <span class="operator">/</span><span class="operator">/</span> 错误，<span class="keyword">where</span> 后面不能用分组</span><br><span class="line"></span><br><span class="line">此时只能用 <span class="keyword">having</span></span><br></pre></td></tr></table></figure><h5 id="多个字段联合起来一起分组？"><a href="#多个字段联合起来一起分组？" class="headerlink" title="多个字段联合起来一起分组？"></a><strong>多个字段联合起来一起分组？</strong></h5><blockquote><p>将多个字段拼在一起看成一个字段</p></blockquote><p>eg: 找出每个部门不同工作岗位的最高薪资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,jop,<span class="built_in">max</span>(sal)</span><br><span class="line">    <span class="keyword">from</span> emp</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> deptno, job;</span><br></pre></td></tr></table></figure><h4 id="关于查询结果的去重"><a href="#关于查询结果的去重" class="headerlink" title="关于查询结果的去重"></a>关于查询结果的去重</h4><blockquote><p>dsitinc： 修饰查询的字段名，只能出现在所有字段的最前面</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 表示所有字段联合去重</span><br><span class="line"><span class="keyword">select</span> distinc deptno,jop <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><blockquote><p>实际开发中，大部分业务都不是单表查询数据发，一般都是夺标联合查询取最终结果</p></blockquote><h5 id="连接查询的分类？"><a href="#连接查询的分类？" class="headerlink" title="连接查询的分类？"></a>连接查询的分类？</h5><blockquote><p>根据语法划分：</p><p>SQL92（老DBA在使用）</p><p>SQL99（比较新）</p></blockquote><p>根据连接方式划分，包括：</p><ul><li><p>内连接</p><blockquote><p>假设A和B表经行连接，使用内连接的话，凡是A表和B表能匹配的上的记录查询出来，这就是内连接。两张表平级，没有主副</p></blockquote><ul><li>等值连接</li><li>非等值连接</li><li>自连接</li></ul></li><li><p>外连接</p><blockquote><p>假设A和B表进行连接，使用外连接的话。一张是主表，主要查询主表中的数据捎带查询附表中的数据，当副表中没有数据和主表中的数据匹配上，副表自动模拟出NULL与之匹配</p></blockquote><ul><li>左外连接（左连接，左边是主表）</li><li>右外连接（右连接，右边是主表）</li></ul></li><li><p>全连接（很少用）</p></li></ul><h5 id="笛卡儿积现象"><a href="#笛卡儿积现象" class="headerlink" title="笛卡儿积现象"></a>笛卡儿积现象</h5><blockquote><p>如果两张表连接查询没有加限制条件，则结果是两张表记录的条数乘积</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 查询所有员工的部门名称</span><br><span class="line"><span class="keyword">select</span> e.ename,d.dname <span class="keyword">from</span> emp e,dept d;</span><br></pre></td></tr></table></figure><h5 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h5><blockquote><p>条件是等量关系</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 查询每个员工的部门名称，要求显示员工名和部门名</span><br><span class="line"></span><br><span class="line">SQL92:</span><br><span class="line"><span class="keyword">select</span> e.ename ,d.dname</span><br><span class="line"><span class="keyword">from</span> emp e, dept d</span><br><span class="line"><span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line"></span><br><span class="line">SQL99:(常用)</span><br><span class="line"><span class="keyword">select</span> e.ename ,d.dname</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">join</span> dept d</span><br><span class="line"><span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line"></span><br><span class="line">内连接语法：<span class="keyword">inner</span> <span class="keyword">join</span> 简写 <span class="keyword">join</span></span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line"><span class="keyword">join</span> B</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">连接条件</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h5><blockquote><p>连接条件是非等值关系</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每个员工的工资等级，要求显示员工名称，工资，工资等级</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.namme, e.sal, s.lv</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">join</span> salgrade s</span><br><span class="line"><span class="keyword">on</span> e.sal vetween s.losal <span class="keyword">and</span> s.hisal;<span class="operator">/</span><span class="operator">/</span> <span class="keyword">no</span> 条件不是等量关系</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h5><blockquote><p>一张表看作两张比表,自己连接自己</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每个员工的上级领导，要求显示员工的姓名和对应领导名字。员工表中有领导和员工 mar 字段 存储了员工的编号</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.ename <span class="keyword">as</span> <span class="string">&#x27;员工名&#x27;</span>, m.ename <span class="keyword">as</span> <span class="string">&#x27;领导名&#x27;</span></span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">join</span> emp m</span><br><span class="line"><span class="keyword">on</span> e.mar <span class="operator">=</span><span class="operator">=</span> m.empno;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 内连接查询大Boss 查不出来</span><br></pre></td></tr></table></figure><h5 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename <span class="keyword">as</span> <span class="string">&#x27;员工名&#x27;</span>, m.ename <span class="keyword">as</span> <span class="string">&#x27;领导名&#x27;</span></span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> emp m</span><br><span class="line"><span class="keyword">on</span> e.mar <span class="operator">=</span><span class="operator">=</span> m.empno;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 外连接可以查出大Boss 数据 对应领导 <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 查询哪个部门没有人</span><br><span class="line"><span class="keyword">select</span> d.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dmp e</span><br><span class="line"><span class="keyword">right</span> <span class="keyword">join</span> dep d</span><br><span class="line"><span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line"><span class="keyword">where</span> e.ename <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><h5 id="三张表以上的表连接查询"><a href="#三张表以上的表连接查询" class="headerlink" title="三张表以上的表连接查询"></a>三张表以上的表连接查询</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每一个员工的部门名称以及工资情况</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.name, d.name, s.grade, e1.enmae <span class="string">&#x27;领导&#x27;</span></span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">join</span> dept d</span><br><span class="line"><span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line"><span class="keyword">join</span> salgrade s</span><br><span class="line"><span class="keyword">on</span> e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> emp e1</span><br><span class="line"><span class="keyword">on</span> e.mgr <span class="operator">=</span> e1.empno;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 先查A <span class="operator">+</span> B，在查A <span class="operator">+</span> C</span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line"><span class="keyword">join</span> B</span><br><span class="line"><span class="keyword">join</span> C</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="子嵌套查询"><a href="#子嵌套查询" class="headerlink" title="子嵌套查询"></a>子嵌套查询</h4><blockquote><p>select 语句中嵌套select语句</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出高于平均薪资的员工信息</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出每个部门平均薪资等级</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="number">1</span>、找出每个部门平均薪水（按照部门编号分组，求sal）</span><br><span class="line"><span class="keyword">select</span> e.deptno ,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="number">2</span>、将上一步的查询结果当作临时表t, 让t和表 salgrade 连接，条件是: t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出所有员工的部门名称</span><br><span class="line"><span class="keyword">select</span> e.ename (</span><br><span class="line"><span class="keyword">select</span> d.ename <span class="keyword">from</span> dept d <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line">) sd dname</span><br><span class="line"><span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><h4 id="union"><a href="#union" class="headerlink" title="union"></a>union</h4><blockquote><p>将查询的结果集相加, 可以是两张不相干的表数据查询结果整合。</p><p>但是两个表查询结果数量一致时才能整合</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 找出公估工作岗位是 SALEMA和MANAGER的员工</span><br><span class="line"><span class="keyword">select</span> ename,job </span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;SALEMA&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line"><span class="keyword">where</span> jon <span class="keyword">in</span> (<span class="string">&#x27;SALEMA&#x27;</span> ,<span class="string">&#x27;MANAGER&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;SALEMA&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><blockquote><p>limit 是 MySQL 特有的，其他数据库么有</p><p>limit 起始位置，条数</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp limit <span class="number">0</span>,<span class="number">10</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 第一页 pageSise <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="number">0</span>, pageSise</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 下一页, n代表页数 <span class="number">1</span> 开始</span><br><span class="line">pageSise<span class="operator">*</span>(n <span class="operator">-</span> <span class="number">1</span>), pageSise</span><br></pre></td></tr></table></figure><h3 id="创建表及操作"><a href="#创建表及操作" class="headerlink" title="创建表及操作"></a>创建表及操作</h3><p>建表语句语法格式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名 (</span><br><span class="line">    字段<span class="number">1</span> 数据类型,</span><br><span class="line">    字段<span class="number">2</span> 数据类型,</span><br><span class="line">    字段<span class="number">3</span> 数据类型,</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="常见的数据类型"><a href="#常见的数据类型" class="headerlink" title="常见的数据类型"></a>常见的数据类型</h5><ul><li>int 整数型</li><li>bight 长整型</li><li>float 浮点型</li><li>char 定长字符串</li><li>date 日期类型</li><li>BLOB 二进制大对象（图片视频流媒体信息）</li><li>CLOB 字符大对象 (储存较大文本，4G字符串)</li></ul><h5 id="insert-语句插入数据"><a href="#insert-语句插入数据" class="headerlink" title="insert 语句插入数据"></a>insert 语句插入数据</h5><blockquote><p>语法格式：</p><p>insert into 表明 （字字段2,字段2,段3,..） values (值1, 值2, 值3);</p><p>字段和值数量相同    </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student</span><br><span class="line">(name,class,birth)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;2006-1-1&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;2006-1-2&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="表的复制"><a href="#表的复制" class="headerlink" title="表的复制"></a>表的复制</h5><blockquote><p>语法：将后边查询的内容插入到 dept1表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept1 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept</span><br></pre></td></tr></table></figure></blockquote><h5 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h5><blockquote><p>语法格式：</p><p>update 表名 set 字段1=值1,字段名2=值2….where…</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_student <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;王五&#x27;</span> <span class="keyword">where</span> 条件</span><br></pre></td></tr></table></figure><h5 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h5><blockquote><p>语法格式：</p><p>delete from 表名 where 条件;</p><p><strong>没有条件全部删除</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dept1 <span class="keyword">where</span> <span class="keyword">no</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h5 id="删除大表"><a href="#删除大表" class="headerlink" title="删除大表"></a><strong>删除大表</strong></h5><blockquote><p>delete 删除不清空内存，可以回滚操作。删除效率慢，尤其是大数据表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 表的截断，删除快，不可回滚</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> emp1;</span><br></pre></td></tr></table></figure></blockquote><h5 id="表结构的修改"><a href="#表结构的修改" class="headerlink" title="表结构的修改"></a>表结构的修改</h5><blockquote><p>通过 工具 来操作</p></blockquote><h4 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h4><blockquote><p>为了保证数据合法性，完整性</p></blockquote><ul><li>非空约束 （not null）字段不能为空</li><li>唯一约束 （unique）字段不能重复</li><li>主键约束 （primary key）既不能为空也不能为null，也不能重复</li><li>外键约束 （foreign key）</li><li>检查约束 （check）MySQL不支持</li></ul><p>使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名 (</span><br><span class="line">    字段<span class="number">1</span> 数据类型 <span class="keyword">not</span> <span class="keyword">null</span>,<span class="operator">/</span><span class="operator">/</span> 列级约束</span><br><span class="line">    字段<span class="number">2</span> 数据类型 ,</span><br><span class="line">    字段<span class="number">3</span> 数据类型 ,</span><br><span class="line">    <span class="keyword">unique</span>(字段<span class="number">1</span>,字段<span class="number">2</span>)<span class="operator">/</span><span class="operator">/</span> 多个字段联合起来添加约束<span class="keyword">unique</span>【表级约束】</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t_class if <span class="keyword">exists</span> t_class;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_class (</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,<span class="operator">/</span><span class="operator">/</span> 列级约束</span><br><span class="line">    name <span class="type">varchar</span> ,</span><br><span class="line">    address <span class="type">varchar</span> ,</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">)</span><br><span class="line"> </span><br></pre></td></tr></table></figure><h5 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h5><blockquote><p>表示这个字段引用其 它表的某个字段，并且只能是 其他表的某个字段 中有的值</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_class(</span><br><span class="line">    cno <span class="type">int</span>,</span><br><span class="line">    cname verchar(<span class="number">255</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(cno)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 被引用的字段要拥有唯一性，一般都是引用主键</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_studenet(</span><br><span class="line">    cno <span class="type">int</span>,</span><br><span class="line">    sname verchar(<span class="number">255</span>),</span><br><span class="line">    classno <span class="type">int</span>,</span><br><span class="line">    <span class="keyword">foreign</span> key(classno) reference t_class(c_o)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h3><blockquote><p>表默认的存储引擎是 InnoDB</p><p>show create table 表名，可见</p><p>存储引擎这个名字只有在MySQL中存在(理解为存储方式)，每一个存储引擎都有优缺点</p><p>查看当前 MySQL 支持的存储引擎</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> engines \G</span><br><span class="line"><span class="comment">-----------------------------------</span></span><br><span class="line">Engine: InnoDB</span><br><span class="line">     Support: <span class="keyword">DEFAULT</span></span><br><span class="line">     Comment: Supports transactions, <span class="type">row</span><span class="operator">-</span>level locking, <span class="keyword">and</span> <span class="keyword">foreign</span> keys</span><br><span class="line">Transactions: YES</span><br><span class="line">          XA: YES</span><br><span class="line">  Savepoints: YES</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 支持事务，外键，行级锁，外键。安全得到保障。<span class="keyword">SQL</span>服务器崩溃后提供自动恢复</span><br><span class="line"><span class="comment">------------------------------------</span></span><br><span class="line">MyISAM</span><br><span class="line"></span><br><span class="line">优点：</span><br><span class="line">可悲压缩，节省储存空间。并且可以转换为只读表，提高检索效率</span><br><span class="line">缺点：不持支事务</span><br><span class="line"><span class="comment">-------------------------------------</span></span><br><span class="line">MEMORY 存储引擎</span><br><span class="line"><span class="operator">-</span>表数据及索引存储在内存中，查询贼快。数据易丢失</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><blockquote><p>一个事务是一个完整的业务逻辑单元，不可再分</p><p>比如：银行账户转账，从A账户向B账户转账1000，需要</p><p>A账户减1000，B账户加1000</p><p><strong>一条语句可以搞定的事不需要事务</strong></p></blockquote><p><strong>和事务相关的语句：DML语句（insert delete update）</strong></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230205153456211.png" alt="image-20230205153456211"></p><h5 id="四大特性"><a href="#四大特性" class="headerlink" title="四大特性"></a>四大特性</h5><blockquote><p>ACID</p></blockquote><ul><li>A：原子性：事务最小的单元，不可拆分</li><li>B：一致性：事务必须保证多条DML语句同时成功或同时失败</li><li>Ｃ：隔离性：事务A与事务B之间具有隔离</li><li>D：持久性：持久性事最终数据必须持久化到硬盘文件中，事务才算结束</li></ul><h4 id="关于事务之间的隔离性"><a href="#关于事务之间的隔离性" class="headerlink" title="关于事务之间的隔离性"></a>关于事务之间的隔离性</h4><p>事务隔离性存在隔离级别，理论上隔离级别包括4个:</p><ul><li><p>第一级别: 读未提交 (read uncommitted)对方事务还没有提交，我们当前事务可以读取到对方未提交的数据读未提交存在脏读 (Dirty Read)现象:表示读到了脏的数据。</p></li><li><p>第二级别: 试已提本 (read committed)<br>  对方事务提交之后的数据我方可以读取到。这种隔离级别解决了: 脏读现象没有了。读已提交存在的问题是:不可重复读。</p></li><li><p>第三级别:可重复读 (repeatable read)<br>  这种隔离级别解决了:不可重复读问题。这种隔离级别存在的问题是:读取到的数据是幻象。</p></li><li><p>第四级别: 序列化读/串行化读解决了所有问题。效率低。需要事务排队。</p></li></ul><blockquote><p>MySQL事务默认情况下是自动提交的，任意DML语句执行完就提交一次</p><p>关闭自动提交：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 开启事务</span><br><span class="line"><span class="keyword">start</span>　transaction;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 事务回滚，</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 提交事务</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 设置事务级别</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transation isolation level read uncommitted;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 查看全局事务隔离级别</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@global</span>.tx_isolation;</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><blockquote><p>索引相当于一本书的目录，通过目录可以快速找到对应的资源。</p><p>数据库中查询一张表有两种检索方式：</p><ol><li><p>全表扫描</p></li><li><p>根据索引检索（效率高）、</p><p> 缩小了检索范围</p></li></ol></blockquote><h5 id="索引虽然可以提高检索效率，但是不能随意的添加索引，因为索引也是数据库当中的对象，也需要数据库不断的维护。是有维护成本的。比如，表中的数据经常被修改这样就不适合添加索引，因为数据一旦修改，索引需要重新排序，进行维护。"><a href="#索引虽然可以提高检索效率，但是不能随意的添加索引，因为索引也是数据库当中的对象，也需要数据库不断的维护。是有维护成本的。比如，表中的数据经常被修改这样就不适合添加索引，因为数据一旦修改，索引需要重新排序，进行维护。" class="headerlink" title="索引虽然可以提高检索效率，但是不能随意的添加索引，因为索引也是数据库当中的对象，也需要数据库不断的维护。是有维护成本的。比如，表中的数据经常被修改这样就不适合添加索引，因为数据一旦修改，索引需要重新排序，进行维护。"></a>索引虽然可以提高检索效率，但是不能随意的添加索引，因为索引也是数据库当中的对象，也需要数据库不断的维护。是有维护成本的。比如，表中的数据经常被修改这样就不适合添加索引，因为数据一旦修改，索引需要重新排序，进行维护。</h5><h5 id="什么时候考虑给字段添加索引？"><a href="#什么时候考虑给字段添加索引？" class="headerlink" title="什么时候考虑给字段添加索引？"></a>什么时候考虑给字段添加索引？</h5><ul><li>数据量庞大</li><li>字段很少的DML操作，（字段修改，索引也需要维护）</li><li>该字段经常出现在where字句中</li></ul><blockquote><p>主键和具有unique约束的字段会自动添加索引</p></blockquote><h5 id="查看sql语句的执行计划"><a href="#查看sql语句的执行计划" class="headerlink" title="查看sql语句的执行计划"></a>查看sql语句的执行计划</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><h5 id="添加删除索引"><a href="#添加删除索引" class="headerlink" title="添加删除索引"></a>添加删除索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 添加索引</span><br><span class="line"><span class="keyword">create</span> inedx emp_ename_index <span class="keyword">on</span> emp(ename);</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 删除</span><br><span class="line"><span class="keyword">drop</span> inedx emp_ename_index;</span><br></pre></td></tr></table></figure><h5 id="索引实现原理"><a href="#索引实现原理" class="headerlink" title="索引实现原理"></a>索引实现原理</h5><blockquote><p>通过B Tree缩小扫描范围，底层索引进行了排序，分区，索引会携带数据在表中的物理地址”最终通过索引检索到数据之后，获取到关联的物理地址，通过物理地址定位表中的数据，效率是最高的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span> :通过索引转换为:</span><br><span class="line"><span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> 物理地址 <span class="operator">=</span> <span class="number">0x3</span>;</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230205162205142.png" alt="image-20230205162205142"></p><h5 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h5><ul><li>单一索引：给单个字段添加索引</li><li>复合索引：给多个字段联合添加1个索引</li><li>主键索引</li><li>唯一索引</li></ul><p><strong>索引的失效</strong></p><blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> enamefrom emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%A%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>模糊查询的时候，第一个通配符使用的是%，这个时候索引是失效的。</p></blockquote><h3 id="视图（view）"><a href="#视图（view）" class="headerlink" title="视图（view）"></a>视图（view）</h3><blockquote><p>站在不同角度去看到数据</p><p>对视图进行增删改查，会影响到原表数据</p></blockquote><h4 id="视图的作用？"><a href="#视图的作用？" class="headerlink" title="视图的作用？"></a><strong>视图的作用？</strong></h4><blockquote><p>可以隐藏数据库真实字段名等实现细节。保密级别高的系统，数据库只提供相关的视图，Java程序员只对视图操作</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 创建视图, 只有查询语句可以创建视图</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> myview <span class="keyword">as</span> <span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 删除视图</span><br><span class="line"><span class="keyword">drop</span> myview myview;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 通过视图修改原表数据。</span><br><span class="line"><span class="keyword">update</span> myviewl <span class="keyword">set</span> ename<span class="operator">=</span><span class="string">&#x27;hehe&#x27;</span>,sal<span class="operator">=</span><span class="number">1</span> <span class="keyword">where</span> empno <span class="operator">=</span> <span class="number">7369</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 通过视图删除原表数据。</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span>,myview1 <span class="keyword">where</span> empno <span class="operator">=</span> <span class="number">7369</span>;</span><br></pre></td></tr></table></figure><h3 id="DBA命令"><a href="#DBA命令" class="headerlink" title="DBA命令"></a>DBA命令</h3><ul><li><p>新建用户</p></li><li><p>授权</p></li><li><p>回收权限</p></li><li><p>导入导出</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> wondows dos 命令</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 导出库</span><br><span class="line">mysqldump 库名<span class="operator">&gt;</span>D:\xxx.sql(导出的路径) <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 导出指定表</span><br><span class="line"></span><br><span class="line">mysqldump 库名 表名<span class="operator">&gt;</span>D:\xxx.sql <span class="operator">-</span>u用户名 <span class="operator">-</span>p密码</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 导入库</span><br><span class="line"><span class="keyword">create</span> database 库名</span><br><span class="line">use 库名</span><br><span class="line">source <span class="keyword">sql</span>文件路径</span><br></pre></td></tr></table></figure></li></ul><h3 id="数据库设计三范式"><a href="#数据库设计三范式" class="headerlink" title="数据库设计三范式"></a>数据库设计三范式</h3><blockquote><p>三范式设计，不会产生数据冗余</p></blockquote><ul><li><p>第一范式:任何一张表都应该<strong>有主键</strong>，并且每一个<strong>字段原子性不可再分</strong></p></li><li><p>第二范式:建立在第一范式的基础之上，所有非主键字段完全依赖主键，<strong>不能产生部分依赖</strong>。</p></li><li><p>建立在第二范式的基础之上，所有非主键字段直接依赖主键，<strong>不能产生传递依赖</strong>。</p></li></ul><blockquote><p>实际开发中，以实现用户需求为主，有时候那冗余换执行速度</p></blockquote><blockquote><p>一对一设计：</p><p>主键共享、外键唯一</p><p>一对多设计：</p><p>两张表，多的表加外键</p><p>多对多设计：</p><p>三张表，关系表两个外键。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;安装与删除&quot;&gt;&lt;a href=&quot;#安装与删除&quot; class=&quot;headerlink&quot; title=&quot;安装与删除&quot;&gt;&lt;/a&gt;安装与删除&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;通过exe 文件安装&lt;/p&gt;
&lt;p&gt;卸载时再点击安装程序，选择 remove 即可卸载。卸载后还需删除两个地方文件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;C:/ProgrameData/mySQL&lt;/li&gt;
&lt;li&gt;C:/program Files(x86)/mySQL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果不删除干净，下次会安装不上&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;sql-DB-DBMS分别是什么？啥关系？&quot;&gt;&lt;a href=&quot;#sql-DB-DBMS分别是什么？啥关系？&quot; class=&quot;headerlink&quot; title=&quot;sql,DB,DBMS分别是什么？啥关系？&quot;&gt;&lt;/a&gt;sql,DB,DBMS分别是什么？啥关系？&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;DB: &lt;/p&gt;
&lt;p&gt;  DataBase (数据库，数据库实际再电脑上以文件形式存在)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;DBMS： &lt;/p&gt;
&lt;p&gt;  DataBase Management System(数据库管理系统，常见 MYSQL，Oracle，DB2,SqlServer…)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;SQL: &lt;/p&gt;
&lt;p&gt;  结构化查询语句，是一门标准化通用语言。标准的sql适用于所有数据库产品&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关系： DBMS 执行 SQL 操作 DB&lt;/p&gt;</summary>
    
    
    
    <category term="mysql" scheme="https://wyf195075595.github.io/categories/mysql/"/>
    
    
    <category term="mysql基础" scheme="https://wyf195075595.github.io/tags/mysql%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>java基础</title>
    <link href="https://wyf195075595.github.io/2023/01/09/programming/java/%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"/>
    <id>https://wyf195075595.github.io/2023/01/09/programming/java/%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/</id>
    <published>2023-01-09T05:00:00.000Z</published>
    <updated>2023-02-14T03:00:11.863Z</updated>
    
    <content type="html"><![CDATA[<h2 id="java-特性"><a href="#java-特性" class="headerlink" title="java 特性"></a>java 特性</h2><h3 id="Java-程序的版本"><a href="#Java-程序的版本" class="headerlink" title="Java 程序的版本"></a>Java 程序的版本</h3><blockquote><p>java SE (标准版)</p><p>java EE（企业版）</p><p>java ME（精简版）</p></blockquote><h3 id="java-程序可移植性"><a href="#java-程序可移植性" class="headerlink" title="java 程序可移植性"></a>java 程序可移植性</h3><blockquote><p>什么是可移植性？</p><p>java 程序可以做到一次编译，到处运行。可就是说可以运行到windows,linux等操作系统上。这个被称作Java程序的可移植性，或者叫跨平台。</p><p>如何实现呢？</p><p>Windows操作系统于Linux操作系统的内核肯定不一样，系统执行指令的而方式也不一样。 Java程序不能直接和系统打交道，因为Java程序只有一份。操作系统原理都不同</p><p>解决：</p><p>sum团队想到了一个办法，他们让Java程序运行在一台虚拟的计算机中，这个虚拟计算机叫Java虚拟机，简称JVM。Java虚拟机再和底层操作系统打交道。</p><p>这个虚拟机不能直接安装，而是通过安装适合自己操作系统的 <strong>java jdk</strong> 来实现的</p></blockquote><h3 id="Java-的加载与执行"><a href="#Java-的加载与执行" class="headerlink" title="Java 的加载与执行"></a>Java 的加载与执行</h3><blockquote><p>编译阶段主要任务是检查 Java 源程序是否符合 Java 语法（不进行运算），符合则生成正常字节码文件 (xxx.class)。不符合则无法生成字节码文件</p></blockquote><p>.java -&gt; .class -&gt;     类装载器 -&gt; java 虚拟机（JVM） -&gt; 操作系统 -&gt; 硬件平台</p><span id="more"></span><p><strong>前两步为编译阶段，后面为运行阶段。两步操作可以在不同系统执行</strong></p><blockquote><ol><li><p>.java 是 java 程序源文件（源代码）必须符合Java 编码 规范</p></li><li><p>class 编译后的文件（字节码文件），使用 javac 编译源文件生成</p><p> javac 是一个java编译工具/命令，一个Java 源文件可编译生成多个 .class 文件。</p><p> 语法：javac java源文件路径</p><p> 字节码文件是最终要执行的文件，所以删除Java源文件也不影响Java程序运行效果。但一般不删除源文件，以防需要修改。</p><p> class 文件拷贝到其他操作系统也是可以运行的</p></li><li><p>安装jdk后除了自带 javac.exe, 还有一个工具/命令 java.exe，主要负责运行阶段</p><p> 语法：java 类名</p><p> 例如：硬盘上有一个 A.class ,那么执行 java A。运行程序不要带 .class</p></li><li><p>运行阶段</p><p> 在DOS窗口运行：java A</p><p> Java.exe 命令会启动Java虚拟机（JVM），JVM 会启动类加载器ClassLoader 去硬盘上搜索 A.class文件，找到文件则将该字节码文件装载到JVM当中。JVM然后将A.class字节码文件解释成 二进制10101010这样的数据，最后由操作系统执行二进制文件和底层平台经行交互。</p></li></ol></blockquote><h3 id="安装jdk-jdk-jre-jvm-关系"><a href="#安装jdk-jdk-jre-jvm-关系" class="headerlink" title="安装jdk,jdk,jre,jvm 关系"></a>安装jdk,jdk,jre,jvm 关系</h3><ul><li>jdk    开发工具包,可单独安装，安装时会自带安装jre</li><li>jre     开发运行环境，包括 jvm，可单独安装</li><li>jvm    Java虚拟机</li></ul><h3 id="jdk-目录介绍"><a href="#jdk-目录介绍" class="headerlink" title="jdk 目录介绍"></a>jdk 目录介绍</h3><blockquote><p>bin目录： 里面存放了很多命令，如 javac.exe,java.exe</p><p>db目录：</p><p>jre目录：自带的开发运行环境</p><p>lib目录：</p><p>include目录:</p></blockquote><h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><ul><li><p>系统环境变量 path</p><p>  可以通过配置 path,让命令在DOS窗口任意 目录下使用，相当于系统全局变量</p></li><li><p>java 环境变量 classpath, 不配也没事（默认当前路径）</p><p>  默认ClassLoader 在当前目录路径下加载 xxx.class 字节码，配置classpath 可以给 ClassLoader 类加载器指定路径。更改默认指定路径</p><p>  配置 <strong>classpath=.</strong>    ，相当于指定默认目录就是当前路径</p></li></ul><h3 id="Java-注释"><a href="#Java-注释" class="headerlink" title="Java 注释"></a>Java 注释</h3><blockquote><p>工具  javadoc.exe 可以将注释中的文字添加到帮助文档中。注释跟 js 一样</p></blockquote><h3 id="Java-SE类库的源码位置？"><a href="#Java-SE类库的源码位置？" class="headerlink" title="Java SE类库的源码位置？"></a>Java SE类库的源码位置？</h3><ul><li>SE库字节码：C:\Program Files\Java\jdk1.7.0_51\jre\lib\rt.jar</li><li>SE库源码：C:\Program Files\Java\jdk1.7.0_51\src.zip</li></ul><h3 id="编码方式"><a href="#编码方式" class="headerlink" title="编码方式"></a>编码方式</h3><blockquote><p>Java 语言采用 Unicode 编码方式，实际开发中使用 utf-8 较多</p></blockquote><p>javac xxx.java 编译错误： 编码GBK的不可映射字符</p><p>解决方法：</p><p>以这种格式对文件经行重新编译    </p><p>javac -encoding utf-8 xxx.java</p><h2 id="Java-语法"><a href="#Java-语法" class="headerlink" title="Java 语法"></a>Java 语法</h2><h3 id="public-class-和-class-的区别"><a href="#public-class-和-class-的区别" class="headerlink" title="public class 和 class 的区别"></a>public class 和 class 的区别</h3><ul><li>一个Java源文件当中可以定义多个class</li><li>一个Java源文件当中 public class 不是必须的</li><li>一个class会定义生成一个 xxx.class字节码文件</li><li>一个Java源文件当中定义公开的类的话，只能有一个，并且该类必须和Java源文件名称一致。</li><li>每一个class当中都可以编写main方法，都可以设置程序入口。要执行B.class 中的main方法，执行 java B。如果B中没有main主方法，会报错</li></ul><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><blockquote><p>Java语言中的标识符。</p></blockquote><h4 id="什么是标识符？"><a href="#什么是标识符？" class="headerlink" title="什么是标识符？"></a>什么是标识符？</h4><p>在Java源码程序中，可以自己命名的单词都是标识符。</p><p>如：类名，方法名，常量名，接口名…</p><h4 id="标识符的命名规则？"><a href="#标识符的命名规则？" class="headerlink" title="标识符的命名规则？"></a>标识符的命名规则？</h4><ul><li><p>一个合法的标识符只能由 数字，字母，下划线_，美元符号$ 组成，不能有其他符号。</p></li><li><p>不能数字开头</p></li><li><p>严格区分大小写</p></li><li><p>关键字不能用</p></li><li><p>理论上无长度限制</p></li></ul><h4 id="标识符的命名规范？"><a href="#标识符的命名规范？" class="headerlink" title="标识符的命名规范？"></a>标识符的命名规范？</h4><p>只是一种规范，不输入语法，不遵守规范编译也可以通过。但是不方便他人理解代码</p><ul><li>最好见名知意</li><li>遵守驼峰命名</li><li>类名，接口名：首字母大写（大驼峰</li><li>变量，方法名：首字母小写（小驼峰</li><li>常量名：全部大写</li></ul><h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><p>在Java中关键字都是小写</p><table><thead><tr><th>class</th><th>extend</th><th>implement</th><th>interface</th><th>important</th></tr></thead><tbody><tr><td>package</td><td>break</td><td>case</td><td>continue</td><td>default</td></tr><tr><td>do</td><td>if</td><td>else</td><td>for</td><td>return</td></tr><tr><td>switch</td><td>while</td><td>false</td><td>true</td><td>…</td></tr></tbody></table><h3 id="字面值"><a href="#字面值" class="headerlink" title="字面值"></a>字面值</h3><blockquote><p>java 语言中所有字符串类型字面值必须使用双引号括起来，双引号是英文的</p><p>Java 语言中所有的字符型字面量必须使用单引号括起来，单引号是英文的</p></blockquote><ul><li>10，1200</li><li>3.14</li><li>“abc”,”123”  属于字符串</li><li>‘a’,’1’,’人’  属于字面值</li><li>true,false</li></ul><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><blockquote><p>变量要求储存的具体的“数据”必须和变量的“数据类型”一致，当不一致的时候编译报错</p></blockquote><h4 id="数据类型的作用？"><a href="#数据类型的作用？" class="headerlink" title="数据类型的作用？"></a>数据类型的作用？</h4><ul><li>不同数据类型底层分配不同大小的空间</li><li>数据类型是指导程序运行阶段应该分配多大的内存空间</li></ul><h4 id="声明、定义变量的语法格式："><a href="#声明、定义变量的语法格式：" class="headerlink" title="声明、定义变量的语法格式："></a>声明、定义变量的语法格式：</h4><p><strong>数据类型 变量名</strong></p><h4 id="变量的分类："><a href="#变量的分类：" class="headerlink" title="变量的分类："></a>变量的分类：</h4><ul><li><p>局部变量</p><p>  在方法体当中声明的变量叫局部变量</p></li><li><p>成员变量</p><p>  在方法体外【类体之内】声明的变量叫做成员变量</p></li></ul><p><strong>不同作用域下变量名可以相同</strong>，Java 遵循就近原则 </p><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><strong>基本数据类型</strong></p><ol><li>整数型 int，byte，short，long</li><li>浮点型 float，double</li><li>布尔型 boolean</li><li>字符型 char 【表示现实中的文字，通过ASC码表转换】</li></ol><h4 id="八种基本数据类型占用空间大小："><a href="#八种基本数据类型占用空间大小：" class="headerlink" title="八种基本数据类型占用空间大小："></a>八种基本数据类型占用空间大小：</h4><table><thead><tr><th>基本数据类型</th><th>占用空间大小(byte)</th><th>取值范围</th><th>默认值</th></tr></thead><tbody><tr><td>byte</td><td>1</td><td>-2^7~2^7-1(-128,127)</td><td>0</td></tr><tr><td>short</td><td>2</td><td>-2^15~2^15-1(-32768,32767)</td><td>0</td></tr><tr><td>int</td><td>4</td><td>-2^31~-2^31-1</td><td>0</td></tr><tr><td>long</td><td>8</td><td>-2^63~2^63-1</td><td>0L</td></tr><tr><td>float</td><td>4</td><td>大约±3.40282347E+38F(有效位15)</td><td>0</td></tr><tr><td>double</td><td>8</td><td>大约±1.79769313486231570E+308(有效位15)</td><td>0.0</td></tr><tr><td>boolean</td><td>1</td><td>true/false</td><td>false</td></tr><tr><td>chart</td><td>2</td><td>0~2^16-1(0, 65535)</td><td>\u0000</td></tr></tbody></table><blockquote><p>字节（byte）：</p><p>1 byte = 8 bit 【一个字节=8个比特位】1个比特位表示一个二进制位：1/0</p><p>1 KB = 1024 Byte</p><p>1 MB = 1024 KB</p><p>1 GB = 1024 MB</p><p>byte 类型最大值： 2的7次方 - 1，127</p><p>byte 类型最小值：-128</p><p>byte 类型可以表示 256 个不同的数字</p></blockquote><h4 id="关于八种基本数据类型的默认值：一切向0看齐"><a href="#关于八种基本数据类型的默认值：一切向0看齐" class="headerlink" title="关于八种基本数据类型的默认值：一切向0看齐"></a>关于八种基本数据类型的默认值：<strong>一切向0看齐</strong></h4><blockquote><p>变量遵守这个语法：必须先声明，再赋值，才能访问。</p><p>成员变量没有手动赋值系统默认会赋值，但是局部变量不会</p></blockquote><p><strong>引用数据类型</strong></p><p>字符串 “abc” 不属于基本数据类型，属于 “引用数据类型”，字符属于基本数据类型：</p><h4 id="char-与-转译字符"><a href="#char-与-转译字符" class="headerlink" title="char 与 转译字符"></a>char 与 转译字符</h4><blockquote><p>chart 支持 中文(‘中’)，支持转义字符（’\n’）, 使用单引号括起来，</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个输出命令会换行</span></span><br><span class="line">System.out.println()</span><br><span class="line"><span class="comment">// 这个不会换行</span></span><br><span class="line">System.out.print()</span><br></pre></td></tr></table></figure><h4 id="整数型"><a href="#整数型" class="headerlink" title="整数型"></a>整数型</h4><blockquote><p>Java 语言当中的 <strong>“整数型字面量值”被默认当作 int 类型来处理</strong>。要让这个 “整数字面量值”后面添加 <strong>l/L</strong> ,建议使用大写<strong>L</strong></p></blockquote><p><strong>整数字面值的三种表示方式：</strong></p><ol><li>十进制：是一种缺省默认的方式</li><li>八进制：需要以0开始</li><li>十六进制：需要以0x开始</li></ol><p><strong>类型转换</strong></p><blockquote><p>int 是小容量，long 类型是大容量。小容量可以自动转换成大容量，称为自动类型转换机制</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1、可以自动转换为大容量</span></span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">y</span> <span class="operator">=</span> x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、编译出错</span></span><br><span class="line"><span class="type">long</span> <span class="variable">z</span> <span class="operator">=</span> <span class="number">2147483648</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2147483648 字面量一开始会被当作int类型4个字节处理，但是这个字面值超出了int范围，所以报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决</span></span><br><span class="line"><span class="type">long</span> <span class="variable">z</span> <span class="operator">=</span> <span class="number">2147483648L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样一开始字面量就会被当作long类型处理</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、大容量转换小容量需要强制转换，但是运行阶段可能损失精度（慎用）</span></span><br><span class="line"><span class="comment">// 转换原理：将原始二进制数据前 32个比特（4字节）去掉</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (<span class="type">int</span>)z;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、int 转换为byte类型，只要不超出byte存储范围不需要强制转换 </span></span><br><span class="line"><span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"><span class="type">byte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">128</span><span class="string">&#x27;// 编译出错</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h4><blockquote><p>浮点型存储的值都是近似值，现实世界中有些数字是无限循环小数，计算机存储资源有限，所以只能存储近似值</p><p>float 单精度【4个字节】</p><p>double 双精度【8个字节，精度较高】</p><p>对于财务类型软件，double精度还是过低，所以Java提供了另一个引用类型： Java.math.bigDecima</p></blockquote><p>在Java语言中，所有的浮点型字面值【3.0】，默认被当作 double 类型来处理，要想该字面值当作 float 类型来处理，需要在字面值后面添加 F/f;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">3.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="variable">f</span> <span class="operator">=</span> <span class="number">5.1</span>;<span class="comment">// 编译错误</span></span><br><span class="line"><span class="comment">// 5.1 默认是double类型大容量， float 是单精度小容量，需要强制转换符</span></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="variable">f</span> <span class="operator">=</span> (<span class="type">float</span>)<span class="number">5.1</span>;<span class="comment">// 强制类型转换</span></span><br><span class="line"><span class="type">float</span> <span class="variable">f</span> <span class="operator">=</span> <span class="number">5.1f</span>;<span class="comment">// 没有强制转换</span></span><br></pre></td></tr></table></figure><h4 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h4><blockquote><p>只有两个值：true,false.</p><p>底层存储的时候Boolean类型占用1个字节，因为实际存储的时候false底层是0，true底层是1</p><p>主要使用在逻辑运算和条件控制语句中</p></blockquote><h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><blockquote><ol><li><p>八种基本数据类型当中，除了<strong>Boolean</strong>类型其他类型都能互相转换</p></li><li><p>小容量向大容量转换，称为自动类型转换，容量从小到大：</p><p> byte &lt; (short = char) &lt; int &lt; long &lt; float &lt; double</p><p> 任何浮点类型不管占用多少个字节，都是比整数型容量大</p></li><li><p>小容量转大容量，必须加强制转换符，编译才能通过，但是运行阶段可能损失精度，慎用</p></li><li><p>当整数字面量没有超出<strong>byte，short，char</strong>的取值范围，可以直接赋值给<strong>byte，short，char</strong>类型的变量</p></li><li><p><strong>byte，short，char</strong>混合运算时，各自先转换成<strong>int</strong>类型在做运算</p></li><li><p>多种数据类型混合运算，先转换成容量最大的那种类型再做运算</p><p> <strong>编写.java文件只考虑编译，不考虑运行</strong></p></li></ol></blockquote><h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><table><thead><tr><th>算数运算符</th><th>+、-、*、/、++、–、%</th></tr></thead><tbody><tr><td>逻辑运算符</td><td>&amp;(与)、(或)、~(非)、^(异或)、&amp;&amp;(短路与)、||(短路或)</td></tr><tr><td>关系运算符</td><td>&lt;、&lt;=、&gt;=、==、!=</td></tr><tr><td>布尔运算符</td><td>&amp;&amp;、||、|、&amp;、！</td></tr><tr><td>位运算符</td><td>&amp;(与)、|(或)、~(非)、^(按位异)、&gt;&gt;(右移)、&gt;&gt;&gt;(右移，左边空出的位0填充)、&lt;&lt;(左移)</td></tr><tr><td>赋值类运算符</td><td>=、+=、-=、*=、/=、%/</td></tr><tr><td>字符串连接运算符</td><td>+</td></tr><tr><td>条件运算符</td><td>?:</td></tr><tr><td>其他运算符</td><td>instanceof、new</td></tr></tbody></table><p><strong>逻辑运算符</strong></p><ul><li><p>逻辑运算符 要求两边的算子都是 真/假（布尔类型），且最终运算结果也是一个布尔类型</p><p>  异或（两边的算子只要不一样，结果就是 true）</p></li><li><p>短路与和逻辑与的运算结果相同，只不过短路与存在短路现象</p></li><li><p>短路或和逻辑或的运算结果相同，只不过短路或存在短路现象</p></li></ul><p><strong>赋值运算符</strong></p><blockquote><p>扩展类的赋值运算符，不改变运算结果类型，假设最初这个变量类型是 byte 类型，无论怎么进行追加，追减，最终该变量的数据类型还是byte类型</p></blockquote><p>+运算符 在Java中的两个作用：</p><ul><li>加法运算，求和</li><li>字符串的连接运算</li></ul><p>当 “+” 运算符两边的数据都是字符串，一定是字符串连接运算。</p><ul><li>数字 + 数字 –&gt; 数字</li><li>数字 + “字符串” —&gt; “字符串” 【字符串连接】</li></ul><p>在一个表达式中可以出现多个 “+” 号，如果没有 括号，那么就是从左到右依次运算</p><h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h2><p>Java控制语句可以分为7种</p><ul><li><p>控制选择结构语句</p><ul><li>if,else 括号中接受一个Boolean</li><li>switch 括号中接受一个 int/String</li></ul></li><li><p>控制循环结构语句</p><ul><li>for</li><li>while</li><li>do while</li></ul></li><li><p>改变控制语句顺序</p><ul><li><p>break </p><p>  作用在for,while,do..while</p></li><li><p>continue</p></li></ul></li></ul><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><blockquote><p>语法结构：</p><p>[修饰符列表] 返回值类型 方法名 (形参参数列表) {</p><p>​    方法体：</p><p>}</p><p>返回值类型可以是基本类型也可以是引用类型，当返回类型是viod时，方法体不能 使用 return 语句 返回值</p><p>修饰符列表 统一写成： public  static</p></blockquote><ol><li><p>对于方法的修饰符列表中有 static 关键字的：在方法体种调用时可以省略<strong>类名.</strong> </p></li><li><p>建议一个Java源文件当中只定义一个 class，清晰易读</p></li><li><p>方法的内存分配情况</p><p> <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230111111814126.png" alt="image-20230111111814126"></p></li></ol><h3 id="方法的重载"><a href="#方法的重载" class="headerlink" title="方法的重载"></a>方法的重载</h3><blockquote><p>同一个类中功能相似的方法可以共用同一个方法名，然后根据传入参数类型的不同来调用不同的方法</p></blockquote><p><strong>什么条件满足之后构成方法重载？</strong></p><ul><li>在同一个类</li><li>方法名相同</li><li>参数列表不同<ul><li>数量不同</li><li>顺序不同</li><li>类型不同</li></ul></li></ul><p><strong>方法重载和什么有关，和什么没有关系？</strong></p><ul><li>方法重载和方法名+参数列表有关系</li><li>方法重载和返回值类型无关</li><li>方法重载和修饰符无关</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OverloadTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> sum(<span class="number">1</span>, <span class="number">2</span>);<span class="comment">// 3</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">b</span> <span class="operator">=</span> sum(<span class="number">1.0</span>, <span class="number">2.0</span>);<span class="comment">// 3.0</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">c</span> <span class="operator">=</span> sum(<span class="number">1L</span>, <span class="number">2L</span>);<span class="comment">// 3L</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">sum</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> a, <span class="type">long</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法的递归"><a href="#方法的递归" class="headerlink" title="方法的递归"></a>方法的递归</h3><blockquote><p>方法自调用就是递归</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 乘法递归</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">chen</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * chen(--n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><blockquote><p>面向对象的三大特征：</p><ol><li>封装</li><li>继承</li><li>多态</li></ol><p>所有面向对象的编程语言都有这三大特征。</p><ol><li>面向对象的分析：OOA</li><li>面向对象的设计：OOD</li><li>面向对象的编程：OOP</li></ol></blockquote><h3 id="对象的创建和使用"><a href="#对象的创建和使用" class="headerlink" title="对象的创建和使用"></a>对象的创建和使用</h3><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230111154018456.png" alt="image-20230111154018456"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OOTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        通过一个类可以实例化N个对象</span></span><br><span class="line"><span class="comment">        语法： new 类名();</span></span><br><span class="line"><span class="comment">        new 运算符作用是创建对象，在JVM堆内存中开辟新的内存空间</span></span><br><span class="line"><span class="comment">        方法区内存：类加载时，class字节码代码片段被加载到该内存空间</span></span><br><span class="line"><span class="comment">        栈内存（局部变量）：方法代码执行时，会给该方法分配栈内存空间，压栈</span></span><br><span class="line"><span class="comment">        堆内存：new 的对象在堆内存中储存</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        Student 是个引用数据类型，s 是 变量，new Student() 是一个学生对象</span></span><br><span class="line"><span class="comment">        什么是引用？</span></span><br><span class="line"><span class="comment">        引用是一个变量，只不过这个变量中保存了另一个Java对象的内存地址</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        访问实例变量的语法格式：</span></span><br><span class="line"><span class="comment">        读取数据：引用.变量名</span></span><br><span class="line"><span class="comment">        修改数据：引用.变量名 = 值</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        不能直接通过 Student.no 访问</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        </span><br><span class="line">        s.no = <span class="number">10</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="comment">// 学号</span></span><br><span class="line">    <span class="type">int</span> no;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 姓名</span></span><br><span class="line">    String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 年龄</span></span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 性别</span></span><br><span class="line">    <span class="type">boolean</span> sex;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 住址</span></span><br><span class="line">    String addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">成员变量没有赋值，则赋默认值， 引用类型默认值为 null</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="空指针异常"><a href="#空指针异常" class="headerlink" title="空指针异常"></a>空指针异常</h3><blockquote><p>空引用访问“实例”相关数据一定会出现空指针异常</p><p>java.lang.NullPointerExption</p></blockquote><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><blockquote><p>封装的步骤：</p><ol><li><p>所有属性私有化，使用 private 关键字进行修饰，修饰的数据只能在本类中访问</p></li><li><p>对外提供简单的操作入口，如：读取和修改</p></li><li><p>set,get方法命名规范：</p><ul><li><p>public void setAge (int a) {</p><p>  ​    age = a;</p><p>  }</p></li><li><p>public int getAge () {</p><p>  ​    return age;</p><p>  }</p></li><li><p>调用：</p><p>  对于 有 static 修饰的方法采用 类名.方法名(实参)</p><p>  对于没有 static 修饰的方法采用 引用.方法名(实参)</p></li></ul></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;zhang san&quot;</span>;</span><br><span class="line">    <span class="comment">// 把属性设置私有化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> <span class="string">&quot;somewhere interesting&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><blockquote><ol><li><p>构造方法又被称为构造函数/构造器/Constructor</p></li><li><p>构造方法语法结构：</p><p> [修饰符列表] 构造方法名(形式参数列表) {</p><p> ​    构造方法体;</p><p> }</p></li><li><p>普通方法语法结构</p><p> [修饰符列表] 返回值类型 方法名(形式参数列表) {</p><p> ​    方法体;</p><p> }</p></li><li><p>当一个类没有定义构造方法，系统默认给该类提供一个无参构造函数，称 缺省构造器</p></li><li><p>构造方法除了 new 时调用，还可以手动调用 this()</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">int</span> year;</span><br><span class="line">    <span class="type">int</span> month;</span><br><span class="line">    <span class="type">int</span> day;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day )</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.year = year;</span><br><span class="line">        <span class="built_in">this</span>.month = month;</span><br><span class="line">        <span class="built_in">this</span>.day = day;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 无参数时调用次构造方法，默认设置日期 2020 12 12</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">2020</span>, <span class="number">12</span>, <span class="number">12</span>);<span class="comment">// 这种语法只能出现在构造函数第一行，类似于 super</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><h3 id="this-关键字"><a href="#this-关键字" class="headerlink" title="this 关键字"></a>this 关键字</h3><blockquote><p>关于Java中的this关键字</p></blockquote><ol><li><p>this是一个引用，this是一个变量，this变量中保存了内存地址指向自身，this存储在JVM堆内存Java对象内部</p></li><li><p>this 不能使用在带有static的方法中</p><p> 那么在 static 方法中怎么访问成员变量？</p><ul><li>方法中实例化对象获取引用访问</li><li>通过参数将实例传入</li><li>用 static 修饰成员变量，但在 非static 方法中不能用 this 访问只能用 <strong>类名.属性名</strong></li></ul></li></ol><h3 id="static-关键字"><a href="#static-关键字" class="headerlink" title="static 关键字"></a>static 关键字</h3><blockquote><p>静态变量：在类加载时就初始化，不需要创建对象<strong>内存</strong>就在<strong>方法区</strong>开辟了</p><ul><li><p>static 关键字修饰的 属性，方法代表 类级别的和具体对象无关。需要使用 类名调用,引用方式也能调用【不建议】</p></li><li><p>非 static 关键字修饰的 属性，方法 代表对象级别的。需要引用去调用</p></li></ul></blockquote><p>可以使用 static 关键字来定义 <strong>静态代码块</strong></p><p>1、语法格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    java 语句;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、静态代码在类加载时执行，并只执行一次</p><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><blockquote><p>关于Java 语言中的继承：</p></blockquote><ol><li><p>继承是面向对象的三大特征之一,三大特征分别是：封装，继承，多态</p></li><li><p>继承 <strong>“基本”</strong> 作用是：代码复用。但是继承 最重要 的作用是：有了继承才有以后”方法的覆盖”和多态机制。</p></li><li><p>继承语法格式：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[修饰符列表] class 类名 extends 父类名 &#123;</span><br><span class="line">类体 = 属性 + 方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Java 语言当中的继承只支持单继承，一个类不能同时继承很多类，只能继承一个类</p></li><li><p>关于继承中的一些术语：</p><p> B类继承A类，其中：</p><p> ​    A类称为：父类，基类、超类、superclass</p><p> ​    B类称为: 子类，派生类、subclass</p></li><li><p>Java语言中子类继承父类都继承哪些数据呢？</p><ul><li><p>私有的不支持</p></li><li><p>构造方法不支持</p></li><li><p>其他数据都支持</p></li></ul></li><li><p>虽然Java语言只支持单继承，但是一个类也可以简洁继承其他类，例如：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C <span class="keyword">extends</span> <span class="title class_">B</span> &#123;&#125;</span><br><span class="line">B <span class="keyword">extends</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line">A <span class="keyword">extends</span> <span class="title class_">T</span> &#123;&#125;</span><br><span class="line"><span class="comment">// C 直接继承B类，但是C类直接继承T、A类。</span></span><br></pre></td></tr></table></figure></li><li><p>Java语言中假设一个类没有显示的继承任何类，该类默认继承 JavaSE 库当中提供的 Java.lang.Object类。</p></li></ol><h3 id="方法的覆盖"><a href="#方法的覆盖" class="headerlink" title="方法的覆盖"></a>方法的覆盖</h3><blockquote><p>Java 语言中方法的重载的条件</p><ul><li>在同一个类当中</li><li>方法名相同</li><li>参数列表不同：类型，顺序，个数至少一个不同</li></ul><ol><li>方法重载和什么无关？<ul><li>和方法的而返回值类型无关</li><li>和方法修饰符列表无关</li></ul></li></ol></blockquote><blockquote><p>Java 语言中方法的覆盖</p><ol><li><p>方法覆盖在什么时候使用？</p><p> <strong>当父类方法无法满足子类的业务需求时，子类有必要重写聪父类继承的方法</strong></p></li><li><p>什么条件满足之后构成方法重载？</p><ul><li>方法覆盖发生在具有继承关系的父子类之间</li><li>返回值类型相同，方法名相同，形参列表相同</li><li>访问权限不能更低 【protected -&gt; public】</li><li>抛出异常不能更多，可以更少</li></ul></li><li><p>方法覆盖和什么无关？</p><ul><li>和方法的而返回值类型无关</li><li>和方法修饰符列表无关</li></ul></li></ol></blockquote><ol><li>私有方法不能继承，所以不能覆盖。</li><li>构造方法不能继承，所以不能覆盖。</li><li>静态方法不存在覆盖。因为是通过类名访问的，父子类名肯定不同</li><li>覆盖只针对方法，不谈属性</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法的覆盖</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"> <span class="comment">// 动物都是可以移动的</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;动物在移动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 猫科类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;猫在走猫步&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 抓老鼠</span></span><br><span class="line">    catchMouse() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;猫抓老鼠&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><blockquote><p>语法机制：</p><p>Cat 继承 Animal，Bird 继承 Animal。Cat 和 Bird 没有任何继承关系。</p><p>关于多态涉及的几个概念：</p><ul><li>向上转型<ul><li>子类型 –&gt; 父类型    自动类型转换</li></ul></li><li>向下转型 <ul><li>父类型 –&gt; 子类型    强制类型转换【加强制类型转换符】</li></ul></li><li>转型的前提是拥有继承关系</li></ul></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230112162203837.png" alt="image-20230112162203837"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();<span class="comment">// 向上转型，编译过，一定能运行</span></span><br><span class="line"></span><br><span class="line">a1.move();<span class="comment">// 猫在走猫步</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">编译不通过，</span></span><br><span class="line"><span class="comment">因为 a1 是 Animal类型，而Animal类型中不存在找老鼠方法。</span></span><br><span class="line"><span class="comment">此时想要调用 catchMouse 方法，需要将 a1 强制转换为 Cat.</span></span><br><span class="line"><span class="comment">向下转型：当调用的方法是子类特有的，父类中不存在的，必须进行向下转型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// a1.catchMouse();</span></span><br><span class="line"><span class="type">Cat</span> <span class="variable">c1</span> <span class="operator">=</span> (Cat)a2;</span><br><span class="line">c1.catchMouse();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">此语法编译通过，但是运行会异常</span></span><br><span class="line"><span class="comment">因为a1 实际引用是 Cat,而 Cat 与Bird 不存在任何继承关系，由此出现著名异常：</span></span><br><span class="line"><span class="comment">java.lang.ClassCastException</span></span><br><span class="line"><span class="comment">类型转换异常，这种异常总是在 &quot;向下转型的时候&quot;会发生。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">解决向下转型错误：</span></span><br><span class="line"><span class="comment">使用 instanceof 运算符 解决</span></span><br><span class="line"><span class="comment">语法格式：（引用 instanceof 数据类型名）</span></span><br><span class="line"><span class="comment">eg: a instanceof Animal</span></span><br><span class="line"><span class="comment">true: a这个引用指向对象是一个 Animal 类型</span></span><br><span class="line"><span class="comment">false: a这个引用指向对象不是一个 Animal 类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Bird b1 = (Bird)a1;// 向下转型，编译过，可能运行错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决：</span></span><br><span class="line"><span class="keyword">if</span>(a1 <span class="keyword">instanceof</span> Bird) &#123;</span><br><span class="line">    <span class="type">Bird</span> <span class="variable">b1</span> <span class="operator">=</span> (Bird)a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多态在实际开发中的作用："><a href="#多态在实际开发中的作用：" class="headerlink" title="多态在实际开发中的作用："></a>多态在实际开发中的作用：</h4><blockquote><p>分析： 主人喂养宠物这个场景需要经行类型抽象：</p><ul><li>主人【类】<ul><li>主人可以喂养宠物，所有主人都有这个动作</li></ul></li><li>宠物【类】<ul><li>宠物可以吃东西，所有宠物都有吃东西的这个动作</li></ul></li></ul></blockquote><ul><li>降低程序耦合度，提高程序扩展力，能使用多态尽量使用多态。父类型引用指向子类型对象</li></ul><p>核心： 面向抽象编程，不要面向具体编程</p><p>不使用多态</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主人类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Master</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    这种方式没有使用多态，每次加一个宠物就要新增一个方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fead</span> <span class="params">(Cat c)</span> &#123;</span><br><span class="line">        c.eat();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fead</span> <span class="params">(Dog c)</span> &#123;</span><br><span class="line">        c.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;猫在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;狗在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建主人</span></span><br><span class="line">        <span class="type">Master</span> <span class="variable">m1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Master</span>();</span><br><span class="line">        <span class="comment">// 创建猫</span></span><br><span class="line">        <span class="type">Cat</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">        <span class="comment">// 主人喂猫</span></span><br><span class="line">        m1.fead(c1);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建狗</span></span><br><span class="line">        <span class="type">Dog</span> <span class="variable">d1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        <span class="comment">// 主人喂狗</span></span><br><span class="line">        m1.fead(d1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用多态</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主人类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Master</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用多态，pet 是一个父引用</span></span><br><span class="line"><span class="comment">    耦合度低，扩展力强</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fead</span> <span class="params">(Ped pet)</span> &#123;</span><br><span class="line">        pet.eat();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 宠物类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;宠物在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Pet</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;猫在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Pet</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;狗在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Snake</span> <span class="keyword">extends</span> <span class="title class_">Pet</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span> <span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;蛇在吃饭饭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建主人</span></span><br><span class="line">        <span class="type">Master</span> <span class="variable">m1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Master</span>();</span><br><span class="line">        <span class="comment">// 主人喂猫</span></span><br><span class="line">        m1.fead(<span class="keyword">new</span> <span class="title class_">Cat</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 主人喂狗</span></span><br><span class="line">        m1.fead(<span class="keyword">new</span> <span class="title class_">Dog</span>());</span><br><span class="line">        </span><br><span class="line">     <span class="comment">// 主人喂蛇</span></span><br><span class="line">        m1.fead(<span class="keyword">new</span> <span class="title class_">Snake</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="finall-关键字"><a href="#finall-关键字" class="headerlink" title="finall 关键字"></a>finall 关键字</h3><blockquote><p>表示最终的，不可变的。跟 js 中 const 作用有点类似</p><ul><li>final 修饰的类无法被继承</li><li>final 修饰的方法无法被覆盖</li><li>final 修饰的变量一旦赋值，不可重新赋值</li><li>final 修饰的实例变量必须手动赋值，不能默认赋值</li><li>final 修饰的引用虽然指向某个对象之后不能指向其他对象，但是所指向的对象内部的内存是可以被修改的</li><li>final 修饰的实例变量，一般和static联合使用，被称为常量</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">finalTest</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    成员变量又默认赋值 + final 修饰的变量一旦赋值就不能重新赋值</span></span><br><span class="line"><span class="comment">    所以下面语法就是默认值0，不能再重新赋值，变量就没有意义</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    <span class="comment">// final int age; // 编译错误</span></span><br><span class="line">    <span class="comment">// 正确写法1</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正确写法2</span></span><br><span class="line">    <span class="keyword">final</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">finalTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 上边两种写法本质是一样的，变量的赋值就发生在构造函数执行</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java 内置的 String 方法为最终方法不能被继承，覆盖，赋值</span></span><br><span class="line"><span class="comment">// 编译错误</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">myString</span> <span class="keyword">extends</span> <span class="title class_">String</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="package，important"><a href="#package，important" class="headerlink" title="package，important"></a>package，important</h3><blockquote><p>包又称为package吗Java 中引入这种语法机制主要是为了方便程序员的管理。不同功能的类被分门别类放到不同的软件包当中，查找比较方便，管理比较方便，易维护。</p></blockquote><h4 id="怎么定义-package？"><a href="#怎么定义-package？" class="headerlink" title="怎么定义 package？"></a><strong>怎么定义 package？</strong></h4><ul><li><p>在Java 源程序的第一行上编写 package 语句。</p></li><li><p>package 只能编写一个语句</p></li><li><p>语法结构：</p><p>  package 包名；</p></li></ul><h4 id="包名的命名规范："><a href="#包名的命名规范：" class="headerlink" title="包名的命名规范："></a><strong>包名的命名规范：</strong></h4><ul><li><p>公司域名倒序 + 项目名 + 模块名 + 功能名；</p></li><li><p>采用这种方式重名概率较低。因为公司域名具有全球唯一性。</p></li><li><p>包名要求全部小写，包名也是标识符，必须遵守命令规则</p></li><li><p>一个包将来对应一个目录</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjpowernode.javase.day11.Test01;</span><br></pre></td></tr></table></figure><p>使用 package 机制后，<strong>java 类名</strong> 中类名 不再是 文件名。而是 com.bjpowernode.javase.day11.Test01;</p><p>编译后 需要创建对应目录：com/javase/day11/Test01.class</p><p><strong>另一种方式（编译+运行）</strong></p><ul><li><p>javac -d 编译之后存放路径 Java 源文件的路径</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg: 将 F:\Hello.java 文件编译后存放到 C:\com 目录下</span></span><br><span class="line">javac -d C:\com F:\Hello.java</span><br></pre></td></tr></table></figure></li><li><p>将当前路径中 *.java 编译之后放到 c:\目录下</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JVM 的类加载器 ClassLoader 默认聪当前路径下加载</span></span><br><span class="line">javac -d . *.java</span><br></pre></td></tr></table></figure></li></ul><h4 id="import"><a href="#import" class="headerlink" title="import"></a>import</h4><blockquote><p>当前类中访问其他不同当前目录的的程序时，需要使用import导入其他包中的程序</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.bjpowernode.javase.test002.Cat;</span><br><span class="line"><span class="comment">// 导入 javase 目录 下 test002 包 中的 Cat 类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略写法，表示导入包com.bjpowernode.javase.test002在这个文件中使用到的所有类，不用考虑性能问题</span></span><br><span class="line"><span class="keyword">import</span> com.bjpowernode.javase.test002.*</span><br></pre></td></tr></table></figure><h3 id="控制访问权限修饰符"><a href="#控制访问权限修饰符" class="headerlink" title="控制访问权限修饰符"></a>控制访问权限修饰符</h3><blockquote><p>访问控制权限修饰符来控制元素访问范围</p></blockquote><p><strong>访问控制权限修饰符包括：</strong></p><ul><li>public    表示公开的，在任何位置都可以访问</li><li>protected  同包下，子类中可以访问</li><li>缺省  同包下可以访问</li><li>private  表示私有的，只能在本类中访问</li></ul><p>范围从大到小排序： public &gt; protected &gt; 默认 &gt; private</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 受保护的</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 缺省</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 私有的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&quot;privateC&quot;</span>;</span><br><span class="line">    <span class="comment">// 公开的</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">1.0f</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>类，接口 只能采用 public 和缺省的修饰符进行修饰。【内部类除外】</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>属性 （四个都能用）</p><p>方法 （四个都能用）</p><h3 id="super-关键字"><a href="#super-关键字" class="headerlink" title="super 关键字"></a>super 关键字</h3><blockquote><p>关键字，全小写</p><p>与 this 对比</p><p>this:</p><p>目的：调用本类的方法</p><ul><li>this 能出现在实例构造方法</li><li>this 的语法是：”this.” ,”this()”【this() 只能出现在构造方法第一行，目的是构造方法代码复用，通用调用本类其他构造方法】</li><li>this 不能在静态方法中使用</li><li>this 大部分情况可以省略（在区分局部变量和成员变量时不能省略）</li></ul><p>super:</p><p>目的：创建子类对象的时候，先初始化父类型的特征</p><ul><li>super 能出现在实例构造方法和构造方法中</li><li>super 的语法是：”this.” ,”this()”</li><li>super 不能在静态方法中使用</li><li>super 只能出现在构造方法第一行，通过当前方法去调用<strong>父类</strong>中其他的构造方法，目的是：代码复用</li></ul><p><strong>this() 和 super() 不能共存</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">superTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> viod <span class="title function_">main</span><span class="params">(Stirng[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建子类对象</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">C</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="comment">// 建议手动将一个类的无参构造方法写出来</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// super(); // 这里也是默认的构造方法写出来</span></span><br><span class="line">        System.out.println(<span class="string">&quot;A 类的无参构造方法&quot;</span>);<span class="comment">//1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">B</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B类的无参数构造方法&quot;</span>);<span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B类的有参数构造方法（String）&quot;</span>);<span class="comment">//3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">extends</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">C</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="string">&quot;zhanggsan&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;C 类的无参数构造方法&quot;</span>);<span class="comment">//4</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">C</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(name, <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;C类的有参数构造方法（String）&quot;</span>);<span class="comment">//5</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">C</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        System.out.println(<span class="string">&quot;C类的有参数构造方法（String, int）&quot;</span>);<span class="comment">//6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行顺序</span></span><br><span class="line"><span class="number">13654</span></span><br></pre></td></tr></table></figure><p><strong>调用子类构造方法必然调用父类构造方法</strong></p><p><strong>在Java语言中不管是new什么对象，最后老祖宗的Object类的无参构造方法（处于栈顶部，最后调用，最先结束）一定会执行</strong></p><h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><blockquote><ol><li><p>什么是抽象类？</p><p> 类和类之间具有共同特征，将这些共同特征提取出来，形成的就是抽象类。</p><p> 类本身是不存在的，所以抽象类无法创建对象《无法实例化》</p></li><li><p>抽象类属于什么类型？</p><p> 抽象类也属于引用数据类型。</p></li><li><p>抽象类怎么定义？</p><p> 语法：</p><p> ​    [修饰符列表] abstract class 类名 {</p><p> ​        类体;</p><p> ​    }</p></li><li><p>抽象类无法实例化，无法创建对象，所有它是用来被子类继承的</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 银行账户类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类继承抽象类，子类可以实例化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditAccount</span> extend Account &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象类的子类也可以是抽象的类</span></span><br><span class="line"><span class="comment">//abstract class CreditAccount extend Account &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="type">CreditAccount</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreditAccount</span>();</span><br></pre></td></tr></table></figure></li><li><p>由于final修饰的类不能被继承，所以 final与abstract不能同时出现</p></li><li><p>抽象类有构造方法，这个方法提供给子类使用</p></li><li><p>抽象方法：表示没有实现的方法，没有方法体的方法</p><p> 特点：</p><ul><li>没有方法体，以分号结尾</li><li>前面有 abstract 关键字</li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">dosome</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>抽象类中不一定有抽象方法，抽象方法必须出现在抽象类中</p></li><li><p>非抽象子类继承抽象类时，会继承抽象方法。但抽象方法只能出现在抽象类中。所以要把子类改为抽象的，或者重写这个继承的抽象方法（也可以叫<strong>实现</strong>）避免编译出错</p><p> <strong>一个非抽象类继承一个抽相类，非抽象类必须要将抽象方法实现</strong></p><p> 面向抽象编程：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动物抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// 抽象方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="comment">// 实现抽象方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;鸟儿在飞！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AbstractTest02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 多态：编译是一种状态，运行是另一种状态</span></span><br><span class="line">        <span class="comment">// 父类型引用指向子类型对象</span></span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bird</span>();<span class="comment">// 向上转型</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230130154911339.png" alt="image-20230130154911339"></p><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><blockquote><ol><li><p>接口也是一种引用数据类型</p></li><li><p>接口也是完全抽象的（抽象类是半抽象）或者也可以说接口是特殊的抽象类</p></li><li><p>接口怎么定义，语法是什么？</p><p> [修饰符列表] interface 接口名 {}</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">C</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>接口支持多继承，一个接口可以继承多个接口</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">D</span> <span class="keyword">extends</span> <span class="title class_">A</span>,B,C &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>接口中只包含两个部分内容，<strong>常量和抽象方法</strong></p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="comment">// 省略写法</span></span><br><span class="line">    <span class="comment">// int sum(int a, int b);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>接口中的抽象方法都是公开的</p></li><li><p>接口中的方法都是抽象方法，所以接口中方法都不能有方法体</p></li><li><p>接口中的常量不能被修改</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">PI</span> <span class="operator">=</span> <span class="number">3.1415926</span>;</span><br><span class="line">    <span class="comment">// 省略写法</span></span><br><span class="line">    <span class="comment">// double PI = 3.1415926;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><h3 id="接口的基础语法"><a href="#接口的基础语法" class="headerlink" title="接口的基础语法"></a><strong>接口的基础语法</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">FF</span> <span class="operator">=</span> <span class="number">3.1415926</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>类和类之间叫做继承，类和接口之间叫做实现（也可以看作”继承“）</p><p> 继承使用 extends 关键字</p><p> 实现使用 implements 关键字</p></li><li><p>当一个<strong>非抽象的类</strong>实现接口的话，必须将接口中所有方法实现</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mian</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 面向接口编程</span></span><br><span class="line">        <span class="type">MyMath</span> <span class="variable">mm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyMathImpl</span>();</span><br><span class="line">        mm.sum(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMathImpl</span> <span class="keyword">implements</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>一个类可以实现多个接口</p><p> 这种机制弥补了Java类只支持单继承带来的缺陷</p></li><li><p>类型转换</p><p> 向下转型养成好习惯，先用 instanceof 判断</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">D</span>();</span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">D</span>();</span><br><span class="line">        <span class="type">C</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">D</span>();</span><br><span class="line">        <span class="comment">// 多态</span></span><br><span class="line">        <span class="type">B</span> <span class="variable">b2</span> <span class="operator">=</span> (B)a;</span><br><span class="line">        <span class="comment">// 接口 E，D 没有继承关系，强转时编译不会出错，但是运行时可能出现 ClassCastException 异常</span></span><br><span class="line">        <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (B)a;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">C</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">E</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">D</span> <span class="keyword">extends</span> <span class="title class_">A</span>,B,C &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>继承和实现同时存在</p><p> 先继承，再实现。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;\</span><br><span class="line">        <span class="comment">// 多态</span></span><br><span class="line">        <span class="type">Flyable</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插拔的是接口，通常提取的是行为动作</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 给猫插上翅膀</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="接口在开发中的作用"><a href="#接口在开发中的作用" class="headerlink" title="接口在开发中的作用"></a>接口在开发中的作用</h3><blockquote><p>注意：接口在开发中的作用类似于多态在开发中的作用</p><p>强制转换过程中，如果是类转换成接口，那么类和接口之间可以没有继承关系</p><p>多态：面向抽象编程，不要面向具体编程。降低程序耦合度。提高程序拓展力。</p><p>面向接口编程少不了多态（接口+多态才可以达到降低耦合）</p><p>任何一个接口都有调用者和实现者，解耦合是指接触调用者和实现者的耦合</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顾客</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    FoodMenu foodmenu;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">(FoodMenu fm)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.foodmenu = fm;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 点菜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.foodmenu.shiZiChaoJiDan();</span><br><span class="line">        <span class="built_in">this</span>.foodmenu.yuXaingRouSi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 菜单</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">FoodMenu</span> &#123;</span><br><span class="line">    <span class="comment">// 西红柿炒鸡蛋</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shiZiChaoJiDan</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 鱼香肉丝</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">yuXaingRouSi</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 厨师</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChinaCooker</span> <span class="keyword">implements</span> <span class="title class_">FoodMenu</span> &#123;</span><br><span class="line">    <span class="comment">// 西红柿炒鸡蛋</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shiZiChaoJiDan</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中餐厨师做的西红柿炒鸡蛋&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 鱼香肉丝</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">yuXaingRouSi</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中餐厨师做的鱼香肉丝&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AmericCooker</span> <span class="keyword">implements</span> <span class="title class_">FoodMenu</span> &#123;</span><br><span class="line">    <span class="comment">// 西红柿炒鸡蛋</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shiZiChaoJiDan</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;西餐厨师做的西红柿炒鸡蛋&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 鱼香肉丝</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">yuXaingRouSi</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;西餐厨师做的鱼香肉丝&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建厨师</span></span><br><span class="line">        <span class="type">FoodMenu</span> <span class="variable">cc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChinaCooker</span>();</span><br><span class="line">        <span class="comment">// 创建顾客</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">cm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>(cc);</span><br><span class="line">        cm.order();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类型和类型之间的关系"><a href="#类型和类型之间的关系" class="headerlink" title="类型和类型之间的关系"></a>类型和类型之间的关系</h3><blockquote><p>is a, has a, like a</p><ul><li><p>is a: </p><p>  Cat is a Animal（猫是一个动物）</p><p>  凡是满足 is a 的表示 <strong>继承关系</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">extends</span> <span class="title class_">B</span></span><br></pre></td></tr></table></figure></li><li><p>has a:</p><p>  I has a Pen （我有一支笔）</p><p>  凡是能满足 has a 关系的表示 <strong>关联关系</strong></p><p>  关联关系通常以”属性“的形式存在</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A &#123;</span><br><span class="line">    B b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>like a:</p><p>  Cooker like a FoodMemu （厨师像一个菜单一样）</p><p>  凡是能满足 like a 关系的表示 <strong>实现关系</strong></p><p>  实现关系通常是： 类实现接口</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A <span class="keyword">implements</span> <span class="title class_">B</span>;</span><br></pre></td></tr></table></figure></li></ul></blockquote><h3 id="抽象类和接口有什么区别？"><a href="#抽象类和接口有什么区别？" class="headerlink" title="抽象类和接口有什么区别？"></a>抽象类和接口有什么区别？</h3><blockquote><p>抽象类是半抽象的，接口是完全抽象的</p><p>抽象类中没有构造方法，接口中没有构造方法</p><p>接口之间可以多继承，类之间只能单继承</p><p>一个类可以同时实现多个接口，一个抽象类只能继承一个类</p></blockquote><h2 id="开发工具-IDE使用"><a href="#开发工具-IDE使用" class="headerlink" title="开发工具 IDE使用"></a>开发工具 IDE使用</h2><blockquote><p>快捷键：</p><p>生成<strong>main</strong>方法： psvm</p><p>生成 打印语句：sout</p><p>删除一行：Ctrl + Y</p><p>编辑窗口变大变小：Ctrl + shift + F12</p><p>显示隐藏项目树：alt + 1</p><p>新增/新建/添加快捷键： alt + insert</p><p>tab 页切换： alt + 左右箭头</p><p>运行：Ctrl + shift + F10</p><p>纠错： alt + 回车</p></blockquote><h2 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h2><blockquote><p>UML 是一种统一建模语言，一种图标式语言，我们可以通过UML来描述一下继承结构。 就像是建筑师的设计图纸</p></blockquote><h2 id="源码及API文档"><a href="#源码及API文档" class="headerlink" title="源码及API文档"></a>源码及API文档</h2><h3 id="JDK-类库的根类：Object"><a href="#JDK-类库的根类：Object" class="headerlink" title="JDK 类库的根类：Object"></a>JDK 类库的根类：Object</h3><blockquote><p>这些方法是所有子类通用的，任何一个类默认继承object，计算没有直接继承，最终也会默认继承。</p></blockquote><p>有哪些常用的文档？</p><ol><li>去源代码查看 【C:\Program Files\Java\jdk1.8.0_321\src】</li><li>去查阅Java类库帮助文档</li></ol><h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h4><blockquote><p>返回对象的字符串表示形式。类名+@+16进制对象哈希码</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getClass().getName() + <span class="string">&#x27;@&#x27;</span> + Integer.toHexString(hashCode())</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">obj.toString()</span><br></pre></td></tr></table></figure><h4 id="equals"><a href="#equals" class="headerlink" title="equals"></a>equals</h4><blockquote><p>指示一些其他对象是否等于此对象。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span> === obj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">obj1.equals(obj2);</span><br></pre></td></tr></table></figure><p>默认是通过 == 判断是否相等，== 是判断两个Java对象的内存地址。如果我们需要判断两个对象内容相同则需要重写 equals 方法</p><h4 id="finalize"><a href="#finalize" class="headerlink" title="finalize"></a>finalize</h4><blockquote><p>垃圾回收器负责调用,此方法不需要调用，只要重写即可。带系统执行垃圾回收时会触发这个方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;即将被销毁！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如：当 </span></span><br><span class="line"><span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p = <span class="literal">null</span>; <span class="comment">// 此时会触发 p.finalize()</span></span><br><span class="line"></span><br><span class="line">System.gc();<span class="comment">// 手动触发垃圾回收</span></span><br></pre></td></tr></table></figure><p>java 中的垃圾回收机制不会轻易启动，jdk9版本后废弃了</p><h4 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h4><blockquote><p>对象的克隆</p></blockquote><h4 id="hashCode"><a href="#hashCode" class="headerlink" title="hashCode"></a>hashCode</h4><blockquote><p>获取对象哈希值的一个方法，返回值是经过哈希算法转换的数字，等同于内存地址</p></blockquote><h3 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h3><blockquote><p><strong>也叫做局部内部类。不推荐使用，但是要看懂别人写的</strong></p><ol><li><p>什么是内部类？</p><p> 在类的内部又重新定义了一个类，被称为内部类</p></li><li><p>内部类的分类</p><ul><li>静态内部类：类似于静态变量</li><li>实例内部类：类似于实例变量</li><li>局部内部类：类似于局部变量</li></ul></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">// 静态内部类</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Inner1</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 实例内部类</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner2</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 局部内部类</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Inner3</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化内部类</span></span><br><span class="line"><span class="comment">// new Test().new Inner2();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 负责计算的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Compute</span> &#123;</span><br><span class="line">    <span class="comment">// 抽象方法啊</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">sum</span> <span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算的接口需要实现类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputeImpl</span> <span class="keyword">implements</span> <span class="title class_">Compute</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sum</span> <span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数学类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sum</span><span class="params">(Compute c, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rs</span> <span class="operator">=</span> c.sum(x, y);</span><br><span class="line">        System.out.println(<span class="string">&quot;计算结果:&quot;</span> + rs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> voidd <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyMath</span> <span class="variable">mm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyMath</span>();</span><br><span class="line">        </span><br><span class="line">        mm.sum(<span class="keyword">new</span> <span class="title class_">ComputeImpl</span>(), <span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匿名内部类可以省略 计算的接口需要实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 负责计算的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Compute</span> &#123;</span><br><span class="line">    <span class="comment">// 抽象方法啊</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">sum</span> <span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数学类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyMath</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sum</span><span class="params">(Compute c, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rs</span> <span class="operator">=</span> c.sum(x, y);</span><br><span class="line">        System.out.println(<span class="string">&quot;计算结果:&quot;</span> + rs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> voidd <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyMath</span> <span class="variable">mm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyMath</span>();</span><br><span class="line">        <span class="comment">// 使用匿名内部类, 看似是接口可以 new 了，实际上是后面的括号中实现了方法。 【不推荐使用，不能复用，结构不清晰】</span></span><br><span class="line">        mm.sum(<span class="keyword">new</span> <span class="title class_">Compute</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sum</span> <span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> a + b;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><blockquote><ul><li><p>Java 语言中的数组属于引用数据类型。父类是 Object</p></li><li><p>可以储存 任意数据类型。储存在堆内存，引用类型在数组中存储的是引用 内存地址</p></li><li><p>数组分类：一维，二维，三维，多维数组</p></li><li><p>数组中元素的类型要求统一【装苹果的数组就不能装香蕉】</p></li></ul><p>优点：</p><ol><li>检索数据效率最快</li><li>元素类型相同，所以占用空间相同</li><li>储存空间是连续的</li></ol><p>缺点：</p><ul><li>随机增删元素，会影响后边元素向前或向后移动，效率低【对数组最后一个元素增删无影响】</li><li>内存中连续的大空间少。无法存储大数据</li></ul></blockquote><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义</span></span><br><span class="line"><span class="type">int</span>[] arrar1;</span><br><span class="line"><span class="type">double</span>[] arrar1;</span><br><span class="line"><span class="type">boolean</span>[] arrar1;</span><br><span class="line">Object[] arrar1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="type">int</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="comment">// 初始化6个长度的String类型数组,默认值为 null</span></span><br><span class="line">String[] array1 = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= array.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 下标越界异常： ArrayIndexOutOfBoundsException</span></span><br><span class="line">    array[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传参</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">test(array); <span class="comment">// √</span></span><br><span class="line">test(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;);<span class="comment">// ×</span></span><br><span class="line">test(<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>]);<span class="comment">// √</span></span><br><span class="line">test(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;);<span class="comment">// √</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="主函数-main-的参数"><a href="#主函数-main-的参数" class="headerlink" title="主函数 main 的参数"></a>主函数 main 的参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> voidd <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">java Test 参数<span class="number">1</span> 参数<span class="number">2</span> ...</span><br></pre></td></tr></table></figure><h4 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h4><blockquote><p>数组长度一旦确定就不可变，那数组满了怎么办？</p><p>java中的方式：先建一个大容量数组，再将小容量数组中数组一个一个拷贝过去</p><p>结论：效率低，少用</p></blockquote><p>数组拷贝方法：</p><p><strong>System.arraycopy(src, srcPos, dest, destPos, length)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a1 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">System.arraycopy(a1,<span class="number">0</span>,a2,<span class="number">0</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(a2[<span class="number">0</span>]+ <span class="string">&quot;&quot;</span> +a2[<span class="number">1</span>]+ <span class="string">&quot;&quot;</span> +a2[<span class="number">2</span>]+ <span class="string">&quot;&quot;</span> +a2[<span class="number">3</span>]+ <span class="string">&quot;&quot;</span> +a2[<span class="number">4</span>]+ <span class="string">&quot;&quot;</span> +a2[<span class="number">5</span>]);</span><br></pre></td></tr></table></figure><h4 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] a = &#123;</span><br><span class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="数组的工具方法"><a href="#数组的工具方法" class="headerlink" title="数组的工具方法"></a>数组的工具方法</h4><blockquote><p>java.utils.Arrays</p><p>常用的方法，sort, binarySearch【二分法查找】</p></blockquote><ul><li><p>binarySearch()</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回对应下标，没有返回 -1</span></span><br><span class="line">Arrays.binarySearch(数组, 查找的值);</span><br></pre></td></tr></table></figure></li><li><p>sort()</p></li></ul><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><blockquote><ul><li>双引号括起来的都是String对象</li><li>字符串不可变，不能修改</li><li>JDK中字符串都是直接存储在<strong>方法区</strong>的<strong>字符串常量池</strong>当中【垃圾回收机制不会回收常量池数据】</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">一共创建了三个对象：</span></span><br><span class="line"><span class="comment">字符串常量池 ： &quot;hello&quot;</span></span><br><span class="line"><span class="comment">堆内存: s1,s2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="常用构造方法："><a href="#常用构造方法：" class="headerlink" title="常用构造方法："></a>常用构造方法：</h4><ol><li><p>```java<br> String s = new String(“”)</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```java</span><br><span class="line">String s = &quot;&quot;</span><br></pre></td></tr></table></figure></li><li><p>```java<br> String s = new String(char数组)</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ```java</span><br><span class="line">String s = new String(char数组,起始下标,长度)</span><br></pre></td></tr></table></figure></li><li><p>```java<br> String s = new String(byte数组)</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. ```java</span><br><span class="line">String s = new String(byte数组,起始下标,长度)</span><br></pre></td></tr></table></figure></li></ol><h4 id="chartAt"><a href="#chartAt" class="headerlink" title="chartAt"></a>chartAt</h4><blockquote><p>返回指定索引处的 char 值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;中国人&quot;</span>.charAt(<span class="number">1</span>);<span class="comment">// 国</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="compareTo"><a href="#compareTo" class="headerlink" title="compareTo"></a>compareTo</h4><blockquote><p>按照字典（ascll码表值）顺序去比较字符串大小.</p><p>前小后大: -1</p><p>前后一致：0</p><p>前大后小：1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;abc&quot;</span>.compareTo(<span class="string">&quot;abce&quot;</span>); <span class="comment">// -1</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="contains"><a href="#contains" class="headerlink" title="contains"></a>contains</h4><blockquote><p>是否包含某字符串</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Hello java&quot;</span>.contains(<span class="string">&quot;java&quot;</span>);<span class="comment">// true</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="endsWith"><a href="#endsWith" class="headerlink" title="endsWith"></a>endsWith</h4><blockquote><p>是否以某字符串结尾</p></blockquote><h4 id="equalsIgnoreCase"><a href="#equalsIgnoreCase" class="headerlink" title="equalsIgnoreCase"></a>equalsIgnoreCase</h4><blockquote><p>忽略大小写的比较字符串相等</p></blockquote><h4 id="getBytes"><a href="#getBytes" class="headerlink" title="getBytes"></a>getBytes</h4><blockquote><p>将字符串对象转为字节数组</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytes = <span class="string">&quot;abcde&quot;</span>.getBytes();</span><br></pre></td></tr></table></figure></blockquote><h4 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty"></a>isEmpty</h4><blockquote><p>判断某个字符串是否为空</p></blockquote><h4 id="toChartArray"><a href="#toChartArray" class="headerlink" title="toChartArray"></a>toChartArray</h4><blockquote><p>将字符串转换为char数组</p></blockquote><h4 id="valueOf-NaN"><a href="#valueOf-NaN" class="headerlink" title="valueOf"></a>valueOf</h4><blockquote><p>底层调用 toString()</p></blockquote><h4 id="indexOf-lastIndexOf"><a href="#indexOf-lastIndexOf" class="headerlink" title="indexOf,lastIndexOf"></a>indexOf,lastIndexOf</h4><blockquote><p>某个字符串在当前字符串中第一次/最后一次出现的下标索引</p></blockquote><h3 id="stringBuffer"><a href="#stringBuffer" class="headerlink" title="stringBuffer"></a>stringBuffer</h3><blockquote><p>stringBuider 与 stringBuffer 都可以拼接字符串，区别在于前者是线程安全的，后者不是</p><p>用 + 拼接字符串会导致方法区字符串常量池创建多个对象。造成空间浪费</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个初始化容量为16个byte[] 数组。（字符串缓冲区），创建时可以估计给一个容量（字节）</span></span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="number">50</span>);</span><br><span class="line"><span class="comment">// append 追加字符串底层会扩容</span></span><br><span class="line">sb.append(<span class="string">&quot;我是&quot;</span>);</span><br><span class="line">sb.append(<span class="number">300</span>);</span><br><span class="line">System.out.println(sb);<span class="comment">// 我是300</span></span><br></pre></td></tr></table></figure><h3 id="包装类"><a href="#包装类" class="headerlink" title="包装类"></a>包装类</h3><blockquote><p>Java为8中数据类型提供了8种包装类，父类是Object。</p><p>包装类可以将基本数据类型包装成对象</p></blockquote><table><thead><tr><th>基本数据类型</th><th>包装类型</th></tr></thead><tbody><tr><td>byte</td><td>java.lang.Byte（父类Number）</td></tr><tr><td>short</td><td>java.lang.Short（父类Number）</td></tr><tr><td>int</td><td>java.lang.<strong>Integer</strong>（父类Number）</td></tr><tr><td>long</td><td>java.lang.Long（父类Number）</td></tr><tr><td>float</td><td>java.lang.Float（父类Number）</td></tr><tr><td>double</td><td>java.lang.Double（父类Number）</td></tr><tr><td>boolean</td><td>java.lang.Boolean（父类Object）</td></tr><tr><td>char</td><td>java.lang.<strong>Character</strong>（父类Object）</td></tr></tbody></table><p>包装类还提供了各种类型的拆箱方法，将包装类转为基本数据类型。不过后面都废弃了，jdk1.5后支持了自动装箱拆箱</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动装箱</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">// 手动拆箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ii</span> <span class="operator">=</span> i.intValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动装箱</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="comment">// 自动拆箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> x;</span><br></pre></td></tr></table></figure><p>java 中为了提高程序效率，将 [-128, 127]数字提前包装创建好了，所以这个区间的的数据不在需要new,直接从常量池中获取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">a == b;<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">x == y;<span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="Number-常用方法"><a href="#Number-常用方法" class="headerlink" title="Number 常用方法"></a>Number 常用方法</h3><ul><li>parseInt    转整形</li><li></li></ul><h3 id="日期处理"><a href="#日期处理" class="headerlink" title="日期处理"></a>日期处理</h3><blockquote><p>java.utils.Date 对象</p><p>格式化时间的库：java.text.SimpleDateFormat</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">yyyy 年</span></span><br><span class="line"><span class="comment">MM月</span></span><br><span class="line"><span class="comment">dd日</span></span><br><span class="line"><span class="comment">HH时</span></span><br><span class="line"><span class="comment">mm分</span></span><br><span class="line"><span class="comment">ss秒</span></span><br><span class="line"><span class="comment">sss毫秒</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Date -&gt; String</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss:sss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> format.format(dt);</span><br><span class="line">System.out.println(time);<span class="comment">// 2023-02-02 09:27:32:032</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String -&gt; date</span></span><br><span class="line"><span class="type">String</span> <span class="variable">dateTime</span> <span class="operator">=</span> <span class="string">&quot;2022-12-12 12:12:12&quot;</span>;</span><br><span class="line"><span class="comment">// 此处格式要和字符串日期格式相同</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">rs</span> <span class="operator">=</span> f2.parse(dateTime);</span><br><span class="line">System.out.println(rs);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间戳 -&gt; Date</span></span><br><span class="line"><span class="type">int</span> <span class="variable">timestamp</span> <span class="operator">=</span> <span class="number">1675302056747</span>;</span><br><span class="line"><span class="type">Date</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(timestamp);</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss:sss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">ddd</span> <span class="operator">=</span> format1.format(dt1);</span><br><span class="line">System.out.println(<span class="string">&quot;ddd = &quot;</span> + ddd);<span class="comment">// 2023-02-02 09:40:56:056</span></span><br></pre></td></tr></table></figure><h3 id="数字格式化"><a href="#数字格式化" class="headerlink" title="数字格式化"></a>数字格式化</h3><blockquote><p>java.text.DecimalFormat 类</p><p>格式：</p><p>#：代表任意数字</p><p>,：代表千分位</p><p>.：代表小数点</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">xx</span> <span class="operator">=</span> <span class="number">10023.222502056</span>;</span><br><span class="line"><span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;###,###.###&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">rr</span> <span class="operator">=</span> df.format(xx);</span><br><span class="line">System.out.println(rr);<span class="comment">// 10,023.223</span></span><br></pre></td></tr></table></figure><h3 id="高精度-BigDecimal"><a href="#高精度-BigDecimal" class="headerlink" title="高精度 BigDecimal"></a>高精度 BigDecimal</h3><blockquote><p>BigDecimal 属于大数据，精度极高。专门用在财务软件当中</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">bd1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">bd2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// +</span></span><br><span class="line">bd1.add(bd2);</span><br><span class="line"><span class="comment">// 运算都提供了自己的方法</span></span><br></pre></td></tr></table></figure><h3 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h3><blockquote><p>产生一个int类型取值范围内的数字</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"><span class="comment">// 下一个int 类型的数据是101，表示只能取到100</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> random.nextInt(<span class="number">101</span>);</span><br></pre></td></tr></table></figure><h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><blockquote><p>枚举编译之后也是生成 class 文件</p><p>枚举是一种引用类型</p><p>当一个方法返回结果超过两种且可以一一列举的情况建议使用枚举</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Season</span> &#123;</span><br><span class="line">    CHUN,XIA,QIU,DONG</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="异常机制"><a href="#异常机制" class="headerlink" title="异常机制"></a>异常机制</h3><blockquote><p>当Java程序运行出现不正常的情况时，Java语言会把程序的异常信息输出到控制台。供程序员参考，以对程序经行修改</p><p>所有异常都发生在运行阶段</p></blockquote><h4 id="异常声明"><a href="#异常声明" class="headerlink" title="异常声明"></a>异常声明</h4><p>java 内置了异常类，可以通过 创建异常对象 再抛出使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ArithmeticExcepetion</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArithmeticExcepetion</span>(<span class="string">&quot;异常信息&quot;</span>);</span><br><span class="line"><span class="keyword">throw</span> error;</span><br></pre></td></tr></table></figure><h4 id="异常的处理"><a href="#异常的处理" class="headerlink" title="异常的处理"></a>异常的处理</h4><blockquote><p>如果这个方法你想让调用者处理标错就throws，否则就 try catch</p></blockquote><ol><li><p>try catch 捕获异常并处理</p><ul><li>catch 后边小括号中得了类型可以是具体类型，也可以是父类型</li><li>catch 可以写多个。便于精确处理</li><li>编写多个catch 时，捕获错误要从小到大</li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">   <span class="comment">// return 语句再方法中肯定是 最后执行的，finall 会在return 前执行，不会影响return 的值     </span></span><br><span class="line">   <span class="keyword">return</span> 语句</span><br><span class="line">&#125; <span class="keyword">catch</span>(错误<span class="number">1</span>|错误<span class="number">2</span>|错误<span class="number">3</span> e) &#123;</span><br><span class="line">    <span class="comment">// 多个错误声明 是 jdk8 新特性</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用此方法，会在控制台打印异常详情，建议使用</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// 除非 System.exit(0); 推出JVM虚拟机。否则 此处代码一定会执行</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方法声明位置上，使用 throws 关键字，抛给上一级</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args)</span> &#123;</span><br><span class="line">        doSome();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span> <span class="keyword">throws</span> 异常<span class="number">1</span>,异常<span class="number">2</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rs</span> <span class="operator">=</span> a/b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h4><blockquote><p>业务中的异常很多，内置异常不满足。此时需要自定义异常。</p><p><strong>自定义异常一定要抛出去让调用者处理，否者没有意义</strong></p><p>异常的应用是代替 return 字符串错误提示</p></blockquote><p><strong>如何自定义异常？</strong></p><ol><li>编写一个类继承 Exception 或者 RuntimeException</li><li>提供两个构造方法，一个无参，一个待用String 参数的</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span>  <span class="title class_">Exception</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="type">MyException</span> <span class="variable">mye</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;自定义的错误&quot;</span>);</span><br><span class="line"><span class="keyword">throw</span> mye;</span><br></pre></td></tr></table></figure><h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><blockquote><p>集合本身是一个容器，用来存储引用类型的数据，不能直接存储基本数据类型</p><p>Java中不同的集合对应不同的数据结构，例如：数组，二叉树，链表，哈希表。。。</p><ul><li>new ArrayList(); 底层是数组</li><li>new LinkedList(); 底层是链表</li><li>new ThreeSet(); 底层是二叉树 </li></ul></blockquote><p>在Java中集合分为两大类：</p><ol><li><p>一类是存储单个元素</p><p> 这类集合祖先是 java.utlls.Collection 【可迭代，可遍历】</p><ul><li>list    有序，可重复，元素有下标<ul><li>ArrayList【类】    底层数组，非线程安全</li><li>LinkedList【类】  底层双向链表  </li><li>Vector【类】    底层数组，线程安全，使用较少【线程安全有其他方案】</li></ul></li><li>Set    无序，不可重复，元素无下标<ul><li>hashSet【类】    底层new了hashMap【底层哈希表】</li><li>SortedSet  自动排序<ul><li>TreeSet【类】    底层new了TreeMap【底层二叉树】</li></ul></li></ul></li></ul></li><li><p>一类是键值对存储形式</p><p> 这类集合祖先是 java.utlls.Map, key 是无需不可重复</p><ul><li>HashMap【类】    非线程安全，底层哈希表</li><li>Hashtable【类】    线程安全，底层哈希表，使用较少【线程安全有其他方案】<ul><li>Properties【类】  线程安全，键,值要求是String类型</li></ul></li><li>SortedMap    会自动排序<ul><li>TreeMap【类】底层二叉树，key按自动大小排序</li></ul></li></ul></li></ol><blockquote><p><strong>Map集合的key部分存储的就是 Set集合</strong></p></blockquote><h4 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h4><blockquote><p>不使用泛型之前，Collection 中可以存储Object的所有子类型。使用泛型之后，Collection中只能储存某个具体类型</p></blockquote><p><strong>Collection 中常用方法</strong></p><ul><li><p>add 添加元素</p></li><li><p>size 获取集合中元素个数</p></li><li><p>void 清空集合</p></li><li><p>contains(Object o) 判断集合中包含 某对象 o</p></li><li><p>remove 删除某个元素</p></li><li><p>isEmpty 集合中数据个数是否为0</p></li><li><p>toArray  将集合转换为数组</p></li><li><p>iterator  返回迭代器</p></li><li><p>dynchronizedList(list l) 让集合变成线程安全的</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元素内容发生改变时。需要冲新获取 iterator</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> c.iterator();</span><br><span class="line">it.hasNext();<span class="comment">// 有就返回true</span></span><br><span class="line">it.next();<span class="comment">// 返回迭代的下一个元素</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>contains 方法解析</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Test &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(string[] args)</span> &#123;</span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;def&quot;</span>;</span><br><span class="line">        c.add(s1);</span><br><span class="line">        c.add(s2);</span><br><span class="line">        <span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        <span class="comment">// 判断集合中是否存在 &quot;abc&quot;</span></span><br><span class="line">        c.contains(x);<span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按照内存地址，x 不在 C 当中。 contains 实现时调用了 equals() 方法,把x与集合中元素比较</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230203132125708.png" alt="image-20230203132125708"></p><blockquote><p>放进集合的元素 一定要重写 equals 方法，非则比较时比较的是内存地址而不是内容</p></blockquote><p><strong>数组坍台</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 迭代过程中不能修改集合结构：例如删除，新增</span></span><br><span class="line"><span class="type">Collection</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line">c2.add(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">c2.add(<span class="string">&quot;def&quot;</span>);</span><br><span class="line">c2.add(<span class="string">&quot;xyz&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>();</span><br><span class="line"><span class="keyword">while</span>(it2.hasNext()) &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> it2.next();</span><br><span class="line">    <span class="comment">// c2.remove(); // 删除之后会出现异常</span></span><br><span class="line">    <span class="comment">// 可以使用迭代器来删除？</span></span><br><span class="line">    it.remove();<span class="comment">// 可以，删除的一定是当前指向的元素</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原因： 因为集合删除元素不会更新迭代器，而迭代器删除会更新迭代器</span></span><br></pre></td></tr></table></figure><p><strong>list 接口常用方法</strong></p><ul><li>get(int index)  根据下标获取元素</li><li>indexOf(Object o)  获取指定对象第一次出现的下标索引</li><li>lastIndexOf(Object o) 获取指定对象最后一次出现的下标索引</li><li>remove(int index) 删除指定索引的元素</li><li>set(int index, E element)  修改指定位置的元素</li><li>add(Object element) 新增</li></ul><h5 id="ArrayList-指定容量及扩容"><a href="#ArrayList-指定容量及扩容" class="headerlink" title="ArrayList 指定容量及扩容"></a>ArrayList 指定容量及扩容</h5><blockquote><p>默认初始化容量为 10.</p><p>扩容: 元素超过初始化容量时，自动扩容，创建新的数组【 原容量 1.5 倍】把数据放进去</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化指定容量，底层先创建一个长度为0的数组，当添加第一个元素时，初始化容量20</span></span><br><span class="line"><span class="type">List</span> <span class="variable">list1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><h5 id="ArrayList有参构造"><a href="#ArrayList有参构造" class="headerlink" title="ArrayList有参构造"></a><strong>ArrayList有参构造</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Collection</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line"></span><br><span class="line">c.add(<span class="number">100</span>);</span><br><span class="line">c.add(<span class="number">200</span>);</span><br><span class="line">c.add(<span class="number">300</span>);</span><br><span class="line"><span class="comment">// 可将HashSet 集合转为 ArrayList</span></span><br><span class="line"><span class="type">List</span> <span class="variable">myList1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(c);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="linkedList"><a href="#linkedList" class="headerlink" title="linkedList"></a>linkedList</h5><blockquote><p>底层是链表结构。随机增删效率较高。检索效率低</p></blockquote><h5 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h5><blockquote><ul><li>不可重复</li><li>存储位置和取出位置不一致</li><li>放到hashSet 集合的元素实际上是放到HashMap的key部分了</li></ul></blockquote><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><blockquote><ol><li><p>Map和Collection没有继承关系</p></li><li><p>Map集合以键值对放啊是存储</p><p> key,value都是引用类型</p></li></ol></blockquote><h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ul><li>V put(K key, V value) 新增</li><li>V get(Object key) 通过key获取value</li><li>void clear() 清空Map集合</li><li>boolean containsKey(Object key) 判断Map中是否包含某个key</li><li>boolean containsValue(Object value)  判断Map中是否包含某个value</li><li>isEmpty() 判断Map集合中元素个数是否为0</li><li>Set&lt;K&gt; keyset() 获取Map集合中所有的value（所有的键是一个set集合）</li><li>V remove(Object key) 通过key删除键值对</li><li>int size() 返回集合中键值对的个数</li><li>Collection&lt;V&gt; values() 获取Map集合中所有的value，返回一个Collection</li><li>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() 将Map集合转Set集合</li></ul><h5 id="Map对象的遍历"><a href="#Map对象的遍历" class="headerlink" title="Map对象的遍历"></a>Map对象的遍历</h5><ol><li><p>通过遍历key,来获取数据</p><p> getKeys, 再遍历得到key，使用 get(key)获取值</p></li><li><p>通过 entrySet,再使用 foreach</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适合大数据量</span></span><br><span class="line">HashMap&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;张三三&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;李思思&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;王五五&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;五六七&quot;</span>);</span><br><span class="line">Set&lt;Map.Entry&lt;String,String&gt;&gt; map2 = map.entrySet();</span><br><span class="line"><span class="keyword">for</span> (Map.Entry item: map2) &#123;</span><br><span class="line">    System.out.println(item.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h4><blockquote><p>键值对限制为String类型</p></blockquote><h4 id="增强for循环"><a href="#增强for循环" class="headerlink" title="增强for循环"></a>增强for循环</h4><blockquote><p>foreach,缺点是没有下标</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> item: arr) &#123;</span><br><span class="line">    System.out.println(<span class="string">&#x27;item:&#x27;</span>, item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h4><blockquote><p>是数组和单链表的结合体，充分发挥各自的有点</p></blockquote><h4 id="集合工具类"><a href="#集合工具类" class="headerlink" title="集合工具类"></a>集合工具类</h4><blockquote><p>java.util.Collections 集合工具类，方便操作</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变成线程安全的</span></span><br><span class="line">Collection.synchronizedList(list)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序, 对list 集合经行排序要保证，list集合中的元素实现了：Comparable 接口</span></span><br><span class="line">Collection.sort(list)</span><br></pre></td></tr></table></figure><h4 id="泛型机制"><a href="#泛型机制" class="headerlink" title="泛型机制"></a>泛型机制</h4><blockquote><p>编译期间的新特性，jdk5新增</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Cat,bird 类继承 Animal类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line"><span class="type">Bird</span> <span class="variable">bird</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bird</span>();</span><br><span class="line"><span class="comment">// 不使用泛型</span></span><br><span class="line"><span class="type">List</span> <span class="variable">myList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"><span class="comment">// 使用泛型，指定泛型后集合只能放 Animal 类型</span></span><br><span class="line">List&lt;Animal&gt; myList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">myList.add(cat);</span><br><span class="line">myList.add(bird);</span><br><span class="line"><span class="comment">// 不使用泛型</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">it</span> <span class="operator">=</span> myList.iterator();</span><br><span class="line"><span class="comment">// 使用泛型</span></span><br><span class="line">Iterator&lt;Animal&gt; it = myList.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    <span class="comment">// 不使用泛型，此时返回的类型是Object</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> it.next()</span><br><span class="line">    <span class="comment">// 使用泛型, 此时可以调用Animal的方法</span></span><br><span class="line">    <span class="type">Animal</span> <span class="variable">obj</span> <span class="operator">=</span> it.next()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="自动类型推断机制"><a href="#自动类型推断机制" class="headerlink" title="自动类型推断机制"></a>自动类型推断机制</h5><blockquote><p>jdk8新增，又称钻石表达式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 右边的 &lt;&gt; 可以省略</span></span><br><span class="line">List&lt;Anamal&gt; myList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><h5 id="自定义泛型"><a href="#自定义泛型" class="headerlink" title="自定义泛型"></a>自定义泛型</h5><blockquote><p>myType 是一个标识符随便命名，java源代码一般用T，E</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &lt;myType&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">(myType o)</span> &#123;</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Test&lt;<span class="type">int</span>&gt; int1 = <span class="keyword">new</span> <span class="title class_">Test</span>&lt;&gt;();</span><br><span class="line">        int1.doSome(<span class="number">1</span>);<span class="comment">// 此处只能传 int 类型</span></span><br><span class="line">        </span><br><span class="line">         Test&lt;String&gt; str1 = <span class="keyword">new</span> <span class="title class_">Test</span>&lt;&gt;();</span><br><span class="line">        str1.doSome(<span class="number">1</span>);<span class="comment">// 此处只能传 String 类型</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="IO流"><a href="#IO流" class="headerlink" title="IO流"></a>IO流</h3><blockquote><p>文件的输入（硬盘-&gt;内存）和输出（内存-&gt;硬盘）。通过IO可以完成硬盘文件的读和写</p></blockquote><ul><li>字节流：每次读取一个字节，啥类型都能读取</li><li>字符流：每次读取一个字符，这种流是为了方便读取普通文件存在的。如：.text</li></ul><h5 id="IO流的四大家族"><a href="#IO流的四大家族" class="headerlink" title="IO流的四大家族"></a>IO流的四大家族</h5><ol><li>java.io.InputStream    字节输入流</li><li>java.io.OutPutStream   字节输出流</li><li>java.io.Reader    字符输入流</li><li>java.io.Writer    字符输出流</li></ol><blockquote><ul><li><p>方法名以 <strong>Stream 结尾</strong>的都是字节流。</p></li><li><p>四大家族首领都是抽象类。</p></li><li><p>所有流都有close方法</p></li><li><p>所有输出流都是可刷新的（实现了java.io.Flushable）刷新的作用就是清空管道，最终输出完记得调一下</p></li></ul></blockquote><p>6种类型的流：</p><ul><li><p>File 文件专属</p><ul><li><p>*FileInputStream</p><blockquote><p>read() 读</p><p>available() 剩余多少字节未读</p><p>skip()  跳过多少字节不读</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字节读取</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;data.text&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">readCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (readCount != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 可以一次读5个字节</span></span><br><span class="line">    <span class="comment">// byte[] bytes = new byte[4];</span></span><br><span class="line">    <span class="comment">// 一次读完，不适合大文件</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[fis.available()];</span><br><span class="line">    </span><br><span class="line">    readCount = fis.read(bytes);</span><br><span class="line">    <span class="keyword">if</span> (readCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 将byte转字符串</span></span><br><span class="line">        System.out.println(<span class="string">&quot;str = &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,readCount));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fis.close();</span><br></pre></td></tr></table></figure></li><li><p>*FileOutPutStream </p><blockquote><p>write(文件名, 追加模式)</p><p>flush() 清空连接管道</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第二参数 true 表示追加，不是重写</span></span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;data.text&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="type">byte</span>[] bt = &#123;<span class="number">100</span>, <span class="number">120</span>,<span class="number">110</span>,<span class="number">111</span>&#125;;</span><br><span class="line"><span class="comment">// 字符串转byte在写入</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;我是一个中国人&quot;</span>;</span><br><span class="line"><span class="type">byte</span>[] bs = s.getBytes();</span><br><span class="line">fis.write(bt);</span><br><span class="line">fis.write(bs);</span><br><span class="line">fis.flush();</span><br><span class="line">fis.close();</span><br></pre></td></tr></table></figure><p>  <strong>文件的复制</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(getPath(<span class="string">&quot;data.text&quot;</span>));</span><br><span class="line">fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:/javaSE/daySE01/data1.text&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心：边写边读</span></span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];<span class="comment">// 最多拷贝1M</span></span><br><span class="line"><span class="type">int</span> <span class="variable">readCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((readCount = fis.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;readCount = &quot;</span> + readCount);</span><br><span class="line">    fos.write(bytes, <span class="number">0</span>, readCount);</span><br><span class="line">&#125;</span><br><span class="line">fos.flush();</span><br><span class="line"></span><br><span class="line">fis.close();</span><br><span class="line">fos.close();</span><br></pre></td></tr></table></figure></li><li><p>FileReader</p><blockquote><p>文件字符输入流，只能读取普通文本</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">fr = <span class="keyword">new</span> <span class="title class_">FileReader</span>(getPath(<span class="string">&quot;data.text&quot;</span>));</span><br><span class="line"><span class="type">char</span>[] chars = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">readCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((readCount = fr.read(chars)) != -<span class="number">1</span>) &#123;</span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, readCount));</span><br><span class="line">&#125;</span><br><span class="line">fr.close();</span><br></pre></td></tr></table></figure></li><li><p>FileWriter</p><blockquote><p>文件字符输出流，只能写到普通文本()能用记事本打开的都是普通文本</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">out = <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="type">char</span>[] charts = &#123;<span class="string">&#x27;我&#x27;</span>,<span class="string">&#x27;是&#x27;</span>,<span class="string">&#x27;谁&#x27;</span>,<span class="string">&#x27;?&#x27;</span>&#125;;</span><br><span class="line">out.write(charts);</span><br><span class="line">out.write(<span class="string">&quot;我是一个字符串。&quot;</span>);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure><p>  <strong>复制文件</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">FileReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">out = <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">in = <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\target.text&quot;</span>);</span><br><span class="line"><span class="type">char</span>[] charts = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>*<span class="number">512</span>];<span class="comment">// 限制1M</span></span><br><span class="line"><span class="type">int</span> <span class="variable">readCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((readCount = in.read(charts)) != -<span class="number">1</span>) &#123;</span><br><span class="line">    out.write(charts, <span class="number">0</span>, readCount);</span><br><span class="line">&#125;</span><br><span class="line">out.flush();</span><br><span class="line">in.close();</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Buffered  缓冲流 【不需要指定char,byte 缓冲字符】</p><ul><li><p>BufferedInputStream</p></li><li><p>BufferedOutPutStream   </p></li><li><p>BufferedReader</p><blockquote><p>BufferedReader(Reader) 只能传入字符流</p><p>readLine() 读取一行字符</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>);</span><br><span class="line"></span><br><span class="line">FileInputStream</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当一个流构造方法需要传入一个流时：被传入的流叫做节点流 fr</span></span><br><span class="line"><span class="comment">// 外部负责包装的流，叫做包装流/处理流 br</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fr);</span><br><span class="line"><span class="type">String</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span> ((rs = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    System.out.println(rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 节点流不需要手动关闭，会自动关闭</span></span><br><span class="line">br.close();</span><br></pre></td></tr></table></figure></li><li><p>BufferedWriter</p><blockquote></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>,<span class="literal">true</span>)));</span><br><span class="line">bw.write(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">bw.flush();</span><br><span class="line">bw.close();</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Data  数据流</p><blockquote><p>DataOutPutStream 写入数据，只能用  DataOutPutStream 按写入顺序读取指定类型，才能正常去除数据</p></blockquote><ul><li><p>*DataInputStream</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data2.text&quot;</span>));</span><br><span class="line">System.out.println(in.readBoolean());</span><br><span class="line">System.out.println(in.read());</span><br><span class="line">System.out.println(in.readUTF());</span><br><span class="line">System.out.println(in.readChar());</span><br><span class="line"></span><br><span class="line">in.close();</span><br></pre></td></tr></table></figure></li><li><p>*DataOutPutStream</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data2.text&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"></span><br><span class="line">out.writeBoolean(flag);</span><br><span class="line">out.write(a);</span><br><span class="line">out.writeUTF(b);</span><br><span class="line">out.writeChar(c);</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Print  标准输出流</p><ul><li><p>PrintWriter</p></li><li><p>PrintStream</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将标准输出流方向修改到 log 文件, 标准输出流不需要关闭</span></span><br><span class="line"><span class="type">PrintStream</span> <span class="variable">printStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\log.text&quot;</span>, <span class="literal">true</span>));</span><br><span class="line">printStream.println(<span class="string">&quot;日志1&quot;</span>);</span><br><span class="line">printStream.println(<span class="string">&quot;日志2&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Object  对象专属流</p><blockquote><p><strong>序列化</strong>：将内存中的java对象一块一块的写入到硬盘文件的过程</p><p><strong>反序列化</strong>：将硬盘上的碎片数据在内存中恢复成对象</p><p>对象要想参与序列化，需要实现 Serializable 接口</p><p> <strong>Serializable 接口</strong>:</p><p>​    这是一个标志接口，里边啥也没有.实现这个接口的类 java虚拟机会提供一个序列化版本号。【将一个对象序列化后，如果之后类发生了变化，则后边想反序列化对象就会报错】</p><p><strong>序列化版本号的作用？</strong></p><p>​    Java区分一个类，先比较类名，再比较序列化版本号</p><p><strong>自动生成序列化的缺陷</strong></p><p>​    几年前序列化的一个对象，后续不能更改代码。否则几年前序列化的对象不能反序列化回来</p><p><strong>一次序列化多个对象</strong>： 使用集合把多个对象装进去，集合与其中对象都需要实现 Serializable 接口</p><p><strong>结论：凡是实现Serializable 接口的类应该手动设置，不在改变</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Test implemtnts Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><ul><li><p>ObjectInputStream</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line">oos = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\student&quot;</span>));</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> oos.readObject();</span><br><span class="line">System.out.println(<span class="string">&quot;obj = &quot;</span> + obj);</span><br><span class="line">oos.close();</span><br></pre></td></tr></table></figure></li><li><p>ObjectOutPutStream</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 序列化</span></span><br><span class="line"><span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;www&quot;</span>, <span class="number">16</span>);</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\student&quot;</span>));</span><br><span class="line">oos.writeObject(s);</span><br><span class="line">oos.flush();</span><br><span class="line">oos.close();</span><br></pre></td></tr></table></figure><p>  如果某个对象中的属性不希望参与序列化可以使用 属性修饰符：transient</p></li></ul></li><li><p>转换流（将字节流-&gt; 字符流）</p><ul><li><p>InputStreamReader</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">InputStreamReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字节流</span></span><br><span class="line">in= <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>);</span><br><span class="line"><span class="comment">// 字节流 =&gt; 字符流</span></span><br><span class="line">reader = <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in);</span><br></pre></td></tr></table></figure></li><li><p>OutPutStreamWriter</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data.text&quot;</span>,<span class="literal">true</span>)));</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="通过properties-读取配置文件信息"><a href="#通过properties-读取配置文件信息" class="headerlink" title="通过properties 读取配置文件信息"></a>通过properties 读取配置文件信息</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=www</span><br><span class="line">password=123</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\javaSE\\daySE01\\src\\data2.text&quot;</span>);</span><br><span class="line"><span class="type">Properties</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">p.load(reader);</span><br><span class="line">System.out.println(p.getProperty(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">System.out.println(p.getProperty(<span class="string">&quot;password&quot;</span>));</span><br></pre></td></tr></table></figure><h4 id="Java-io-File-类"><a href="#Java-io-File-类" class="headerlink" title="Java.io.File 类"></a>Java.io.File 类</h4><blockquote><p>FIle 类与流无关，不能读写，File 对象表示 <strong>文件和目录</strong>的抽象形式。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 File,</span></span><br><span class="line"><span class="type">File</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/myTest&quot;</span>);</span><br><span class="line"><span class="comment">// 不存在以文件形式创建</span></span><br><span class="line"><span class="keyword">if</span> (!f1.exists()) &#123;</span><br><span class="line">    f1.createNewFile();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不存在以目录形式创建</span></span><br><span class="line"><span class="keyword">if</span>(!f1.exists()) &#123;</span><br><span class="line">    f1.mkdir();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建多重目录</span></span><br><span class="line"><span class="type">File</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/myTest/day01/module1/one&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!f2.exists()) &#123;</span><br><span class="line">    f2.mkdirs();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">File</span> <span class="variable">f3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/myTest/day01/module1&quot;</span>);</span><br><span class="line"><span class="comment">// 获取父级目录</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> f3.getParent();</span><br><span class="line"><span class="comment">// 获取父级绝对路径</span></span><br><span class="line">f3.getParentFile().getAbsolutePath();</span><br></pre></td></tr></table></figure><h5 id="常用方法-1"><a href="#常用方法-1" class="headerlink" title="常用方法"></a>常用方法</h5><ul><li>isFile  判断是否文件</li><li>isDirectory  判断是否目录</li><li>getName  获取文件名</li><li>lastModified  获取上次修改时间</li><li>length  获取文件大小</li><li>listFile  获取当前目录下所有子文件</li></ul><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><blockquote><p><strong>什么式进程？线程?</strong></p><p>进程是一个应用程序（进程可以启动多个线程）</p><p>线程是一个进程的中的执行场景/执行单元</p></blockquote><h4 id="进程，线程关系"><a href="#进程，线程关系" class="headerlink" title="进程，线程关系"></a>进程，线程关系</h4><blockquote><p>进程A和进程B内存独立不共享</p><p>线程A和B，堆内存和方法区共享，栈内存独立</p></blockquote><h4 id="真正的多线程并发"><a href="#真正的多线程并发" class="headerlink" title="真正的多线程并发"></a>真正的多线程并发</h4><blockquote><p>t1线程执行t1,t2线程执行t2.两者不会相互影响。这叫做真正的并发</p><p>单核CPU 不能做到真正的多线程并发，但可以做到给人多线程并发的 感觉、</p></blockquote><h4 id="实线线程的方式"><a href="#实线线程的方式" class="headerlink" title="实线线程的方式"></a>实线线程的方式</h4><ol><li><p>编写一个类直接继承java.lang.Thread, 重写run方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">// 创建线程</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="comment">// 启动线程.在JVM中开启一个新的栈空间，start方法就结束了。 直接调用run方法不会开辟新空间开启线程</span></span><br><span class="line">        td.start();</span><br><span class="line">        <span class="comment">// 其他代码</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThred</span> implaments Thread &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新的线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写一个类实现java.lang.Runnable接口 (这种方式拓展性好)</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">            <span class="comment">// 创建线程</span></span><br><span class="line">            <span class="type">MyRunnable</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(td);</span><br><span class="line">            t.start();</span><br><span class="line">            <span class="comment">// 其他代码</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新的线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 匿名内部类方式</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">// 创建线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>() &#123;</span><br><span class="line">            run() &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">// 其他代码</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>实现 Callable 接口</p><blockquote><p>可以获取线程返回值</p></blockquote> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">FutureTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FutureTask</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>()&#123;</span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throw</span> Exception &#123;</span><br><span class="line">                ...</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 创建线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        </span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">// 获取结果, 此处会阻塞</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> task.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>  &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新的线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h4><ul><li>新建状态：刚 new 出来</li><li>就绪状态：调用了 start 方法，具有抢夺CPU时间片的权利</li><li>运行状态：内部调用了 run方法后进入，当抢夺的时间片用完再次回到就绪状态，再次抢夺时间片回来继续执行代码（这个来回切换状态的过程叫做JVM的调度）</li><li>阻塞状态：此时线程会放弃之前占有的CPU时间片，例如进入到键盘输入，休眠等方法</li></ul><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230209112604572.png" alt="image-20230209112604572"></p><h4 id="获取线程对象，名字"><a href="#获取线程对象，名字" class="headerlink" title="获取线程对象，名字"></a>获取线程对象，名字</h4><blockquote><p>默认线程名字 Thread-n 【n从开始递增】</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建线程</span></span><br><span class="line"><span class="type">MyRunnable</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(td);</span><br><span class="line"><span class="comment">// 获取线程名字</span></span><br><span class="line">System.out.println(t.getName());;</span><br><span class="line"><span class="comment">// 修改名字</span></span><br><span class="line">t.setName(<span class="string">&quot;line&quot;</span>);</span><br><span class="line">System.out.println(t.getName());;</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><h4 id="获取当前线程"><a href="#获取当前线程" class="headerlink" title="获取当前线程"></a>获取当前线程</h4><blockquote><p>哪个线程在执行run方法，就获取哪个线程</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">currentThread</span> <span class="operator">=</span> Thread.currentThread();</span><br></pre></td></tr></table></figure><h4 id="线程的sleep方法"><a href="#线程的sleep方法" class="headerlink" title="线程的sleep方法"></a>线程的sleep方法</h4><blockquote><p>静态方法(跟谁调用没关系)，参数 毫秒。让当前线程进组阻塞状态</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(<span class="number">1000</span>*<span class="number">3</span>)<span class="string">&#x27;// sleep 3s</span></span><br></pre></td></tr></table></figure><h4 id="唤醒线程"><a href="#唤醒线程" class="headerlink" title="唤醒线程"></a>唤醒线程</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建线程</span></span><br><span class="line"><span class="type">MyRunnable</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(td);</span><br><span class="line">t.inerrupt();</span><br></pre></td></tr></table></figure><h4 id="强行终止线程"><a href="#强行终止线程" class="headerlink" title="强行终止线程"></a>强行终止线程</h4><blockquote><p>容易丢失数据，不建议使用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建线程</span></span><br><span class="line"><span class="type">MyRunnable</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(td);</span><br><span class="line">t.sopt();</span><br></pre></td></tr></table></figure><h4 id="合理的终止线程"><a href="#合理的终止线程" class="headerlink" title="合理的终止线程"></a>合理的终止线程</h4><blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyRunnable</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(td);</span><br><span class="line"><span class="comment">// 终止线程</span></span><br><span class="line">td.run = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">run</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新的线程&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(run) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="线程的调度"><a href="#线程的调度" class="headerlink" title="线程的调度"></a>线程的调度</h4><blockquote><p><strong>常见的线程调度模型</strong>，Java采用第一种</p><ul><li>抢占式调度模型：哪个线程优先级高，强夺CPU时间片的概率就高一些</li><li>均分式调度模型：平均分配CPU时间片，每个线程占用CPU时间片长度一样</li></ul></blockquote><h4 id="线程调度相关方法"><a href="#线程调度相关方法" class="headerlink" title="线程调度相关方法"></a>线程调度相关方法</h4><ul><li><p>setPriority(int newPriority) 设置线程的优先级</p></li><li><p>int getPriority()  获取线程优先级 [1,10]，默认5</p></li><li><p>static void yield()  让位，暂停当前线程让其他线程先执行（非阻塞），从运行状态退回就绪状态</p></li><li><p>join() 合并线程</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// t合并到当前线程，当前线程受阻塞，t线程执行直到结束</span></span><br><span class="line">t.join();</span><br></pre></td></tr></table></figure></li></ul><h4 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h4><blockquote><p>以后在开发中，我们的项目都是运行在服务器当中，而服务器已经将线程的定义，线程对象的创建，线程的启动等，都已经实现完了。这些代码我们都不需要编写.<br>最重要的是:你要知道，你编写的程序需要放到一个多线程的环境下运行，你更需要关注的是这些数据在多线程并发的环境下是否是安全的。(重点: *<em>t</em> )</p></blockquote><p><strong>啥时候数据会在多线程并发存在安全问题</strong></p><p>满足以下三个条件就会存在安全问题：</p><ul><li>多线程并发</li><li>有数据共享</li><li>共享数据有修改行为</li></ul><p><strong>怎么解决？</strong></p><blockquote><p>线程排队执行，不能并发。（线程同步机制）</p></blockquote><p>异步编程模型：异步就是并发</p><p>同步编程模型：同步就是排队</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线程同步机制语法</span></span><br><span class="line"><span class="comment">// ()中写什么？假设t1,t2,t3 3个线程，只希望t1,t2排队，t3不排队。（）中就写t1,t2共享的对象，这个对象对于t3来说不是共享的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    synchroized() &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时 共享对象只能是 this</span></span><br><span class="line"><span class="keyword">public</span> synchroized <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表示找类🔒，类锁只有一个，创建的对象都共用一个</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> synchroized <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>理解线程同步锁机制 ：例如🚾就一个🕳，一个人上时会🔒🚪，第二个人就进不去，只有等第一个人解决完打开🔒开🚪后，第二个人才能进去</strong>， 人就像线程，共享的对象就是🕳</p><h4 id="死锁现象"><a href="#死锁现象" class="headerlink" title="死锁现象"></a>死锁现象</h4><p>两个线程t1, t2，共享🔒s1,s2。 t1 先锁 s1, 再锁s2。t2先锁s2,再锁s1。 结果t1锁住s1,等待s2，t2锁住s2,等待s1。这种现象就叫死锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="type">MyThread1</span> <span class="variable">m1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread1</span>(o1, o2);</span><br><span class="line">    <span class="type">MyThread1</span> <span class="variable">m2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread1</span>(o1, o2);</span><br><span class="line">    m1.start();</span><br><span class="line">    m2.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread1</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    Object o1;</span><br><span class="line">    Object o2;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread</span><span class="params">(Object o1, Object o2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.o1 = o1;</span><br><span class="line">        <span class="built_in">this</span>.o2 = o2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        sychonized (o1) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            sychonized (o2) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread2</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    Object o1;</span><br><span class="line">    Object o2;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyThread</span><span class="params">(Object o1, Object o2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.o1 = o1;</span><br><span class="line">        <span class="built_in">this</span>.o2 = o2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        sychonized (o2) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            sychonized (o1) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="三种变量"><a href="#三种变量" class="headerlink" title="三种变量"></a>三种变量</h4><ul><li>实例变量：堆</li><li>静态变量：方法区</li><li>局部变量：栈</li></ul><p>局部变量永远不会有线程安全问题，因为 不共享，一个线程一个栈</p><h4 id="开发中如何避免"><a href="#开发中如何避免" class="headerlink" title="开发中如何避免"></a>开发中如何避免</h4><blockquote><p>不能直接使用线程安全的数据类型，很导致程序执行效率低</p></blockquote><ol><li>经量使用局部变量代替实例变量和静态变量</li><li>如果必须是实例变量，可以考虑创建多个对象，不共享内存</li><li>使用  synchroized,线程同步机制</li></ol><h4 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h4><blockquote><p>如 System.gc(); 也叫做后台线程。一般守护线程是死循环。只要用户线程结束，守护线程自动结束</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义守护线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span> <span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">    <span class="comment">// 设置成守护线程</span></span><br><span class="line">    t.setDaemon(<span class="literal">true</span>);</span><br><span class="line">    t.start();</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;我是守护者&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h4><blockquote><p>java.util.Timer 很少用，框架大多会提供定时任务功能</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定时任务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Timer</span> <span class="variable">timer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>();</span><br><span class="line">        <span class="type">SimpleDataFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDataFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">first</span> <span class="operator">=</span> sdf.parse(<span class="string">&#x27;2023-03-03&#x27;</span>);</span><br><span class="line">     timer.schedule(<span class="keyword">new</span> <span class="title class_">logTimerTask</span>(), first, <span class="number">1000</span>*<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogTomerTsak</span> <span class="keyword">extends</span> <span class="title class_">TimerTask</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="wait-和-notify-方法"><a href="#wait-和-notify-方法" class="headerlink" title="wait 和 notify 方法"></a>wait 和 notify 方法</h4><blockquote><p>它们并不是线程对象专属方法，所有对象都能调用</p></blockquote><h5 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h5><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">o.await();</span><br></pre></td></tr></table></figure><p>​    让正在o对象上活动的线程进入等待状态，无期限等待，百到被唤配为止。<br>​    o.wait() ;方法的调用，会让”当前线程(正在o对象上活动的线程)”进入等待状态，</p></blockquote><h5 id="notify"><a href="#notify" class="headerlink" title="notify"></a>notify</h5><blockquote><p>唤醒o对象上沉睡的线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o.notify();</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20230209164328749.png" alt="image-20230209164328749"></p><h3 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h3><blockquote><p>通过Java 语言中的反射机制可以操作字节码文件。</p></blockquote><blockquote><p>相关包的位置： java.lang.reflect.*</p><p>相关重要的类</p><ul><li>java.lang.Class 字节码文件</li><li>java.lang.reflect.Method 字节码中的方法</li><li>java.lang.reflect.Constructor 字节码中构造方法字节码</li><li>java.lang.reflect.Field 字节码中属性字节码</li></ul></blockquote><h4 id="获取字节码的三种方式"><a href="#获取字节码的三种方式" class="headerlink" title="获取字节码的三种方式"></a>获取字节码的三种方式</h4><ol><li><p>java.lang.Class</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>java 中任意一个对象都有一个方法：getClass()</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="comment">// x 代表String.class 字节码文件，x代表String 类型</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">x</span> <span class="operator">=</span> s.getClass();</span><br><span class="line">c1 = x;<span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>java语言中任何一种类型，包括基本数据类型，他都有.class属性</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">z</span> <span class="operator">=</span> String.class;<span class="comment">// 代表String类型</span></span><br><span class="line">z==x;<span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="通过反射实例化对象"><a href="#通过反射实例化对象" class="headerlink" title="通过反射实例化对象"></a>通过反射实例化对象</h4><blockquote><p>获取到class能干吗？</p><p>通过 newInstance 实例化对象，实际上调用了无参构造方法，必须保证无参构造存在。【比普通方式灵活】</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.xxx.java.bean.User&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// newInstance 会调用无参构造</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">c</span>.newInstance();</span><br></pre></td></tr></table></figure><p>可以同过配置项，动态加载不同的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chapter25/classinfo.properties</span></span><br><span class="line">classNae = <span class="string">&quot;java.util.Date&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建读取流</span></span><br><span class="line"><span class="type">FileReader</span> <span class="variable">rd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;chapter25/classinfo.properties&quot;</span>);</span><br><span class="line"><span class="comment">// 创建集合</span></span><br><span class="line"><span class="type">Propereties</span> <span class="variable">pro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="comment">// 加载</span></span><br><span class="line">pro.load(rd);</span><br><span class="line"><span class="comment">// 关闭流</span></span><br><span class="line">rd.close();</span><br><span class="line"><span class="comment">// 反射实例化对象</span></span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> pro.getProperty(<span class="string">&#x27;className&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">c</span>.newInstance();</span><br></pre></td></tr></table></figure><h4 id="Class-forName-发生了什么？"><a href="#Class-forName-发生了什么？" class="headerlink" title="Class.forName 发生了什么？"></a>Class.forName 发生了什么？</h4><blockquote><p>Class.forName 会导致类加载。<strong>如果你希望一个类的静态代码块长记性，其他一律不执行</strong> 可以这样使用 Class.forName(className);</p></blockquote><h4 id="文件路径问题"><a href="#文件路径问题" class="headerlink" title="文件路径问题"></a>文件路径问题</h4><blockquote><p>复制引用的方式只在Idea中有效。代码在其他位置打开可能不一样。</p></blockquote><p><strong>src是类路径的根路径，在src下的都是类路径：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Thread.currentThread()当前线程路径</span></span><br><span class="line"><span class="comment">getContextClassLoader() 线程方法，可以获取当前线程的类加载器对象</span></span><br><span class="line"><span class="comment">getResource(&quot;&quot;) 【获取资源】类加载器方法，当前类加载器默认的根路径【src】下加载资源</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">根类路径位置先把getResource()方法不传参数看看，不同框架可能不一样</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">最终获取到文件的绝对路径</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResource(<span class="string">&quot;com/bjpowernode/java/bean/classinfo.properties&quot;</span>).getPath();</span><br></pre></td></tr></table></figure><p><strong>以流的形式返回</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">rd</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResourceAsStream(<span class="string">&quot;test.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Properties</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    p.load(rd);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> p.getProperty(<span class="string">&quot;className&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="资源绑定器"><a href="#资源绑定器" class="headerlink" title="资源绑定器"></a>资源绑定器</h4><blockquote><p>java.util 包下提供了一个资源绑定器，便于获取属性配置文件中的内容</p><p>只能绑定 xxx.properties 文件,绑定时不带后缀。并且这个名，必须在类路径下</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;className&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="反射属性"><a href="#反射属性" class="headerlink" title="反射属性"></a>反射属性</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">reflectTestFiled</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;myName&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">version</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> <span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">studentClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"><span class="comment">// 获取完整类名 studentClass.getName()</span></span><br><span class="line"><span class="comment">// 获取简单类名 studentClass.getSimpleName()</span></span><br><span class="line"><span class="comment">// 获取属性类型 studentClass.getTypeName()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有类中的 public修饰的 Filed</span></span><br><span class="line">Field[] field = studentClass.getFields();</span><br><span class="line"><span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> field[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 取出名字</span></span><br><span class="line">System.out.println(<span class="string">&quot;取出 &quot;</span> + f.getName());</span><br><span class="line"><span class="comment">// 过去所有属性名</span></span><br><span class="line">Field[] fs = studentClass.getDeclaredFields();</span><br><span class="line">System.out.println(<span class="string">&quot;field = &quot;</span> + fs.length);</span><br><span class="line"><span class="keyword">for</span> (Field item: fs) &#123;</span><br><span class="line">    <span class="comment">// Modifier.toString(int type) 将 item.getModifiers() 返回的数字类型转换为文字描述</span></span><br><span class="line">    System.out.println(<span class="string">&quot;类型： &quot;</span>+ item.getType().getSimpleName() + <span class="string">&quot;属性名：&quot;</span> + item.getName() + <span class="string">&quot;修饰符：&quot;</span> + Modifier.toString(item.getModifiers()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h4><blockquote><p>通过反射机制，反编译一个类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">studentClass</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    studentClass = Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建字符串拼接缓冲</span></span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">s.append(Modifier.toString(studentClass.getModifiers()) + <span class="string">&quot; class &quot;</span> + studentClass.getSimpleName() + <span class="string">&quot; &#123;\n&quot;</span>);</span><br><span class="line">Field[] fields = studentClass.getDeclaredFields();</span><br><span class="line"><span class="keyword">for</span> (Field item: fields) &#123;</span><br><span class="line">    s.append(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">    s.append(Modifier.toString(item.getModifiers()));</span><br><span class="line">    s.append(<span class="string">&quot; &quot;</span>+ item.getType().getSimpleName() + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    s.append(item.getName()+ <span class="string">&quot;;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">System.out.println(s);</span><br></pre></td></tr></table></figure><h4 id="怎么通过反射机制访问一个Java对象的属性？"><a href="#怎么通过反射机制访问一个Java对象的属性？" class="headerlink" title="怎么通过反射机制访问一个Java对象的属性？"></a>怎么通过反射机制访问一个Java对象的属性？</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">studentClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"><span class="comment">// c 就是 reflectTestFiled 对象，底层调用无参构造</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> stydentClass.newInstance();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 name 属性</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> studentClass.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="comment">// 如果要访问的属性是私有的，需要打破封装才能赋值 【又安全隐患】</span></span><br><span class="line">nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 给name 赋值</span></span><br><span class="line">nameField.set(c, <span class="string">&quot;你的名字&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="反射方法"><a href="#反射方法" class="headerlink" title="反射方法"></a>反射方法</h4><blockquote><p>方法体中的逻辑代码无法反编译</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">userClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有方法</span></span><br><span class="line">Method[] methods = userClass.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span>(Method item: methods) &#123;</span><br><span class="line">    <span class="comment">// 方法返回值类型</span></span><br><span class="line">    item.getReturnType();</span><br><span class="line">    <span class="comment">// 获取方法名字</span></span><br><span class="line">    item.getName();</span><br><span class="line">    <span class="comment">// 获取修饰符列表</span></span><br><span class="line">    Modifier.toString(item.getModifiers());</span><br><span class="line">    <span class="comment">// 方法参数列表</span></span><br><span class="line">    Class[] paramsTypes = item.getParameterTypes();</span><br><span class="line">    <span class="keyword">for</span>(Class parameterType: paramsTypes) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过反射机制怎么调用一个方法？"><a href="#通过反射机制怎么调用一个方法？" class="headerlink" title="通过反射机制怎么调用一个方法？"></a>通过反射机制怎么调用一个方法？</h4><blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">userClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// c 就是 reflectTestFiled 对象，底层调用无参构造</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">c</span> <span class="operator">=</span> userClass.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取方法， 通过方法名，参数列表区分方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">loginMethod</span> <span class="operator">=</span> item.getDeclaredMethod(<span class="string">&quot;login&quot;</span>, String.class, String.class);</span><br><span class="line"><span class="comment">//Method loginMethod = item.getDeclaredMethod(&quot;login&quot;, int.class);</span></span><br><span class="line"><span class="comment">// 调用方法4要素，对象，方法名，参数，返回值</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">retValue</span> <span class="operator">=</span> loginMethod.invoke(c, <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="通过反射机制创建对象"><a href="#通过反射机制创建对象" class="headerlink" title="通过反射机制创建对象"></a>通过反射机制创建对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> c.newInstance();</span><br><span class="line"><span class="comment">// 获取有参构造</span></span><br><span class="line"><span class="type">Construct</span> <span class="variable">con</span> <span class="operator">=</span> c.getDelaredConstrucror(<span class="type">int</span>.class, String.class, String.class, <span class="type">boolean</span>.class);</span><br><span class="line"></span><br><span class="line">con.newInstance(<span class="number">110</span>, <span class="string">&quot;joke&quot;</span>, <span class="string">&quot;1900-10-11&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="通过反射获取一个类的父类，已经实现的接口"><a href="#通过反射获取一个类的父类，已经实现的接口" class="headerlink" title="通过反射获取一个类的父类，已经实现的接口"></a>通过反射获取一个类的父类，已经实现的接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.zkrd.officialwebsite.util.reflectTestFiled&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取父类</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">supClass</span> <span class="operator">=</span> c.getSuperClass();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取父类实现的接口 (一个类可以实现多个接口)</span></span><br><span class="line">Class[] interfaces = c.getInterfaces();</span><br><span class="line"><span class="keyword">for</span>(Class item: interfaces) &#123;</span><br><span class="line">    System.out.println(item.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="可变长度参数"><a href="#可变长度参数" class="headerlink" title="可变长度参数"></a>可变长度参数</h4><blockquote><p>语法： int… args。 根js中的拓展运算符有点类似</p><ul><li>可变长度要求参数个数是：0~N</li><li>可变长度参数只能有一个，而且只能在最后</li><li>可变长度可以当作一个数组处理</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">(<span class="type">int</span> a, Sting... args1)</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><blockquote><p>注解Annotation是一种引用数据类型。编译之后也是生成 xxx.class文件</p><p>语法格式：</p><p>[修饰符列表] @interface 注解类型名 {}</p></blockquote><h4 id="注解可以用在什么地方？"><a href="#注解可以用在什么地方？" class="headerlink" title="注解可以用在什么地方？"></a>注解可以用在什么地方？</h4><ol><li><p>注解使用时的语法格式是：</p><p> @注解类型名</p></li><li><p>注解可以出现在类，属性，方法，变量上…</p><p> 注解还可以出现在注解类型上</p></li></ol><h4 id="JDK内置的注解"><a href="#JDK内置的注解" class="headerlink" title="JDK内置的注解"></a>JDK内置的注解</h4><blockquote><ul><li><p>Deprecated    </p><p>  用Deprecated 注释的程序元素，不鼓励程序员使用这样的元素，通常是因为它很危险或存在更好的选择【此代码已过时】</p></li><li><p>Override </p><p>  表示一个方法重写，给编译器参考的，运行无用</p></li></ul></blockquote><h5 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h5><blockquote><p>用来标注’注解类型的注解，称为元注解</p><p>常见的元注解</p><ul><li><p>Target</p><p>  标示被注解的注解可以使用在哪些地方</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只能出现在方法上</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br></pre></td></tr></table></figure></li><li><p>Retention</p><p>  表示被注解的注解最终保存在哪个位置</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存在Java源代码中</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><h4 id="如果一个注解当中有属性，那么必须给属性赋值-除非有默认值"><a href="#如果一个注解当中有属性，那么必须给属性赋值-除非有默认值" class="headerlink" title="如果一个注解当中有属性，那么必须给属性赋值,除非有默认值"></a>如果一个注解当中有属性，那么必须给属性赋值,除非有默认值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyNonotation &#123;</span><br><span class="line">    <span class="comment">// name 属性</span></span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">color</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;red&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用注解</span></span><br><span class="line"><span class="meta">@MyNonotation(name=&quot;属性值&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果属性名是value, 可以省略不写</span></span><br><span class="line"><span class="meta">@MyNonotation(&quot;属性值&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="注解中的属性可以是？"><a href="#注解中的属性可以是？" class="headerlink" title="注解中的属性可以是？"></a>注解中的属性可以是？</h4><blockquote><p>byte,short,int, long,double,boolean,char,string,class,枚举类型。以及以上每一种的数组形式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 数组大括号, 如果数组只有一项可以省略大括号</span></span><br><span class="line"><span class="meta">@MyNonotation(friend = &#123;&quot;张三&quot;, &#x27;李四&#x27;&#125;, arr = 5)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="反射注解"><a href="#反射注解" class="headerlink" title="反射注解"></a>反射注解</h4><blockquote><p>如果希望这个注解可以被反射：</p><p>@Retention(Retentionpolicy.RUNTIME})</p></blockquote><p><strong>获取某个类上的注解</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&#x27;xxxxx.MyAnnotation.class&#x27;</span>);</span><br><span class="line"><span class="comment">// 判断是否有注解</span></span><br><span class="line"><span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span>  c.isAnnotationPresent(MyAnnotation.class);</span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">    <span class="type">MyAnnotation</span> <span class="variable">annotation</span> <span class="operator">=</span> (MyAnnotation)c.getAnnotation(MyAnnotation.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取注解 value 属性</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取方法上注解自定义属性的值"><a href="#获取方法上注解自定义属性的值" class="headerlink" title="获取方法上注解自定义属性的值"></a>获取方法上注解自定义属性的值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&#x27;xxxxx.MyAnnotation.class&#x27;</span>);</span><br><span class="line"><span class="comment">// 获取方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">doSomeMethod</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;dosome&quot;</span>);</span><br><span class="line"><span class="comment">// 方法中是否有注解</span></span><br><span class="line"><span class="keyword">if</span>(doSomeMethod.isAnnotationPresent(MyAnnotation.class)) &#123;</span><br><span class="line">    <span class="comment">// 获取方法注解</span></span><br><span class="line">    <span class="type">MyAnnotaion</span> <span class="variable">myAnnotaion</span> <span class="operator">=</span> doSomeMethod.getAnnotation(MyAnnotation.class);</span><br><span class="line">    <span class="comment">// 获取注解属性</span></span><br><span class="line">    myAnnotaion.username();</span><br><span class="line">    myAnnotaion.password();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JDK类加载器"><a href="#JDK类加载器" class="headerlink" title="JDK类加载器"></a>JDK类加载器</h3><blockquote><p>负责专门加载类的命令/工具</p><p>jdk 中自带了3个类加载器</p><ul><li>启动类加载器</li><li>扩展类加载器</li><li>应用类加载器</li></ul></blockquote><p>假设这样一段代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br></pre></td></tr></table></figure><p>代码执行前，会将所需要类全部加载到JVM当中。通过类加载器加载，看到以上代码类加载器会找String.class文件，找到就加载，那么是怎么经行加载的呢？</p><ol><li><p>首先<strong>启动类加载器</strong></p><p> ：路径 %JAVA_HOME%/jre/lib/rt.jar [里边都是JDK核心类库]</p></li><li><p>1加载不到就通过<strong>扩展类加载器</strong>加载</p><p> ：路径 %JAVA_HOME%/jre/lib/ext</p></li><li><p>如果2也找不到就会通过<strong>应用类加载器</strong>加载</p><p> 注意：应用类加载器专门加载：classoath中的类</p></li></ol><blockquote><p>优先从 1（父）2（母）【双亲委派机制】加载，防止类加载代码植入</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;java-特性&quot;&gt;&lt;a href=&quot;#java-特性&quot; class=&quot;headerlink&quot; title=&quot;java 特性&quot;&gt;&lt;/a&gt;java 特性&lt;/h2&gt;&lt;h3 id=&quot;Java-程序的版本&quot;&gt;&lt;a href=&quot;#Java-程序的版本&quot; class=&quot;headerlink&quot; title=&quot;Java 程序的版本&quot;&gt;&lt;/a&gt;Java 程序的版本&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;java SE (标准版)&lt;/p&gt;
&lt;p&gt;java EE（企业版）&lt;/p&gt;
&lt;p&gt;java ME（精简版）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;java-程序可移植性&quot;&gt;&lt;a href=&quot;#java-程序可移植性&quot; class=&quot;headerlink&quot; title=&quot;java 程序可移植性&quot;&gt;&lt;/a&gt;java 程序可移植性&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;什么是可移植性？&lt;/p&gt;
&lt;p&gt;java 程序可以做到一次编译，到处运行。可就是说可以运行到windows,linux等操作系统上。这个被称作Java程序的可移植性，或者叫跨平台。&lt;/p&gt;
&lt;p&gt;如何实现呢？&lt;/p&gt;
&lt;p&gt;Windows操作系统于Linux操作系统的内核肯定不一样，系统执行指令的而方式也不一样。 Java程序不能直接和系统打交道，因为Java程序只有一份。操作系统原理都不同&lt;/p&gt;
&lt;p&gt;解决：&lt;/p&gt;
&lt;p&gt;sum团队想到了一个办法，他们让Java程序运行在一台虚拟的计算机中，这个虚拟计算机叫Java虚拟机，简称JVM。Java虚拟机再和底层操作系统打交道。&lt;/p&gt;
&lt;p&gt;这个虚拟机不能直接安装，而是通过安装适合自己操作系统的 &lt;strong&gt;java jdk&lt;/strong&gt; 来实现的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;Java-的加载与执行&quot;&gt;&lt;a href=&quot;#Java-的加载与执行&quot; class=&quot;headerlink&quot; title=&quot;Java 的加载与执行&quot;&gt;&lt;/a&gt;Java 的加载与执行&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;编译阶段主要任务是检查 Java 源程序是否符合 Java 语法（不进行运算），符合则生成正常字节码文件 (xxx.class)。不符合则无法生成字节码文件&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;.java -&amp;gt; .class -&amp;gt;     类装载器 -&amp;gt; java 虚拟机（JVM） -&amp;gt; 操作系统 -&amp;gt; 硬件平台&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://wyf195075595.github.io/categories/java/"/>
    
    
    <category term="java基础" scheme="https://wyf195075595.github.io/tags/java%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>你不知道的JavaScript</title>
    <link href="https://wyf195075595.github.io/2022/11/15/programming/javascript/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript/"/>
    <id>https://wyf195075595.github.io/2022/11/15/programming/javascript/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript/</id>
    <published>2022-11-15T00:58:10.000Z</published>
    <updated>2022-12-08T06:28:40.482Z</updated>
    
    <content type="html"><![CDATA[<p><strong>LHS与RHS</strong></p><blockquote><p>LHS和RHS的含义是“赋值操作的左侧或右侧”并不一定意味着就是“=赋值操作符的左侧或右侧”。赋值操作还有其他几种形式，因此在概念上最好将其理解为“赋值操作的目标是谁（LHS）”以及“谁是赋值操作的源头（RHS）”</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> b = a;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c = <span class="title function_">foo</span>(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>1．找到其中所有的LHS查询。（这里有3处！）</p><p>2．找到其中所有的RHS查询。（这里有4处！）</p><p><strong>ReferenceError</strong></p><blockquote><p>如果RHS查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出ReferenceError异常.</p><p>相较之下，当引擎执行LHS查询时，如果在顶层（全局作用域）中也无法找到目标变量，全局作用域中就会创建一个具有该名称的变量，并将其返还给引擎，前提是程序运行在非“严格模式”下。</p></blockquote><p><strong>TypeError</strong></p><blockquote><p>ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或不合理的。</p></blockquote><span id="more"></span><h2 id="词法作用域"><a href="#词法作用域" class="headerlink" title="词法作用域"></a>词法作用域</h2><blockquote><p>作用域共有两种主要的工作模型。第一种是最为普遍的，被大多数编程语言所采用的词法作用域，我们会对这种作用域进行深入讨论。另外一种叫作动态作用域，仍有一些编程语言在使用（比如Bash脚本、Perl中的一些模式等）。</p></blockquote><h3 id="词法阶段"><a href="#词法阶段" class="headerlink" title="词法阶段"></a>词法阶段</h3><blockquote><p>大部分标准语言编译器的第一个工作阶段叫作词法化（也叫单词化）。回忆一下，词法化的过程会对源代码中的字符进行检查，如果是有状态的解析过程，还会赋予单词语义。这个概念是理解词法作用域及其名称来历的基础。</p></blockquote><h4 id="屏蔽效应"><a href="#屏蔽效应" class="headerlink" title="屏蔽效应"></a><strong>屏蔽效应</strong></h4><blockquote><p>作用域查找会在找到第一个匹配的标识符时停止。在多层的嵌套作用域中可以定义同名的标识符，这叫作“遮蔽效应”（内部的标识符“遮蔽”了外部的标识符）</p></blockquote><p>全局变量会自动成为全局对象（比如浏览器中的window对象）的属性，因此可以不直接通过全局对象的词法名称，而是间接地通过对全局对象属性的引用来对其进行访问。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">a</span></span><br></pre></td></tr></table></figure><p>通过这种技术可以访问那些被同名变量所遮蔽的全局变量。但非全局的变量如果被遮蔽了，无论如何都无法被访问到。</p><h3 id="欺骗词法"><a href="#欺骗词法" class="headerlink" title="欺骗词法"></a><strong>欺骗词法</strong></h3><blockquote><p>如果词法作用域完全由写代码期间函数所声明的位置来定义，怎样才能在运行时来“修改”（也可以说欺骗）词法作用域呢？</p></blockquote><h4 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h4><blockquote><p>eval(..)函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码</p></blockquote><p>JavaScript中还有其他一些功能效果和eval(..)很相似。setTimeout(..)和setInterval(..)的第一个参数可以是字符串，字符串的内容可以被解释为一段动态生成的函数代码。这些功能已经过时且并不被提倡。不要使用它们！</p><p>new Function(..)函数的行为也很类似，最后一个参数可以接受代码字符串，并将其转化为动态生成的函数（前面的参数是这个新生成的函数的形参）。这种构建函数的语法比eval(..)略微安全一些，但也要尽量避免使用。</p><h4 id="with"><a href="#with" class="headerlink" title="with"></a>with</h4><blockquote><p>JavaScript中另一个难以掌握（并且现在也不推荐使用）的用来欺骗词法作用域的功能是with关键字</p></blockquote><p>with通常被当作重复引用同一个对象中的多个属性的快捷方式，可以不需要重复引用对象本身。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 单调乏味的重复&quot;obj&quot;</span></span><br><span class="line">obj.<span class="property">a</span> = <span class="number">2</span>;</span><br><span class="line">obj.<span class="property">b</span> = <span class="number">3</span>;</span><br><span class="line">obj.<span class="property">c</span> = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// 简单的快捷方式</span></span><br><span class="line"><span class="keyword">with</span> (obj) &#123;</span><br><span class="line">    a = <span class="number">3</span>;</span><br><span class="line">    b = <span class="number">4</span>;</span><br><span class="line">    c = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>尽管with块可以将一个对象处理为词法作用域，但是这个块内部正常的var声明并不会被限制在这个块的作用域中，而是被添加到with所处的函数作用域中。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">with</span> (obj) &#123;</span><br><span class="line">      a = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> o2 = &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">foo</span>(o1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o1.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">foo</span>(o2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o2.<span class="property">a</span>); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2——不好，a被泄漏到全局作用域上了！</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>eval(..)函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域，而with声明实际上是根据你传递给它的对象凭空创建了一个全新的词法作用域。</strong></p></blockquote><blockquote><p>另外一个不推荐使用eval(..)和with的原因是会被严格模式所影响（限制）。with被完全禁止，而在保留核心功能的前提下，间接或非安全地使用eval(..)也被禁止了</p></blockquote><h2 id="函数作用域和块级作用域"><a href="#函数作用域和块级作用域" class="headerlink" title="函数作用域和块级作用域"></a>函数作用域和块级作用域</h2><blockquote><p><strong>区分函数声明和表达式</strong>最简单的方法是看function关键字出现在声明中的位置（不仅仅是一行代码，而是整个声明中的位置）。如果function是声明中的第一个词，那么就是一个函数声明，否则就是一个函数表达式。</p></blockquote><h3 id="匿名和具名"><a href="#匿名和具名" class="headerlink" title="匿名和具名"></a>匿名和具名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;I waited 1 second! &quot;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span> );</span><br></pre></td></tr></table></figure><blockquote><p>这叫作匿sss名函数表达式，因为function().．没有名称标识符。函数表达式可以是匿名的，而函数声明则不可以省略函数名——在JavaScript的语法中这是非法的。</p></blockquote><p>1．匿名函数在栈追踪中不会显示出有意义的函数名，使得调试很困难。</p><p>2．如果没有函数名，当函数需要引用自身时只能使用已经过期的arguments.callee引用，比如在递归中。另一个函数需要引用自身的例子，是在事件触发后事件监听器需要解绑自身。</p><p>3．匿名函数省略了对于代码可读性/可理解性很重要的函数名。一个描述性的名称可以让代码不言自明。</p><h4 id="立即执行函数表达式"><a href="#立即执行函数表达式" class="headerlink" title="立即执行函数表达式"></a>立即执行函数表达式</h4><blockquote><p>这种模式很常见，几年前社区给它规定了一个术语：IIFE，代表立即执行函数表达式（Immediately Invoked Function Expression）；</p><p>函数名对IIFE当然不是必须的，IIFE最常见的用法是使用一个匿名函数表达式。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 3</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>相较于传统的IIFE形式，很多人都更喜欢另一个改进的形式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123; .. &#125;())</span><br></pre></td></tr></table></figure><p><strong>IIFE的另一个非常普遍的进阶用法是把它们当作函数调用并传递参数进去。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> <span class="title function_">IIFE</span>(<span class="params"><span class="variable language_">global</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">global</span>.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">&#125;)(<span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p><strong>IIFE还有一种变化的用途是倒置代码的运行顺序，将需要运行的函数放在第二位，在IIFE执行之后当作参数传递进去。这种模式在UMD（Universal Module Definition）项目中被广泛使用。尽管这种模式略显冗长，但有些人认为它更易理解。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> <span class="title function_">IIFE</span>(<span class="params">def</span>) &#123;</span><br><span class="line">    <span class="title function_">def</span>(<span class="variable language_">window</span>);</span><br><span class="line">&#125;)(<span class="keyword">function</span> <span class="title function_">def</span>(<span class="params"><span class="variable language_">global</span></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">global</span>.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for 循环块级作用域</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if 块级作用域</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (foo) &#123;</span><br><span class="line">    <span class="keyword">var</span> bar = foo * <span class="number">2</span>;</span><br><span class="line">    bar = <span class="title function_">something</span>(bar);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="with-1"><a href="#with-1" class="headerlink" title="with"></a>with</h4><blockquote><p>我们在第2章讨论过with关键字。它不仅是一个难于理解的结构，同时也是块作用域的一个例子（块作用域的一种形式），用with从对象中创建出的作用域仅在with声明中而非外部作用域中有效</p></blockquote><h4 id="try-catch"><a href="#try-catch" class="headerlink" title="try/catch"></a>try/catch</h4><blockquote><p>非常少有人会注意到JavaScript的ES3规范中规定try/catch的catch分句会创建一个块作用域，其中声明的变量仅在catch内部有效。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">undefined</span>(); <span class="comment">// 执行一个非法操作来强制制造一个异常</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// 能够正常执行！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// ReferenceError: err not found</span></span><br></pre></td></tr></table></figure><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><blockquote><p>let关键字可以将变量绑定到所在的任意作用域中（通常是{ .. }内部）。换句话说，let为其声明的变量隐式地劫持了所在的块作用域。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="literal">true</span>    </span><br><span class="line"><span class="keyword">if</span> (foo) &#123;</span><br><span class="line">        &#123; <span class="comment">// &lt;-- 显式的块</span></span><br><span class="line">          <span class="keyword">let</span> bar = foo ＊ <span class="number">2</span>;</span><br><span class="line">          bar = <span class="title function_">something</span>(bar);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(bar);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// ReferenceError</span></span><br></pre></td></tr></table></figure><blockquote><p>只要声明是有效的，在声明中的任意位置都可以使用{ .. }括号来为let创建一个用于绑定的块。在这个例子中，我们在if声明内部显式地创建了一个块，如果需要对其进行重构，整个块都可以被方便地移动而不会对外部if声明的位置和语义产生任何影响</p></blockquote><h4 id="垃圾收集"><a href="#垃圾收集" class="headerlink" title="垃圾收集"></a>垃圾收集</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">        </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">process</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 在这里做点有趣的事情</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> someReallyBigData = &#123; ..&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">process</span>(someReallyBigData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;my button&quot;</span>);</span><br><span class="line"></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> <span class="title function_">click</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;button clicked&quot;</span>);</span><br><span class="line">&#125;, <span class="comment">/*capturingPhase=*/</span><span class="literal">false</span> );</span><br></pre></td></tr></table></figure><blockquote><p>click函数的点击回调并不需要someReallyBigData变量。理论上这意味着当process(..)执行后，在内存中占用大量空间的数据结构就可以被垃圾回收了。但是，由于click函数形成了一个覆盖整个作用域的闭包，JavaScript引擎极有可能依然保存着这个结构（取决于具体实现）。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">process</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 在这里做点有趣的事情</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这个块中定义的内容完事可以销毁！</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> someReallyBigData = &#123; .. &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">process</span>(someReallyBigData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;my button&quot;</span>);</span><br><span class="line"></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> <span class="title function_">click</span>(<span class="params">evt</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;button clicked&quot;</span>);</span><br><span class="line">&#125;, <span class="comment">/*capturingPhase=*/</span><span class="literal">false</span> );</span><br></pre></td></tr></table></figure><h4 id="const"><a href="#const" class="headerlink" title="const"></a>const</h4><blockquote><p>除了let以外，ES6还引入了const，同样可以用来创建块作用域变量，但其值是固定的（常量）。之后任何试图修改值的操作都会引起错误。</p></blockquote><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><blockquote><p>函数是JavaScript中最常见的作用域单元。本质上，声明在一个函数内部的变量或函数会在所处的作用域中“隐藏”起来，这是有意为之的良好软件的设计原则。但函数不是唯一的作用域单元。块作用域指的是变量和函数不仅可以属于所处的作用域，也可以属于某个代码块（通常指{ .. }内部）。从ES3开始，try/catch结构在catch分句中具有块作用域。在ES6中引入了let关键字（var关键字的表亲），用来在任意代码块中声明变量。if (..) { let a = 2; }会声明一个劫持了if的{ .. }块的变量，并且将变量添加到这个块中。有些人认为块作用域不应该完全作为函数作用域的替代方案。两种功能应该同时存在，开发者可以并且也应该根据需要选择使用何种作用域，创造可读、可维护的优良代码。</p></blockquote><h2 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h2><blockquote><p>变量和函数声明都会在作用域提升</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)<span class="comment">// undefined</span></span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">a = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><strong>函数表达式却不会被提升</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 不是ReferenceError, 而是TypeError!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// TypeError</span></span><br><span class="line"><span class="title function_">bar</span>(); <span class="comment">// ReferenceError</span></span><br><span class="line"></span><br><span class="line">foo = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> bar = ...self...</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数优先"><a href="#函数优先" class="headerlink" title="函数优先"></a>函数优先</h4><blockquote><p>函数声明和变量声明都会被提升。但是一个值得注意的细节（这个细节可以出现在有多个“重复”声明的代码中）是函数会首先被提升，然后才是变量。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>会输出1而不是2！这个代码片段会被引擎理解为如下形式：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">foo = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>注意，var foo尽管出现在function foo()..．的声明之前，但它是重复的声明（因此被忽略了），因为函数声明会被提升到普通变量之前。</p></blockquote><h2 id="作用域闭包"><a href="#作用域闭包" class="headerlink" title="作用域闭包"></a>作用域闭包</h2><blockquote><p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure><p><strong>这是闭包吗？</strong></p><blockquote><p>技术上来讲，也许是。但根据前面的定义，确切地说并不是。我认为最准确地用来解释bar()对a的引用的方法是词法作用域的查找规则，而这些规则只是闭包的一部分。（但却是非常重要的一部分！）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> baz = <span class="title function_">foo</span>();</span><br><span class="line"><span class="title function_">baz</span>(); <span class="comment">// 2——朋友，这就是闭包的效果。</span></span><br></pre></td></tr></table></figure><blockquote><p>无论通过何种手段将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</p></blockquote><h3 id="循环和闭包"><a href="#循环和闭包" class="headerlink" title="循环和闭包"></a>循环和闭包</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">    &#125;, i＊<span class="number">1000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>正常情况下，我们对这段代码行为的预期是分别输出数字1～5，每秒一次，每次一个。但实际上，这段代码在运行时会以每秒一次的频率输出五次6。</p><p><strong>延迟函数的回调会在循环结束时才执行</strong>。事实上，当定时器运行时即使每个迭代中执行的是setTimeout(.., 0)，所有的回调函数依然是在循环结束后才会被执行，因此会每次输出一个6出来。</p></blockquote><p><strong>利用IIFE</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">    (<span class="keyword">function</span>(<span class="params">j</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(j);</span><br><span class="line">      &#125;, j*<span class="number">1000</span> );</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在迭代内使用IIFE会为每个迭代都生成一个新的作用域，使得延迟函数的回调可以将新的作用域封闭在每个迭代内部，每个迭代中都会含有一个具有正确值的变量供我们访问。</p><p>本质上这是将一个块转换成一个可以被关闭的作用域</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">1</span>; i&lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">    &#125;, i*<span class="number">1000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><blockquote><p>模块模式需要具备两个必要条件。</p><p>1．必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）。</p><p>2．封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">CoolModule</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> something = <span class="string">&quot;cool&quot;</span>;    </span><br><span class="line">    <span class="keyword">var</span> another = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(something);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">doAnother</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(another.<span class="title function_">join</span>(<span class="string">&quot; ! &quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">doSomething</span>: doSomething,</span><br><span class="line">        <span class="attr">doAnother</span>: doAnother</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="title class_">CoolModule</span>();</span><br><span class="line"></span><br><span class="line">foo.<span class="title function_">doSomething</span>(); <span class="comment">// cool</span></span><br><span class="line">foo.<span class="title function_">doAnother</span>(); <span class="comment">// 1 ! 2 ! 3</span></span><br></pre></td></tr></table></figure><h3 id="现代的模块机制"><a href="#现代的模块机制" class="headerlink" title="现代的模块机制"></a>现代的模块机制</h3><blockquote><p>大多数模块依赖加载器/管理器本质上都是将这种模块定义封装进一个友好的API。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">MyModules</span> = (<span class="keyword">function</span> <span class="title function_">Manager</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> modules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">define</span>(<span class="params">name, deps, impl</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;deps.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          deps[i] = modules[deps[i]];</span><br><span class="line">      &#125;</span><br><span class="line">      modules[name] = impl.<span class="title function_">apply</span>(impl, deps);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> modules[name];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">define</span>: define,</span><br><span class="line">        <span class="attr">get</span>: get</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><strong>定义模块</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">MyModules</span>.<span class="title function_">define</span>(<span class="string">&quot;bar&quot;</span>, [], <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params">who</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Let me introduce: &quot;</span> + who;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">hello</span>: hello</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="title class_">MyModules</span>.<span class="title function_">define</span>(<span class="string">&quot;foo&quot;</span>, [<span class="string">&quot;bar&quot;</span>], <span class="keyword">function</span>(<span class="params">bar</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hungry = <span class="string">&quot;hippo&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">awesome</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="title function_">hello</span>(hungry).<span class="title function_">toUpperCase</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">awesome</span>: awesome</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="title class_">MyModules</span>.<span class="title function_">get</span>(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> foo = <span class="title class_">MyModules</span>.<span class="title function_">get</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    bar.<span class="title function_">hello</span>(<span class="string">&quot;hippo&quot;</span>)</span><br><span class="line">); <span class="comment">// Let me introduce: hippo</span></span><br><span class="line">foo.<span class="title function_">awesome</span>(); <span class="comment">// LET ME INTRODUCE: HIPPO</span></span><br></pre></td></tr></table></figure><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><blockquote><p>当函数可以记住并访问所在的词法作用域，即使函数是在当前词法作用域之外执行，这时就产生了闭包。</p><p>模块有两个主要特征：</p><p>（1）为创建内部作用域而调用了一个包装函数；</p><p>（2）包装函数的返回值必须至少包括一个对内部函数的引用，这样就会创建涵盖整个包装函数内部作用域的闭包。</p></blockquote><h2 id="关于this"><a href="#关于this" class="headerlink" title="关于this"></a>关于this</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">identify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>.<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> greeting = <span class="string">&quot;Hello, I&#x27;m &quot;</span> + identify.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> me = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Kyle&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> you = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Reader&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">identify.<span class="title function_">call</span>(me); <span class="comment">// KYLE</span></span><br><span class="line">identify.<span class="title function_">call</span>(you); <span class="comment">// READER</span></span><br><span class="line"></span><br><span class="line">speak.<span class="title function_">call</span>(me); <span class="comment">// Hello, 我是KYLE</span></span><br><span class="line">speak.<span class="title function_">call</span>(you); <span class="comment">// Hello, 我是READER</span></span><br></pre></td></tr></table></figure><p><strong>为什么要使用this?</strong></p><blockquote><p>这段代码可以在不同的上下文对象（me和you）中重复使用函数identify()和speak()，不用针对每个对象编写不同版本的函数。</p><p>如果不使用this，那就需要给identify()和speak()显式传入一个上下文对象。</p><p>this提供了一种更优雅的方式来隐式“传递”一个对象引用，因此可以将API设计得更加简洁并且易于复用。</p></blockquote><h3 id="对this的误解"><a href="#对this的误解" class="headerlink" title="对this的误解"></a>对this的误解</h3><h4 id="指向自身"><a href="#指向自身" class="headerlink" title="指向自身"></a>指向自身</h4><blockquote><p>人们很容易把this理解成指向函数自身，这个推断从英语的语法角度来说是说得通的。</p></blockquote><p>记录一下函数foo被调用的次数，思考一下下面的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;foo: &quot;</span> + num);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录foo被调用的次数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">5</span>) &#123;</span><br><span class="line">      <span class="title function_">foo</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// foo: 6</span></span><br><span class="line"><span class="comment">// foo: 7</span></span><br><span class="line"><span class="comment">// foo: 8</span></span><br><span class="line"><span class="comment">// foo: 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// foo被调用了多少次？</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">count</span>); <span class="comment">// 0 -- 什么？！</span></span><br></pre></td></tr></table></figure><blockquote><p>this.count 和 foo.count 不是同一个东西，也就是说this 不是指向函数自身</p></blockquote><blockquote><p>如果要从函数对象内部引用它自身，那只使用this是不够的。一般来说你需要通过一个指向函数对象的词法标识符（变量）来引用它。</p><p>还有一种传统的但是现在已经被弃用和批判的用法，是使用arguments. callee来引用当前正在运行的函数对象。这是唯一一种可以从匿名函数对象内部引用自身的方法。</p></blockquote><h4 id="this指向函数的作用域"><a href="#this指向函数的作用域" class="headerlink" title="this指向函数的作用域"></a>this指向函数的作用域</h4><blockquote><p>这个问题有点复杂，因为在某种情况下它是正确的，但是在其他情况下它却是错误的。</p></blockquote><p>思考一下下面的代码，它试图（但是没有成功）跨越边界，使用this来隐式引用函数的词法作用域：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure><blockquote><p>首先，这段代码试图通过this.bar()来引用bar()函数。这样调用能成功纯属意外</p><p>调用bar()最自然的方法是省略前面的this，直接使用词法引用标识符。</p><p>编写这段代码的开发者还试图使用this联通foo()和bar()的词法作用域，从而让bar()可以访问foo()作用域里的变量a。这是不可能实现的，使用this不可能在词法作用域中查到什么。</p></blockquote><h3 id="this到底是什么"><a href="#this到底是什么" class="headerlink" title="this到底是什么"></a>this到底是什么</h3><blockquote><p>this是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于函数调用时的各种条件。<strong>this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</strong></p></blockquote><h3 id="调用位置"><a href="#调用位置" class="headerlink" title="调用位置"></a>调用位置</h3><blockquote><p>在理解this的绑定过程之前，首先要理解调用位置：调用位置就是函数在代码中被调用的位置（而不是声明的位置）。只有仔细分析调用位置才能回答这个问题：这个this到底引用的是什么？</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 当前调用栈是：baz</span></span><br><span class="line">    <span class="comment">// 因此，当前调用位置是全局作用域</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;baz&quot;</span>);</span><br><span class="line">    <span class="title function_">bar</span>(); <span class="comment">// &lt;-- bar的调用位置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 当前调用栈是baz -&gt; bar</span></span><br><span class="line">    <span class="comment">// 因此，当前调用位置在baz中</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    <span class="title function_">foo</span>(); <span class="comment">// &lt;-- foo的调用位置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 当前调用栈是baz -&gt; bar -&gt; foo</span></span><br><span class="line">    <span class="comment">// 因此，当前调用位置在bar中</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">baz</span>(); <span class="comment">// &lt;-- baz的调用位置</span></span><br></pre></td></tr></table></figure><h3 id="默认绑定"><a href="#默认绑定" class="headerlink" title="默认绑定"></a>默认绑定</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>我们可以看到当调用foo()时，this.a被解析成了全局变量a。为什么？因为在本例中，<strong>函数调用时应用了this的默认绑定，因此this指向全局对象。</strong></p><p>【注意】<strong>前提是在 非strict mode下</strong></p></blockquote><h3 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>无论你如何称呼这个模式，当foo()被调用时，它的前面确实加上了对obj的引用。当函数引用有上下文对象时，隐式绑定规则会把函数调用中的this绑定到这个上下文对象。因为调用foo()时this被绑定到obj，因此this.a和obj.a是一样的。</p></blockquote><p><strong>对象属性引用链中只有上一层或者说最后一层在调用位置中起作用。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">obj2</span>: obj2</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj1.<span class="property">obj2</span>.<span class="title function_">foo</span>(); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><h3 id="隐式丢失"><a href="#隐式丢失" class="headerlink" title="隐式丢失"></a>隐式丢失</h3><blockquote><p>一个最常见的this绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说它会应用默认绑定，从而把this绑定到全局对象或者undefined上，取决于是否是严格模式。</p></blockquote><p>示例1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = obj.<span class="property">foo</span>; <span class="comment">// 函数别名！</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;oops, global&quot;</span>; <span class="comment">// a是全局对象的属性</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">bar</span>(); <span class="comment">// &quot;oops, global&quot;</span></span><br></pre></td></tr></table></figure><p>示例2</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doFoo</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="comment">// fn其实引用的是foo</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">fn</span>(); <span class="comment">// &lt;-- 调用位置！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;oops, global&quot;</span>; <span class="comment">// a是全局对象的属性</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">doFoo</span>(obj.<span class="property">foo</span>); <span class="comment">// &quot;oops, global&quot;</span></span><br></pre></td></tr></table></figure><h3 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a>显式绑定</h3><blockquote><p>在分析隐式绑定时，我们必须在一个对象内部包含一个指向函数的属性，并通过这个属性间接引用函数，从而把this间接（隐式）绑定到这个对象上。</p><p>可以使用函数的<strong>call</strong>(..)和<strong>apply</strong>(..)方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">foo.<span class="title function_">call</span>(obj); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>通过foo.call(..)，我们可以在调用foo时强制把它的this绑定到obj上。</p><p>如果你传入了一个原始值（字符串类型、布尔类型或者数字类型）来当作this的绑定对象，这个原始值会被转换成它的对象形式（也就是new String(..)、new Boolean(..)或者new Number(..)）。这通常被称为“装箱”。</p></blockquote><p><strong>硬绑定</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">something</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>, something);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">a</span> + something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单的辅助绑定函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bind</span>(<span class="params">fn, obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="title function_">bind</span>(foo, obj);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">bar</span>(<span class="number">3</span>); <span class="comment">// 2 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><p>由于硬绑定是一种非常常用的模式，所以ES5提供了内置的方法Function.prototype.bind，它的用法如下：</p><h3 id="new-绑定"><a href="#new-绑定" class="headerlink" title="new 绑定"></a>new 绑定</h3><blockquote><p>使用new来调用函数，或者说发生构造函数调用时，会自动执行下面的操作。</p><p>1．创建（或者说构造）一个全新的对象。</p><p>2．这个新对象会被执行[[Prototype]]连接。</p><p>3．这个新对象会绑定到函数调用的this。</p><p>4．如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> <span class="title function_">foo</span>(<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="property">a</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="API调用的“上下文”"><a href="#API调用的“上下文”" class="headerlink" title="API调用的“上下文”"></a>API调用的“上下文”</h3><blockquote><p>第三方库的许多函数，以及JavaScript语言和宿主环境中许多新的内置函数，都提供了一个可选的参数，通常被称为“上下文”（context），其作用和bind(..)一样，确保你的回调函数使用指定的this。举例来说：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(el, <span class="variable language_">this</span>.<span class="property">id</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;awesome&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用foo(..)时把this绑定到obj</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].<span class="title function_">forEach</span>(foo, obj);</span><br><span class="line"><span class="comment">// 1 awesome 2 awesome 3 awesome</span></span><br></pre></td></tr></table></figure><blockquote><p>这些函数实际上就是通过call(..)或者apply(..)实现了显式绑定，这样你可以少写一些代码。</p></blockquote><h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p><strong>隐式绑定和显式绑定哪个优先级更高？</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj1.<span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br><span class="line">obj2.<span class="title function_">foo</span>(); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">obj1.<span class="property">foo</span>.<span class="title function_">call</span>(obj2); <span class="comment">// 3</span></span><br><span class="line">obj2.<span class="property">foo</span>.<span class="title function_">call</span>(obj1); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>可以看到，显式绑定优先级更高，也就是说在判断时应当先考虑是否可以存在显式绑定</p></blockquote><p><strong>new绑定和隐式绑定的优先级谁高谁低?</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">something</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">foo</span>: foo</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj1.<span class="title function_">foo</span>(<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">obj1.<span class="property">foo</span>.<span class="title function_">call</span>(obj2, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2.<span class="property">a</span>); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> obj1.<span class="title function_">foo</span>(<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="property">a</span>); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><blockquote><p>可以看到new绑定比隐式绑定优先级高</p></blockquote><p><strong>new绑定和显式绑定谁的优先级更高呢？</strong></p><blockquote><p>new和call/apply无法一起使用，因此无法通过new foo.call(obj1)来直接进行测试。但是我们可以使用硬绑定（显示绑定的一种）来测试它俩的优先级。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">something</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="property">bind</span> (obj1);</span><br><span class="line"><span class="title function_">bar</span>(<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> baz = <span class="keyword">new</span> <span class="title function_">bar</span>(<span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(baz.<span class="property">a</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="判断this"><a href="#判断this" class="headerlink" title="判断this"></a>判断this</h3><blockquote><p>现在我们可以根据优先级来判断函数在某个调用位置应用的是哪条规则。可以按照下面的顺序来进行判断：</p></blockquote><ol><li><p>函数是否在new中调用（new绑定）？如果是的话this绑定的是新创建的对象。</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> <span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure></li><li><p>函数是否通过call、apply（显式绑定）或者硬绑定调用？如果是的话，this绑定的是指定的对象。</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">call</span>(obj2)</span><br></pre></td></tr></table></figure></li><li><p>函数是否在某个上下文对象中调用（隐式绑定）？如果是的话，this绑定的是那个上下文对象。</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = obj1.<span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure></li><li><p>如果都不是的话，使用默认绑定。如果在严格模式下，就绑定到undefined，否则绑定到全局对象。</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = <span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure></li></ol><h3 id="绑定例外"><a href="#绑定例外" class="headerlink" title="绑定例外"></a>绑定例外</h3><blockquote><p>规则总有例外，这里也一样。</p><p>在某些场景下this的绑定行为会出乎意料，你认为应当应用其他绑定规则时，实际上应用的可能是默认绑定规则</p></blockquote><h4 id="被忽略的this"><a href="#被忽略的this" class="headerlink" title="被忽略的this"></a>被忽略的this</h4><blockquote><p>如果你把null或者undefined作为this的绑定对象传入call、apply或者bind，这些值在调用时会被忽略，实际应用的是默认绑定规则：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">foo.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>当我们的函数不需要关心this指向只关心参数时，但第一个参数需要占位符，null是一个不错的选择</p><p>然而，总是使用null来忽略this绑定可能产生一些副作用。如果某个函数确实使用了this（比如第三方库中的一个函数），那默认绑定规则会把this绑定到全局对象（在浏览器中这个对象是window），这将导致不可预计的后果（比如修改全局对象）。</p></blockquote><h4 id="更安全的this"><a href="#更安全的this" class="headerlink" title="更安全的this"></a>更安全的this</h4><blockquote><p>一种“更安全”的做法是传入一个特殊的对象，把this绑定到这个对象不会对你的程序产生任何副作用.</p><p>我们可以创建一个“DMZ”（demilitarized zone，非军事区）对象——它就是一个空的非委托的对象</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;a:&quot;</span> + a + <span class="string">&quot;, b:&quot;</span> + b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们的DMZ空对象</span></span><br><span class="line"><span class="keyword">var</span> ø = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把数组展开成参数</span></span><br><span class="line">foo.<span class="title function_">apply</span>(ø, [<span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// a:2, b:3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用bind(..)进行柯里化</span></span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">bind</span>(ø, <span class="number">2</span>);</span><br><span class="line"><span class="title function_">bar</span>(<span class="number">3</span>); <span class="comment">// a:2, b:3</span></span><br></pre></td></tr></table></figure><h4 id="间接引用"><a href="#间接引用" class="headerlink" title="间接引用"></a>间接引用</h4><blockquote><p>另一个需要注意的是，你有可能（有意或者无意地）创建一个函数的“间接引用”，在这种情况下，调用这个函数会应用默认绑定规则。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> o = &#123; <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">foo</span>: foo &#125;;</span><br><span class="line"><span class="keyword">var</span> p = &#123; <span class="attr">a</span>: <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line">o.<span class="title function_">foo</span>(); <span class="comment">// 3</span></span><br><span class="line">(p.<span class="property">foo</span> = o.<span class="property">foo</span>)(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>赋值表达式p.foo = o.foo的返回值是目标函数的引用，因此调用位置是foo()而不是p.foo()或者o.foo()。根据我们之前说过的，这里会应用默认绑定。</p><p>注意：对于默认绑定来说，决定this绑定对象的并不是调用位置是否处于严格模式，而是函数体是否处于严格模式。如果函数体处于严格模式，this会被绑定到undefined，否则this会被绑定到全局对象。</p></blockquote><h4 id="软绑定"><a href="#软绑定" class="headerlink" title="软绑定"></a>软绑定</h4><blockquote><p>之前我们已经看到过，硬绑定这种方式可以把this强制绑定到指定的对象（除了使用new时），防止函数调用应用默认绑定规则。问题在于，硬绑定会大大降低函数的灵活性，使用硬绑定之后就无法使用隐式绑定或者显式绑定来修改this。</p><p>如果可以给默认绑定指定一个全局对象和undefined以外的值，那就可以实现和硬绑定相同的效果，同时保留隐式绑定或者显式绑定修改this的能力</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">softBind</span>) &#123;</span><br><span class="line">    <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">softBind</span> = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> fn = <span class="variable language_">this</span>;</span><br><span class="line">      <span class="comment">// 捕获所有 curried 参数</span></span><br><span class="line">      <span class="keyword">var</span> curried = [].<span class="property">slice</span>.<span class="property">call</span> (<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">var</span> bound = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> fn.<span class="title function_">apply</span>(</span><br><span class="line">              (! <span class="variable language_">this</span> || <span class="variable language_">this</span> === (<span class="variable language_">window</span> || <span class="variable language_">global</span>)) ?</span><br><span class="line">                  obj : <span class="variable language_">this</span>,</span><br><span class="line">              curried.<span class="property">concat</span>.<span class="title function_">apply</span>(curried, <span class="variable language_">arguments</span>)</span><br><span class="line">          );</span><br><span class="line">      &#125;;</span><br><span class="line">      bound.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(fn.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">      <span class="keyword">return</span> bound;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>它会对指定的函数进行封装，首先检查调用时的this，如果this绑定到全局对象或者undefined，那就把指定的默认对象obj绑定到this，否则不会修改this</p></blockquote><h3 id="this-词法"><a href="#this-词法" class="headerlink" title="this 词法"></a>this 词法</h3><blockquote><p>之前介绍的四条规则已经可以包含所有正常的函数。但是ES6中介绍了一种无法使用这些规则的特殊函数类型：箭头函数。</p><p>箭头函数并不是使用function关键字定义的，而是使用被称为“胖箭头”的操作符=&gt;定义的。箭头函数不使用this的四种标准规则，而是根据外层（函数或者全局）作用域来决定this。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 返回一个箭头函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//this继承自foo()</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">call</span>(obj1);</span><br><span class="line">bar.<span class="title function_">call</span>(obj2); <span class="comment">// 2, 不是3！</span></span><br></pre></td></tr></table></figure><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><blockquote><p>如果要判断一个运行中函数的this绑定，就需要找到这个函数的直接调用位置。找到之后就可以顺序应用下面这四条规则来判断this的绑定对象。</p><p>1．由new调用？绑定到新创建的对象。</p><p>2．由call或者apply（或者bind）调用？绑定到指定的对象。</p><p>3．由上下文对象调用？绑定到那个上下文对象。</p><p>4．默认：在严格模式下绑定到undefined，否则绑定到全局对象。</p><p>一定要注意，有些调用可能在无意中使用默认绑定规则。如果想“更安全”地忽略this绑定，你可以使用一个DMZ对象，比如ø =Object.create(null)，以保护全局对象。</p><p>ES6中的<strong>箭头函数</strong>并不会使用四条标准的绑定规则，而是<strong>根据当前的词法作用域来决定this</strong>，具体来说，箭头函数会继承外层函数调用的this绑定（无论this绑定到什么）。这其实和ES6之前代码中的self = this机制一样。</p></blockquote><h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><blockquote><p>简单基本类型（string、boolean、number、null和undefined）本身并不是对象。null有时会被当作一种对象类型，但是这其实只是语言本身的一个bug，即对null执行typeof null时会返回字符串”object”。[插图]实际上，null本身是基本类型。</p></blockquote><h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><blockquote><p>对象的内容是由一些存储在特定命名位置的（任意类型的）值组成的，我们称之为属性。</p><p>在引擎内部，这些值的存储方式是多种多样的，一般并不会存在对象容器内部。存储在对象容器内部的是这些属性的名称，它们就像指针（从技术角度来说就是引用）一样，指向这些值真正的存储位置。</p></blockquote><p><strong>可计算属性名</strong></p><blockquote><p>ES6增加了可计算属性名，可以在文字形式中使用[]包裹一个表达式来当作属性名：</p><p>可计算属性名最常用的场景可能是ES6的符号（Symbol）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> prefix = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    [prefix + <span class="string">&quot;bar&quot;</span>]:<span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    [prefix + <span class="string">&quot;baz&quot;</span>]: <span class="string">&quot;world&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myObject[<span class="string">&quot;foobar&quot;</span>]; <span class="comment">// hello</span></span><br><span class="line">myObject[<span class="string">&quot;foobaz&quot;</span>]; <span class="comment">// world</span></span><br></pre></td></tr></table></figure><p><strong>数组</strong></p><blockquote><p>你完全可以把数组当作一个普通的键/值对象来使用，并且不添加任何数值索引，但是这并不是一个好主意。数组和普通的对象都根据其对应的行为和用途进行了优化，所以最好只用对象来存储键/值对，只用数组来存储数值下标/值对。</p></blockquote><p>注意：如果你试图向数组添加一个属性，但是属性名“看起来”像一个数字，那它会变成一个数值下标（因此会修改数组的内容而不是添加一个属性）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray = [ <span class="string">&quot;foo&quot;</span>, <span class="number">42</span>, <span class="string">&quot;bar&quot;</span> ];</span><br><span class="line"></span><br><span class="line">myArray[<span class="string">&quot;3&quot;</span>] = <span class="string">&quot;baz&quot;</span>;</span><br><span class="line"></span><br><span class="line">myArray.<span class="property">length</span>; <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">myArray[<span class="number">3</span>]; <span class="comment">// &quot;baz&quot;</span></span><br></pre></td></tr></table></figure><h4 id="复制对象"><a href="#复制对象" class="headerlink" title="复制对象"></a>复制对象</h4><blockquote><p>浅复制只复制对象引用，不是创建一个新的一模一样的对象。深复制比较复杂，如果对象存在相互引用则会出现死循环</p></blockquote><p>深复制：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(someObj));</span><br></pre></td></tr></table></figure><p>浅复制：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(..)</span><br></pre></td></tr></table></figure><h4 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h4><blockquote><p>在ES5之前，JavaScript语言本身并没有提供可以直接检测属性特性的方法，比如判断属性是否是只读。但是从ES5开始，所有的属性都具备了属性描述符。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(myObject, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//    value: 2,</span></span><br><span class="line"><span class="comment">//    writable: true,</span></span><br><span class="line"><span class="comment">//    enumerable: true,</span></span><br><span class="line"><span class="comment">//    configurable: true</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p>除了value属性还有三个特性：writable（可写）、enumerable（可枚举）和configurable（可配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(myObject, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>我们使用defineProperty(..)给myObject添加了一个普通的属性并显式指定了一些特性。然而，一般来说你不会使用这种方式，除非你想修改属性描述符。</p></blockquote><ol><li><p><strong>Writable</strong></p><blockquote><p>writable决定是否可以修改属性的值。</p></blockquote></li><li><p><strong>Configurable</strong></p><blockquote><p>只要属性是可配置的，就可以使用defineProperty(..)方法来修改属性描述符</p><p>注意：把configurable修改成false是单向操作，无法撤销！</p><p>要注意有一个小小的例外：即便属性是configurable:false，我们还是可以把writable的状态由true改为false，但是无法由false改为true。除了无法修改，configurable:false还会禁止删除这个属性：</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> myObject.<span class="property">a</span>;</span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(myObject, <span class="string">&quot;a&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">delete</span> myObject.<span class="property">a</span>;</span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Enumerable</strong></p><blockquote><p>这个描述符控制的是属性是否会出现在对象的属性枚举中，比如说for..in循环。如果把enumerable设置成false，这个属性就不会出现在枚举中，虽然仍然可以正常访问它。相对地，设置成true就会让它出现在枚举中</p></blockquote></li></ol><h4 id="不变性"><a href="#不变性" class="headerlink" title="不变性"></a>不变性</h4><blockquote><p>描述符的可变性是浅层的，当有嵌套属性是对象时就控制不了</p></blockquote><ol><li><p>对象常量</p><blockquote><p>结合writable:false和configurable:false就可以创建一个真正的常量属性（不可修改、重定义或者删除）：</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(myObject, <span class="string">&quot;FAVORITE NUMBER&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure></li><li><p>禁止扩展</p><blockquote><p>如果你想禁止一个对象添加新属性并且保留已有属性，可以使用Object.prevent Extensions(..)：</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(myObject);</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">b</span> = <span class="number">3</span>;</span><br><span class="line">myObject.<span class="property">b</span>; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><blockquote><p>在非严格模式下，创建属性b会静默失败。在严格模式下，将会抛出TypeError错误。</p></blockquote></li><li><p>密封</p><blockquote><p>Object.seal(..)会创建一个“密封”的对象，这个方法实际上会在一个现有对象上调用Object.preventExtensions(..)并把所有现有属性标记为<strong>configurable:false</strong>。</p></blockquote></li><li><p>冻结</p><blockquote><p>Object.freeze(..)会创建一个冻结对象，这个方法实际上会在一个现有对象上调用Object.seal(..)并把所有“数据访问”属性标记为<strong>writable:false</strong>，这样就无法修改它们的值。</p></blockquote></li><li><p>[get]</p><blockquote><p>对象默认的内置[[Get]]操作首先在对象中查找是否有名称相同的属性，</p><p>如果找到就会返回这个属性的值。然而，如果没有找到名称相同的属性，按照[[Get]]算法的定义会执行另外一种非常重要的行为。</p><p>(其实就是遍历可能存在的[[Prototype]]链，也就是原型链）。</p><p>如果无论如何都没有找到名称相同的属性，那[[Get]]操作会返回值undefined：</p></blockquote></li><li><p>[put]</p><blockquote><p>1．属性是否是访问描述符？如果是并且存在setter就调用setter。</p><p>2．属性的数据描述符中writable是否是false？如果是，在非严格模式下静默失败，在严格模式下抛出TypeError异常。</p><p>3．如果都不是，将该值设置为属性的值。</p></blockquote></li><li><p>Getter和Setter</p><blockquote><p>对象默认的 [get],[put] 行为可以重写</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    <span class="comment">// 给a定义一个getter</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">a</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="存在性"><a href="#存在性" class="headerlink" title="存在性"></a><strong>存在性</strong></h4><blockquote><p>前面我们介绍过，如myObject.a的属性访问返回值可能是undefined，但是这个值有可能是属性中存储的undefined，也可能是因为属性不存在所以返回undefined。那么如何区分这两种情况呢？</p></blockquote><p>我们可以在不访问属性值的情况下判断对象中是否存在这个属性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="string">&quot;a&quot;</span> <span class="keyword">in</span> myObject); <span class="comment">// true</span></span><br><span class="line">(<span class="string">&quot;b&quot;</span> <span class="keyword">in</span> myObject); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// true</span></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><blockquote><p>in操作符会检查属性是否在对象及其[[Prototype]]原型链中.。</p><p>相比之下，hasOwnProperty(..)只会检查属性是否在myObject对象中，不会检查[[Prototype]]链</p><p>Object.prototype.hasOwnProperty. call(myObject, “a”)，它借用基础的hasOwnProperty(..)方法并把它显式绑定到myObject上。</p></blockquote><blockquote><p>看起来<strong>in操作符可以检查容器内是否有某个值</strong>，但是<strong>它实际上检查的是某个属性名是否存在</strong>。</p><p>对于数组来说这个区别非常重要，4 in [2, 4, 6]的结果并不是你期待的True，因为[2, 4,6]这个数组中包含的属性名是0、1、2，没有4。</p></blockquote><h4 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(</span><br><span class="line">    myObject,</span><br><span class="line">    <span class="string">&quot;a&quot;</span>,</span><br><span class="line">    <span class="comment">// 让a像普通属性一样可以枚举</span></span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="number">2</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(</span><br><span class="line">    myObject,</span><br><span class="line">    <span class="string">&quot;b&quot;</span>,</span><br><span class="line">    <span class="comment">// 让b不可枚举</span></span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="number">3</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">b</span>; <span class="comment">// 3</span></span><br><span class="line">(<span class="string">&quot;b&quot;</span> <span class="keyword">in</span> myObject); <span class="comment">// true</span></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .......</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> myObject) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, myObject[k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &quot;a&quot; 2</span></span><br></pre></td></tr></table></figure><blockquote><p>myObject.b确实存在并且有访问值，但是却不会出现在for..in循环中（尽管可以通过in操作符来判断是否存在）。原因是“可枚举”就相当于“可以出现在对象属性的遍历中”。</p><p>在数组上应用for..in循环有时会产生出人意料的结果，因为这种枚举不仅会包含所有数值索引，还会包含所有可枚举属性。最好只在对象上应用for..in循环，如果要遍历数组就使用传统的for循环来遍历数值索引。</p></blockquote><p><strong>判断是否可枚举</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(</span><br><span class="line">    myObject,</span><br><span class="line">    <span class="string">&quot;a&quot;</span>,</span><br><span class="line">    <span class="comment">// 让a像普通属性一样可以枚举</span></span><br><span class="line">    &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="number">2</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(</span><br><span class="line">                  myObject,</span><br><span class="line">      <span class="string">&quot;b&quot;</span>,</span><br><span class="line">      <span class="comment">// 让b不可枚举</span></span><br><span class="line">      &#123; <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="number">3</span> &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  myObject.<span class="title function_">propertyIsEnumerable</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// true</span></span><br><span class="line">  myObject.<span class="title function_">propertyIsEnumerable</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(myObject); <span class="comment">// [&quot;a&quot;]</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(myObject); <span class="comment">// [&quot;a&quot;, &quot;b&quot;]</span></span><br></pre></td></tr></table></figure><blockquote><p>propertyIsEnumerable(..)会检查给定的属性名是否直接存在于对象中（而不是在原型链上）并且满足enumerable:true。</p><p>Object.keys(..)会返回一个数组，包含所有可枚举属性，Object.getOwnPropertyNames(..)会返回一个数组，包含所有属性，无论它们是否可枚举。</p><p>in和hasOwnProperty(..)的区别在于前者会查找[[Prototype]]链，然而，Object.keys(..)和Object.getOwnPropertyNames(..)都只会查找对象直接包含的属性。</p></blockquote><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><blockquote><p>for..in循环可以用来遍历对象的可枚举属性列表（包括[[Prototype]]链）。但是如何遍历属性的值呢？</p></blockquote><blockquote><p>ES5中增加了一些数组的辅助迭代器，包括forEach(..)、every(..)和some(..)。</p><p><strong>遍历数组下标时采用的是数字顺序</strong>（for循环或者其他迭代器），<strong>但是遍历对象属性时的顺序是不确定的</strong>，在不同的JavaScript引擎中可能不一样。因此，在不同的环境中需要保证一致性时，一定不要相信任何观察到的顺序，它们是不可靠的。</p></blockquote><h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><blockquote><p>在研究类的具体机制之前，我们首先会介绍面向类的设计模式：实例化（instantiation）、继承（inheritance）和（相对）多态（polymorphism）。</p></blockquote><h3 id="混入"><a href="#混入" class="headerlink" title="混入"></a>混入</h3><blockquote><p>在继承或者实例化时，JavaScript的对象机制并不会自动执行复制行为。简单来说，JavaScript中只有对象，并不存在可以被实例化的“类”。一个对象并不会被复制到其他对象，它们会被关联起来</p><p>因此JavaScript开发者也想出了一个方法来模拟类的复制行为，这个方法就是混入</p></blockquote><h4 id="显式混入"><a href="#显式混入" class="headerlink" title="显式混入"></a>显式混入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非常简单的mixin(..)例子：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mixin</span>(<span class="params">sourceObj, targetObj</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> sourceObj) &#123;</span><br><span class="line">      <span class="comment">// 只会在不存在的情况下复制</span></span><br><span class="line">      <span class="keyword">if</span> (! (key <span class="keyword">in</span> targetObj)) &#123;</span><br><span class="line">          targetObj[key] = sourceObj[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> targetObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Vehicle</span> = &#123;</span><br><span class="line">    <span class="attr">engines</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">ignition</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Turning on my engine.&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">drive</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">ignition</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Steering and moving forward! &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Car</span> = <span class="title function_">mixin</span>(<span class="title class_">Vehicle</span>, &#123;</span><br><span class="line">    <span class="attr">wheels</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">drive</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title class_">Vehicle</span>.<span class="property">drive</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;Rolling on all &quot;</span> + <span class="variable language_">this</span>.<span class="property">wheels</span> + <span class="string">&quot; wheels! &quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><blockquote><p>Vehicle.drive()，函数调用中的this会被绑定到Vehicle对象而不是Car对象，这并不是我们想要的。因此，我们会使用．call(this)来确保drive()在Car对象的上下文中执行。</p></blockquote><h3 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h3><blockquote><p>JavaScript中的对象有一个特殊的[[Prototype]]内置属性，其实就是对于其他对象的引用。几乎所有的对象在创建时[[Prototype]]属性都会被赋予一个非空的值。</p></blockquote><p>对于默认的[[Get]]操作来说，如果无法在对象本身找到需要的属性，就会继续访问对象的[[Prototype]]链：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个关联到anotherObject的对象</span></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="title class_">Object</span>.<span class="title function_">create</span>(anotherObject);</span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><blockquote><p>使用for..in遍历对象时原理和查找[[Prototype]]链类似，任何可以通过原型链访问到（并且是enumerable）的属性都会被枚举。</p><p>使用in操作符来检查属性在对象中是否存在时，同样会查找对象的整条原型链（无论属性是否可枚举）</p></blockquote><h4 id="但是到哪里是-Prototype-的“尽头”呢？"><a href="#但是到哪里是-Prototype-的“尽头”呢？" class="headerlink" title="但是到哪里是[[Prototype]]的“尽头”呢？"></a><strong>但是到哪里是[[Prototype]]的“尽头”呢？</strong></h4><blockquote><p><strong>所有普通的[[Prototype]]链最终都会指向内置的Object.prototype</strong></p></blockquote><h4 id="属性设置和屏蔽"><a href="#属性设置和屏蔽" class="headerlink" title="属性设置和屏蔽"></a>属性设置和屏蔽</h4><blockquote><p>给一个对象设置属性并不仅仅是添加一个新属性或者修改已有的属性值。现在我们完整地讲解一下这个过程：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myObject.<span class="property">foo</span> = <span class="string">&quot;bar&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>如果myObject对象中包含名为foo的普通数据访问属性</strong>，这条赋值语句只会修改已有的属性值。</p><p><strong>如果foo不是直接存在于myObject中</strong>，[[Prototype]]链就会被遍历，类似[[Get]]操作。如果原型链上找不到foo, foo就会被直接添加到myObject上。</p><blockquote><p>如果属性名foo既出现在myObject中也出现在myObject的[[Prototype]]链上层，那么就会发生屏蔽。<strong>myObject中包含的foo属性会屏蔽原型链上层的所有foo属性，因为myObject.foo总是会选择原型链中最底层的foo属性。</strong></p></blockquote><p><strong>如果foo不直接存在于myObject中 而是存在于原型链上层时myObject.foo = “bar”会出现的三种情况。</strong></p><p>1．如果在[[Prototype]]链上层存在名为foo的普通数据访问属性并且没有被标记为只读（writable:false），那就会直接在myObject中添加一个名为foo的新属性，它是屏蔽属性。</p><p>2．如果在[[Prototype]]链上层存在foo，但是它被标记为只读（writable:false），那么无法修改已有属性或者在myObject上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。</p><p>3．如果在[[Prototype]]链上层存在foo并且它是一个setter，那就一定会调用这个setter。foo不会被添加到（或者说屏蔽于）myObject，也不会重新定义foo这个setter。</p><blockquote><p>第二种情况可能是最令人意外的，只读属性会阻止[[Prototype]]链下层隐式创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承。你可以把原型链上层的foo看作是父类中的属性，它会被myObject继承（复制），这样一来myObject中的foo属性也是只读，所以无法创建。但是一定要注意，实际上并不会发生类似的继承复制（参见第4章和第5章）。这看起来有点奇怪，myObject对象竟然会因为其他对象中有一个只读foo就不能包含foo属性。更奇怪的是，这个限制只存在于=赋值中，使用Object.defineProperty(..)并不会受到影响。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="title class_">Object</span>.<span class="title function_">create</span>(anotherObject);</span><br><span class="line"></span><br><span class="line">anotherObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line">anotherObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// true</span></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>++; <span class="comment">// 隐式屏蔽！</span></span><br><span class="line"></span><br><span class="line">anotherObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>++操作相当于myObject.a = myObject.a + 1。因此++操作首先会通过[[Prototype]]查找属性a并从anotherObject.a获取当前属性值2，然后给这个值加1，接着用[[Put]]将值3赋给myObject中新建的屏蔽属性a</p></blockquote><h3 id="类-1"><a href="#类-1" class="headerlink" title="类"></a>类</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(a) === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>调用new Foo()时会创建a,其中一步就是将a内部的[[Prototype]]链接到Foo.prototype所指向的对象。</p><p>实际上，绝大多数JavaScript开发者不知道的秘密是，new Foo()这个函数调用实际上并没有直接创建关联，这个关联只是一个意外的副作用。new Foo()只是间接完成了我们的目标：一个关联到其他对象的新对象</p><p>继承意味着复制操作，JavaScript（默认）并不会复制对象属性。相反，JavaScript会在两个对象之间创建一个关联，这样一个对象就可以通过委托访问另一个对象的属性和函数。</p></blockquote><p><strong>到底是什么让我们认为Foo是一个“类”呢？</strong></p><blockquote><p>其中一个原因是我们看到了关键字new，在面向类的语言中构造类实例时也会用到它。另一个原因是，看起来我们执行了类的构造函数方法，Foo()的调用方式很像初始化类时类构造函数的调用方式。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> === <span class="title class_">Foo</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line">a.<span class="property">constructor</span> === <span class="title class_">Foo</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>Foo.prototype默认有一个公有并且不可枚举的属性．constructor，这个属性引用的是对象关联的函数。此外，我们可以看到通过“构造函数”调用new Foo()创建的对象也有一个．constructor属性，指向“创建这个对象的函数”。</p></blockquote><h4 id="构造函数还是调用"><a href="#构造函数还是调用" class="headerlink" title="构造函数还是调用"></a>构造函数还是调用</h4><blockquote><p>上一段代码很容易让人认为Foo是一个构造函数，因为我们使用new来调用它并且看到它“构造”了一个对象。</p><p>实际上，Foo和你程序中的其他函数没有任何区别。函数本身并不是构造函数，然而，当你在普通的函数调用前面加上new关键字之后，就会把这个函数调用变成一个“构造函数调用”。实际上，new会劫持所有普通函数并用构造对象的形式来调用它。</p></blockquote><p>举例来说：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">NothingSpecial</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Don&#x27;t mind me! &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">NothingSpecial</span>();</span><br><span class="line"><span class="comment">// &quot;Don&#x27;t mind me! &quot;</span></span><br><span class="line"></span><br><span class="line">a; <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>函数不是构造函数，但是当且仅当使用new时，函数调用会变成“构造函数调用”</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line">a.<span class="title function_">myName</span>(); <span class="comment">// &quot;a&quot;</span></span><br><span class="line">b.<span class="title function_">myName</span>(); <span class="comment">// &quot;b&quot;</span></span><br></pre></td></tr></table></figure><p><strong>这段代码展示了另外两种</strong>“面向类”的技巧：</p><p>1．this.name = name给每个对象（也就是a和b）都添加了．name属性，有点像类实例封装的数据值。</p><p>2．Foo.prototype.myName = ..．可能个更有趣的技巧，它会给Foo.prototype对象添加一个属性（函数）。</p><p>现在，a.myName()可以正常工作，但是你可能会觉得很惊讶，这是什么原理呢？</p><blockquote><p>在这段代码中，看起来似乎创建a和b时会把Foo.prototype对象复制到这两个对象中，然而事实并不是这样</p><p>在创建的过程中，a和b的内部[[Prototype]]都会关联到Foo.prototype上。当a和b中无法找到myName时，它会（通过委托）在Foo.prototype上找到。</p></blockquote><p><strong>之前讨论．constructor属性时我们说过，看起来a.constructor === Foo为真意味着a确实有一个指向Foo的．constructor属性，</strong></p><blockquote><p>但是事实不是这样。实际上，.constructor引用同样被委托给了Foo.prototype，而Foo.prototype.constructor默认指向Foo。</p><p>Foo.prototype的．constructor属性只是Foo函数在声明时的默认属性。<strong>如果你创建了一个新对象并替换了函数默认的．prototype对象引用，那么新对象并不会自动获得．constructor属性。</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123; <span class="regexp">/＊ .. ＊/</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123; <span class="regexp">/＊ .. ＊/</span> &#125;; <span class="comment">// 创建一个新原型对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line">a1.<span class="property">constructor</span> === <span class="title class_">Foo</span>; <span class="comment">// false!</span></span><br><span class="line">a1.<span class="property">constructor</span> === <span class="title class_">Object</span>; <span class="comment">// true!</span></span><br></pre></td></tr></table></figure><blockquote><p>.constructor并不是一个不可变属性。它是不可枚举（参见上面的代码）的，但是它的值是可写的（可以被修改）。此外，你可以给任意[[Prototype]]链中的任意对象添加一个名为constructor的属性或者对其进行修改，你可以任意对其赋值。</p></blockquote><h3 id="（原型）继承"><a href="#（原型）继承" class="headerlink" title="（原型）继承"></a>（原型）继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span>(<span class="params">name, label</span>) &#123;</span><br><span class="line">    <span class="title class_">Foo</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">label</span> = label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们创建了一个新的Bar.prototype对象并关联到Foo.prototype</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意！现在没有Bar.prototype.constructor了</span></span><br><span class="line"><span class="comment">// 如果你需要这个属性的话可能需要手动修复一下它</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myLabel</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">label</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;obj a&quot;</span>);</span><br><span class="line"></span><br><span class="line">a.<span class="title function_">myName</span>(); <span class="comment">// &quot;a&quot;</span></span><br><span class="line">a.<span class="title function_">myLabel</span>(); <span class="comment">// &quot;obj a&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>这段代码的核心部分就是语句Bar.prototype =Object.create(Foo.prototype)。调用Object.create(..)会凭空创建一个“新”对象并把新对象内部的[[Prototype]]关联到你指定的对象</p></blockquote><p><strong>注意，下面这两种方式是常见的错误做法，实际上它们都存在一些问题：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 和你想要的机制不一样！</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基本上满足你的需求，但是可能会产生一些副作用:(</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br></pre></td></tr></table></figure><blockquote><p>Bar.prototype = Foo.prototype并不会创建一个关联到Bar.prototype的新对象，它只是让Bar.prototype直接引用Foo.prototype对象。因此当你执行类似Bar.prototype.myLabel = ..．的赋值语句时会直接修改Foo.prototype对象本身。显然这不是你想要的结果，否则你根本不需要Bar对象，直接使用Foo就可以了，这样代码也会更简单一些。</p><p>Bar.prototype = new Foo()的确会创建一个关联到Bar.prototype的新对象。但是它使用了Foo(..)的“构造函数调用”，如果函数Foo有一些副作用（比如写日志、修改状态、注册到其他对象、给this添加数据属性，等等）的话，就会影响到Bar()的“后代”，后果不堪设想。</p></blockquote><p><strong>ES6添加了辅助函数可以用标准并且可靠的方法来修改关联。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6之前需要抛弃默认的Bar.prototype</span></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property">ptototype</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6开始可以直接修改现有的Bar.prototype</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br></pre></td></tr></table></figure><h4 id="检查类的关系"><a href="#检查类的关系" class="headerlink" title="检查类的关系"></a>检查类的关系</h4><blockquote><p>假设有对象a，如何寻找对象a委托的对象（如果存在的话）呢？</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">blah</span> = ...;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"></span><br><span class="line">a <span class="keyword">instanceof</span> <span class="title class_">Foo</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>instanceof回答的问题是：在a的整条[[Prototype]]链中是否有指向Foo.prototype的对象？</p><p>这个方法只能处理对象（a）和函数（带．prototype引用的Foo）之间的关系。如果你想判断两个对象（比如a和b）之间是否通过[[Prototype]]链关联，只用instanceof无法实现。</p><p>如果使用内置的．bind(..)函数来生成一个硬绑定函数的话，该函数是没有．prototype属性的。在这样的函数上使用instanceof的话，目标函数的．prototype会代替硬绑定函数的．prototype。</p></blockquote><p><strong>判断[[Prototype]]反射的方法</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(a); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>isPrototypeOf(..)回答的问题是：在a的整条[[Prototype]]链中是否出现过Foo.prototype？</p></blockquote><p><strong>我们也可以直接获取一个对象的[[Prototype]]链。在ES5中，标准的方法是：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(a);</span><br><span class="line"><span class="comment">// 验证</span></span><br><span class="line">          </span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(a) === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>绝大多数（不是所有！）浏览器也支持一种非标准的方法来访问内部[[Prototype]]属性：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>.__proto__的实现大致上是这样的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&quot; __proto__&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">o</span>) &#123;</span><br><span class="line">      <span class="comment">// ES6中的setPrototypeOf(..)</span></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="variable language_">this</span>, o);</span><br><span class="line">      <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><h3 id="对象关联"><a href="#对象关联" class="headerlink" title="对象关联"></a>对象关联</h3><blockquote><p>现在我们知道了，[[Prototype]]机制就是存在于对象中的一个内部链接，它会引用其他对象。</p><p>通常来说，这个链接的作用是：如果在对象上没有找到需要的属性或者方法引用，引擎就会继续在[[Prototype]]关联的对象上进行查找。同理，如果在后者中也没有找到需要的引用就会继续查找它的[[Prototype]]，以此类推。这一系列对象的链接被称为“原型链”。</p></blockquote><h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><blockquote><p> Object.create(null)会创建一个拥有空（或者说null）[[Prototype]]链接的对象，这个对象无法进行委托。由于这个对象没有原型链，所以instanceof操作符（之前解释过）无法进行判断，因此总是会返回false。这些特殊的空[[Prototype]]对象通常被称作“字典”，它们完全不会受到原型链的干扰，因此非常适合用来存储数据。</p></blockquote><p>Object.create()的polyfill 代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="title class_">Object</span>.<span class="property">create</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="property">create</span> = <span class="keyword">function</span>(<span class="params">o</span>) &#123;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">      F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Object.create(..)的第二个参数指定了需要添加到新对象中的属性名以及这些属性的属性描述符。因为ES5之前的版本无法模拟属性操作符，所以polyfill代码无法实现这个附加功能。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    <span class="attr">a</span>:<span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="title class_">Object</span>.<span class="title function_">create</span>(anotherObject, &#123;</span><br><span class="line">    <span class="attr">b</span>: &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">c</span>: &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">// false</span></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// true</span></span><br><span class="line">myObject.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;c&quot;</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">myObject.<span class="property">a</span>; <span class="comment">// 2</span></span><br><span class="line">myObject.<span class="property">b</span>; <span class="comment">// 3</span></span><br><span class="line">myObject.<span class="property">c</span>; <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><h4 id="关联关系是备用"><a href="#关联关系是备用" class="headerlink" title="关联关系是备用"></a>关联关系是备用</h4><blockquote><p>看起来对象之间的关联关系是处理“缺失”属性或者方法时的一种备用选项。这个说法有点道理，但是我认为这并不是[[Prototype]]的本质。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    <span class="attr">cool</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;cool! &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="title class_">Object</span>.<span class="title function_">create</span>(anotherObject);</span><br><span class="line"></span><br><span class="line">myObject.<span class="title function_">cool</span>(); <span class="comment">// &quot;cool! &quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>小结：</strong></p><p>如果要访问对象中并不存在的一个属性，[[Get]]操作（参见第3章）就会查找对象内部[[Prototype]]关联的对象。这个关联关系实际上定义了一条“原型链”（有点像嵌套的作用域链），在查找属性时会对它进行遍历。</p><p>出于各种原因，以“继承”结尾的术语（包括“原型继承”）和其他面向对象的术语都无法帮助你理解JavaScript的真实机制（不仅仅是限制我们的思维模式）。</p><p>相比之下，“委托”是一个更合适的术语，因为对象之间的关系不是复制而是委托。</p></blockquote><h2 id="行为委托"><a href="#行为委托" class="headerlink" title="行为委托"></a>行为委托</h2><blockquote><p> [[Prototype]]机制就是指对象中的一个内部链接引用另一个对象。不断向上层查找这一系列对象的链接被称为“原型链”。</p><p>换句话说，JavaScript中这个机制的本质就是对象之间的关联关系。</p><p>这个观点对于理解行为委托很重要</p></blockquote><h3 id="面向委托的设计"><a href="#面向委托的设计" class="headerlink" title="面向委托的设计"></a>面向委托的设计</h3><blockquote><p>面向类的设计中有些原则依然有效，因此不要把所有知识都抛掉。（只需要抛掉大部分就够了！）举例来说，封装是非常有用的，它同样可以应用在委托中（虽然不太常见）。</p></blockquote><h4 id="类理论"><a href="#类理论" class="headerlink" title="类理论"></a>类理论</h4><blockquote><p>如果使用类，那设计方法可能是这样的：定义一个通用父（基）类，可以将其命名为Task，在Task类中定义所有任务都有的行为。接着定义子类XYZ和ABC，它们都继承自Task并且会添加一些特殊的行为来处理对应的任务。</p><p>非常重要的是，类设计模式鼓励你在继承时使用方法重写（和多态），比如说在XYZ任务中重写Task中定义的一些通用方法，甚至在添加新行为时通过super调用这个方法的原始版本。你会发现许多行为可以先“抽象”到父类然后再用子类进行特殊化（重写）。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数Task()</span></span><br><span class="line">    <span class="title class_">Task</span>(<span class="variable constant_">ID</span>) &#123; id = <span class="variable constant_">ID</span>; &#125;</span><br><span class="line">    <span class="title function_">outputTask</span>(<span class="params"></span>) &#123; <span class="title function_">output</span>(id); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XYZ</span> inherits <span class="title class_">Task</span> &#123;</span><br><span class="line">    label;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数XYZ()</span></span><br><span class="line">    <span class="title function_">XYZ</span>(<span class="params">ID, Label</span>) &#123; <span class="variable language_">super</span>(<span class="variable constant_">ID</span>); label = <span class="title class_">Label</span>; &#125;</span><br><span class="line">    <span class="title function_">outputTask</span>(<span class="params"></span>) &#123; <span class="variable language_">super</span>(); <span class="title function_">output</span>(label); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ABC</span> inherits <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>基本上你可以想象成，执行任务“XYZ”需要两个兄弟对象（XYZ和Task）协作完成。但是我们并不需要把这些行为放在一起，通过类的复制，我们可以把它们分别放在各自独立的对象中，需要时可以允许XYZ对象委托给Task。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Task</span> = &#123;</span><br><span class="line">    <span class="attr">setID</span>: <span class="keyword">function</span>(<span class="params">ID</span>) &#123; <span class="variable language_">this</span>.<span class="property">id</span> = <span class="variable constant_">ID</span>; &#125;,</span><br><span class="line">    <span class="attr">outputID</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">id</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让XYZ委托Task</span></span><br><span class="line"><span class="variable constant_">XYZ</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Task</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">XYZ</span>.<span class="property">prepareTask</span> = <span class="keyword">function</span>(<span class="params">ID, Label</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setID</span>(<span class="variable constant_">ID</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">label</span> = <span class="title class_">Label</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">XYZ</span>.<span class="property">outputTaskDetails</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">outputID</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">label</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ABC = Object.create(Task);</span></span><br><span class="line"><span class="comment">// ABC ... = ...</span></span><br></pre></td></tr></table></figure><blockquote><p>相比于面向类（或者说面向对象），我会把这种编码风格称为“对象关联”</p><p>我们真正关心的只是XYZ对象（和ABC对象）委托了Task对象。</p></blockquote><p>1．在上面的代码中，id和label数据成员都是直接存储在XYZ上（而不是Task）。通常来说，在[[Prototype]]委托中最好把状态保存在委托者（XYZ、ABC）而不是委托目标（Task）上。</p><p>2．在类设计模式中，我们故意让父类（Task）和子类（XYZ）中都有outputTask方法，这样就可以利用重写（多态）的优势。在委托行为中则恰好相反：我们会尽量避免在[[Prototype]]链的不同级别中使用相同的命名，否则就需要使用笨拙并且脆弱的语法来消除引用歧义</p><p>3．this.setID(ID); XYZ中的方法首先会寻找XYZ自身是否有setID(..)，但是XYZ中并没有这个方法名，因此会通过[[Prototype]]委托关联到Task继续寻找，这时就可以找到setID(..)方法。此外，由于调用位置触发了this的隐式绑定规则，因此虽然setID(..)方法在Task中，运行时this仍然会绑定到XYZ，这正是我们想要的</p><h4 id="互相委托（禁止）"><a href="#互相委托（禁止）" class="headerlink" title="互相委托（禁止）"></a>互相委托（禁止）</h4><blockquote><p>你无法在两个或两个以上互相（双向）委托的对象之间创建循环委托。如果你把B关联到A然后试着把A关联到B，就会出错。(但其实所有引用严格限制，理论上相互委托是可以正常运行工作的)</p><p>之所以要禁止互相委托，是因为引擎的开发者们发现在设置时检查（并禁止！）一次无限循环引用要更加高效，否则每次从对象中查找属性时都需要进行检查。</p></blockquote><h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><blockquote><p>JavaScript规范并不会控制浏览器中开发者工具对于特定值或者结构的表示方式，浏览器和引擎可以自己选择合适的方式来进行解析,</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> <span class="title class_">Foo</span>();</span><br><span class="line"></span><br><span class="line">a1; <span class="comment">// &#123;&#125;   Chrome中， 火狐中 Object &#123;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>本例中Chrome的控制台确实使用了．constructor.name</p></blockquote><h4 id="比较思维模型"><a href="#比较思维模型" class="headerlink" title="比较思维模型"></a>比较思维模型</h4><blockquote><p>“类”和“委托”这两种设计模式的理论，接下来我们看看它们在思维模型方面的区别。</p></blockquote><p>典型的（“原型”）面向对象风格：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">who</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">me</span> = who;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">identify</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;I am &quot;</span> + <span class="variable language_">this</span>.<span class="property">me</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Bar</span>(<span class="params">who</span>) &#123;</span><br><span class="line">    <span class="title class_">Foo</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, who);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;Hello, &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">identify</span>() + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;b1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;b2&quot;</span>);</span><br><span class="line"></span><br><span class="line">b1.<span class="title function_">speak</span>();</span><br><span class="line">b2.<span class="title function_">speak</span>();</span><br></pre></td></tr></table></figure><p>用对象关联风格来编写功能完全相同的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Foo</span> = &#123;</span><br><span class="line">    <span class="attr">init</span>: <span class="keyword">function</span>(<span class="params">who</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">me</span> = who;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">identify</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;I am &quot;</span> + <span class="variable language_">this</span>.<span class="property">me</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Bar</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Foo</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Bar</span>.<span class="property">speak</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;Hello, &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">identify</span>() + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Bar</span>);</span><br><span class="line">b1.<span class="title function_">init</span>(<span class="string">&quot;b1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Bar</span>);</span><br></pre></td></tr></table></figure><h4 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h4><p>组件实例</p><p><strong>类风格：</strong></p><p>es5 写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 父类</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Widget</span>(<span class="params">width, height</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">width</span> = width || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">height</span> = height || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Widget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span>(<span class="params">$where</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$elem</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">css</span>(&#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">width</span> + <span class="string">&quot;px&quot;</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="variable language_">this</span>.<span class="property">height</span> + <span class="string">&quot;px&quot;</span></span><br><span class="line">        &#125;).<span class="title function_">appendTo</span>($where);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 子类</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">width, height, label</span>) &#123;</span><br><span class="line">      <span class="comment">// 调用“super”构造函数</span></span><br><span class="line">      <span class="title class_">Widget</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, width, height);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">label</span> = label || <span class="string">&quot;Default&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span> = $(<span class="string">&quot;&lt;button&gt;&quot;</span>).<span class="title function_">text</span>(<span class="variable language_">this</span>.<span class="property">label</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 让Button“继承”Widget</span></span><br><span class="line">  <span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Widget</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写render(..)</span></span><br><span class="line">  <span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span>(<span class="params">$where</span>) &#123;</span><br><span class="line">      <span class="comment">// “super”调用</span></span><br><span class="line">      <span class="title class_">Widget</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, $where);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">click</span>(<span class="variable language_">this</span>.<span class="property">onClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Button</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">onClick</span> = <span class="keyword">function</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Button &#x27;&quot;</span> + <span class="variable language_">this</span>.<span class="property">label</span> + <span class="string">&quot;&#x27; clicked! &quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> $body = $(<span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">var</span> btn1 = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="number">125</span>, <span class="number">30</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> btn2 = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="number">150</span>, <span class="number">40</span>, <span class="string">&quot;World&quot;</span>);</span><br><span class="line"></span><br><span class="line">    btn1.<span class="title function_">render</span>($body);</span><br><span class="line">    btn2.<span class="title function_">render</span>($body);</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>es6 class语法糖写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">width, height</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">width</span> = width || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">height</span> = height || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params">$where</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$elem</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">css</span>(&#123;</span><br><span class="line">              <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">width</span> + <span class="string">&quot;px&quot;</span>,</span><br><span class="line">              <span class="attr">height</span>: <span class="variable language_">this</span>.<span class="property">height</span> + <span class="string">&quot;px&quot;</span></span><br><span class="line">          &#125;).<span class="title function_">appendTo</span>($where);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Widget</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">width, height, label</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>(width, height);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">label</span> = label || <span class="string">&quot;Default&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span> = $(<span class="string">&quot;&lt;button&gt;&quot;</span>).<span class="title function_">text</span>(<span class="variable language_">this</span>.<span class="property">label</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params">$where</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>.<span class="title function_">render</span>($where);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">click</span>(<span class="variable language_">this</span>.<span class="property">onClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onClick</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Button &#x27;&quot;</span> + <span class="variable language_">this</span>.<span class="property">label</span> + <span class="string">&quot;&#x27; clicked! &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>委托控件对象</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Widget</span> = &#123;</span><br><span class="line">    <span class="attr">init</span>: <span class="keyword">function</span>(<span class="params">width, height</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">width</span> = width || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">height</span> = height || <span class="number">50</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$elem</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">insert</span>: <span class="keyword">function</span>(<span class="params">$where</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$elem</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">css</span>(&#123;</span><br><span class="line">              <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">width</span> + <span class="string">&quot;px&quot;</span>,</span><br><span class="line">              <span class="attr">height</span>: <span class="variable language_">this</span>.<span class="property">height</span> + <span class="string">&quot;px&quot;</span></span><br><span class="line">          &#125;).<span class="title function_">appendTo</span>($where);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Button</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Widget</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Button</span>.<span class="property">setup</span> = <span class="keyword">function</span>(<span class="params">width, height, label</span>)&#123;</span><br><span class="line">    <span class="comment">// 委托调用</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>(width, height);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">label</span> = label || <span class="string">&quot;Default&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$elem</span> = $(<span class="string">&quot;&lt;button&gt;&quot;</span>).<span class="title function_">text</span>(<span class="variable language_">this</span>.<span class="property">label</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Button</span>.<span class="property">build</span> = <span class="keyword">function</span>(<span class="params">$where</span>) &#123;</span><br><span class="line">  <span class="comment">// 委托调用</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">insert</span>($where);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$elem</span>.<span class="title function_">click</span>(<span class="variable language_">this</span>.<span class="property">onClick</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Button</span>.<span class="property">onClick</span> = <span class="keyword">function</span>(<span class="params">evt</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Button &#x27;&quot;</span> + <span class="variable language_">this</span>.<span class="property">label</span> + <span class="string">&quot;&#x27; clicked! &quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> $body = $(<span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> btn1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Button</span>);</span><br><span class="line">  btn1.<span class="title function_">setup</span>(<span class="number">125</span>, <span class="number">30</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> btn2 = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Button</span>);</span><br><span class="line">  btn2.<span class="title function_">setup</span>(<span class="number">150</span>, <span class="number">40</span>, <span class="string">&quot;World&quot;</span>);</span><br><span class="line"></span><br><span class="line">  btn1.<span class="title function_">build</span>($body);</span><br><span class="line">  btn2.<span class="title function_">build</span>($body);</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><blockquote><p>对象关联可以更好地支持关注分离（separation of concerns）原则，创建和初始化并不需要合并为一个步骤。</p></blockquote><h4 id="更简洁的设计"><a href="#更简洁的设计" class="headerlink" title="更简洁的设计"></a>更简洁的设计</h4><blockquote><p>对象关联除了能让代码看起来更简洁（并且更具扩展性）外还可以通过行为委托模式简化代码结构。</p><p>我们来看最后一个例子，它展示了对象关联如何简化整体设计。在这个场景中我们有两个控制器对象，一个用来操作网页中的登录表单，另一个用来与服务器进行验证（通信）。</p></blockquote><p><strong>传统类设计</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Controller</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">errors</span> = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">showDialog</span> = <span class="keyword">function</span>(<span class="params">title, msg</span>) &#123;</span><br><span class="line">    <span class="comment">// 给用户显示标题和消息</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">success</span> = <span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showDialog</span>(<span class="string">&quot;Success&quot;</span>, msg);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">failure</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">errors</span>.<span class="title function_">push</span>(err);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showDialog</span>(<span class="string">&quot;Error&quot;</span>, err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginController</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Controller</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把子类关联到父类</span></span><br><span class="line"><span class="title class_">LoginController</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">LoginController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getUser</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;login username&quot;</span>).<span class="property">value</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">LoginController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getPassword</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;login password&quot;</span>).<span class="property">value</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">LoginController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">validateEntry</span> = <span class="keyword">function</span>(<span class="params">user, pw</span>) &#123;</span><br><span class="line">    user = user || <span class="variable language_">this</span>.<span class="title function_">getUser</span>();</span><br><span class="line">    pw = pw || <span class="variable language_">this</span>.<span class="title function_">getPassword</span>();</span><br><span class="line">    <span class="keyword">if</span> (! (user &amp;&amp; pw)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">failure</span>(</span><br><span class="line">          <span class="string">&quot;Please enter a username &amp; password! &quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pw.<span class="property">length</span> &lt; <span class="number">5</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">failure</span>(</span><br><span class="line">          <span class="string">&quot;Password must be 5+ characters! &quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果执行到这里说明通过验证</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 重写基础的failure()</span></span><br><span class="line"><span class="title class_">LoginController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">failure</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="comment">// “super”调用</span></span><br><span class="line">    <span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">failure</span>.<span class="title function_">call</span>(</span><br><span class="line">      <span class="variable language_">this</span>,</span><br><span class="line">      <span class="string">&quot;Login invalid: &quot;</span> + err</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AuthController</span>(<span class="params">login</span>) &#123;</span><br><span class="line">    <span class="title class_">Controller</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="comment">// 合成</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">login</span> = login;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把子类关联到父类</span></span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">server</span> = <span class="keyword">function</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: url,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">checkAuth</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="variable language_">this</span>.<span class="property">login</span>.<span class="title function_">getUser</span>();</span><br><span class="line">    <span class="keyword">var</span> pw = <span class="variable language_">this</span>.<span class="property">login</span>.<span class="title function_">getPassword</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">login</span>.<span class="title function_">validateEntry</span>(user, pw)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">server</span>(<span class="string">&quot;/check-auth&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">user</span>: user,</span><br><span class="line">            <span class="attr">pw</span>: pw</span><br><span class="line">        &#125; )</span><br><span class="line">        .<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">success</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">        .<span class="title function_">fail</span>(<span class="variable language_">this</span>.<span class="property">failure</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 重写基础的success()</span></span><br><span class="line">    <span class="title class_">AuthController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">success</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// “super”调用</span></span><br><span class="line">    <span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">success</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&quot;Authenticated! &quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 重写基础的failure()</span></span><br><span class="line">    <span class="title class_">AuthController</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">failure</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="comment">// “super”调用</span></span><br><span class="line">    <span class="title class_">Controller</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">failure</span>.<span class="title function_">call</span>(</span><br><span class="line">        <span class="variable language_">this</span>,</span><br><span class="line">        <span class="string">&quot;Auth Failed: &quot;</span> + err</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> auth = <span class="keyword">new</span> <span class="title class_">AuthController</span>(</span><br><span class="line">    <span class="comment">// 除了继承，我们还需要合成</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LoginController</span>()</span><br><span class="line">);</span><br><span class="line">auth.<span class="title function_">checkAuth</span>();</span><br></pre></td></tr></table></figure><p><strong>使用对象关联风格的行为委托来实现更简单的设计</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">LoginController</span> = &#123;</span><br><span class="line">    <span class="attr">errors</span>: [],</span><br><span class="line">    <span class="attr">getUser</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(</span><br><span class="line">          <span class="string">&quot;login username&quot;</span></span><br><span class="line">      ).<span class="property">value</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getPassword</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(</span><br><span class="line">          <span class="string">&quot;login password&quot;</span></span><br><span class="line">      ).<span class="property">value</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">validateEntry</span>: <span class="keyword">function</span>(<span class="params">user, pw</span>) &#123;</span><br><span class="line">      user = user || <span class="variable language_">this</span>.<span class="title function_">getUser</span>();</span><br><span class="line">      pw = pw || <span class="variable language_">this</span>.<span class="title function_">getPassword</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (! (user &amp;&amp; pw)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">failure</span>(</span><br><span class="line">            <span class="string">&quot;Please enter a username &amp; password! &quot;</span></span><br><span class="line">          );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (pw.<span class="property">length</span> &lt; <span class="number">5</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">failure</span>(</span><br><span class="line">            <span class="string">&quot;Password must be 5+ characters! &quot;</span></span><br><span class="line">          );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果执行到这里说明通过验证</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">showDialog</span>: <span class="keyword">function</span>(<span class="params">title, msg</span>) &#123;</span><br><span class="line">      <span class="comment">// 给用户显示标题和消息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">failure</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">errors</span>.<span class="title function_">push</span>(err);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showDialog</span>(<span class="string">&quot;Error&quot;</span>, <span class="string">&quot;Login invalid: &quot;</span> + err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 让AuthController委托LoginController</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">AuthController</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">LoginController</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property">errors</span> = [];</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property">checkAuth</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="variable language_">this</span>.<span class="title function_">getUser</span>();</span><br><span class="line">    <span class="keyword">var</span> pw = <span class="variable language_">this</span>.<span class="title function_">getPassword</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">validateEntry</span>(user, pw)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">server</span>(<span class="string">&quot;/check-auth&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">user</span>: user,</span><br><span class="line">            <span class="attr">pw</span>: pw</span><br><span class="line">      &#125; )</span><br><span class="line">      .<span class="title function_">then</span>(<span class="variable language_">this</span>.<span class="property">accepted</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">      .<span class="title function_">fail</span>(<span class="variable language_">this</span>.<span class="property">rejected</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property">server</span> = <span class="keyword">function</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: url,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property">accepted</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">showDialog</span>(<span class="string">&quot;Success&quot;</span>, <span class="string">&quot;Authenticated! &quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">AuthController</span>.<span class="property">rejected</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">failure</span>(<span class="string">&quot;Auth Failed: &quot;</span> + err);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>我们用一种（极其）简单的设计实现了同样的功能，这就是对象关联风格代码和行为委托设计模式的力量。</p></blockquote><h4 id="内省"><a href="#内省" class="headerlink" title="内省"></a>内省</h4><blockquote><p>内省就是检查实例的类型。类实例的内省主要目的是通过创建方式来判断对象的结构和功能。</p></blockquote><blockquote><p><strong>小结：</strong></p><p>行为委托认为对象之间是兄弟关系，互相委托，而不是父类和子类的关系。JavaScript的[[Prototype]]机制本质上就是行为委托机制。也就是说，我们可以选择在JavaScript中努力实现类机制，也可以拥抱更自然的[[Prototype]]委托机制。</p><p>当你只用对象来设计代码时，不仅可以让语法更加简洁，而且可以让代码结构更加清晰。对象关联（对象之前互相关联）是一种编码风格，它倡导的是直接创建和关联对象，不把它们抽象成类。对象关联可以用基于[[Prototype]]的行为委托非常自然地实现。</p></blockquote><h2 id="类型和语法"><a href="#类型和语法" class="headerlink" title="类型和语法"></a>类型和语法</h2><h3 id="typeof-处理undeclared-未声明-变量的方式"><a href="#typeof-处理undeclared-未声明-变量的方式" class="headerlink" title="typeof 处理undeclared (未声明)变量的方式"></a>typeof 处理undeclared (未声明)变量的方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> a; <span class="comment">// &quot;undefined&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">// &quot;undefined&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>对于undeclared（或者not defined）变量，typeof照样返回”undefined”。请注意虽然b是一个undeclared变量，但typeof b并没有报错。这是因为typeof有一个特殊的安全防范机制。</p></blockquote><p><strong>利用这个安全机制检测变量是否存在</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这样会抛出错误</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">DEBUG</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Debugging is starting&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样是安全的</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable constant_">DEBUG</span> ! == <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Debugging is starting&quot;</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串借用数组的不变更成员函数"><a href="#字符串借用数组的不变更成员函数" class="headerlink" title="字符串借用数组的不变更成员函数"></a>字符串借用数组的不变更成员函数</h3><blockquote><p>可惜我们无法“借用”数组的可变更成员函数，因为字符串是不可变的</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="property">join</span>;         <span class="comment">// undefined</span></span><br><span class="line">a.<span class="property">map</span>;          <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">join</span>.<span class="title function_">call</span>( a, <span class="string">&quot;-&quot;</span> );</span><br><span class="line"><span class="keyword">var</span> d = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">map</span>.<span class="title function_">call</span>( a, <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> v.<span class="title function_">toUpperCase</span>() + <span class="string">&quot;.&quot;</span>;</span><br><span class="line">&#125; ).<span class="title function_">join</span>( <span class="string">&quot;&quot;</span> );</span><br><span class="line"></span><br><span class="line">c;              <span class="comment">// &quot;f-o-o&quot;</span></span><br><span class="line">d;              <span class="comment">// &quot;F.O.O.&quot;</span></span><br></pre></td></tr></table></figure><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><blockquote><p>数字字面量还可以用其他格式来表示，如二进制、八进制和十六进制。</p><p>从ES6开始，严格模式（strict mode）不再支持0363八进制格式</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无效语法：</span></span><br><span class="line"><span class="number">42.</span><span class="title function_">toFixed</span>( <span class="number">3</span> );    <span class="comment">// SyntaxError</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面的语法都有效：</span></span><br><span class="line">(<span class="number">42</span>).<span class="title function_">toFixed</span>( <span class="number">3</span> );  <span class="comment">// &quot;42.000&quot;</span></span><br><span class="line"><span class="number">0.42</span>.<span class="title function_">toFixed</span>( <span class="number">3</span> );  <span class="comment">// &quot;0.420&quot;</span></span><br><span class="line"><span class="number">42.</span>.<span class="title function_">toFixed</span>( <span class="number">3</span> );   <span class="comment">// &quot;42.000&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>42.toFixed(3)是无效语法，因为．被视为常量42．的一部分（如前所述），所以没有．属性访问运算符来调用toFixed方法。</p></blockquote><p>ES6支持以下新格式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0o363</span>;      <span class="comment">// 243的八进制</span></span><br><span class="line"><span class="number">0O363</span>;      <span class="comment">// 同上</span></span><br><span class="line"></span><br><span class="line"><span class="number">0b11110011</span>; <span class="comment">// 243的二进制</span></span><br><span class="line"><span class="number">0B11110011</span>; <span class="comment">// 同上</span></span><br></pre></td></tr></table></figure><h4 id="二进制浮点数最大的问题"><a href="#二进制浮点数最大的问题" class="headerlink" title="二进制浮点数最大的问题"></a><strong>二进制浮点数最大的问题</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure><blockquote><p>简单来说，二进制浮点数中的0.1和0.2并不是十分精确，它们相加的结果并非刚好等于0.3，而是一个比较接近的数字0.30000000000000004，所以条件判断结果为false。</p></blockquote><h4 id="整数的安全范围"><a href="#整数的安全范围" class="headerlink" title="整数的安全范围"></a><strong>整数的安全范围</strong></h4><blockquote><p>es6 新增了 Number.MAX_SAFE_INTEGER，Number.MIN_SAFE_INTEGER 储存了最大最小安全整数</p></blockquote><h4 id="整数检测"><a href="#整数检测" class="headerlink" title="整数检测"></a><strong>整数检测</strong></h4><blockquote><p>可以使用ES6中的Number.isInteger(..)方法：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>( <span class="number">42</span> );     <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>( <span class="number">42.000</span> ); <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>( <span class="number">42.3</span> );   <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>es6之前的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="title class_">Number</span>.<span class="property">isInteger</span>) &#123;</span><br><span class="line">    <span class="title class_">Number</span>.<span class="property">isInteger</span> = <span class="keyword">function</span>(<span class="params">num</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> num == <span class="string">&quot;number&quot;</span> &amp;&amp; num % <span class="number">1</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="要检测一个值是否是安全的整数"><a href="#要检测一个值是否是安全的整数" class="headerlink" title="要检测一个值是否是安全的整数"></a>要检测一个值是否是安全的整数</h4><blockquote><p>可以使用ES6中的Number.isSafeInteger(..)方法：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="title function_">isSafeInteger</span>( <span class="title class_">Number</span>.<span class="property">MAX</span> <span class="variable constant_">SAFE</span> <span class="variable constant_">INTEGER</span> );    <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isSafeInteger</span>( <span class="title class_">Math</span>.<span class="title function_">pow</span>( <span class="number">2</span>, <span class="number">53</span> ) );          <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isSafeInteger</span>( <span class="title class_">Math</span>.<span class="title function_">pow</span>( <span class="number">2</span>, <span class="number">53</span> ) -<span class="number">1</span> );      <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>es6之前方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="title class_">Number</span>.<span class="property">isSafeInteger</span>) &#123;</span><br><span class="line">    <span class="title class_">Number</span>.<span class="property">isSafeInteger</span> = <span class="keyword">function</span>(<span class="params">num</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Number</span>.<span class="title function_">isInteger</span>( num ) &amp;&amp;</span><br><span class="line">          <span class="title class_">Math</span>.<span class="title function_">abs</span>( num ) &lt;= <span class="title class_">Number</span>.<span class="property">MAX</span> <span class="variable constant_">SAFE</span> <span class="variable constant_">INTEGER</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="void"><a href="#void" class="headerlink" title="void"></a>void</h4><blockquote><p>undefined是一个内置标识符,它的值为undefined，通过void运算符即可得到该值。</p><p>表达式void______没有返回值，因此返回结果是undefined。void并不改变表达式的结果，只是让表达式不返回值：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 注：APP.ready由程序自己定义</span></span><br><span class="line">    <span class="keyword">if</span> (! <span class="variable constant_">APP</span>.<span class="property">ready</span>) &#123;</span><br><span class="line">      <span class="comment">// 稍后再试</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">void</span> <span class="built_in">setTimeout</span>( doSomething,<span class="number">100</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在可以了吗？</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">doSomething</span>()) &#123;</span><br><span class="line">    <span class="comment">// 立即执行下一个任务</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="特殊的数字"><a href="#特殊的数字" class="headerlink" title="特殊的数字"></a>特殊的数字</h4><blockquote><p>如果数学运算的操作数不是数字类型（或者无法解析为常规的十进制或十六进制数字），就无法返回一个有效的数字，这种情况下返回值为<strong>NaN</strong>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span> / <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"></span><br><span class="line">a == <span class="title class_">NaN</span>;   <span class="comment">// false</span></span><br><span class="line">a === <span class="title class_">NaN</span>;  <span class="comment">// false</span></span><br></pre></td></tr></table></figure><blockquote><p>aN是一个特殊值，它和自身不相等，是唯一一个非自反（自反，reflexive，即x === x不成立）的值。而NaN ! =NaN为true，很奇怪吧？</p></blockquote><p><strong>那如何来判断它们呢？</strong></p><blockquote><p>可以使用内建的全局工具函数isNaN(..)来判断一个值是否是NaN。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span> / <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// NaN</span></span><br><span class="line">b; <span class="string">&quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="built_in">isNaN</span>( a ); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="built_in">isNaN</span>( b ); <span class="comment">// true——晕！</span></span><br></pre></td></tr></table></figure><blockquote><p>它的检查方式过于死板，就是“<strong>检查参数是否不是NaN，也不是数字</strong>”</p><p>很明显”foo”不是一个数字，但是它也不是NaN。这个bug自JavaScript问世以来就一直存在，至今已超过19年。</p></blockquote><blockquote><p>从ES6开始我们可以使用工具函数Number.isNaN(..)。ES6之前的浏览器的polyfill如下：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title class_">Number</span>.<span class="property">isNaN</span>) &#123;</span><br><span class="line">    <span class="title class_">Number</span>.<span class="property">isNaN</span> = <span class="keyword">function</span>(<span class="params">n</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">          <span class="keyword">typeof</span> n === <span class="string">&quot;number&quot;</span> &amp;&amp;</span><br><span class="line">          <span class="variable language_">window</span>.<span class="built_in">isNaN</span>( n )</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span> / <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>( a ); <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>( b ); <span class="comment">// false——好！</span></span><br></pre></td></tr></table></figure><h4 id="无穷数"><a href="#无穷数" class="headerlink" title="无穷数"></a>无穷数</h4><blockquote><p>JavaScript的运算结果有可能溢出，此时结果为Infinity或者-Infinity。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span> / <span class="number">0</span>;  <span class="comment">// Infinity</span></span><br><span class="line"><span class="keyword">var</span> b = -<span class="number">1</span> / <span class="number">0</span>; <span class="comment">// -Infinity</span></span><br></pre></td></tr></table></figure><blockquote><p>Infinity/Infinity是一个未定义操作，结果为NaN。</p><p>有穷正数除以Infinity，结果为0。</p><p>有穷负数除以Infinity，结果为-0。</p></blockquote><h4 id="零值"><a href="#零值" class="headerlink" title="零值"></a>零值</h4><blockquote><p>JavaScript有一个常规的0（也叫作+0）和一个-0。</p></blockquote><p>根据规范，对负零进行字符串化会返回”0”：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0</span> / -<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 至少在某些浏览器的控制台中显示是正确的</span></span><br><span class="line">a;                           <span class="comment">// -0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是规范定义的返回结果是这样！</span></span><br><span class="line">a.<span class="title function_">toString</span>();               <span class="comment">// &quot;0&quot;</span></span><br><span class="line">a + <span class="string">&quot;&quot;</span>;                     <span class="comment">// &quot;0&quot;</span></span><br><span class="line"><span class="title class_">String</span>( a );                <span class="comment">// &quot;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON也如此，很奇怪</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a );   <span class="comment">// &quot;0&quot;</span></span><br></pre></td></tr></table></figure><p>如果反过来将其从字符串转换为数字，得到的结果是准确的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+<span class="string">&quot;-0&quot;</span>;              <span class="comment">// -0</span></span><br><span class="line"><span class="title class_">Number</span>( <span class="string">&quot;-0&quot;</span> );     <span class="comment">// -0</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>( <span class="string">&quot;-0&quot;</span> ); <span class="comment">// -0</span></span><br></pre></td></tr></table></figure><p>负零转换为字符串的结果令人费解，它的比较操作也是如此：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0</span> / -<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">a == b;     <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">-<span class="number">0</span> == <span class="number">0</span>;    <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">a === b;    <span class="comment">// true</span></span><br><span class="line">-<span class="number">0</span> === <span class="number">0</span>;   <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> &gt; -<span class="number">0</span>;     <span class="comment">// false</span></span><br><span class="line">a &gt; b;      <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><strong>判断是否是 -0</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isNegZero</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    n = <span class="title class_">Number</span>( n );</span><br><span class="line">    <span class="keyword">return</span> (n === <span class="number">0</span>) &amp;&amp; (<span class="number">1</span> / n === -<span class="title class_">Infinity</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">isNegZero</span>( -<span class="number">0</span> );        <span class="comment">// true</span></span><br><span class="line"><span class="title function_">isNegZero</span>( <span class="number">0</span> / -<span class="number">3</span> );    <span class="comment">// true</span></span><br><span class="line"><span class="title function_">isNegZero</span>( <span class="number">0</span> );         <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><strong>为啥需要存在 -0?</strong></p><blockquote><p>有些应用程序中的数据需要以级数形式来表示（比如动画帧的移动速度），数字的符号位（sign）用来代表其他信息（比如移动的方向）。此时如果一个值为0的变量失去了它的符号位，它的方向信息就会丢失。所以保留0值的符号位可以防止这类情况发生。</p></blockquote><h4 id="特殊等式"><a href="#特殊等式" class="headerlink" title="特殊等式"></a>特殊等式</h4><blockquote><p>NaN和-0在相等比较时的表现有些特别。由于NaN和自身不相等，所以必须使用ES6中的Number.isNaN(..)。而-0等于0（对于===也是如此），</p><p>ES6中新加入了一个工具方法Object.is(..)来判断两个值是否绝对相等，可以用来处理上述所有的特殊情况：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span> / <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = -<span class="number">3</span> * <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>( a, <span class="title class_">NaN</span> );    <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>( b, -<span class="number">0</span> );     <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>( b, <span class="number">0</span> );      <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="值和引用"><a href="#值和引用" class="headerlink" title="值和引用"></a>值和引用</h3><blockquote><p>简单值（即标量基本类型值，scalar primitive）总是通过值复制的方式来赋值/传递，包括null、undefined、字符串、数字、布尔和ES6中的symbol。</p><p>复合值（compound value）——对象（包括数组和封装对象）和函数，则总是通过引用复制的方式来赋值/传递。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> b = a; <span class="comment">// b是a的值的一个复本</span></span><br><span class="line">b++;</span><br><span class="line">a; <span class="comment">// 2</span></span><br><span class="line">b; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> d = c; <span class="comment">// d是[1,2,3]的一个引用</span></span><br><span class="line">d.<span class="title function_">push</span>( <span class="number">4</span> );</span><br><span class="line">c; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">d; <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure><p>产生的困惑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    x.<span class="title function_">push</span>( <span class="number">4</span> );</span><br><span class="line">    x; <span class="comment">// [1,2,3,4]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 然后</span></span><br><span class="line">    x = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line">    x.<span class="title function_">push</span>( <span class="number">7</span> );</span><br><span class="line">    x; <span class="comment">// [4,5,6,7]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>( a );</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// 是[1,2,3,4]，不是[4,5,6,7]</span></span><br></pre></td></tr></table></figure><blockquote><p>我们不能通过引用x来更改引用a的指向，只能更改a和x共同指向的值。</p></blockquote><p>我们无法自行决定使用值复制还是引用复制，一切由值的类型来决定。</p><h3 id="原生函数"><a href="#原生函数" class="headerlink" title="原生函数"></a>原生函数</h3><ul><li>String()</li><li> Number()</li><li> Boolean()</li><li> Array()</li><li> Object()</li><li> Function()</li><li> RegExp()</li><li> Date()</li><li> Error()</li><li> Symbol()——ES6中新加入的！</li></ul><p>可以这样来用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">String</span>( <span class="string">&quot;Hello World! &quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( s.<span class="title function_">toString</span>() ); <span class="comment">// &quot;Hello World! &quot;</span></span><br></pre></td></tr></table></figure><p>但其构造出来的对象可能会和我们设想的有所出入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">String</span>( <span class="string">&quot;abc&quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> a;<span class="comment">// 是&quot;object&quot;，不是&quot;String&quot;</span></span><br><span class="line"></span><br><span class="line">a <span class="keyword">instanceof</span> <span class="title class_">String</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>( a ); <span class="comment">// &quot;[object String]&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>new String(“abc”)创建的是字符串”abc”的封装对象，而非基本类型值”abc”。</p></blockquote><h4 id="原生函数作为构造函数"><a href="#原生函数作为构造函数" class="headerlink" title="原生函数作为构造函数"></a>原生函数作为构造函数</h4><blockquote><p>关于数组（array）、对象（object）、函数（function）和正则表达式，我们通常喜欢以常量的形式来创建它们。实际上，使用常量和使用构造函数的效果是一样的</p><p><strong>应该尽量避免使用构造函数，除非十分必要，因为它们经常会产生意想不到的结果</strong></p></blockquote><p><strong>Array(..)</strong></p><blockquote><p>我们将包含至少一个“空单元”的数组称为“稀疏数组”。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Array</span>( <span class="number">3</span> );</span><br><span class="line"></span><br><span class="line">a.<span class="property">length</span>; <span class="comment">// 3</span></span><br><span class="line">a;</span><br></pre></td></tr></table></figure><blockquote><p>我们可以通过下述方式来创建包含undefined单元（而非“空单元”）的数组：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="title class_">Array</span>.<span class="title function_">apply</span>( <span class="literal">null</span>, &#123; <span class="attr">length</span>: <span class="number">3</span> &#125; );</span><br><span class="line">a; <span class="comment">// [ undefined, undefined, undefined ]</span></span><br></pre></td></tr></table></figure><blockquote><p>总之，永远不要创建和使用空单元数组。</p></blockquote><h4 id="Object-、Function-和RegExp"><a href="#Object-、Function-和RegExp" class="headerlink" title="Object(..)、Function(..)和RegExp(..)"></a>Object(..)、Function(..)和RegExp(..)</h4><blockquote><p>同样，除非万不得已，否则尽量不要使用Object(..)/Function(..)/RegExp(..)：</p></blockquote><p>比如动态定义正则表达式时可以使用 RegExp()</p><h4 id="Date-和Error"><a href="#Date-和Error" class="headerlink" title="Date(..)和Error(..)"></a>Date(..)和Error(..)</h4><blockquote><p>这两个构造函数用的比较多</p></blockquote><h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol(..)"></a>Symbol(..)</h4><blockquote><p>ES6中新加入了一个基本数据类型 ——符号（Symbol）。符号是具有唯一性的特殊值（并非绝对），用它来命名对象属性不容易导致重名。该类型的引入主要源于ES6的一些特殊构造，此外符号也可以自行定义。</p></blockquote><blockquote><p>ES6中有一些预定义符号，以Symbol的静态属性形式出现，如Symbol.create、Symbol. iterator等，可以这样来使用：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="comment">/*..*/</span> &#125;;</span><br></pre></td></tr></table></figure><blockquote><p>符号并非对象，而是一种简单标量基本类型</p></blockquote><h4 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h4><blockquote><p>JavaScript为基本数据类型值提供了封装对象，称为原生函数（如String、Number、Boolean等）。它们为基本数据类型值提供了该子类型所特有的方法和属性（如：String#trim()和Array#concat(..)）。对于简单标量基本类型值，比如”abc”，如果要访问它的length属性或String.prototype方法，JavaScript引擎会自动对该值进行封装（即用相应类型的封装对象来包装它）来实现对这些属性和方法的访问。</p></blockquote><h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><h4 id="值类型转换"><a href="#值类型转换" class="headerlink" title="值类型转换"></a>值类型转换</h4><blockquote><p>将值从一种类型转换为另一种类型通常称为类型转换（type casting），这是显式的情况；隐式的情况称为强制类型转换（coercion）。</p><p>JavaScript中的强制类型转换总是返回标量基本类型值。如字符串、数字和布尔值，不会返回对象和函数</p></blockquote><p>然而在JavaScript中通常将它们统称为强制类型转换，我个人则倾向于用“<strong>隐式强制类型转换</strong>”（implicit coercion）和“<strong>显式强制类型转换</strong>”（explicit coercion）来区分。</p><p>二者的区别显而易见：<strong>我们能够从代码中看出哪些地方是显式强制类型转换，而隐式强制类型转换则不那么明显，通常是某些操作产生的副作用。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = a + <span class="string">&quot;&quot;</span>;         <span class="comment">// 隐式强制类型转换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="title class_">String</span>( a );    <span class="comment">// 显式强制类型转换</span></span><br></pre></td></tr></table></figure><blockquote><p>要是你明白a + “”是怎么回事，它对你来说就是“显式”的。相反，如果你不知道String(..)可以用来做字符串强制类型转换，它对你来说可能就是“隐式”的。</p></blockquote><h5 id="ToString"><a href="#ToString" class="headerlink" title="ToString"></a>ToString</h5><blockquote><p>它负责处理非字符串到字符串的强制类型转换。</p><p>基本类型值的字符串化规则为：null转换为”null”, undefined转换为”undefined”, true转换为”true”。数字的字符串化则遵循通用规则，不过前面讲过的那些极小和极大的数字使用指数形式</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.07 连续乘以七个 1000</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1.07</span> * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 七个1000一共21位数字</span></span><br><span class="line">a.<span class="title function_">toString</span>(); <span class="comment">// &quot;1.07e21&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>对普通对象来说，除非自行定义，否则toString()（Object.prototype.toString()）返回内部属性[[Class]]的值，如”[object Object]”。</p></blockquote><h5 id="JSON字符串化"><a href="#JSON字符串化" class="headerlink" title="JSON字符串化"></a>JSON字符串化</h5><blockquote><p>工具函数JSON.stringify(..)在将JSON对象序列化为字符串时也用到了ToString。</p></blockquote><p>对大多数简单值来说，JSON字符串化和toString()的效果基本相同，只不过序列化的结果总是字符串：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( <span class="number">42</span> );   <span class="comment">// &quot;42&quot;</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( <span class="string">&quot;42&quot;</span> ); <span class="comment">// &quot;&quot;42&quot;&quot;（含有双引号的字符串）</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( <span class="literal">null</span> ); <span class="comment">// &quot;null&quot;</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( <span class="literal">true</span> ); <span class="comment">// &quot;true&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>所有安全的JSON值（JSON-safe）都可以使用JSON.stringify(..)字符串化。安全的JSON值是指能够呈现为有效JSON格式的值。</p><p>不安全的JSON值：</p><p>undefined、function、symbol（ES6+）和包含循环引用（对象之间相互引用，形成一个无限循环）的对象都不符合JSON结构标准，其他支持JSON的语言无法处理它们</p></blockquote><p>如果对象中定义了toJSON()方法，JSON字符串化时会首先调用该方法，然后用它的返回值来进行序列化。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">42</span>,</span><br><span class="line">  <span class="attr">c</span>: o,</span><br><span class="line">  <span class="attr">d</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 在a中创建一个循环引用</span></span><br><span class="line">o.<span class="property">e</span> = a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环引用在这里会产生错误</span></span><br><span class="line"><span class="comment">// JSON.stringify( a );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义的JSON序列化</span></span><br><span class="line">a.<span class="property">toJSON</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 序列化仅包含b</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">b</span>: <span class="variable language_">this</span>.<span class="property">b</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a ); <span class="comment">// &quot;&#123;&quot;b&quot;:42&#125;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>也就是说，toJSON()应该“返回一个能够被字符串化的安全的JSON值”，而不是“返回一个JSON字符串”。</strong></p></blockquote><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">val</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可能是我们想要的结果！</span></span><br><span class="line">    <span class="attr">toJSON</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">val</span>.<span class="title function_">slice</span>( <span class="number">1</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">    <span class="attr">val</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可能不是我们想要的结果！</span></span><br><span class="line">    <span class="attr">toJSON</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;[&quot;</span> +</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">val</span>.<span class="title function_">slice</span>( <span class="number">1</span> ).<span class="title function_">join</span>() +</span><br><span class="line">      <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a ); <span class="comment">// &quot;[2,3]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( b ); <span class="comment">// &quot;&quot;[2,3]&quot;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>这里第二个函数是对toJSON返回的字符串做字符串化，而非数组本身。</p></blockquote><p><strong>JSON.stringify(..)<strong>也可以传递一个可选参数replacer，它可以是</strong>数组或者函数</strong>，<strong>用来指定对象序列化过程中哪些属性应该被处理，哪些应该被排除</strong>，和toJSON()很像。</p><p>如果replacer是一个函数，它会对对象本身调用一次，然后对对象中的每个属性各调用一次，每次传递两个参数，键和值。<strong>如果要忽略某个键就返回undefined，否则返回指定的值。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="string">&quot;42&quot;</span>,</span><br><span class="line">    <span class="attr">d</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, [<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>] ); <span class="comment">// &quot;&#123;&quot;b&quot;:42, &quot;c&quot;:&quot;42&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, <span class="keyword">function</span>(<span class="params">k, v</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (k ! == <span class="string">&quot;c&quot;</span>) <span class="keyword">return</span> v;</span><br><span class="line">&#125; );</span><br><span class="line"><span class="comment">// &quot;&#123;&quot;b&quot;:42, &quot;d&quot;:[1,2,3]&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>JSON.stringify还有一个可选参数space，用来指定输出的缩进格式。space为正整数时是指定每一级缩进的字符数，它还可以是字符串，此时最前面的十个字符被用于每一级的缩进：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="string">&quot;42&quot;</span>,</span><br><span class="line">    <span class="attr">d</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, <span class="literal">null</span>, <span class="number">3</span> );</span><br><span class="line"><span class="comment">// &quot;&#123;</span></span><br><span class="line"><span class="comment">//    &quot;b&quot;: 42,</span></span><br><span class="line"><span class="comment">//    &quot;c&quot;: &quot;42&quot;,</span></span><br><span class="line"><span class="comment">//    &quot;d&quot;: [</span></span><br><span class="line"><span class="comment">//       1,</span></span><br><span class="line"><span class="comment">//       2,</span></span><br><span class="line"><span class="comment">//       3</span></span><br><span class="line"><span class="comment">//    ]</span></span><br><span class="line"><span class="comment">// &#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, <span class="literal">null</span>, <span class="string">&quot;-----&quot;</span> );</span><br><span class="line"><span class="comment">// &quot;&#123;</span></span><br><span class="line"><span class="comment">// -----&quot;b&quot;: 42,</span></span><br><span class="line"><span class="comment">// -----&quot;c&quot;: &quot;42&quot;,</span></span><br><span class="line"><span class="comment">// -----&quot;d&quot;: [</span></span><br><span class="line"><span class="comment">// ----------1,</span></span><br><span class="line"><span class="comment">// ----------2,</span></span><br><span class="line"><span class="comment">// ----------3</span></span><br><span class="line"><span class="comment">// -----]</span></span><br><span class="line"><span class="comment">// &#125;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>JSON.stringify(..)并不是强制类型转换。在这里介绍是因为它涉及ToString强制类型转换，具体表现在以下两点。</p><p>(1) 字符串、数字、布尔值和null的JSON.stringify(..)规则与ToString基本相同。</p><p>(2) 如果传递给JSON.stringify(..)的对象中定义了toJSON()方法，那么该方法会在字符串化前调用，以便将对象转换为安全的JSON值。</p></blockquote><h5 id="ToNumber"><a href="#ToNumber" class="headerlink" title="ToNumber"></a>ToNumber</h5><blockquote><p>有时我们需要将非数字值当作数字来使用，比如数学运算。</p><p>为此ES5规范在9.3节定义了抽象操作ToNumber。其中<strong>true转换为1, false转换为0。undefined转换为NaN, null转换为0</strong>。</p><p>ToNumber对字符串的处理基本遵循数字常量的相关规则/语法.处理失败时返回NaN。不同之处是ToNumber对以0开头的十六进制数并不按十六进制处理（而是按十进制</p><p>对象（包括数组）会首先被转换为相应的基本类型值，如果返回的是非数字的基本类型值，则再遵循以上规则将其强制转换为数字。</p></blockquote><p>为了<strong>将值转换为相应的基本类型值</strong>，抽象操作ToPrimitive（参见ES5规范9.1节）会首先（通过内部操作DefaultValue，参见ES5规范8.12.8节）<strong>检查该值是否有valueOf()方法</strong>。如果有并且返回基本类型值，就使用该值进行强制类型转换。<strong>如果没有就使用toString()的返回值</strong>（如果存在）来进行强制类型转换。如果valueOf()和toString()均不返回基本类型值，会产生TypeError错误。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;42&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">    <span class="attr">toString</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;42&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">4</span>,<span class="number">2</span>];</span><br><span class="line">c.<span class="property">toString</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">join</span>( <span class="string">&quot;&quot;</span> ); <span class="comment">// &quot;42&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>( a );                <span class="comment">// 42</span></span><br><span class="line"><span class="title class_">Number</span>( b );                <span class="comment">// 42</span></span><br><span class="line"><span class="title class_">Number</span>( c );                <span class="comment">// 42</span></span><br><span class="line"><span class="title class_">Number</span>( <span class="string">&quot;&quot;</span> );               <span class="comment">// 0</span></span><br><span class="line"><span class="title class_">Number</span>( [] );               <span class="comment">// 0</span></span><br><span class="line"><span class="title class_">Number</span>( [ <span class="string">&quot;abc&quot;</span> ] );        <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><h5 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h5><blockquote><p>在JavaScript中布尔值和数字是不一样的。虽然我们可以将1强制类型转换为true，将0强制类型转换为false，反之亦然，但它们并不是一回事。</p></blockquote><p><strong>假值</strong></p><blockquote><p>• undefined</p><p>• null</p><p>• false</p><p>• +0、-0和NaN</p><p>• “”</p><p>假值的布尔强制类型转换结果为false。从逻辑上说，假值列表以外的都应该是真值（truthy）。</p></blockquote><p><strong>假值对象（falsy object）</strong></p><blockquote><p>前面讲过规范规定所有的对象都是真值，怎么还会有假值对象呢？</p></blockquote><p>有人可能会以为假值对象就是包装了假值的封装对象（如””、0和false，参见第3章），实际不然。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Boolean</span>( <span class="literal">false</span> );</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Number</span>( <span class="number">0</span> );</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">String</span>( <span class="string">&quot;&quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="title class_">Boolean</span>( a &amp;&amp; b &amp;&amp; c );</span><br><span class="line"></span><br><span class="line">d; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>如果假值对象并非封装了假值的对象，那它究竟是什么？</p><blockquote><p>最常见的例子是document.all，它是一个类数组对象，包含了页面上的所有元素，由DOM（而不是JavaScript引擎）提供给JavaScript程序使用。它以前曾是一个真正意义上的对象，布尔强制类型转换结果为true，不过现在它是一个假值对象。</p></blockquote><h5 id="真值"><a href="#真值" class="headerlink" title="真值"></a>真值</h5><blockquote><p>真值就是假值列表之外的值。</p></blockquote><h5 id="显示强制转换"><a href="#显示强制转换" class="headerlink" title="显示强制转换"></a><strong>显示强制转换</strong></h5><blockquote><p>在JavaScript开源社区中，一元运算+被普遍认为是显式强制类型转换。</p><p>一元运算符+紧挨着++和–也很容易引起混淆。例如a +++b、a + ++b和a+ + +b</p></blockquote><p>加法运算符（<code>+</code>）为两种不同的运算重载：数字加法和字符串连接。在求值时，它首先<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures#%E5%BC%BA%E5%88%B6%E5%8E%9F%E5%A7%8B%E5%80%BC%E8%BD%AC%E6%8D%A2">将两个操作数强制转换为基本类型</a>。然后，检查两个操作数的类型：</p><ul><li>如果有一方是字符串，另外一方则会被<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String#%E8%BD%AC%E6%8D%A2%E6%95%B0%E5%AD%97%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2">转换为字符串</a>，并且与它们连接起来。</li><li>如果双方都是<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt">BigInt</a>，则执行 BigInt 加法。如果一方是 BigInt 而另一方不是，则会抛出<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypeError"><code>TypeError</code></a>。</li><li>否则，双方都会被<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number#%E8%BD%AC%E6%8D%A2%E6%95%B0%E5%AD%97%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BA%E6%95%B0%E5%AD%97">转换为数字</a>，执行数字加法。</li></ul><p><strong>日期显式转换为数字</strong></p><blockquote><p>一元运算符+的另一个常见用途是将日期（Date）对象强制类型转换为数字，返回结果为Unix时间戳</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>( <span class="string">&quot;Mon, 18 Aug 2014 08:53:06 CDT&quot;</span> );</span><br><span class="line"></span><br><span class="line">+d; <span class="comment">// 1408369986000</span></span><br></pre></td></tr></table></figure><h5 id="奇特的-运算符"><a href="#奇特的-运算符" class="headerlink" title="奇特的~运算符"></a>奇特的~运算符</h5><blockquote><p>~和indexOf()一起可以将结果强制类型转换（实际上仅仅是转换）为真/假值：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"></span><br><span class="line">~a.<span class="title function_">indexOf</span>( <span class="string">&quot;lo&quot;</span> );         <span class="comment">// -4   &lt;-- 真值！</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (~a.<span class="title function_">indexOf</span>( <span class="string">&quot;lo&quot;</span> )) &#123;   <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// 找到匹配！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~a.<span class="title function_">indexOf</span>( <span class="string">&quot;ol&quot;</span> );         <span class="comment">// 0    &lt;-- 假值！</span></span><br><span class="line">!~a.<span class="title function_">indexOf</span>( <span class="string">&quot;ol&quot;</span> );        <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! ~a.<span class="title function_">indexOf</span>( <span class="string">&quot;ol&quot;</span> )) &#123;  <span class="comment">// true</span></span><br><span class="line">    <span class="comment">// 没有找到匹配！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="字位截除"><a href="#字位截除" class="headerlink" title="字位截除"></a>字位截除</h5><blockquote><p>~~来截除数字值的小数部分，以为这和Math.floor(..)的效果一样，实际上并非如此。</p><p>首先它只适用于32位数字，更重要的是它对负数的处理与Math. floor(..)不同。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">floor</span>( -<span class="number">49.6</span> );    <span class="comment">// -50</span></span><br><span class="line">~~-<span class="number">49.6</span>;                <span class="comment">// -49</span></span><br></pre></td></tr></table></figure><h4 id="字符串和数字之间的隐式强制类型转换"><a href="#字符串和数字之间的隐式强制类型转换" class="headerlink" title="字符串和数字之间的隐式强制类型转换"></a>字符串和数字之间的隐式强制类型转换</h4><blockquote><p>+运算符即能用于数字加法，也能用于字符串拼接。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;42&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> d = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">a + b; <span class="comment">// &quot;420&quot;</span></span><br><span class="line">c + d; <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><blockquote><p>某个操作数是字符串或者能够通过以下步骤转换为字符串的话，+将进行拼接操作。如果其中一个操作数是对象（包括数组），则首先对其调用ToPrimitive抽象操作（规范9.1节），该抽象操作再调用[[DefaultValue]]（规范8.12.8节），以数字作为上下文。</p></blockquote><h4 id="布尔值到数字的隐式强制类型转换"><a href="#布尔值到数字的隐式强制类型转换" class="headerlink" title="布尔值到数字的隐式强制类型转换"></a>布尔值到数字的隐式强制类型转换</h4><blockquote><p>在将某些复杂的布尔逻辑转换为数字加法的时候，隐式强制类型转换能派上大用场。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只有一个为真的条件返回true</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onlyOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 跳过假值，和处理0一样，但是避免了NaN</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">arguments</span>[i]) &#123;</span><br><span class="line">          sum += <span class="variable language_">arguments</span>[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onlyOne</span>( b, a );                <span class="comment">// true</span></span><br><span class="line"><span class="title function_">onlyOne</span>( b, a, b, b, b );       <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="隐式强制类型转换为布尔值"><a href="#隐式强制类型转换为布尔值" class="headerlink" title="隐式强制类型转换为布尔值"></a>隐式强制类型转换为布尔值</h4><blockquote><p>相对布尔值，数字和字符串操作中的隐式强制类型转换还算比较明显。下面的情况会发生布尔值隐式强制类型转换。</p></blockquote><p>(1) if (..)语句中的条件判断表达式。</p><p>(2) for ( .. ; .. ; .. )语句中的条件判断表达式（第二个）。</p><p>(3) while (..)和do..while(..)循环中的条件判断表达式。</p><p>(4) ? ：中的条件判断表达式。</p><p>(5) 逻辑运算符 ||（逻辑或）和 &amp;&amp;（逻辑与）左边的操作数（作为条件判断表达式）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> c;</span><br><span class="line"><span class="keyword">var</span> d = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;yep&quot;</span> );       <span class="comment">// yep</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (c) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;nope, never runs&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c = d ? a : b;</span><br><span class="line">c;                               <span class="comment">// &quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((a &amp;&amp; d) || c) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;yep&quot;</span> );       <span class="comment">// yep</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="和-amp-amp"><a href="#和-amp-amp" class="headerlink" title="|| 和 &amp;&amp;"></a>|| 和 &amp;&amp;</h4><blockquote><p>逻辑运算符||（或）和&amp;&amp;（与）应该并不陌生. 它们的返回值是两个操作数中的一个（且仅一个）。即选择两个操作数中的一个，然后返回它的值。 因此 可能 称之为 <strong>操作数选择器运算符</strong> 更恰当</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">a || b;     <span class="comment">// 42</span></span><br><span class="line">a &amp;&amp; b;     <span class="comment">// &quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line">c || b;     <span class="comment">// &quot;abc&quot;</span></span><br><span class="line">c &amp;&amp; b;     <span class="comment">// null</span></span><br></pre></td></tr></table></figure><p>||和&amp;&amp;首先会对第一个操作数（a和c）执行条件判断，如果其不是布尔值（如上例）就先进行ToBoolean强制类型转换，然后再执行条件判断。</p><blockquote><p>对于||来说，如果条件判断结果为true就返回第一个操作数（a和c）的值，如果为false就返回第二个操作数（b）的值。</p><p>&amp;&amp;则相反，如果条件判断结果为true就返回第二个操作数（b）的值，如果为false就返回第一个操作数（a和c）的值。</p></blockquote><p>换个角度理解：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a || b;</span><br><span class="line"><span class="comment">// 大致相当于(roughly equivalent to):</span></span><br><span class="line">a ? a : b;</span><br><span class="line"></span><br><span class="line">a &amp;&amp; b;</span><br><span class="line"><span class="comment">// 大致相当于(roughly equivalent to):</span></span><br><span class="line">a ? b : a;</span><br></pre></td></tr></table></figure><blockquote><p>a = b || “something”和a &amp;&amp; b()用到了“短路”机制</p></blockquote><h4 id="符号的强制类型转换"><a href="#符号的强制类型转换" class="headerlink" title="符号的强制类型转换"></a>符号的强制类型转换</h4><blockquote><p>ES6中引入了符号类型，它的强制类型转换有一个坑，在这里有必要提一下。ES6允许从符号到字符串的显式强制类型转换，然而隐式强制类型转换会产生错误</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="title class_">Symbol</span>( <span class="string">&quot;cool&quot;</span> );</span><br><span class="line"><span class="title class_">String</span>( s1 );     <span class="comment">// &quot;Symbol(cool)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s2 = <span class="title class_">Symbol</span>( <span class="string">&quot;not cool&quot;</span> );</span><br><span class="line">s2 + <span class="string">&quot;&quot;</span>;      <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>符号不能够被强制类型转换为数字</strong>（显式和隐式都会产生错误），但可以<strong>被强制类型转换为布尔值</strong>（显式和隐式结果都是true）。</p></blockquote><h4 id="宽松相等和严格相等"><a href="#宽松相等和严格相等" class="headerlink" title="宽松相等和严格相等"></a>宽松相等和严格相等</h4><blockquote><p>宽松相等（loose equals）==和严格相等（strict equals）===都用来判断两个值是否“相等”，但是它们之间有一个很重要的区别，特别是在判断条件上。</p><p><strong>常见的误区是“==检查值是否相等，===检查值和类型是否相等”。</strong></p><p><strong>正确的解释是：“==允许在相等比较中进行强制类型转换，而===不允许。”</strong></p></blockquote><h4 id="相等比较操作的性能"><a href="#相等比较操作的性能" class="headerlink" title="相等比较操作的性能"></a>相等比较操作的性能</h4><blockquote><p>有人觉得==会比===慢，实际上虽然强制类型转换确实要多花点时间，但仅仅是微秒级（百万分之一秒）的差别而已。</p><p>不用在乎性能</p><p>==和===都会检查操作数的类型。区别在于操作数类型不同时它们的处理方式不同。</p></blockquote><h4 id="抽象相等"><a href="#抽象相等" class="headerlink" title="抽象相等"></a>抽象相等</h4><blockquote><p>“抽象相等”（abstract equality）的这些规则正是隐式强制类型转换被诟病的原因。</p></blockquote><blockquote><p>es5规定 如果两个值的类型相同，就仅比较它们是否相等**。例如，42等于42, “abc”等于”abc”。</p><p>有几个非常规的情况需要注意</p><p>• NaN不等于NaN</p><p>• +0等于-0</p></blockquote><blockquote><p><strong>==在比较两个不同类型的值时会发生隐式强制类型转换</strong>，会将其中之一或两者都转换为相同的类型后再进行比较。</p></blockquote><blockquote><p>宽松不相等（loose not-equality）! =就是==的相反值，! ==同理。</p></blockquote><h5 id="字符串和数字之间的相等比较"><a href="#字符串和数字之间的相等比较" class="headerlink" title="字符串和数字之间的相等比较"></a>字符串和数字之间的相等比较</h5><blockquote></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;42&quot;</span>;</span><br><span class="line"></span><br><span class="line">a === b;    <span class="comment">// false</span></span><br><span class="line">a == b;     <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>类型不相等时会发生强制类型转换，具体怎么转换？</strong></p><p>ES5规范11.9.3.4-5这样定义：</p><p>(1) 如果Type(x)是数字，Type(y)是字符串，则返回x ==ToNumber(y)的结果。</p><p>(2) 如果Type(x)是字符串，Type(y)是数字，则返回ToNumber(x)== y的结果。</p><blockquote><p>字符串，数字之间比较时，将字符串强制转为数字</p></blockquote><h5 id="其他类型和布尔类型之间的相等比较"><a href="#其他类型和布尔类型之间的相等比较" class="headerlink" title="其他类型和布尔类型之间的相等比较"></a>其他类型和布尔类型之间的相等比较</h5><blockquote><p>==最容易出错的一个地方是true和false与其他类型之间的相等比较。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;42&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">a == b; <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>规范11.9.3.6-7是这样说的：</p><p>(1) 如果Type(x)是布尔类型，则返回ToNumber(x) == y的结果；</p><p>(2) 如果Type(y)是布尔类型，则返回x == ToNumber(y)的结果。</p><blockquote><p>先将布尔值转换成数字，在应用数字与其他类型的比较规则</p></blockquote><h5 id="null和undefined之间的相等比较"><a href="#null和undefined之间的相等比较" class="headerlink" title="null和undefined之间的相等比较"></a>null和undefined之间的相等比较</h5><blockquote><p>null和undefined之间的==也涉及隐式强制类型转换。</p></blockquote><p>ES5规范11.9.3.2-3规定：</p><p>(1) 如果x为null, y为undefined，则结果为true。</p><p>(2) 如果x为undefined, y为null，则结果为true。</p><p>除此之外，其他比较结果都是 false</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="title function_">doSomething</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>条件判断a == null仅在doSomething()返回null和undefined时才成立，除此之外其他值都不成立，包括0、false和””这样的假值。</p></blockquote><blockquote><p>这也就是说，在==中null和undefined是一回事，可以相互进行隐式强制类型转换</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"></span><br><span class="line">a == b;     <span class="comment">// true</span></span><br><span class="line">a == <span class="literal">null</span>;  <span class="comment">// true</span></span><br><span class="line">b == <span class="literal">null</span>;  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">a == <span class="literal">false</span>; <span class="comment">// false</span></span><br><span class="line">b == <span class="literal">false</span>; <span class="comment">// false</span></span><br><span class="line">a == <span class="string">&quot;&quot;</span>;    <span class="comment">// false</span></span><br><span class="line">b == <span class="string">&quot;&quot;</span>;    <span class="comment">// false</span></span><br><span class="line">a == <span class="number">0</span>;     <span class="comment">// false</span></span><br><span class="line">b == <span class="number">0</span>;     <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h5 id="对象和非对象之间的相等比较"><a href="#对象和非对象之间的相等比较" class="headerlink" title="对象和非对象之间的相等比较"></a>对象和非对象之间的相等比较</h5><blockquote><p>关于对象（对象/函数/数组）和标量基本类型（字符串/数字/布尔值）之间的相等比较</p></blockquote><p>ES5规范11.9.3.8-9做如下规定：</p><p>(1) 如果Type(x)是字符串或数字，Type(y)是对象，则返回x ==ToPrimitive(y)的结果；</p><p>(2) 如果Type(x)是对象，Type(y)是字符串或数字，则返回ToPrimitive(x) == y的结果。</p><blockquote><p><strong>toPrimitive</strong>(input,preferedType?):</p><ol><li><p>如果input是原始值，直接返回这个值；</p><ol start="2"><li><p>否则，如果input是对象，调用input.valueOf()，如果结果是原始值，返回结果；</p></li><li><p>否则，调用input.toString()。如果结果是原始值，返回结果；</p></li><li><p>否则，抛出错误。</p></li></ol></li></ol></blockquote><blockquote><p>这里没提到布尔值，因为布尔值会先被强制类型转换为数字</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">Object</span>( a );    <span class="comment">// 和new String( a )一样</span></span><br><span class="line"></span><br><span class="line">a === b;                <span class="comment">// false</span></span><br><span class="line">a == b;                 <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>但有一些值不这样，原因是==算法中其他优先级更高的规则</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">Object</span>( a );    <span class="comment">// 和Object()一样</span></span><br><span class="line">a == b;                 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">var</span> d = <span class="title class_">Object</span>( c );    <span class="comment">// 和Object()一样</span></span><br><span class="line">c == d;                 <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> e = <span class="title class_">NaN</span>;</span><br><span class="line"><span class="keyword">var</span> f = <span class="title class_">Object</span>( e );    <span class="comment">// 和new Number( e )一样</span></span><br><span class="line">e == f;                 <span class="comment">// false</span></span><br></pre></td></tr></table></figure><blockquote><p>因为没有对应的封装对象，所以null和undefined不能够被封装（boxed）, Object(null)和Object()均返回一个常规对象。</p><p>NaN能够被封装为数字封装对象，但拆封之后NaN == NaN返回false，因为NaN不等于NaN</p></blockquote><h5 id="比较少见的情况"><a href="#比较少见的情况" class="headerlink" title="比较少见的情况"></a>比较少见的情况</h5><blockquote><p>更改内置原生原型会导致哪些奇怪的结果。</p></blockquote><p><strong>返回其他数字</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Number</span>( <span class="number">2</span> ) == <span class="number">3</span>;   <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>2 == 3不会有这种问题，因为2和3都是数字基本类型值，不会调用Number.prototype.valueOf()方法。而Number(2)涉及ToPrimitive强制类型转换，因此会调用valueOf()</p></blockquote><p>还有更奇怪的情况：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a == <span class="number">2</span> &amp;&amp; a == <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果让a.valueOf()每次调用都产生副作用，比如第一次返回2，第二次返回3，就会出现这样的情况。这实现起来很简单：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i++;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Number</span>( <span class="number">42</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a == <span class="number">2</span> &amp;&amp; a == <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Yep, this happened.&quot;</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是千万不要滥用，我们应该正确合理地运用强制类型转换，避免这些极端的情况。</p><p><strong>假值的相等比较</strong></p><blockquote><p>==中的隐式强制类型转换最为人诟病的地方是假值的相等比较</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">null</span>;           <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">undefined</span>;      <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">false</span>;          <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="title class_">NaN</span>;            <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="number">0</span>;              <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="string">&quot;&quot;</span>;             <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="literal">false</span> == <span class="literal">null</span>;         <span class="comment">// false</span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">undefined</span>;    <span class="comment">// false</span></span><br><span class="line"><span class="literal">false</span> == <span class="title class_">NaN</span>;          <span class="comment">// false</span></span><br><span class="line"><span class="literal">false</span> == <span class="number">0</span>;            <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="literal">false</span> == <span class="string">&quot;&quot;</span>;           <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="literal">false</span> == [];           <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="literal">false</span> == &#123;&#125;;           <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="literal">null</span>;            <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="literal">undefined</span>;       <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="title class_">NaN</span>;             <span class="comment">// false</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="number">0</span>;               <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == [];              <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == &#123;&#125;;              <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> == <span class="literal">null</span>;             <span class="comment">// false</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">undefined</span>;        <span class="comment">// false</span></span><br><span class="line"><span class="number">0</span> == <span class="title class_">NaN</span>;              <span class="comment">// false</span></span><br><span class="line"><span class="number">0</span> == [];               <span class="comment">// true -- 晕！</span></span><br><span class="line"><span class="number">0</span> == &#123;&#125;;               <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><strong>极端情况</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[] ==  ![]   <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>根据ToBoolean规则，它会进行布尔值的显式强制类型转换（同时反转奇偶校验位）。所以[] == ! []变成了[] == false。布尔值强制转换数字 0，[] == 0, 数字跟对象比较 </p></blockquote><p>其他情况</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> == [<span class="number">2</span>];       <span class="comment">// true</span></span><br><span class="line"><span class="string">&quot;&quot;</span> == [<span class="literal">null</span>];   <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>还有一个坑常常被提到：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> == <span class="string">&quot;\n&quot;</span>;  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><p>“”、”\n”（或者” “等其他空格组合）等空字符串被ToNumber强制类型转换为0</p></blockquote><h4 id="安全运用隐式强制类型转换"><a href="#安全运用隐式强制类型转换" class="headerlink" title="安全运用隐式强制类型转换"></a>安全运用隐式强制类型转换</h4><blockquote><p>我们要对==两边的值认真推敲，以下两个原则可以让我们有效地避免出错。</p></blockquote><p>• 如果两边的值中有true或者false，千万不要使用==。</p><p>• 如果两边的值中有[]、””或者0，尽量不要使用==。</p><h4 id="抽象关系比较"><a href="#抽象关系比较" class="headerlink" title="抽象关系比较"></a>抽象关系比较</h4><blockquote><p>a &lt; b中涉及的隐式强制类型转换不太引人注意，不过还是很有必要深入了解一下。</p><p>ES5规范11.8.5节定义了“抽象关系比较”（abstract relational comparison），分为两个部分：比较双方都是字符串（后半部分）和其他情况（前半部分）。</p></blockquote><p>比较双方首先调用ToPrimitive，如果结果出现非字符串，就根据ToNumber规则将双方强制类型转换为数字来进行比较。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ <span class="number">42</span> ];</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="string">&quot;43&quot;</span> ];</span><br><span class="line">a &lt; b;  <span class="comment">// true</span></span><br><span class="line">b &lt; a;  <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>如果比较双方都是字符串，则按字母顺序来进行比较：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [ <span class="string">&quot;42&quot;</span> ];</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="string">&quot;043&quot;</span> ];</span><br><span class="line"></span><br><span class="line">a &lt; b;  <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>再比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">b</span>: <span class="number">43</span> &#125;;</span><br><span class="line"></span><br><span class="line">a &lt; b;  <span class="comment">// ? ?</span></span><br></pre></td></tr></table></figure><p>结果居然是 false !!!, 🙄这是因为 a,b都被转换成了 “[object Object]”</p><p>下面的例子就有些奇怪了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">b</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">b</span>: <span class="number">43</span> &#125;;</span><br><span class="line"></span><br><span class="line">a &lt; b;  <span class="comment">// false</span></span><br><span class="line">a == b; <span class="comment">// false</span></span><br><span class="line">a &gt; b;  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">a &lt;= b; <span class="comment">// true</span></span><br><span class="line">a &gt;= b; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>对象相等的情况就是引用相同，所以 a!=b,但是如果a &lt; b和a == b结果为false，<strong>为什么a &lt;= b和a &gt;= b的结果会是true呢？</strong></p><blockquote><p>因为根据规范a &lt;= b被处理为b &lt; a，然后将结果反转。因为b &lt;a的结果是false，所以a &lt;= b的结果是true。</p><p>这可能与我们设想的大相径庭，即&lt;=应该是“小于或者等于”。实际上JavaScript中&lt;=是“不大于”的意思（即！(a &gt; b)，处理为！(b &lt; a)）。同理，a &gt;= b处理为b &lt;= a。</p></blockquote><p><strong>为避免出啥幺蛾子，最好保证比较双方类型相同</strong></p><h3 id="语句和表达式"><a href="#语句和表达式" class="headerlink" title="语句和表达式"></a>语句和表达式</h3><blockquote><p>语句相当于句子，表达式相当于短语，运算符则相当于标点符号和连接词。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">3</span> * <span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line">b;</span><br></pre></td></tr></table></figure><p>这里，3 ＊ 6是一个表达式（结果为18）。第二行的a也是一个表达式，第三行的b也是。表达式a和b的结果值都是18。</p><p><strong>var a = 3 ＊ 6和var b = a称为“声明语句”</strong>（declaration statement），因为它们声明了变量（还可以为其赋值）。a = 3 ＊ 6和b = a<strong>（不带var）叫作“赋值表达式”</strong>。</p><h4 id="语句的结果值"><a href="#语句的结果值" class="headerlink" title="语句的结果值"></a>语句的结果值</h4><blockquote><p>如果你用开发控制台（或者JavaScript REPL——read/evaluate/print/loop工具）调试过代码，应该会看到很多语句的返回值显示为undefined，只是你可能从未探究过其中的原因。其实控制台中显示的就是语句的结果值。但是在代码中没有办法获取这个结果值</p></blockquote><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    b = <span class="number">4</span> + <span class="number">38</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在控制台/REPL中输入以上代码应该会显示42，即最后一个语句/表达式b = 4 + 38的结果值。</p><p>但下面这样的代码无法运行：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">a = <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    b = <span class="number">4</span> + <span class="number">38</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>因为语法不允许我们获得语句的结果值并将其赋值给另一个变量（至少目前不行）。</p></blockquote><p><strong>那应该怎样获得语句的结果值呢？</strong></p><p>可以使用万恶的eval(..)（又读作“evil”）来获得结果值：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">eval</span>( <span class="string">&quot;if (true) &#123; b = 4 + 38; &#125;&quot;</span> );</span><br><span class="line"></span><br><span class="line">a;  <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><h4 id="表达式的副作用"><a href="#表达式的副作用" class="headerlink" title="表达式的副作用"></a>表达式的副作用</h4><blockquote><p>大部分表达式没有副作用。</p><p>最常见的有副作用（也可能没有）的表达式是函数调用：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    a = a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="title function_">foo</span>();      <span class="comment">// 结果值：undefined。副作用：a的值被改变</span></span><br></pre></td></tr></table></figure><p>其他一些表达式也有副作用，比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> b = a++;</span><br><span class="line"></span><br><span class="line">a;  <span class="comment">// 43</span></span><br><span class="line">b;  <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>语句系列逗号运算符（statement-series comma operator）将多个独立的表达式语句串联成一个语句：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>, b;</span><br><span class="line">b = ( a++, a );</span><br><span class="line"></span><br><span class="line">a;  <span class="comment">// 43</span></span><br><span class="line">b;  <span class="comment">// 43</span></span><br></pre></td></tr></table></figure><p>a++, a中第二个表达式a在a++之后执行，结果为43，并被赋值给b。</p><p>再如delete运算符。delete用来删除对象中的属性和数组中的单元。它通常以单独一个语句的形式出现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">42</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">a</span>;          <span class="comment">// 42</span></span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">a</span>;   <span class="comment">// true</span></span><br><span class="line">obj.<span class="property">a</span>;          <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>如果操作成功，delete返回true，否则返回false。其副作用是属性被从对象中删除（或者单元从array中删除）。</p><p>另一个有趣的例子是=赋值运算符。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line">a = <span class="number">42</span>;     <span class="comment">// 42</span></span><br><span class="line">a;          <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><blockquote><p>组合赋值运算符，如+=和-=等也是如此。例如，a = b += 2首先执行b +=2（即b = b + 2），然后结果再被赋值给a。</p></blockquote><h4 id="上下文规则"><a href="#上下文规则" class="headerlink" title="上下文规则"></a>上下文规则</h4><blockquote><p>在JavaScript语法规则中，有时候同样的语法在不同的情况下会有不同的解释。这些语法规则孤立起来会很难理解。</p></blockquote><h5 id="大括号"><a href="#大括号" class="headerlink" title="大括号"></a>大括号</h5><blockquote><p>下面两种情况会用到大括号{ .. }（随着JavaScript的演进会出现更多类似的情况）。</p></blockquote><ol><li><p>对象常量</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假定函数bar()已经定义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="title function_">bar</span>()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>标签</p><p> 如果将上例中的var a =去掉会发生什么情况呢？</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设 bar已定义</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="title function_">bar</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 很多开发人员以为这里的{ .. }只是一个孤立的对象常量，没有赋值。事实上不是这样。</p><p> 这里涉及JavaScript中一个不太为人知（也不建议使用）的特性，叫作“<strong>标签语句</strong>”（labeled statement）。<strong>foo是语句bar()的标签</strong>（后面没有；）。标签语句具体是做什么用的呢？</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标签为foo的循环</span></span><br><span class="line"><span class="attr">foo</span>: <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>; j&lt;<span class="number">4</span>; j++) &#123;</span><br><span class="line">      <span class="comment">// 如果j和i相等，继续外层循环</span></span><br><span class="line">      <span class="keyword">if</span> (j == i) &#123;</span><br><span class="line">          <span class="comment">// 跳转到foo的下一个循环</span></span><br><span class="line">          <span class="keyword">continue</span> foo;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 跳过奇数结果</span></span><br><span class="line">      <span class="keyword">if</span> ((j ＊ i) % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// 继续内层循环（没有标签的）</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( i, j );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 0</span></span><br><span class="line"><span class="comment">// 2 0</span></span><br><span class="line"><span class="comment">// 2 1</span></span><br><span class="line"><span class="comment">// 3 0</span></span><br><span class="line"><span class="comment">// 3 2</span></span><br></pre></td></tr></table></figure><p> break foo不是指“跳转到标签foo所在位置继续执行”，而是“跳出标签foo所在的循环/代码块，继续执行后面的代码”</p><blockquote><p>标签也能用于非循环代码块，但只有break才可以。我们可以对带标签的代码块使用break______，但是不能对带标签的非循环代码块使用continue，也不能对不带标签的代码块使用break：</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标签为bar的代码块</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="attr">bar</span>: &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello&quot;</span> );</span><br><span class="line">              <span class="keyword">break</span> bar;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;never runs&quot;</span> );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;World&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"><span class="comment">// Hello</span></span><br><span class="line"><span class="comment">// World</span></span><br></pre></td></tr></table></figure><blockquote><p>带标签的循环/代码块十分少见，也不建议使用。</p></blockquote></li></ol><h5 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[] + &#123;&#125;; <span class="comment">// &quot;[object Object]&quot;</span></span><br><span class="line">&#123;&#125; + []; <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><p>第一行代码中，{}出现在+运算符表达式中，因此它被当作一个值（空对象）来处理。[]会被强制类型转换为””，而{}会被强制类型转换为”[object Object]”。</p><p>但在第二行代码中，{}被当作一个独立的空代码块（不执行任何操作）。代码块结尾不需要分号，所以这里不存在语法上的问题。最后+ []将[]显式强制类型转换为0。</p><h5 id="对象解构"><a href="#对象解构" class="headerlink" title="对象解构"></a>对象解构</h5><blockquote><p>从ES6开始，{ .. }也可用于“解构赋值”</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// ..</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">42</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&quot;foo&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> &#123; a, b &#125; = <span class="title function_">getData</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>( a, b ); <span class="comment">// 42 &quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line">&#123; a , b &#125; = .．就是<span class="title class_">ES6</span>中的解构赋值，相当于下面的代码：</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> res = <span class="title function_">getData</span>();</span><br><span class="line">  <span class="keyword">var</span> a = res.<span class="property">a</span>;</span><br><span class="line">  <span class="keyword">var</span> b = res.<span class="property">b</span>;</span><br></pre></td></tr></table></figure><p>{ a, b }实际上是{ a: a, b: b }的简化版本，两者均可，只不过{ a,b }更简洁。</p><h5 id="else-if和可选代码块"><a href="#else-if和可选代码块" class="headerlink" title="else if和可选代码块"></a>else if和可选代码块</h5><blockquote><p>很多人误以为JavaScript中有else if，因为我们可以这样来写代码：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (b) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>事实上JavaScript没有else if，但if和else只包含单条语句的时候可以省略代码块的{ }。下面的代码你一定不会陌生：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) <span class="title function_">doSomething</span>( a );</span><br></pre></td></tr></table></figure><p>很多JavaScript代码检查工具建议对单条语句也应该加上{ }，如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) &#123; <span class="title function_">doSomething</span>( a ); &#125;</span><br></pre></td></tr></table></figure><p>else也是如此，所以我们经常用到的else if实际上是这样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (b) &#123;</span><br><span class="line">      <span class="comment">// ..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ..</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>else if极为常见，能省掉一层代码缩进，所以很受青睐。但这只是我们自己发明的用法，切勿想当然地认为这些都属于JavaScript语法的范畴。</p></blockquote><h3 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h3><blockquote><p>超过一个运算符时表达式的执行顺序。 对此js没有具体介绍<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence">参考</a></p></blockquote><p>&amp;&amp;运算符的优先级高于=</p><p>&amp;&amp;运算符先于||执行</p><p>||的优先级又高于？:</p><h5 id="短路"><a href="#短路" class="headerlink" title="短路"></a>短路</h5><blockquote><p>对&amp;&amp;和||来说，如果从左边的操作数能够得出结果，就可以忽略右边的操作数。我们将这种现象称为“短路”（即执行最短路径）。</p></blockquote><p>以a &amp;&amp; b为例，如果a是一个假值，足以决定&amp;&amp;的结果，就没有必要再判断b的值。同样对于a || b，如果a是一个真值，也足以决定||的结果，也就没有必要再判断b的值。</p><h5 id="更强的绑定"><a href="#更强的绑定" class="headerlink" title="更强的绑定"></a>更强的绑定</h5><p>多个运算符串联在一起的例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &amp;&amp; b || c ? c || b ? a : c &amp;&amp; b : a</span><br></pre></td></tr></table></figure><p>其中？：运算符的优先级比&amp;&amp;和||高还是低呢？执行顺序是怎样？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(a &amp;&amp; b || c) ? (c || b) ? a : (c &amp;&amp; b) : a</span><br></pre></td></tr></table></figure><blockquote><p>因为&amp;&amp;运算符的优先级高于||，而||的优先级又高于？ :。</p></blockquote><h5 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h5><blockquote><p>&amp;&amp;和||运算符先于？：执行，那么如果多个相同优先级的运算符同时出现，又该如何处理呢？它们的执行顺序是从左到右还是从右到左？</p></blockquote><p>一般说来，运算符的关联（associativity）不是从左到右就是从右到左，这取决于组合（grouping）是从左开始还是从右开始。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="title function_">foo</span>() &amp;&amp; <span class="title function_">bar</span>();</span><br></pre></td></tr></table></figure><p>这里遵循从左到右的顺序（JavaScript的默认执行顺序）。这里foo()首先执行，它的返回结果决定了bar()是否执行。所以如果bar()在foo()之前执行，整个结果会完全不同。</p><p>而a &amp;&amp; b &amp;&amp; c这样的表达式就涉及组合（隐式），这意味着a &amp;&amp; b或b &amp;&amp; c会先执行。</p><blockquote><p>如果&amp;&amp;是右关联的话会被处理为a &amp;&amp; (b &amp;&amp; c)。但这并不意味着c会在b之前执行。右关联不是指从右往左执行，而是指从右往左组合。任何时候，不论是组合还是关联，严格的执行顺序都应该是从左到右，a, b，然后c。</p></blockquote><p>比如？：（三目运算符）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ? b : c ? d : e;</span><br></pre></td></tr></table></figure><p>?：是右关联，它的组合顺序是以下哪一种呢？</p><p>• a ? b : (c ? d : e)</p><p>• (a ? b : c) ? d : e</p><p>答案是a ? b : (c ? d : e)。</p><p><strong>更为复杂的赋值表达式的例子：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> c = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = a &amp;&amp; b || c ? c || b ? a : c &amp;&amp; b : a;</span><br><span class="line"></span><br><span class="line">d;      <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>掌握了优先级和关联等相关知识之后，就能够根据组合规则将上面的代码分解如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((a &amp;&amp; b) || c) ? ((c || b) ? a : (c &amp;&amp; b)) : a</span><br></pre></td></tr></table></figure><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><h4 id="自动分号"><a href="#自动分号" class="headerlink" title="自动分号"></a>自动分号</h4><blockquote><p>有时JavaScript会自动为代码行补上缺失的分号，即自动分号插入（Automatic Semicolon Insertion, ASI）。</p><p>请注意，ASI只在换行符处起作用，而不会在代码行的中间插入分号。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>, b</span><br><span class="line">c;</span><br></pre></td></tr></table></figure><p>JavaScript判断b之后应该有；，所以c；被处理为一个独立的表达式语句。</p><p>语法规定do..while循环后面必须带；,但是大多数开发人员会不记得，所以ASI会自动补上，其他涉及ASI的情况是break、continue、return和yield（ES6）等关键字</p><p><strong>纠错机制</strong></p><p>对于ASI自动添加 ; , js社区争议</p><ul><li><p>正方认为ASI机制大有裨益，能省略掉那些不必要的；，让代码更简洁。</p></li><li><p>反方则认为ASI机制问题太多，对于缺乏经验的初学者尤其如此，自动插入会改变代码逻辑。应该通过linter这样的工具来找出这些错误，而不是依赖JavaScript引擎来改正错误。</p></li></ul><blockquote><p>建议在所有需要的地方加上分号，将对ASI的依赖降到最低。</p></blockquote><h4 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h4><blockquote><p>JavaScript不仅有各种类型的运行时错误（TypeError、ReferenceError、SyntaxError等），它的语法中也定义了一些编译时错误。</p><p>如非法正则，重名函数，重名属性…</p><p>从语义角度来说，这些错误并非词法错误，而是语法错误，因为它们在词法上是正确的。只不过由于没有GrammarError类型，一些浏览器选择用SyntaxError来代替。</p></blockquote><h5 id="提前使用变量"><a href="#提前使用变量" class="headerlink" title="提前使用变量"></a>提前使用变量</h5><blockquote><p>ES6规范定义了一个新概念，叫作TDZ（Temporal Dead Zone，暂时性死区）。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    a = <span class="number">2</span>;      <span class="comment">// ReferenceError!</span></span><br><span class="line">    <span class="keyword">let</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>a = 2试图在let a初始化a之前使用该变量（其作用域在{ .. }内），这里就是a的TDZ，会产生错误。</p><p>有意思的是，对未声明变量使用typeof不会产生错误，但在TDZ中却会报错：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typeof</span> a;   <span class="comment">// undefined</span></span><br><span class="line">    <span class="keyword">typeof</span> b;   <span class="comment">// ReferenceError! (TDZ)</span></span><br><span class="line">    <span class="keyword">let</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h4><blockquote><p>另一个TDZ违规的例子是ES6中的参数默认值</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"> a = <span class="number">42</span>, b = a + b + <span class="number">5</span> </span>) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>b = a + b + 5在参数b（=右边的b，而不是函数外的那个）的TDZ中访问b，所以会出错。而访问a却没有问题，因为此时刚好跨出了参数a的TDZ。</p></blockquote><h4 id="try-finally"><a href="#try-finally" class="headerlink" title="try..finally"></a>try..finally</h4><blockquote><p>try..catch对我们来说可能已经非常熟悉了。但你是否知道try可以和catch或者finally配对使用，并且必要时两者可同时出现？</p></blockquote><p>在一种情况下需要finally:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">              <span class="comment">// throw 42;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello&quot;</span> );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;never runs&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="title function_">foo</span>() );</span><br><span class="line"><span class="comment">// Hello</span></span><br><span class="line"><span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>当try 语句用有return 时，finally 会在return 前执行。 当try中 使用 throw 时也是如此</p><p>如果finally中抛出异常（无论是有意还是无意），函数就会在此处终止。如果此前try中已经有return设置了返回值，则该值会被丢弃：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="keyword">throw</span> <span class="string">&quot;Oops! &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;never runs&quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="title function_">foo</span>() );</span><br><span class="line"><span class="comment">// Uncaught Exception: Oops!</span></span><br></pre></td></tr></table></figure><p>continue和break等控制语句也是如此：finally 中语句会在 关键字之前执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>( i );</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 1 2 3 4 5 6 7 8 9</span></span><br></pre></td></tr></table></figure><p>finally中的return会覆盖try和catch中return的返回值：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="comment">// 没有返回语句，所以没有覆盖</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="comment">// 覆盖前面的return 42</span></span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="comment">// 覆盖前面的return 42</span></span><br><span class="line">              <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();  <span class="comment">// 42</span></span><br><span class="line"><span class="title function_">bar</span>();  <span class="comment">// undefined</span></span><br><span class="line"><span class="title function_">baz</span>();  <span class="comment">// Hello</span></span><br></pre></td></tr></table></figure><blockquote><p>通常来说，在函数中省略return的结果和return；及return undefined；是一样的，但是在finally中省略return则会返回前面的return设定的返回值。</p></blockquote><h4 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h4><blockquote><p>可以把它看作if..else if..else.．的简化版本：a与case的值执行严格相等（===）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (a) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">              <span class="comment">// 执行一些代码</span></span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">42</span>:</span><br><span class="line">              <span class="comment">// 执行另外一些代码</span></span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">              <span class="comment">// 执行缺省代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里a与case表达式逐一进行比较。如果匹配就执行该case中的代码，直到break或者switch代码块结束。</p></blockquote><h2 id="异步现在和将来"><a href="#异步现在和将来" class="headerlink" title="异步现在和将来"></a>异步现在和将来</h2><h3 id="异步和性能"><a href="#异步和性能" class="headerlink" title="异步和性能"></a>异步和性能</h3><h4 id="异步控制台"><a href="#异步控制台" class="headerlink" title="异步控制台"></a>异步控制台</h4><blockquote><p>并没有什么规范或一组需求指定console.＊方法族如何工作——它们并不是JavaScript正式的一部分，而是由宿主环境添加到JavaScript中的。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a ); <span class="comment">// ? ?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 再然后</span></span><br><span class="line">a.<span class="property">index</span>++;</span><br></pre></td></tr></table></figure><p>正常情况下会输出 { index: 1}， 但如果遇到控制台I/O延迟情况，可能会输出 { index: 2}</p><h4 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h4><blockquote><p>现在我们来澄清一件事情（可能令人震惊）：尽管你显然能够编写异步JavaScript代码（就像前面我们看到的定时代码），但直到最近（ES6）, JavaScript才真正内建有直接的异步概念。</p><p>宿主环境（浏览器-js，服务器-nodejs）提供了一种机制来处理程序中多个块的执行，且执行每块时调用JavaScript引擎，这种机制被称为事件循环。</p><p>换句话说，JavaScript引擎本身并没有时间的概念，只是一个按需执行JavaScript任意代码片段的环境。“事件”（JavaScript代码执行）调度总是由包含它的环境进行。</p></blockquote><p>通过伪代码了解这个概念：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eventLoop是一个用作队列的数组</span></span><br><span class="line"><span class="comment">//（先进，先出）</span></span><br><span class="line"><span class="keyword">var</span> eventLoop = [ ];</span><br><span class="line"><span class="keyword">var</span> event;</span><br><span class="line"></span><br><span class="line"><span class="comment">// “永远”执行</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="comment">// 一次tick</span></span><br><span class="line">    <span class="keyword">if</span> (eventLoop.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// 拿到队列中的下一个事件</span></span><br><span class="line">          event = eventLoop.<span class="title function_">shift</span>();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 现在，执行下一个事件</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="title function_">event</span>();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">              <span class="title function_">reportError</span>(err);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>有一个用while循环实现的持续运行的循环，循环的每一轮称为一个tick。对每个tick而言，如果在队列中有等待事件，那么就会从队列中摘下一个事件并执行。这些事件就是你的回调函数。</p><p>要搞清楚的是，setTimeout(..)并没有把你的回调函数挂在事件循环队列中。它所做的是设定一个定时器。当定时器到时后，环境会把你的回调函数放在事件循环中，这样，在未来某个时刻的tick会摘下并执行这个回调。</p><p>如果这时候事件循环中已经有20个项目了会怎样呢？你的回调就会等待。它得排在其他项目后面——通常没有抢占式的方式支持直接将其排到队首。这也就是为啥说setTimeout()定时器精度不高的原因了</p><p>现在ES6精确指定了事件循环的工作细节，这意味着在技术上将其纳入了JavaScript引擎的势力范围，而不是只由宿主环境来管理。这个改变的一个主要原因是ES6中Promise的引入，因为这项技术要求对事件循环队列的调度运行能够直接进行精细控制</p></blockquote><h4 id="并行线程"><a href="#并行线程" class="headerlink" title="并行线程"></a>并行线程</h4><blockquote><p>术语“异步”和“并行”常常被混为一谈，但实际上它们的意义完全不同。记住，<strong>异步是关于现在和将来的时间间隙，而并行是关于能够同时发生的事情。</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    a = a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    a = a * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax(..)是某个库中提供的某个Ajax函数</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, foo );</span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.2&quot;</span>, bar );</span><br></pre></td></tr></table></figure><p>根据 foo,bar 的执行顺序不同可能得到不一样的结果a(2/40), 但如果 foo,bar 同时运行？两个操作共享a的内存地址，这是很复杂的操作，好在js是单线程不需要考虑这个问题</p><h4 id="完整运行"><a href="#完整运行" class="headerlink" title="完整运行"></a>完整运行</h4><blockquote><p>由于JavaScript的单线程特性，foo()（以及bar()）中的代码具有原子性。也就是说，一旦foo()开始运行，它的所有代码都会在bar()中的任意代码运行之前完成，或者相反。这称为完整运行（run-to-completion）特性。</p></blockquote><p>foo,bar中的内容越长，其运行的不确定性就越多，但是其确定性肯定比多线程要高</p><h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><blockquote><p>现在让我们来设想一个展示状态更新列表（比如社交网络新闻种子）的网站，其随着用户向下滚动列表而逐渐加载更多内容。要正确地实现这一特性，需要（至少）两个独立的“<strong>进程</strong>”同时运行（也就是说，是在同一段时间内，并不需要在同一时刻）。</p><p>【“进程”】这是虚拟进程，并非真正意义上的操作系统进程。之所以使用“进程”而不是“任务”，是因为从概念上来讲，“进程”的定义更符合这里我们使用的意义。</p></blockquote><ul><li><p>第一个“进程”在用户向下滚动页面触发onscroll事件时响应这些事件（发起Ajax请求要求新的内容）。</p></li><li><p>第二个“进程”接收Ajax响应（把内容展示到页面）。</p></li></ul><p>如果用户滚动够快的话，可能会有两个或者更多事件被触发。两个或多个“进程”同时执行就出现了并发</p><p>下面列出了事件循环队列中所有这些交替事件：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onscroll, 请求1       &lt;--- 进程1启动</span><br><span class="line">onscroll, 请求2</span><br><span class="line">响应1                 &lt;--- 进程2启动</span><br><span class="line">onscroll, 请求3</span><br><span class="line">响应2</span><br><span class="line">响应3</span><br><span class="line">onscroll, 请求4</span><br><span class="line">onscroll, 请求5</span><br><span class="line">onscroll, 请求6</span><br><span class="line">响应4</span><br><span class="line">onscroll, 请求7       &lt;--- 进程1结束</span><br><span class="line">响应6</span><br><span class="line">响应5</span><br><span class="line">响应7                 &lt;--- 进程2结束</span><br></pre></td></tr></table></figure><p>单线程事件循环是并发的一种形式</p><h5 id="非交互"><a href="#非交互" class="headerlink" title="非交互"></a>非交互</h5><blockquote><p>两个或多个“进程”在同一个程序内并发地交替运行它们的步骤/事件时，如果这些任务彼此不相关，就不一定需要交互。如果进程间没有相互影响的话，不确定性是完全可以接受的。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">results</span>) &#123;</span><br><span class="line">    res.<span class="property">foo</span> = results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">results</span>) &#123;</span><br><span class="line">    res.<span class="property">bar</span> = results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax(..)是某个库提供的某个Ajax函数</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, foo );</span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.2&quot;</span>, bar );</span><br></pre></td></tr></table></figure><h5 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h5><blockquote><p>更常见的情况是，并发的“进程”需要相互交流，通过作用域或DOM间接交互。正如前面介绍的，如果出现这样的交互，就需要对它们的交互进行协调以避免竞态的出现。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">response</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">url</span> == <span class="string">&quot;http://some.url.1&quot;</span>) &#123;</span><br><span class="line">      res[<span class="number">0</span>] = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">url</span> == <span class="string">&quot;http://some.url.2&quot;</span>) &#123;</span><br><span class="line">      res[<span class="number">1</span>] = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax(..)是某个库中提供的某个Ajax函数</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, response );</span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.2&quot;</span>, response );</span><br></pre></td></tr></table></figure><h5 id="协作"><a href="#协作" class="headerlink" title="协作"></a>协作</h5><blockquote><p>还有一种并发合作方式，称为并发协作（cooperative concurrency）。这里的重点不再是通过共享作用域中的值进行交互（尽管显然这也是允许的！）。这里的目标是取到一个长期运行的“进程”，并将其分割成多个步骤或多批任务，使得其他并发“进程”有机会将自己的运算插入到事件循环队列中交替运行。</p></blockquote><p>举例来说，考虑一个需要遍历很长的结果列表进行值转换的Ajax响应处理函数。我们会使用Array#map(..)让代码更简洁：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// response(..)从Ajax调用中取得结果数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">response</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 添加到已有的res数组</span></span><br><span class="line">    res = res.<span class="title function_">concat</span>(</span><br><span class="line">      <span class="comment">// 创建一个新的变换数组把所有data值加倍</span></span><br><span class="line">      data.<span class="title function_">map</span>( <span class="keyword">function</span>(<span class="params">val</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> val * <span class="number">2</span>;</span><br><span class="line">      &#125; )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax(..)是某个库中提供的某个Ajax函数</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, response );</span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.2&quot;</span>, response );</span><br></pre></td></tr></table></figure><p>然而数据量多的话，比如1000万条</p><p>所以，要创建一个协作性更强更友好且不会霸占事件循环队列的并发系统，你可以异步地批处理这些结果 。每次处理之后返回事件循环，让其他等待事件有机会运行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// response(..)从Ajax调用中取得结果数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">response</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 一次处理1000个</span></span><br><span class="line">    <span class="keyword">var</span> chunk = data.<span class="title function_">splice</span>( <span class="number">0</span>, <span class="number">1000</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到已有的res组</span></span><br><span class="line">    res = res.<span class="title function_">concat</span>(</span><br><span class="line">      <span class="comment">// 创建一个新的数组把chunk中所有值加倍</span></span><br><span class="line">      chunk.<span class="title function_">map</span>( <span class="keyword">function</span>(<span class="params">val</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> val * <span class="number">2</span>;</span><br><span class="line">      &#125; )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 还有剩下的需要处理吗？</span></span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 异步调度下一次批处理</span></span><br><span class="line">      <span class="built_in">setTimeout</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="title function_">response</span>( data );</span><br><span class="line">      &#125;, <span class="number">0</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ajax(..)是某个库中提供的某个Ajax函数</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, response );</span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.2&quot;</span>, response );</span><br></pre></td></tr></table></figure><p>这里使用setTimeout(..0)（hack）进行异步调度，基本上它的意思就是“把这个函数插入到当前事件循环队列的结尾处”。</p><h4 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h4><blockquote><p>在ES6中，有一个新的概念建立在事件循环队列之上，叫作任务队列（job queue）。这个概念给大家带来的最大影响可能是Promise的异步特性\</p><p>遗憾的是，目前为止，这是一个没有公开API的机制，因此要展示清楚有些困难。所以我们目前只从概念上进行描述</p></blockquote><p>设想一个调度任务（直接地，不要hack）的API，称其为schedule(..)。考虑：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;A&quot;</span> );</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;B&quot;</span> );</span><br><span class="line">&#125;, <span class="number">0</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 理论上的&quot;任务API&quot;</span></span><br><span class="line"><span class="title function_">schedule</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;C&quot;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="title function_">schedule</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;D&quot;</span> );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>可能你认为这里会打印出A B C D，但实际打印的结果是A C D B。因为任务处理是在当前事件循环tick结尾处，而定时器触发是为了调度下一个事件循环tick（如果可用的话！）。</p><h4 id="语句顺序"><a href="#语句顺序" class="headerlink" title="语句顺序"></a>语句顺序</h4><blockquote><p>代码中语句的顺序和JavaScript引擎执行语句的顺序并不一定要一致。</p></blockquote><p>编写的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span>;</span><br><span class="line">b = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">a = a + <span class="number">1</span>;</span><br><span class="line">b = b + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a + b ); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>js引擎可能会发现，其实这样执行会更快：重排代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">a = <span class="number">11</span>;</span><br><span class="line">b = <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a + b ); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>或者甚至这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为a和b不会被再次使用</span></span><br><span class="line"><span class="comment">// 我们可以inline，从而完全不需要它们！</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="number">42</span> ); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>但是这里有一种场景，其中特定的优化是不安全的，因此也是不允许的:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a, b;</span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span>;</span><br><span class="line">b = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们需要a和b处于递增之前的状态！</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a * b ); <span class="comment">// 300</span></span><br><span class="line"></span><br><span class="line">a = a + <span class="number">1</span>;</span><br><span class="line">b = b + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a + b ); <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>还有其他一些例子，其中编译器重新排序会产生可见的副作用，比如会产生副作用的函数调用（特别是getter函数），或ES6代理对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( b );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a, b, c;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5.1 getter字面量语法</span></span><br><span class="line">c = &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">bar</span>() &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( a );</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span>;</span><br><span class="line">b = <span class="number">30</span>;</span><br><span class="line">a += <span class="title function_">foo</span>();              <span class="comment">// 30</span></span><br><span class="line">b += c.<span class="property">bar</span>;              <span class="comment">// 11</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a + b );    <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>如果不是代码片段中的语句 console.log(),js引擎本来可以把代码重新排序如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span> + <span class="title function_">foo</span>();</span><br><span class="line">b = <span class="number">30</span> + c.<span class="property">bar</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>尽管JavaScript语义让我们不会见到编译器语句重排序可能导致的噩梦，这是一种幸运，但是代码编写的方式（从上到下的模式）和编译后执行的方式之间的联系非常脆弱，理解这一点也非常重要。</p><h3 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h3><blockquote><p>到目前为止，回调是编写和处理JavaScript程序异步逻辑的最常用方式。确实，回调是这门语言中最基础的异步模式。</p></blockquote><h4 id="continuation"><a href="#continuation" class="headerlink" title="continuation"></a>continuation</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A</span></span><br><span class="line"><span class="title function_">ajax</span>( <span class="string">&quot;..&quot;</span>, <span class="keyword">function</span>(<span class="params">..</span>)&#123;</span><br><span class="line">    <span class="comment">// C</span></span><br><span class="line">&#125; );</span><br><span class="line"><span class="comment">// B</span></span><br></pre></td></tr></table></figure><p>// A和// B表示程序的前半部分（也就是现在的部分），而// C标识了程序的后半部分（也就是将来的部分）。前半部分立刻执行，然后是一段时间不确定的停顿。在未来的某个时刻，如果Ajax调用完成，程序就会从停下的位置继续执行后半部分。</p><p>换句话说，回调函数包裹或者说封装了程序的延续（continuation）。</p><p>简化代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A</span></span><br><span class="line"><span class="built_in">setTimeout</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// C</span></span><br><span class="line">&#125;, <span class="number">1000</span> );</span><br><span class="line"><span class="comment">// B</span></span><br></pre></td></tr></table></figure><h4 id="嵌套回调与链式回调"><a href="#嵌套回调与链式回调" class="headerlink" title="嵌套回调与链式回调"></a>嵌套回调与链式回调</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">listen</span>( <span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">evt</span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>( <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">ajax</span>( <span class="string">&quot;http://some.url.1&quot;</span>, <span class="keyword">function</span> <span class="title function_">response</span>(<span class="params">text</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span> (text == <span class="string">&quot;hello&quot;</span>) &#123;</span><br><span class="line">              <span class="title function_">handler</span>();</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (text == <span class="string">&quot;world&quot;</span>) &#123;</span><br><span class="line">              <span class="title function_">request</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; );</span><br><span class="line">    &#125;, <span class="number">500</span>) ;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>你很可能非常熟悉这样的代码。这里我们得到了三个函数嵌套在一起构成的链，其中每个函数代表异步序列（任务，“进程”）中的一个步骤。</p><p>这种代码常常被称为<strong>回调地狱</strong>（callback hell）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doA</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">doB</span>();</span><br><span class="line">    <span class="title function_">doC</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">doD</span>();</span><br><span class="line">    &#125; )</span><br><span class="line"></span><br><span class="line">    <span class="title function_">doE</span>();</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="title function_">doF</span>();</span><br></pre></td></tr></table></figure><p>你第一眼看到前面这段代码就分析出正确的顺序了吗？</p><h4 id="信任问题"><a href="#信任问题" class="headerlink" title="信任问题"></a>信任问题</h4><p>假设你是一名开发人员，为某个销售昂贵电视的网站建立商务结账系统。你已经做好了结账系统的各个界面。在最后一页，当用户点击“确定”就可以购买电视时，你需要调用（假设由某个分析追踪公司提供的）第三方函数以便跟踪这个交易。</p><p>你注意到，可能是为了提高性能，他们提供了一个看似用于异步追踪的工具，这意味着你需要传入一个回调函数。在传入的这个continuation中，你需要提供向客户收费和展示感谢页面的最终代码。代码可能是这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">analytics.<span class="title function_">trackPurchase</span>( purchaseData, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">chargeCreditCard</span>();</span><br><span class="line">  <span class="title function_">displayThankyouPage</span>();</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>六个月过去了，没有任何问题。你几乎已经忘了自己写过这么一段代码。某个上班之前的早晨，你像往常一样在咖啡馆里享用一杯拿铁。突然，你的老板惊慌失措地打电话过来，让你放下咖啡赶紧到办公室。</p><p>原因是一位高级客户购买了一台电视，信用卡被刷了5次。老板很生气并询问你为何出现这种事情，这种情况你没有测试过么？</p><p>你甚至都不记得自己写过这段代码。但是，你得深入研究这些代码，并开始寻找问题产生的原因。</p><p>通过分析日志，你得出一个结论：唯一的解释就是那个分析工具出于某种原因把你的回调调用了五次而不是一次。他们的文档中完全没有提到这种情况。</p><p>然后你联系它们的客服，客服表示吃惊并马上联系开发者，明天给你回复。第二天你收到一封很长的信，是他们解释的原因，于是你转发给老板</p><p>然后呢？你和老板讨论此事，他对这种状况却不怎么满意。他坚持认为，你不能再信任他们了（你们受到了伤害）。对此你也只能无奈接受，并且你需要找到某种方法来保护结账代码，保证不再出问题。</p><p>于是乎面临这样的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tracked = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">analytics.<span class="title function_">trackPurchase</span>( purchaseData, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (! tracked) &#123;</span><br><span class="line">      tracked = <span class="literal">true</span>;</span><br><span class="line">      <span class="title function_">chargeCreditCard</span>();</span><br><span class="line">      <span class="title function_">displayThankyouPage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>再后来，又有人质疑说</p><p>• 调用回调过早（在追踪之前）；</p><p>• 调用回调过晚（或没有调用）；</p><p>• 调用回调的次数太少或太多（就像你遇到过的问题！）；</p><p>• 没有把所需的环境/参数成功传给你的回调函数；</p><p>• 吞掉可能出现的错误或异常；</p><p>• ……</p><p>你可能已经开始慢慢意识到，对于被传给你无法信任的工具的每个回调，你都将不得不创建大量的混乱逻辑。</p><p>现在你应该更加明白回调地狱是多像地狱了吧。</p><h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><blockquote><p>回忆一下，我们用回调函数来封装程序中的continuation，然后把回调交给第三方（甚至可能是外部代码），接着期待其能够调用回调，实现正确的功能。通过这种形式，我们要表达的意思是：“这是将来要做的事情，要在当前的步骤完成之后发生。”</p><p>但是，如果我们能够把控制反转再反转回来，会怎样呢？如果我们不把自己程序的continuation传给第三方，而是希望第三方给我们提供了解其任务何时结束的能力，然后由我们自己的代码来决定下一步做什么，那将会怎样呢？</p><p>这种范式就称为Promise</p></blockquote><h5 id="什么是Promise"><a href="#什么是Promise" class="headerlink" title="什么是Promise"></a>什么是Promise</h5><blockquote></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">xPromise, yPromise</span>) &#123;</span><br><span class="line">    <span class="comment">// Promise.all([ .. ])接受一个promise数组并返回一个新的promise，</span></span><br><span class="line">    <span class="comment">// 这个新promise等待数组中的所有promise完成</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>( [xPromise, yPromise] )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个promise决议之后，我们取得收到的X和Y值并加在一起</span></span><br><span class="line">    .<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">values</span>)&#123;</span><br><span class="line">      <span class="comment">// values是来自于之前决议的promise的消息数组</span></span><br><span class="line">      <span class="keyword">return</span> values[<span class="number">0</span>] + values[<span class="number">1</span>];</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fetchX()和fetchY()返回相应值的promise，可能已经就绪，</span></span><br><span class="line"><span class="comment">// 也可能以后就绪</span></span><br><span class="line"><span class="title function_">add</span>( <span class="title function_">fetchX</span>(), <span class="title function_">fetchY</span>() )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们得到一个这两个数组的和的promise</span></span><br><span class="line"><span class="comment">// 现在链式调用then(..)来等待返回promise的决议</span></span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">sum</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( sum ); <span class="comment">// 这更简单！</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><blockquote><p>在add(..)内部，Promise.all([ .. ])调用创建了一个promise（这个promise等待promiseX和promiseY的决议）。链式调用．then(..)创建了另外一个promise。这个promise由return values[0] + values[1]这一行立即决议（得到加运算的结果）。</p><p>因此，链add(..)调用终止处的调用then(..)——在代码结尾处——实际上操作的是返回的第二个promise，而不是由Promise.all([ .. ])创建的第一个promise。还有，尽管第二个then(..)后面没有链接任何东西，但它实际上也创建了一个新的promise，如果想要观察或者使用它的话就可以看到。</p></blockquote><p>new Promise( function(..){ .. } )模式通常称为<a href="http://domenic.me/2014/02/13/the-revealing-constructor-pattern/">revealing constructor</a> <strong>传入的函数会立即执行</strong>（不会像then(..)中的回调一样异步延迟），它有两个参数，在本例中我们将其分别称为resolve和reject。这些是promise的决议函数。resolve(..)通常标识完成，而reject(..)则标识拒绝。</p><p>检查一个对象是否是Promise对象？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p <span class="keyword">instanceof</span> <span class="title class_">Promise</span></span><br></pre></td></tr></table></figure><p>这种方法有缺陷，浏览器不同窗口的 Promise 实例不同，比如当前窗口Promise与，当前窗口iframe的不同</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    p ! == <span class="literal">null</span> &amp;&amp;</span><br><span class="line">    (</span><br><span class="line">      <span class="keyword">typeof</span> p === <span class="string">&quot;object&quot;</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> p === <span class="string">&quot;function&quot;</span></span><br><span class="line">    ) &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> p.<span class="property">then</span> === <span class="string">&quot;function&quot;</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// 假定这是一个thenable!</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 不是thenable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>识别Promise（或者行为类似于Promise的东西）就是定义某种称为thenable的东西，将其定义为任何具有then(..)方法的对象和函数。我们认为，任何这样的值就是Promise一致的thenable。</p></blockquote><p>先回顾一下只用回调编码的信任问题。把一个回调传入工具foo(..)时可能出现如下问题：</p><p>Promise的特性就是专门用来为这些问题提供一个有效的可复用的答案。</p><p>• <strong>调用回调过早</strong>；</p><blockquote><p>根据定义，Promise就不必担心这种问题，因为即使是立即完成的Promise（类似于new Promise(function(resolve){ resolve(42);})）也无法被同步观察到。</p><p>也就是说，对一个Promise调用then(..)的时候，即使这个Promise已经决议，提供给then(..)的回调也总会被异步调用</p></blockquote><p>• <strong>调用回调过晚（或不被调用）</strong>；</p><blockquote><p>和前面一点类似，Promise创建对象调用resolve(..)或reject(..)时，这个Promise的then(..)注册的观察回调就会被自动调度。可以确信，这些被调度的回调在下一个异步事件点上一定会被触发.</p><p>这些回调中的任意一个都无法影响或延误对其他回调的调用。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    p.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;C&quot;</span> );</span><br><span class="line">    &#125; );</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;A&quot;</span> );</span><br><span class="line">&#125; );</span><br><span class="line">p.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;B&quot;</span> );</span><br><span class="line">&#125; );</span><br><span class="line"><span class="comment">// A B C</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里，”C”无法打断或抢占”B”，这是因为Promise的运作方式。</p><p>如果两个promise p1和p2都已经决议，那么p1.then(..);p2.then(..)应该最终会先调用p1的回调，然后是p2的那些。但还有一些微妙的场景可能不是这样的，比如以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>( <span class="string">&quot;B&quot;</span> );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>( p3 );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>( <span class="string">&quot;A&quot;</span> );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line">p1.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );</span><br><span class="line">&#125; );</span><br><span class="line">p2.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="comment">// A B    &lt;-- 而不是像你可能认为的B A</span></span><br></pre></td></tr></table></figure><p>防止不被调用的超时模式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于超时一个Promise的工具</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">timeoutPromise</span>(<span class="params">delay</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>( <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="title function_">reject</span>( <span class="string">&quot;Timeout! &quot;</span> );</span><br><span class="line">      &#125;, delay );</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置foo()超时</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>( [</span><br><span class="line">    <span class="title function_">foo</span>(),                      <span class="comment">// 试着开始foo()</span></span><br><span class="line">    <span class="title function_">timeoutPromise</span>( <span class="number">3000</span> )      <span class="comment">// 给它3秒钟</span></span><br><span class="line">] )</span><br><span class="line">.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">// foo(..)及时完成！</span></span><br><span class="line">    &#125;,</span><br><span class="line">                  <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">          <span class="comment">// 或者foo()被拒绝，或者只是没能按时完成</span></span><br><span class="line">          <span class="comment">// 查看err来了解是哪种情况</span></span><br><span class="line">      &#125;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure><p>Promise.race,返回多个Promise中最快的那一个</p><p>• <strong>调用回调次数过少或过多</strong>；</p><blockquote><p>根据定义，回调被调用的正确次数应该是1。“过少”的情况就是调用0次，和前面解释过的“未被”调用是同一种情况。</p><p>如果出于某种原因，Promise创建代码试图调用resolve(..)或reject(..)多次，或者试图两者都调用，那么这个Promise将只会接受第一次决议，并默默地忽略任何后续调用。</p></blockquote><p>• <strong>未能传递所需的环境和参数</strong>；</p><blockquote><p>Promise至多只能有一个决议值（完成或拒绝）。</p><p>如果你没有用任何值显式决议，那么这个值就是undefined，这是JavaScript常见的处理方式。但不管这个值是什么，无论当前或未来，它都会被传给所有注册的（且适当的完成或拒绝）回调。</p><p>如果使用多个参数调用resovle(..)或者reject(..)，第一个参数之后的所有参数都会被默默忽略。</p><p>如果要传递多个值，你就必须要把它们封装在单个值中传递，比如通过一个数组或对象。</p></blockquote><p>• <strong>吞掉可能出现的错误和异常</strong>。</p><blockquote><p>基本上，这部分是上个要点的再次说明。如果拒绝一个Promise并给出一个理由（也就是一个出错消息），这个值就会被传给拒绝回调。</p><p>如果在Promise的创建过程中或在查看其决议结果过程中的任何时间点上出现了一个JavaScript异常错误，比如一个TypeError或ReferenceError，那这个异常就会被捕捉，并且会使这个Promise被拒绝。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    foo.<span class="title function_">bar</span>();  <span class="comment">// foo未定义，所以会出错！</span></span><br><span class="line">    <span class="title function_">resolve</span>( <span class="number">42</span> );  <span class="comment">// 永远不会到达这里 :(</span></span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">// 永远不会到达这里 :(</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">rejected</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="comment">// err将会是一个来自foo.bar()这一行的TypeError异常对象</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>foo.bar()中发生的JavaScript异常导致了Promise拒绝，你可以捕捉并对其作出响应。</p><h5 id="Promise是可信任的么"><a href="#Promise是可信任的么" class="headerlink" title="Promise是可信任的么"></a>Promise是可信任的么</h5><blockquote><p>Promise并没有完全摆脱回调。它们只是改变了传递回调的位置。</p><p>为什么这就比单纯使用回调更值得信任呢？如何能够确定返回的这个东西实际上就是一个可信任的Promise呢？</p></blockquote><p>Promise对这个问题已经有一个解决方案。包含在原生ES6 Promise实现中的解决方案就是Promise.resolve(..)。</p><p>如果向Promise.resolve(..)传递一个非Promise、非thenable的立即值，就会得到一个用这个值填充的promise。下面这种情况下，promise p1和promise p2的行为是完全一样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>( <span class="number">42</span> );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>( <span class="number">42</span> );</span><br></pre></td></tr></table></figure><p>更重要的是，如果向Promise.resolve(..)传递了一个非Promise的thenable值，前者就会试图展开这个值，而且展开过程会持续到提取出一个具体的非类Promise的最终值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = &#123;</span><br><span class="line">    <span class="attr">then</span>: <span class="keyword">function</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">      <span class="title function_">cb</span>( <span class="number">42</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这可以工作，但只是因为幸运而已</span></span><br><span class="line">p</span><br><span class="line">.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params">val</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( val ); <span class="comment">// 42</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">rejected</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="comment">// 永远不会到达这里</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Promise.resolve(..)提供了可信任的Promise封装工具，可以链接使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不要只是这么做：</span></span><br><span class="line"><span class="title function_">foo</span>( <span class="number">42</span> )</span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );</span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 而要这么做：</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>( <span class="title function_">foo</span>( <span class="number">42</span> ) )</span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><h5 id="链式流"><a href="#链式流" class="headerlink" title="链式流"></a>链式流</h5><blockquote><p>我们可以把多个Promise连接到一起以表示一系列异步步骤</p><p>这种方式可以实现的关键在于以下两个Promise固有行为特性：</p><p>• 每次你对Promise调用then(..)，它都会创建并返回一个新的Promise，我们可以将其链接起来；</p><p>• 不管从then(..)调用的完成回调（第一个参数）返回的值是什么，它都会被自动设置为被链接Promise（第一点中的）的完成。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>( <span class="number">21</span> );</span><br><span class="line"></span><br><span class="line">p</span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );    <span class="comment">// 21</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用值42完成连接的promise</span></span><br><span class="line">    <span class="keyword">return</span> v * <span class="number">2</span>;</span><br><span class="line">&#125; )</span><br><span class="line"><span class="comment">// 这里是链接的promise</span></span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );    <span class="comment">// 42</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>在这些例子中，一步步传递的值是可选的。如果不显式返回一个值，就会隐式返回undefined，并且这些promise仍然会以同样的方式链接在一起。</p><p><strong>如果这个Promise链中的某个步骤出错了怎么办？</strong></p><p>这意味着可能在链的任意位置捕捉到这样的错误，而这个捕捉动作在某种程度上就相当于在这一位置将整条链“重置”回了正常运作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 步骤1：</span></span><br><span class="line"><span class="title function_">request</span>( <span class="string">&quot;http://some.url.1/&quot;</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 步骤2：</span></span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">response1</span>)&#123;</span><br><span class="line">    foo.<span class="title function_">bar</span>(); <span class="comment">// undefined，出错！</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 永远不会到达这里</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>( <span class="string">&quot;http://some.url.2/? v=&quot;</span> + response1 );</span><br><span class="line">&#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 步骤3：</span></span><br><span class="line">.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params">response2</span>)&#123;</span><br><span class="line">      <span class="comment">// 永远不会到达这里</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 捕捉错误的拒绝处理函数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">rejected</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( err );</span><br><span class="line">      <span class="comment">// 来自foo.bar()的错误TypeError</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 步骤4：</span></span><br><span class="line">.<span class="title function_">then</span>( <span class="keyword">function</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( msg );           <span class="comment">// 42</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><blockquote><p>调用then(..)时的完成处理函数或拒绝处理函数如果抛出异常，都会导致（链中的）下一个promise因这个异常而立即被拒绝。</p><p>调用promise的then(..)，并且只传入一个完成处理函数，一个默认拒绝处理函数就会顶替上来。默认拒绝处理函数只是把错误重新抛出，这最终会使得链条下一步用同样的错误理由拒绝</p><p>实际上啥都不传也会有一个默认的处理成功的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>第2步出错后，第3步的拒绝处理函数会捕捉到这个错误。拒绝处理函数的返回值（这段代码中是42），如果有的话，会用来完成交给下一个步骤（第4步）的promise，这样，这个链现在就回到了完成状态。</p><h5 id="术语：决议、完成以及拒绝"><a href="#术语：决议、完成以及拒绝" class="headerlink" title="术语：决议、完成以及拒绝"></a>术语：决议、完成以及拒绝</h5><blockquote><p>对于术语决议（resolve）、完成（fulfill）和拒绝（reject），在更深入学习Promise之前，我们还有一些模糊之处需要澄清。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">X, Y</span>)&#123;</span><br><span class="line">    <span class="comment">// X()用于完成</span></span><br><span class="line">    <span class="comment">// Y()用于拒绝</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><p>第一个通常用于标识Promise已经完成，第二个总是用于标识Promise被拒绝.ES6规范将这两个回调命名为onFulfilled(..)和onRejected(..)，所以这两个术语很准确。</p><h5 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h5><blockquote><p>错误处理最自然的形式就是同步的try..catch结构。遗憾的是，它只能是同步的，无法用于异步代码模式</p></blockquote><p>如果通过无效的方式使用Promise API，并且出现一个错误阻碍了正常的Promise构造，那么结果会得到一个立即抛出的异常，而不是一个被拒绝的Promise。</p><p>例子：new Promise(null)、Promise.all()、Promise.race(42)，等等</p><p>如果一开始你就没能有效使用Promise API真正构造出一个Promise，那就无法得到一个被拒绝的Promise！</p><p>为了避免丢失被忽略和抛弃的Promise错误，一些开发者表示，Promise链的一个最佳实践就是最后总以一个catch(..)结束:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>( <span class="number">42</span> );</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">      <span class="comment">// 数字没有string函数，所以会抛出错误</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( msg.<span class="title function_">toLowerCase</span>() );</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">.<span class="title function_">catch</span>( handleErrors );</span><br></pre></td></tr></table></figure><p>如果handleErrors(..)本身内部也有错误怎么办呢？</p><h5 id="成功的坑"><a href="#成功的坑" class="headerlink" title="成功的坑"></a>成功的坑</h5><blockquote><p>接下来的内容只是理论上的</p><p>• 默认情况下，Promsie在下一个任务或时间循环tick上（向开发者终端）报告所有拒绝，如果在这个时间点上该Promise上还没有注册错误处理函数。</p><p>• 如果想要一个被拒绝的Promise在查看之前的某个时间段内保持被拒绝状态，可以调用defer()，这个函数优先级高于该Promise的自动错误报告。</p></blockquote><p>如果一个Promise被拒绝的话，默认情况下会向开发者终端报告这个事实（而不是默认为沉默）。可以选择隐式（在拒绝之前注册一个错误处理函数）或者显式（通过defer()）禁止这种报告。在这两种情况下，都是由你来控制误报的情况。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="title class_">Promise</span>.<span class="title function_">reject</span>( <span class="string">&quot;Oops&quot;</span> ).<span class="title function_">defer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo(..)是支持Promise的</span></span><br><span class="line"><span class="title function_">foo</span>( <span class="number">42</span> )</span><br><span class="line">.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fulfilled</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">rejected</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="comment">// 处理foo(..)错误</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>创建p的时候，我们知道需要等待一段时间才能使用或查看它的拒绝结果，所以我们就调用defer()，这样就不会有全局报告出现。为了便于链接，defer()只是返回这同一个promise。</p><p>从foo(..)返回的promise立刻就被关联了一个错误处理函数，所以它也隐式消除了出错全局报告。</p><h5 id="Promise模式"><a href="#Promise模式" class="headerlink" title="Promise模式"></a>Promise模式</h5><blockquote><p><strong>Promise.all</strong>([ .. ])需要一个参数，是一个数组，通常由Promise实例组成。从Promise. all([ .. ])调用返回的promise会收到一个完成消息（代码片段中的msg）。这是一个由所有传入promise的完成消息组成的数组，与指定的顺序一致（与完成顺序无关）。</p><p>数组中的值可以是Promise、thenable，甚至是立即值</p></blockquote><blockquote><p><strong>Promise.race</strong>([ .. ])就会完成；一旦有任何一个Promise决议为拒绝，它就会拒绝。</p></blockquote><p>变体模式</p><p>• none([ .. ])这个模式类似于all([ .. ])，不过完成和拒绝的情况互换了。所有的Promise都要被拒绝，即拒绝转化为完成值，反之亦然。</p><p>• any([ .. ])这个模式与all([ .. ])类似，但是会忽略拒绝，所以只需要完成一个而不是全部。</p><p>• first([ .. ])这个模式类似于与any([ .. ])的竞争，即只要第一个Promise完成，它就会忽略后续的任何拒绝和完成。</p><p>• last([ .. ])这个模式类似于first([ .. ])，但却是只有最后一个完成胜出。</p><p>自己实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// polyfill安全的guard检查</span></span><br><span class="line"><span class="keyword">if</span> (! <span class="title class_">Promise</span>.<span class="property">first</span>) &#123;</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">first</span> = <span class="keyword">function</span>(<span class="params">prs</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">          <span class="comment">// 在所有promise上循环</span></span><br><span class="line">          prs.<span class="title function_">forEach</span>( <span class="keyword">function</span>(<span class="params">pr</span>)&#123;</span><br><span class="line">              <span class="comment">// 把值规整化</span></span><br><span class="line">              <span class="title class_">Promise</span>.<span class="title function_">resolve</span>( pr )</span><br><span class="line">              <span class="comment">// 不管哪个最先完成，就决议主promise</span></span><br><span class="line">              .<span class="title function_">then</span>( resolve );</span><br><span class="line">          &#125; );</span><br><span class="line">      &#125; );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果所有的promise都被拒绝，就在主promise上调用reject()。这个实现留给你当练习。</p><h5 id="then-和catch"><a href="#then-和catch" class="headerlink" title="then(..)和catch(..)"></a>then(..)和catch(..)</h5><blockquote><p>catch捕获错误后，设置返回值。那么Promise链后面还能获取到catch的返回值，如果 onReject函数存在语法错误，会走catch语句</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&#x27;reject&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;没错误：&#x27;</span>,res)   </span><br><span class="line">    &#125;,<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;出错！&#x27;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;reject&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;有错误：&#x27;</span>,err)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;catch&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;下一轮：&#x27;</span>, res)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">// 出错！ reject</span></span><br><span class="line"><span class="comment">// 下一轮： reject</span></span><br></pre></td></tr></table></figure><p>基于回调的工具</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// polyfill安全的guard检查</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title class_">Promise</span>.<span class="property">wrap</span>) &#123;</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">wrap</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> args = [].<span class="property">slice</span>.<span class="title function_">call</span>( <span class="variable language_">arguments</span> );</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">                  fn.<span class="title function_">apply</span>(</span><br><span class="line">                    <span class="literal">null</span>,</span><br><span class="line">                    args.<span class="title function_">concat</span>( <span class="keyword">function</span>(<span class="params">err, v</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>( err );</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title function_">resolve</span>( v );</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; )</span><br><span class="line">                  );</span><br><span class="line">              &#125; );</span><br><span class="line">          &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="title class_">Promise</span>.<span class="title function_">wrap</span>( ajax );</span><br><span class="line"></span><br><span class="line"><span class="title function_">request</span>( <span class="string">&quot;http://some.url.1/&quot;</span> )</span><br><span class="line">.<span class="title function_">then</span>( .. )</span><br><span class="line">..</span><br></pre></td></tr></table></figure><p>Promise.wrap(..)并不产出Promise。它产出的是一个将产生Promise的函数。在某种意义上，产生Promise的函数可以看作是一个Promise工厂。</p><h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><blockquote><p>一个函数一旦开始执行，就会运行到结束，期间不会有其他代码能够打断它并插入其间。</p><p>生成器就是一类特殊的函数，可以一次或多次启动和停止，并不一定非得要完成。</p></blockquote><h5 id="迭代消息传递"><a href="#迭代消息传递" class="headerlink" title="迭代消息传递"></a>迭代消息传递</h5><blockquote><p>除了能够接受参数并提供返回值之外，生成器甚至提供了更强大更引人注目的内建消息输入输出能力，通过yield和next(..)实现。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y = x * (<span class="keyword">yield</span>);</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = <span class="title function_">foo</span>( <span class="number">6</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动foo(..)</span></span><br><span class="line">it.<span class="title function_">next</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = it.<span class="title function_">next</span>( <span class="number">7</span> );</span><br><span class="line"></span><br><span class="line">res.<span class="property">value</span>;     <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><blockquote><p>根据你的视角不同，yield和next(..)调用有一个不匹配。一般来说，需要的next(..)调用要比yield语句多一个，前面的代码片段有一个yield和两个next(..)调用。</p><p>因为第一个next(..)总是启动一个生成器，并运行到第一个yield处。不过，是第二个next(..)调用完成第一个被暂停的yield表达式，第三个next(..)调用完成第二个yield，以此类推。</p></blockquote><p><strong>注意：在生成器的起始处我们调用第一个next()时，还没有暂停的yield来接受这样一个值。规范和所有兼容浏览器都会默默丢弃传递给第一个next()的任何东西。因此，启动生成器时一定要用不带参数的next()。</strong></p><p>如果你的生成器中没有return的话——在生成器中和在普通函数中一样，return当然不是必需的——总有一个假定的/隐式的return;（也就是return undefined;），<strong>它会在默认情况下回答最后的it.next(7)调用提出的问题</strong>。</p><h5 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h5><blockquote><p>它的接口中有一个next()方法。而与其紧密相关的一个术语是iterable（可迭代），即指一个包含可以在其值上迭代的迭代器的对象。</p><p>其名称是专门的ES6符号值Symbol.iterator。调用这个函数时，它会返回一个迭代器。通常每次调用会返回一个全新的迭代器，虽然这一点并不是必须的。</p></blockquote><p>生成器实现标准的迭代器接口：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> something = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> nextVal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// for..of循环需要</span></span><br><span class="line">      [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="keyword">return</span> <span class="variable language_">this</span>; &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 标准迭代器接口方法</span></span><br><span class="line">      <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="keyword">if</span> (nextVal === <span class="literal">undefined</span>) &#123;</span><br><span class="line">              nextVal = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              nextVal = (<span class="number">3</span> * nextVal) + <span class="number">6</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> &#123; <span class="attr">done</span>:<span class="literal">false</span>, <span class="attr">value</span>:nextVal &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span>;     <span class="comment">// 1</span></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span>;     <span class="comment">// 9</span></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span>;     <span class="comment">// 33</span></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span>;     <span class="comment">// 105</span></span><br></pre></td></tr></table></figure><p>内置迭代器：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = a[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"></span><br><span class="line">it.<span class="title function_">next</span>().<span class="property">value</span>;    <span class="comment">// 1</span></span><br><span class="line">it.<span class="title function_">next</span>().<span class="property">value</span>;    <span class="comment">// 3</span></span><br><span class="line">it.<span class="title function_">next</span>().<span class="property">value</span>;    <span class="comment">// 5</span></span><br><span class="line">..</span><br></pre></td></tr></table></figure><p>前面的代码中列出了定义的something，你可能已经注意到了这一行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for..of循环需要</span></span><br><span class="line">[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="keyword">return</span> <span class="variable language_">this</span>; &#125;</span><br></pre></td></tr></table></figure><p>这段有点令人疑惑的代码是在将something的值（迭代器something的接口）也构建成为一个iterable。现在它既是iterable，也是迭代器。然后我们把something传给for..of循环：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> v <span class="keyword">of</span> something) &#123;</span><br><span class="line">    ..</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="生成器迭代器"><a href="#生成器迭代器" class="headerlink" title="生成器迭代器"></a>生成器迭代器</h5><blockquote><p>可以把生成器看作一个值的生产者，我们通过迭代器接口的next()调用一次提取出一个值。</p><p>严格说来，生成器本身并不是iterable，尽管非常类似——当你执行一个生成器，就得到了一个迭代器：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params"></span>)&#123; .. &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> it = <span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure><p>可以通过生成器实现前面的这个something无限数字序列生产者，类似这样：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">something</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nextVal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nextVal === <span class="literal">undefined</span>) &#123;</span><br><span class="line">          nextVal = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          nextVal = (<span class="number">3</span> * nextVal) + <span class="number">6</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> nextVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>• 为什么不能用for (var v of something) .. ？因为这里的something是生成器，并不是iterable。我们需要调用something()来构造一个生产者供for..of循环迭代。</p><p>• something()调用产生一个迭代器，但for..of循环需要的是一个iterable，对吧？是的。生成器的迭代器也有一个Symbol.iterator函数，基本上这个函数做的就是return this，和我们前面定义的iterable something一样。换句话说，生成器的迭代器也是一个iterable！</p><h5 id="停止生成器"><a href="#停止生成器" class="headerlink" title="停止生成器"></a>停止生成器</h5><blockquote><p>something()生成器的迭代器实例在循环中的break调用之后就永远留在了挂起状态。</p><p>其实有一个隐藏的特性会帮助你管理此事。for..of循环的“异常结束”（也就是“提前终止”），通常由break、return或者未捕获异常引起，会向生成器的迭代器发送一个信号使其终止。</p></blockquote><p>如果在生成器内有try..finally语句，它将总是运行，即使生成器已经外部结束。如果需要清理资源的话（数据库连接等），这一点非常有用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">something</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> nextVal;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (nextVal === <span class="literal">undefined</span>) &#123;</span><br><span class="line">              nextVal = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              nextVal = (<span class="number">3</span> ＊ nextVal) + <span class="number">6</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">yield</span> nextVal;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 清理子句</span></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;cleaning up! &quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之前的例子中，for..of循环内的break会触发finally语句。但是，也可以在外部通过return(..)手工终止生成器的迭代器实例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> it = <span class="title function_">something</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> v <span class="keyword">of</span> it) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( v );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不要死循环！</span></span><br><span class="line">    <span class="keyword">if</span> (v &gt; <span class="number">500</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="comment">// 完成生成器的迭代器</span></span><br><span class="line">          it.<span class="keyword">return</span>( <span class="string">&quot;Hello World&quot;</span> ).<span class="property">value</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// 这里不需要break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 9 33105 321969</span></span><br><span class="line"><span class="comment">// cleaning up!</span></span><br><span class="line"><span class="comment">// Hello World</span></span><br></pre></td></tr></table></figure><h5 id="异步迭代生成器"><a href="#异步迭代生成器" class="headerlink" title="异步迭代生成器"></a>异步迭代生成器</h5><p>如果想要通过生成器来表达同样的任务流程控制，可以这样实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="title function_">ajax</span>(</span><br><span class="line">      <span class="string">&quot;http://some.url.1/? x=&quot;</span> + x + <span class="string">&quot;&amp;y=&quot;</span> + y,</span><br><span class="line">      <span class="keyword">function</span>(<span class="params">err, data</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">              <span class="comment">// 向*main()抛出一个错误</span></span><br><span class="line">              it.<span class="keyword">throw</span>( err );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 用收到的data恢复＊main()</span></span><br><span class="line">              it.<span class="title function_">next</span>( data );</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> *<span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> text = <span class="keyword">yield</span> <span class="title function_">foo</span>( <span class="number">11</span>, <span class="number">31</span> );</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( text );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>( err );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> it = <span class="title function_">main</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里启动！</span></span><br><span class="line">  it.<span class="title function_">next</span>();</span><br></pre></td></tr></table></figure><p>这是如何工作的呢？调用foo(..)是异步完成的，难道try..catch不是无法捕获异步错误，就像我们在第3章中看到的一样吗？</p><p>我们已经看到yield是如何让赋值语句暂停来等待foo(..)完成，使得响应完成后可以被赋给text。精彩的部分在于yield暂停也使得生成器能够捕获错误。通过这段前面列出的代码把错误抛出到生成器中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 向*main()抛出一个错误</span></span><br><span class="line">      it.<span class="keyword">throw</span>( err );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生成器yield暂停的特性意味着我们不仅能够从异步函数调用得到看似同步的返回值，还可以同步捕获来自这些异步函数调用的错误！</p><h5 id="生成器-Promise"><a href="#生成器-Promise" class="headerlink" title="生成器+Promise"></a>生成器+Promise</h5><blockquote><p>ES6中最完美的世界就是生成器（看似同步的异步代码）和Promise（可信任可组合）的结合</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">&quot;http://some.url.1/? x=&quot;</span> + x + <span class="string">&quot;&amp;y=&quot;</span> + y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> *<span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> text = <span class="keyword">yield</span> <span class="title function_">foo</span>( <span class="number">11</span>, <span class="number">31</span> );</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( text );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>( err );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> it = <span class="title function_">main</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = it.<span class="title function_">next</span>().<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待promise p决议</span></span><br><span class="line">p.<span class="title function_">then</span>(</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">text</span>)&#123;</span><br><span class="line">      it.<span class="title function_">next</span>( text );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      it.<span class="keyword">throw</span>( err );</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>使用专门设计用来以我们前面展示的方式运行Promise-yielding生成器的工具。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在此感谢Benjamin Gruenbaum（@benjamingr on GitHub）的巨大改进！</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">gen</span>) &#123;</span><br><span class="line">    <span class="comment">// 去除第一个参数</span></span><br><span class="line">    <span class="keyword">var</span> args = [].<span class="property">slice</span>.<span class="title function_">call</span>( <span class="variable language_">arguments</span>, <span class="number">1</span>), it;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在当前上下文中初始化生成器</span></span><br><span class="line">    it = gen.<span class="title function_">apply</span>( <span class="variable language_">this</span>, args );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回一个promise用于生成器完成</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">        .<span class="title function_">then</span>( <span class="keyword">function</span> <span class="title function_">handleNext</span>(<span class="params">value</span>)&#123;</span><br><span class="line">            <span class="comment">// 对下一个yield出的值运行</span></span><br><span class="line">            <span class="keyword">var</span> next = it.<span class="title function_">next</span>( value );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">function</span> <span class="title function_">handleResult</span>(<span class="params">next</span>)&#123;</span><br><span class="line">                <span class="comment">// 生成器运行完毕了吗？</span></span><br><span class="line">                <span class="keyword">if</span> (next.<span class="property">done</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> next.<span class="property">value</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 否则继续运行</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>( next.<span class="property">value</span> )</span><br><span class="line">                    .<span class="title function_">then</span>(</span><br><span class="line">                        <span class="comment">// 成功就恢复异步循环，把决议的值发回生成器</span></span><br><span class="line">                        handleNext,</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 如果value是被拒绝的promise，</span></span><br><span class="line">                        <span class="comment">// 就把错误传回生成器进行出错处理</span></span><br><span class="line">                        <span class="keyword">function</span> <span class="title function_">handleErr</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(</span><br><span class="line">                            it.<span class="keyword">throw</span>( err )</span><br><span class="line">                            .<span class="title function_">then</span>( handleResult );</span><br><span class="line">                        &#125;</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)(next);</span><br><span class="line">        &#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上边例子使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>( main );</span><br></pre></td></tr></table></figure><h5 id="ES7-async与await"><a href="#ES7-async与await" class="headerlink" title="ES7:async与await?"></a>ES7:async与await?</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(</span><br><span class="line">      <span class="string">&quot;http://some.url.1/? x=&quot;</span> + x + <span class="string">&quot;&amp;y=&quot;</span> + y</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> text = <span class="keyword">await</span> <span class="title function_">foo</span>( <span class="number">11</span>, <span class="number">31</span> );</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( text );</span><br><span class="line">    &#125;</span><br><span class="line">                <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>( err );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure><h3 id="程序性能"><a href="#程序性能" class="headerlink" title="程序性能"></a>程序性能</h3><h4 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a>Web Worker</h4><blockquote><p>如果你有一些处理密集型的任务要执行，但不希望它们都在主线程运行（这可能会减慢浏览器/UI），可能你就会希望JavaScript能够以多线程的方式运行。</p><p>浏览器这样的环境，很容易提供多个JavaScript引擎实例，各自运行在自己的线程上，这样你可以在每个线程上运行不同的程序。程序中每一个这样的独立的多线程部分被称为一个（Web）Worker。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w1 = <span class="keyword">new</span> <span class="title class_">Worker</span>( <span class="string">&quot;http://some.url.1/mycoolworker.js&quot;</span> );</span><br></pre></td></tr></table></figure><p>这个<strong>URL应该指向一个JavaScript文件的位置</strong>，还可以通过提供一个<strong>Blob URL</strong>（另外一个HTML5特性）创建一个在线Worker（Inline Worker)，本质上就是一个存储在单个（二进制）值中的在线文件</p><p>Worker之间以及<strong>它们和主程序之间，不会共享任何作用域或资源</strong>，那会把所有多线程编程的噩梦带到前端领域，而是通过一个基本的<strong>事件消息机制相互联系</strong>。</p><p>Worker w1对象是一个事件侦听者和触发者，可以通过订阅它来获得这个Worker发出的事件以及发送事件给这个Worker。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听 worker 消息发送</span></span><br><span class="line">w1.<span class="title function_">addEventListener</span>( <span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">evt</span>)&#123;</span><br><span class="line">    <span class="comment">// evt.data</span></span><br><span class="line">&#125; );</span><br><span class="line"><span class="comment">// 主动向worker 发送消息</span></span><br><span class="line">w1.<span class="title function_">postMessage</span>( <span class="string">&quot;something cool to say&quot;</span> );</span><br></pre></td></tr></table></figure><p>Worker内部，收发消息是完全对称的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;mycoolworker.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">addEventListener</span>( <span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">evt</span>)&#123;</span><br><span class="line"><span class="comment">// evt.data</span></span><br><span class="line">&#125; );</span><br><span class="line"></span><br><span class="line"><span class="title function_">postMessage</span>( <span class="string">&quot;a really cool reply&quot;</span> );</span><br></pre></td></tr></table></figure><p>Worker 也可以实例化子Worker，称为 subworker.有时候吧这个工作交给主worker创建其他worker处理部分很有用，不幸的是，到写作本书时为止，Chrome还不支持subworker，不过Firefox支持。</p><h5 id="终止Worker"><a href="#终止Worker" class="headerlink" title="终止Worker"></a><strong>终止Worker</strong></h5><blockquote><p>突然终止Worker线程不会给它任何机会完成它的工作或者清理任何资源。这就类似于通过关闭浏览器标签页来关闭页面。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w1.<span class="title function_">terminate</span>()</span><br></pre></td></tr></table></figure><p>如果浏览器中有两个或多个页面（或同一页上的多个tab!）试图从同一个文件URL创建Worker，那么最终得到的实际上是完全独立的Worker。后面我们会简单介绍如何共享Worker。</p><h5 id="Worker环境"><a href="#Worker环境" class="headerlink" title="Worker环境"></a><strong>Worker环境</strong></h5><blockquote><p>在Worker内部是无法访问主程序的任何资源的。这意味着你不能访问它的任何全局变量，也不能访问页面的DOM或者其他资源。这是一个完全独立的线程</p><p>但是，你可以执行<strong>网络操作（Ajax、WebSockets）以及设定定时器</strong>。还有，Worker可以访问几个重要的全局变量和功能的本地复本，包括<strong>navigator、location、JSON和applicationCache</strong>。</p></blockquote><p>可以通过importScripts(..)向Worker加载额外的JavaScript脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在Worker内部</span></span><br><span class="line"><span class="title function_">importScripts</span>( <span class="string">&quot;foo.js&quot;</span>, <span class="string">&quot;bar.js&quot;</span> );</span><br></pre></td></tr></table></figure><p>这些脚本加载是同步的。也就是说，importScripts(..)调用会阻塞余下Worker的执行，直到文件加载和执行完成。</p><p>Web Worker通常应用于哪些方面呢？</p><p>• 处理密集型数学计算</p><p>• 大数据集排序</p><p>• 数据处理（压缩、音频分析、图像处理等）</p><p>• 高流量网络通信</p><h5 id="数据传递"><a href="#数据传递" class="headerlink" title="数据传递"></a>数据传递</h5><blockquote><p>你可能已经注意到这些应用中的大多数有一个共性，就是需要在线程之间通过事件机制传递大量的信息，可能是双向的。</p></blockquote><p>早期 Worker中，唯一的选择就是把所有数据序列化到一个字符串值中。除了双向序列化导致的速度损失之外，另一个主要的负面因素是数据需要被复制，这意味着两倍的内存使用（及其引起的垃圾收集方面的波动）。</p><p><strong>结构化克隆算法</strong></p><blockquote><p>如果要传递一个对象，可以<strong>使用结构化克隆算法把这个对象复制到另一边</strong>。这个算法非常高级，甚至可以处理要复制的对象有循环引用的情况。</p></blockquote><p><strong>Transferable对象</strong></p><blockquote><p>对于大数据集而言，就是使用Transferable对象。这时发生的是<strong>对象所有权的转移</strong>，数据本身并没有移动。一旦你把对象传递到一个Worker中，在原来的位置上，它就变为空的或者是不可访问的，这样就消除了多线程编程作用域共享带来的混乱。当然，所有权传递是可以双向进行的。</p></blockquote><p>如果选择Transferable对象的话，其实不需要做什么。任何实现了Transferable接口（<a href="http://developer.mozilla.org/en-US/docs/Web/API/Transferable%EF%BC%89%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%B0%B1%E8%87%AA%E5%8A%A8%E6%8C%89%E7%85%A7%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%E4%BC%A0%E8%BE%93%EF%BC%88Firefox%E5%92%8CChrome%E9%83%BD%E6%94%AF%E6%8C%81%EF%BC%89%E3%80%82">http://developer.mozilla.org/en-US/docs/Web/API/Transferable）的数据结构就自动按照这种方式传输（Firefox和Chrome都支持）。</a></p><p>下面是如何使用postMessage(..)发送一个Transferable对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如foo是一个Uint8Array</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">postMessage</span>( foo.<span class="property">buffer</span>, [ foo.<span class="property">buffer</span> ] );</span><br></pre></td></tr></table></figure><p>不支持Transferable对象的浏览器就降级到结构化克隆，这会带来性能下降而不是彻底的功能失效。</p><h5 id="共享Worker"><a href="#共享Worker" class="headerlink" title="共享Worker"></a>共享Worker</h5><blockquote><p>如果你的站点或app允许加载同一个页面的多个tab（一个常见的功能），那你可能非常希望通过防止重复专用Worker来降低系统的资源使用。在这一方面最常见的有限资源就是socket网络连接，因为浏览器限制了到同一个主机的同时连接数目。当然，限制来自于同一客户端的连接数也减轻了你的资源压力。</p></blockquote><p>这称为SharedWorker，可通过下面的方式创建（只有Firefox和Chrome支持这一功能）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w1 = <span class="keyword">new</span> <span class="title class_">SharedWorker</span>( <span class="string">&quot;http://some.url.1/mycoolworker.js&quot;</span> );</span><br></pre></td></tr></table></figure><p>Worker需要通过某种方式来得知消息来自于哪个程序。这个唯一标识符称为端口（port），可以类比网络socket的端口。因此，调用程序必须使用Worker的port对象用于通信：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">w1.<span class="property">port</span>.<span class="title function_">addEventListener</span>( <span class="string">&quot;message&quot;</span>, handleMessages );</span><br><span class="line"></span><br><span class="line"><span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">w1.<span class="property">port</span>.<span class="title function_">postMessage</span>( <span class="string">&quot;something cool&quot;</span> );</span><br></pre></td></tr></table></figure><p>端口连接必须初始化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w1.<span class="property">port</span>.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure><p>在共享Worker内部，必须要处理额外的一个事件：”connect”。这个事件为这个特定的连接提供了端口对象。保持多个连接独立的最简单办法就是使用port上的闭包就像下面的代码一样，把这个链接上的事件侦听和传递定义在”connect”事件的处理函数内部：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在共享Worker内部</span></span><br><span class="line"><span class="title function_">addEventListener</span>( <span class="string">&quot;connect&quot;</span>, <span class="keyword">function</span>(<span class="params">evt</span>)&#123;</span><br><span class="line">  <span class="comment">// 这个连接分配的端口</span></span><br><span class="line">  <span class="keyword">var</span> port = evt.<span class="property">ports</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  port.<span class="title function_">addEventListener</span>( <span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(<span class="params">evt</span>)&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line">    port.<span class="title function_">postMessage</span>( .. );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">  &#125; );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化端口连接</span></span><br><span class="line">  port.<span class="title function_">start</span>();</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure><h5 id="模拟Web-Worker"><a href="#模拟Web-Worker" class="headerlink" title="模拟Web Worker"></a>模拟Web Worker</h5><blockquote><p>为了在缺乏对此支持的老浏览器中运行代码</p><p>因为Worker是一种API而不是语法，所以我们可以作为扩展来模拟它。如果浏览器不支持Worker，那么从性能的角度来说是没法模拟多线程的。通常认为Iframe提供了并行环境，但是在所有的现代浏览器中，它们实际上都是和主页面运行在同一个线程中的，所以并不足以模拟并发。</p></blockquote><p><a href="https://gist.github.com/getify/1b26accb1a09aa53ad25">模拟worker</a></p><h5 id="SIMD"><a href="#SIMD" class="headerlink" title="SIMD"></a>SIMD</h5><blockquote><p>单指令多数据（SIMD）是一种数据并行（data parallelism）方式，与Web Worker的任务并行（task parallelism）相对，因为这里的重点实际上不再是把程序逻辑分成并行的块，而是并行处理数据的多个位。</p><p>通过SIMD，线程不再提供并行。取而代之的是，现代CPU通过数字“向量”（特定类型的数组），以及可以在所有这些数字上并行操作的指令，来提供SIMD功能。这是利用低级指令级并行的底层运算。</p></blockquote><h5 id="asm-js"><a href="#asm-js" class="headerlink" title="asm.js"></a>asm.js</h5><blockquote><p>asm.js（<a href="http://asmjs.org)这个标签是指javascript语言中可以高度优化的一个子集.通过小心避免某些难以优化的机制和模式(垃圾收集、类型强制转换,等等)/">http://asmjs.org）这个标签是指JavaScript语言中可以高度优化的一个子集。通过小心避免某些难以优化的机制和模式（垃圾收集、类型强制转换，等等）</a>, asm.js风格的代码可以被JavaScript引擎识别并进行特别激进的底层优化。</p></blockquote><h4 id="性能测试与调优"><a href="#性能测试与调优" class="headerlink" title="性能测试与调优"></a>性能测试与调优</h4><h5 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h5><blockquote><p>如果被问到如何测试某个运算的速度（执行时间），绝大多数JavaScript开发者都会从类似下面的代码开始：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> start = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>(); <span class="comment">// 或者Date.now()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 进行一些操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> end = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Duration:&quot;</span>, (end - start) );</span><br></pre></td></tr></table></figure><p>这个方案有很多错误。不管报告的时长是多少，你能知道的唯一一点就是，这个运算的这次特定的运行消耗了大概这么长时间。而它是不是总是以这样的速度运行，你基本上一无所知。你不知道引擎或系统在这个时候有没有受到什么影响，以及其他时候这个运算会不会运行得更快。</p><h5 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h5><blockquote><p>“好吧，”你现在会说，“那就用一个循环把它包起来，这样整个测试的运行时间就会更长一些了。”如果重复一个运算100次，然后整个循环报告共消耗了137ms，那你就可以把它除以100，得到每次运算的平均用时为1.37ms，是这样吗？</p></blockquote><p>并不完全是这样。</p><p>简单的数学平均值绝对不足以对你要外推到整个应用范围的性能作出判断。迭代100次，即使只有几个（过高或过低的）的异常值也可以影响整个平均值，然后在重复应用这个结论的时候，你还会扩散这个误差，产生更大的欺骗性。</p><p>你也可以不以固定次数执行运算，转而循环运行测试，直到达到某个固定的时间。这可能会更可靠一些，但如何确定要执行多长时间呢？你可能会猜测，执行时间应该是你的运算执行的单次时长的若干倍。错。</p><p>实际上，重复执行的时间长度应该根据使用的定时器的精度而定，专门用来最小化不精确性。定时器的精度越低，你需要运行的时间就越长，这样才能确保错误率最小化。15ms的定时器对于精确的性能测试来说是非常差劲的。要最小化它的不确定性（也就是出错率）到小于1%，需要把你的每轮测试迭代运行750ms。而1ms定时器时只需要每轮运行50ms就可以达到同样的置信度。</p><h5 id="Benchmark-js"><a href="#Benchmark-js" class="headerlink" title="Benchmark.js"></a>Benchmark.js</h5><blockquote><p>幸运的是，像John-David Dalton和Mathias Bynens这样的聪明人了解这些概念，并编写了一个统计学上有效的性能测试工具，名为Benchmark.js（<a href="http://benchmarkjs.com/%EF%BC%89%E3%80%82%E5%9B%A0%E6%AD%A4%EF%BC%8C%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%B8%AA%E6%82%AC%E8%80%8C%E6%9C%AA%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E6%88%91%E7%9A%84%E7%AD%94%E6%A1%88%E5%B0%B1%E6%98%AF%EF%BC%9A%E2%80%9C%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E5%B7%A5%E5%85%B7%E5%B0%B1%E5%A5%BD%E4%BA%86%E3%80%82%E2%80%9D">http://benchmarkjs.com/）。因此，对于这个悬而未决的问题，我的答案就是：“使用这个工具就好了。”</a></p></blockquote><p>使用Benchmark.js来运行一个快速的性能测试：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 要测试的运算</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bench = <span class="keyword">new</span> <span class="title class_">Benchmark</span>(</span><br><span class="line">  <span class="string">&quot;foo test&quot;</span>,             <span class="comment">// 测试名称</span></span><br><span class="line">    foo,                    <span class="comment">// 要测试的函数（也即内容）</span></span><br><span class="line">                &#123;</span><br><span class="line">        <span class="comment">// ..             // 可选的额外选项（参见文档）</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">bench.<span class="property">hz</span>;                <span class="comment">// 每秒运算数</span></span><br><span class="line">bench.<span class="property">stats</span>.<span class="property">moe</span>;         <span class="comment">// 出错边界</span></span><br><span class="line">bench.<span class="property">stats</span>.<span class="property">variance</span>;    <span class="comment">// 样本方差</span></span><br><span class="line"><span class="comment">// ..</span></span><br></pre></td></tr></table></figure><h5 id="环境为王"><a href="#环境为王" class="headerlink" title="环境为王"></a>环境为王</h5><blockquote><p>对特定的性能测试来说，不要忘了检查测试环境，特别是比较任务Ⅹ和Y这样的比对测试。仅仅因为你的测试显示Ⅹ比Y快，并不能说明结论Ⅹ比Y快就有实际的意义。</p></blockquote><h5 id="引擎优化"><a href="#引擎优化" class="headerlink" title="引擎优化"></a>引擎优化</h5><blockquote><p>你无法可靠地推断，如果在你的独立测试中Ⅹ比Y要快上10μs，就意味着Ⅹ总是比Y要快，就应该总是使用Ⅹ。性能并不是这样发挥效力的。它要比这复杂得多。</p></blockquote><h5 id="jsPerf-com"><a href="#jsPerf-com" class="headerlink" title="jsPerf.com"></a>jsPerf.com</h5><blockquote><p>尽管在所有的JavaScript运行环境下，Benchmark.js都可用于测试代码的性能，但有一点一定要强调，如果你想要得到可靠的测试结论的话，就需要在很多不同的环境（桌面浏览器、移动设备，等等）中测试汇集测试结果。</p></blockquote><p>有一个很棒的网站正是因这样的需求而诞生的，名为jsPerf（<a href="http://jsperf.com).它使用我们前面介绍的benchmark.js库来运行统计上精确可靠的测试,并把测试结果放在一个公开可得的url上,你可以把这个url转发给别人./">http://jsperf.com）。它使用我们前面介绍的Benchmark.js库来运行统计上精确可靠的测试，并把测试结果放在一个公开可得的URL上，你可以把这个URL转发给别人。</a></p><p>每次测试运行的时候，测试结果就会被收集并持久化，累积的测试结果会被图形化，并展示到一个页面上以供查看。</p><h5 id="尾调用优化"><a href="#尾调用优化" class="headerlink" title="尾调用优化"></a>尾调用优化</h5><blockquote><p>简单地说，尾调用就是一个出现在另一个函数“结尾”处的函数调用。这个调用结束后就没有其余事情要做了（除了可能要返回结果值）。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">foo</span>( y + <span class="number">1</span> );     <span class="comment">// 尾调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> + <span class="title function_">bar</span>( <span class="number">40</span> );    <span class="comment">// 非尾调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">baz</span>();                       <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>不详细谈那么多本质细节的话，调用一个新的函数需要额外的一块预留内存来管理调用栈，称为栈帧。所以前面的代码一般会同时需要为每个baz()、bar(..)和foo(..)保留一个栈帧。</p><p>然而，如果支持TCO的引擎能够意识到foo(y+1)调用位于尾部，这意味着bar(..)基本上已经完成了，那么在调用foo(..)时，它就不需要创建一个新的栈帧，而是可以重用已有的bar(..)的栈帧。这样不仅速度更快，也更节省内存。</p><p>在简单的代码片段中，这类优化算不了什么，但是在处理递归时，这就解决了大问题，特别是如果递归可能会导致成百上千个栈帧的时候。有了TCO，引擎可以用同一个栈帧执行所有这类调用！</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;LHS与RHS&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;LHS和RHS的含义是“赋值操作的左侧或右侧”并不一定意味着就是“=赋值操作符的左侧或右侧”。赋值操作还有其他几种形式，因此在概念上最好将其理解为“赋值操作的目标是谁（LHS）”以及“谁是赋值操作的源头（RHS）”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;foo&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;a&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; b = a;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a + b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; c = &lt;span class=&quot;title function_&quot;&gt;foo&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;1．找到其中所有的LHS查询。（这里有3处！）&lt;/p&gt;
&lt;p&gt;2．找到其中所有的RHS查询。（这里有4处！）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ReferenceError&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果RHS查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出ReferenceError异常.&lt;/p&gt;
&lt;p&gt;相较之下，当引擎执行LHS查询时，如果在顶层（全局作用域）中也无法找到目标变量，全局作用域中就会创建一个具有该名称的变量，并将其返还给引擎，前提是程序运行在非“严格模式”下。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;TypeError&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或不合理的。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="js" scheme="https://wyf195075595.github.io/categories/js/"/>
    
    
    <category term="js" scheme="https://wyf195075595.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>性能优化篇</title>
    <link href="https://wyf195075595.github.io/2022/11/11/programming/javascript/others/"/>
    <id>https://wyf195075595.github.io/2022/11/11/programming/javascript/others/</id>
    <published>2022-11-11T00:23:10.000Z</published>
    <updated>2022-11-11T03:31:01.220Z</updated>
    
    <content type="html"><![CDATA[<h3 id="缓存你的-CORS"><a href="#缓存你的-CORS" class="headerlink" title="缓存你的 CORS"></a>缓存你的 CORS</h3><blockquote><p>在您的浏览器发出任何跨源请求（例如 example.com 到 api.example.com）之前，如果它不是一个<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests">简单的请求</a>，那么浏览器首先发送一个预检请求，并在发送真正的请求之前等待成功的响应。</p><p>这个预检请求是对服务器的一个 OPTIONS 请求，描述了浏览器要发送的请求，并首先请求权限。</p><p>实际上，几乎所有跨域 API 请求都需要这些预检请求，特别是包括：</p><ul><li>任何带有 JSON 或 XML 正文的请求</li><li>任何请求，包括凭据</li><li>任何不是 GET、POST 或 HEAD 的请求</li><li>流式传输请求或响应正文的任何交换</li><li><code>Accept</code>使用除、<code>Accept-Language</code>和以外的任何<code>Content-Language</code>标题<code>Content-Type</code></li></ul></blockquote><p>要在浏览器中缓存 CORS 响应，只需将此标头添加到您的预检响应中：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Max-Age: 86400</span><br></pre></td></tr></table></figure><p>要在浏览器和 API 服务器之间的 CDN 和其他代理中缓存 CORS 响应，请添加：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: public, max-age=86400</span><br><span class="line">Vary: origin</span><br></pre></td></tr></table></figure><p>在nodejs中缓存 CORS</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>(&#123;</span><br><span class="line">    <span class="comment">// Set the browser cache time for preflight responses</span></span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">86400</span>,</span><br><span class="line">    <span class="attr">preflightContinue</span>: <span class="literal">true</span> <span class="comment">// Allow us to manually add to preflights</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add cache-control to preflight responses in a separate middleware:</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=86400&#x27;</span>);</span><br><span class="line">        <span class="comment">// No Vary required: cors sets it already set automatically</span></span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>使用 Java Spring 缓存 CORS</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddPreflightCacheControlWebFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (CorsUtils.isPreFlightRequest(exchange.getRequest())) &#123;</span><br><span class="line">            exchange.getResponse()</span><br><span class="line">                .getHeaders()</span><br><span class="line">                .add(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;public, max-age=86400&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://httptoolkit.com/blog/cache-your-cors/">参考文章</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;缓存你的-CORS&quot;&gt;&lt;a href=&quot;#缓存你的-CORS&quot; class=&quot;headerlink&quot; title=&quot;缓存你的 CORS&quot;&gt;&lt;/a&gt;缓存你的 CORS&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在您的浏览器发出任何跨源请求（例如 example.com</summary>
      
    
    
    
    
    <category term="性能优化" scheme="https://wyf195075595.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>CSS 3.0</title>
    <link href="https://wyf195075595.github.io/2022/10/26/programming/htmlcss/css3/"/>
    <id>https://wyf195075595.github.io/2022/10/26/programming/htmlcss/css3/</id>
    <published>2022-10-26T10:00:00.000Z</published>
    <updated>2022-12-23T03:06:48.567Z</updated>
    
    <content type="html"><![CDATA[<p><strong>CSS世界已经有了CSS2和CSS3，那会有CSS4吗？</strong></p><p>答案是：不会有CSS4！</p><blockquote><p>实际上，现在连CSS3这个词都已经名存实亡了，因为CSS3已经解体了。为什么说CSS3解体了呢？因为CSS按照大版本的方式进行迭代实在是太低效了。低效的原因其实很好理解，如果CSS这门语言必须按照大版本迭代发布的话，只要其中一个版本有一个CSS特性存在极大的争议，那这个版本的CSS的发布时间就会延后。例如，CSS2.1的规范在2002年开始制定，而一直到2011年才成为推荐规范，整个过程足足花费了10年的时间，就是因为一些次要的CSS特性拖了后腿。</p><p>为了加速没有争议的CSS特性的标准化，W3C的CSS工作组做出了一项被称为“Beijing doctrine”的决定，该决定将CSS划分为更小的组件，并把这些组件称为模块。这些模块互相独立，各自按照自己的速度走向标准化。例如，CSS选择器模块已经到了Level 4了，弹性布局模块还是Level 1。</p><p>将CSS划分为独立的模块是一个非常明智的决定，浏览器厂商可以根据对自己需求的判断决定究竟对哪些模块进行支持，哪怕这个模块还处于草案状态。例如CSS的env()函数的规范还是草案状态，但是Chrome和Safari浏览器的厂商却快速响应，对其进行了支持。对开发者而言，如此迅速地支持新特性犹如一场及时雨。</p><p>当然，这种模块化的设计也不是没有弊端，最大的问题就是设计冗余。例如，弹性布局和网格布局中的对齐属性其实可以统一，但它们却是分离的，这就会徒增学习成本；分栏布局、弹性布局和网格布局中的间隙其实可以统一，但它们也都是分离的，各有各的间隙属性。好在纠正及时，现在这三大布局全部开始改用gap属性表示间隙，减少了因为模块化带来的设计冗余。</p><p>模块化策略带来的好处远远大于弊端，正所谓瑕不掩瑜，与带来的好处相比，模块化设计的弊端几乎可以忽略不计。从这个角度看，CSS2.1之后的CSS世界就是模块化的新世界，所以我称之为CSS新世界。这个CSS新世界带来了新的CSS属性，并让很多CSS2中模糊的概念有了明确的定义，如尺寸体系、逻辑属性、CSS值类型划分等。CSS新世界中各模块虽然发展独立，但是相互间还是有很多共性和联系的。因此，CSS新世界不仅是一个模块化的世界，还是一个缤纷多彩，同时又自成一体的严谨的世界。</p></blockquote><span id="more"></span><h2 id="互通互联的CSS数据类型"><a href="#互通互联的CSS数据类型" class="headerlink" title="互通互联的CSS数据类型"></a>互通互联的CSS数据类型</h2><blockquote><p>任何CSS属性值一定包含一个或多个数据类型。</p><p>在CSS2时代，CSS数据类型的概念并不怎么重要，因为常用的CSS属性翻来覆去就那几个，这些CSS属性支持的属性值我们反复使用就记住了。但是在CSS新世界中，由于各个CSS模块独立发展，没有统一的大版本进行约束，因此CSS的发展和变化非常快，这导致短时间内大量的CSS新属性如雨后春笋般涌现。</p><p>如果此时还和过去一样，只是凭借经验去学习CSS新特性，那么学习起来肯定是十分困难的，因为效率比较低下。此时CSS数据类型的价值就体现出来了，当CSS新属性出现的时候，我们无须记忆数量众多的属性值名称，只需要记住支持的数据类型即可，这样学习成本就大大降低了</p></blockquote><p>举一个例子，background-image是使用频率非常高的一个CSS属性，这个CSS属性的语法结构是下面这样的：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-image</span>: none | &lt;image&gt;</span><br></pre></td></tr></table></figure><p>这个语法中出现的&lt;image&gt;就是一种数据类型，它包括下面这些类型和函数：</p><p>● &lt;url&gt;；</p><p>● &lt;gradient&gt;；</p><p>● element()；</p><p>● image()；</p><p>● image-set()；</p><p>● cross-fade()</p><p>● paint()</p><p>也就是说，CSS的background-image属性不仅支持url()函数和渐变图像，还支持element()、image()、image-set()和cross-fade()等函数。</p><h3 id="几个常见数据类型的简单介绍"><a href="#几个常见数据类型的简单介绍" class="headerlink" title="几个常见数据类型的简单介绍"></a>几个常见数据类型的简单介绍</h3><blockquote><p>CSS数据类型非常多，保守估计，至少有50个，这里介绍几个常见且值得一提的数据类型。</p></blockquote><p>CSS Shapes布局中有一个名为shape-outside的属性，我们不用关心这个CSS属性的含义，只看这个CSS属性的语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">shape-outside</span>: none | &lt;shape-box&gt; || &lt;basic-shape&gt; | &lt;image&gt;</span><br></pre></td></tr></table></figure><ol><li><p>&lt;shape-box&gt; 支持属性如下：</p><ul><li><p>&lt;box&gt;</p><p>  ● content-box；</p><p>  ● padding-box；</p><p>  ● border-box。</p></li><li><p>margin-box</p></li></ul></li><li><p>&lt;basic-shape&gt; 支持属性如下：</p><ul><li>inset()</li><li>circle()</li><li>ellipse()</li><li>polygon()</li><li>path()</li></ul></li><li><p>&lt;image&gt;</p></li><li><p>&lt;cololr&gt;</p><ul><li>&lt;rgb()&gt;；</li><li>&lt;rgba()&gt;；</li><li>&lt;hsl()&gt;；</li><li>&lt;hsla()&gt;；</li><li>&lt;hex-color&gt;；</li><li>&lt;named-color&gt;；</li><li>currentColor；</li><li>&lt;deprecated-system-color&gt; 废弃的系统的颜色</li></ul></li></ol><p><a href="https://www.zhangxinxu.com/wordpress/2019/11/css-value-type/">css值类型文档大全</a></p><h3 id="学会看懂CSS属性值定义语法"><a href="#学会看懂CSS属性值定义语法" class="headerlink" title="学会看懂CSS属性值定义语法"></a>学会看懂CSS属性值定义语法</h3><blockquote><p>CSS属性值有专门的定义语法，用来表示CSS属性值的合法组成。例如，线性渐变的语法为：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linear-gradient(<span class="selector-attr">[ &lt;angle&gt; | to &lt;side-or-corner&gt; , ]</span>? &lt;<span class="attribute">color</span>-stop-list&gt;)</span><br></pre></td></tr></table></figure><h4 id="学习CSS属性值定义语法的好处"><a href="#学习CSS属性值定义语法的好处" class="headerlink" title="学习CSS属性值定义语法的好处"></a>学习CSS属性值定义语法的好处</h4><blockquote><p>在开始介绍具体的语法规则之前，我想先说说我们为什么要学会看懂CSS属性值定义语法（CSS value definition syntax）。就拿线性渐变的语法举例，根据我的观察，几乎无一例外，CSS开发者会写出类似下面这样的CSS线性渐变代码：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to bottom, deepskyblue, deeppink)</span><br></pre></td></tr></table></figure><p>上面这句声明有问题吗？从功能上讲没问题，但是写法上却有瑕疵， “to bottom” 这几个字符是多余的，可直接写为</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(deepskyblue, deeppink)</span><br></pre></td></tr></table></figure><blockquote><p>如果你看得懂CSS的语法，那么在学习CSS的时候，只要稍微看一看线性渐变的语法，就能很轻松地知道“线性渐变的方向设置是可以省略的”这样一个细节知识，也就能写出更简洁的CSS代码。</p></blockquote><h4 id="CSS属性值定义语法详解"><a href="#CSS属性值定义语法详解" class="headerlink" title="CSS属性值定义语法详解"></a>CSS属性值定义语法详解</h4><blockquote><p>CSS属性值定义语法是专门用来限定CSS属性合法取值的语法，这种语法包含以下3种基本组成元素：</p><ul><li>关键字</li><li>数据类型</li><li>符号</li></ul></blockquote><p>线性渐变语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linear-gradient(<span class="selector-attr">[&lt;angle&gt; | to &lt;side-or-corner&gt;, ]</span>? &lt;<span class="attribute">color</span>-stop-list&gt;)</span><br></pre></td></tr></table></figure><p>上面语法中， to 为关键字， &lt;angle&gt;,&lt;side-or-corner&gt;,&lt;color-stop-list&gt;是数据类型，[] | ? 为符号</p><ol><li><p>关键字</p><p> 关键字分为通用关键字和全局关键字：</p><p> ● auto、none、ease等关键字是通用关键字，或者可以称为普通关键字，这些关键字均只被部分CSS属性支持；</p><p> ● inherit、initial、unset和revert是全局关键字，属于被所有CSS属性支持的特殊关键字</p></li><li><p>数据类型</p><p> 数据类型外面有一对尖括号（“&lt;”和“&gt;”）。有些数据类型是CSS规范中专门定义的，它们被称为基本类型，其他数据类型就被称为其他类型。</p></li><li><p>符号</p><p> 符号是CSS语法中的重点和难点。CSS语法中的符号分为字面符号、组合符号和数量符号这3类</p><ul><li><p>字面符号指的是CSS属性值中原本就支持的合法符号，这些符号在CSS语法中会按照其原本的字面意义呈现。目前字面符号就两个，一个是逗号（,），另一个是斜杠（/）</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221021095011386.png" alt="image-20221021095011386"></p></li><li><p>组合符号用来表示数个基本元素之间的组合关系。目前共有5个组合符号，其中大多数组合符号的含义一目了然，除了“|”这个组合符号。因为“|”表示互斥，这在编程语言中比较少见，大家可以特别关注一下。</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221021095120238.png" alt="image-20221021095120238"></p></li><li><p>数量符号用来描述一个元素可以出现多少次，数量符号不能叠加出现，并且优先级高于组合符号。目前共有6个数量符号，大多数的数量符号的含义和在正则表达式中的含义是一样的</p><p>  <img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221021095233527.png" alt="image-20221021095233527"></p></li></ul></li></ol><blockquote><p>接下来只要弄清楚&lt;angle&gt;、&lt;side-or-corner&gt;和&lt;color-stop-list&gt;这几个数据类型的含义和语法，我们就可以理解线性渐变的语法了。</p></blockquote><h4 id="了解CSS全局关键字"><a href="#了解CSS全局关键字" class="headerlink" title="了解CSS全局关键字"></a>了解CSS全局关键字</h4><blockquote><p>inherit、initial、unset和revert都是CSS全局关键字属性值，也就是说所有CSS属性都可以使用这几个关键字作为属性值。</p></blockquote><table><thead><tr><th align="center">关键字属性值</th><th align="center">实用性</th><th align="center">兼容性</th><th align="center">整体设计</th></tr></thead><tbody><tr><td align="center">inherit</td><td align="center">A</td><td align="center">A+</td><td align="center">A+</td></tr><tr><td align="center">initial</td><td align="center">B</td><td align="center">B+</td><td align="center">B</td></tr><tr><td align="center">unset</td><td align="center">B-</td><td align="center">B-</td><td align="center">B-</td></tr><tr><td align="center">revert</td><td align="center">B</td><td align="center">C</td><td align="center">B-</td></tr></tbody></table><p><strong>用过都说好的继承关键字inherit</strong></p><blockquote><p>inherit这个关键字是继承的意思。IE浏览器从IE8（标准版）开始就已经支持该关键字了，而不是从IE9浏览器开始支持的。请记住，不是从IE9开始支持的，网络上的某些在线文档是错误的。</p></blockquote><p><strong>可以一用的初始值关键字initial</strong></p><blockquote><p>initial是初始值关键字，可以把当前的CSS属性的计算值还原成<strong>CSS语法中规定的初始值</strong>。【<strong>不是浏览器内置的样式</strong>】</p></blockquote><p><a href="https://demo.cssworld.cn/new/2/3-1.php">示例</a></p><p><strong>很多人有这样一个误区：把 initial 关键字理解为浏览器设置的元素的初始值。实际上两者是不一样的。</strong></p><blockquote><p>举个例子，实际开发的时候，&lt;ul&gt;元素或 &lt;ol&gt;元素默认的list-style-type样式会被CSS重置。但是可能会遇到这样的场景，即某些区域需要增加一些描述信息，因此需要重新使用list-style-type样式（小圆点或者数字），此时有些开发者就会使用initial关键字对该样式进行还原：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: initial;</span><br><span class="line">    <span class="attribute">list-style-type</span>: initial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是没有用！应为上边等同如下设置</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">list-style-type</span>: disc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而不是预想的</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">list-style-type</span>: decimal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此时需要的全局关键字属性值其实是 revert，而不是initial。</p></blockquote><blockquote><p>兼容性</p><p>除IE浏览器之外，其他浏览器都很早就支持了initial，因此，至少在移动端项目（包括微信小程序）中大家可以百分之百放心使用这个关键字属性值。</p></blockquote><p><strong>了解一下不固定值关键字unset</strong></p><blockquote><p>unset是不固定值关键字，其特性如下：如果当前使用的CSS属性是具有继承特性的，如color属性，则等同于使用inherit关键字；如果当前使用的CSS属性是没有继承特性的，如background-color，则等同于使用initial关键字。</p><p>unset这个关键字只有配合all属性使用才有意义，因为对于某个具体的CSS属性，想要继承某个属性，那就使用inherit关键字；想要使用初始值，那就使用initial关键字，没有任何理由使用unset关键字。</p></blockquote><p>如某元素很多默认属性不是我们需要的，但是我们又不想一个属性接一个属性地进行重置，怎么办呢？此时就可以先使用all:unset进行批量重置，再设置我们需要的CSS属性：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dialog &#123;</span><br><span class="line">    <span class="attribute">all</span>: unset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><dialog>元素的样式重置是很难得的unset使用场景，由于支持<dialog>元素的浏览器一定支持unset，因此也不用担心兼容性的问题。</blockquote><p><strong>个人很喜欢的恢复关键字revert</strong></p><blockquote><p>revert 关键字可以让当前元素的样式还原成浏览器内置的样式。例如：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: revert;</span><br><span class="line">    <span class="attribute">list-style-type</span>: revert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>那么 &lt;ol&gt;中的每一个 &lt;li&gt;项都会有数字效果呈现，当然，前提是你没有对子元素 &lt;li&gt;的list-style-type属性做过样式重置。这里有必要插一句，请记住：没有任何理由对 &lt;li&gt;元素进行任何样式重置。因为所有浏览器的<li>元素默认都没有margin外间距，也没有padding内间距，list-style-type也是继承 &lt;ul&gt;或 &lt;ol&gt;元素，所以对 &lt;li&gt;元素进行任何样式重置，既浪费CSS代码，也不利于列表序号的样式设置。此刻，你就可以看看手中的项目中的代码有没有对 &lt;li&gt;元素做过样式重置，如果有，赶快删掉</p></blockquote><p><a href="https://demo.cssworld.cn/new/2/3-2.php">在支持 revert 样式的 浏览器中 设置恢复</a></p><ul><li><h5 id="HTML："><a href="#HTML：" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;revert-ol&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>inherit关键字实用<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>initial关键字可用<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>unset关键字配合all使用<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>revert关键字有用<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS："><a href="#CSS：" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.revert-ol</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@supports</span> (<span class="attribute">padding</span>: revert) &#123;</span><br><span class="line">    <span class="selector-class">.revert-ol</span> &#123;</span><br><span class="line">        <span class="attribute">padding</span>: revert;</span><br><span class="line">        <span class="attribute">list-style-type</span>: revert;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>指代所有CSS属性的all属性</strong></p><blockquote><p>all属性可以重置除unicode-bidi、direction以及CSS自定义属性以外的所有CSS属性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">all</span>: inherit;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>该段代码表示 &lt;input&gt;元素中所有CSS属性都使用inherit关键字作为属性值</p></blockquote><blockquote><p>all:inherit没有任何实用价值，all:initial也没有任何实用价值。有实用价值的是all:unset和all:revert。all:unset可以让任意一个元素样式表现和&lt;span&gt;元素一样。all:revert可以让元素恢复成浏览器默认的样式，也是很有用的。</p></blockquote><blockquote><p>为什么unicode-bidi和direction这两个CSS属性不受all属性影响?</p><p>我们不妨反问一下，如果unicode-bidi和direction这两个CSS属性会受到all属性影响，那会出现什么问题呢？阿拉伯文的呈现形式是从右往左的，但是，direction属性的初始值却是ltr，即从左往右。如果all属性可以影响direction属性，那么执行all:initial的时候，这些阿拉伯文的网页文字全部都会变成从左往右呈现。大家可以想象一下我们的中文网页上的中文内容全部从右往左显示是什么样的，我敢保证，使用阿拉伯文的前端开发者绝对不会使用这个all属性的，all属性在阿拉伯文中从此名存实亡。</p><p>于是答案就出来了，之所以direction属性不受all影响，是因为当年direction属性设计失误，将其初始值设为了ltr，而不是auto。现在为了照顾从右往左阅读的场景，direction属性就被设计成不受all属性影响。unicode-bidi属性是direction属性的“跟屁虫”，而且它的功能还挺强大的，可以精确控制每一个文字的呈现方向，只是离开了direction属性就没用。既然这两个CSS属性形影不离，那就把unicode-bidi属性加入不会受all属性影响的属性队列吧。</p></blockquote><h4 id="css-新特性的渐进式增强处理技巧"><a href="#css-新特性的渐进式增强处理技巧" class="headerlink" title="css 新特性的渐进式增强处理技巧"></a>css 新特性的渐进式增强处理技巧</h4><blockquote><p>有很多CSS新特性是对现有Web特性的体验升级，我们直接使用这些CSS新特性就好了，不要担心兼容性问题。因为在支持的浏览器中体验更好，在不支持的浏览器中也就是保持原来的样子而已。</p><p>做Web开发是没有必要让所有浏览器都显示得一模一样的，好的浏览器有更好的显示，糟糕的浏览器就只有普通的显示，这才是对用户更负责任的做法。</p></blockquote><blockquote><p>举个例子，IE10+浏览器支持CSS动画属性animation，我们要实现加载效果就可以使用一个很小的PNG图片，再借助旋转动画。这个方法的优点是资源占用少，动画效果细腻。于是，我们的需求来了，IE9及其以下版本浏览器还是使用传统的GIF动图作为背景，IE10+浏览器则使用PNG背景图外加animation属性实现加载效果。</p></blockquote><p>这个需求的难点在于我们该如何区分IE9和IE10浏览器。大家千万不要再去找什么CSS Hack了，我们可以利用属性值的语法差异实现渐进增强效果。例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-loading</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30px</span>; <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">../images/loading.gif</span>);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">../images/loading.png</span>), <span class="built_in">linear-gradient</span>(transparent, transparent);</span><br><span class="line">    <span class="attribute">animation</span>: spin <span class="number">1s</span> linear infinite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/2/5-2.php">background-blend-mode纹理背景渐进增强实现实例页面</a></p><p><strong>@supports规则下的渐进增强处理</strong></p><blockquote><p>@supports是CSS中的常见的@规则，可以用来检测当前浏览器是否支持某个CSS新特性，这是最规范、最正统的CSS渐进增强处理方法，尤其适合多个CSS属性需要同时处理的场景。</p><p>但是在实际开发的时候，@supports规则并没有在IE浏览器的兼容性问题上做出什么大的贡献。原因很简单，@supports规则的支持是从Edge12浏览器开始的，根本就没有IE浏览器什么事情。</p></blockquote><p><strong>@supports规则常用的语法</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-loading</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">30px</span>; <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./loading.gif</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*Edge12+浏览器*/</span></span><br><span class="line"><span class="keyword">@supports</span> (<span class="attribute">animation</span>: none) &#123;</span><br><span class="line">    <span class="selector-class">.icon-loading</span> &#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./loading.png</span>);</span><br><span class="line">        <span class="attribute">animation</span>: spin <span class="number">1s</span> linear infinite;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> spin &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>) &#125;;</span><br><span class="line">    <span class="selector-tag">to</span> &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>) &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@supports规则还支持使用操作符进行判断，这些操作符是<strong>not</strong>、<strong>and</strong>和<strong>or</strong>，分别表示“否定”“并且”“或者”。</p><p>甚至连续判断3个以上的CSS声明也没问题还支持嵌套语法</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span> (<span class="attribute">display</span>: flex) <span class="keyword">and</span> (<span class="attribute">display</span>: <span class="attribute">grid</span>) <span class="keyword">and</span> (<span class="attribute">gap</span>: <span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@supports</span> (<span class="attribute">display</span>: flex) <span class="keyword">and</span> (<span class="keyword">not</span> (<span class="attribute">display</span>: <span class="attribute">grid</span>)) &#123;&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/2/5-3.php">@supports嵌套语法测试实例页面</a></p><blockquote><p>@supports规则支持CSS自定义属性的检测和CSS选择器语法的检测。例如：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span> (<span class="attribute">--var</span>: blue) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@supports</span> selector(:default) &#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其中，CSS自定义属性的检测没有任何实用价值，本书不展开讲解；而CSS选择器语法的检测属于CSS Conditional Rules Module Level 4规范中的内容，目前浏览器尚未大规模支持，暂时没有实用价值，因此本书暂不讲解。</p></blockquote><p><strong>浏览器还提供了CSS.supports()接口，让我们可以在JavaScript代码中检测当前浏览器是否支持某个CSS特性，语法如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">CSS</span>.<span class="title function_">supports</span>(propertyName, value);</span><br><span class="line"><span class="variable constant_">CSS</span>.<span class="title function_">supports</span>(supportCondition);</span><br></pre></td></tr></table></figure><p><strong>@supports规则的花括号可以包含其他任意@规则，甚至是包含@supports规则自身</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span> (<span class="attribute">display</span>: flex) <span class="keyword">and</span> (<span class="keyword">not</span> (<span class="attribute">display</span>: <span class="attribute">grid</span>)) &#123;</span><br><span class="line">    <span class="keyword">@supports</span> (<span class="attribute">animation</span>: none) &#123;</span><br><span class="line">        <span class="selector-class">.icon-loading</span> &#123;</span><br><span class="line">            <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./loading.png</span>);</span><br><span class="line">            <span class="attribute">animation</span>: spin <span class="number">1s</span> linear infinite;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/2/5-4.php">@supports @规则嵌套测试实例页面</a></p><blockquote><p>我觉得大家在日常工作中，应该大胆使用CSS新特性，同时再多花一点额外的时间对这些新特性做一些兼容性方面的工作。这绝对是一件非常划算的事情，无论是对用户还是对自身的成长都非常有帮助。</p></blockquote><h2 id="从增强已有的CSS属性开始"><a href="#从增强已有的CSS属性开始" class="headerlink" title="从增强已有的CSS属性开始"></a>从增强已有的CSS属性开始</h2><h3 id="尺寸体系"><a href="#尺寸体系" class="headerlink" title="尺寸体系"></a>尺寸体系</h3><blockquote><p>尺寸体系，如果用一个金字塔来表示，那么在最上层的概念就是“Intrinsic Sizing”和“Extrinsic Sizing”。“Intrinsic Sizing”被称为“内在尺寸”，表示元素最终的尺寸表现是由内容决定的；“Extrinsic Sizing”被称为“外在尺寸”，表示元素最终的尺寸表现是由上下文决定的。</p></blockquote><h4 id="width-fit-content声明"><a href="#width-fit-content声明" class="headerlink" title="width:fit-content声明"></a>width:fit-content声明</h4><blockquote><p>fit-content关键字是新的尺寸体系关键字中使用频率最高的关键字。你可以把fit-content关键字的尺寸表现想象成“紧身裤”，大腿的肉对应的就是元素里面的内容，如果是宽松的裤子，那肉眼所见的尺寸就比较大，但是如果是紧身裤，则呈现的尺寸就是大腿实际的尺寸。</p><p>实际上，fit-content关键字的样式表现就是CSS2.1规范中的“shrink-to-fit”，我称其为“包裹性”。这种尺寸表现和元素应用display:inline-block、position:absolute等CSS声明类似，尺寸收缩但不会超出包含块级元素的尺寸限制。</p></blockquote><p><a href="https://demo.cssworld.cn/new/3/1-1.php">文字居中和左对齐自动布局实例页面</a></p><blockquote><p>如果是内联元素要收缩，可以使用display:inline-block声明；如果是块级元素要收缩，可以使用display:table声明。这两种方式效果一样，兼容性还更好，IE8+浏览器都提供了支持。这么一看，fit-content关键字岂不是没什么用？</p></blockquote><p><strong>使用fit-content关键字有两大优点。</strong></p><ul><li>保护了元素原始的display计算值，例如&lt;li&gt;元素要是设置成了display:table，前面的项目符号就不会出现，::marker伪元素也会失效。</li><li>让元素的尺寸有了确定的值，这是fit-content关键字最重要也最可贵的优点。</li></ul><p><strong>让元素的尺寸有了确定的值这点展开一下</strong></p><p>CSS中有不少布局需要有明确的元素的尺寸才能实现，非常典型的例子就是绝对定位元素使用margin:auto实现居中效果时需要设置具体的width或height的属性值，CSS代码示意如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cw-dialog</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;<span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">    <span class="attribute">border</span>: solid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是很多时候绝对定位元素的尺寸不是固定的，最终尺寸会根据内容自动变化，此时以上CSS就不适合了。有人想到了 translate 偏移 50%。这个方法不错，但是并不完美，而且这个地方占据了 transform 属性，这会导致绝对定位元素无法使用包含transform属性的动画效果。 此时如果使用 <strong>fit-content</strong> 关键字 。就不用担心包括transform属性的动画带来的冲突。 </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cw-dialog</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: fit-content;</span><br><span class="line">    <span class="attribute">height</span>: fit-content;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    ledt: <span class="number">0</span>; <span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">border</span>: solid;</span><br><span class="line">    <span class="attribute">animation</span>: tinUp .<span class="number">2s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/1-2.php">效果展示</a></p><h4 id="stretch、available和fill-available关键字究竟用哪个"><a href="#stretch、available和fill-available关键字究竟用哪个" class="headerlink" title="stretch、available和fill-available关键字究竟用哪个?"></a>stretch、available和fill-available关键字究竟用哪个?</h4><blockquote><p>我们在页面中放置一个没有样式设置的&lt;div&gt;元素，此时，该&lt;div&gt;元素的宽度自动填满可用空间。</p><p>stretch、available和fill-available这3个关键字虽然名称有所不同，但是作用都是一致的，那就是让元素的尺寸自动填满可用空间，就如同&lt;div&gt;元素的默认尺寸表现。</p><p>下面问题来了，究竟该使用stretch、available和fill-available这3个关键字中的哪一个呢？先简单分析一下这3个关键字。</p></blockquote><p>● stretch指“弹性拉伸”，是最新的规范中定义的关键字，替换之前的fill-available和available。</p><p>● available指“可用空间”，是Firefox浏览器使用的关键字，需要配合-moz-私有前缀使用。</p><p>● fill-available指“填充可用空间”，是webkit浏览器使用的关键字，需要配合-webkit-私有前缀使用。</p><blockquote><p>实际开发的时候，我们需要用到stretch关键字的场景并不多。首先，block水平的元素、弹性布局和网格布局中的子项默认都自带弹性拉伸特性；其次，对于替换元素、表格元素、内联块级元素等这些具有“包裹性”的元素，建议使用“宽度分离原则”</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/1-3.php">stretch关键字与button按钮的margin自适应实例页面</a></p><h4 id="min-content关键字"><a href="#min-content关键字" class="headerlink" title="min-content关键字"></a>min-content关键字</h4><blockquote><p>min-content关键字实际上就是CSS2.1规范中提到的“preferred minimum width”或者“minimum content width”，即“首选最小宽度”或者“最小内容宽度”。</p><p>元素由content-box、padding-box、border-box和margin-box组成，元素最终占据的尺寸由这4个盒子占据的尺寸决定。其中padding-box、border-box和margin-box的尺寸表现规则不会因为元素的不同而有所不同，但是content-box不一样，它随着内容的不同，首选最小宽度也会不同。这个有必要好好讲一讲。</p></blockquote><ol><li><p>替换元素</p><p> 按钮、视频和图片等元素属于替换元素，替换元素的首选最小宽度是当前元素内容自身的宽度</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./1.jpg&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 上面这段HTML代码中的图片，如果原始尺寸是256px×192px，则<section>元素的首选最小宽度就是256px。</p></li><li><p>CJK文字</p><p> CJK是Chinese/Japanese/Korean的缩写，指的是中文、日文、韩文这几种文字。这里以中文为代表加以说明。如果是一段没有标点的中文文字，则首选最小宽度是单个汉字的宽度。</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p &#123;</span><br><span class="line">width: min-content;</span><br><span class="line">outline: 1px dotted;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    感谢您的支持</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>非CJK文字</p><blockquote><p>非CJK文字指的是除中文、日文、韩文之外的文字，如英文、数字和标点等字符。非CJK文字的首选最小宽度是由字符单元的宽度决定的，所有连续的英文字母、数字和标点都被认为是一个字符单元，直到遇到中断字符。</p></blockquote><p> 哪些字符可以中断字符单元呢？</p><p> 1、Space空格（U+0020）无论是哪个浏览器，都能中断字符单元，并且忽略Space空格前后字符的类型</p><p> 2、短横线（U+002D），在webkit浏览器中可以中断字符单元</p><p> 3、在Firefox浏览器中，英文问号（U+003F）不能中断字符单元，而短横线（U+002D）可以，不过后面的字符必须是字母而不能是数字</p><p> 4、在IE浏览器和Edge浏览器中，英文问号（U+003F）不能中断字符单元，而短横线（U+002D）可以，但是要求短横线前后是由字母、数字或短横线组成的字符单元，且这个字符单元的长度要大于1</p></li><li><p>最终的首选最小宽度</p><p> <a href="https://demo.cssworld.cn/new/3/1-5.php">一个元素最终的首选最小宽度是所有内部子元素中最大的那个首选最小宽度值</a></p></li></ol><h4 id="max-content关键字"><a href="#max-content关键字" class="headerlink" title="max-content关键字"></a>max-content关键字</h4><blockquote><p>max-content关键字表示最大内容宽度，max-content关键字的作用是让元素尽可能大，保证图文内容在一行显示，哪怕最终的宽度溢出外部容器元素</p></blockquote><p><a href="https://demo.cssworld.cn/new/3/1-6.php">示例</a></p><blockquote><p>对CSS新的尺寸体系做一个总结。带content这个单词的3个关键字fit-content、min-content和max-content都是“内在尺寸”（intrinsic sizing），尺寸表现和内容相关；stretch关键字（也包括available关键字和fill-available关键字）是“外在尺寸”（extrinsic sizing），尺寸表现和上下文有关。这4个关键字一起撑起了CSS世界的尺寸体系。</p></blockquote><h3 id="深入了解CSS逻辑属性"><a href="#深入了解CSS逻辑属性" class="headerlink" title="深入了解CSS逻辑属性"></a>深入了解CSS逻辑属性</h3><blockquote><p>整个CSS世界就是围绕“流”来构建的（详见《CSS世界》一书的第6页，1.3.2节）。在CSS2.1时代，CSS属性的定位都是基于方向的，而不是“流”。这样的设计其实是有问题的，基于方向进行定位虽然符合现实世界认知，但和CSS世界基于“流”的底层设计理念不符，这样就会产生不合理的问题。</p></blockquote><p>两个水平按钮要给它们设置间距，margin-right: 10px;但是当 文档流方向发生变化时即 direction:rtl; 时，在右侧会出现空隙，此时应该是设置成margin-left: 10px;的效果。.</p><p>如果我们一开始设置的不是符合现实世界认知的margin-right属性，而是符合CSS世界“流”概念的逻辑属性margin-inline-end，代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">margin-inline-end</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/2-1.php">效果对比</a></p><p><strong>CSS逻辑属性有限的使用场景</strong></p><blockquote><p>CSS逻辑属性需要配合writing-mode属性、direction属性或者text-orientation属性使用才有意义。</p><p>CSS中还有其他一些CSS属性值也可以改变DOM元素的呈现方向，例如flex-direction属性中的属性值row-reverse和column-reverse，但是请注意，这些属性值和CSS逻辑属性之间[没有任何关系](<a href="https://demo/">https://demo</a>. cssworld.cn/new/3/2-2.php)</p><p><a href="https://demo.cssworld.cn/new/3/2-3.php">模拟微信聊天界面</a></p></blockquote><p>[inline/block与start/end元素](<a href="https://demo.cssworld.cn/">https://demo.cssworld.cn/</a> new/3/2-4.php)</p><p><strong>width/height属性与inline-size/block-size逻辑属性</strong></p><h3 id="在CSS边框上做文章"><a href="#在CSS边框上做文章" class="headerlink" title="在CSS边框上做文章"></a>在CSS边框上做文章</h3><blockquote><p>一个图形元素的装饰部件主要是边框和背景。在CSS2.1时代，边框只能是纯色的，效果太单调了。于是CSS规范制定者就开始琢磨，是不是可以在CSS边框上做文章，通过支持图片显示来增强边框的表现力呢？</p></blockquote><h4 id="独一无二的border-image属性"><a href="#独一无二的border-image属性" class="headerlink" title="独一无二的border-image属性"></a>独一无二的border-image属性</h4><blockquote><p>所有与装饰有关的CSS属性都能从其他设计软件中找到对应的功能，如背景、描边、阴影，甚至滤镜和混合模式，但是唯独border-image属性是CSS这门语言独有的，就算其他软件有边框装饰，也不是border-image这种表现机制。这看起来是件好事情，你瞧，border-image多么与众不同！但实际上，border-image属性很少出现在项目代码中，其中重要的原因之一就是border-image属性过于特殊。</p></blockquote><p>（1）对开发者而言，border-image属性怪异的渲染机制，导致学习成本较高，掌握border-image属性的人并不多。而且很多时候该属性对源图像的规格和比例也有要求，这导致使用成本也比较高。</p><p>（2）对设计师而言，border-image属性的视觉表现和现实认知是不一致的，而设计师的视觉设计多基于现实认知，因此，设计师无法为border-image属性量身定制图形表现。另外，当下的设计趋势是扁平化而非拟物化，边框装饰通常在项目中不会出现。</p><p>（3）border-image属性怪异的渲染机制导致元素的4个边角成了4个尴尬的地方，实现的边框效果往往不符合预期，最终导致开发者放弃使用border-image属性。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-image</span>: <span class="built_in">url</span>(<span class="string">./q.svg</span>) <span class="number">54</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">border-image-source</span>: <span class="built_in">url</span>(<span class="string">./q.svg</span>);</span><br><span class="line"><span class="attribute">border-image-slice</span>: <span class="number">54</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>border-image-slice属性的正式语法如下，表示支持1～4个数值或1～4个百分比值，后面可以带一个关键字fill</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-image-slice</span>: &lt;number-percentage&gt;&#123;<span class="number">1</span>,<span class="number">4</span>&#125; &amp;&amp; fill?</span><br></pre></td></tr></table></figure><blockquote><p>border-image-slice属性的作用是对原始的图像进行划分，划分的方位和顺序同margin属性、padding属性一样，遵循上、右、下、左的顺序。例如border-image-slice:20表示在距离源图像上方20px、距离源图像右侧20px、距离源图像下方20px、距离源图像左侧20px的地方进行划分</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221024155122282.png" alt="image-20221024155122282"></p><blockquote><p>此时4个边角区域只有很小的一部分被划分，而剩余的上、下、左、右区域会被拉伸，因此，作用在.example元素上的效果就会如图3-22所示，其中增加的几根辅助线可以方便大家理解。</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221024155150672.png" alt="image-20221024155150672"></p><p><a href="https://demo.cssworld.cn/new/3/3-1.php">示例</a></p><blockquote><p>理解了border-image-slice属性，border-image属性的学习就算完成了一半，剩下的就是学会控制九宫格的尺寸了，而控制九宫格尺寸的CSS属性就是border-image-width和border-image-outset。</p></blockquote><p><a href="https://demo.cssworld.cn/new/3/3-2.php">border-image-width</a></p><p><a href="https://demo.cssworld.cn/new/3/3-3.php">border-image-outset</a></p><p><a href="https://demo.cssworld.cn/new/3/3-4.php">border-image-repeat</a></p><blockquote><p>order-image-slice属性用于划分源图像，border-image-width用于控制九宫格第一区到第八区的尺寸，border-image-outset属性用于控制九宫格最中间第九区的尺寸。掌握这3个属性，就算完全理解border-image属性了。</p></blockquote><p>border-image属性的正式语法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-image</span>: &lt;<span class="string">&#x27;border-image-source&#x27;</span>&gt; || &lt;<span class="string">&#x27;border-image-slice&#x27;</span>&gt; [/&lt;border-image-width&gt;| /&lt;<span class="string">&#x27;border-image-width&#x27;</span>&gt;? /&lt;<span class="string">&#x27;border-image-outset&#x27;</span>&gt;]? || &lt;<span class="string">&#x27;border-image-repeat&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/3-5.php">示例</a></p><p><a href="https://demo.cssworld.cn/new/3/3-6.php">border-image实现效果示意</a></p><p><a href="https://demo.cssworld.cn/new/3/3-7.php">红色条纹渐变边框</a></p><p><a href="https://demo.cssworld.cn/new/3/3-8.php">圆角渐变边框</a></p><blockquote><p>CSS中共有 3 个属性可以实现对布局没有任何影响的轮廓扩展，分别是outline轮廓、box-shadow盒阴影和border-image边框图片</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221024161943783.png" alt="image-20221024161943783"></p><p>● 如果需要轮廓带有渐变效果，一定是使用border-image属性。</p><p>● 如果需要轮廓效果是纯色，且4个角为直角，则优先使用outline属性；如果outline属性不能使用（如无障碍访问需要），则使用box-shadow属性；如果box-shadow属性已经有了其他样式，则使用border-image属性。</p><p>● 如果需要轮廓有圆角效果，则一定是使用box-shadow属性。</p><p>● 如果需要轮廓和元素之间还有一段间隙，则优先使用outline属性；如果outline属性不能使用，则使用border-image属性。</p><p>● 如果需要轮廓只有一个方向，则不考虑outline属性。</p><p>● 如果需要兼容IE浏览器，则border-image属性不考虑。</p><h3 id="position-属性增强"><a href="#position-属性增强" class="headerlink" title="position 属性增强"></a>position 属性增强</h3><blockquote><p>全新的position属性值——sticky，单词“sticky”的中文意思是“黏性的”，position:sticky就是黏性定位。为了让接下来的描述更精准，我们不妨在这里先约定：黏性定位就是指元素应用了position:sticky声明；相对定位就是指元素应用了position:relative声明；绝对定位就是指元素应用了position:absolute声明；固定定位就是指元素应用了position:fixed声明。</p></blockquote><blockquote><p>sticky属性值刚出来的时候，在圈子里是引发过一阵小热度的。但是，在2014年至2016年这长达3年的时间里，Chrome浏览器放弃了对它的支持，后来这个新特性就淡出了大众的视野。不知道出于什么原因，2017年之后，Chrome浏览器又重新开始支持黏性定位了。目前所有主流浏览器都已经支持黏性定位。</p></blockquote><blockquote><p>过去，黏性定位效果一定是通过JavaScript代码实现的。这个效果常用在导航元素上，具体表现为：当导航元素在屏幕内的时候，导航元素滚动跟随；当导航元素就要滚出屏幕的时候，导航元素固定定位。</p><p>sticky属性值的设计初衷就是把原来JavaScript才能实现的黏性效果改由CSS实现。下面来看一个例子。</p></blockquote><p><a href="https://demo.cssworld.cn/new/3/4-1.php">效果预览</a></p><p><strong>黏性定位效果底层的渲染规则和固定定位没有任何关系，而是相对定位的延伸。先说说黏性定位和相对定位相似的地方。</strong></p><p>（1）元素发生偏移的时候，元素的原始位置是保留的。</p><p>（2）创建了新的绝对定位包含块，也就是黏性定位元素里面如果有绝对定位的子元素，那这个子元素设置left属性、top属性、right属性和bottom属性时的偏移计算是相对于当前黏性定位元素的。</p><p>（3）支持设置z-index属性值来改变元素的层叠顺序。</p><p><strong>再说说黏性定位和相对定位不一样的地方。</strong></p><p>（1）偏移计算元素不一样。相对定位偏移计算的容器是父元素，而黏性定位偏移计算的元素是层级最近的可滚动元素（overflow属性值不是visible的元素）。如果一个可滚动元素都没有，则相对浏览器视窗进行位置偏移。</p><p>（2）偏移定位计算规则不一样。黏性定位的计算规则比较复杂，涉及多个黏性定位专有的概念。</p><p>（3）重叠表现不一样。相对定位元素彼此独立，重叠的时候表现为堆叠；但是黏性定位元素在特定布局结构下，元素重叠的时候并不是表现为堆叠，而是会有A黏性定位元素推开B黏性定位元素的视觉表现。</p><p><strong>注意的三个点</strong></p><ol><li><p>可滚动元素对黏性定位的影响</p><blockquote><p>通常的Web页面都是窗体滚动的，而黏性定位偏移计算的元素是层级最近的那个滚动元素。因此，如果黏性定位元素的某个祖先元素的overflow属性值不是visible，那么窗体滚动的时候就不会有黏性定位效果，</p></blockquote> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">div &#123;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">nav &#123;</span><br><span class="line">    position: sticky;</span><br><span class="line">    top: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span>&gt;</span><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 此时滚动页面，&lt;nav&gt;元素是没有黏性效果的。注意，这不是bug，也不是sticky属性值没有渲染，而是因为此时&lt;nav&gt;元素黏性定位的偏移计算是相对于父级&lt;div&gt;元素计算的，黏性效果也只有在&lt;div&gt;元素滚动的时候才能够体现。</p><p> 如果希望出现滚动，可以这样调整一下</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    display: block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">800px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果你的网页使用的是窗体滚动，又希望有黏性效果，那务必保证黏性定位元素的祖先元素中没有可滚动元素。</p></blockquote></li><li><p>深入理解黏性定位的计算规则</p><blockquote><p>如果黏性定位元素的父元素的高度和黏性定位元素的高度相同，则垂直滚动的时候，黏性定位效果是不会出现的。要讲清楚这个问题，就必须深入理解黏性定位的计算规则。</p></blockquote><p> 黏性定位中有一个“流盒”（flow box）的概念，指的是黏性定位元素最近的可滚动元素的尺寸盒子，如果没有可滚动元素，则表示浏览器视窗盒子。黏性定位中还有一个名为“黏性约束矩形”的概念，指的是黏性定位元素的包含块（通常是父元素）在文档流中呈现的矩形区域和流盒的4个边缘在应用黏性定位元素的left、top、right和bottom属性的偏移计算值后的新矩形的交集。由于滚动的时候流盒不变，而黏性定位元素的包含块跟着滚动，因此黏性约束矩形随着滚动的进行是实时变化的。假设我们的黏性定位元素只设置了top属性值，则黏性定位元素碰到黏性约束矩形的顶部时就开始向下移动，直到它完全被包含在黏性约束矩形中。<a href="https://demo.cssworld.cn/new/3/4-2.php">效果查看</a></p><p> 明白了黏性定位的计算规则，也就明白了为什么黏性定位元素的父元素和自身高度计算值一样的时候没有黏性效果。因为此时包含块高度和黏性定位元素的高度相同，这导致黏性约束矩形的最大高度和黏性定位元素的高度相同，黏性定位元素已经完全没有了实现黏性效果的空间。</p></li><li><p>理解黏性定位的堆叠规则</p><blockquote><p>黏性定位元素的偏移由容器决定，如果多个黏性定位元素在同一容器中，则这几个黏性定位元素会产生元素重叠的情况；如果黏性定位元素分布在不同的容器中，同时这些容器在布局上是上下紧密相连的，则视觉上会表现为新的黏性定位元素挤开原来的黏性定位元素，形成依次占位的效果。</p></blockquote><p> <a href="https://demo.cssworld.cn/new/3/4-3.php">效果查看</a></p><blockquote><p>黏性定位元素在<strong>同一个容器下会重叠</strong>，而在<strong>不同容器下则会依次推开</strong>，这和上面等高父元素没有黏性效果的原因一样，都是黏性定位计算规则下的样式表现。</p></blockquote><blockquote><p>Safari浏览器中使用黏性定位需要添加-webkit-私有前缀。IE浏览器可以使用Polyfill进行支持，可以兼容到IE9+版本。同时设置top属性、bottom属性的时候，上下两个方位的黏性效果会同时生效。水平方向的left属性、right属性也是类似的，不过由于水平滚动场景不常见，因此，left属性、right属性并不常用。</p></blockquote><p> <a href="https://demo.cssworld.cn/new/3/4-4.php">层次滚动效果</a></p><blockquote></blockquote></li></ol><h3 id="font-family属性和-font-face规则新特性"><a href="#font-family属性和-font-face规则新特性" class="headerlink" title="font-family属性和@font-face规则新特性"></a>font-family属性和@font-face规则新特性</h3><blockquote><p>本节主要介绍与字体相关的一些新特性，包括font-family属性的功能加强，以及@font-face自定义字体。</p></blockquote><p>全新的通用字体族包括以下几种。</p><p>● system-ui：系统UI字体。</p><p>● emoji：适用于emoji字符的字体家族。</p><p>● math：适用于数学表达式的字体家族。</p><p>● fangsong：中文字体中的仿宋字体家族。</p><h4 id="system-ui"><a href="#system-ui" class="headerlink" title="system-ui"></a>system-ui</h4><blockquote><p>在过去，如果想要使用系统字体，只能使用font:menu、font:status-bar等CSS声明。但是，menu、status-bar、small-caption等font关键字属性值是包含字号的，不同操作系统中的字号会不一样，因此我们还需要通过设置font-size属性值重置字号大小，比较麻烦。system-ui字体族的出现很好地解决了使用系统字体的需求。</p></blockquote><p><strong>为啥要使用系统字体？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">font</span>-familly: system-ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不同字体在不同系统下显示有差异，效果可能不如系统字体，还有可能发生网页设置的通用字体与系统字体冲突的问题</p><h4 id="emoji"><a href="#emoji" class="headerlink" title="emoji"></a>emoji</h4><blockquote><p>前主流的操作系统都已经内置emoji字体，如macOS、iOS、Android操作系统和Windows 10操作系统等。然而，虽然主流的操作系统内置了emoji字体，但是有些emoji字符并不会显示为彩色的图形，需要专门指定emoji字体</p></blockquote><p><strong>emoji字体设置应该放在系统字体设置后面</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.emoji</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>● Apple Color Emoji用在Apple的产品中的，如iPhone（iOS）或者Mac Pro（macOS）等。</p><p>● Segoe UI Emoji是用在Windows操作系统中的emoji字体。</p><p>● Segoe UI Symbol是在Windows 7操作系统中添加的一种新字体，是一种Unicode编码字体，显示的是单色图案，非彩色图形。</p><p>● Noto Color Emoji是谷歌的emoji字体，用在Android和Linux操作系统中。</p><p><strong>以上4种字体涵盖了所有主流的操作系统。可以专门定义一个新的emoji字体来优化代码</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Emoji;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;Apple Color Emoji&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Segoe UI Emoji&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Segoe UI Symbol&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Noto Color Emoji&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.emoji</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Emoji;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/5-1.php">Emoji字体设置后的作用实例页面</a></p><p><a href="https://demo.cssworld.cn/new/3/5-2.php">Emoji字体设置放在最后的效果实例页面</a></p><p><a href="https://demo.cssworld.cn/new/3/5-3.php">Emoji字体unicode-range范围限定效果实例页面</a></p><h4 id="math通用字体族"><a href="#math通用字体族" class="headerlink" title="math通用字体族"></a>math通用字体族</h4><blockquote><p>math通用字体族的作用是方便在Web中展现数学公式。数学公式包含非常多的层次关系，需要特殊的字体进行支持</p></blockquote><p>有一种名为MathML的XML语言专门用来呈现富有层级关系的数学公式（对MathML的详细介绍见<a href="https://www.zhangxinxu.com/wordpress/?p=8108%EF%BC%89">https://www.zhangxinxu.com/wordpress/?p=8108）</a></p><p>理论上在开发的时候，我们只要使用MathML语言进行数学公式书写就好了，无须关心背后的字体。但是，在实际操作中，Chrome浏览器并不支持MathML。为了兼容Chrome浏览器，我们需要对数学标签进行CSS重定义，此时就需要用到math通用字体族：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">math &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Cambria Math, Latin Modern Math;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，Cambria Math是Windows操作系统中的数学字体，Latin Modern Math是macOS中的数学字体。</p><h4 id="fangsong通用字体族"><a href="#fangsong通用字体族" class="headerlink" title="fangsong通用字体族"></a>fangsong通用字体族</h4><blockquote><p>个字体族来自中文字体“仿宋”，仿宋是介于宋体（衬线字体）和楷体（手写字体）之间的一种字体。和宋体相比，仿宋笔画的水平线通常是倾斜的，端点修饰较少，笔画宽度变化较小。一般非常正式的公告才会用到这个字体，平常开发项目中很少用到</p></blockquote><h4 id="local-函数与系统字体的调用"><a href="#local-函数与系统字体的调用" class="headerlink" title="local()函数与系统字体的调用"></a>local()函数与系统字体的调用</h4><blockquote><p>从IE9浏览器开始，@font-face规则开始支持使用local()函数调用系统安装的字体。使用local()函数主要有两大好处。</p></blockquote><p>（1）简化字体调用。例如我们要使用等宽字体，但是不同操作系统中的等宽字体不一样。为了兼容，我们需要一长串不同的字体名称作为font-family属性值，但是根本就记不住这么多字体，没关系，有了local()函数，使用这些字体的方法就一下子变得简单了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Mono;</span><br><span class="line">    <span class="comment">/*每个单词可不加引号*/</span>、</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;Menlo&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Monaco&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Consolas&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Liberation Mono&#x27;</span>),</span><br><span class="line">        ...;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">code</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Mono;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（2）在自定义字体场景下提高性能。例如我们希望在各个平台都能使用Roboto字体，则可以像下面这样重新定义下Roboto字体</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Roboto;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&quot;Roboto&quot;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&quot;Roboto-Regular&quot;</span>),</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">&quot;./Roboto.woff2&quot;</span>) <span class="built_in">format</span>(<span class="string">&quot;woff2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时local()函数可以让已经安装了Roboto字体的用户无须发起额外的Roboto字体请求，优化了这部分用户的使用体验。</p><h4 id="unicode-range属性"><a href="#unicode-range属性" class="headerlink" title="unicode-range属性"></a>unicode-range属性</h4><blockquote><p>我们在使用@font-face规则自定义字体的时候，还可以通过使用unicode-range属性来决定自定义的字体作用在哪些字符上。例如设置emoji字体的作用范围</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Emoji;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;Apple Color Emoji&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Segoe UI Emoji&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Segoe UI Symbol&#x27;</span>),</span><br><span class="line">        <span class="built_in">local</span>(<span class="string">&#x27;Noto Color Emoji&#x27;</span>);</span><br><span class="line">    unicode-range: U+<span class="number">1</span>F000-<span class="number">1</span>F644,U+<span class="number">203</span>C-<span class="number">3299</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在前端领域，使用Unicode编码显示字符在各种语言中都是可以的，不过前缀各有不同。</p><p>（1）在HTML中，字符输出可以使用&amp;#x加上Unicode编码。</p><p>（2）在JavaScript文件中，为了避免中文乱码需要转义，应使用\u加上Unicode编码。</p><p>（3）在CSS文件中，如CSS伪元素的content属性，就直接使用\加上对应字符的Unicode编码值。</p><p>（4）unicode-range属性则是使用U+加上Unicode编码。</p><p><strong>unicode-range属性常用的Unicode编码值对中文用户而言，最常用的Unicode编码值有下面这些。</strong></p><p>● 基本二次汉字：[0x4e00,0x9fa5]（或十进制[19968,40869]）。</p><p>● 数字：[0x30,0x39]（或十进制[48, 57]）。</p><p>● 小写字母：[0x61,0x7a]（或十进制[97, 122]）。</p><p>● 大写字母：[0x41,0x5a]（或十进制[65, 90]）。</p><p>如果想获取某一个具体字符的Unicode编码值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U = <span class="string">&#x27;℃&#x27;</span>.<span class="title function_">codePointAt</span>().<span class="title function_">toString</span>(<span class="number">16</span>) <span class="comment">// 2103</span></span><br></pre></td></tr></table></figure><h4 id="woff-woff2字体"><a href="#woff-woff2字体" class="headerlink" title="woff/woff2字体"></a><strong>woff/woff2字体</strong></h4><blockquote><p>为了方便在网页中高效使用自定义字体，woff和woff2应运而生，它们是两个专门用在Web中的字体。其中，woff字体在2012年12月被World Wide Web Consortium（W3C）推荐使用，IE9+浏览器支持该字体。woff2字体最早在2013年7月的Chrome Canary版本上就可以使用了，发展到现在，几乎已经成为自定义图标字体使用的标准配置，目前浏览器对它的兼容性已经相当不错了。</p><p>woff2字体没有必要再开启GZIP，因为这个字体文本本身就是压缩过的。</p><p>最后说一下woff字体的MIME type值。关于这一点有点小争议，拿woff2字体举例，Google使用的是font/woff2，而W3C则推荐使用application/font-woff2。我个人的建议是，在Web中使用的时候采用font/woff2，在服务器端进行MIME type配置的时候采用application/font- woff2。</p></blockquote><h4 id="font-display"><a href="#font-display" class="headerlink" title="font-display"></a>font-display</h4><blockquote><p>假设我们定义一个名为MyFont的自定义字体，并且采用url()函数外链的方式引入..这时浏览器的字体加载行为表现为，应用MyFont字体的文本会先被隐藏，直到字体加载结束才会显示，但是这个隐藏最多持续3s，3s后字体仍未加载结束则会使用其他字体代替。这种加载体验利弊参半。</p></blockquote><blockquote><p><strong>字体显示时间线</strong></p><p>字体显示时间线开始于浏览器尝试下载字体的那一刻，整个时间线分为3个时段，浏览器会在这3个时段让元素表现出不同的字体渲染行为。</p><p>● 字体阻塞时段：如果未加载字体，任何试图使用它的元素都必须以不可见的方式渲染后备字体；如果在此期间字体成功加载，则正常使用它。</p><p>● 字体交换时段：如果未加载字体，任何试图使用它的元素都必须以可见的方式渲染后备字体；如果在此期间字体成功加载，则正常使用它。</p><p>● 字体失败时段：如果未加载字体，则浏览器将其视为加载失败，并使用正常字体进行回退渲染。font-display的属性值就是围绕字体显示时间线展开的。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-display</span>: [auto | block | swap | fallback | optional]</span><br></pre></td></tr></table></figure><p>● auto：字体显示策略由浏览器决定，大多数浏览器的字体显示策略类似block。</p><p>● block：字体阻塞时段较短（推荐3s），字体交换时段无限。此值适合图标字体场景。</p><p>● swap：字体阻塞时段极短（不超过100ms），字体交换时段无限。此值适合用在小段文本，同时文本内容对页面非常重要的场景。</p><p>● fallback：字体阻塞时段极短（不超过100ms），字体交换时段较短（推荐3s）。此值适合用于大段文本，例如文章正文，同时对字体效果比较看重的场景，例如广告页面、个人网站等。</p><p>● optional：字体阻塞时段极短（不超过100ms），没有字体交换时段。此值的作用可以描述为，如果字体可以瞬间被加载（例如已经被缓存了），则浏览器使用该字体，否则使用回退字体。optional是日常Web产品开发更推荐的属性值，因为无论任何时候，网页内容在用户第一次访问时快速呈现是最重要的，不能让用户等待很长时间后再看到你认为的完美效果。</p><blockquote><p>如果自定义字体的大小在30 KB以内，建议直接用Base64将其内联在页面中。不过只有woff2字体采取内联处理，woff字体依旧采用url()函数外链体验最佳，因为此时现代浏览器中的字体都是瞬间渲染，根本无须使用font-display属性进行字体加载优化</p></blockquote><h3 id="字符单元的中断与换行"><a href="#字符单元的中断与换行" class="headerlink" title="字符单元的中断与换行"></a>字符单元的中断与换行</h3><p>字符单元默认的中断与换行规则如下。</p><p>● Space普通空格、Enter（回车）空格和Tab（制表符）空格这3种空格无论怎样组合都会合并为单个普通空格。</p><p>● 文字可以在CJK文本、普通空格和短横线连字符处换行，连续英文单词和数字不换行。</p><p>word-break</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">word-break</span>: normal | break-all | keep-all | break-word;</span><br></pre></td></tr></table></figure><p>keep-all这个属性值可以让CJK文本不换行排版，同时又不影响非CJK文本的排版行为<a href="https://demo.cssworld.cn/new/3/6-1.php">效果预览</a></p><p><a href="https://demo.cssworld.cn/new/3/6-2.php">word-break 属性效果</a></p><p>hyphens属性与连字符</p><blockquote><p>hyphens是专为英文场景设计的一个属性，这个属性可以让英文单词断开换行的时候带上连字符（也就是短横线），这样可以让读者知道上一行的尾部和下一行的头部连起来是一个完整的单词</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hyphens</span>: none| manual|auto;</span><br></pre></td></tr></table></figure><blockquote><p>属性值auto可以让英文单词在行尾自动换行，同时带上短横线。需要注意的是，英文单词换行不需要设置word-break或者word-wrap属性，hyphens属性自带换行能力。如果你设置了word-break:break-all声明，反而不会有短横线效果。</p></blockquote><blockquote><p>连字符总共分两种。</p><p>一种是“硬连字符”（U+2010），称为可见的换行机会。这个字符就是我们键盘上的短横线“-”，是可见的。</p><p>另一种是“软连字符”（U+00AD），称为不可见的换行机会。这个字符很有意思，通常情况是隐藏的，但是，如果浏览器觉得有必要在软连字符所在位置打断单词，则连字符又会变为可见。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>大家好，我叫zhang<span class="symbol">&amp;shy;</span>xin<span class="symbol">&amp;shy;</span>xu，感谢大家购买我的书。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/6-3.php">hyphens:manual与软连字符优化排版效果实例页面</a></p><blockquote><p>不过由于在<strong>Chrome浏览器中不支持hyphens:none这个声明</strong>，因此其没有实用价值。</p></blockquote><h4 id="lt-wbr-gt-与精确换行的控制"><a href="#lt-wbr-gt-与精确换行的控制" class="headerlink" title="&lt;wbr&gt;与精确换行的控制"></a>&lt;wbr&gt;与精确换行的控制</h4><blockquote><p>HTML中有一个&lt;wbr&gt;元素标签，可以实现连续英文和数字的精准换行，具体效果如下：如果宽度足够，不换行；如果宽度不足，则在&lt;wbr&gt;元素所在的位置进行换行。也就是说，&lt;wbr&gt;元素提供了一个换行机会。</p></blockquote><p>[&lt;wbr&gt;标签与排版效果优化实例页面](<a href="https://demo.cssworld.cn/new/3/6-4">https://demo.cssworld.cn/new/3/6-4</a>. php)</p><p><strong>&lt;wbr&gt;实现换行原理</strong></p><blockquote><p>&lt;wbr&gt;之所以能够创造新的换行机会，是因为其创建了一个带有换行特性的宽度为0px的空格。该空格的Unicode编码是U+200B，因此&lt;wbr&gt;标签也可以替换为&#x200b;，例如下面HTML代码实现的效果和标签的效果是一样的</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>大家好，我叫zhang<span class="symbol">&amp;#x200B;</span>xin<span class="symbol">&amp;#x200B;</span>xu，感谢大家购买我的书。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>大家好，我叫zhang<span class="tag">&lt;<span class="name">wbr</span>&gt;</span>xin<span class="tag">&lt;<span class="name">wbr</span>&gt;</span>xu，感谢大家购买我的书。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>IE不兼容处理</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wbr<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line"><span class="attribute">content</span>: <span class="string">&#x27;\00200B&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&lt;wbr&gt;与&lt;br&gt;换行的区别</strong></p><blockquote><p>&lt;wbr&gt;是“Word Break Opportunity”的缩写，表示有机会就断开换行；而&lt;br&gt;则是直接换行显示，无论宽度是否足够。</p></blockquote><blockquote><p>● 动态文本内容换行使用word-break:break-all和word-wrap:break-word组合代码，如果要彻底换行，还可以使用line-break:anywhere。</p><p>● 静态内容排版不建议使用word-break属性、word-wrap属性或者line-break属性，如果是英文单词，则使用&shy;软连字符优化排版；如果是非英文单词，则使用&lt;wbr&gt;标签优化排版。</p></blockquote><h4 id="overflow-wrap-anywhere声明有什么用"><a href="#overflow-wrap-anywhere声明有什么用" class="headerlink" title="overflow-wrap:anywhere声明有什么用"></a>overflow-wrap:anywhere声明有什么用</h4><blockquote><p>这里主要讲一下属性值anywhere的作用。在展开讲解之前，先给大家讲解一个概念，关于“硬换行”和“软换行”。硬换行会在文本的换行点处插入实际换行符；而软换行的文本实际上仍在同一行，但看起来它被分成了多行，例如通过word-break:break-all让长英文单词换行就属于软换行。</p><p>属性值anywhere正常状态下的效果和属性值break-word类似，具体描述为：如果行中没有其他可接受的断点，则可以在任何点断开原本不可断开的字符串（如长单词或URL），并且在断点处不插入连字符。</p><p>属性值anywhere和属性值break-word的不同之处在于，overflow-wrap:anywhere在计算最小内容尺寸的时候会考虑软换行，而overflow-wrap:break-word则不会考虑软换行</p></blockquote><p>overflow-wrap属性的正式语法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow-wrap</span>: normal | break-word | anywhere;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/6-5.php">overflow-wrap:anywhere和break-word的区别实例页面</a></p><blockquote><p>由于overflow-wrap:anywhere的兼容性不佳，因此它目前的实用性远不及line- break:anywhere，大家了解即可。</p></blockquote><h4 id="text-align属性相关的新特性"><a href="#text-align属性相关的新特性" class="headerlink" title="text-align属性相关的新特性"></a>text-align属性相关的新特性</h4><blockquote><p>text-align属性支持常用的属性值left、right、center、justify，也支持逻辑属性值start、end，除此之外，还新增了多个其他属性值。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">text-align</span>: match-parent| justify-all| &lt;string&gt;;</span><br></pre></td></tr></table></figure><blockquote><p>不过这几个新增的属性值的兼容性都不太好，因此不适合在生产环境中使用，大家先简单了解一下即可。</p></blockquote><p>match-parent</p><blockquote><p>match-parent视觉表现类似inherit，由于text-align属性本身就具有继承性，因此，match-parent不是用来改变视觉上的对齐效果的，而是用来改变“看不见”的对齐计算值。</p></blockquote><p>justify-all属性</p><blockquote><p>它和justify属性值的区别在于justify-all属性值可以让最后一行也表现为两端对齐。可惜目前还没有浏览器支持justify-all属性值</p></blockquote><p><strong>CSS Text Module Level 4规范中，text-align属性还新增了对字符属性值的支持。</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">td</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: <span class="string">&#x27;.&#x27;</span> center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;40&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>长途电话费<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥1.30<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥2.50<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥10.80<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥111.02<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥85<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>￥.30<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时，单元格的数值会按照字符“.”进行对齐</p><h4 id="text-decoration属性全新升级"><a href="#text-decoration属性全新升级" class="headerlink" title="text-decoration属性全新升级"></a>text-decoration属性全新升级</h4><blockquote><p>text-decoration属性则是一个CSS缩写属性，完整的CSS属性包括text-decoration-line、text-decoration- style、text-decoration-color和text-decoration-thickness。</p></blockquote><ul><li><p>text-decoration-line</p><p>  表示装饰线的类型。支持多个值一起使用</p><ol><li>none 没有装饰线</li><li>underline 下划线</li><li>overline 上划线</li><li>line-through 贯穿线</li></ol></li><li><p>text-decoration-style</p><p>  表示装饰线的样式风格，</p><ol><li>solid    实线</li><li>double 双实线</li><li>dotted 点线</li><li>dashed 虚线</li><li>wavy 波浪线</li></ol></li><li><p>text-decoration-color：表示装饰线的颜色。</p></li><li><p>text-decoration-thickness：表示装饰线的粗细</p></li></ul><p>正式语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">text-decoration</span>: &lt;text-decoration-line&gt; || &lt;text-decoration-style&gt; || &lt;text-decoration-color&gt; || &lt;text-decoration-thinckness&gt;</span><br></pre></td></tr></table></figure><p>意思就是，4个子属性值位置随机、组合随机</p><p><a href="https://demo.cssworld.cn/new/3/8-1.php">text-decoration 属性叠加</a></p><p><a href="https://demo.cssworld.cn/new/3/8-2.php">宽度100%自适应的波浪线效果实现实例页面</a></p><p><strong>text-underline-position:under声明</strong></p><p>text-underline-position属性可以用来设置下划线的位置。</p><p><a href="https://demo.cssworld.cn/new/3/8-3.php">text-underline-position属性实例页面</a></p><blockquote><p>text-underline-position属性除了支持under，还支持left、right和from-font这几个CSS规范定义的属性值。</p><p>● left和right这两个属性值平常根本用不到，只有在使用writing-mode属性让文字垂直排版，并且需要控制下划线左右位置的时候才会用到。</p><p>● from-font是CSS文本装饰规范Level 4新增的属性值，表示优先使用字体文件中设置的下划线位置，如果字体没有设置下划线对齐信息，就使用auto效果。大家目前可以无视from-font这个属性值，因为就算不考虑其目前糟糕的兼容性，这个属性值也是非常不实用的，限制太多了。</p><p>总而言之，如果使用了文字的下划线效果，你可能需要text-underline-position: under来优化下划线的显示位置。</p></blockquote><p><strong>text-underline-offset属性</strong></p><blockquote><p>text-underline-position属性虽然可以调整下划线的位置，但是调整的位置都是固定的，不能满足多变的开发需求。此时，你更需要text-underline-offset属性。</p></blockquote><p><a href="https://demo.cssworld.cn/new/3/8-4.php">text-underline-offset属性实例页面</a></p><blockquote><p>百分比值表示偏移量相对于1em的大小。因此，text-underline-offset: 100%等同于text-underline-offset:1em。text-underline-offset支持负值，此时下划线就会向上偏移。text-underline-offset属性只对下划线类型的装饰线有效，对删除线和上划线都无效</p></blockquote><p><strong>text-decoration-skip属性</strong></p><blockquote><p>text-decoration-skip属性可以用来控制装饰线和文字之间的重叠关系，这里的装饰线专指下划线。因为一些英文字符（如“g”“q”）的“小尾巴”会和下划线重叠，所以需要使用text -decoration-skip属性设置装饰线是跳过文字，还是和文字连在一起。虽然删除线（text-decoration:line-through）也会和文字重叠，但是它并不是text-decoration- skip属性的目标装饰线，因为删除线必须贯穿文字。</p></blockquote><h3 id="color属性与颜色设置"><a href="#color属性与颜色设置" class="headerlink" title="color属性与颜色设置"></a>color属性与颜色设置</h3><p>148<strong>个颜色关键字</strong></p><blockquote><p><a href="https://demo.cssworld.cn/new/3/9-1.php">查看</a></p></blockquote><p>（1）HTML中color属性算法和CSS中的color属性算法是不一样的。同样是一个无法识别的颜色关键字，在HTML中这个无法识别的颜色关键字会渲染成另外一个颜色，而在CSS中会直接忽略这个颜色关键字。具体案例参见《CSS世界》一书的9.1.1节。</p><p>（2）颜色关键字设置的颜色都是实色，不带透明度。目前没有CSS语法可以直接让颜色关键字带有透明度，唯一可行的方式是借助animation-delay负值实现。</p><p>（3）颜色关键字不区分大小写。例如下面语法也是可以正常解析的</p><p>（4）有一些颜色关键字是互相等同的</p><p>（5）所有颜色关键字中，只有两个颜色关键字是以“deep”开头的，分别是深天蓝色deepskyblue和深粉色deeppink，这是我最喜爱的两个颜色关键字。</p><p>（6）暗灰色darkgray的颜色要比灰色gray更浅，因此，并不是有“dark”前缀的颜色关键字控制的颜色就更深。</p><p>（7）在148个颜色关键字中，只有CSS Color Level 4新增的颜色关键字rebeccapurple不是规范的颜色名词，有人或许会奇怪为什么会有这样“不规范”的命名，实际上，这个命名的背后有一段你不知道的温情故事</p><h4 id="transparent关键字"><a href="#transparent关键字" class="headerlink" title="transparent关键字"></a><strong>transparent关键字</strong></h4><blockquote><p>透明色</p></blockquote><h4 id="currentColor关键字"><a href="#currentColor关键字" class="headerlink" title="currentColor关键字"></a><strong>currentColor关键字</strong></h4><blockquote><p>currentColor关键字非常实用，且无可替代，它表示当前元素（或伪元素）所使用的color属性的计算值，currentColor关键字从IE9浏览器开始被支持。比较常用的全局设置是：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">fill: currentColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>需要注意的是，CSS中很多属性的默认颜色就是color属性值，没有必要专门指定currentColor关键字，包括border-color、outline-color、caret-color、text-shadow、box-shadow等CSS属性</p></blockquote><h4 id="RGB颜色和HSL颜色的新语法"><a href="#RGB颜色和HSL颜色的新语法" class="headerlink" title="RGB颜色和HSL颜色的新语法"></a><strong>RGB颜色和HSL颜色的新语法</strong></h4><p><strong>HSL颜色</strong></p><blockquote><p>HSL颜色是由色调（Hue）、饱和度（Saturation）和亮度（Lightness）这3个元素组成的。HSL就是由这3个元素对应的英文单词的首字母组成的。色调值的大小是任意的，因为CSS世界中与色调相关的数值都是角度值，其单位是deg，所以无论设置什么值，最终都会在0～360deg这个范围中解析，例如−120deg=240deg、480deg=120deg。</p></blockquote><p><strong>RGBA颜色</strong></p><blockquote><p>从IE9浏览器开始，支持设置颜色的透明度了，RGBA和HSLA中的字母A指的就是Alpha透明通道，透明度取值范围任意，但是渲染范围是0～1，也就是小于0的透明度会当作0渲染，大于1的透明度会当作1渲染</p></blockquote><p><strong>#RRGGBBAA颜色</strong></p><blockquote><p>目前现代浏览器已经全面支持#RRGGBBAA颜色。其中R、G、B还是原来的十六进制表示的RGB色值，范围从00～FF，至于这里新出现的AA，则表示透明度，范围也是00～FF。</p><p>#RRGGBBAA颜色虽然很实用，但是透明度的转换却没有RGB色值那么方便，因为透明度范围是0%～100%，而00～FF的十进制范围是0～255，所以需要转换</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Alpha 范围 0~1</span></span><br><span class="line"><span class="variable constant_">AA</span> = (<span class="title class_">Alpha</span> * <span class="number">255</span>).<span class="title function_">toString</span>(<span class="number">16</span>)</span><br></pre></td></tr></table></figure><p>透明度50%就等于(0.5*255).toString(16)，结果是7f.8，约等于80。因此#FF000080就表示透明度约为50%的红色。</p><blockquote><p>同样，#RRGGBBAA颜色也支持缩写，例如#f308等同于#ff330088</p></blockquote><h3 id="必学必会的background属性新特性"><a href="#必学必会的background属性新特性" class="headerlink" title="必学必会的background属性新特性"></a>必学必会的background属性新特性</h3><h4 id="background-size属性"><a href="#background-size属性" class="headerlink" title="background-size属性"></a>background-size属性</h4><ol><li><p>cover和contain</p><p> cover和contain是两个关键字属性值，两者都不会改变背景图的原始比例，非常适合背景图像高宽不确定的场景。</p><p> <a href="https://demo.cssworld.cn/new/3/10-1.php">效果示例</a></p></li><li><p>理解auto关键字下的尺寸渲染规则</p><blockquote><p>在深入理解auto关键字的尺寸渲染规则之前，我们需要先了解一下常见图像的内在尺寸和内在比例。在CSS世界中，常见的图像有以下几种。</p></blockquote><p> ● 位图。例如JPG或者PNG图片都属于位图，这些图像总是有自己的<strong>内在尺寸（原始图像大小）</strong>和<strong>内在比例（原始图像比例）</strong>。</p><p> ● 矢量图。例如SVG图像就属于矢量图，这些图像不一定具有内在尺寸。如果水平尺寸和垂直尺寸都设置了，那么它就具有内在的比例；如果没有设置尺寸，或者只设置了一个方向的尺寸，它可能有比例，也可能没有比例，要视SVG内部代码而定，如有些SVG元素内部只有&lt;defs&gt;元素，此时矢量图就没有比例。</p><p> ● 渐变图像。就是使用CSS渐变语法绘制的图像，这些图像是没有内在尺寸和内在比例的。</p><p> ● 元素图像。例如使用element()函数把DOM元素作为背景图，此时的内在尺寸就是这个DOM元素的尺寸。</p><p> <strong>auto关键字的尺寸渲染规则</strong></p><p> （1）如果图像水平和垂直方向同时具有内在尺寸，则按照图像原始大小进行渲染。例如一个PNG图片尺寸是800px×600px，那么背景图的尺寸就是800px×600px，这就是多倍图一定要设置background-size属性的原因，否则只能显示部分图像内容。</p><p> （2）如果图像没有内在尺寸，也没有内在比例，则按照背景定位区域的大小进行渲染，等同于设置属性值为100%。所以，CSS渐变图像默认都是覆盖整个背景定位区域的，</p><p> （3）如果图像没有内在尺寸，但具有内在比例，则渲染效果等同于设置属性值为contain <a href="https://demo.cssworld.cn/new/3/10-2.php">效果示例</a></p><blockquote><p>preserveAspectRatio=”none”可以去除SVG图像的内在比例，根据我的测试，除Firefox浏览器的渲染有问题外，IE、Edge和Chrome浏览器都可以达到预期效果。</p></blockquote><p> （4）如果图像只有一个方向有内在尺寸，但又具有内在比例，则图像会拉伸到该内在尺寸的大小，同时宽高比符合内在比例</p><p> （5）如果图像只有一个方向有内在尺寸而没有内在比例，则图像有内在尺寸的一侧会拉伸到该内在尺寸大小，没有设置内在尺寸的一侧会拉伸到背景定位区域大小。</p></li><li><p>数值或百分比值</p><p> background-size属性值无论是数值还是百分比值，都不能是负值，其中百分比值是相对于元素的背景定位区域计算的。背景定位区域是由background-origin属性决定的，默认值是padding box。<a href="https://demo.cssworld.cn/new/3/10-3.php">效果展示</a></p></li></ol><h4 id="background属性最成功的设计——多背景"><a href="#background属性最成功的设计——多背景" class="headerlink" title="background属性最成功的设计——多背景"></a>background属性最成功的设计——多背景</h4><p>语法很简单，就是使用逗号分隔多个独立的背景定位语法。</p><p>、</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.multiple-backgrounds</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>) no-repeat top,<span class="built_in">url</span>(<span class="string">1.jpg</span>) no-repeat bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CSS渐变本质上也是一种图像，它也可以作为background-image的属性值。为什么CSS渐变的出现让多背景重获新生了呢？</strong></p><p>（1）CSS渐变可以实现纯色效果，只要渐变起止颜色一样即可。</p><p>（2）background-size属性也支持多背景，且可以任意控制尺寸。</p><p>[css渐变和多背景实现加减图标按钮效果](<a href="https://demo.cssworld.cn/new/3/10-">https://demo.cssworld.cn/new/3/10-</a> 4.php)</p><p><a href="https://demo.cssworld.cn/new/3/10-5.php">多背景实现灰白网格效果</a></p><p>更复杂、更“炫酷”的背景图案和纹理效果可以访问Css3 Patterns Gallery网站</p><p>如果想让语句合法，则需要使用CSS多背景语法，并且颜色值必须放在最后</p><h4 id="background-clip"><a href="#background-clip" class="headerlink" title="background-clip"></a>background-clip</h4><p>支持以下属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-clip</span>:border-box|padding-box|content-box|text;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>其中border-box是默认值，表示背景图像或者背景颜色的显示区域是整个border-box，也就是边框的下方也会显示背景内容。</p></blockquote><p>background-clip属性最实用的应用场景之一就是控制背景颜色的显示范围</p><p>举个例子，我们想要模拟一个复选框效果，设计师设计的复选框尺寸只有18px×18px，区域太小了，不容易点中，尤其是在移动端，此时我们就可以借助透明边框增大点击区域的范围，</p><ul><li><h5 id="HTML：-1"><a href="#HTML：-1" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">默认：<span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span> </span><br><span class="line">选中：<span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;checkbox checked&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-1"><a href="#CSS：-1" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.checkbox</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">18px</span>; <span class="attribute">height</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> solid transparent;</span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0</span> <span class="number">1px</span>, inset -<span class="number">1px</span> <span class="number">0</span>, inset <span class="number">0</span> -<span class="number">1px</span>, inset <span class="number">1px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: gray;</span><br><span class="line">    user-select: none;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.checked</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: deepskyblue;</span><br><span class="line">    <span class="attribute">background</span>: currentColor;</span><br><span class="line">    <span class="attribute">background-clip</span>: padding-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.checkbox</span><span class="selector-class">.checked</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>; <span class="attribute">height</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> auto <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://demo.cssworld.cn/new/3/10-6.php">效果展示</a></p><h4 id="background-clip-text声明与渐变文字效果"><a href="#background-clip-text声明与渐变文字效果" class="headerlink" title="background-clip:text声明与渐变文字效果"></a>background-clip:text声明与渐变文字效果</h4><blockquote><p>background-clip:text原本是webkit内核浏览器的私有声明，只在Safari浏览器和Chrome浏览器中有效。后来，因为这个特性还挺实用，所以其被加入了最新的CSS边框和背景模块规范，目前Firefox浏览器和Edge15+浏览器也提供了支持。background-clip:text可以让背景图像按照字符形状进行剪裁，此时我们只要隐藏文字，就可以看到字符形状的背景效果了。这个特性可以用来实现文字纹理效果和更常见的文字渐变效果</p></blockquote><p>[文字渐变效果](<a href="https://demo.cssworld.cn/">https://demo.cssworld.cn/</a> new/3/10-7.php)</p><blockquote><p>另外，如果使用background-clip:text声明实现渐变文字效果，那么原本彩色的emoji字符的颜色会丢失。</p></blockquote><h4 id="background-origin属性与背景定位原点控制"><a href="#background-origin属性与背景定位原点控制" class="headerlink" title="background-origin属性与背景定位原点控制"></a><strong>background-origin属性与背景定位原点控制</strong></h4><p>background-origin属性支持下面几个属性值：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: border-box|padding-box|content-box;</span><br></pre></td></tr></table></figure><h4 id="background-repeat属性新增了space和round这两个关键字属性值"><a href="#background-repeat属性新增了space和round这两个关键字属性值" class="headerlink" title="background-repeat属性新增了space和round这两个关键字属性值"></a>background-repeat属性新增了space和round这两个关键字属性值</h4><ol><li><p>space 平铺</p><p> 让背景图像尽可能地重复，而不进行剪裁，每个重复单元的尺寸不会变化。其中第一张和最后一张图像固定在元素的两边，然后通过拉伸空白区域让剩余的图像均匀分布</p></li><li><p>round 拉伸</p><p> 背景图像会被拉伸，并保证不留间隙。随着定位区域空间的增加，如果（假设图像都是原始尺寸下的）剩余空间大于图像宽度的一半，则添加另外一张图像。在添加下一张图像时，当前的所有图像都会压缩以留出空间放下这个新添加的图像</p></li></ol><p><a href="https://demo.cssworld.cn/new/3/10-8.php">效果展示</a></p><h4 id="可以指定background-position的起始方位了"><a href="#可以指定background-position的起始方位了" class="headerlink" title="可以指定background-position的起始方位了"></a>可以指定background-position的起始方位了</h4><blockquote><p>由于background-position的百分比定位的计算比较特殊（详见《CSS世界》一书的9.2.2节），因此，在过去，我们想要实现一个距离元素右下方特定距离的定位就不太容易，唯一的方法就是借助透明边框帮助定位。好在IE9浏览器已经开始支持指定background-position的起始位置了，于是我们想要让背景图像在距离右下方20px的位置就非常简单了：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">border</span>: solid deepskyblue;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>) no-repeat right <span class="number">20px</span> bottom <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/3/10-9.php">效果展示</a></p><p>也有这种写法</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>) no-repeat <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">20px</span>) <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">20px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>虽然这种写法也有效果，但是性能不够好，而且这种写法可能会让IE9浏览器崩溃</p></blockquote><blockquote><p><strong>如果只有1个值</strong>，无论是具体的数值、百分比值，还是关键字属性值，<strong>则另外一个值一定是center</strong></p></blockquote><blockquote><p>总结一下，IE浏览器从IE9版本开始就已经支持background-position属性的3值和4值语法，因此不要再使用calc()函数实现相对于右下方的定位了。</p></blockquote><h3 id="outline相关新属性outline-offset"><a href="#outline相关新属性outline-offset" class="headerlink" title="outline相关新属性outline-offset"></a>outline相关新属性outline-offset</h3><p>outline-offset属性用于改变outline属性设置的轮廓的偏移位置。</p><p>以我的经验来看，outline-offset属性使用负值来缩小轮廓的频率要比使用正值来扩大轮廓的频率高很多。</p><p><a href="https://demo.cssworld.cn/new/3/11-1.php">outline轮廓被覆盖out-offset优化示例</a></p><p>让合适的outline尺寸配合合适的outline-offset负值，我们可以通过颜色覆盖的方式实现渐变边框效果，或者绘制一个加号图案</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">120px</span>; <span class="attribute">height</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(deepskyblue, deeppink);</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">40px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">outline-offset</span>: -<span class="number">92px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cursor属性新增的手形效果"><a href="#cursor属性新增的手形效果" class="headerlink" title="cursor属性新增的手形效果"></a>cursor属性新增的手形效果</h3><blockquote></blockquote><h4 id="放大手形zoom-in和缩小手形zoom-out简介"><a href="#放大手形zoom-in和缩小手形zoom-out简介" class="headerlink" title="放大手形zoom-in和缩小手形zoom-out简介"></a>放大手形zoom-in和缩小手形zoom-out简介</h4><p>cursor:zoom-in的鼠标指针是[插图]形状，cursor:zoom-out的鼠标指针是[插图]形状，多用于在桌面端的网页中查看大图的交互场景中</p><p><a href="https://demo.cssworld.cn/new/3/12-1.php">效果展示</a></p><h4 id="抓取手形grab和放手手形grabbing"><a href="#抓取手形grab和放手手形grabbing" class="headerlink" title="抓取手形grab和放手手形grabbing"></a>抓取手形grab和放手手形grabbing</h4><p>cursor:grab的鼠标指针是一个五指张开的手的形状[插图]，cursor:grabbing的鼠标指针是一个五指收起的手的形状[插图]，它们多用在元素预览空间不足并需要拖动元素的交互场景中</p><p>[效果展示](<a href="https://demo.cssworld.cn/new/">https://demo.cssworld.cn/new/</a> 3/12-2.php)</p><blockquote></blockquote><h2 id="全新的布局方式"><a href="#全新的布局方式" class="headerlink" title="全新的布局方式"></a>全新的布局方式</h2><h3 id="分栏布局"><a href="#分栏布局" class="headerlink" title="分栏布局"></a>分栏布局</h3><blockquote><p>分栏布局也被称为多列布局、多栏布局，这种布局可以将内容布局到多个列框中，类似报纸上的排版。</p><p>分栏布局比较特殊，有别于传统布局，它将子元素在内的所有内容拆分为列，这与打印网页的时候将网页内容分成多个页面的方式类似。分栏布局主要针对图文排版布局，应用在横向排版场景中，文档流是倒N方向。有个别布局只能使用分栏布局实现，分栏布局虽然在日常开发中用得不多，但是遇到合适的场景时是一种非常有用的布局方式。</p></blockquote><ul><li><h5 id="HTML：-2"><a href="#HTML：-2" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>重庆市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>哈尔滨市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>长春市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>兰州市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>北京市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>杭州市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>长沙市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>沈阳市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>成都市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>合肥市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>天津市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>西安市<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-2"><a href="#CSS：-2" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">columns</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://demo.cssworld.cn/new/6/1-1.php">效果展示</a></p><blockquote><p>相比其他布局方法，分栏布局最大的优点是不会改变元素原本的display计算值。例如，在默认状态下，<li>元素会出现项目符号，如圆点或数字序号。此时，如果对<li>元素使用弹性布局或网格布局，则项目符号就会消失，因为display:flex或display:grid会重置<li>元素内置的display:list-item声明</p></blockquote><p><strong>分栏布局相关的CSS属性</strong></p><p>● columns；</p><p>● column-width；</p><p>● column-count；</p><p>● column-rule；</p><p>● column-rule-color；</p><p>● column-rule-style；</p><p>● column-rule-width；</p><p>● column-span；</p><p>● column-fill；</p><p>● column-gap。</p><blockquote><p>虽然这10个CSS属性都有各自的作用，但是在实用程度上却有明显的差异。根据我的开发经验，超过80%的分栏布局只需要使用columns属性就足够，因此，大家的学习重心可以放在columns属性上，column-gap属性有时候也会用到，所以也可以关注下，至于剩下的属性，大家了解一下基本作用即可。</p></blockquote><h4 id="重点关注columns属性"><a href="#重点关注columns属性" class="headerlink" title="重点关注columns属性"></a>重点关注columns属性</h4><blockquote><p>columns属性是column-width和column-count属性的缩写，举几个使用columns属性的例子：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*栏目宽度*/</span></span><br><span class="line">colums: <span class="number">18em</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*栏目数目*/</span></span><br><span class="line"><span class="attribute">columns</span>: auto;</span><br><span class="line">columnsL <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 同时定义宽度和数目，顺序任意 */</span></span><br><span class="line"><span class="attribute">columns</span>: <span class="number">2</span> auto;</span><br><span class="line"><span class="attribute">columns</span>: auto <span class="number">2</span>;</span><br><span class="line"><span class="attribute">columns</span>: auto <span class="number">12em</span>;</span><br><span class="line"><span class="attribute">columns</span>: auto auto;</span><br></pre></td></tr></table></figure><p><strong>关于column-width</strong></p><blockquote><p>column-width表示每一栏/列的最佳宽度，注意，是“最佳宽度”，实际渲染宽度多半和指定的宽度是有出入的.。它不支持 % 语法</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">column-width</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里容器宽度为300px，设定每一栏的宽度是200px，不足以分栏，此时容器里面的内容会无视column-width:200px声明，并按照容器的300px宽度排版。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">column-width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里容器宽度为200px，设定的每一栏宽度是300px，比容器宽度还要宽，此时容器里面的内容会无视column-width:300px声明，并按照容器的200px宽度排版。</p></blockquote><p>那么，什么情况下column-width设置的宽度值和实际渲染的宽度值一致呢？</p><p>这个问题的答案可能会出乎大家的意料：<strong>几乎不存在分栏布局的栏目宽度就是column-width设置的宽度这样的场景。</strong></p><blockquote><p>因为column-width和传统的width属性不同，column-width更像是一个期望尺寸，浏览器会根据这个期望尺寸确定分栏数目，一旦分栏数目确定了，column-width属性的使命也就完成了，接下来根据分栏数目对容器进行的分栏布局就和column-width属性没有任何关系了。</p></blockquote><p><strong>关于column-count</strong></p><blockquote><p>column-count表示理想的分栏数目，又出现了很微妙的词——“理想的”，也就是意味着最终的分栏数目可能不受column-count属性值的控制。</p><p>在分栏布局中，最终分栏的数量要么由column-count属性决定，要么由column-width属性决定，这两个CSS属性都可能有更高的决定权，至于哪个CSS属性的决定权更高，是要看具体场景的。</p><p>决定权优先级的计算诀窍可以用一句话概括：<strong>统一转换column-count值，哪个值小就使用哪一个。</strong></p></blockquote><ul><li><h5 id="HTML：-3"><a href="#HTML：-3" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-1&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-2&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-3"><a href="#CSS：-3" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">此容器设置2列</span></span><br><span class="line"><span class="comment">容器宽/期望宽 = 360/100 ≈ 3 列</span></span><br><span class="line"><span class="comment">取最小列2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.container-1</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">360px</span>;</span><br><span class="line">    <span class="attribute">column-count</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">column-width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">此容器设置4列</span></span><br><span class="line"><span class="comment">容器宽/期望宽 = 360/100 ≈ 3 列</span></span><br><span class="line"><span class="comment">取最小列3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.container-2</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">360px</span>;</span><br><span class="line">    <span class="attribute">column-count</span>: <span class="number">4</span>;</span><br><span class="line">    <span class="attribute">column-width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://demo.cssworld.cn/new/6/1-2.php">效果展示</a></p><h4 id="column-gap和gap属性的关系"><a href="#column-gap和gap属性的关系" class="headerlink" title="column-gap和gap属性的关系"></a>column-gap和gap属性的关系</h4><blockquote><p>column-gap属性表示每一栏之间的空白间隙的大小，可以是长度值，也可以是百分比值</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*关键字*/</span></span><br><span class="line">coulmn-<span class="attribute">gap</span>: normal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*长度值*/</span></span><br><span class="line">coulmn-<span class="attribute">gap</span>: <span class="number">3px</span>;</span><br><span class="line">coulmn-<span class="attribute">gap</span>: <span class="number">3em</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*百分比*/</span></span><br><span class="line">coulmn-<span class="attribute">gap</span>: <span class="number">3%</span>;</span><br></pre></td></tr></table></figure><p>实际上，在分栏布局中，如果不考虑IE浏览器，我们可以直接使用gap属性设置分栏间隙大小，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">columns</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至于原因，用一句话解释就是：<strong>column-gap是gap属性的子属性。</strong></p><blockquote><p>在网格布局规范制定之后的一段时间，CSS世界中的行与列之间的间隙使用了gap属性进行了统一，也就是分栏布局、弹性布局和网格布局的间隙都全部统一使用gap属性表示，而gap属性实际上是column-gap属性和row-gap属性的缩写。</p></blockquote><h4 id="了解column-rule、column-span和column-fill属性"><a href="#了解column-rule、column-span和column-fill属性" class="headerlink" title="了解column-rule、column-span和column-fill属性"></a>了解column-rule、column-span和column-fill属性</h4><blockquote><p>平常不太用得到，多出现在对分栏布局效果要求更高的场景中。</p></blockquote><p><strong>了解column-rule属性</strong></p><blockquote><p>column-rule属性是column-rule-width、column-rule-style和column-rule- color这3个CSS属性的缩写。</p><p>column-rule属性和border属性的语法和规则是一模一样的，只是column-rule是设置各个分栏的分隔线样式，border是设置元素的边框样式</p></blockquote><ul><li><h5 id="CSS：-4"><a href="#CSS：-4" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">320px</span>;</span><br><span class="line">    <span class="attribute">border</span>: solid deepskyblue;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">column-count</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">column-rule</span>: dashed deepskyblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://demo.cssworld.cn/new/6/1-3.php">效果展示</a></p><p><strong>了解column-span属性</strong></p><blockquote><p>column-span属性有点类似表格布局中的HTML属性colspan，表示某一个内容是否跨多栏显示。这个CSS属性是作用在分栏布局的子元素上的。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">column-span</span>: none| all;</span><br></pre></td></tr></table></figure><p>● none表示不横跨多栏，默认值。</p><p>● all表示横跨所有垂直列。</p><p><strong>【不支持数字</strong>】</p><p><a href="https://demo.cssworld.cn/new/6/1-4.php">all属性效果展示</a></p><p><strong>了解column-fill属性</strong></p><blockquote><p>column-fill的作用是当<strong>内容分栏的时候平衡每一栏填充的内容</strong></p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">column-fill</span>: auto | balance | balance-all;</span><br></pre></td></tr></table></figure><p>● auto的作用是按顺序填充每一列，内容只占用它需要的空间。</p><p>● balance是默认值，作用是尽可能在列之间平衡内容。在分隔断开的上下文中，只有最后一个片段是平衡的。例如，有多个<p>元素，正好最后一个&lt;p&gt;换行了，那这个&lt;p&gt;元素的内容前后等分，保持平衡。这会造成最后一栏内容较少的问题。</p><p>● balance-all的作用是尽可能在列之间平衡内容。在分隔断开的上下文中，所有片段都是平衡的。该属性值目前没有任何浏览器支持，可以忽略。</p><p><a href="https://demo.cssworld.cn/new/6/1-5.php">效果展示</a></p><p>（1）所有浏览器都能识别column-fill:auto，但是，需要容器有固定的高度才能准确渲染。如果容器没有设置具体的高度值，则仅在Firefox浏览器中有比较符合预期的渲染。因此，在实际开发的时候，column-fill:auto声明的使用一定要配合容器元素的height属性。</p><p>（2）所有浏览器都不能识别column-fill:balance-all</p><p><a href="">分栏布局实现两端对齐布局</a></p><ul><li><h5 id="HTML：-4"><a href="#HTML：-4" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>分栏布局实现两端对齐<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-5"><a href="#CSS：-5" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">border</span>: solid deepskyblue;</span><br><span class="line">    <span class="attribute">column-count</span>: <span class="number">3</span>;</span><br><span class="line">    <span class="attribute">column-gap</span>: <span class="number">5%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: deeppink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>break-inside属性与元素断点位置的控制</strong></p><blockquote><p>break-inside属性可以定义页面打印、分栏布局或Regions布局（已废弃）发生中断时元素的表现形式。如果没有发生中断，则忽略该属性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">break-inside</span>: auto| avoid | avoid-page | avoid-column | avoid-region;</span><br></pre></td></tr></table></figure><p>只需关注下面两个</p><p>● auto表示元素可以中断。</p><p>● avoid表示元素不能中断。</p><p><a href="https://demo.cssworld.cn/new/6/1-7.php">效果展示</a></p><p><strong>box-decoration-break属性与元素断点装饰的控制</strong></p><blockquote><p>在默认情况下，元素片段在跨行、跨列或跨页（如打印）时候的样式是分割渲染的，例如边框或者圆角都是分割开的</p></blockquote><h3 id="弹性布局"><a href="#弹性布局" class="headerlink" title="弹性布局"></a>弹性布局</h3><blockquote><p>专门为现代Web应用设计的布局方式，代码简单，样式丰富，目前已经逐渐成为主流的布局方式，是所有前端开发者需要重点学习的布局方式。</p></blockquote><p>弹性布局相关属性分为4个大的类目，分别是流向控制、对齐设置、顺序控制和弹性设置。</p><p>流向控制对应flex-flow属性及其相关属性。与对齐设置相关的CSS属性在弹性布局和网格布局中是通用的。顺序控制对应order属性，平常用得不多。弹性设置对应flex属性及其相关属性。</p><h4 id="设置display-flex声明发生了什么？"><a href="#设置display-flex声明发生了什么？" class="headerlink" title="设置display:flex声明发生了什么？"></a>设置display:flex声明发生了什么？</h4><blockquote><p>给任意元素设置display:flex声明或者display:inline-flex声明，弹性布局就会被创建。</p><p>display:inline-flex声明可以让flex容器保持内联特性，也就是可以让图片和文字在一行显示，多用在精致的小控件布局中，至于其他特性表现则和display:flex声明一模一样。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">content</span>&gt;</span>1<span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">    裸露的文本元素</span><br><span class="line">    <span class="tag">&lt;<span class="name">content</span>&gt;</span>2<span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">content</span>&gt;</span>3<span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.container &#123;</span><br><span class="line">display: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>flex子项块状化</p><p> 默认状态下，&lt;content&gt;元素的display计算值是inline，而在上面这个例子中，&lt;content&gt;元素的display计算值是block，其变成了块级元素。</p><p> flex子项都是块级水平元素，因此，在flex子项元素中使用vertial-align属性一定是没有任何效果的。</p><p> 此时字符<strong>裸露的文本元素</strong>会变成<strong>匿名块级元素</strong>，和前后两个&lt;content&gt;元素并排显示，如图6-15所示。但是，如果仅是空格字符（Enter空格、Space空格或Tab空格），则不会渲染，即使设置white- space:pre或者white-space:pre-wrap也是如此</p></li><li><p>flex子项浮动失效</p><p> 控制flex子项左右对齐是有专门的CSS属性的</p></li><li><p>flex子项支持z-index属性</p><p> 即使flex子项的position属性的计算值是static，flex子项也是支持z-index属性的。如果z-index属性值不是auto，则会创建新的层叠上下文</p></li><li><p>flex子项的margin值不会合并</p><p> 这一点和普通的块级元素不一样。</p></li><li><p>flex子项是格式化的尺寸</p><p> 就是说flex子项的尺寸在底层是有具体的计算值的，因此，我们可以使用margin:auto进行剩余空间的智能分配</p></li><li><p>其他</p><ul><li>flex子项如果被设置为绝对定位，则会脱离弹性布局</li><li>flex子项的尺寸默认表现为收缩，如果要设置建议的尺寸，可以给flex子项使用flex-basis属性，或者使用缩写的flex属性。</li><li>flex子项默认是水平排列的，这个特性表现是由flex-direction属性决定的</li><li>而且就算flex子项的宽度之和超过flex容器，flex子项也不会换行，这个特性表现是由flex-wrap属性决定的</li></ul></li></ol><h4 id="flex-direction属性与整体布局方向"><a href="#flex-direction属性与整体布局方向" class="headerlink" title="flex-direction属性与整体布局方向"></a>flex-direction属性与整体布局方向</h4><blockquote><p>flex-direction属性用来控制flex子项整体布局方向，决定是从左往右排列还是从右往左排列，是从上往下排列还是从下往上排列</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br></pre></td></tr></table></figure><p>● row是默认值，表示flex子项显示为水平排列。</p><p>● row-reverse表示flex子项显示为水平排列</p><p>● column表示flex子项显示为垂直排列</p><p>● column-reverse表示flex子项显示为垂直排列，但方向和column属性值相反</p><p><a href="https://demo.cssworld.cn/new/6/2-1.php">效果展示</a></p><h4 id="flex-wrap属性与整体布局的换行表现"><a href="#flex-wrap属性与整体布局的换行表现" class="headerlink" title="flex-wrap属性与整体布局的换行表现"></a>flex-wrap属性与整体布局的换行表现</h4><blockquote><p>flex-wrap属性用来控制flex子项是单行显示还是换行显示，以及在换行情况下，每一行内容是否在垂直方向的反方向显示。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-wrap</span>: nowarp | wrap | wrap-reverse;</span><br></pre></td></tr></table></figure><p>● nowrap是默认值，表示flex子项是单行显示，且不换行</p><p>● wrap表示flex容器宽度不足的时候，flex子项会换行显示</p><p>● wrap-reverse表示宽度不足的时候，flex子项会换行显示，但是flex子项是从下往上开始排列的，也就是原本换行到下面一行的flex子项现在换行到上面一行</p><p><a href="https://demo.cssworld.cn/new/6/2-2.php">效果展示</a></p><h4 id="熟练使用flex-flow属性"><a href="#熟练使用flex-flow属性" class="headerlink" title="熟练使用flex-flow属性"></a>熟练使用flex-flow属性</h4><blockquote><p>flex-flow属性是flex-direction属性和flex-wrap属性的缩写，表示弹性布局的流动特性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-flow</span>: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br></pre></td></tr></table></figure><p>使用时不区分方向，可以随意省略一个值</p><h4 id="对齐特性综述"><a href="#对齐特性综述" class="headerlink" title="对齐特性综述"></a>对齐特性综述</h4><p>在整个CSS世界中是有通用的含义的，具体如下：</p><p>● justify表示水平方向的样式设置；</p><p>● align表示垂直方向的样式设置；</p><p>● items表示全体元素的样式设置；</p><p>● content表示整体布局的样式设置；</p><p>● self表示元素自身的样式设置，其一定是应用在子元素上的。</p><p>因此，justify-content属性就表示整体布局的水平对齐设置，align-items就表示全体元素的垂直对齐样式设置。</p><h4 id="justify-content属性与整体布局的水平对齐"><a href="#justify-content属性与整体布局的水平对齐" class="headerlink" title="justify-content属性与整体布局的水平对齐"></a>justify-content属性与整体布局的水平对齐</h4><p>常用语法</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">justify-content</span>: normal | flex-start | flex-end | center | space-between| space-evenly| space-around;</span><br></pre></td></tr></table></figure><p>● normal是初始值，表示根据环境不同，可以采用不同的对齐表现。flex默认表现类似于start</p><p>● flex-start可以看成默认值，它是一个逻辑CSS属性值，与文档流方向相关，默认表现为整体布局左对齐。</p><p>● flex-end是逻辑CSS属性值，与文档流方向相关，默认表现为整体布局右对齐。<strong>注意，如果flex容器设置了overflow滚动，同时应用justify-content:flex-end，滚动效果会失效。</strong></p><p>● center表现为整体布局居中对齐。</p><p>● space-between表示多余的空白间距只在元素中间区域分配</p><p>● space-around表示每个flex子项两侧都环绕互不干扰的等宽的空白间距，最终在视觉表现上边缘两侧的空白只有中间空白宽度的一半</p><p>● space-evenly表示每个flex子项两侧空白间距完全相等</p><p><a href="https://demo.cssworld.cn/new/6/2-4.php">效果展示</a></p><h4 id="垂直对齐属性align-items与align-self"><a href="#垂直对齐属性align-items与align-self" class="headerlink" title="垂直对齐属性align-items与align-self"></a>垂直对齐属性align-items与align-self</h4><blockquote><p>align-items属性和align-self属性的一个区别是align-self属性是设置在具体的某一个flex子项上的，而align-items属性是设置在flex容器元素上的，控制所有flex子项的垂直对齐方式；另一个区别是align-self属性的初始值是auto，其余的属性值align-items属性和align-self属性的是一样的，含义也是一样的。</p></blockquote><p>常用语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">align-items</span>: stretch | flex-start | flex-end | center | baseline;</span><br><span class="line"></span><br><span class="line"><span class="attribute">align-self</span>: auto | stretch | flex-start | flex-end | center | baseline;</span><br></pre></td></tr></table></figure><p>● stretch可以看成弹性布局中align-items属性的默认值，表示flex子项在垂直方向上拉伸。</p><p>● auto是align-self属性的默认值，表示flex子项的垂直对齐方式是由flex容器的align-items属性值决定的。</p><p>● flex-start是逻辑CSS属性值，与文档流方向相关，默认表现为flex子项顶部对齐</p><p>● flex-end是逻辑CSS属性值，与文档流方向相关，默认表现为flex子项底部对齐</p><p>● center表示flex子项都是垂直居中对齐</p><p>● baseline表示flex子项参与基线对齐。注意这里的措辞是“参与基线对齐”，并不是指flex子项和基线对齐，而是让所有flex子项的内外基线都在一条水平线上，换句话说，就是给每个flex子项里里外外写上多个字母“x”，这些字母“x”的下边缘保持对齐</p><p><a href="https://demo.cssworld.cn/new/6/2-5.php">效果展示</a></p><blockquote><p>补充一个小知识点，如果flex-direction属性的值是column或是column-reverse，则flex子项的垂直对齐不应使用align-items属性控制，而是应该使用justify-content属性控制</p></blockquote><blockquote><p>align-self属性的各个属性值的表现和align-items属性的各个属性值一样，区别在于align-self属性设置的是具体某个flex子项的垂直对齐方式</p><p><a href="https://demo.cssworld.cn/new/6/2-6.php">效果展示</a></p></blockquote><h4 id="align-content属性与整体布局的垂直对齐"><a href="#align-content属性与整体布局的垂直对齐" class="headerlink" title="align-content属性与整体布局的垂直对齐"></a>align-content属性与整体布局的垂直对齐</h4><blockquote><p>lign-content属性和align-items属性的区别在于align-items属性设置的是每一个flex子项的垂直对齐方式，而align-content属性将所有flex子项作为一个整体进行垂直对齐设置。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">align-content</span>: stretch | flex-start | flex-end | center | space-between | space-around | space-evenly;</span><br></pre></td></tr></table></figure><p>● stretch可以看成弹性布局中align-content属性的默认值，表示每一行flex子项都等比例拉伸。例如，如果共两行flex子项，则每一行拉伸的高度是50%。</p><p>● flex-start是逻辑CSS属性值，与文档流方向相关，默认表现为顶部堆砌。</p><p>● flex-end是逻辑CSS属性值，与文档流方向相关，默认表现为底部堆放。</p><p>● center表现为整体垂直居中对齐。</p><p>● space-between表现为上下两行两端对齐，剩下的每一行元素等分剩余空间。</p><p>● space-around表现为每一行元素上下都享有独立不重叠的空白空间。</p><p>● space-evenly表现为每一行元素上下的空白空间的大小都是一致的。</p><p><a href="https://demo.cssworld.cn/new/6/2-7.php">效果展示</a></p><h4 id="order属性与单个子项的顺序控制"><a href="#order属性与单个子项的顺序控制" class="headerlink" title="order属性与单个子项的顺序控制"></a>order属性与单个子项的顺序控制</h4><blockquote><p>我们可以通过设置order属性来改变某一个flex子项的排序位置。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">order</span>: &lt;integer&gt;; <span class="comment">/*整数值，默认是 0*/</span></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/6/2-8.php">效果展示</a></p><h4 id="深入理解flex属性"><a href="#深入理解flex属性" class="headerlink" title="深入理解flex属性"></a>深入理解flex属性</h4><p><strong>隐藏的友善细节</strong></p><blockquote><p>flex属性是flex-grow、flex-shrink和flex-basis这3个CSS属性的缩写，这个很多人都知道，但是，我相信很多人并不知道flex属性悄悄做了很多其他CSS缩写属性都没有的优化。</p><p>border, background 也是如此</p></blockquote><p>border ：</p><p>● border:2px等同于border:2px none currentColor，也就是此时border-style的值是默认值none，border-color的计算值是当前的色值。</p><p>● border:#fff等同于border:medium none #fff，也就是此时border-width的值是默认值medium。</p><p>● border:solid等同于border:medium solid currentColor。</p><p>flex：</p><p>● flex:1等同于flex:1 1 0%，flex:1 2等同于flex:1 2 0%，即flex-basis使用的不是默认值auto，而是使用的0%。</p><p>● flex:100px等同于flex:1 1 100px，即flex-grow使用的不是默认值0，而是使用的1。</p><p>● flex:auto等同于设置flex: 1 1 auto，其作用就和它的名称一样，表示“自动”，即flex子项自动填满剩余空间或自动收缩。</p><p>● flex:none等同于设置flex: 0 0 auto，作用就和名称一样，表示“没有”，即flex子项没有弹性，适合固定尺寸元素（无须设置width属性）。</p><p><strong>flex属性的语法</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex</span>: auto;</span><br><span class="line"><span class="attribute">flex</span>: none;</span><br><span class="line"><span class="attribute">flex</span>: &lt;flex-grow&gt; &lt;flex-shrink&gt; || &lt;flex-basis&gt;</span><br></pre></td></tr></table></figure><p>1）如果flex的属性值只有1个值，则具体规则如下。</p><p>● 如果是数值，如flex: 1，则这个1为flex-grow属性的值，此时flex-shrink属性和flex-basis属性的值分别是1和0%。注意，这里的flex-basis属性的值是0%，而不是默认值auto。</p><p>● 如果是长度值，如flex:100px，则这个100px显然为flex-basis属性的值，因为3个缩写CSS属性中只有flex-basis的属性值支持长度值。此时flex-grow属性和flex- shrink属性的值都是1，注意，这里的flex-grow属性的值是1，而不是默认值0。</p><p>2）如果flex的属性值有2个值，则第一个值一定是flex-grow属性值（因为表示0个或1个的问号“?”在flex-shrink的后面），第二个值根据值的类型不同对应不同的CSS属性，具体规则如下。</p><p>● 如果第二个值是数值，例如flex: 1 2，则这个2是flex-shrink属性的值，此时flex-basis属性计算值是0%，并非默认值auto。</p><p>● 如果第二个值是长度值，例如flex: 1 100px，则这个100px为flex-basis属性值。</p><p>3）如果flex的属性值有3个值，则长度值为flex-basis属性值，其余2个数值分别为flex-grow和flex-shrink的属性值。</p><p><strong>理解flex-grow属性、flex-shrink属性和flex-basis属性</strong></p><blockquote><p>为了让这3个属性更容易被理解，我们不妨把弹性布局中的尺寸分配看成分配家产。</p><p>故事是这样的，有一个姓范的人家生了5个孩子，分别叫作范张、范鑫、范旭、范帅和范哥。要是只有一个孩子，那这个孩子就继承100%的家产，但是现在有5个孩子，家长范某需要提早定好家产分配规则。而flex属性的作用就如同制定分配家产的规则。</p><p>● flex-basis属性用来分配基础数量的家产。</p><p>● flex-grow属性用来家产仍有富余的时候该如何分配。</p><p>● flex-shrink属性用来家产不足的时候该如何分配。</p></blockquote><ol><li><p>flex-grow属性指定了容器剩余空间多余时候的分配规则，默认值是0，表示多余空间不分配，语法如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-grow</span>: &lt;number&gt;; // 可以是小数默认是<span class="number">0</span></span><br></pre></td></tr></table></figure><blockquote><p>具体规则如下。</p><p>● 所有剩余空间总量是1。</p><p>● 如果只有1个flex子项设置了flex-grow属性值，则有两种分配情况。</p><p>● 如果flex-grow属性值小于1，则flex子项扩展的空间就是总剩余空间和这个比例的计算值。</p><p>● 如果flex-grow属性值大于1，则flex子项独享所有剩余空间。</p><p>● 如果有多个子项flex设置了flex-grow属性值，则有两种分配情况。</p><p>● 如果flex-grow属性值的总和小于1，则每个flex子项扩展的空间就是总剩余空间和当前flex子项设置的flex-grow比例的计算值。</p><p>● 如果flex-grow属性值的总和大于1，则所有剩余空间被利用，分配比例就是各个flex子项的flex-grow属性值的比例。</p><p>例如，所有flex子项都设置flex-grow:1，则表示剩余空间等分；如果设置的flex-grow比例是1:2:1，则中间的flex子项占据一半的剩余空间，剩下另外一半的剩余空间由前后两个flex子项等分。</p></blockquote></li><li><p>flex-shrink属性指定了容器剩余空间不足时候的分配规则，默认值是1，表示空间不足要分配，语法如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-shrink</span>: &lt;number&gt; // 默认<span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>具体规则如下。</p><p>● 如果只有1个flex子项设置了flex-shrink属性值，则有两种分配情况。</p><p>● 如果flex-shrink属性值小于1，则收缩不完全，会有一部分内容溢出flex容器。</p><p>● 如果flex-shrink属性值大于等于1，则收缩完全，元素正好填满flex容器。</p><p>● 如果多个flex子项设置了flex-shrink属性，则有两种分配情况。</p><p>● 如果flex-shrink属性值的总和小于1，则收缩不完全，每个元素收缩尺寸和“完全收缩的尺寸”的比例就是该元素的flex-shrink属性的值。</p><p>● 如果flex-shrink属性值的总和大于1，则收缩完全，每个元素收缩尺寸的比例和flex-shrink属性值的比例一样。</p></blockquote></li><li><p>flex-basis属性则是指定的分配基础尺寸，默认值是auto，语法如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-basis</span>: &lt;length&gt; | auto; // 默认值是 auto</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>范某的家产分配遗嘱是在自己50岁时候制定的。由于范张、范鑫和范旭都已经成家立业，各自在外独立生活，因此，给这3个人分配了固定数目的家产，每人100万元；而范帅和范哥尚未成年，和范某还住在一起，所以，遗嘱就是剩下的家产由范帅和范哥两人平分，按照范某50岁时候的资产，范帅和范哥也分得人均100万元的家产。但是世事难料，没过几年范家家道中落，范某总资产已经不足300万元，此时，扣除答应范张、范鑫和范旭的300万元，已经没有多余家产了，范帅和范哥就没有家产可继承了，这就相当于容器剩余空间不足。因此，为了应对各种状况出现，在家产分配规则制定的时候，一定要明确好基础家产数量flex-basis，家产充足时候的分配规则flex-grow，以及家产不足时候的分配规则flex-shrink。</p><p>实现范张、范鑫和范旭每人有100万元固定家产，范帅和范哥有20万元保底家产。如果范某去世那天家产还有富余，则范帅和范哥按照3:2比例分配；如果没有剩余家产，则范张、范鑫和范旭按照2:1:1的比例分别给范帅和范哥匀20万元保底家产</p></blockquote><ul><li><h5 id="HTML：-5"><a href="#HTML：-5" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">class</span>=<span class="string">&quot;zhang&quot;</span>&gt;</span>范张<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">class</span>=<span class="string">&quot;xin&quot;</span>&gt;</span>范鑫<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">class</span>=<span class="string">&quot;xu&quot;</span>&gt;</span>范旭<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">class</span>=<span class="string">&quot;shuai&quot;</span>&gt;</span>范帅<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">class</span>=<span class="string">&quot;ge&quot;</span>&gt;</span>范哥<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-6"><a href="#CSS：-6" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> dashed crimson;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> item &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid deepskyblue;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.zhang</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">2</span> <span class="number">100px</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.xin</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">100px</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.xu</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">1</span> <span class="number">100px</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.shuai</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">3</span> <span class="number">0</span> <span class="number">20px</span>;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ge</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">2</span> <span class="number">0</span> <span class="number">20px</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://demo.cssworld.cn/new/6/2-9.php">示例效果</a></p><h4 id="应该在什么时候使用flex-0-1-none-auto"><a href="#应该在什么时候使用flex-0-1-none-auto" class="headerlink" title="应该在什么时候使用flex:0/1/none/auto"></a>应该在什么时候使用flex:0/1/none/auto</h4><blockquote><p>常见的flex属性单值语法对应的计算值</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221031150458362.png" alt="image-20221031150458362"></p><ol><li><p>flex:initial的基本表现</p><p> 应用flex:initial的元素在flex容器有剩余空间时其尺寸不会增长（flex-grow:0），在flex容器尺寸不足时尺寸会收缩变小（flex-shrink:1），同时当前应用flex:initial的元素的尺寸自适应于内容（flex-basis:auto）。</p><p> <strong>适用的场景</strong></p><blockquote><p>就是在那些希望元素尺寸收缩，同时元素内容较多又能自动换行的场景中可以不做任何flex属性设置</p></blockquote></li><li><p>flex:0和flex:none的区别</p><p> flex:0等同于设置flex: 0 1 0%</p><p> flex:none等同于设置flex: 0 0 auto</p><blockquote><p><strong>flex:0</strong>元素尺寸不会弹性增大（flex-grow:0）,但是会弹性收缩(flex-shrink:1），考虑到此时flex-basis属性值是0%，表示基础尺寸是0，因此设置flex:0的元素尺寸表现为最小内容宽度，也就是文字会呈现“一柱擎天”的</p><p><strong>flex:none</strong>的尺寸同样不会弹性增大（flex-grow:0），但是也不会弹性收缩（flex-shrink:0），我们可以理解为元素的尺寸没有弹性变化，考虑到此时flex-basis属性值是auto，即基础尺寸由内容决定，因此设置flex:none的元素最终尺寸通常表现为最大内容宽度。</p></blockquote></li><li><p>flex:1和flex:auto的区别</p><p> flex:1等同于设置flex: 1 1 0%</p><p> flex:auto等同于设置flex: 1 1 auto</p><blockquote><p>元素尺寸可以弹性增大，也可以弹性减小，但是flex:1在容器尺寸不足时会优先最小化内容尺寸，flex:auto在容器尺寸不足时会优先最大化内容尺寸。</p><p>当希望元素充分利用剩余空间，同时不会侵占其他元素应有的宽度的时候，适合使用flex:1，这样的场景在弹性布局中非常多</p><p><a href="https://demo.cssworld.cn/new/6/2-10.php">效果展示</a></p><p>当希望元素充分利用剩余空间，但是元素各自的尺寸又需要按照各自内容进行分配的时候，就适合使用flex:auto。</p><p>[宽度自动分配的导航栏](<a href="https://demo/">https://demo</a>. cssworld.cn/new/6/2-11.php)</p></blockquote></li></ol><p>最后再总结一下。</p><p>● flex:initial表示默认的弹性布局状态，无须专门设置，适合小控件元素的分布布局（其中某一个flex子项的内容动态变化也没有关系）。</p><p>● flex:0适用场景较少，适合设置在替换元素的父元素上。</p><p>● flex:none适合设置在内容不能换行显示的小控件元素上，如按钮。</p><p>● flex:1适合等分布局。</p><p>● flex:auto适合基于内容动态适配的布局。</p><h4 id="详细了解flex-basis属性与尺寸计算规则"><a href="#详细了解flex-basis属性与尺寸计算规则" class="headerlink" title="详细了解flex-basis属性与尺寸计算规则"></a>详细了解flex-basis属性与尺寸计算规则</h4><blockquote><p>在弹性布局中，一个flex子项的最终尺寸是基础尺寸（或内容尺寸）、弹性增长或收缩、最大最小尺寸共同作用的结果。</p><p><strong>最终尺寸计算的优先级是：</strong></p><p>最大最小尺寸限制 &gt; 弹性增长或收缩 &gt; 基础尺寸</p><p>● 基础尺寸由flex-basis属性或width属性，以及box-sizing盒模型共同决定；</p><p>● 内容尺寸指最大内容宽度，当没有设置基础尺寸时会顶替基础尺寸的角色；</p><p>● 弹性增长指的是flex-grow属性，弹性收缩指的是flex-shrink属性；</p><p>● 最大尺寸主要受max-width属性限制；最小尺寸则比较复杂，受最小内容宽度、width属性和min-width属性共同影响。</p></blockquote><p><strong>flex-basis属性与盒模型</strong></p><blockquote><p>flex-basis属性的尺寸是作用在content-box上的，这一点和width属性是一样的</p><p>flex子项里面的文本内容存在连续英文单词导致最小尺寸比较大，最终尺寸大于120px</p></blockquote><p><a href="https://demo.cssworld.cn/new/6/2-12.php">word-break:break-all对flex-basis尺寸渲染的影响</a></p><p><strong>理解flex-basis属性、width属性和基础尺寸之间的关系</strong></p><blockquote><p>弹性布局中的尺寸表现几乎都是围绕基础尺寸展开的。其中flex-basis属性和width属性都可以用来设置flex子项的基础尺寸，对基础尺寸的影响关系如下。</p><ul><li>如果flex-basis属性和width属性同时设置了具体的数值，width属性值会被忽略，优先使用flex-basis的属性值作为基础尺寸</li><li>如果flex-basis的属性值是初始值auto，则会使用width属性设置的长度值作为基础尺寸。</li><li>如果flex-basis和width的属性值都是auto，则会使用flex子项的最大内容宽度作为基础尺寸，此时称为“内容尺寸”。</li></ul></blockquote><h4 id="深入理解最小尺寸"><a href="#深入理解最小尺寸" class="headerlink" title="深入理解最小尺寸"></a><strong>深入理解最小尺寸</strong></h4><blockquote><p>在弹性布局中，虽然flex-basis属性和width属性的语法类似（例如百分比值的计算规则是一样的），性质也类似（例如都可以作为基础尺寸），但是如果涉及最小尺寸，两者的差异就体现出来了。</p><p>flex-basis属性下的最小尺寸是由内容决定的，而width属性下的最小尺寸是由width属性的计算值决定的。这里出现的“最小尺寸”表示最终尺寸的最小值，这个“最小尺寸”是最小内容宽度、width属性和min-width属性共同作用的结果。</p></blockquote><p>具体规则如下，如果flex-shrink属性不为0，则：</p><p>● 如果min-width属性值不是auto，则元素的最小尺寸就是min-width的属性值，此时width属性无法影响最小尺寸，哪怕width的属性值大于min-width的属性值；</p><p>● 比较width属性的计算值和最小内容宽度的大小，较小的值就是元素的最小尺寸；</p><p>● 如果width的属性值和min-width的属性值均为auto，则元素的最小尺寸就是最小内容宽度；</p><p>● 如果flex子项设置了overflow:hidden，且最小尺寸是由最小内容宽度决定的，则最小尺寸无效。</p><p><a href="https://demo.cssworld.cn/new/6/2-13.php">flex-basic、width与最小内容宽度同时作用</a></p><blockquote><p>最后总结下本节关于flex-basis属性的一些要点。</p><p>● flex-basis属性默认作用在content box上，IE11浏览器会忽略box-sizing属性。</p><p>● flex-basis属性优先级比width属性高，同时设置的时候，width属性无法影响基础尺寸，但是会影响最小尺寸（IE11除外）。</p><p>● 最小尺寸与flex-basis属性无关，而与最小内容宽度、width属性和min-width属性有关。</p><p>● flex-basis属性使用得当可以实现类似min-width属性或max-width属性的效果，min-width属性可以在不影响基础尺寸的前提下设置最小尺寸，从而解决弹性布局中打点无效的问题。</p><p>● flex-basis属性还支持很多关键字属性值，只不过目前兼容性不太好。</p></blockquote><p><a href="https://demo.cssworld.cn/new/6/2-15.php">宽度不确定时设置文字超出隐藏</a></p><p><strong>flex-basis属性还支持关键字属性值</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex-basis</span>: content | fill | max-content | min-content | fit-content;</span><br></pre></td></tr></table></figure><h4 id="弹性布局最后一行不对齐的处理"><a href="#弹性布局最后一行不对齐的处理" class="headerlink" title="弹性布局最后一行不对齐的处理"></a>弹性布局最后一行不对齐的处理</h4><ul><li><p>补齐最后一行的元素</p></li><li><p>理论上最好的方法是使用gap属性设置间隙</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="built_in">calc</span>(<span class="number">4%</span> / <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">24%</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: skyblue;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>不过由于目前仅有Firefox浏览器和Chrome浏览器最新的几个版本支持gap属性，因此目前这个方法无法应用在生产环境。</p></blockquote></li><li><p>最后一个元素设置动态margin值</p><blockquote><p>由于每一列的数目都是固定的，因此，我们可以计算出不同元素个数的列表应当设置多大的margin值才能保证完全左对齐。例如，假设每行可以存放4个元素，结果最后一行只有3个元素，如果最后一个元素的margin-right大小是“列表宽度+间隙大小”，那最后一行的3个元素也是可以完美左对齐的。</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*最后一行有3个，或者7个元素*/</span></span><br><span class="line"><span class="selector-class">.last</span><span class="selector-pseudo">:last-child</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>n -<span class="number">2</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*最后一行有2个或者6个元u怒诉*/</span></span><br><span class="line"><span class="selector-class">.last</span><span class="selector-pseudo">:last-child</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>n -<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="built_in">calc</span>(<span class="number">48%</span> + <span class="number">8%</span> / <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>如果flex<strong>子项宽度不固定</strong></p><blockquote><p>有时候，每一个flex子项的宽度都是不固定的，这个时候希望让最后一行左对齐如何实现呢？由于这种情况下间隙的大小不固定，对齐不严格，因此我们可以直接让最后一行左对齐，具体实现方法有两种。</p></blockquote><ol><li><p>给最后一项设置margin-right:auto</p></li><li><p>使用伪元素在列表的末尾创建一个flex子项，并设置flex:auto或设置flex:1</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">flex</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>如果每一行列数不固定</strong></p><blockquote><p>如果每一行的列数不固定，则上面的这些方法均不适用，需要使用其他方法来实现最后一行左对齐。</p><p>这个方法其实很简单，也很好理解，就是使用足够的空白标签进行填充占位，具体的占位数量是由最多列数的个数决定的。例如布局最多有7列，那我们可以使用7个空白标签进行填充占位；布局最多10列，那我们需要使用10个空白标签进行填充占位</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>实现该方法的关键是要将占位的&lt;i&gt;元素宽度和margin值设置得与.list列表元素一样，其他样式都不需要设置，相关CSS代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">margin-right</span>: -<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: skyblue;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">10px</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &gt; <span class="selector-tag">i</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于&lt;i&gt;元素高度为0，因此，如此设置并不会影响垂直方向上的布局呈现，最终可以实现与图6-72所示一样的效果。</p><p><strong>如果列数不固定，HTML又不能调整</strong></p><blockquote><p>有时候，由于客观原因，前端重构人员没有办法去调整HTML代码结构，同时布局的列表个数又不固定，这时候该如何实现最后一行左对齐效果呢？</p></blockquote><p>那就使用网格布局</p><h3 id="网格布局"><a href="#网格布局" class="headerlink" title="网格布局"></a>网格布局</h3><blockquote><p>给HTML元素设置display:grid或者display:inline-grid，网格布局就创建完成了！</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>4<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">div &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此时该div就是“grid容器”，其子元素被称为“grid子项”。</p><p>display:grid和display:inline-grid的区别是：inline-grid容器外部盒子保持内联特性，因此可以和图片文字在同一行显示；grid容器保持块状特性，宽度默认为100%，不和内联元素在一行显示。</p></blockquote><h4 id="grid-template-columns和grid-template-rows属性简介"><a href="#grid-template-columns和grid-template-rows属性简介" class="headerlink" title="grid-template-columns和grid-template-rows属性简介"></a><strong>grid-template-columns和grid-template-rows属性简介</strong></h4><blockquote><p>grid-template-columns和grid-template-rows属性主要用来指定网格的数量和尺寸等信息。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">80px</span> auto <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: <span class="number">25%</span> <span class="number">100px</span> auto <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>● grid-template-columns属性含3个值，表示网格分为3列，从左往右每列的尺寸分别是80px、auto（自动）和100px。</p><p>● grid-template-rows属性含4个值，表示网格分为了4行，从上往下每行的高度分别是25%、100px、auto（自动）和60px。</p></blockquote><ol><li><p>网格线的命名</p><blockquote><p>两属性语法基本一致， 以 grid-template-columns 为例，</p></blockquote> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-template-columns</span>: &lt;line-name&gt; &lt;track-size&gt;;</span><br><span class="line"><span class="comment">/* 中文示意 */</span></span><br><span class="line"><span class="attribute">grid-template-columns</span>: &lt;道路名称&gt; &lt;小区占地&gt;;</span><br></pre></td></tr></table></figure><p> ● &lt;track-size&gt;表示划分出来的小区的尺寸，可以是长度值、百分比值、fr单位（网格剩余空间比例单位）和尺寸关键字等多种类型的属性值。</p><p> ● &lt;line-name&gt;表示划分的街道的名称，命名规则和CSS动画的命名规则一样。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-template-columns</span>: [道路名称-起始] <span class="number">80px</span> [道路名称<span class="number">2</span>] auto [道路名称<span class="number">3</span>] <span class="number">100px</span> [道路名称-结束];</span><br></pre></td></tr></table></figure></li><li><p>聊聊 &lt;track-size&gt;</p><blockquote><p>grid-template-columns属性的默认值是none，可以使用grid-auto-columns属性设定网格尺寸。</p></blockquote></li></ol><p>grid-template-columns属性支持的其他值全都属于&lt;track-size&gt;数据类型，共支持9种数据类型，分别如下：</p><p>● 长度值；</p><p>● 百分比值；</p><p>● 关键字属性值，包括min-content、max-content和auto；</p><p>●&lt;flex&gt;数据类型，也就是以fr为单位的值；</p><p>● 函数值，包括repeat()、minmax()和fit-content()。</p><ol><li><p>min-content</p><p> 网格布局中的同一行grid子项的高度和同一列grid子项的宽度都是一致的，因此min-content指的并不是某一个格子的最小内容尺寸，而是一排或者一列格子中所有最小内容尺寸中最大的那个最小内容尺寸值</p></li><li><p>max-content</p><p> max-content关键字和min-content关键字类似，只是最终的尺寸是最大内容宽度中最大的那一个值。</p></li><li><p>auto</p><p> auto关键字的计算规则有些复杂，W3C规范中是这样描述的：尺寸的上限是最大内容尺寸的最大值，但是不同于max-content关键字，max-content关键字的尺寸是固定的，这里的尺寸是会受到justify-content属性和align-content属性影响的。</p><p> 另外，当多列的宽度同时设置为auto的时候，这些列的宽度并不是等分的，而是在max-content尺寸的基础上增加同样大小的尺寸。</p></li></ol><h4 id="了解网格布局专用单位fr"><a href="#了解网格布局专用单位fr" class="headerlink" title="了解网格布局专用单位fr"></a>了解网格布局专用单位fr</h4><blockquote><p>fr是单词fraction的缩写，表示分数。</p><p>是这样的，网格布局往往有多列或者多行，其中有些列有固定的宽度，有些列的宽度就由页面自动分配，而fr就表示这些自动分配列的尺寸划分比例。</p><p>fr单位值的计算规则如下。</p><p>● 如果所有fr值之和大于1，则按fr值的比例划分可自动分配尺寸。</p><p>● 如果所有fr值之和小于1，最终的尺寸是可自动分配尺寸和fr值的乘法计算值。</p></blockquote><p>和auto关键字混合使用</p><blockquote><p>如果部分列使用的是auto关键字，则fr值的计算规则就与设置auto这一列的内容密切相关。<strong>fr值的可自动分配尺寸是容器尺寸减去设置auto关键字的列的fit-content尺寸</strong></p></blockquote><h4 id="minmax-和fit-content-函数"><a href="#minmax-和fit-content-函数" class="headerlink" title="minmax()和fit-content()函数"></a>minmax()和fit-content()函数</h4><ol><li><p>minmax()函数</p><p> minmax()函数支持两个参数值，例如：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">minmax(min, max)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*正式语法如下*/</span></span><br><span class="line">minmax(<span class="selector-attr">[&lt;length&gt; | &lt;percentage&gt; | min-content | max-content | auto]</span>, <span class="selector-attr">[&lt;length&gt; | &lt;percentage&gt; | &lt;flex&gt; | min-content | max-content | auto]</span>)</span><br></pre></td></tr></table></figure><p> <strong>注意flex类型如fr为单位的值只能作为第二个值出现</strong></p></li><li><p>fit-content()函数</p><p> fit-content()函数的作用用一句话解释就是：让尺寸适应于内容，但不超过设定的尺寸。底层计算公式如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit-<span class="attribute">content</span>(limit) = max(minimum, min(limit, max-<span class="attribute">content</span>))</span><br></pre></td></tr></table></figure><p> minimum是尺寸下限，如果不考虑min-width/min-height属性，这个尺寸就是最小内容尺寸</p></li></ol><h4 id="repeat-函数"><a href="#repeat-函数" class="headerlink" title="repeat()函数"></a>repeat()函数</h4><blockquote><p>repeat()函数只能作用在grid-template-columns和grid-template -rows这两个CSS属性上。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeat(<span class="selector-attr">[&lt;positive-integer&gt;| auto-fill | auto-fit]</span>, &lt;track-list&gt;)</span><br></pre></td></tr></table></figure><ul><li><p>&lt;positive-integer&gt;，顾名思义，就是正整数的意思，表示尺寸重复的次数</p></li><li><p>auto-fill和auto-fit相当于一个变量，表示一个不确定的重复次数，究竟重复多少次，是由grid容器和每一个grid子项的尺寸计算得到的。</p><p>  一一般配合其他函数一起使用</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fill, <span class="built_in">minmax</span>(<span class="number">100px</span>, <span class="number">1</span>fr))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这就实现了无论grid容器多宽，grid子项都会等比例充满grid容器（因为设置了1fr），同时保证宽度不小于100px，网格布局的<a href="https://demo.cssworld.cn/new/6/3-1.php">列数自动计算分配的智能弹性布局效果</a>。</p><blockquote><p>当我们使用auto-fill关键字自动填充的时候，repeat()函数是不能和auto一起使用的。</p></blockquote></li><li><p>．auto-fit关键字</p><p>  auto-fit和auto-fill关键字的作用是相似的，区别在于auto-fit关键字会把空白匿名网格进行折叠合并，而这个合并的0px大小的格子可以被认为具有单个格子轨道大小调整的功能，同时，空白匿名格子两侧的过道（grid-gap设置的间隙）也会合并。</p><p>  ，auto-fit关键字把空白匿名网格连同左侧的间隙也一起合并了。这种合并设计有什么好处呢？好处就在于，如果配合fr值一起使用，可以保证<a href="https://demo.cssworld.cn/new/6/3-2.php">无论grid容器宽度多大，grid子项都可以填满grid容器</a></p></li></ul><h4 id="grid-template-areas属性"><a href="#grid-template-areas属性" class="headerlink" title="grid-template-areas属性"></a>grid-template-areas属性</h4><blockquote><p>grid-template-areas属性用来指定网格区域的划分，注意是areas，不是area，后面有个s。网格区域的划分性质和城市的行政区划分、小区的划分、农田的划分都很接近，划分网格区域可以更方便网格的管理与维护。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">grid-template-areas</span>: <span class="string">&quot;</span></span><br><span class="line"><span class="string">        &lt;gride-area-name&gt; | . | none | ...&quot;</span> </span><br><span class="line">        <span class="string">&quot;...&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>● &lt;grid-area-name&gt;表示对应网格区域的名称，命名规则和animation-name属性值一样。</p><p>●.表示空的网格单元格。</p><p>●none表示没有定义网格区域。</p><p><a href="https://demo.cssworld.cn/new/6/3-3.php">效果展示</a></p><blockquote><p>（1）如果我们给网格区域命名了，但是没有给网格线命名，则系统会自动根据网格区域名称生成网格线名称，规则是在区域名称后面加-start和-end。例如，某网格区域名称是“葡萄”，则左侧网格线名称就是“葡萄-start”，右侧网格线名称就是“葡萄-end”。</p><p>（2）网格区域一定要形成规整的矩形区域，无论是L形，还是凹的或凸的形状都会认为是无效的属性值。</p></blockquote><h4 id="缩写属性grid-template"><a href="#缩写属性grid-template" class="headerlink" title="缩写属性grid-template"></a><strong>缩写属性grid-template</strong></h4><blockquote><p>grid-template属性是grid-template-rows、grid-template-columns和grid- template-areas属性的缩写</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"><span class="attribute">grid-template</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"><span class="attribute">grid-template</span>: &lt;grid-template-rows&gt; / &lt;grid-template-columns&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"><span class="attribute">grid-template</span>: [ &lt;line-name&gt;?&lt;string&gt; &lt;track-size&gt;? &lt;line-names&gt;? ]+ [/ &lt;explicit-track-list&gt;]?;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，前两种缩写相对简单，最后一种缩写略复杂，具体如下。</p><p>（1）属性值none表示将3个CSS属性都设置为初始值none。</p><p>（2）&lt;grid-template-rows&gt; / &lt;grid-template-columns&gt;表示行尺寸或列尺寸的设置</p><p>（3）第三种缩写是包含grid-template-areas属性的语法，其中&lt;string&gt;指的就是grid-template-areas属性值，更准确地说是每一行网格的区域名称。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">grid-template</span>:</span><br><span class="line">        <span class="string">&quot;葡萄 葡萄 葡萄&quot;</span> <span class="number">1</span>fr</span><br><span class="line">        <span class="string">&quot;龙虾 养鱼 养鱼&quot;</span> <span class="number">1</span>fr</span><br><span class="line">        <span class="string">&quot;龙虾 养鱼 养鱼&quot;</span> <span class="number">1</span>fr</span><br><span class="line">        <span class="string">&quot;西瓜 西瓜 西瓜&quot;</span> <span class="number">1</span>fr</span><br><span class="line">        / <span class="number">1</span>fr <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从语法可以看出，只有&lt;string&gt;数据类型是必需的，其他数据类型都可以省略。例如&lt;track-size&gt;（也就是尺寸）可以省略（会使用auto代替计算）</p><h4 id="了解grid-auto-columns和grid-auto-rows属性"><a href="#了解grid-auto-columns和grid-auto-rows属性" class="headerlink" title="了解grid-auto-columns和grid-auto-rows属性"></a>了解grid-auto-columns和grid-auto-rows属性</h4><blockquote><p>grid-auto-columns和grid-auto-rows属性的作用是指定任何自动生成的网格（也称为隐式网格）的尺寸大小。</p><p>“<strong>隐式网格</strong>”是非正常网格，其在grid子项多于设置的单元格数量，或grid子项的位置出现在设定的网格范围之外时出现，而在规定容器内显示的网格称为“<strong>显式网格</strong>”</p><p>grid-auto-columns属性和grid-auto-rows属性就是用来控制“隐式网格”的尺寸的</p></blockquote><h4 id="grid-auto-flow属性"><a href="#grid-auto-flow属性" class="headerlink" title="grid-auto-flow属性"></a>grid-auto-flow属性</h4><blockquote><p>grid-auto-flow属性用来定义子项目元素的自动流动状态，grid-auto-flow属性在网格布局中的地位非常类似于弹性布局中的flex-direction属性。</p><p>默认值（row）</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-auto-flow</span>: [row | column] || dense</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*合法写法示例 */</span></span><br><span class="line"><span class="attribute">grid-auto-flow</span>: row;</span><br><span class="line"><span class="attribute">grid-auto-flow</span>: column;</span><br><span class="line"><span class="attribute">grid-auto-flow</span>: dense;</span><br><span class="line"><span class="attribute">grid-auto-flow</span>: row dense;</span><br><span class="line"><span class="attribute">grid-auto-flow</span>: column dense;</span><br></pre></td></tr></table></figure><ul><li>row是默认值，表示没有指定位置的网格在水平（行）方向上自然排列。</li><li>dense表示网格的自然排列启用“密集”打包算法，也就是说，如果稍后出现的网格比较小，则尝试看看其前面有没有合适的地方放置该网格，使网格尽可能排列紧凑。</li><li>column表示没有指定位置的网格在垂直（列）方向上自然排列。</li></ul><h4 id="dense关键字"><a href="#dense关键字" class="headerlink" title="dense关键字"></a>dense关键字</h4><blockquote><p>dense关键字单从字面含义是不太好理解，dense的意思是“密集的”“稠密的”“浓密的”。空网格会被后面的网格顶上去</p></blockquote><h4 id="缩写属性grid"><a href="#缩写属性grid" class="headerlink" title="缩写属性grid"></a>缩写属性grid</h4><blockquote><p>grid属性的缩写规则比较复杂。grid是这些CSS属性的缩写集合：grid-template- rows、grid-template-columns、grid-template-areas、grid-auto-rows、grid- auto-columns和grid-auto-flow。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、gird: none;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、<span class="attribute">grid</span>: &lt;grid-template&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*键字是一个只在grid缩写属性中出现的关键*/</span></span><br><span class="line"><span class="comment">/*3、auto-flow在后面*/</span></span><br><span class="line">grid: &lt;grid-template-rows&gt;/ [auto-flow &amp;&amp; dense?] &lt;grid-auto-columns&gt;?</span><br><span class="line"></span><br><span class="line"><span class="comment">/*4、auto-flow在前面*/</span></span><br><span class="line">grid:  [auto-flow &amp;&amp; dense?] &lt;grid-auto-rows&gt;？ / &lt;grid-template-columns&gt;?</span><br></pre></td></tr></table></figure><blockquote><p>梳理一下grid缩写的语法。</p><p>● grid:none很简单，没什么好说的。</p><p>● 如果没有隐式网格，且无须改变网格布局的自然流向，则使用grid-template属性。</p><p>● 最后两个语法是在出现隐式网格，或者需要改变网格布局的自然流向的时候使用，要么使用grid-template/auto-flow，要么使用auto-flow/grid-template，就这么简单。</p></blockquote><h4 id="设置属性-column-gap-和-row-gap"><a href="#设置属性-column-gap-和-row-gap" class="headerlink" title="设置属性 column-gap 和 row-gap"></a>设置属性 column-gap 和 row-gap</h4><blockquote><p>以前是使用grid-column-gap属性和grid-row-gap属性来对网格布局中各个网格之间的间隙进行设置的</p><p>随着CSS Box Alignment Module Level 3的制定，无论是分栏布局、弹性布局还是网格布局，全部统一使用column-gap属性和row-gap属性来设置。</p></blockquote><p>以column-gap属性举例，各大布局兼容性排序如下：</p><p>分栏布局 &gt; 网格布局 &gt; 弹性布局各个布局的浏览器兼容性如下。</p><p>● 分栏布局中，column-gap属性在IE10+浏览器中全兼容。</p><p>● 网格布局中，column-gap属性在Edge16+浏览器中都提供支持。</p><p>● 弹性布局中，column-gap属性目前仅有Chrome浏览器和Firefox浏览器提供不错的支持。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">column-gap</span>: &lt;line-size&gt;;</span><br><span class="line">    <span class="attribute">row-gap</span>: &lt;line-size&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 可以是长度值，也可以是百分比值 */</span></span><br><span class="line"><span class="attribute">row-gap</span>: <span class="number">20px</span>| <span class="number">1em</span> | <span class="number">3vmin</span> | <span class="number">10%</span>;</span><br></pre></td></tr></table></figure><p><strong>缩写 gap</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gap</span>: &lt;row-gap&gt; &lt;column-gap&gt;;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*缩写前*/</span></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid</span>: <span class="number">1</span>fr <span class="number">2</span>fr / <span class="number">2</span>fr <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">column-gap</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">row-gap</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid</span>: <span class="number">1</span>fr <span class="number">2</span>fr / <span class="number">2</span>fr <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="元素对齐属性-justify-items和align-items"><a href="#元素对齐属性-justify-items和align-items" class="headerlink" title="元素对齐属性 justify-items和align-items"></a>元素对齐属性 justify-items和align-items</h4><blockquote><p>在网格布局中，以-items结尾的对齐属性表示控制每一个元素在自己所在的网格中的对齐表现。justify-items属性用来定义元素在网格中的水平对齐表现，align-items属性则是用来定义元素在网格中的垂直对齐表现。</p></blockquote><ol><li><p>justify-items</p><p> 语法如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    justify-items: stretch | start | end | center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ● stretch表现为元素水平尺寸拉伸，填满整个网格的水平空间。</p><p> ● start表现为元素的水平尺寸收缩为内容大小，同时沿着网格线左侧对齐显示</p><p> ● end表现为元素的水平尺寸收缩为内容大小，同时沿着网格线右侧对齐显示</p><p> ● center表现为元素的水平尺寸收缩为内容大小，同时在当前网格区域内部水平居中对齐显示</p></li><li><p>align-items</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: normal | stretch | start | end | center | baseline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ● normal是默认值，会根据使用场景的不同表现为stretch或者start。</p><p> ● stretch表现为元素的尺寸在垂直方向进行拉伸，以填满整个网格的垂直空间。</p><p> ● start表现为元素的垂直尺寸收缩为内容大小，同时沿着上网格线对齐显示</p><p> ● end表现为元素的垂直尺寸收缩为内容大小，同时沿着下网格线对齐显示</p><p> ● center表现为元素的垂直尺寸收缩为内容大小，同时在当前网格区域内部垂直居中对齐显示</p><p> ● baseline表现为每一行的各个grid子项沿着基线对齐</p></li></ol><p><a href="https://demo.cssworld.cn/new/6/3-5.php">元素对齐效果</a></p><p><a href="https://demo.cssworld.cn/new/6/3-6.php">align-items默认值图片和按钮的样式表现</a></p><p><strong>缩写属性place-items</strong></p><blockquote><p>使用place-items属性可以让align-items和justify-items属性写在单个声明中。语法如下：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">place-items: &lt;align-items&gt; &lt;justify-items&gt;?</span><br></pre></td></tr></table></figure><blockquote><p>垂直对齐写在前面，水平对齐写在后面，不过这种缩写顺序只适合CSS对齐属性，网格布局相关属性还是行在前、列在后</p></blockquote><p><strong>整体对齐属性justify-content和align-content</strong></p><blockquote><p>justify-content属性和align-content属性分别指定了网格元素整体水平方向和垂直方向上的分布对齐方式。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">justify-content</span>: normal | stretch | start | end | center | space-between | space-around | space-evenly;</span><br><span class="line"></span><br><span class="line"><span class="attribute">align-content</span>: normal | stretch | start | end | center | space-between | space-around | space-evenly;</span><br></pre></td></tr></table></figure><p>● normal是默认值，效果和stretch一样。</p><p>● stretch可以看成justify-content属性和align-content属性的默认值，表示拉伸，表现为尺寸填满grid容器。拉伸效果需要在网格目标尺寸设为auto的时候才有效，如果固定了宽高，则无法拉伸。</p><p>● start是逻辑CSS属性值，与文档流方向相关。水平方向上默认表现为左对齐，垂直方向上默认表现为顶对齐</p><p>● end是逻辑CSS属性值，与文档流方向相关。水平方向上默认表现为右对齐，垂直方向上默认表现为底对齐</p><p>● center表现为水平居中对齐或垂直居中对齐</p><p>● space-between表现为grid子项两端对齐，中间剩余空间等分</p><p>● space-around表现为每个grid子项的上下或左右两侧都环绕互不干扰的相同尺寸的空白间距，在视觉上表现为grid子项边缘处的空白尺寸只有中间空白尺寸的一半</p><p>● space-evenly表现为每个grid子项上下或左右两侧的空白间距完全相等</p><p><a href="https://demo.cssworld.cn/new/6/3-7.php">效果预览</a></p><p><strong>缩写属性place-content</strong></p><blockquote><p>使用place-content属性可以让align-content属性和justify-content属性写在同一个CSS声明中</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">place-<span class="attribute">content</span>: &lt;align-content&gt; &lt;justify-content&gt;?</span><br></pre></td></tr></table></figure><blockquote><p>place-content属性在弹性布局中也是有效的，不过需要注意一下兼容性，IE浏览器和Edge浏览器都不支持place-content缩写。</p></blockquote><h4 id="区间范围设置属性grid-column-start-grid-column-end和grid-row-start-grid-row-end"><a href="#区间范围设置属性grid-column-start-grid-column-end和grid-row-start-grid-row-end" class="headerlink" title="区间范围设置属性grid-column-start/grid-column-end和grid-row-start/ grid-row-end"></a>区间范围设置属性grid-column-start/grid-column-end和grid-row-start/ grid-row-end</h4><blockquote><p>列范围设置属性grid-column-start/grid-column-end和行范围设置属性grid- row-start/grid-row-end是应用在grid子项上的，通过指定grid子项行和列的起止位置来表明当前grid子项所占据的范围</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column-start</span>: &lt;integer&gt; | &lt;name&gt; | &lt;integer&gt; &lt;name&gt; | span &lt;number&gt; | span &lt;name&gt; | auto;</span><br><span class="line">    <span class="attribute">grid-column-end</span>: ... ;</span><br><span class="line">    <span class="attribute">grid-row-start</span>: ... ;</span><br><span class="line">    <span class="attribute">grid-row-end</span>: ... ;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（1）&lt;integer&gt;指起止于第几条网格线，可以是负整数，但是不能是0，负整数表示从右侧开始计数网格线</p><p>（2）&lt;name&gt;是自定义的网格线的名称。需要注意的是，这里的名称有一个自动补全-start后缀和-end后缀的特性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: [A-start] <span class="number">100px</span> [A-end B-start] auto [B-end] auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column-start</span>: A;</span><br><span class="line">    <span class="attribute">grid-column-end</span>: B;</span><br><span class="line">    <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>虽然grid-column-start的值是A，但是，浏览器在找不到名称为A的网格线的时候，会自动补全-start继续寻找；同样，grid-column-end:B会依次寻找名称为B和B-end的网格线。于是.item元素区间就是从[A-start]到[B-end]，跨度是2个显式网格</p></blockquote><p>（3）&lt;integer&gt; &lt;name&gt;这个语法非常难理解，属于高阶应用，平常实践中的网格布局是用不到的。</p><blockquote><p>这个语法表示当前名称为 &lt;name&gt;的第 &lt;integer&gt;个网格线，从定义上看，网格布局中需要有很多个名称一样的网格线才能匹配对应的网格线，但如果没有这么多同样名称的网格线会怎样呢？此时，浏览器会自动创建符合数量的隐式网格，这些隐式网格的网格线都是指定的这个名称。</p></blockquote><p>（4）span &lt;number&gt;表示当前网格会自动跨越指定的网格数量。</p><p>（5）span &lt;name&gt;表示当前网格会自动扩展，直到选中指定的网格线名称。与span关键字相关的语法在后面会专门介绍。</p><p>（6）auto是默认值，表示自动，默认跨度是1个格子。</p><h4 id="span关键字的样式表现"><a href="#span关键字的样式表现" class="headerlink" title="span关键字的样式表现"></a>span关键字的样式表现</h4><blockquote><p>span关键字和传统的 &lt;table&gt;元素中单元格使用的HTML中的colspan属性和rowspan属性的作用是类似的，表示合并单元格（网格）。</p><p>span &lt;number&gt;中的 &lt;number&gt;不能是负值，也不能是0，也不能是小数。</p></blockquote><p>如果网格布局中有多个网格线的命名是B或者是B-start，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;</span><br><span class="line">display: grid;</span><br><span class="line">grid-template-columns: [B] 80px [B] auto [B] 100px [D] auto auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>则span B表示离grid-column-end位置最近的一个网格线B，而如果属性值是B而不是span B，则起始位置会是离grid-column-end位置最远的一个网格线B。</p><p><a href="https://demo.cssworld.cn/new/6/3-8.php">span和不同数量网格线命名效果</a></p><p><strong>缩写属性grid-column和grid-row</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-column</span>: &lt;grid-line&gt; [/ &lt;grid-line&gt;]?</span><br><span class="line"></span><br><span class="line">grid-row: &lt;grid-line&gt; [/ &lt;grid-line&gt;]?</span><br></pre></td></tr></table></figure><blockquote><p>其实就是使用斜杠把原始CSS属性的值原封不动地区分开，且不讲究顺序，当然，开发的时候还是建议把起始范围写在前面。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*缩写前*/</span></span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column-start</span>: <span class="number">2</span>;</span><br><span class="line">    <span class="attribute">grid-column-end</span>: span 纵线<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">grid-row-start</span>: 第一行开始;</span><br><span class="line">    <span class="attribute">grid-row-end</span>: span <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*缩写*/</span></span><br><span class="line"><span class="selector-class">.item-b</span> &#123;</span><br><span class="line">    <span class="attribute">grid-column</span>: <span class="number">2</span> / span 纵线<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">grid-row</span>: 第一行开始 / span <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="缩写属性grid-area外加区域范围设置"><a href="#缩写属性grid-area外加区域范围设置" class="headerlink" title="缩写属性grid-area外加区域范围设置"></a>缩写属性grid-area外加区域范围设置</h4><blockquote><p>grid-area是一个缩写属性，它是grid-row-start、grid-column-start、grid-row-end和grid-column-end这4个CSS属性的缩写。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-area</span>: &lt;area-name&gt; | &lt;row-start&gt; / &lt;column-start&gt; / &lt;row-end&gt;/ &lt;column-end&gt;</span><br></pre></td></tr></table></figure><p>● &lt;area-name&gt;指区域名称，由grid-template-areas属性创建。</p><p>● &lt;row-start&gt; / &lt;column-start&gt; / &lt;row-end&gt; /&lt;column-end&gt;指占据网格区域的行列起止位置。</p><p>（1）如果grid-area属性有完整的4个值，则这4个值依次表示grid-row-start、grid-column-start、grid-row-end和grid-column-end这4个属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-area</span>: <span class="number">4</span> A/ span <span class="number">4</span> / B / D</span><br></pre></td></tr></table></figure><p>（2）如果grid-area属性有3个值，也就是把grid-column-end值省略了。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-area</span>: A / B / C;</span><br></pre></td></tr></table></figure><p>（3）如果grid-area属性是2个值，说明grid-row-end值也被省略了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">grid-area</span>: A / B;</span><br><span class="line"><span class="comment">/*等同于*/</span></span><br><span class="line"><span class="attribute">grid-area</span>: A /B /A /B;</span><br><span class="line"></span><br><span class="line">gird-area: <span class="number">1</span> / <span class="number">2</span>;</span><br><span class="line"><span class="comment">/*等同于*/</span></span><br><span class="line"><span class="attribute">grid-area</span>: <span class="number">1</span> / <span class="number">2</span>/ auto/ auto;</span><br></pre></td></tr></table></figure><p>（4）如果grid-area属性仅有1个值，说明grid-column-start值也被省略了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gird-area: A;</span><br><span class="line"><span class="comment">/*等同于*/</span></span><br><span class="line">gird-area: A/A/A/A;</span><br><span class="line"></span><br><span class="line"><span class="attribute">grid-area</span>: <span class="number">2</span>;</span><br><span class="line"><span class="comment">/*等同于*/</span></span><br><span class="line">gird-area: <span class="number">2</span>/auto/auto/auto;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/6/3-9.php">grid-area与元素重叠</a></p><h4 id="grid子项对齐属性justify-self和align-self"><a href="#grid子项对齐属性justify-self和align-self" class="headerlink" title="grid子项对齐属性justify-self和align-self"></a>grid子项对齐属性justify-self和align-self</h4><blockquote><p>justify-self属性用来设置单个网格元素的水平对齐方式，align-self属性则用来设置单个网格元素的垂直对齐方式。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    justify-self: auto| noraml| stretch | start | end | center | baseline;</span><br><span class="line">    <span class="attribute">align-self</span>: ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>缩写 place-self</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">place-self: &lt;align-self&gt; &lt;justify-self&gt;;</span><br></pre></td></tr></table></figure><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>1、box 是容器</p><p>​      -display: grid /inline-grid 指定网格布局</p><p>​      -grid-template-columns 列宽 px,% 都可以</p><p>​      -grid-template-rows 行高 px,%,fr 都可以</p><p>​      -grid-row-gap  行间距</p><p>​      -grid-column-gap 列间距</p><p>​      -grid-gap 简写； eg: grid-gap: 行间距，列间距</p><p>​      -grid-template-areas 区域：将一个或多个单元格划分为一个区域</p><p>​        // 9个单元格，分为3个区域</p><p>​        grid-template-areas: ‘a a a’</p><p>​                   ‘b b b’</p><p>​                   ‘c c c’;</p><p>​        -区域的命名会影响到网格线。每个区域的起始网格线，会自动命名为区域名-start，终止网格线自动命名为区域名-end。</p><p>​      -grid-auto-flow: row, column，row dense,column dense 自动布局算法按照通过逐行填充来排列元素，在必要时增加新行</p><p>​      -justify-items 属性，项目内容水平start | end | center | stretch</p><p>​      -align-items 属性，项目内容垂直 start | end | center | stretch</p><p>​      -place-items 属性， 简写 place-items: 水平 垂直;</p><p>​      -justify-content 属性，整个内容区域在容器里面的水平位置 start | end | center | stretch | space-around | space-between | space-evenly;</p><p>​      -align-content 属性，整个内容区域在容器里面的垂直位置 start | end | center | stretch | space-around | space-between | space-evenly;</p><p>​      -place-content 属性 简写 place-content: &lt;align-content&gt; &lt;justify-content&gt;;</p><p>​      -grid-auto-columns 属性，多余网格的列宽【当网格只有3X3但指定4行2列位置时时会生成多余的网格】</p><p>​      -grid-auto-rows 属性，多余网格的行高</p><p>​      -辅助函数</p><p>​        -repeat(重复数, 值) 设置行高，列宽使用 eg: repeat(3, 100px 150px 200px) 定义了9个项目列宽行高</p><p>​        -minmax()  产生一个长度范围，表示长度就在这个范围之中。它接受两个参数，分别为最小值和最大值。</p><p>​      -关键字</p><p>​        -auto-fill 在repeat中使用，示自动填充。项目充满容器</p><p>​        -fr ，1fr 代表1倍列宽，2fr代表2倍列宽</p><p>​        -auto 由浏览器自己决定长度</p><p>​    2、box&gt;div 是项目，span不是</p><p>​    -（项目）的float、display: inline-block、display: table-cell、vertical-align和column-*等设置都将失效</p><p>​      ▣项目位置</p><p>​        -grid-column-start属性：左边框所在的垂直网格线</p><p>​        -grid-column-end属性：右边框所在的垂直网格线</p><p>​        -grid-row-start属性：上边框所在的水平网格线</p><p>​        -grid-row-end属性：下边框所在的水平网格线</p><p>​        -grid-column 属性，简写：grid-column: &lt;start-line&gt; /\ <end-line>;</p><p>​        -grid-row 属性， 简写：grid-row: &lt;start-line&gt; / &lt;end-line&gt;;</p><p>​        -grid-area 属性，指定项目放在哪一个区域。</p><p>​          .grid-area: a;// 指定项目放在a区域</p><p>​          .简写：grid-area: &lt;row-start&gt; / &lt;column-start&gt; / &lt;row-end&gt; / &lt;column-end&gt;; // grid-area: 1 / 1 / 3 / 3;</p><p>​        -justify-self 属性，置单元格内容的水平位置</p><p>​        -align-self 属性，设置单元格内容的垂直位置</p><p>​        -place-self 属性。place-self: &lt;align-self&gt; &lt;justify-self&gt;;</p><p>​      -关键字</p><p>​        -span 跨越了多少个网格</p><p>​    3、容器里面的水平区域称为”行”（row）垂直区域称为”列”（column）。</p><p>​    4、行和列的交叉区域，称为”单元格”（cell）</p><p>​      -正常情况下，n行和m列会产生n x m个单元格。比如，3行3列会产生9个单元格。</p><p>​    5、网格线”（grid line）</p><p>​      -正常情况下，n行有n + 1根水平网格线，m列有m + 1根垂直网格线，比如三行就有四根水平网格线</p><p>​      -指定网格线的名字 </p><p>​        grid-template-columns: [c1] 100px [c2] 100px [c3] auto [c4]</p><p>​        grid-template-rows: [r1 s1] 100px [r2] 100px [r3] auto [r4] // 可设置多个名字</p><p>​    </p><h3 id="CSS-Shapes布局"><a href="#CSS-Shapes布局" class="headerlink" title="CSS Shapes布局"></a>CSS Shapes布局</h3><blockquote><p>使用CSS Shapes布局可以实现不规则的图文环绕效果，它需要和float属性配合使用。</p><p>CSS Shapes布局的兼容性还是很不错的，移动端可用，企业内部使用的中后台项目也可用</p><p>与CSS Shapes布局相关的属性并不多，包括shape-outside、shape-margin和shape- image-threshold这3个CSS属性，学习成本比网格布局和弹性布局小很多。</p></blockquote><h4 id="shape-outside属性"><a href="#shape-outside属性" class="headerlink" title="shape-outside属性"></a>shape-outside属性</h4><p>shape-outside属性是shapes布局的核心，其支持的属性值分为如下4类。</p><ul><li><p>none表示默认值。</p><p>  表示普通的矩形环绕。</p></li><li><p>&lt;shape-box&gt;表示图形盒子。</p><p>  是指定文字环绕时依照哪个盒子模型的边缘来计算。</p></li><li><p>&lt;basic-shape&gt;表示基本图形函数。</p><p>  它和clip-path剪裁属性支持的基本形状函数一模一样。</p></li><li><p>&lt;image&gt;表示图像类。</p><p>  包括URL链接图像、渐变图像、cross-fade()函数图像、element ()函数图像等</p></li></ul><p><a href="https://demo.cssworld.cn/new/6/4-1.php">不同shape-outside盒子布局效果</a></p><p><strong>基本的形状函数</strong></p><blockquote><p>CSS世界中的“基本的形状函数”指的就是下面这4个形状函数，这几个形状函数在其他与形状相关的CSS属性中也是适用的，例如clip-path属性</p></blockquote><p>● circle()表示圆。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">circle(<span class="selector-attr">[&lt;shape-radius&gt;]</span>? <span class="selector-attr">[at &lt;position&gt;]</span>?)</span><br><span class="line"><span class="comment">/* 半径，圆心 */</span></span><br><span class="line">eg:</span><br><span class="line">shape-outside: <span class="built_in">circle</span>(<span class="number">50px</span> at <span class="number">50px</span> <span class="number">50px</span>)</span><br></pre></td></tr></table></figure><p>● ellipse()表示椭圆。</p><blockquote><p>&lt;shape-radius&gt;指的是水平半径和垂直半径，&lt;position&gt;指的是椭圆的圆心位置</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ellipse(<span class="selector-attr">[&lt;shape-radius&gt;&#123;2&#125;]</span>? <span class="selector-attr">[at &lt;position&gt;]</span>?)</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">shape-outside: <span class="built_in">ellipse</span>(<span class="number">50px</span> <span class="number">75px</span> at <span class="number">50%</span> <span class="number">50%</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>● inset()表示内矩形（包括圆角矩形）。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inset(&lt;shape-arg&gt;&#123;<span class="number">1</span>,<span class="number">4</span>&#125; <span class="selector-attr">[round &lt;border-radius&gt;]</span>?)</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">shape-outside: <span class="built_in">inset</span>(<span class="number">10px</span> <span class="number">20px</span> <span class="number">30px</span> <span class="number">40px</span> round <span class="number">10px</span>)</span><br></pre></td></tr></table></figure><p>● polygon()表示多边形。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">polygon(<span class="selector-attr">[&lt;fill-rule&gt;,]</span>? <span class="selector-attr">[&lt;shape-arg&gt; &lt;shape-arg&gt;]</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">shape-outside</span>: <span class="built_in">polygon</span>(<span class="number">0</span> <span class="number">0</span>, <span class="number">100px</span> <span class="number">0</span>, <span class="number">0</span> <span class="number">50px</span>, <span class="number">10px</span> <span class="number">100px</span> ,<span class="number">0</span> <span class="number">100px</span>)</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/6/4-2.php">效果展示</a></p><p><strong>图像类</strong></p><blockquote><p>这里只讲URL图像和渐变图像，因为这两种类型最常用。</p></blockquote><p><a href="https://demo.cssworld.cn/new/6/4-3.php">文字围绕鹦鹉轮廓</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.shape</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>; <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attribute">shape-outside</span>: <span class="built_in">url</span>(<span class="string">../images/bird.png</span>);</span><br><span class="line">    -webkit-<span class="attribute">mask</span>: <span class="built_in">url</span>(<span class="string">../images/bird.png</span>) no-repeat;</span><br><span class="line">    <span class="attribute">mask</span>: <span class="built_in">url</span>(<span class="string">../images/bird.png</span>) no-repeat;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#cd0000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>gradient渐变与环绕。</strong></p><blockquote><p>这里的渐变可以是线性渐变、径向渐变、锥形渐变和对应的重复渐变。</p></blockquote><p><a href="https://demo.cssworld.cn/new/6/4-4.php">效果展示</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shape &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>; <span class="attribute">height</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attr">--gradient</span>: <span class="built_in">linear-gradient</span>(to right bottom, <span class="number">#cd0000</span>, transparent <span class="number">50%</span>, transparent <span class="number">90%</span>, <span class="number">#cd0000</span>);</span><br><span class="line">    <span class="attribute">shape-outside</span>: <span class="built_in">var</span>(--gradient);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--gradient);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="shape-margin属性"><a href="#shape-margin属性" class="headerlink" title="shape-margin属性"></a><strong>shape-margin属性</strong></h4><blockquote><p>shape-margin属性很好理解，其作用就是控制文字环绕图形时文字与元素边界的距离。这个属性很有用，因为在Shapes布局中，文字环绕有时候是无视margin属性的，想要让文字和元素边界保持一定距离，多半还得用shape-margin属性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*长度单位*/</span></span><br><span class="line"><span class="attribute">shape-margin</span>: <span class="number">10px</span>;</span><br><span class="line"><span class="attribute">shape-margin</span>: <span class="number">20mm</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*百分比值*/</span></span><br><span class="line"><span class="attribute">shape-margin</span>: <span class="number">20%</span>;</span><br></pre></td></tr></table></figure><p>只支持一个值</p><p><a href="https://demo.cssworld.cn/new/6/4-5.php">效果演示</a></p><h4 id="shape-image-threshold属性"><a href="#shape-image-threshold属性" class="headerlink" title="shape-image-threshold属性"></a>shape-image-threshold属性</h4><blockquote><p>hreshold这个单词是“阈值”的意思，shape-image-threshold指图像环绕时候的半透明阈值，默认是0.0，也就是图像透明度为0的区域边界才能被文字环绕。同理，如果属性值是0.5，则表示透明度小于0.5的区域都可以被文字环绕。</p><p>就是说使用颜色渐变时透明度低的地方可以设置被文字覆盖</p></blockquote><p><a href="https://demo.cssworld.cn/new/6/4-6.php">效果展示</a></p><p><a href="https://demo.cssworld.cn/new/6/4-7.php">布局案例</a></p><h2 id="不同设备的适配与响应"><a href="#不同设备的适配与响应" class="headerlink" title="不同设备的适配与响应"></a>不同设备的适配与响应</h2><h3 id="media规则"><a href="#media规则" class="headerlink" title="@media规则"></a>@media规则</h3><blockquote><p>@media规则是用来匹配不同设备的，例如，响应式布局中常用的宽度查询与适配</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">aside</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*当前设备屏幕宽度小于 480px 的时候隐藏侧边栏*/</span></span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">480px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">aside</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="媒体查询修饰符"><a href="#媒体查询修饰符" class="headerlink" title="媒体查询修饰符"></a>媒体查询修饰符</h4><ul><li><p>only</p><p>  only修饰符很有意思，它本身并没有任何效果，将其去掉或加上，最终效果是没有任何变化的.</p><blockquote><p>为了让老旧的浏览器干脆不要识别一些新的查询语句，就设计了only修饰符，放在媒体类型的前面。这样only screen and (color)查询语句中的CSS代码就再也不会被老旧的浏览器解析了，因为这些老旧的浏览器认为only是非法的。</p></blockquote></li><li><p>not</p><p>  not否定的不是媒体类型，而是后面整个查询语句</p></li></ul><h4 id="媒体类型"><a href="#媒体类型" class="headerlink" title="媒体类型"></a>媒体类型</h4><blockquote><p>大家只需要关心screen、print和all这3个媒体类型就可以了，对于曾经支持的speech、tv等8个媒体类型，大家直接忽略即可，目前在规范中已经将它们舍弃了，浏览器也已经放弃了对它们的支持</p></blockquote><p>想要在打印的时候使页面的头部和尾部</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> print &#123;</span><br><span class="line">    <span class="selector-tag">header</span>, <span class="selector-tag">footer</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以使用逗号同时指定多个媒体类型，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen, print &#123;...&#125;</span><br></pre></td></tr></table></figure><h4 id="媒体条件"><a href="#媒体条件" class="headerlink" title="媒体条件"></a>媒体条件</h4><blockquote><p>媒体条件有3个，即not、and和or。</p></blockquote><p>not表示否定某个媒体特性，例如not (color)表示非彩色设备。</p><p>and和or则是有效且常用的，前者表示条件同时满足，后者表示满足之一即可</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 如果设备更新频率慢，或者不支持鼠标行为 */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">update</span>: slow) <span class="keyword">or</span> (<span class="attribute">hover</span>: none) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*宽度在 320px~480px,同时分辨率是150dpi的设备*/</span></span><br></pre></td></tr></table></figure><h4 id="媒体特性"><a href="#媒体特性" class="headerlink" title="媒体特性"></a>媒体特性</h4><blockquote><p>媒体特性指的是对媒体特性的描述信息，包括浏览器、用户设备和使用环境等特性。</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/epub_40870013_665" alt="img"></p><blockquote><p>媒体特性虽然多，但大多数媒体特性都不实用，只有width和height媒体特性，以及宽高比和屏幕分辨率等媒体特性比较实用，</p></blockquote><h4 id="对深色模式和动画关闭的支持检测"><a href="#对深色模式和动画关闭的支持检测" class="headerlink" title="对深色模式和动画关闭的支持检测"></a>对深色模式和动画关闭的支持检测</h4><ol><li><p>prefers-color-scheme</p><blockquote><p>prefers-color-scheme媒体特性可以用来检测当前网页是否处于深色模式（或称黑暗模式）中，其支持的参数值如下。</p><p>● no-preference表示系统没有告知用户使用的颜色方案。</p><p>● light表示系统倾向于使用浅色模式。</p><p>● dark表示系统倾向于使用深色模式。</p><p>除该媒体特性的兼容性非常好之外，更重要的原因是这个媒体特性非常实用</p><p>以后的Web产品支持深浅两种主题是大概率事件，尤其是用户群广泛的产品，届时，必定会大规模使用prefers-color-scheme。</p></blockquote> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*深色模式*/</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>: dark) &#123;</span><br><span class="line">    <span class="selector-tag">body</span> &#123;<span class="attribute">background</span>: <span class="number">#333</span>; <span class="attribute">color</span>: white&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*浅色模式*/</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>: light) &#123;</span><br><span class="line">    <span class="selector-tag">body</span> &#123;<span class="attribute">background</span>: <span class="number">#333</span>; <span class="attribute">color</span>: white&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> js中判断是否支持深色模式</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&quot;(prefers-color-scheme: dark)&quot;</span>).<span class="property">matches</span>;</span><br></pre></td></tr></table></figure><p> prefers-color-scheme是CSS世界中被迅速支持的媒体特性之一，目前所有现代浏览器均支持此媒体特性，读者可以完全放心大胆地使用。</p><p> <a href="https://demo.cssworld.cn/new/7/1-1.php">对网页快速改造深色模式的技巧</a></p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>: dark) &#123;</span><br><span class="line">    <span class="selector-tag">body</span> &#123; </span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">invert</span>(<span class="number">1</span>) <span class="built_in">hue-rotate</span>(<span class="number">180deg</span>);</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">img</span> &#123;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">invert</span>(<span class="number">1</span>) <span class="built_in">hue-rotate</span>(<span class="number">180deg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">p</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&quot;深色&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>不过，需要提醒一下大家，filter:invert(1)这种“偷懒”的技巧只适合用于不太重要的页面。根据我的实际开发经验，filter滤镜在Safari浏览器中会带来潜在的渲染问题。</p></blockquote></li><li><p>prefers-reduced-motion</p><blockquote><p>prefers-reduced-motion媒体特性的兼容性和prefers-color-scheme是一样的，毕竟属于体验增强特性，大家可以无顾虑地使用。</p><p>prefers-reduced-motion用来检测操作系统是否设置了关闭不必要动画的操作，其支持的参数值如下。</p><p>● no-preference表示用户没有通知系统任何首选项。</p><p>● reduced表示用户已通知系统</p></blockquote><p> 几乎所有操作系统都有对应的关闭不必要动画的首选项，具体设置方式如下。</p><p> ● Windows 10：设置→轻松使用→在Windows中显示动画。</p><p> ● Windows 7：控制面板→轻松访问→使计算机更易于查看→关闭所有不必要的动画（如果可能）。</p><p> ● macOS：系统偏好→辅助使用→显示器→渐弱动态效果。</p><p> ● iOS：设置→通用→辅助功能→渐弱动态效果。</p><p> ● Android 9+：设置→辅助功能→移除动画（或者高级视觉效果）。</p><p> 根据我查到的一些信息，关闭操作系统动画的用户并不少，尤其是对用户基数很大的产品而言。</p><p> 如果用户选择了关闭动画，那么我们要让Web应用中的动画同步关闭。例如，弹框出现就不需要有弹一下的动画效果，评论框也不需要从下方出现，直接让评论框显示出来就可以。CSS代码示意如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-reduced-motion</span>) &#123;</span><br><span class="line">    <span class="selector-class">.example-1</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.example-2</span> &#123;</span><br><span class="line">        <span class="attribute">transition</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*甚至可以*/</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-reduced-motion</span>) &#123;</span><br><span class="line">    * &#123;</span><br><span class="line">        <span class="attribute">animation</span>: none;</span><br><span class="line">        <span class="attribute">transition</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;pointer和any-pointer</span><br></pre></td></tr></table></figure></li></ol><h4 id="对鼠标行为和触摸行为的支持检测"><a href="#对鼠标行为和触摸行为的支持检测" class="headerlink" title="对鼠标行为和触摸行为的支持检测"></a>对鼠标行为和触摸行为的支持检测</h4><blockquote><p>:hover伪类在移动端，尤其在iOS的Safari浏览器中的交互会很奇怪，可以触发但是不容易触发，而且触发后的hover状态不太容易消除，体验并不好</p><p>用设备宽度解决，又会有手机横屏等问题。仅通过屏幕宽度判断是不是触屏设备是非常片面和不准确的</p><p>完美的CSS解决方法就是CSS世界新出现的支持检测鼠标行为和触摸行为的媒体特性。</p></blockquote><ol><li><p>any-hover</p><blockquote><p>any-hover媒体特性可用于测试是否有任意可用的输入装置可以悬停（就是hover行为）在元素上。例如，鼠标这个输入装置就可以控制鼠标指针的位置，以及悬停在元素上。因此，下个不太严谨的结论，any-hover其实就是用来检测设备是否接入了鼠标的。</p></blockquote><p> ● none表示没有输入装置可以实现悬停效果，或者没有可以实现指向的输入装置。</p><p> ● hover表示一个或多个输入装置可以触发元素的悬停交互效果。</p><p> 希望&lt;figcaption&gt;元素在不支持悬停效果的设备上显示：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">figure</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">any-hover</span>: none) &#123;</span><br><span class="line">    <span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <a href="https://demo.cssworld.cn/new/7/1-2.php">效果展示</a></p><blockquote><p>该媒体特性在CSS新特性中算是兼容性不错的，考虑到any-hover媒体特性的作用是体验增强，因此在生产环境中大可放心使用，无须顾虑陈旧设备。</p></blockquote></li><li><p>hover</p><blockquote><p>hover媒体特性的语法和作用与any-hover是一样的，两者的主要区别在于，any-hover检测任意输入装置，而hover只检测主要的输入装置。</p></blockquote><p> ● none表示主输入装置根本无法悬停或无法方便地悬停（例如，使用长点击来模拟悬停，而长点击这种交互并不方便），或者没有主输入装置。</p><p> ● hover表示主输入装置可以触发元素的悬停交互。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">figure</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">hover</span>: none) &#123;</span><br><span class="line">    <span class="selector-tag">figcaption</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>hover媒体特性的兼容性更好，且从Edge12+就开始支持hover了，因此，如果是针对传统桌面端网页的体验优化，可以优先使用hover媒体特性。</p></blockquote></li><li><p>pointer和any-pointer</p><blockquote><p>pointer是与点击事件相关的。pointer和any-pointer媒体特性主要用于识别当前环境，判断是否可以非常方便地进行点击操作。</p></blockquote><p> any-pointer支持3个属性值，含义分别如下。</p><p> ● none表示没有可用的点击设备。</p><p> ● coarse表示至少有一个设备的点击不是很精确。例如，使用手指操作手机就属于点击不精确。</p><p> ● fine表示有点击很精准的设备。例如，用鼠标操作的计算机浏览器。</p><p> <a href="https://demo.cssworld.cn/new/7/1-3.php">点击不精准情况下增大选框范围</a>：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">pointer</span>: coarse) &#123;</span><br><span class="line">    <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;checkbox&quot;</span>]</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="环境变量函数env"><a href="#环境变量函数env" class="headerlink" title="环境变量函数env()"></a>环境变量函数env()</h3><blockquote><p>环境变量函数env()规范的制定和兴起是由于iPhone X这类带有“刘海屏”和底部触摸条的移动设备的出现，如果按钮和底部触摸条在一起显示，就会出现交互冲突的问题，而env()函数可以让网页内容显示在设备的安全区域范围</p><p>通过使用env()函数，很多原本需要特殊权限才可以访问的信息就可以作为全局变量在整个页面文档中使用。只是，虽然env()函数的规划很长远，但是由于目前规范还只停留在第一阶段的草案阶段，内容很少，因此目前可以在实践中应用的就只有设置安全边距。</p><p>env()函数的语法和var()函数的语法很相似，它们的区别在于，env()函数可以用在媒体查询语句中，甚至用在选择器中，但var()函数只能作为属性值或作为属性值的一部分。</p><p>或者说，凡是可以使用var()函数的地方一定可以使用env()函数，但是反过来却不成立。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 直接使用4个安全内边距值 */</span></span><br><span class="line">env(safe-area-inset-<span class="attribute">top</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">right</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">bottom</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">left</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用4个安全内边距值，同时设置兜底尺寸值 */</span></span><br><span class="line">env(safe-area-inset-<span class="attribute">top</span>, <span class="number">20px</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">right</span>, <span class="number">1em</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">bottom</span>, <span class="number">0.5vh</span>);</span><br><span class="line">env(safe-area-inset-<span class="attribute">left</span>, <span class="number">1.4rem</span>);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/epub_40870013_673" alt="img"></p><p>（1）和通常的CSS属性不同，env()函数中的属性是区分大小写的，因此，下面CSS代码中的padding-left值一定是50px：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">padding-left</span>: <span class="built_in">env</span>(SAVE-AREA-INSET-LEFT, <span class="number">50px</span>);</span><br></pre></td></tr></table></figure><p>SAFE-AREA-INSET-LEFT是无法识别的属性，因此，会使用兜底的50px作为padding- left的属性值。</p><p>（2）要想使safe-area-inset-*属性表现出准确的间距，一定要确保viewport相关的&lt;meta&gt;信息如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=&quot;viewport&quot; <span class="attribute">content</span>=&quot;viewport-fit=cover&quot;&gt;</span><br></pre></td></tr></table></figure><h3 id="rem和vw单位与移动端适配最佳实践"><a href="#rem和vw单位与移动端适配最佳实践" class="headerlink" title="rem和vw单位与移动端适配最佳实践"></a>rem和vw单位与移动端适配最佳实践</h3><p>让不同宽度设备下网页字体合适，动态设置字体大小</p><ol><li>使用媒体查询设置 html font-size(根字体)</li><li>使用js根据屏幕尺寸设置对应的根字号大小</li></ol><p>第一种做法对于非临界点尺寸的设备很不友好</p><p>第二种做法的优点在于任何宽度的手机都有对应的根字号设置，但是缺点很多,原罪布局用了Js，根字体会线性放大，后期改动适配策略，代价巨大</p><p><strong>了解视区相对单位</strong></p><p>视区相对单位指的是相对于浏览器视区尺寸（viewport）的单位，具体包括下面4个。</p><p>● vw——视区宽度百分值。</p><p>● vh——视区高度百分值。</p><p>● vmin——vw或vh，取小的那个值。</p><p>● vmax——vw或vh，取大的那个值。</p><p><a href="">vh单位的经典应用</a></p><p><strong>calc()函数下的最佳实践</strong></p><blockquote><p>有了vw单位，再配合calc()函数进行计算，无须使用任何JavaScript代码，我们就可以实现基于设备宽度的移动端布局适配方案</p></blockquote><p>例如，希望375px～414px的宽度区间的根字号大小是16px～18px，就可以这么设置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">375px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        375px宽度使用16px基准尺寸，414px宽度时根字体大小正好18px</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">16px</span> + <span class="number">2</span> * (<span class="number">100vw</span>-<span class="number">375px</span>) / <span class="number">39</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">414px</span>) &#123;</span><br><span class="line">    <span class="selector-tag">html</span> &#123;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>clamp语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">clamp</span>(<span class="number">16px</span>, <span class="built_in">calc</span>(<span class="number">16px</span> + <span class="number">2</span> * (<span class="number">100vw</span> - <span class="number">375px</span>) / <span class="number">39</span>), <span class="number">22px</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>rem单位不是万能的</strong></p><p>首先渲染尺寸并不总是整数,可能出现一些渲染问题，某些场景下可以把 rem改成 px 单位</p><h3 id="使用touch-action属性控制设备的触摸行为"><a href="#使用touch-action属性控制设备的触摸行为" class="headerlink" title="使用touch-action属性控制设备的触摸行为"></a>使用touch-action属性控制设备的触摸行为</h3><blockquote><p>touch-action属性是移动端中与手势触摸密切相关的CSS属性，它源自Windows Phone手机，属于微软系，后来被Chrome浏览器吸收借鉴，Firefox浏览器跟着支持，现在Safari浏览器也已经完全支持（iOS 13之前是部分支持），是一个在移动端可以畅行的CSS属性。</p></blockquote><h4 id="常见应用"><a href="#常见应用" class="headerlink" title="常见应用"></a>常见应用</h4><ol><li><p>touch-action:manipulation取消300ms的点击延时</p><blockquote><p>touch-action:manipulation表示浏览器只允许进行滚动和持续缩放操作，所以类似双击缩放这种非标准操作就不被允许。想当初，之所以click事件在移动端有300 ms延时，就是因为要避免点击行为和手机双击行为发生冲突。于是，当我们设置touch-action:manipulation时，取消了双击行为，300 ms延时也就不复存在了。</p></blockquote> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">touch-action: manipulation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>touch-action:none解决treated as passive错误</p><p> 如下js移动端模式下滑页面报错:</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p> css解决方式：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    touch-action: none;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    touch-action: auto;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <a href="https://demo.cssworld.cn/new/7/4-1.php">移动端查看效果</a></p><p> 不过，此方法改变了默认的滚动行为，比较适合原本就需要对默认滚动行为进行重置的单页，而对于传统的网页，建议还是使用JavaScript，通过传递passive:false参数设置来解决这个问题</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, <span class="keyword">function</span>(<span class="params">even</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;, &#123;<span class="attr">passive</span>: <span class="literal">false</span>&#125;)</span><br></pre></td></tr></table></figure></li></ol><h4 id="了解touch-action属性各个属性值的含义"><a href="#了解touch-action属性各个属性值的含义" class="headerlink" title="了解touch-action属性各个属性值的含义"></a>了解touch-action属性各个属性值的含义</h4><p>ouch-action属性支持的属性值有：</p><p>● auto是默认值，表示手势操作完全由浏览器决定（如&lt;meta&gt;元素的viewport属性通过设置user-scalable=no/yes来确定是否允许缩放）。</p><p>● manipulation表示浏览器只允许进行滚动和持续缩放操作，类似双击缩放这种非标准操作就不可以。此属性值可以用来解决点击后延时300ms的问题。iOS 9.3就已经支持该值。</p><p>● none表示不进行任何手势相关的行为，例如，你想用手指滚动网页就不行，双击放大或缩小页面也不可以，所有这些行为都要自定义。另外，从这个属性值开始，一直到最后一个属性值pinch-zoom，都是iOS 13才开始支持的。</p><p>● pan-x表示支持手指头水平移来移去的操作。</p><p>● pan-y表示支持手指头垂直移来移去的操作。</p><p>● pan-left表示支持手指头往左移动，移动开始后往右可以恢复的操作。</p><p>● pan-right表示支持手指头往右移动，移动开始后往左可以恢复的操作。</p><p>● pan-up表示支持手指头往上移动，移动开始后往下可以恢复的操作。</p><p>● pan-down表示支持手指头往下移动，移动开始后往上可以恢复的操作。</p><p>● pinch-zoom表示支持手指头缩放页面的操作。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">touch-action: pan-left pan-up pan-zoom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>表示可以左移、上移和缩放。这些关键字属性值适合用在需要自定义手势行为的场景下，虽不常用，但很实用。</p><h4 id="image-set-函数与多倍图设置"><a href="#image-set-函数与多倍图设置" class="headerlink" title="image-set()函数与多倍图设置"></a>image-set()函数与多倍图设置</h4><blockquote><p>image-set()函数的性质与element()函数、cross-fade()函数的性质是一样的，它们都属于&lt;image&gt;数据类型，不过就实用性而言，image-set()函数明显高了不只一个级别</p></blockquote><p>image-set()函数可以根据不同设备的屏幕密度或者分辨率来显示不同的背景图（background- image）或者遮罩图片（mask-image）等</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">image-set</span>(<span class="built_in">url</span>(<span class="string">1.jpg</span>) <span class="number">1</span>x, <span class="built_in">url</span>(<span class="string">2.jpg</span>) <span class="number">2</span>x, <span class="built_in">url</span>(<span class="string">1-print.jpg</span>) <span class="number">600dpi</span>,)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果屏幕是1倍屏，也就是设备像素比是1∶1的话，就使用1.jpg作为背景图；如果屏幕是2倍屏及以上，就使用1-2x.jpg作为背景图；如果设备的分辨率大于600dpi，就使用1-print.jpg作为背景图。</p><blockquote><p>注意，图片地址需要写在url()函数里，url()函数中不用添加引号</p></blockquote><p>HTML中有一个名为srcset的属性，这个属性与image-set()函数无论是名称还是语法都有相似之处，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">srcset</span>=<span class="string">&quot;1-2x.png 2x&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/7/5-1.php">效果展示</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.image-set</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">128px</span>; <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./fallback.jpg</span>);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">-webkit-image-set</span>(</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w128.jpg</span>) <span class="number">1</span>x, </span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w256.jpg</span>) <span class="number">2</span>x, </span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w512.jpg</span>) <span class="number">3</span>x);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">image-set</span>(</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w128.jpg</span>) <span class="number">1</span>x, </span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w256.jpg</span>) <span class="number">2</span>x, </span><br><span class="line">        <span class="built_in">url</span>(<span class="string">w512.jpg</span>) <span class="number">3</span>x);</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.zhangxinxu.com/wordpress/2014/10/responsive-images-srcset-size-w-descriptor/">了解更多</a></p><blockquote><p>即便在桌面端浏览器中，image-set()函数也可以放心使用，不用担心会影响内容的呈现，因为它是一个渐进增强特性。实际开发时，在image-set()语句之前加一行background:url();语句兜底就可以了，这样就算浏览器不支持image-set()函数，界面样式依然表现良好。</p></blockquote><p>虽然image-set()函数的设计初衷是好的，但是实用性很一般，因为在实际开发中往往会设置直接加载2倍图，1倍图是不加载的。这样做一是因为现在流量便宜，二是因为无须准备多张不同尺寸的图片，可以减少开发和维护成本。</p><p>只有下面两种情况才需要用到image-set()函数。</p><p>（1）不同屏幕密度下显示的是完全不同的图，而不是只有尺寸不一样的图。例如，在1倍屏下显示造型简单的图标，在多倍屏下显示细节丰富的图标。</p><p>（2）用户体验和流量收益足够明显的场景。例如类似WeChat这种用户基数很大的产品；或者给流量费用较高、信号较差的地区开发的产品。</p><h2 id="CSS的变量函数var-与自定义属性"><a href="#CSS的变量函数var-与自定义属性" class="headerlink" title="CSS的变量函数var()与自定义属性"></a>CSS的变量函数var()与自定义属性</h2><h3 id="CSS变量的语法、特性和细节"><a href="#CSS变量的语法、特性和细节" class="headerlink" title="CSS变量的语法、特性和细节"></a>CSS变量的语法、特性和细节</h3><blockquote><p>CSS变量的语法由两部分组成，一部分是CSS变量的声明，另一部分是CSS变量的使用。其中，CSS变量的声明由CSS自定义属性及其对应的值组成，而CSS变量的使用则通过变量函数var()调用CSS自定义属性实现。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attr">--primary-color</span>: deepskyblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">val</span>(--primary-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CSS自定义属性的命名"><a href="#CSS自定义属性的命名" class="headerlink" title="CSS自定义属性的命名"></a>CSS自定义属性的命名</h4><blockquote><p>CSS自定义属性时，支持数字命名的,中文等CJK文字也是可以随意使用的</p><p>虽然CSS自定义属性的命名限制较少，但是还是不支持包含$、[、]、^、(、)、%、”等特殊字符的命名，要使用这些特殊字符，需要使用反斜杠转义。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    --\$: deepskyblue;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--\$)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="var-函数的语法和特性"><a href="#var-函数的语法和特性" class="headerlink" title="var()函数的语法和特性"></a>var()函数的语法和特性</h4><blockquote><p>其中，&lt;custom-property-name&gt;指的就是自定义属性名；&lt;declaration-value&gt;指的是声明值，可以理解为备选值或缺省值，当前面的自定义属性一定无效时，就会使用\declaration- value&gt;定义的值。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span>( &lt;custom-property-name&gt; <span class="selector-attr">[, &lt;declaration-value&gt;]</span>? )</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--any-what, deepskyblue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>参数非法的有趣现象</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attr">--color</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: deeppink;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--color, deepskyblue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请问，此时 body 元素背景色是什么？</p><p>A. transarent    B.20px    C.deeppink    D.deepskyblue</p><blockquote><p>这是var()函数非常有意思的一点：只要第一个参数值可能有效，哪怕这个参数值是一个乱七八糟的东西，这个var()函数依然会正常解析。下面重点来了：如果第一个参数值是不合法的，则var()函数解析为当前CSS属性的初始值或继承值（如果有继承性），也就是按照unset全局关键字的规则渲染。（注意，只是渲染规则类似，并不等同于直接设置unset关键字。）</p></blockquote><p>上面的案例中的background-color属性值显然不能是20px，因为背景色的值是颜色值，不能是长度值，20px显然是不合法的，所以会使用background-color的初始值transparent代替, <strong>所以正确答案是 A</strong></p><p><a href="https://demo.cssworld.cn/new/8/1-1.php">利用初始值默认值设置点击效果</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="comment">/* 这里的空格很重要 */</span></span><br><span class="line">    <span class="attr">--open</span>: ;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#2a80eb</span>;</span><br><span class="line">    -webkit-text-fill-<span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">9px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--open, <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">1</span>));</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--open, inset <span class="number">0</span> <span class="number">1px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">1</span>));</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--open, <span class="built_in">linear-gradient</span>(<span class="number">#0003</span>, transparent)) currentColor;</span><br><span class="line">    <span class="attribute">text-shadow</span>: <span class="built_in">var</span>(--open, -<span class="number">1px</span> -<span class="number">1px</span> <span class="number">#0003</span>);</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">15s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">    <span class="comment">/* 任意全局关键字都可以 */</span></span><br><span class="line">    <span class="attr">--open</span>: inherit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>利用这种特性让CSS变量同时开启和关闭一个或多个不同的属性值，从而让CSS代码更加简洁</p><p>空格在语法上是可能有效的。但是空格对于box-shadow和background等CSS属性是无效的，因此，box-shadow和background等CSS属性均解析为初始值</p></blockquote><h4 id="var-函数的空格尾随特性"><a href="#var-函数的空格尾随特性" class="headerlink" title="var()函数的空格尾随特性"></a>var()函数的空格尾随特性</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hmtl &#123; <span class="attribute">font-size</span>: <span class="number">14px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attr">--size</span>: <span class="number">20</span> ;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--size)px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请问， 此时 body 元素的font-size 大小是多少？</p><p>A.medium    B.14px    C.16px    D.20px</p><blockquote><p>此处font-size:var(–size)px等同于font-size:20px，注意，20后面有一个空格，这属于不合法的font-size属性值。由于语法上var(–size)px又是合法的，因此会重置font-size:16px，最终使用父元素设置的字号大小14px。</p><p><strong>所以答案是B</strong></p></blockquote><h4 id="CSS自定义属性的作用域"><a href="#CSS自定义属性的作用域" class="headerlink" title="CSS自定义属性的作用域"></a>CSS自定义属性的作用域</h4><blockquote><p>全局作用域是 root ,其他作用域跟css 父子层级类似。div 中定义的变量在body 上使用无效果，反之则有效果。<strong>本质上是继承特性， <a href="https://demo.cssworld.cn/new/8/1-2.php">Shadow DOM中的元素也能继承</a></strong></p></blockquote><h4 id="CSS自定义属性值可以是任意值或表达式"><a href="#CSS自定义属性值可以是任意值或表达式" class="headerlink" title="CSS自定义属性值可以是任意值或表达式"></a><a href="https://weread.qq.com/web/reader/13c32c90726fa07d13c0072k9a132c802349a1158154a83">CSS自定义属性值可以是任意值或表达式</a></h4><h4 id="CSS自定义属性值可以相互传递"><a href="#CSS自定义属性值可以相互传递" class="headerlink" title="CSS自定义属性值可以相互传递"></a>CSS自定义属性值可以相互传递</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attr">--green</span>: <span class="number">#4caf50</span>;</span><br><span class="line">    <span class="attr">--successColor</span>: <span class="built_in">var</span>(--green);</span><br><span class="line">    <span class="attr">--columns</span>: <span class="number">4</span>;</span><br><span class="line">    <span class="attr">--margins</span>: <span class="built_in">calc</span>(<span class="number">24px</span> / <span class="built_in">var</span>(--columns));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CSS自定义属性不能自身赋值"><a href="#CSS自定义属性不能自身赋值" class="headerlink" title="CSS自定义属性不能自身赋值"></a>CSS自定义属性不能自身赋值</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attr">--primary-color</span>: deepskyblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.some-class</span> &#123;</span><br><span class="line">    <span class="attr">--primary-color</span>: <span class="built_in">var</span>(primary-color, <span class="number">#2a80eb</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     --primary-color 会被认为是非法的，color的颜色为当前上下文的颜色</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>( --primary-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CSS自定义属性不支持用在媒体查询中"><a href="#CSS自定义属性不支持用在媒体查询中" class="headerlink" title="CSS自定义属性不支持用在媒体查询中"></a>CSS自定义属性不支持用在媒体查询中</h4><blockquote><p>在 @media() 中无法使用，但是可以使用 evn()函数</p></blockquote><h3 id="在-页面中设置获取变量"><a href="#在-页面中设置获取变量" class="headerlink" title="在 页面中设置获取变量"></a>在 页面中设置获取变量</h3><p>html:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border 10px solid var(--color);&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">box.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--color&#x27;</span>, <span class="string">&#x27;deepskyblue&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>普通属性可以通过style.xxx = x 设置，但是自定义属性智能通过 setProperty属性设置。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 --color CSS变量</span></span><br><span class="line"><span class="keyword">var</span> cssVarColor = <span class="title function_">getComputedStyle</span>(box).<span class="title function_">getPropertyValue</span>(<span class="string">&#x27;--color&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="使用content属性显示CSS自定义属性值的技巧"><a href="#使用content属性显示CSS自定义属性值的技巧" class="headerlink" title="使用content属性显示CSS自定义属性值的技巧"></a>使用content属性显示CSS自定义属性值的技巧</h3><blockquote><p>有时候需要让CSS变量中的自定义属性值能够同时作为字符内容在页面中呈现。我们很快就会想到使用::before和::after伪元素配合content属性来实现，但是，把CSS自定义属性值作为content属性值是没有任何效果的。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 无效 */</span></span><br><span class="line"><span class="selector-class">.bar</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">var</span>(--percent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>借助CSS计数器呈现CSS自定义属性值</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 有效 */</span></span><br><span class="line"><span class="selector-class">.bar</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">counter-reset</span>: progress <span class="built_in">var</span>(--percent);</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">var</span>(progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>虽然content属性本身不支持CSS自定义属性值，但是counter-reset属性后面的计数器初始值是支持的，于是我们可以来一招“移花接木”，从而让CSS自定义属性值作为字符在页面中显示。</p></blockquote><p><a href="https://demo.cssworld.cn/new/8/3-1.php">css自定义属性实现上传进度条</a></p><blockquote><p>如果希望兼容陈旧的设备，可以试试GitHub站点上一个名为css-vars-ponyfill的项目，其可以让CSS变量兼容到IE9+</p></blockquote><h3 id="使用CSS变量自定义全新的CSS语法"><a href="#使用CSS变量自定义全新的CSS语法" class="headerlink" title="使用CSS变量自定义全新的CSS语法"></a>使用CSS变量自定义全新的CSS语法</h3><blockquote><p>虽然目前CSS Color Level 4支持非常多的颜色写法，但是唯独不支持颜色关键字的半透明效果。所以我就会思考这样一个问题：有没有可能自创一个CSS函数语法，实现颜色关键字的半透明效果？</p></blockquote><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">color</span>: <span class="built_in">keyword</span>(red, <span class="number">50%</span>)</span><br><span class="line">color: <span class="built_in">keyword</span>(red, <span class="number">0.5</span>)</span><br><span class="line">color: <span class="built_in">keyword</span>(red / <span class="number">50%</span>)</span><br><span class="line">color: <span class="built_in">keyword</span>(red / <span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><blockquote><p>直接这样写的话浏览器认为是不合法</p><p>CSS自定义属性作为信使使整个语法合法化</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attr">--keyword</span>: <span class="built_in">keyword</span>(red, <span class="number">50%</span>); // 合法</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--keyword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>JavaScript获取使用了keyword()函数的元素，再将其转换成浏览器可识别的颜色函数</p><p>（1）获取页面中所有包含keyword()函数的自定义属性。</p><p>（2）遍历并观察所有DOM，如果设置了对应的自定义属性，则将keyword()函数语法转换成浏览器能够识别的rgba()函数语法。</p><p><a href="https://demo.cssworld.cn/new/8/4-1.php">效果展示</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> CSS 自定义的keyword()方法的支持和使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhangxinxu(.com) 2020-08-11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@docs</span> https://www.zhangxinxu.com/wordpress/?p=9537</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@license</span> MIT 作者和出处保留</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">CSS</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">NodeList</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span>) &#123;</span><br><span class="line">        <span class="title class_">NodeList</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span> = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取页面中所有的CSS自定义属性</span></span><br><span class="line">    <span class="keyword">var</span> isSameDomain = <span class="keyword">function</span> (<span class="params">styleSheet</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!styleSheet.<span class="property">href</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> styleSheet.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">origin</span>) === <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> isStyleRule = <span class="keyword">function</span> (<span class="params">rule</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> rule.<span class="property">type</span> === <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arrCSSCustomProps = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">document</span>.<span class="property">styleSheets</span>).<span class="title function_">filter</span>(isSameDomain).<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">finalArr, sheet</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> finalArr.<span class="title function_">concat</span>([].<span class="property">slice</span>.<span class="title function_">call</span>(sheet.<span class="property">cssRules</span>).<span class="title function_">filter</span>(isStyleRule).<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">propValArr, rule</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> props = [].<span class="property">slice</span>.<span class="title function_">call</span>(rule.<span class="property">style</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">propName</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> [</span><br><span class="line">                        propName.<span class="title function_">trim</span>(),</span><br><span class="line">                        rule.<span class="property">style</span>.<span class="title function_">getPropertyValue</span>(propName).<span class="title function_">trim</span>()</span><br><span class="line">                    ];</span><br><span class="line">                &#125;).<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">[propName]</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> propName.<span class="title function_">indexOf</span>(<span class="string">&#x27;--&#x27;</span>) === <span class="number">0</span>;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> [].<span class="title function_">concat</span>(propValArr, props);</span><br><span class="line">            &#125;, []));</span><br><span class="line">        &#125;, []);</span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用了keyword()语法的CSS自定义属性名</span></span><br><span class="line">    <span class="keyword">var</span> arrCssPropsValueIsKeyword = arrCSSCustomProps.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">arrPropVal</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="regexp">/keyword\([\w\W]+\)/i</span>.<span class="title function_">test</span>(arrPropVal[<span class="number">1</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置自定义属性值的方法</span></span><br><span class="line">    <span class="keyword">var</span> funKeywordColor2Rgba = <span class="keyword">function</span> (<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> != <span class="number">1</span> || [<span class="string">&#x27;script&#x27;</span>, <span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;meta&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;head&#x27;</span>].<span class="title function_">includes</span>(node.<span class="property">nodeName</span>.<span class="title function_">toLowerCase</span>())) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当前节点的所有样式对象</span></span><br><span class="line">        <span class="keyword">var</span> objStyle = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(node);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所有设置了keyword()的自定义属性的遍历处理</span></span><br><span class="line">        arrCssPropsValueIsKeyword.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">arr</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> cssProp = arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断当前元素是否设置了当前自定义属性</span></span><br><span class="line">            <span class="keyword">var</span> cssVarValueKeyword = objStyle.<span class="title function_">getPropertyValue</span>(cssProp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!cssVarValueKeyword || !cssVarValueKeyword.<span class="title function_">trim</span>() || !<span class="regexp">/keyword\([\w\W]+\)/i</span>.<span class="title function_">test</span>(cssVarValueKeyword)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cssVarValueKeyword = arr[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 解析与处理</span></span><br><span class="line">            <span class="keyword">var</span> keyColorAndOpacity = cssVarValueKeyword.<span class="title function_">replace</span>(<span class="regexp">/\w+\(([\w\W]+)\)/</span>, <span class="string">&#x27;$1&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> arrKeyColorAndOpacity = keyColorAndOpacity.<span class="title function_">split</span>(<span class="regexp">/\s+/</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="regexp">/,/</span>.<span class="title function_">test</span>(keyColorAndOpacity)) &#123;</span><br><span class="line">                arrKeyColorAndOpacity = keyColorAndOpacity.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\//</span>.<span class="title function_">test</span>(keyColorAndOpacity)) &#123;</span><br><span class="line">                arrKeyColorAndOpacity = keyColorAndOpacity.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (arrKeyColorAndOpacity.<span class="property">length</span> != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 分出颜色和透明度</span></span><br><span class="line">            <span class="keyword">var</span> keyColor = arrKeyColorAndOpacity[<span class="number">0</span>].<span class="title function_">trim</span>();</span><br><span class="line">            <span class="keyword">var</span> opacity = (arrKeyColorAndOpacity[<span class="number">1</span>] || <span class="string">&#x27;1&#x27;</span>).<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// keyColor转rgb</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">head</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = keyColor;</span><br><span class="line">            <span class="keyword">var</span> rgbColor = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(<span class="variable language_">document</span>.<span class="property">head</span>).<span class="property">backgroundColor</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 应用的颜色</span></span><br><span class="line">            <span class="keyword">var</span> applyColor = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="comment">// 透明度替换</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="regexp">/^rgba/</span>.<span class="title function_">test</span>(rgbColor)) &#123;</span><br><span class="line">                applyColor = rgbColor.<span class="title function_">replace</span>(<span class="string">&#x27;1)&#x27;</span>, opacity + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                applyColor = rgbColor.<span class="title function_">replace</span>(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;, &#x27;</span> + opacity + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            node.<span class="property">style</span>.<span class="title function_">setProperty</span>(cssProp, applyColor);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> funAutoInitAndWatching = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// DOM Insert自动初始化</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">MutationObserver</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> observerSelect = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="keyword">function</span> (<span class="params">mutationsList</span>) &#123;</span><br><span class="line">                mutationsList.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">mutation</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> nodeAdded = mutation.<span class="property">addedNodes</span>;</span><br><span class="line">                    <span class="comment">// 新增元素</span></span><br><span class="line">                    nodeAdded.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">eleAdd</span>) &#123;</span><br><span class="line">                        <span class="title function_">funKeywordColor2Rgba</span>(eleAdd);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            observerSelect.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="property">body</span>, &#123;</span><br><span class="line">                <span class="attr">childList</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">subtree</span>: <span class="literal">true</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果没有开启自动初始化，则返回</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;*&#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">ele</span>) &#123;</span><br><span class="line">            <span class="title function_">funKeywordColor2Rgba</span>(ele);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> != <span class="string">&#x27;loading&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">funAutoInitAndWatching</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, funAutoInitAndWatching);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h4 id="CSS变量模拟CSS新特性"><a href="#CSS变量模拟CSS新特性" class="headerlink" title="CSS变量模拟CSS新特性"></a>CSS变量模拟CSS新特性</h4><blockquote><p>CSS中的有些非常棒的新特性还没有被浏览器所支持，attr()函数的新语法就是其中之一。如果浏览器支持attr()函数的新语法，那么我们就可以使用任意HTML自定义属性控制元素的样式</p><p><a href="https://demo.cssworld.cn/new/8/4-2.php">css变量Polyfill attr 语法</a></p></blockquote><ul><li><h5 id="HTML：-6"><a href="#HTML：-6" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bgcolor</span>=<span class="string">&quot;skyblue&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;4&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bgcolor</span>=<span class="string">&quot;#00000040&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;1rem&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bgcolor</span>=<span class="string">&quot;red&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;50%&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bgcolor</span>=<span class="string">&quot;orange&quot;</span> <span class="attr">radius</span>=<span class="string">&quot;100% / 50%&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-7"><a href="#CSS：-7" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: .<span class="number">5em</span> <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attr">--attr-bg</span>: <span class="built_in">attr</span>(bgcolor color);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--attr-bg);</span><br><span class="line">    <span class="attr">--attr-radius</span>: <span class="built_in">attr</span>(radius px, <span class="number">4px</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--attr-radius);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="丰富的图形处理"><a href="#丰富的图形处理" class="headerlink" title="丰富的图形处理"></a>丰富的图形处理</h2><h3 id="超级实用的CSS遮罩"><a href="#超级实用的CSS遮罩" class="headerlink" title="超级实用的CSS遮罩"></a>超级实用的CSS遮罩</h3><blockquote><p>CSS遮罩属性非常实用，它可以让一个元素按照某张图像的轮廓显示。有非常多的图形表现效果只能使用遮罩实现，因此CSS遮罩在CSS世界中有着独一无二的地位。</p></blockquote><h4 id="mask-image属性的详细介"><a href="#mask-image属性的详细介" class="headerlink" title="mask-image属性的详细介"></a>mask-image属性的详细介</h4><blockquote><p>mask-image属性是CSS遮罩第一阶段就支持的CSS属性，兼容性非常好，作用是设置使用遮罩效果的图像。这里有一点需要说明，虽然浏览器很早就支持mask-image属性，但是只支持是部分传统的属性值，例如url()函数，很多新特性是第二阶段才出来的，可能会有浏览器不支持的情况，这一点会在接下来的内容中有所体现。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-image</span>: none | &lt;image&gt; | &lt;mask-source&gt;</span><br></pre></td></tr></table></figure><p>● none是默认值，表示默认无遮罩图片。</p><p>● &lt;image&gt;表示图像数据类型，包括CSS渐变图像、url()函数、image-set()函数、cross-fade()函数和element()函数等。</p><p>● &lt;mask-source&gt;表示遮罩元素类型，主要指SVG遮罩元素。</p><ol><li><p><a href="https://demo.cssworld.cn/new/12/1-1.php">带有半透明的PNG图像的遮罩效果</a></p><ul><li><h5 id="HTML：-7"><a href="#HTML：-7" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;nature-8.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image&quot;</span> <span class="attr">width</span>=<span class="string">&quot;256&quot;</span> <span class="attr">height</span>=<span class="string">&quot;192&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-8"><a href="#CSS：-8" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mask-image</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">mask</span>: no-repeat center / contain;</span><br><span class="line">    <span class="attribute">mask</span>: no-repeat center / contain;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">url</span>(<span class="string">../images/bird.png</span>);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">url</span>(<span class="string">../images/bird.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><a href="https://demo.cssworld.cn/new/12/1-2.php">SVG图形遮罩效果展示</a></p><blockquote><p>除了常见的GIF、PNG等位图图片，SVG矢量图片也可以作为mask-image的遮罩图像。</p></blockquote><ul><li><h5 id="HTML：-8"><a href="#HTML：-8" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;8.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image&quot;</span> <span class="attr">width</span>=<span class="string">&quot;256&quot;</span> <span class="attr">height</span>=<span class="string">&quot;174&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-9"><a href="#CSS：-9" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mask-image</span> &#123;</span><br><span class="line">    <span class="attr">--svg</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/svg+xml,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 32 32&#x27;%3E%3Cpath d=&#x27;M28.027 5.161l-17.017 17.017-7.007-7.007-3.003 3.003 10.010 10.010 20.020-20.020z&#x27;%3E%3C/path%3E%3C/svg%3E&quot;</span>);</span><br><span class="line"></span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">var</span>(--svg);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">var</span>(--svg);</span><br><span class="line"></span><br><span class="line">    -webkit-<span class="attribute">mask-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">mask-repeat</span>: no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><a href="https://demo.cssworld.cn/new/12/1-3.php">用渐变图像实现遮罩效果</a></p><blockquote><p>在实际开发过程中，使用渐变图像实现遮罩效果是最常用的，也是最实用的，因为此时的渐变图像是代码生成的，相比url()函数外链的图像，其资源开销小，开发成本低，维护更加方便。</p></blockquote><ul><li><h5 id="HTML：-9"><a href="#HTML：-9" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image&quot;</span> <span class="attr">width</span>=<span class="string">&quot;256&quot;</span> <span class="attr">height</span>=<span class="string">&quot;192&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-10"><a href="#CSS：-10" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mask-image</span> &#123;</span><br><span class="line">    <span class="attr">--gradient1</span>: <span class="built_in">radial-gradient</span>(<span class="number">600px</span> <span class="number">80px</span> at top, transparent <span class="number">150px</span>, black <span class="number">152px</span> <span class="number">1000px</span>, transparent <span class="number">0</span>);</span><br><span class="line">    <span class="attr">--gradient2</span>: <span class="built_in">radial-gradient</span>(<span class="number">600px</span> <span class="number">80px</span> at bottom, transparent <span class="number">150px</span>, black <span class="number">152px</span> <span class="number">1000px</span>, transparent <span class="number">0</span>);</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">var</span>(--gradient1), <span class="built_in">var</span>(--gradient2);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">var</span>(--gradient1), <span class="built_in">var</span>(--gradient2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><a href="https://demo.cssworld.cn/new/12/1-4.php">SVG图形中&lt;mask&gt;元素作为遮罩图像</a></p><blockquote><p>&lt;mask-source&gt;数据类型并不常用，日常开发中还是使用PNG图像和SVG图像更方便。但这并不表示&lt;mask-source&gt;数据类型一无是处，它有一个不可替代的巨大优势，就是让IE9在内的浏览器也能实现遮罩效果</p></blockquote></li><li><p><a href="https://demo.cssworld.cn/new/12/1-6.php">外链SVG文件的&lt;mask&gt;元素作为遮罩元素</a></p><blockquote><p>无论是普通HTML元素，还是SVG元素，遮罩效果都只会在Firefox浏览器中出现，在IE浏览器、Edge浏览器和Chrome浏览器中均无效。</p></blockquote></li><li><p><a href="https://demo.cssworld.cn/new/12/1-7.php">image-set()、cross-fade()或element()作为遮罩图像</a></p><blockquote><p>所有&lt;image&gt;数据类型的值都可以作为遮罩图像，自然也就包括image-set()、cross-fade()和element()这3个图像函数。</p></blockquote><ul><li><h5 id="HTML：-10"><a href="#HTML：-10" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>image-set()<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image image-set&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>cross-fade()<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image cross-fade&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;title&quot;</span>&gt;</span>element()<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image element&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-11"><a href="#CSS：-11" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.image-set</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">-webkit-image-set</span>(<span class="built_in">url</span>(<span class="string">bird.png</span>) <span class="number">1</span>x, <span class="built_in">url</span>(<span class="string">triangle.svg</span>) <span class="number">2</span>x);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">image-set</span>(<span class="built_in">url</span>(<span class="string">bird.png</span>) <span class="number">1</span>x, <span class="built_in">url</span>(<span class="string">triangle.svg</span>) <span class="number">2</span>x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.cross-fade</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">-webkit-cross-fade</span>(<span class="built_in">url</span>(<span class="string">bird.png</span>), <span class="built_in">url</span>(<span class="string">triangle.svg</span>), <span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">cross-fade</span>(<span class="built_in">url</span>(<span class="string">bird.png</span>), <span class="built_in">url</span>(<span class="string">triangle.svg</span>), <span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">-webkit-element</span>(#title);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">-moz-element</span>(#title);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">element</span>(#title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h4 id="mask-mode属性"><a href="#mask-mode属性" class="headerlink" title="mask-mode属性"></a>mask-mode属性</h4><blockquote><p>mask-mode属性的默认值是match-source，作用是根据资源的类型自动采用合适的遮罩模式。例如，如果遮罩效果使用的是SVG中的&lt;mask&gt;元素，则此时的mask-mode属性的计算值是<strong>luminance，表示基于亮度判断是否要进行遮罩</strong>。如果是其他场景，则计算值是<strong>alpha，表示基于透明度判断是否要进行遮罩</strong></p><p>mask-mode:luminance让JPG图片也能有遮罩效果示意</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-mode</span>: match-source| luminance| alpha;</span><br></pre></td></tr></table></figure><blockquote><p>目前，仅Firefox浏览器支持mask-mode属性，Chrome浏览器并不提供支持，但是可以使用非标准的mask-source-type属性代替（没有私有前缀）</p></blockquote><h4 id="mask-repeat属性"><a href="#mask-repeat属性" class="headerlink" title="mask-repeat属性"></a>mask-repeat属性</h4><blockquote><p>mask-repeat属性的默认值是repeat，作用类似于background-repeat属性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-repeat</span>: repeat-x| repeat-y| repeat| no-repeat| space| round;</span><br></pre></td></tr></table></figure><p>mask-image支持多遮罩图片，因此mask-repeat也支持多属性值</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-repeat</span>: round repeat, space, repeat-x;</span><br></pre></td></tr></table></figure><p>● space与background属性中的space的含义是类似的，表示遮罩图片尽可能地平铺，同时不进行任何剪裁。</p><p>● round表示遮罩图片尽可能靠在一起，没有任何间隙，同时不进行任何剪裁。这意味着图片可能会产生缩放效果。</p><h4 id="mask-position属性"><a href="#mask-position属性" class="headerlink" title="mask-position属性"></a>mask-position属性</h4><blockquote><p>mask-position和background-position支持的属性值和属性值的表现基本上都是一样的。例如，mask-position的默认计算值是0% 0%，也就是相对左上角定位。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-position</span>: top;</span><br><span class="line"><span class="attribute">mask-position</span>: right top;</span><br><span class="line"><span class="attribute">mask-position</span>: <span class="number">30%</span> <span class="number">50%</span>;</span><br><span class="line"><span class="attribute">mask-position</span>: top <span class="number">20px</span> left <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">mask-position</span>: top, center;<span class="comment">/* 多属性 */</span></span><br></pre></td></tr></table></figure><h4 id="mask-clip属性"><a href="#mask-clip属性" class="headerlink" title="mask-clip属性"></a>mask-clip属性</h4><blockquote><p>mask-clip属性用来设置遮罩效果显示的盒子区域。</p><p>mask-clip的几个属性值中比较有实用价值的是border-box、padding-box和content-box这3个关键字的属性值，原因很简单——Chrome浏览器仅支持这3个关键字。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-clip</span>: border-box| padding-box| content-box| no-clip| fill-box| fill-box| stroke-box| view-box;</span><br></pre></td></tr></table></figure><ul><li><p>no-clip</p><p>  mask-clip属性支持一个名为no-clip的属性值，我个人觉得这个值的效果还是很稀奇的，它的作用是不对元素的遮罩效果做区域上的限制，言外之意就是只要是元素身上“长出来”的东西，都可以应用遮罩效果。例如，轮廓（outline）、盒阴影（box-shadow）都是可以应用遮罩效果的。</p></li></ul><h4 id="关于fill-box、stroke-box和view-box"><a href="#关于fill-box、stroke-box和view-box" class="headerlink" title="关于fill-box、stroke-box和view-box"></a>关于fill-box、stroke-box和view-box</h4><blockquote><p>fill-box、stroke-box和view-box这3个关键字属性值要应用在SVG元素上才有效果。</p></blockquote><p>● fill-box表示遮罩应用的区域是图形填充区域形成的边界盒子</p><p>● stroke-box表示的遮罩区域把描边占据的区域也包含在内。</p><p>● view-box表示使用最近的SVG视口作为参考盒子。如果SVG代码中的viewBox属性有设置，则遮罩区域盒子位于viewBox属性建立的坐标系的原点，尺寸由viewBox属性中的宽高值决定。</p><p><a href="https://demo.cssworld.cn/new/12/1-8.php">效果展示</a></p><h4 id="mask-origin属性"><a href="#mask-origin属性" class="headerlink" title="mask-origin属性"></a>mask-origin属性</h4><blockquote><p>mask-origin属性表示遮罩效果起始点，其与background-origin有很多类似之处。也支持多属性</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-origin</span>: content-box| padding-box| border-box| fill-box| stroke-box| view-box;</span><br></pre></td></tr></table></figure><h4 id="mask-size属性"><a href="#mask-size属性" class="headerlink" title="mask-size属性"></a>mask-size属性</h4><blockquote><p>mask-size属性的性质和background-size属性类似，支持的关键字属性值也类似，作用是控制遮罩图片尺寸.支持多属性</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-size</span>: cover| contain;</span><br><span class="line"></span><br><span class="line"><span class="attribute">mask-size</span>: <span class="number">50%</span> auto;</span><br><span class="line"><span class="attribute">mask-size</span>: <span class="number">3em</span> <span class="number">25%</span>;</span><br><span class="line"><span class="attribute">mask-size</span>: auto <span class="number">6px</span>;</span><br></pre></td></tr></table></figure><h4 id="mask-type属性"><a href="#mask-type属性" class="headerlink" title="mask-type属性"></a>mask-type属性</h4><blockquote><p>mask-type属性的功能和mask-mode属性类似，都是设置不同的遮罩模式，但还是有一个很大的区别，就是mask-type属性只能作用在SVG元素上</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-type</span>: alpha| luminance;</span><br></pre></td></tr></table></figure><h4 id="mask-composite属性"><a href="#mask-composite属性" class="headerlink" title="mask-composite属性"></a>mask-composite属性</h4><blockquote><p>mask-composite属性表示同时使用多张图片进行遮罩时的合成方式</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mask-composite</span>: add| subtract| intersect| exclude;</span><br></pre></td></tr></table></figure><p>● add表示遮罩累加，是默认值。</p><p>● subtract表示遮罩相减，也就是遮罩图片重合的区域不显示。这就意味着，遮罩图片越多，遮罩区域越小。</p><p>● intersect表示遮罩相交，也就是遮罩图片重合的区域才显示遮罩。</p><p>● exclude表示遮罩排除，也就是遮罩图片重合的区域被当作透明的。</p><p><a href="https://demo.cssworld.cn/new/12/1-9.php">效果展示</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask-image&quot;</span>&gt;</span> </span><br><span class="line">.mask-image &#123;</span><br><span class="line">    mask: url(https://res.weread.qq.com/wrepub/web/40870013/bird.png) no-repeat center / contain, linear-gradient(black, black);</span><br><span class="line">    webkit-mask-composite: xor;</span><br><span class="line">    mask-composite: exclude; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CSS遮罩的一些经典应用示例"><a href="#CSS遮罩的一些经典应用示例" class="headerlink" title="CSS遮罩的一些经典应用示例"></a>CSS遮罩的一些经典应用示例</h4><p><a href="https://demo.cssworld.cn/new/12/1-10.php">PNG/SVG背景图标变色最佳实践</a></p><ul><li><h5 id="HTML：-11"><a href="#HTML：-11" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span> <span class="attr">id</span>=<span class="string">&quot;buttonDelete&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-delete&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-12"><a href="#CSS：-12" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-delete</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20px</span>; <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attr">--mask</span>: <span class="built_in">url</span>(<span class="string">/images/8/delete@2x.png</span>) no-repeat center / <span class="number">1.125em</span> <span class="number">1.125em</span>;</span><br><span class="line">    -webkit-<span class="attribute">mask</span>: <span class="built_in">var</span>(--mask);</span><br><span class="line">    <span class="attribute">mask</span>: <span class="built_in">var</span>(--mask);</span><br><span class="line"></span><br><span class="line">    <span class="attribute">vertical-align</span>: -<span class="number">4px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>虽说是最佳实践，但是上面的代码并不是完美的，因为应用遮罩的当前元素的outline效果会失去，这对于无障碍访问是有影响的，解决方法是将图标遮罩的执行放在伪元素中，也就是在.icon-delete::before{}语句中应用遮罩效果，这样，.icon-delete元素依然可以有outline轮廓效果。</p></blockquote><p><a href="https://demo.cssworld.cn/new/12/1-11.php">大尺寸PNG图片的尺寸优化</a></p><ul><li><h5 id="HTML：-12"><a href="#HTML：-12" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;leaf.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-13"><a href="#CSS：-13" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attr">--mask-url</span>: <span class="built_in">url</span>(<span class="string">leaf-mask.png</span>);</span><br><span class="line">    -webkit-<span class="attribute">mask-image</span>: <span class="built_in">var</span>(--mask-url);</span><br><span class="line">    <span class="attribute">mask-image</span>: <span class="built_in">var</span>(--mask-url);</span><br><span class="line">    -webkit-<span class="attribute">mask-size</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">mask-size</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>PNG图片的文件大小之所以大，就是因为其色彩过于丰富，如果把图片变成纯色，图片文件大小可以降低很多</p><p>单纯用png(259K),转成jpg(55.6),制作png纯色图片（4K）,由于遮罩图像的解析有跨域的限制，因此，大小不足5KB的纯色的PNG背景遮罩图像可以直接转换为Base64格式并内联在CSS文件中</p></blockquote><h4 id="webkit-mask-box-image和mask-border属性"><a href="#webkit-mask-box-image和mask-border属性" class="headerlink" title="-webkit-mask-box-image和mask-border属性"></a>-webkit-mask-box-image和mask-border属性</h4><blockquote><p>-webkit-mask-box-image和mask-border属性实现的都是边框遮罩效果。它们之间的区别有以下几点。</p></blockquote><p>● 语法细节不同。例如，-webkit-mask-box-image的属性值使用空格分隔，不会用到斜杠，而mask-border属性是多个CSS属性的缩写，会使用斜杠进行属性值的区分。</p><p>● -webkit-mask-box-image是非标准CSS属性，mask-border是标准CSS属性。</p><p>● -webkit-mask-box-image属性在webkit内核浏览器中兼容性极佳，因此，在移动端项目可以放心大胆使用；而mask-border属性在我书写这段内容的时候还没有被任何浏览器支持，暂无实用价值。</p><h4 id="webkit-mask-box-image属性"><a href="#webkit-mask-box-image属性" class="headerlink" title="-webkit-mask-box-image属性"></a>-webkit-mask-box-image属性</h4><blockquote><p>background和mask有很多相似之处，一个是背景图像，另一个是背景遮罩。同样，这里的-webkit-mask-box-image属性和border-image属性也是这种关系，border-image属性表示边框图像，而-webkit-mask-box-image属性则表示边框遮罩。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-<span class="attribute">mask</span>-box-image: none;</span><br><span class="line">-webkit-<span class="attribute">mask</span>-box-image: &lt;mask-box-image&gt; [&lt;top&gt; &lt;right&gt; &lt;bottom&gt; &lt;left&gt; &lt;x-repeat&gt; &lt;y-repeat&gt;]</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/12/1-12.php">尺寸任意渐变提示框效果</a></p><h4 id="mask-border属性"><a href="#mask-border属性" class="headerlink" title="mask-border属性"></a>mask-border属性</h4><blockquote><p>虽然目前mask-border属性的兼容性不好，但是它毕竟是CSS规范属性，是未来之星。mask-border属性和border-image属性在语法上极为相似。首先，mask-border属性也是以下多个CSS属性的缩写：</p><p>● mask-border-mode；</p><p>支持alpha和luminance这两个关键字属性值</p><p>● mask-border-outset；</p><p>表示边框遮罩效果向外偏移的大小，支持长度值和数值，如果值是数值，则表示边框宽度border-width属性值的倍数</p><p>● mask-border-repeat；</p><p>表示遮罩图像的平铺方式，支持stretch、repeat、round、space等关键字属性值</p><p>● mask-border-slice；</p><p>表示对遮罩图像进行九宫格划分的方式，支持4个方位的划分</p><p>● mask-border-source；</p><p>支持任意的&lt;image&gt;数据类型的图像，常见的有url()图像和渐变图像</p><p>● mask-border-width。</p></blockquote><h3 id="实用的CSS剪裁属性clip-path"><a href="#实用的CSS剪裁属性clip-path" class="headerlink" title="实用的CSS剪裁属性clip-path"></a>实用的CSS剪裁属性clip-path</h3><blockquote><p>clip-path属性可以用来对任意元素的可视区域进行剪裁。</p><p>相比CSS2.1中的clip属性，clip-path属性不需要将元素设置为绝对定位就能生效，并且剪裁的形状类型要远比clip属性丰富得多。clip属性只能进行矩形剪裁，而clip-path属性不仅可以进行矩形剪裁，圆形、多边形和不规则形状都是可以剪裁的。</p><p>同时clip-path属性是CSS新特性中兼容性非常好的几个CSS属性之一，iOS 7和Android 4.4这些非常古老的手机系统都支持clip-path属性，因此在移动端项目中可以放心使用clip-path属性。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 关键字属性值 */</span></span><br><span class="line"><span class="attribute">clip-path</span>: none;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &lt;clip-source&gt; 值类型 资源剪裁 */</span> </span><br><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">url</span>(<span class="string">resources.svg#someId</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &lt;geometry-box&gt; 值类型 盒子剪裁 */</span></span><br><span class="line"><span class="attribute">clip-path</span>: margin-box;</span><br><span class="line"><span class="attribute">clip-path</span>: border-box;</span><br><span class="line"><span class="attribute">clip-path</span>: padding-box;</span><br><span class="line"><span class="attribute">clip-path</span>: content-box;</span><br><span class="line"><span class="attribute">clip-path</span>: fill-box;</span><br><span class="line"><span class="attribute">clip-path</span>: stroke-box;</span><br><span class="line"><span class="attribute">clip-path</span>: view-box;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &lt;basic-shape&gt; 值类型 基本图形剪裁 */</span></span><br><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">100px</span> <span class="number">50px</span>);</span><br><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">circle</span>(<span class="number">50px</span> at <span class="number">0</span> <span class="number">100px</span>);</span><br><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">polygon</span>(<span class="number">50%</span> <span class="number">0%</span>, <span class="number">100%</span> <span class="number">50%</span>, <span class="number">50%</span> <span class="number">100%</span>, <span class="number">0%</span> <span class="number">50%</span>);</span><br><span class="line"><span class="attribute">clip-path</span>: <span class="built_in">path</span>(<span class="string">&#x27;M0.5,1 C0.5,1,0,0.7,0,0.3 A0.25,0.25,1,1,1,0.5,0.3 </span></span><br><span class="line"><span class="string">A0.25,0.25,1,1,1,1,0.3 C1,0.7,0.5,1,0.5,1 Z&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（1）对于“资源剪裁”，Chrome浏览器仅支持使用内联SVG元素进行剪裁，不支持引用外链SVG元素进行剪裁</p><p>（2）对于“盒子剪裁”，所有值都不被Chrome浏览器支持。</p><h4 id="资源裁剪"><a href="#资源裁剪" class="headerlink" title="资源裁剪"></a><strong>资源裁剪</strong></h4><p><a href="https://demo.cssworld.cn/new/12/2-1.php">SVG资源裁剪效果</a></p><p><a href="https://demo.cssworld.cn/new/12/2-2.php">使用ClipPath Sprites技术实现的小图标效果</a></p><blockquote><p>那就是内联的SVG元素不能使用display:none或者visibility:hidden进行隐藏，否则剪裁元素会被隐藏，并且此技术只适合填充模式的小图标，不适合描边小图标。</p></blockquote><h4 id="盒子裁剪"><a href="#盒子裁剪" class="headerlink" title="盒子裁剪"></a><strong>盒子裁剪</strong></h4><blockquote><p>盒子剪裁只需要关心margin-box、border-box、padding-box和content-box这几个盒子类型即可。fill-box、stroke-box和view-box这3个盒子类型需要和SVG元素配合使用，在实际开发中用到的概率较小</p></blockquote><p><a href="https://demo.cssworld.cn/new/12/2-3.php">clip-path &lt;geometry-box&gt;值对比实例页面</a></p><h4 id="基本图形剪裁"><a href="#基本图形剪裁" class="headerlink" title="基本图形剪裁"></a><strong>基本图形剪裁</strong></h4><blockquote><p>基本图形剪裁是clip-path属性高频使用的一种剪裁方式，其可以实现剪裁效果的基本形状函数包括inset()、circle()、ellipse()、polygon()和path()。</p></blockquote><ul><li><p>inset()函数</p><p>  语法与 clip 的 rect()函数类似，但是更强大.剪切便宜支持四个方向，还支持四个反向圆角 %值等</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inset(&lt;length-percentage&gt;&#123;<span class="number">1</span>,<span class="number">4</span>&#125; round &lt;&#x27;<span class="attribute">border-radius</span>&#x27;&gt;);</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="comment">/* 偏移大小15%，圆角大小10% 50% 10% 50%*/</span></span><br><span class="line">clip-path: <span class="built_in">inset</span>(<span class="number">15%</span> round <span class="number">10%</span> <span class="number">50%</span> <span class="number">10%</span> <span class="number">50%</span>);</span><br></pre></td></tr></table></figure></li><li><p>circle()函数</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">circle( <span class="selector-attr">[ &lt;shape-radius&gt; ]</span>? <span class="selector-attr">[ at &lt;position&gt; ]</span>? )</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">clip-path: <span class="built_in">circle</span>(<span class="number">40%</span> at right <span class="number">10%</span> bottom <span class="number">10%</span>);</span><br></pre></td></tr></table></figure></li><li><p>ellipse()函数</p><blockquote><p>剪裁椭圆形状,与circle相比多了一个半径参数</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ellipse( <span class="selector-attr">[ &lt;shape-radius&gt;&#123;2&#125; ]</span>? <span class="selector-attr">[ at &lt;position&gt; ]</span>? )</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">img &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">ellipse</span>(<span class="number">30%</span> <span class="number">50%</span> at <span class="number">75%</span> <span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>polygon()函数</p><blockquote><p>使用频率最多，语法简单功能强大，可以有很多衍生的应用。</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">polygon( &lt;fill-rule&gt;? , <span class="selector-attr">[ x, y ]</span># )</span><br></pre></td></tr></table></figure><p>  <a href="https://demo.cssworld.cn/new/12/2-4.php">实现渐变提示框</a></p><p>  实现双三角图标</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.double-triangle</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">polygon</span>(<span class="number">5px</span> <span class="number">10px</span>, <span class="number">16px</span> <span class="number">3px</span>, <span class="number">16px</span> <span class="number">10px</span>, <span class="number">26px</span> <span class="number">10px</span>, <span class="number">26px</span> <span class="number">3px</span>, <span class="number">37px</span> <span class="number">10px</span>, </span><br><span class="line"><span class="number">26px</span> <span class="number">17px</span>, <span class="number">26px</span> <span class="number">10px</span>, <span class="number">16px</span> <span class="number">10px</span>, <span class="number">16px</span> <span class="number">17px</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>path()函数</p><blockquote><p>可以剪裁出任意图形效果，是一个功能非常强大的剪裁函数，其他所有基本形状函数都可以使用path()函数表示</p></blockquote><p>  <a href="https://demo.cssworld.cn/new/12/2-5.php">实现图标变化效果</a></p><ul><li><h5 id="HTML：-13"><a href="#HTML：-13" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;icon-arrow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-14"><a href="#CSS：-14" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-arrow</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">32px</span>; <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">45deg</span>, deepskyblue, deeppink);</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">path</span>(<span class="string">&quot;M16.016 1.157l-15.015 15.015h9.009v16.016h12.012v-16.016h9.009z&quot;</span>);</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-arrow</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">path</span>(<span class="string">&quot;M16.016 31.187l15.015-15.015h-9.009v-16.016h-12.012v16.016h-9.009z&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>（1）剪裁效果发生的时候，元素原始的位置是保留的，不会发生布局上的变化，这为clip-path属性在图形动态效果领域大显身手打下了技术基础。</p><p>（2）被剪裁的区域不能响应点击行为，也不能响应:hover伪类和:active伪类。这一点和mask属性不同，元素应用mask属性遮罩效果后，透明的部分依然是可以点击的。</p><p>（3）clip-path属性的几个基本图形函数都是支持动画效果的，但是需要关键坐标点的数量在动画前后保持一致。对于path()函数，还需要路径的指令保持一致才会有动画效果。</p></blockquote></li></ul><h4 id="了解nonzero和evenodd填充规则"><a href="#了解nonzero和evenodd填充规则" class="headerlink" title="了解nonzero和evenodd填充规则"></a>了解nonzero和evenodd填充规则</h4><blockquote><p>clip-path属性中的polygon()函数支持一个名为&lt;fill-rule&gt;的数据类型，表示填充规则。</p><p>无论是SVG、Canvas还是CSS，只要涉及路径填充，都离不开填充规则，并且用来表示填充规则的参数名也都是完全一致的，即nonzero和evenodd。换句话说，弄懂了nonzero和evenodd这两个填充规则，不仅在CSS这门语言中受用，在SVG、Canvas和其他与路径填充相关的程序开发语言中都是受用的。</p></blockquote><h4 id="差异"><a href="#差异" class="headerlink" title="差异"></a>差异</h4><p>如果填充对象是一个三角形，则这两种填充规则没什么区别，如果填充对象是两个三角形，并且两者重叠，差异就出现了</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221110120126561.png" alt="image-20221110120126561"></p><h4 id="一切都是交叉点的选择"><a href="#一切都是交叉点的选择" class="headerlink" title="一切都是交叉点的选择"></a>一切都是交叉点的选择</h4><blockquote><p>填充规则的关键，就是确定复杂路径构成的图形的内部和外部。内部则填充，外部则透明。</p><p>顾名思义，“nonzero规则”就是“非零规则”，用通俗的话讲，就是计算某些值是不是0，如果不是0则表示内部，表现为填充；如果是0则表示外部，表现为不填充。“evenodd规则”就是“奇偶规则”，用通俗的话讲，就是计算某些值是不是奇数，如果是奇数则表示内部，表现为填充；如果是偶数则表示外部，表现为不填充。</p></blockquote><h4 id="clip-path属性的精彩应用示例"><a href="#clip-path属性的精彩应用示例" class="headerlink" title="clip-path属性的精彩应用示例"></a>clip-path属性的精彩应用示例</h4><p><a href="clip-path%E5%AE%9E%E7%8E%B0%E5%85%A8%E6%96%B0%E8%BF%87%E5%9C%BA%E4%BA%A4%E4%BA%92%E6%95%88%E6%9E%9C">clip-path实现全新过场交互效果</a></p><p><a href="https://demo.cssworld.cn/new/12/2-7.php">渐变提示框效果</a></p><h3 id="webkit-box-reflect属性与倒影效果的实现"><a href="#webkit-box-reflect属性与倒影效果的实现" class="headerlink" title="-webkit-box-reflect属性与倒影效果的实现"></a>-webkit-box-reflect属性与倒影效果的实现</h3><blockquote><p>-webkit-box-reflect还是非标准的CSS属性，所以Firefox浏览器一直没有对-webkit-box-reflect属性进行支持，但是，Firefox浏览器有其他特性可以实现部分倒影效果。</p></blockquote><p>除了方位可以指定，倒影的偏移大小和倒影的遮罩图像都是可以设置的，-webkit-box- reflect属性完整的语法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-webkit-box-reflect: [ above | below | right | left ]? </span><br><span class="line">&lt;length&gt;? &lt;image&gt;?</span><br></pre></td></tr></table></figure><p>● 方位：可以是above、below、left和right这4个值中的任意一个，分别表示在上、下、左、右进行倒影。</p><p>● 偏移大小：表示倒影和原始元素的偏移距离，可以是数值，也可以是百分比值。如果是百分比值，则百分比大小是相对于元素自身尺寸计算的，与transform属性中translate()函数的百分比计算规则是一致的。</p><p>● 遮罩图像：可以实现对元素倒影的遮罩控制，支持url()函数图像、渐变图像等。</p><p><a href="https://demo.cssworld.cn/new/12/3-1.php">效果展示</a></p><p><strong>小结：</strong></p><p>（1）倒影和outline、box-shadow属性一样，其不占据尺寸空间，同时倒影也无法响应点击事件。</p><p>（2）如果倒影的偏移值是使用百分比值设置的，那么这个百分比值对应的尺寸计算方位是根据倒影方向自动识别的。例如倒影方向是below或above，则偏移百分比值是根据原始元素的高度计算的；如果倒影方向是left或right，则偏移百分比值是根据元素的宽度来计算的。</p><p>（3）遮罩图像可以使用任意的CSS渐变语法，包括锥形渐变，不过这里的遮罩图像一次最多只能设置一张图像。</p><p>（4）使用遮罩图像的时候，倒影的偏移值是不能缺省的。如果没有偏移，请使用0占位</p><p>（5）倒影效果具有实时渲染特性，也就是说，如果我们对原始图像进行剪裁，倒影也会被剪裁。</p><p>（6）遮罩图像是没有跨域限制的，而mask-image属性使用的遮罩图像是有跨域限制的。</p><h4 id="Firefox浏览器实现投影效果的解决方案"><a href="#Firefox浏览器实现投影效果的解决方案" class="headerlink" title="Firefox浏览器实现投影效果的解决方案"></a>Firefox浏览器实现投影效果的解决方案</h4><blockquote><p>虽然Firefox浏览器不支持-webkit-box-reflect属性，却可以使用element()图像函数实现近似的投影效果。</p></blockquote><p><a href="https://demo.cssworld.cn/new/12/3-2.php">效果展示</a></p><p>这一效果的实现原理如下。</p><p>● 使用伪元素模拟倒影效果，不占据多余的HTML元素，也无法被机器识别，和真实倒影性质接近。</p><p>● 倒影元素设置为绝对定位，这样大多数场景下是不会影响布局的。设置pointer- events:none无视所有点击事情，模拟倒影元素的穿透性。</p><p>● 最终的一步就是倒影元素一定要使用element()函数作为背景图出现，这样才是一个和原始元素效果实时同步的倒影效果。</p><p>● 如果有遮罩效果，可以使用mask属性实现，Firefox浏览器对mask属性的支持度很高，大家放心使用。</p><blockquote><p>上面案例中的倒影并不会随着原始图像同步变化，因为element()函数只能实时同步内容的变化。不过，要解决这个问题也很简单，在&lt;img&gt;外面再套一层标签，把父元素作为倒影图像即可，这是因为此时&lt;img&gt;元素属于倒影元素的子元素，变成了内容的一部分</p></blockquote><h3 id="使用offset属性实现元素的不规则运动"><a href="#使用offset属性实现元素的不规则运动" class="headerlink" title="使用offset属性实现元素的不规则运动"></a>使用offset属性实现元素的不规则运动</h3><blockquote><p>要让一个元素按照不规则路径进行运动，在过去实现成本比较低、兼容性也比较好的方法是使用“SVG SMIL animation”，现代浏览器均提供支持。[《超级强大的SVG SMIL animation动画详解》](<a href="https://www.zhangxinxu.com/wordpress/2014/08/">https://www.zhangxinxu.com/wordpress/2014/08/</a> so-powerful-svg-smil-animation/)进行了解</p></blockquote><p><a href="https://demo.cssworld.cn/new/12/4-1.php">路径运动实例</a></p><ul><li><h5 id="HTML：-14"><a href="#HTML：-14" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;horse.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;horse-run&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;280&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 280 150&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M10,80 q100,120 120,20 q140,-50 160,0&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;#cd0000&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-15"><a href="#CSS：-15" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.horse-run</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    offset-path: <span class="built_in">path</span>(<span class="string">&quot;M10,80 q100,120 120,20 q140,-50 160,0&quot;</span>);</span><br><span class="line">    <span class="attribute">animation</span>: motion <span class="number">3s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> motion &#123;</span><br><span class="line">    <span class="number">100%</span> &#123; offset-distance: <span class="number">100%</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>但是offset属性有一个缺点，那就是Safari浏览器并不提供对它的支持</p></blockquote><p>offset`属性是多个CSS属性的缩写，相关属性包括：</p><ul><li><p>offset-anchor；</p><blockquote><p>用来确定偏移运动的锚点，也就是确定元素中沿着轨迹运动的点。支持百分比，固定长度。</p></blockquote></li><li><p>offset-distance；</p><blockquote><p>表示偏移的距离大小，也就是元素沿着路径移动的距离，支持百分比值和长度值</p><p>如果路径是封闭的，则无论offset-distance有多大的值，都可以看到位置的变化；如果路径是开放的，则负值的位置和0%的位置是一样的，大于100%的值的位置和100%的位置是一样的。</p></blockquote><p>  如果移动路径是闭合路径，那么就会形成循环动画<a href="https://demo.cssworld.cn/new/12/4-3.php">三龙戏珠</a></p></li><li><p>offset-path；</p><blockquote><p>指的是运动的路径，支持多种路径类型，但从语法而言，它和clip-path属性有众多相似之处。</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">offset-path: none;</span><br><span class="line">offset-path: <span class="built_in">ray</span>( [ &lt;angle&gt; &amp;&amp; &lt;size&gt; &amp;&amp; contain? ] );</span><br><span class="line">offset-path: &lt;<span class="built_in">path</span>()&gt;;</span><br><span class="line">offset-path: &lt;url&gt;;</span><br><span class="line">offset-path: [ &lt;basic-shape&gt; || &lt;geometry-box&gt; ];</span><br></pre></td></tr></table></figure><p>  其中&lt;url&gt;数据类型可以直接使用页面内联SVG元素中任意图形元素的路径，&lt;basic-shape&gt;则包括inset、circle、ellipse、polygon等基本图形函数。</p><p>  咋一看很强大，但是只有path兼容性好，如ray()函数【射线状的偏移】，根本没有浏览器支持</p></li><li><p>offset-position；</p><blockquote><p>定义路径的起始点</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">offset-<span class="attribute">position</span>: auto | &lt;position&gt;</span><br></pre></td></tr></table></figure><ul><li>auto是初始值，表示偏移路径的起始点是元素正常的位置。</li><li>&lt;position&gt;用来指定偏移路径起始点的位置。</li></ul><p>offset-position属性有3个特点：<strong>语法简单、细节繁多、支持较差。</strong></p></blockquote><p>  <strong>细节：</strong></p><ul><li>如果元素的position属性的计算值是static，则offset-position属性是无效的。</li><li>如果offset-path的属性值包含&lt;geometry-box&gt;数据类型（margin-box、padding- box、border-box），或者使用了基本形状函数［circle()和ellipse()除外］，则offset-position属性也是无效的。</li><li>offset-position的属性值不是auto的时候会创建新的层叠上下文和包含块，类似于transform属性。</li><li>offset-position设置具体的定位值的表现和绝对定位是极度相似的，区别就在于绝对定位是脱离文档流的，位置的变化不会影响兄弟元素，但是offset-position属性产生的位移依然在当前布局中。</li><li>offset-position产生的位置偏移是相对于包含块区域计算的，而不是相对于自身，这一点和offset-anchor属性不同。</li></ul></li><li><p>offset-rotate。</p><blockquote><p>用来定义元素沿着offset-path路径运动时的方向和角度</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">offset-rotate: [ auto | reverse ] || &lt;angle&gt;</span><br></pre></td></tr></table></figure><ul><li>auto是初始值，表示元素沿着垂直于路径切线的方向运动。</li><li>&lt;angle&gt;表示元素按照指定的角度运动，例如设置offset-rotate: 30deg后，则元素会一直保持相对于元素正常状态旋转30°的角度进行运动</li><li>auto &lt;angle&gt;这种语法并不多见，却是一个非常巧妙的设计。auto &lt;angle&gt;表示元素沿着垂直于路径切线的方向运动，但是元素自身需要增加一点旋转角度。auto &lt;angle&gt;参数很实用。</li><li>reverse的含义和auto类似，区别在于方向是反的，等同于设置了auto 180deg。例如，设置offset-rotate: reverse后，元素会旋转180°，然后继续沿着路径切线角度运动</li></ul></li></ul><h2 id="图片等多媒体的处理"><a href="#图片等多媒体的处理" class="headerlink" title="图片等多媒体的处理"></a>图片等多媒体的处理</h2><h3 id="图片和视频元素的内在尺寸控制"><a href="#图片和视频元素的内在尺寸控制" class="headerlink" title="图片和视频元素的内在尺寸控制"></a>图片和视频元素的内在尺寸控制</h3><blockquote><p>为保持图片比例，不被拉伸变形。开发者往往利用具有内部尺寸的元素在没有指定高宽的情况下依然保持比例的特性，仅设置宽度值，或者仅设置高度值，让图片既有自适应的特性，又能保持比例。</p><p>但是首次加载图片，若图片没有加载出来，浏览器就会内在尺寸是0，此时图片占据高度0，图片加载成功后，高度突然变高，视觉上出现高度变化变现为内容跳动出现，图片会不断触发重绘，不仅性能不佳，用户体验也不好。</p></blockquote><h4 id="object-fit属性"><a href="#object-fit属性" class="headerlink" title="object-fit属性"></a>object-fit属性</h4><blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">object-fit</span>: fill | contain | cover | none | scale-down</span><br></pre></td></tr></table></figure><p>contain和cover这两个属性值，因为两者几乎占据了全部的object-fit属性使用场景。</p></blockquote><ol><li><p>fill</p><p> fill是默认值，表示“填充”，替换内容会拉伸，填满整个content-box的尺寸, 不保证保持原有的比例。</p></li><li><p>contain</p><p> 表示“包含”，替换内容保持原有尺寸比例，同时替换内容一定可以在content-box中完整显示，至少一个方向的尺寸和content-box保持一致。此关键字属性值可能会让content-box出现留白</p></li><li><p>cover</p><p> 表示“覆盖”，替换内容同样会保持原始的尺寸比例，同时替换内容会完全覆盖content-box区域，至少一个方向的尺寸和content-box保持一致。此关键字可能会让替换内容的部分区域不可见</p></li><li><p>none</p><p> none表示替换内容的尺寸显示为原始的尺寸，无视外部的尺寸设置。如果图片尺寸较小，就会在四周产生大量留白；如果图片尺寸较大，则会有较大面积的图片区域被剪裁。在实际开发中，此关键字很少被使用。</p></li><li><p>scale-down</p><p> 样式表现就好像依次设置了none和contain关键字，然后选取呈现的尺寸较小的那个效果</p></li></ol><blockquote><p>object-fit属性在现代浏览器中的兼容性非常好，Android 4.4.4就开始支持了，在移动端可以放心使用。</p></blockquote><h3 id="object-position属性的作用规则"><a href="#object-position属性的作用规则" class="headerlink" title="object-position属性的作用规则"></a>object-position属性的作用规则</h3><blockquote><p>用于控制替换内容的位置。object- position的初始值是50% 50%，也就是说默认是居中效果。所以，无论object-fit的值是哪一个关键字属性值，图片都是水平、垂直居中的。</p><p>因此，要实现尺寸大小不固定图片的水平、垂直居中效果，可以试试先将&lt;img&gt;元素的宽度设置为容器的宽度大小，然后设置object-fit:none。</p></blockquote><p><a href="">效果示例</a></p><blockquote><p>在实际开发中，通常缩略图使用cover关键字，列表图使用contain关键字，全屏大图预览使用scale-down关键字</p></blockquote><p>让替换元素在相对于content-box区域右下角20px 10px的地方定位：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">object-position</span>: right <span class="number">20px</span> bottom <span class="number">10px</span>;</span><br></pre></td></tr></table></figure><p><strong>Img Sprites技术</strong></p><blockquote><p>过去使用background-position定位实现的CSS Sprites技术和配合animation属性实现的无损Gif模拟技巧，现在都可以使用object-position属性实现，我称之为“Img Sprites技术”。</p></blockquote><p><a href="https://demo.cssworld.cn/new/10/1-3.php">object-position属性img元素类gif效果</a></p><ul><li><h5 id="CSS：-16"><a href="#CSS：-16" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.love</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">    <span class="attribute">animation</span>: heart-burst <span class="built_in">steps</span>(<span class="number">28</span>) .<span class="number">8s</span> infinite both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> heart-burst &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">object-position</span>: <span class="number">0%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">object-position</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="使用image-orientation属性纠正图片的方向"><a href="#使用image-orientation属性纠正图片的方向" class="headerlink" title="使用image-orientation属性纠正图片的方向"></a>使用image-orientation属性纠正图片的方向</h4><blockquote><p>当图片方向不正确时，纠正图片方向</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">image-orientation</span>: from-image | none;</span><br></pre></td></tr></table></figure><ul><li>from-image为初始值，表示如果图片包含旋转信息，则自动旋转图片。</li><li>如果照片没有Exif信息，则表现为none关键字属性值。none表示无论照片是否包含Exif信息，都不进行旋转。</li></ul><p><a href="https://demo.cssworld.cn/new/10/2-1.php">image-orientation属性基本效果实</a></p><h4 id="image-rendering属性与图像的渲染"><a href="#image-rendering属性与图像的渲染" class="headerlink" title="image-rendering属性与图像的渲染"></a>image-rendering属性与图像的渲染</h4><blockquote><p>image-rendering属性用来设置图像的缩放算法，主要针对PNG和JPG这类位图。image-rendering属性可以设置在&lt;img&gt;元素上，也可以设置在&lt;img&gt;元素的祖先元素上。</p><p>在现代浏览器中，image-rendering属性还可以设置background图像和canvas画布图像的缩放算法。image-rendering属性只有在图像发生缩放的时候才会有效果。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">image-rendering</span>: auto | crisp-edges | pixelated</span><br></pre></td></tr></table></figure><ul><li>auto表示浏览器自动选择使用何种图像缩放算法，通常表现为平滑缩放。</li><li>crisp-edges表示不使用平滑缩放算法，因此，缩放的图像会有较高的对比度和较锐利的边缘，也不会有模糊的感觉。常用的算法包括邻近算法和其他像素艺术算法，如2×SaI和hqx系列算法。</li><li>pixelated表示当放大图像时，必须使用邻近算法，使图像看起来由大像素块组成；当缩小图像时，使用与auto关键字属性值相同的算法。</li></ul><p>由于历史原因，各个浏览器用来控制图像算法的属性和属性值并不完全一致。</p><ul><li>IE浏览器使用非标准的声明-ms-interpolation-mode: nearest-neighbor。</li><li>Firefox浏览器支持关键字属性值crisp-edges，但是并不支持pixelated。</li><li>Chrome浏览器则支持关键字属性值pixelated，但并不支持crisp-edges关键字属性值，取而代之的关键字属性值是私有的-webkit-optimize-contrast。</li></ul><p><a href="https://demo.cssworld.cn/new/10/3-1.php">效果展示</a></p><blockquote><p>在常规的场景中，图像采用平滑效果肯定是更好的，因此是用不到image-rendering属性的。但是，如果网页的设计风格是像素化风格或者锐化风格（例如一些像素风格的游戏介绍页面）</p></blockquote><h3 id="不常用的图像类型函数"><a href="#不常用的图像类型函数" class="headerlink" title="不常用的图像类型函数"></a>不常用的图像类型函数</h3><h4 id="实现图像半透明叠加的cross-fade-函数"><a href="#实现图像半透明叠加的cross-fade-函数" class="headerlink" title="实现图像半透明叠加的cross-fade()函数"></a>实现图像半透明叠加的cross-fade()函数</h4><blockquote><p>cross-fade()函数可以让两张图像半透明混合<a href="https://demo.cssworld.cn/new/10/4-1.php">效果展示</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;image-combination&gt; = cross-fade( &lt;image&gt;, &lt;image&gt;, &lt;percentage&gt; )</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cross-fade-image</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background</span>: no-repeat center / contain;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>), <span class="built_in">url</span>(<span class="string">2.jpg</span>);</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">cross-fade</span>(<span class="built_in">url</span>(<span class="string">1.jpg</span>), <span class="built_in">url</span>(<span class="string">2.jpg</span>), <span class="number">50%</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>新语法，支持任意数量透明叠加，但是没有浏览器支持</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cross-fade(url(red<span class="selector-class">.png</span>) <span class="number">20%</span>, url(yellow<span class="selector-class">.png</span>) <span class="number">30%</span>, url(blue<span class="selector-class">.png</span>) <span class="number">50%</span>);</span><br></pre></td></tr></table></figure><p>本来可以用作水印添加，但是透明png图似乎效果更好，兼容性更好。于是它可以</p><p><a href="https://demo.cssworld.cn/new/10/4-2.php">cross-fade()函数降低背景图像透明度</a></p><h4 id="神奇的element-函数"><a href="#神奇的element-函数" class="headerlink" title="神奇的element()函数"></a>神奇的element()函数</h4><blockquote><p>CSS中的element()函数是一个非常神奇的函数，它可以让页面中任意DOM元素的渲染效果变成图像。</p></blockquote><p>只有Firefox浏览器支持element()函数，chrome 不支持</p><h2 id="更绚丽的视觉表现"><a href="#更绚丽的视觉表现" class="headerlink" title="更绚丽的视觉表现"></a>更绚丽的视觉表现</h2><h3 id="深入了解CSS滤镜属性"><a href="#深入了解CSS滤镜属性" class="headerlink" title="深入了解CSS滤镜属性"></a>深入了解CSS滤镜属性</h3><p><strong>filter</strong></p><blockquote><p>filter属性总共支持10个滤镜函数,所有filter属性支持的滤镜函数都支持animation动画效果</p></blockquote><table><thead><tr><th>滤镜</th><th align="center">释义</th></tr></thead><tbody><tr><td>filter:blur(5px)</td><td align="center">模糊</td></tr><tr><td>filter:brightness(2.4)</td><td align="center">亮度</td></tr><tr><td>filter:contrast(200%)</td><td align="center">对比度</td></tr><tr><td>filter:drop-shadow(4px 4px 8px blue)</td><td align="center">投影</td></tr><tr><td>filter:grayscale(50%)</td><td align="center">灰度</td></tr><tr><td>filter:hue-rotate(90deg)</td><td align="center">色调旋转</td></tr><tr><td>filter:invert(75%)</td><td align="center">反相</td></tr><tr><td>filter:opacity(25%)</td><td align="center">透明度</td></tr><tr><td>filter:saturate(230%)</td><td align="center">饱和度</td></tr><tr><td>filter:sepia(60%)</td><td align="center">褐色</td></tr></tbody></table><h4 id="模糊滤镜函数blur"><a href="#模糊滤镜函数blur" class="headerlink" title="模糊滤镜函数blur()"></a>模糊滤镜函数blur()</h4><blockquote><p>使用blur()函数可以让元素或者图像产生高斯模糊的效果</p></blockquote><p>使用blur()函数后图像边缘泛白效果</p><p>解决：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.1</span>);</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">5px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/11/1-1.php">径向模糊局部模糊效果</a></p><h4 id="亮度滤镜函数brightness"><a href="#亮度滤镜函数brightness" class="headerlink" title="亮度滤镜函数brightness()"></a>亮度滤镜函数brightness()</h4><blockquote><p>可以用来调节元素的亮度.</p><p>brightness()函数的参数值支持数值和百分比值，范围是0到无穷大。参数值0或0%表示纯黑色，参数值1或100%表示正常的亮度，0～1或0%～100%的亮度是线性变化的。随着参数值逐渐大于1或大于100%，元素的亮度也会逐渐提升。</p><p>值为空则使用参数1</p></blockquote><p><a href="https://demo.cssworld.cn/new/11/1-2.php#">效果展示</a></p><h4 id="对比度滤镜函数contrast"><a href="#对比度滤镜函数contrast" class="headerlink" title="对比度滤镜函数contrast()"></a>对比度滤镜函数contrast()</h4><blockquote><p>可以用来调节元素的对比度.</p><p>contrast()函数的<strong>参数值支持数值和百分比值</strong>，范围是0到无穷大。参数值0或0%表示毫无对比度，表现为纯灰色，色值是#808080，使用RGB色值表示为rgb(128,128,128)，也就是gray颜色关键字对应的色值。注意，这里说的是纯灰色，图像会直接变成一个灰色色块，而不是图像灰度。参数值1或100%表示正常的对比度。随着参数值逐渐大于1，元素的对比度也会逐渐提升。</p><p>值为空则使用参数1</p></blockquote><h4 id="投影滤镜函数drop-shadow"><a href="#投影滤镜函数drop-shadow" class="headerlink" title="投影滤镜函数drop-shadow()"></a>投影滤镜函数drop-shadow()</h4><blockquote><p>可以给元素设置符合真实世界阴影规则的投影效果</p><p>从语法上来看，drop-shadow()函数最多只支持3个数值，而box-shadow属性最多支持4个数值，其中第四个数值表示扩展。</p><p>drop-shadow()函数没有内投影效果，而box-shadow属性可以使用inset关键字实现内阴影效果。</p><p>drop-shadow()函数不支持投影叠加，box-shadow属性则允许无限累加投影</p></blockquote><p>使用drop-shadow()函数实现的投影是**<a href="https://demo.cssworld.cn/new/11/1-3.php">符合真实世界表现的投影</a>**，凡是透明镂空的地方，一定会留下相应的阴影轮廓。相对的，box-shadow属性实现的是盒阴影，只会在方方正正的盒子的四周留下阴影效果，无论是镂空还是凸出的图形都不会有阴影效果。</p><h4 id="灰度滤镜函数grayscale"><a href="#灰度滤镜函数grayscale" class="headerlink" title="灰度滤镜函数grayscale()"></a>灰度滤镜函数grayscale()</h4><blockquote><p>可以实现元素的去色效果，让所有彩色值变成灰度值。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">70%</span>); <span class="comment">/* 70% 等同于 0.7 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>0或0%表示正常的图像表现。在0～1或0%～100%范围区间的灰度是线性变化的。</p></blockquote><p>grayscale()函数比较经典的应用是在特殊的节日让网页变灰，这个效果只需一行CSS代码即可实现：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="色调旋转滤镜函数hue-rotate"><a href="#色调旋转滤镜函数hue-rotate" class="headerlink" title="色调旋转滤镜函数hue-rotate()"></a>色调旋转滤镜函数hue-rotate()</h4><blockquote><p>可以调整元素的色调，但饱和度和亮度保持不变</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">filter</span>: <span class="built_in">hue-rotate</span>(<span class="number">90deg</span>);</span><br></pre></td></tr></table></figure><p>hue-rotate()函数的参数值支持角度值，例如90deg或0.5turn等，角度值的范围没有限制，每360度就是一个循环。</p></blockquote><p><a href="https://demo.cssworld.cn/new/11/1-4.php">实现7彩文字效果</a></p><h4 id="反相滤镜函数invert"><a href="#反相滤镜函数invert" class="headerlink" title="反相滤镜函数invert()"></a>反相滤镜函数invert()</h4><blockquote><p>invert()函数可以让元素的亮度和色调同时反转</p><p>invert()函数的参数值支持数值和百分比值，范围是0到无穷大。参数值为1或100%的时候图像表现为完全反相。单纯从语法上来说，值可以大于1或者大于100%，但是效果不会再进一步变化。0或0%表示正常的图像表现。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line"><span class="attribute">filter</span>: <span class="built_in">invert</span>(<span class="number">75%</span>);<span class="comment">/*0.75*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>invert()函数可以和hue-rotate()函数一起使用，实现反转元素亮度的效果，下面这段CSS代码在实现深色模式效果的时候很实用：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">filter</span>: <span class="built_in">invert</span>(<span class="number">1</span>) <span class="built_in">hue-rotate</span>(<span class="number">180deg</span>);</span><br></pre></td></tr></table></figure><h4 id="透明度滤镜函数opacity"><a href="#透明度滤镜函数opacity" class="headerlink" title="透明度滤镜函数opacity()"></a>透明度滤镜函数opacity()</h4><blockquote><p>opacity()函数可以改变元素的透明度，效果和opacity属性类似</p><p>opacity()函数的参数值支持数值和百分比值，范围是0到无穷大。参数值为0或0%的时候图像表现为完全透明；参数值为1或100%或者更大的值时，图像均是正常表现。</p><p>opacity()函数和opacity属性的区别在于，在部分浏览器中，使用opacity()函数可以启用硬件加速，性能会更好。不过由于opacity属性本身性能就非常好，因此没有任何必要使用opacity()函数。另外，同时使用opacity()函数和opacity属性的时候，元素的透明度效果会互相累加，也就是最终渲染图像的透明度会进一步降低。</p></blockquote><h4 id="饱和度滤镜函数saturate"><a href="#饱和度滤镜函数saturate" class="headerlink" title="饱和度滤镜函数saturate()"></a>饱和度滤镜函数saturate()</h4><blockquote><p>saturate()函数可以调整元素的饱和度</p><p>saturate()函数的参数值支持数值和百分比值，范围是0到无穷大。参数值0或0%表示毫无饱和度，表现为灰度效果，等同于grayscale(1)；参数值1或100%表示正常的饱和度；随着参数值逐渐大于1，元素的饱和度也会逐渐提升。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">saturate</span>(<span class="number">230%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="褐色滤镜函数sepia"><a href="#褐色滤镜函数sepia" class="headerlink" title="褐色滤镜函数sepia()"></a>褐色滤镜函数sepia()</h4><blockquote><p>sepia()函数可以让元素的视觉效果向褐色靠拢</p><p>sepia()函数的参数值支持数值和百分比值，范围是0到无穷大。当参数值为1或100%，或者大于1或100%时，图像均表现为深褐色；当参数值为0或0%时，图像还是原始效果。</p></blockquote><p><strong>sepia()函数在日常开发中使用不多，主要是用来实现老照片效果。</strong></p><h3 id="更进一步的滤镜技术"><a href="#更进一步的滤镜技术" class="headerlink" title="更进一步的滤镜技术"></a>更进一步的滤镜技术</h3><h4 id="实现元素融合效果的技术"><a href="#实现元素融合效果的技术" class="headerlink" title="实现元素融合效果的技术"></a><a href="https://demo.cssworld.cn/new/11/1-5.php">实现元素融合效果的技术</a></h4><blockquote><p>就是同时使用模糊滤镜函数和对比度滤镜函数</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">10px</span>) <span class="built_in">contrast</span>(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="引用SVG滤镜技术"><a href="#引用SVG滤镜技术" class="headerlink" title="引用SVG滤镜技术"></a>引用SVG滤镜技术</h4><p><strong>融合粘滞效果</strong></p><p><a href="https://demo.cssworld.cn/new/11/1-6.php">filter SVG滤镜融合粘滞效果实</a></p><p><a href="https://demo.cssworld.cn/new/11/1-7.php">filter SVG滤镜水波荡漾的效果实</a></p><h4 id="姐妹花滤镜属性backdrop-filter"><a href="#姐妹花滤镜属性backdrop-filter" class="headerlink" title="姐妹花滤镜属性backdrop-filter"></a>姐妹花滤镜属性backdrop-filter</h4><blockquote><p>CSS背景滤镜属性backdrop-filter是一个人见人爱的属性，它可以非常轻松地实现毛玻璃效果等美观的滤镜特效。</p><p>backdrop-filter属性的学习成本极低，因为它和filter属性的语法几乎是一模一样的。</p><p>backdrop-filter属性和filter属性的区别在于backdrop-filter属性是让当前元素所在区域后面的内容应用滤镜效果，要想看到滤镜效果，需要当前元素本身是半透明或者完全透明的；而filter属性是让当前元素自身应用滤镜效果。</p></blockquote><p><a href="https://demo.cssworld.cn/new/11/2-1.php">backdrop-filter和filter属性效果对比示意实</a></p><h4 id="backdrop-filter属性与毛玻璃效果"><a href="#backdrop-filter属性与毛玻璃效果" class="headerlink" title="backdrop-filter属性与毛玻璃效果"></a>backdrop-filter属性与毛玻璃效果</h4><blockquote><p>毛玻璃效果必须要设置元素透明度</p></blockquote><p><a href="https://demo.cssworld.cn/new/11/2-2.php">弹框毛玻璃效果实</a></p><p><a href="https://demo.cssworld.cn/new/11/2-3.php">下拉框毛玻璃</a></p><blockquote><p><strong>对于backdrop-filter属性，请勿使用opacity()函数作为属性值。</strong></p></blockquote><h3 id="深入了解CSS混合模式"><a href="#深入了解CSS混合模式" class="headerlink" title="深入了解CSS混合模式"></a>深入了解CSS混合模式</h3><blockquote><p>CSS有下面3个混合模式相关属性：</p><p>background-blend-mode 属性用于混合元素背景图案、渐变和颜色；</p><p>mix-blend-mode 属性用于元素与元素之间的混合；</p><p>isolation 属性用在祖先元素上，限制mix-blend-mode属性设置的混合模式的应用范围。</p></blockquote><table><thead><tr><th>混合模式类型</th><th align="center">释义</th></tr></thead><tbody><tr><td>normal</td><td align="center">正常</td></tr><tr><td>multiply</td><td align="center">正片叠底</td></tr><tr><td>screen</td><td align="center">滤色</td></tr><tr><td>overlay</td><td align="center">叠加</td></tr><tr><td>darken</td><td align="center">变暗</td></tr><tr><td>lighten</td><td align="center">变亮</td></tr><tr><td>color-dodge</td><td align="center">颜色变淡</td></tr><tr><td>color-burn</td><td align="center">颜色加深</td></tr><tr><td>hard-light</td><td align="center">强光</td></tr><tr><td>soft-light</td><td align="center">柔光</td></tr><tr><td>difference</td><td align="center">差值</td></tr><tr><td>exclusion</td><td align="center">排除</td></tr><tr><td>hue</td><td align="center">色调</td></tr><tr><td>saturation</td><td align="center">饱和度</td></tr><tr><td>color</td><td align="center">颜色</td></tr><tr><td>luminosity</td><td align="center">亮度</td></tr></tbody></table><h4 id="mix-blend-mode-multiply"><a href="#mix-blend-mode-multiply" class="headerlink" title="mix-blend-mode:multiply"></a>mix-blend-mode:multiply</h4><blockquote><p>值multiply的混合效果是正片叠底，最终效果表现的色值的计算公式是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="variable constant_">AB</span>/<span class="number">255</span></span><br></pre></td></tr></table></figure><p>例如，已知颜色关键字deepskyblue的RGB色值是<strong>rgb(0,192,255)<strong>，颜色关键字deeppink的RGB色值是</strong>rgb(255,20,147)<strong>，则这两种颜色进行正片叠底混合后的色值是</strong>rgb(0,15,147)</strong></p></blockquote><p><a href="https://demo.cssworld.cn/new/11/3-2.php">浅色背景素材混合效果实例</a></p><h4 id="mix-blend-mode-screen"><a href="#mix-blend-mode-screen" class="headerlink" title="mix-blend-mode:screen"></a>mix-blend-mode:screen</h4><blockquote><p>值screen的<strong>混合效果是滤色</strong>，最终效果的色值的计算公式是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="number">255</span> - [(<span class="number">255</span>-A)(<span class="number">255</span>-B)]/<span class="number">255</span></span><br></pre></td></tr></table></figure></blockquote><p>screen的效果和multiply正好相反，multiply的效果是混合后颜色变暗，而screen则是混合后颜色变亮。因为滤色混合模式将两个混合颜色的互补色值相乘，然后除以255。</p><p>滤色模式具有以下一些直观的特性：</p><ul><li>任何颜色和黑色进行滤色混合后，还是呈现原来的颜色；</li><li>任何颜色和白色进行滤色混合后得到的仍是白色；</li><li>任何颜色和其他颜色进行滤色混合后，颜色会更浅，有点类似漂白的效果。</li></ul><p><a href="https://demo.cssworld.cn/new/11/3-3.php">滤色与前景特效</a></p><blockquote><p>无论是正片叠底、滤色，还是接下来要介绍的混合模式，都不仅仅适用于图像，<strong>还适用于视频元素</strong>。例如，我们希望网页中有烟花播放的动态效果，无须使用WebGL这么复杂的技术，直接准备一个烟花播放的视频，由于视频默认的背景色都是黑色的，因此，我们只需要设置视频的混合模式是screen，烟花播放动画就出现了</p></blockquote><h4 id="mix-blend-mode-overlay"><a href="#mix-blend-mode-overlay" class="headerlink" title="mix-blend-mode:overlay"></a>mix-blend-mode:overlay</h4><blockquote><p>overlay的<strong>混合效果是叠加</strong>，最终效果的色值的计算公式所示（表示底图的色值）。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当 A &lt;= 128时：</span></span><br><span class="line">C = <span class="variable constant_">AB</span>/<span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当 A &gt; 128时：</span></span><br><span class="line">C = <span class="number">255</span> - [(<span class="number">255</span> - A)(<span class="number">255</span> - B)]/<span class="number">128</span></span><br></pre></td></tr></table></figure><p>叠加效果在Web中主要有两个应用场景，一个是在图像上显示文字水印，另一个是着色叠加</p><p><a href="https://demo.cssworld.cn/new/11/3-4.php">叠加模式效果</a></p><h4 id="mix-blend-mode-darken"><a href="#mix-blend-mode-darken" class="headerlink" title="mix-blend-mode:darken"></a>mix-blend-mode:darken</h4><blockquote><p><strong>混合效果是变暗</strong>，表示将两种颜色的RGB通道值依次进行比较，哪个色值小就使用哪个色值。最终效果的色值的计算公式是：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="title function_">min</span>(A,B)</span><br></pre></td></tr></table></figure><h4 id="mix-blend-mode-lighten"><a href="#mix-blend-mode-lighten" class="headerlink" title="mix-blend-mode:lighten"></a>mix-blend-mode:lighten</h4><blockquote><p>值lighten的<strong>混合效果是变亮</strong>，表示将两个颜色的RGB通道值依次进行比较，哪个色值大就使用哪个色值。最终效果的色值的计算公式是：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="title function_">max</span>(A,B)</span><br></pre></td></tr></table></figure><h4 id="mix-blend-mode-color-dodge"><a href="#mix-blend-mode-color-dodge" class="headerlink" title="mix-blend-mode:color-dodge"></a>mix-blend-mode:color-dodge</h4><blockquote><p>color-dodge的<strong>混合效果是颜色变淡</strong>，最终效果的色值的计算公式是：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = <span class="selector-tag">A</span> + AB/(<span class="number">255</span> - <span class="selector-tag">B</span>)</span><br></pre></td></tr></table></figure><blockquote><p>，适合处理高光下的人物照片，通过将照片和特定颜色混合，可以改变整个照片的色调（暖色调或是冷色调），而不会影响人物高光区域的细节。</p></blockquote><h4 id="mix-blend-mode-color-burn"><a href="#mix-blend-mode-color-burn" class="headerlink" title="mix-blend-mode:color-burn"></a>mix-blend-mode:color-burn</h4><blockquote><p>color-burn的<strong>混合效果是颜色加深</strong>，最终效果的色值的计算公式是：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = A - [(<span class="number">255</span> - A)(<span class="number">255</span> - B)]/B</span><br></pre></td></tr></table></figure><blockquote><p>color-burn颜色加深混合模式可以用来保护底图的阴影，适合处理“幽深秘境”一类的照片，通过将照片和特定颜色混合，可以营造更加幽深的氛围。</p></blockquote><h4 id="mix-blend-mode-hard-light"><a href="#mix-blend-mode-hard-light" class="headerlink" title="mix-blend-mode:hard-light"></a>mix-blend-mode:hard-light</h4><blockquote><p>hard-light的<strong>混合效果是强光</strong>，就好像耀眼的聚光灯照射过来，表现为图像<strong>亮的地方更亮，暗的地方更暗</strong>。最终效果的色值的计算公式如下所示：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// B &lt;= 128 时</span></span><br><span class="line">C = <span class="variable constant_">AB</span>/<span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当B &gt; 128 时</span></span><br><span class="line">C = <span class="number">255</span> - [(<span class="number">255</span> - A)(<span class="number">255</span> - B)]/<span class="number">128</span></span><br></pre></td></tr></table></figure><h4 id="mix-blend-mode-soft-light"><a href="#mix-blend-mode-soft-light" class="headerlink" title="mix-blend-mode:soft-light"></a>mix-blend-mode:soft-light</h4><blockquote><p>soft-light的混合效果是柔光，就好像发散的光源四处弥漫，它的表现效果和hard-light有类似之处，只是表现没有hard-light那么强烈。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当B &lt;= 128 时</span></span><br><span class="line">C - <span class="variable constant_">AB</span>/<span class="number">128</span> + (A/<span class="number">255</span>)(A/<span class="number">255</span>)(<span class="number">255</span> - <span class="number">2</span> - B)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当B &gt; 128 时</span></span><br><span class="line">C = <span class="number">255</span> - [(<span class="number">255</span> - A)(<span class="number">255</span> - B)]/<span class="number">128</span></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/11/3-6.php">soft-light和hard-light混合模式效果对比</a></p><h4 id="mix-blend-mode-difference"><a href="#mix-blend-mode-difference" class="headerlink" title="mix-blend-mode:difference"></a>mix-blend-mode:difference</h4><blockquote><p>difference的混合效果是差值，最终颜色的色值是用较浅颜色的色值减去较深颜色的色值的结果，计算公式是：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = |A - B|</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/11/3-7.php">difference显示不同文字颜色实例</a></p><h4 id="mix-blend-mode-exclusion"><a href="#mix-blend-mode-exclusion" class="headerlink" title="mix-blend-mode:exclusion"></a>mix-blend-mode:exclusion</h4><blockquote><p>值exclusion的混合效果是排除，最终的混合效果和difference模式是类似的，区别在于exclusion的对比度要更低一些。最终效果的色值的计算公式是：</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = A + B - <span class="variable constant_">AB</span>/<span class="number">128</span></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/11/3-8.php">difference和exclusion混合模式效果对比</a></p><p><strong>4种都属于颜色系混合模式。</strong></p><h4 id="mix-blend-mode-hue"><a href="#mix-blend-mode-hue" class="headerlink" title="mix-blend-mode:hue"></a>mix-blend-mode:hue</h4><blockquote><p>值hue表示色调混合，作用是将颜色混合，使用底层元素的亮度和饱和度，以及上层元素的色调</p><p>需要注意的是，所有颜色系混合模式（色调、饱和度、颜色和亮度）都不要使用黑色进行混合，因为这样会挖掉底层元素的颜色信息，导致最终混合后的颜色是灰色</p></blockquote><h4 id="mix-blend-mode-saturation"><a href="#mix-blend-mode-saturation" class="headerlink" title="mix-blend-mode:saturation"></a>mix-blend-mode:saturation</h4><blockquote><p>值saturation表示饱和度混合，混合后的颜色保留底图的亮度和色调，并使用顶图的饱和度。</p></blockquote><h4 id="mix-blend-mode-color"><a href="#mix-blend-mode-color" class="headerlink" title="mix-blend-mode:color"></a>mix-blend-mode:color</h4><blockquote><p>值color表示颜色混合，混合后的颜色保留底图的亮度，并使用顶图的色调和饱和度。</p></blockquote><p>同样，颜色混合模式也可以通过使用CSS渐变让照片的色调变得丰富起来</p><p><a href="https://demo.cssworld.cn/new/11/3-9.php">颜色系混合模式和色盘混合效果</a></p><h4 id="mix-blend-mode-luminosity"><a href="#mix-blend-mode-luminosity" class="headerlink" title="mix-blend-mode:luminosity"></a>mix-blend-mode:luminosity</h4><blockquote><p>值luminosity表示亮度混合，混合后的颜色保留底图的色调和饱和度，并使用顶图的亮度，效果和color模式正好是相反的</p></blockquote><p><a href="https://demo.cssworld.cn/new/11/3-1.php">mix-blend-mode各个混合模式值效果实例</a></p><h3 id="滤镜和混合模式的化合反应"><a href="#滤镜和混合模式的化合反应" class="headerlink" title="滤镜和混合模式的化合反应"></a>滤镜和混合模式的化合反应</h3><h4 id="使用白天素材模拟夜晚"><a href="#使用白天素材模拟夜晚" class="headerlink" title="使用白天素材模拟夜晚"></a>使用白天素材模拟夜晚</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">night &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">256px</span>; <span class="attribute">height</span>: <span class="number">256px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">40</span>,<span class="number">140</span>,.<span class="number">6</span>) <span class="built_in">url</span>(<span class="string">./house-bed.jpg</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-blend-mode</span>: darken;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">80%</span>) <span class="built_in">grayscale</span>(<span class="number">20%</span>) <span class="built_in">contrast</span>(<span class="number">1.2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="照片美化处理"><a href="#照片美化处理" class="headerlink" title="照片美化处理"></a>照片美化处理</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">figure</span> class=&quot;_1977&quot;&gt;</span><br><span class="line">  &lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;<span class="number">10</span><span class="selector-class">.jpg</span>&quot;&gt;</span><br><span class="line">&lt;/<span class="selector-tag">figure</span>&gt;</span><br><span class="line">._1977 &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="comment">/* 应用滤镜 */</span></span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">contrast</span>(<span class="number">1.1</span>) <span class="built_in">brightness</span>(<span class="number">1.1</span>) <span class="built_in">saturate</span>(<span class="number">1.3</span>);</span><br><span class="line">&#125;</span><br><span class="line">._1977<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>; <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>; <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">243</span>,<span class="number">106</span>,<span class="number">188</span>,.<span class="number">3</span>);</span><br><span class="line">    <span class="comment">/* 应用混合模式 */</span></span><br><span class="line">    <span class="attribute">mix-blend-mode</span>: screen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="照片风格处理"><a href="#照片风格处理" class="headerlink" title="照片风格处理"></a>照片风格处理</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;sketch&quot;&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line"><span class="selector-class">.sketch</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">256px</span>; <span class="attribute">height</span>: <span class="number">171px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">10.jpg</span>) -<span class="number">2px</span> -<span class="number">2px</span>, <span class="built_in">url</span>(<span class="string">10.jpg</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">258px</span> <span class="number">173px</span>;</span><br><span class="line">    <span class="attribute">background-blend-mode</span>: difference;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">3</span>) <span class="built_in">invert</span>(<span class="number">1</span>) <span class="built_in">grayscale</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/new/11/3-10.php">滤镜和混合模式一起使用实例页面</a></p><h4 id="混合模式属性background-blend-mode"><a href="#混合模式属性background-blend-mode" class="headerlink" title="混合模式属性background-blend-mode"></a>混合模式属性background-blend-mode</h4><blockquote><p>background-blend-mode属性可以在各个背景图像之间应用混合模式。background-blend-mode属性的使用频率要明显低于mix-blend- mode属性，原因有以下两个。</p><ul><li>真实世界的照片很少作为background-image背景图像呈现，因为不利于无障碍访问，而混合模式设计的初衷就是处理这类照片。</li><li>background-blend-mode属性的作用机制不像mix-blend-mode属性那么单纯，很多开发者并不能很好地驾驭它。例如使用混合模式让透明背景的小图标变成渐变图标，很多人会使用mix-blend-mode属性实现，但是能够使用background-blend-mode属性实现的人寥寥无几。</li></ul></blockquote><p><a href="background-blend-mode%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%BA%B9%E7%90%86%E8%83%8C%E6%99%AF%E6%95%88%E6%9E%9C">background-blend-mode实现的纹理背景效果</a></p><h4 id="使用isolation-isolate声明隔离混合模式"><a href="#使用isolation-isolate声明隔离混合模式" class="headerlink" title="使用isolation: isolate声明隔离混合模式"></a>使用isolation: isolate声明隔离混合模式</h4><blockquote><p>isolation: isolate声明的作用很单纯，就是用来隔离混合模式，限制混合模式的作用范围。</p></blockquote><ul><li>auto是默认值，表示混合模式隔离与否根据具体情况而定。</li><li>isolate表示对混合模式进行隔离。</li></ul><blockquote><p>isolation:isolate声明之所以可以隔离混合模式，本质上是因为isolation: isolate创建了一个新的层叠上下文（stacking context）（有对层叠上下文不太了解的读者可以参阅《CSS世界》第214页第7章相关内容）。isolation:isolate本身并没有做什么特殊的事情，或者我可以这么大胆地说：“isolation:isolate除了创建层叠上下文，没有任何其他作用！”</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;CSS世界已经有了CSS2和CSS3，那会有CSS4吗？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;答案是：不会有CSS4！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;实际上，现在连CSS3这个词都已经名存实亡了，因为CSS3已经解体了。为什么说CSS3解体了呢？因为CSS按照大版本的方式进行迭代实在是太低效了。低效的原因其实很好理解，如果CSS这门语言必须按照大版本迭代发布的话，只要其中一个版本有一个CSS特性存在极大的争议，那这个版本的CSS的发布时间就会延后。例如，CSS2.1的规范在2002年开始制定，而一直到2011年才成为推荐规范，整个过程足足花费了10年的时间，就是因为一些次要的CSS特性拖了后腿。&lt;/p&gt;
&lt;p&gt;为了加速没有争议的CSS特性的标准化，W3C的CSS工作组做出了一项被称为“Beijing doctrine”的决定，该决定将CSS划分为更小的组件，并把这些组件称为模块。这些模块互相独立，各自按照自己的速度走向标准化。例如，CSS选择器模块已经到了Level 4了，弹性布局模块还是Level 1。&lt;/p&gt;
&lt;p&gt;将CSS划分为独立的模块是一个非常明智的决定，浏览器厂商可以根据对自己需求的判断决定究竟对哪些模块进行支持，哪怕这个模块还处于草案状态。例如CSS的env()函数的规范还是草案状态，但是Chrome和Safari浏览器的厂商却快速响应，对其进行了支持。对开发者而言，如此迅速地支持新特性犹如一场及时雨。&lt;/p&gt;
&lt;p&gt;当然，这种模块化的设计也不是没有弊端，最大的问题就是设计冗余。例如，弹性布局和网格布局中的对齐属性其实可以统一，但它们却是分离的，这就会徒增学习成本；分栏布局、弹性布局和网格布局中的间隙其实可以统一，但它们也都是分离的，各有各的间隙属性。好在纠正及时，现在这三大布局全部开始改用gap属性表示间隙，减少了因为模块化带来的设计冗余。&lt;/p&gt;
&lt;p&gt;模块化策略带来的好处远远大于弊端，正所谓瑕不掩瑜，与带来的好处相比，模块化设计的弊端几乎可以忽略不计。从这个角度看，CSS2.1之后的CSS世界就是模块化的新世界，所以我称之为CSS新世界。这个CSS新世界带来了新的CSS属性，并让很多CSS2中模糊的概念有了明确的定义，如尺寸体系、逻辑属性、CSS值类型划分等。CSS新世界中各模块虽然发展独立，但是相互间还是有很多共性和联系的。因此，CSS新世界不仅是一个模块化的世界，还是一个缤纷多彩，同时又自成一体的严谨的世界。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="htmlcss" scheme="https://wyf195075595.github.io/categories/htmlcss/"/>
    
    
    <category term="CSS" scheme="https://wyf195075595.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>CSS 2.1</title>
    <link href="https://wyf195075595.github.io/2022/10/20/programming/htmlcss/css2/"/>
    <id>https://wyf195075595.github.io/2022/10/20/programming/htmlcss/css2/</id>
    <published>2022-10-20T10:00:00.000Z</published>
    <updated>2022-11-10T01:38:23.003Z</updated>
    
    <content type="html"><![CDATA[<p>本章内容来自于《css的世界》-张鑫旭，类似于读书笔记吧。主要介绍css2.1的语法。本书主要用于进阶学习，不适用于初学者，书中也默认忽略一些基础的知识.</p><p>CSS2.1中的CSS属性的设计初衷是展示图文</p><h3 id="css-的世界"><a href="#css-的世界" class="headerlink" title="css 的世界"></a>css 的世界</h3><blockquote><p>已操作系统划分世界，不同的操作系统就是平行世界。每种浏览器就是一个王国。</p><p>在CSS世界中，HTML是魔法石，选择器就是选择法器，CSS属性就是魔法师，CSS各种属性值就是魔法师的魔法技能，浏览器就是他们所在的“王国”，“王国”会不断更新法律法规（版本升级），决定是否允许使用新的魔法石（HTML5新标签新属性），是否允许新的魔法师入“国籍”（CSS3新属性），或者允许魔法师使用某些新技能（CSS新的属性值），以及是否舍弃某些魔法技能（如display:run-in）；操作系统就是他们所在的世界，不同的操作系统代表不同的平行世界，所以，CSS世界有这么几个比较大的平行世界，即Windows世界、OS X世界以及移动端的iOS世界和Android世界。不同世界的浏览器王国的命运不一样，例如，在OS X世界中，IE王国是不存在的，而Safari王国却异常强大，但在Windows世界中，Safari王国却异常落寞。以上这一切就构成了完整的CSS世界的“世界观”。</p></blockquote><h3 id="专业术语"><a href="#专业术语" class="headerlink" title="专业术语"></a>专业术语</h3><ol><li><p>属性</p></li><li><p>值</p></li><li><p>关键字</p></li><li><p>变量</p></li><li><p>长度单位</p><p> 时间单位（如s、ms），还有角度单位（如deg、rad等）</p><p> 相对长度单位：如em,rem(相对字体),vh,vw,vmin,vmax(相对视区)</p><p> 绝对长度单位：px</p></li><li><p>功能符</p><p> 值以函数的形式指定（就是被括号括起来的那种），主要用来表示颜色（rgba和hsla）、背景图片地址（url）、元素属性值、计算（calc）和过渡效果等，如rgba(0,0,0, .5)、url(‘css-world.png’)、attr(‘href’)和scale(-1)。</p></li><li><p>属性值</p></li><li><p>声明</p><p> 属性名加上属性值就是声明</p></li><li><p>声明块</p><p> 就是选择器 {} 区域</p></li><li><p>规则或规则集</p><p>选择器后面的声明块就是一个规则集</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    ... 规则集</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>选择器</p></li><li><p>关系选择器</p><p>常见的符号有空格、&gt;、～，还有+等，这些都是非常常用的选择器。</p></li><li><p>@规则</p><p>@规则指的是以@字符开始的一些规则，像@media、@font-face、@page或者@support，诸如此类</p></li></ol><span id="more"></span><h3 id="未定义行为"><a href="#未定义行为" class="headerlink" title="未定义行为"></a>未定义行为</h3><blockquote><p>不同浏览器对某一行为可能没制定规则，或规则不一致。结果会出现的问题。</p><p>狭隘的说法就是浏览器出现bug了</p></blockquote><h3 id="流（文档流）"><a href="#流（文档流）" class="headerlink" title="流（文档流）"></a>流（文档流）</h3><blockquote><p>默认的流规则： 自上而下，从左到右</p></blockquote><p>在流中只有两种元素，内联，块级元素。块级元素具有换行属性,也就是一个水平流上只能单独显示一个元素，多个块级元素则换行显示。</p><p>理论上都能通过清除浮动去除影响</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clear</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;// 也可以是 block,list-item(使用这个要去除项目符号，IE不支持)</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="对-liet-item及-display-其他属性的理解"><a href="#对-liet-item及-display-其他属性的理解" class="headerlink" title="对  liet-item及 display 其他属性的理解"></a>对  liet-item及 display 其他属性的理解</h3><blockquote><p>为啥 list-item 会出现 项目符号，将其理解为附加盒子。只有它是特殊的</p><p>display: inline-block; 可以理解为 嵌套盒子，外边是内联盒子里边是块级盒子</p></blockquote><h3 id="widh-默认值是-auto"><a href="#widh-默认值是-auto" class="headerlink" title="widh 默认值是 auto"></a>widh 默认值是 auto</h3><p>包含了至少4种不同的表现</p><ol><li><p>充分利用空间</p><p> div,p这些元素宽度默认是100%于父级容器</p></li><li><p>收缩于包裹</p><p> 典型代表：浮动，绝对定位，inner-block元素或table元素。会收缩到合适宽度</p></li><li><p>收缩到最小</p><p> 容易出现在 table-layout为 auto 的表格中</p></li><li><p>超出容器限制</p><p> 除非明确width相关设置，否则上边3种情况尺寸都不会超过父级容器宽度。特殊情况长连续字母，数字或设置了 white-space: nowrap;</p></li></ol><h4 id="“鑫三无准则”，即“无宽度，无图片，无浮动”"><a href="#“鑫三无准则”，即“无宽度，无图片，无浮动”" class="headerlink" title="“鑫三无准则”，即“无宽度，无图片，无浮动”"></a>“鑫三无准则”，即“无宽度，无图片，无浮动”</h4><blockquote><p>内部尺寸：元素宽度由内部元素大小控制</p><p>外部尺寸：元素大小由外部容器大小绝定，就是上边 with auto 四种表现得第一种</p></blockquote><p>外部尺寸：<a href="http://demo.cssworld.cn/3/2-3.php">宽度设置后会丧失流动性</a></p><p>内部尺寸：</p><ol><li><a href="http://demo.cssworld.cn/3/2-4.php">包裹性</a> 实现文本少时居中显示，超出一行则居左显示</li><li><a href="http://demo.cssworld.cn/3/2-6.php">首选最小宽度</a> 实现一个凹凸文字效果</li><li><a href="http://demo.cssworld.cn/3/2-7.php">最大宽度</a> iScroll 根据元素尺寸和容器关系改变内部关系实现滚动</li></ol><h4 id="CSS流体布局下得宽度分离原则"><a href="#CSS流体布局下得宽度分离原则" class="headerlink" title="CSS流体布局下得宽度分离原则"></a>CSS流体布局下得宽度分离原则</h4><blockquote><p>就是CSS中的width属性不与影响宽度的padding/border（有时候包括margin）属性共存</p><p>但是css3 有 box-sizing属性可以改变盒模型就不需要这么麻烦了</p></blockquote><p>不能这样写</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;<span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">border</span>: <span class="number">1px</span> solid;&#125;</span><br><span class="line">或</span><br><span class="line"><span class="selector-class">.box</span> &#123;<span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">padding</span>: <span class="number">10px</span>;&#125;</span><br></pre></td></tr></table></figure><p>这样写</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.father</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">180px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="height-100-不生效"><a href="#height-100-不生效" class="headerlink" title="height: 100% 不生效"></a>height: 100% 不生效</h3><blockquote><p>对于普通文档流中的元素，百分比高度值要想起作用，其父级必须有一个可以生效的高度值！</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 页面设置全屏红色背景，不生效</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        .main &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        heiht: 100%;</span><br><span class="line">        background: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">// 除非 给 body,html 也同时设置了 height: 100%;</span><br></pre></td></tr></table></figure><h4 id="为啥宽度设置100-可以，高度就不行？"><a href="#为啥宽度设置100-可以，高度就不行？" class="headerlink" title="为啥宽度设置100%可以，高度就不行？"></a>为啥宽度设置100%可以，高度就不行？</h4><p>规范中其实给出了答案。</p><p>​    如果包含块的高度没有显式指定（即高度由内容决定），并且该元素不是绝对定位，则计算值为auto。一句话总结就是：因为解释成了auto。要知道，auto和百分比计算，肯定是算不了的</p><p>​    宽度的解释却是：如果包含块的宽度取决于该元素的宽度，那么产生的布局在CSS 2.1中是未定义的。</p><blockquote><p>还记不记得本书第2章最后的“未定义行为”吗？这里的宽度布局其实也是“未定义行为”，也就是规范没有明确表示该怎样，浏览器可以自己根据理解去发挥。好在根据我的测试，布局效果在各个浏览器下都是一致的。这里和高度的规范定义就区别明显了，高度明确了就是auto，高度百分比计算自然无果，width却没有这样的说法，因此，就按照包含块真实的计算值作为百分比计算的基数。</p></blockquote><h4 id="如何让元素支持-hieght-100-效果"><a href="#如何让元素支持-hieght-100-效果" class="headerlink" title="如何让元素支持 hieght: 100% 效果"></a>如何让元素支持 hieght: 100% 效果</h4><ol><li><p>设置显式得高度值</p></li><li><p>使用绝对定位</p><p> 需要注意的是，绝对定位元素的百分比计算和非绝对定位元素的百分比计算是有区别的，区别在于绝对定位的宽高百分比计算是相对于padding box的，也就是说会把padding大小值计算在内，但是，非绝对定位元素则是相对于content box计算的</p></li></ol><h4 id="为流体而生的min-width-max-width"><a href="#为流体而生的min-width-max-width" class="headerlink" title="为流体而生的min-width/max-width"></a>为流体而生的min-width/max-width</h4><blockquote><p>改变其值不会触发过度动画。</p><p>min-width/min-height的初始值是auto, max-width/max-height的初始值是none。</p><p>max-width/max-height的初始值为何是none而不是auto呢？</p><p>这个问题的答案其实与下面小节的内容有关。我们不妨举个简单的例子解释一下，已知父元素宽度400像素，子元素设置宽度800像素，假如说max-width初始值是auto，那自然使用和width一样的解析渲染规则，此时max-width的计算值就应该是父元素的400像素，此时，你就会发现，子元素的800像素直接完蛋了，因为max-width会覆盖width。于是，我们的width永远不能设置为比auto计算值更大的宽度值了，这显然是有问题的，这就是为什么max-width初始值是none的原因。</p></blockquote><p>权重 <strong>!important</strong> 在max-* 属性面前黯然失色</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;<span class="number">1</span><span class="selector-class">.jpg</span>&quot; style=&quot;<span class="attribute">width</span>: <span class="number">480px</span> <span class="meta">!important</span>;&quot;&gt;</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line"><span class="attribute">max-width</span>: <span class="number">256px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 结果是 max-width 覆盖了 width</p><h4 id="min-width-max-width-冲突"><a href="#min-width-max-width-冲突" class="headerlink" title="min-width/max-width 冲突"></a>min-width/max-width 冲突</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line"><span class="attribute">min-width</span>: <span class="number">1400px</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果是 min-width 存活，没有后来居上</p><h4 id="height-变化动画"><a href="#height-变化动画" class="headerlink" title="height 变化动画"></a>height 变化动画</h4><p>一个下拉框如果下拉内容不确定，设置 height:auto;  那么从0 -&gt; auto 的动画怎么计算展示</p><p>height使用的值是默认的auto，应该都知道的auto是个关键字值，并非数值，正如height:100%的100%无法和auto相计算一样，从0px到auto也是无法计算的，因此无法形成过渡或动画效果。</p><p>解决办法：</p><p>​    通过设置 max-height </p><p>但是 max-height 的值设置的过大则会导致延迟效果，建议max-height使用足够安全的最小值，这样，收起时即使有延迟，也会因为时间很短，很难被用户察觉，并不会影响体验。</p><h3 id="深入理解content"><a href="#深入理解content" class="headerlink" title="深入理解content"></a>深入理解content</h3><p><strong>内联盒子（inline box）</strong></p><p>  <strong>“内联盒子”</strong>不会让内容成块显示，而是排成一行，这里的<strong>“内联盒子”</strong>实际指的就是元素的<strong>“外在盒子”</strong>，用来决定元素是内联还是块级。该盒子又可以细分为<strong>“内联盒子”</strong>和<strong>“匿名内联盒子”</strong>两类：</p><p><img src="https://upload-images.jianshu.io/upload_images/11794918-7f5b2f269ef80945.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/603/format/webp" alt="img"></p><p>内联盒子</p><p><strong>行框盒子（line box）</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/11794918-f1889ebe5b82b2da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/590/format/webp" alt="img"></p><p>行框盒子</p><p>  每一行就是一个<strong>“行框盒子”</strong>（实线框标注），每个<strong>“行框盒子”</strong>又是由一个一个<strong>“内联盒子”</strong>组成的。每个行框盒子都前面有一个宽度为0的具有该元素的字体和行高属性的看不见的“幽灵空白节点”（strut）</p><p><strong>包含盒子（containing box）</strong></p><p><img src="https://upload-images.jianshu.io/upload_images/11794918-3561f2dc90a8ead3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/577/format/webp" alt="img"></p><p>包含盒子</p><p>标签就是一个“包含盒子”（实线框标注），此盒子由一行一行的“行框盒子”组成。<p>  需要补充说明一点，在CSS 规范中，并没有<strong>“包含盒子”</strong>的说法，更准确的称呼应该是<strong>“包含****块”</strong>（containing block）。这里之所以把它称为盒子，一是为了与其他盒子名称统一，二是称为盒子更形象、更容易理解。</p><p><strong>替换元素</strong></p><blockquote><p>什么是替换元素？</p><p>通过修改某个属性值呈现的内容就可以被替换的元素就称为“替换元素”。因此，<strong>img</strong>、<strong>替换元素</strong>、<strong>video</strong>、<strong>iframe</strong>或者表单元素<strong>textarea</strong>和<strong>input</strong>都是典型的替换元素。</p></blockquote><p>特性：</p><ol><li>内容的外观不受页面上的 CSS 的影响</li><li>有自己的尺寸。</li><li>在很多CSS属性上有自己的一套表现规则。</li></ol><p>替换元素的 display 属性值</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221010174705251.png" alt="image-20221010174705251"></p><h4 id="替换元素的尺寸计算"><a href="#替换元素的尺寸计算" class="headerlink" title="替换元素的尺寸计算"></a>替换元素的尺寸计算</h4><p>将替换元素的尺寸从内而外分为3类：固有尺寸、HTML尺寸和CSS尺寸。</p><ol><li><p>固有尺寸指的是替换内容原本的尺寸（简单说就是原文件的尺寸）</p><p> 例如，图片、视频作为一个独立文件存在的时候，都是有着自己的宽度和高度的</p></li><li><p>HTML尺寸这个概念略微抽象 （简单来说就是标签自带的width,hieght等属性）</p><p> 我们不妨将其想象成水煮蛋里面的那一层白色的膜，里面是“固有尺寸”这个蛋黄蛋白，外面是“CSS尺寸”这个蛋壳。“HTML尺寸”只能通过HTML原生属性改变，这些HTML原生属性包括<strong>img</strong>的width和height属性、<strong>input</strong>的size属性、<strong>textarea</strong>的cols和rows属性等。</p></li><li><p>CSS尺寸</p><p> 特指可以通过CSS的width和height或者max-width/min-width和max-height/min-height设置的尺寸，对应盒尺寸中的content box。</p></li></ol><p>权重： css尺寸&gt;HTML尺寸&gt;固有尺寸</p><h4 id="元素，图片的固定尺寸不受CSS宽高控制，那为何我们设定img的-width和height-属性会影响图片的尺寸呢？"><a href="#元素，图片的固定尺寸不受CSS宽高控制，那为何我们设定img的-width和height-属性会影响图片的尺寸呢？" class="headerlink" title="元素，图片的固定尺寸不受CSS宽高控制，那为何我们设定img的 width和height 属性会影响图片的尺寸呢？"></a><img>元素，图片的固定尺寸不受CSS宽高控制，那为何我们设定img的 width和height 属性会影响图片的尺寸呢？</h4><p>​    因为图片中的<strong>content</strong>替换内容默认的适配方式是填充（fill），也就是外部设定的尺寸多大，我就填满、跟着一样大。换句话说，尺寸变化的本质并不是改变固有尺寸，而是采用了填充作为适配HTML尺寸和CSS尺寸的方式，且在CSS3之前，此适配方式是不能修改的。</p><p>object-fit 属性就是用来修改图片设配方式的</p><blockquote><p>替换元素具有固定的宽高比例，所以如果只设置宽/高， 另一个属性会俺比例自动计算</p></blockquote><blockquote><p>如果任何尺寸都没有，则元素应该是300像素×150像素，这条规则 <strong>video</strong>、<strong>canvas</strong>和<strong>iframe</strong>这些元素都符合，唯独图片例外。</p><p>结果不仅不是这个尺寸，而且各个浏览器下的尺寸还不一样。IE浏览器下是28×30，如图4-2所示。Chrome浏览器下是0×0，如图4-3所示。Firefox浏览器下显示的是0×22</p></blockquote><blockquote><p>关于图片的src 属性：除非没有 src 属性，否则不管是空值还是其他值，很多浏览器下还是会发送请求</p></blockquote><blockquote><p>对于Firefox浏览器，src默认的<strong>img</strong>不是替换元素，而是一个普通的内联元素，所以使用的就不是替换元素的尺寸规则，而是类似<strong>span</strong>的内联元素尺寸规则，宽高会无效</p><p>修复需设置</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123; <span class="attribute">display</span>: inline-block; &#125;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>chrome 浏览器中 img 要想表象的像替换元素一样要设置 alt=”任意值”，否者就是一个普通的内联标签</p></blockquote><h4 id="src缺省时，img元素的alt信息展示"><a href="#src缺省时，img元素的alt信息展示" class="headerlink" title="src缺省时，img元素的alt信息展示"></a>src缺省时，img元素的alt信息展示</h4><ul><li><h5 id="HTML："><a href="#HTML：" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;美女沉思图&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;1.jpg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>设置src属性显示图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS："><a href="#CSS：" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">256px</span>; <span class="attribute">height</span>: <span class="number">192px</span>;</span><br><span class="line">    <span class="comment">/* 隐藏Firefox alt文字 */</span></span><br><span class="line">    <span class="attribute">color</span>: transparent;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[src]</span>) &#123;</span><br><span class="line">    <span class="comment">/* 隐藏Chrome alt文字以及银色边框 */</span></span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="comment">/* 淡蓝色占位背景 */</span></span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute; <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f0f3f9</span>;</span><br><span class="line">    <span class="attribute">visibility</span>: visible;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="comment">/* 黑色alt信息条 */</span></span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">attr</span>(alt);</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">5</span>);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">100%</span>);</span><br><span class="line">    <span class="comment">/* 来点过渡动画效果 */</span></span><br><span class="line">    <span class="attribute">transition</span>: transform .<span class="number">2s</span>;</span><br><span class="line">    <span class="attribute">visibility</span>: visible;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="JS："><a href="#JS：" class="headerlink" title="JS："></a>JS：</h5>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> eleButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;button&#x27;</span>),</span><br><span class="line">    eleImg = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (eleButton &amp;&amp; eleImg) &#123;</span><br><span class="line">    <span class="keyword">var</span> initValueButton = eleButton.<span class="property">innerHTML</span>;</span><br><span class="line">    <span class="comment">// 图片地址</span></span><br><span class="line">    <span class="keyword">var</span> srcImage = eleImg.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>);</span><br><span class="line">    <span class="comment">// 移除该属性</span></span><br><span class="line">    eleImg.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>);</span><br><span class="line">    <span class="comment">// 按钮点击事件</span></span><br><span class="line">    eleButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">innerHTML</span> == initValueButton) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;移除src属性&#x27;</span>;</span><br><span class="line">            <span class="comment">// 图片显示</span></span><br><span class="line">            eleImg.<span class="title function_">setAttribute</span>(<span class="string">&#x27;src&#x27;</span>, srcImage);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">innerHTML</span> = initValueButton;</span><br><span class="line">            <span class="comment">// src属性移除</span></span><br><span class="line">            eleImg.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;src&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>技巧：图片从普通元素变成替换元素，原本都还支持的：:before和：:after此时全部无效</p><p>兼容性问题</p><p>根据我的测试，目前Chrome和Firefox等浏览器支持，但IE浏览器不支持；其次，要想让Chrome或Firefox等浏览器生效，还有其他一些需要注意的技术点。</p><p>（1）不能有src属性（证明观点的关键所在）；</p><p>（2）不能使用content属性生成图片（针对Chrome）；</p><p>（3）需要有alt属性并有值（针对Chrome）；</p><p>（4）Firefox下：:before伪元素的content值会被无视，::after无此问题，应该与Firefox自己占用了：:before伪元素的content属性有关。</p></blockquote><blockquote><p>Chrome浏览器的渲染表现帮助我们更好地理解了替换元素。什么表现呢？就是在Chrome浏览器下，所有的元素都支持content属性，而其他浏览器仅在：:before/::after伪元素中才有支持</p></blockquote><p>实现设置默认图片</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[src]</span>) &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="content与替换元素关系剖析"><a href="#content与替换元素关系剖析" class="headerlink" title="content与替换元素关系剖析"></a>content与替换元素关系剖析</h4><blockquote><p>content属性生成的内容都是替换元素？没错，就是替换元素！</p></blockquote><ol><li><p>content生成的文本是无法选中、无法复制的</p></li><li><p>content生成的文本无法被屏幕阅读设备读取，也无法被搜索引擎抓取</p></li><li><p>不能左右：empty伪类 。content 中有内容也会被当成 空</p></li><li><p>content动态生成值无法获取</p><p> 计算动态值</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.total</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line"><span class="attribute">content</span>: <span class="built_in">counter</span>(icecrean)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 试图获取计算值时却只能拿到 “counter(icecrean)”</p></li></ol><blockquote><p>辅助实现“两端对齐”以及“垂直居中/上边缘/下边缘对齐”效果</p></blockquote><p>content换行符与打点loading效果实例页面</p><ul><li><h5 id="HTML：-1"><a href="#HTML：-1" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">正在加载中<span class="tag">&lt;<span class="name">dot</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dot</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-1"><a href="#CSS：-1" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dot &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block; </span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">    <span class="attribute">vertical-align</span>: -.<span class="number">25em</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line">dot<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;...\A..\A.&#x27;</span>;</span><br><span class="line">    <span class="attribute">white-space</span>: pre-wrap;</span><br><span class="line">    <span class="attribute">animation</span>: dot <span class="number">3s</span> infinite step-start both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> dot &#123;</span><br><span class="line">    <span class="number">33%</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2em</span>); &#125;</span><br><span class="line">    <span class="number">66%</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">1em</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>（1）为什么使用<dot>这个元素？</p><p>​    <dot>是自定义的一个标签元素，除了简约、语义化明显外，更重要的是方便向下兼容，IE8等低版本浏览器不认识自定义的HTML标签，因此，会乖乖地显示里面默认的3个点，对我们的CSS代码完全忽略。</p><p>（2）为什么使用：:before，可不可以使用：:after？</p><p>​    伪元素使用：:before同时display设置为block，是为了在高版本浏览器下原来的3个点推到最下面，不会影响content的3行内容显示，如果使用：:after怕是效果就很难实现了。</p><p>（3）从content属性值来看，是3个点在第1行，而1个点反而在最后一行，为什么这么处理？</p><p>​    3个点在第一行的目的在于兼容IE9浏览器，因为IE9浏览器认识<dot>以及：:before，但是不支持CSS新世界的animation属性，所以，为了IE9也能正常显示静态的3个点，故而把3个点放在第一行。</p><p>（4）这里white-space值为何使用的是pre-wrap而不是pre？</p><p>​    这里的white-space:pre-wrap改成white-space:pre效果其实是一样的</p><h4 id="深入理解content计数器"><a href="#深入理解content计数器" class="headerlink" title="深入理解content计数器"></a>深入理解content计数器</h4><blockquote><p>所谓CSS计数器效果，指的是使用CSS代码实现随着元素数目增多，数值也跟着变大的效果</p></blockquote><p>计数器有两个属性，一个方法</p><p>属性：</p><ul><li><p>counter-reset</p><p>  计数器-重置: 默认是0，可以设置初始值，可以是负整数，小数，不过，IE和Firefox对此都不识别，Chrome 小数向下取整</p></li><li><p>counter-increment</p><p>  计数器递增：值为counter-reset的1个或多个关键字</p></li></ul><p>方法：</p><ul><li><p>counter()/counters()</p><p>  -counter(name, style)</p><p>  name是计数器名， style 它支持lst-style-type支持的哪些值。作用：我们递增/减的不一定是数字，还可以是英文字母，罗马文等</p><p>  -counters(name, string, style)</p><p>  ​    此方法用于生成子序号 如 1-1，1-1-1</p><p>  ​    name: 计数器名， string:  表示子序号的连接字符串。</p></li></ul><p>counter 计算实例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.one &#123;</span><br><span class="line">    counter-reset: one 10 two 20;</span><br><span class="line">&#125;</span><br><span class="line">.one:before &#123;</span><br><span class="line">    content: counter(one) &#x27;~&#x27; counter(two);</span><br><span class="line">    counter-increment: one;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span>《计数器》<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>counters 计算实例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">ul</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">counter-reset</span>: two <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">list-style-type</span>: none;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">content</span>: <span class="built_in">counters</span>(two, <span class="string">&#x27;-&#x27;</span>) <span class="string">&#x27;：&#x27;</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">counter-increment</span>: two;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        第一章</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>结束<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二章<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        第三章</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>结束<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        第四章</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>结束<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>第五章<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="padding-属性"><a href="#padding-属性" class="headerlink" title="padding 属性"></a>padding 属性</h3><p>设置了 box-sizing: border-box; 后元素的 content 区域会自动计算。也就是说padding就可以随意设置。但是如果padding 足够大的花 元素的尺寸也是会发生变化的。</p><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时的width 会无效，最终宽度为120px ,而里面的内容则表现为 ”首选最小宽度“</p><blockquote><p>padding 对于内联元素的高度的影响。 对于内联元素padding 可以撑开元素的宽（影响布局尺寸）。但是高度却不行。虽然高度可以撑开（不影响布局尺寸）但是撑开的上下部分会与其他元素发生重叠</p></blockquote><h4 id="设置实例分割线"><a href="#设置实例分割线" class="headerlink" title="设置实例分割线"></a>设置实例分割线</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">a</span> href=&quot;&quot;&gt;登录&lt;/<span class="selector-tag">a</span>&gt;&lt;<span class="selector-tag">a</span> href=&quot;&quot;&gt;注册&lt;/<span class="selector-tag">a</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> + <span class="selector-tag">a</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">3px</span> <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">1px</span> solid gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="padding-的百分比值"><a href="#padding-的百分比值" class="headerlink" title="padding 的百分比值"></a>padding 的百分比值</h4><p>与margin 不同 ，padding 不支持 负值，支持%但是，和高度等属性%计算规则有些差异。</p><p>padding百分比值无论是水平方向还是垂直方向均是相对于宽度（父级宽度）计算的！</p><h4 id="按钮-button-的padding"><a href="#按钮-button-的padding" class="headerlink" title="按钮 button 的padding"></a>按钮 button 的padding</h4><p>按钮padding与高度计算不同浏览器下千差万别</p><p>如何统一：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">button &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">clip: react(0 0 0 0);</span><br><span class="line">&#125;</span><br><span class="line">label &#123;</span><br><span class="line">display: inline-block;</span><br><span class="line">line-height: 20px;</span><br><span class="line">padding: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="padding-实现三道杠-双层圆点图形效果小图标"><a href="#padding-实现三道杠-双层圆点图形效果小图标" class="headerlink" title="padding  实现三道杠 ,双层圆点图形效果小图标"></a>padding  实现三道杠 ,双层圆点图形效果小图标</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-menu</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">140px</span>; <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">35px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">10px</span> solid;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">10px</span> solid;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-dot</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">10px</span> solid;    </span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: currentColor;</span><br><span class="line">    <span class="attribute">background-clip</span>: content-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="padding-兼容性问题"><a href="#padding-兼容性问题" class="headerlink" title="padding 兼容性问题"></a>padding 兼容性问题</h4><blockquote><p>如果容器可以滚动，在IE和Firefox浏览器下是会忽略padding-bottom值的，Chrome等浏览器则不会。</p><p>本质区别在于：Chrome浏览器是子元素超过content box尺寸触发滚动条显示，而IE和Firefox浏览器是超过padding box尺寸触发滚动条显示。</p></blockquote><p>如 非Chrome浏览器中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 100px; padding: 50px 0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;0.jpg&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>底部没有50像素的padding-bottom间隙</p><p>兼容写法：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 100px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;0.jpg&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 50px 0;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="margin-属性"><a href="#margin-属性" class="headerlink" title="margin 属性"></a>margin 属性</h3><p>只要元素的尺寸表现符合“充分利用可用空间”，无论是垂直方向还是水平方向，都可以通过margin改变尺寸。</p><p>CSS世界默认的流方向是水平方向，因此，对于普通流体元素，margin只能改变元素水平方向尺寸；但是，对于具有拉伸特性的绝对定位元素，则水平或垂直方向都可以，因为此时的尺寸表现符合“充分利用可用空间”</p><ul><li><p>元素尺寸</p><p>  $().width()，$().height()方法 包括 padding和border。也就是元素的border-box尺寸。元素DOM API中 写作 offsetWidth和offsetHeight 也称为“元素偏移尺寸”</p></li><li><p>元素内部尺寸</p><p>  $().innerWidth()和$().innerHeight()方法，表示元素的内部区域尺寸，包括padding但不包括border，也就是元素的padding box的尺寸。在原生的DOM API中写作clientWidth和clientHeight，所以，有时候也称为“元素可视尺寸”</p></li><li><p>元素外部尺寸</p><p>  $().outerWidth(true)和$().outerHeight (true)方法，表示元素的外部尺寸，不仅包括padding和border，还包括margin，也就是元素的margin box的尺寸。没有相对应的原生的DOM API。</p></li></ul><blockquote><p>margin对尺寸没有影响，只有元素是“充分利用可用空间”状态的时候，margin才可以改变元素的可视尺寸。</p><p>因为只要宽度设定，margin就无法改变元素尺寸，这和padding是不一样的。</p></blockquote><h4 id="margin-实现-等高布局效果示意"><a href="#margin-实现-等高布局效果示意" class="headerlink" title="margin 实现 等高布局效果示意"></a><a href="http://demo.cssworld.cn/4/3-2.php">margin 实现 等高布局效果示意</a></h4><p>这里我们设置了margin-bottom:-9999px意味着元素的外部尺寸在垂直方向上小了9999px。默认情况下，垂直方向块级元素上下距离是0，一旦margin-bottom:-9999px就意味着后面所有元素和上面元素的空间距离变成了-9999px，也就是后面元素都往上移动了9999px。此时，通过神来一笔padding-bottom:9999px增加元素高度，这正负一抵消，对布局层并无影响，但却带来了我们需要的东西—视觉层多了9999px高度的可使用的背景色。但是，9999px太大了，所以需要配合父级overflow:hidden把多出来的色块背景隐藏掉，于是实现了视觉上的等高布局效果。</p><p>优点：兼容性好，可兼容IE6</p><p>缺点：如果需要有子元素定位到容器之外，父级的overflow:hidden是一个棘手的限制；其次，当触发锚点定位或者使用DOM.scrollIntoview()方法的时候，可能就会出现奇怪的定位问题</p><p>其他方法实现：例如使用display:table-cell布局，左右两栏作为单元格处理，或者使用border边框来模拟</p><ul><li><h5 id="HTML：-2"><a href="#HTML：-2" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;colLeft&quot;</span> <span class="attr">class</span>=<span class="string">&quot;column-left&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>正方观点<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>观点1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;colRight&quot;</span> <span class="attr">class</span>=<span class="string">&quot;column-right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>反方观点<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>观点1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;leftMore&quot;</span> <span class="attr">value</span>=<span class="string">&quot;更多正方观点&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;rightMore&quot;</span> <span class="attr">value</span>=<span class="string">&quot;更多反方观点&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-2"><a href="#CSS：-2" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.column-left</span>,</span><br><span class="line"><span class="selector-class">.column-right</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: -<span class="number">9999px</span>;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">9999px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.column-left</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#34538b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.column-right</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#cd0000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h5 id="JS：-1"><a href="#JS：-1" class="headerlink" title="JS："></a>JS：</h5>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $ = <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 分栏元素</span></span><br><span class="line"><span class="keyword">var</span> colLeft = $(<span class="string">&#x27;colLeft&#x27;</span>), colRight = $(<span class="string">&#x27;colRight&#x27;</span>);</span><br><span class="line"><span class="comment">// 按钮元素</span></span><br><span class="line"><span class="keyword">var</span> leftMore = $(<span class="string">&#x27;leftMore&#x27;</span>), rightMore = $(<span class="string">&#x27;rightMore&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 序号</span></span><br><span class="line"><span class="keyword">var</span> indexLeft = <span class="number">1</span>, indexRight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (colLeft &amp;&amp; colRight &amp;&amp; leftMore &amp;&amp; rightMore) &#123;</span><br><span class="line">    leftMore.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        indexLeft = indexLeft + <span class="number">1</span>;</span><br><span class="line">        colLeft.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, <span class="string">&#x27;&lt;p&gt;观点&#x27;</span>+ indexLeft +<span class="string">&#x27;&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    rightMore.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        indexRight = indexRight + <span class="number">1</span>;</span><br><span class="line">        colRight.<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, <span class="string">&#x27;&lt;p&gt;观点&#x27;</span>+ indexRight +<span class="string">&#x27;&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="margin-的百分比值"><a href="#margin-的百分比值" class="headerlink" title="margin 的百分比值"></a>margin 的百分比值</h4><blockquote><p>和padding属性一样，margin的百分比值无论是水平方向还是垂直方向都是相对于宽度计算的</p></blockquote><h4 id="margin-合并"><a href="#margin-合并" class="headerlink" title="margin 合并"></a>margin 合并</h4><blockquote><p>块级元素的上外边距（margin-top）与下外边距（margin-bottom）有时会合并为单个外边距，这样的现象称为“margin合并”</p></blockquote><ol><li><p>块级元素，但不包括浮动和绝对定位元素</p></li><li><p>只发生在垂直方向</p><p> 不考虑 writing-mode 的情况下才正确</p></li></ol><p><strong>margin 合并的3种场景</strong></p><ul><li><p>相邻兄弟元素margin合并</p></li><li><p><a href="http://demo.cssworld.cn/4/3-3.php">父级和第一个/最后一个子元素</a></p><p>  下面三种设置等效</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 80px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 80px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 80px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 80px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>如何阻止 margin 合并？</strong></p><p>对于margin-top 可以进行如下操作（满足一个条件即可）</p><ul><li><p> 父元素设置为块状格式化上下文元素；</p></li><li><p> 父元素设置border-top值；</p></li><li><p> 父元素设置padding-top值；</p></li><li><p> 父元素和第一个子元素之间添加内联元素进行分隔。</p></li></ul><p>对于margin-bottom 合并，可以进行如下操作（满足一个条件即可）：</p><ul><li><p>父元素设置为块状格式化上下文元素；</p></li><li><p>父元素设置border-bottom值；</p></li><li><p>父元素设置padding-bottom值；</p></li><li><p>父元素和最后一个子元素之间添加内联元素进行分隔；</p></li><li><p>父元素设置height、min-height或max-height。</p></li></ul><p>在尝试设置 元素之间添加 空 div 阻止合并时还需如下设置</p><ul><li><p>设置垂直方向的border；</p></li><li><p>设置垂直方向的padding；</p></li><li><p>里面添加内联元素（直接Space键空格是没用的）；</p></li><li><p>设置height或者min-height。</p></li></ul><p><strong>margin 合并的规则</strong></p><blockquote><p>计算规则总结为“正正取大值”“正负值相加”“负负最负值”</p></blockquote><p><strong>margin 合并的意义</strong></p><p>让我们的页面结构容错性更强了，比方说最后一个元素移除或位置调换，均不会破坏原来的布局，也就是我们的CSS无须做任何调整。</p><p><strong>margin: auto;</strong></p><p>在父元素有富余宽度时，可设置 margin: 0 auto; 左右居中。要设置垂直居中可以改变流方向(writing-mode: vertical-lr)。要做到垂直居中则需要借助定位.如下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.father</span> &#123;</span><br><span class="line">hieght<span class="selector-class">.father</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f0f3f9</span>;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span> &#123; </span><br><span class="line">    <span class="attribute">position</span>: absolute; </span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>; <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#cd0000</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果son 太大超过了father ，则margin会变化为0</p><p><strong>margin 无效的情况</strong></p><ol><li><p>display计算值inline的非替换元素的垂直margin是无效的</p><p> 对于内联替换元素，垂直margin有效，并且没有margin合并的问题，所以图片永远不会发生margin合并。</p></li><li><p>表格中的<tr>和<td>元素或者设置display计算值是table-cell或table-row的元素的margin都是无效的</p></li><li><p>margin合并的时候，更改margin值可能是没有效果的。除非超过当前最值</p></li><li><p>绝对定位元素非定位方位的margin值“无效”。</p><p> 如：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123; <span class="attribute">top</span>: <span class="number">10%</span>; <span class="attribute">left</span>: <span class="number">30%</span>; &#125;</span><br></pre></td></tr></table></figure><p> 此时right和bottom值属于auto状态，也就是右侧和底部没有进行定位，此时，这两个方向设置margin值我们在页面上是看不到定位变化的</p></li><li><p>定高容器的子元素的margin-bottom或者宽度定死的子元素的margin-right的定位“失效”。</p><p> 例如，一个普通元素，在默认流下，其定位方向是左侧以及上方，此时只有margin-left和margin-top可以影响元素的定位。但是，如果通过一些属性改变了定位方向，如float:right或者绝对定位元素的right右侧定位，则反过来margin-right可以影响元素的定位，margin-left只能影响兄弟元素。</p></li><li><p>鞭长莫及导致的margin无效</p><p> 如下例子：</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;mml.jpg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        内容</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.box &gt; img &#123;</span><br><span class="line">float: left;</span><br><span class="line">width: 256px;</span><br><span class="line">&#125;</span><br><span class="line">.box &gt; p &#123;</span><br><span class="line">overflow: hidden;</span><br><span class="line">margin-left: 200px;// 此时设置无效，准确地讲，此时的<span class="tag">&lt;<span class="name">p</span>&gt;</span>的margin-left从负无穷到256px都是没有任何效果的</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>）内联特性导致的margin无效 <strong>(*)</strong></p><p> 如下：</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">clss</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;mml.jpg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">.box &gt; img &#123;</span><br><span class="line">height: 96px;</span><br><span class="line">margin-top: -200px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 一个容器里面有一个图片，然后这张图片设置margin-top负值，让图片上偏移。但是，随着我们的负值越来越负，结果达到某一个具体负值的时候，图片不再往上偏移了。比方说，本例margin-top设置的是-200px，如果此时把margin-top设置成-300px，图片会再往上偏移100px吗？不会！它会微丝不动，margin-top变得无效了。要解释这里为何会无效，需要对vertical-align和内联盒模型有深入的理解</p></li></ol><h3 id="border-属性"><a href="#border-属性" class="headerlink" title="border 属性"></a>border 属性</h3><p><strong>为啥 border-width 不支持百分比值？</strong></p><p>margin，padding都是相对于宽度计算。假设如果boder支持%，那么不同宽度屏幕的相同%值的边框大小就不一样，显然不合边框的语义， 同时设计之初也没有需要使用%值得场景</p><p>支持得关键字：</p><ul><li>thin: 相当于px</li><li>medium: 相当于 3px (默认)</li><li>think: 相当于4px</li></ul><p>为啥 默认是medium，应为 border-style:double至少3px才有效果！</p><p><strong>border-style</strong></p><ul><li>solid 实线</li><li>dashed 虚线</li><li>dotted 虚点（IE中渲染为圆点，IE9一下不支持border-raduis,so…）</li><li>doble 双线边框</li><li>其他 inset（内凹）、outset（外凸）、groove（沟槽）、ridge（山脊）风格老土过时，且兼容性惨不忍睹</li></ul><p>计巧</p><ul><li><p><a href="https://demo.cssworld.cn/4/4-1.php">border绘制带加号的上传按钮</a></p></li><li><p>通过透明border 设置左右间距</p></li><li><p><a href="http://demo.cssworld.cn/4/4-2.php">增加点击区域大小</a></p></li><li><p>绘制三角形 (通过不同的 border-style 可绘制更多形状)</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">10px</span> solid;</span><br><span class="line">    <span class="attribute">border-color</span>: $f30 transparent transparent transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a href="http://demo.cssworld.cn/4/4-4.php">border实现等高布局</a> 通过border-left/right只持支2-3栏</p></li></ul><h3 id="内联与流"><a href="#内联与流" class="headerlink" title="内联与流"></a>内联与流</h3><h4 id="字母X与CSS世界的基线"><a href="#字母X与CSS世界的基线" class="headerlink" title="字母X与CSS世界的基线"></a>字母X与CSS世界的基线</h4><blockquote><p>在各种内联相关模型中，凡是涉及垂直方向的排版或者对齐的，都离不开最基本的基线（baseline）。例如，line-height行高的定义就是两基线的间距，vertical-align的默认值就是基线</p></blockquote><p><strong>CSS中有一个概念叫作x-height，指的是字母x的高度。</strong></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221012165319074.png" alt="image-20221012165319074"></p><ul><li><p>ascender height：上下线高度。</p></li><li><p>cap height：大写字母高度。</p></li><li><p>median：中线。</p></li><li><p>descender height：下行线高度。</p></li></ul><p><strong>vertical-align:middle</strong></p><p>这里的middle是中间的意思。注意，跟上面的median（中线）不是一个意思。在CSS世界中，middle指的是基线往上1/2 x-height高度。我们可以近似理解为字母x交叉点那个位置。</p><p><strong>字母中的x与CSS中的ex</strong></p><blockquote><p>ex是CSS中的一个相对单位，指的是小写字母x的高度，没错，就是指x-height。</p><p>ex的价值就在其副业上—不受字体和字号影响的内联元素的垂直居中对齐效果。</p></blockquote><p><a href="https://demo.cssworld.cn/5/1-1.php">基于ex单位的天然垂直居中对齐效果</a></p><ul><li><h5 id="CSS：箭头图标垂直对齐文字"><a href="#CSS：箭头图标垂直对齐文字" class="headerlink" title="CSS：箭头图标垂直对齐文字"></a>CSS：箭头图标垂直对齐文字</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-arrow</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1ex</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">/images/5/arrow.png</span>) no-repeat center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="内联元素的高度之本—line-height"><a href="#内联元素的高度之本—line-height" class="headerlink" title="内联元素的高度之本—line-height"></a><strong>内联元素的高度之本—line-height</strong></h4><p>一个空div 写上几个文字，请问div的高度是由什么决定的?</p><p>一般人都会觉得是文字font-size决定的，但本质上是由line-height属性全权决定的</p><p><a href="http://demo.cssworld.cn/5/2-1.php">例子如下</a>：</p><ul><li><h5 id="HTML：-3"><a href="#HTML：-3" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;test1&quot;</span>&gt;</span>我的高度是？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;test2&quot;</span>&gt;</span>我的高度是？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-3"><a href="#CSS：-3" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.test1</span>,</span><br><span class="line"><span class="selector-class">.test2</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">24px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.test1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.test2</span> &#123; </span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>行距，半行距、内容区域</strong></p><p>一般业界的共识是：行距= 行高 - em-box（一个概念）</p><p>转换成CSS语言就是：行距= line-height - font-size</p><p>内容区域：Firefox/IE浏览器下文本选中带背景色的区域</p><p><a href="http://demo.cssworld.cn/5/2-2.php%E3%80%82">半行间距</a></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221012171416152.png" alt="image-20221012171416152"></p><p>当字体是是宋体时，em-box 等高与 内容区域</p><p>假设line-height是1.5, font-size大小是14px，那么我们的半行距大小就是（套用上面的行距公式再除以2）:(14px ＊ 1.5-14px) / 2= 14px ＊ 0.25 = 3.5px。border以及line-height等传统CSS属性并没有小数像素的概念（从CSS3动画的细腻程度可以看出），因此，这里的3.5px需要取整处理，如果标注的是文字上边距，则向下取整；如果是文字下边距，则向上取整，因为绝大多数的字体在内容区域中都是偏下的。所以，假设设计师标注了文字字形上边缘到图片下边缘间距20px，则我们实际的margin-top值应该是17px，因为3.5px向下取整是3px。</p><p><a href="http://demo.cssworld.cn/5/2-3.php">line-height通过控制行距实现文字排版</a></p><blockquote><p>对于块级元素，line-height对其本身是没有任何作用的，我们平时改变line-height，块级元素的高度跟着变化实际上是通过改变块级元素里面内联级别元素占据的高度实现的。</p></blockquote><p><strong>line-height可以让内联元素“垂直居中”</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">24px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面样式可以实现单行文字垂直居中，这似乎是众所周知的。但实际上这种说法不够严谨，准确来说是近似垂直居中</p><p>垂直居中的原理就是 <strong>行距的上下等分机制</strong>，如果行距的添加规则是在文字的上方或者下方，则行高是无法让文字垂直居中的。</p><p>说“近似”是因为文字字形的垂直中线位置普遍要比真正的“行框盒子”的垂直中线位置低</p><p><strong><a href="http://demo.cssworld.cn/5/2-4.php">实现多行文字垂直居中</a></strong></p><p>这里的垂直居中其实也是近似</p><ul><li><h5 id="HTML：-4"><a href="#HTML：-4" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>基于行高实现的...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-4"><a href="#CSS：-4" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">280px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f0f3f9</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">    // 创建一个独立的“行框盒子.既能重置外部的<span class="attribute">line-height</span>为正常的大小，又能保持内联元素特性</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">    // 产生一个非常关键的“行框盒子”,每个“行框盒子”都会附带的一个产物—“幽灵空白节点”，即一个宽度为<span class="number">0</span>、表现如同普通字符的看不见的“节点”</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>line-height 属性的值</strong></p><ul><li><p>normal</p><p>  计算值，只要字体相同，各个浏览器下的默认line-height解析值基本上都是一样的。</p></li><li><p>数值</p><p>  其最终的计算值是和当前font-size相乘后的值，数值(1.5) * fontSize</p></li><li><p>百分比值</p><p>  如line-height:150%，其最终的计算值是和当前font-size相乘后的值。</p></li><li><p>长度值</p><p>  也就是带单位的值，如line-height:21px或者line-height:1.5em等。最终的计算值也是和当前font-size相乘后的值</p></li></ul><blockquote><p><a href="http://demo.cssworld.cn/5/2-5.php">继承细节有所差别</a>。如果使用数值作为line-height的属性值，那么所有的子元素继承的都是这个值；但是，如果使用百分比值或者长度值作为属性值，那么所有的子元素继承的是最终的计算值</p></blockquote><p><strong>内联元素line-height的大值特性</strong></p><blockquote><p>无论内联元素line-height如何设置，最终父级元素的高度都是由数值大的那个line-height决定的</p></blockquote><h4 id="vertical-align"><a href="#vertical-align" class="headerlink" title="vertical-align"></a><strong>vertical-align</strong></h4><blockquote><p>它是line-height 的好朋友，为啥这么说呢？应为line-height 生效的地方，vertical-align 也一定起作用</p></blockquote><p>很多人认为 单行文本只要设置行高是多少，其占据的高度就是多少。<a href="http://demo.cssworld.cn/5/3-1.php">看下面一个例子</a></p><ul><li><h5 id="HTML：-5"><a href="#HTML：-5" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-5"><a href="#CSS：-5" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">24px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  box 盒子高度是多少？</p></li></ul><p>很多人认为 box 高度是32px, 因为没有设置高度，高度由line-height 决定。然而实际上确实要大那么几像素（受字体影响，增加高度不一样），比方说36px</p><p>为啥会这样呢？其实这里是vertical-align 下了黑手</p><p>其中一个关键点，那就是 fontSize 设置在span ,这就导致 box的fontSize 与 span 有差异。这时我们可以通过设置: 字体大小统一，或者设置对齐方式来 解决这个问题</p><h4 id="vertical-align-的属性值"><a href="#vertical-align-的属性值" class="headerlink" title="vertical-align 的属性值"></a><a href="http://demo.cssworld.cn/5/3-2.php">vertical-align 的属性值</a></h4><ul><li>数值百分比类，如20px、2em、20%等。•</li><li>上标下标类，如sub、super；•</li><li>文本类，如text-top、text-bottom；•</li><li>线类，如baseline（默认值）、top、middle、bottom；</li></ul><p>经过一番测试我们可以发现负值全部都是往下偏移，正值全部都是往上偏移，而且数值大小全部都是相对于基线位置计算的，因此，从这一点来看，<strong>vertical-align:baseline 等同于 vertical-align:0</strong>。</p><blockquote><p>margin和padding是相对于宽度计算的，line-height是相对于font-size计算的，而这里的vertical-align属性的百分比值则是相对于line-height的计算值计算的。</p></blockquote><p><strong>vertical-align 作用的前提</strong></p><p>有时候我们想设置 vertical-align 但是却不生效，为啥？</p><p>因为vertical-align起作用是有前提条件的，这个前提条件就是：<strong>只能应用于内联元素以及display值为table-cell的元素。</strong>换句话说，vertical-align属性只能作用在display计算值为inline、inline-block, inline-table或table-cell的元素上。因此，默认情况下，<strong>span</strong>、<strong>strong</strong>、<strong>em</strong>等内联元素，<strong>img</strong>、<strong>button</strong>、<strong>input</strong>等替换元素，非HTML规范的自定义标签元素，以及<td>单元格，都是支持vertical-align属性的，其他块级元素则不支持。</p><blockquote><p>如果设置了元素 浮动，定位 会让元素块状化。然后导致vertical-align不起作用</p></blockquote><p><strong>另一种不生效情况如下：</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">128px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;box&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;<span class="number">1</span><span class="selector-class">.jpg</span>&quot; &gt;</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure><p>这种情况 图片顶着 box 上边缘，为啥不起作用？实际上是行框盒子前面的 <strong>幽灵空包节点</strong>高度太小，如果我们设置足够大的行高让 ”<strong>幽灵节点</strong>“ 高度足够，就会看到效果了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">128px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">128px</span>; // 关键</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>为啥 diaplay: table-cell 可以无视行高？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">128px</span>;</span><br><span class="line">    <span class="attribute">display</span>: table-cell;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;box&quot;&gt;</span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=&quot;<span class="number">1</span><span class="selector-class">.jpg</span>&quot; &gt;</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure><p>对table-cell元素而言，vertical-align起作用的是table-cell元素自身</p><p><strong><a href="http://demo.cssworld.cn/5/3-5.php">消除底部间隙</a></strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">280px</span>;</span><br><span class="line"><span class="attribute">outline</span>: <span class="number">1px</span> solid <span class="number">#aaa</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>结果 box 元素 高度肯能就无缘无故多了5 px.</p><p>间隙产生的三大元凶就是“幽灵空白节点”、line-height和vertical-align属性</p><ol><li>图片块状化。可以一口气干掉“幽灵空白节点”、line-height和vertical-align。</li><li>容器line-height足够小。只要半行间距小到字母x的下边缘位置或者再往上，自然就没有了撑开底部间隙高度空间了。比方说，容器设置line-height:0。</li><li>容器font-size足够小。此方法要想生效，需要容器的line-height属性值和当前font-size相关，如line-height:1.5或者line-height:150%之类；否则只会让下面的间隙变得更大，因为基线位置因字符x变小而往上升了。</li><li>图片设置其他vertical-align属性值。间隙的产生原因之一就是基线对齐，所以我们设置vertical-align的值为top、middle、bottom中的任意一个都是可以的。</li></ol><p><strong>内联特性导致的margin无效</strong></p><blockquote><p>而在CSS世界中，非主动触发位移的内联元素是不可能跑到计算容器外面的，导致图片的位置被“幽灵空白节点”的vertical-align:baseline给限死了</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">96px</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    x<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../images/b2.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在幽灵节点处使用X代替，因为字符x下边缘和图片下边缘对齐，字符x非主动定位，不可能跑到容器外面，所以图片就被限死在此问题，margin-top失效。</p><p><strong>inline-block与baseline</strong></p><blockquote><p>vertical-align属性的默认值<strong>baseline</strong>在<strong>文本之类的内联元素</strong>那里就是<strong>字符x的下边缘</strong>，对于<strong>替换元素</strong>则是<strong>替换元素的下边缘</strong>。但是，如果是<strong>inline-block元素</strong>，则规则要复杂了：一个inline-block元素，如果里面<strong>没有内联元素，或者overflow不是visible</strong>,则该元素的基线就是其<strong>margin底边缘</strong>；否则其基线就是元素里面<strong>最后一行内联元素的基线</strong>。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;dib-baseline&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;dib-baseline&quot;</span>&gt;</span>x-baselinex-baselinex-baselinex-baselinex-baseline<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dib-baseline</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>; <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221013154058106.png" alt="image-20221013154058106"></p><p><a href="http://demo.cssworld.cn/5/3-6.php">text-align:jusitfy声明可以帮助我们实现兼容的列表两端对齐效果</a></p><p><a href="http://demo.cssworld.cn/5/3-7.php">处理图标对齐</a></p><p><strong><a href="http://demo.cssworld.cn/5/3-8.php">vertical-align middle 近似垂直居中的原因</a>)</strong></p><ul><li><p>内联元素：元素的垂直中心点和行框盒子基线往上1/2 x-height处对齐（就是字符x的交叉点位置）。</p></li><li><p>table-cell元素：单元格填充盒子相对于外面的表格行居中对齐。</p></li></ul><blockquote><p>基本上所有的字体中，字符x的位置都是偏下一点儿的，font-size越大偏移越明显，这才导致默认状态下的vertial-align:middle实现的都是“近似垂直居中”。</p><p>如果想要实现真正意义上的垂直居中对齐，只要想办法让字符x的中心位置就是容器的垂直中心位置即可，通常的做法是设置font-size:0。</p></blockquote><p><strong><a href="http://demo.cssworld.cn/5/3-9.php">vertical-align 的顶部，底部对齐</a></strong></p><ul><li>vertical-align:text-top：盒子的顶部和父级内容区域的顶部对齐。</li><li>vertical-align:text-bottom：盒子的底部和父级内容区域的底部对齐。</li></ul><p><strong><a href="http://demo.cssworld.cn/5/3-10.php">基于vertical-align属性的水平垂直居中弹框</a></strong></p><ul><li><h5 id="HTML：-6"><a href="#HTML：-6" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>内容占位<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-6"><a href="#CSS：-6" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>; <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* for IE8 */</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">data:image/png;base64,iVB...g==</span>);</span><br><span class="line">    <span class="comment">/* for IE9+ */</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">5</span>), none;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dialog</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">    <span class="attribute">white-space</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="流的破坏与保护"><a href="#流的破坏与保护" class="headerlink" title="流的破坏与保护"></a>流的破坏与保护</h3><h4 id="float"><a href="#float" class="headerlink" title="float"></a>float</h4><blockquote><p>设计初衷：浮动的本质就是为了实现文字环绕效果（即“父级高度塌陷”和“行框盒子区域限制”）</p><p>float属性有个著名的特性表现，就是会让父元素的高度塌陷。</p></blockquote><ul><li><p>浮动锚点</p><p>  浮动锚点是float元素所在的“流”中的一个点，这个点本身并不浮动，就表现而言更像一个没有margin、border和padding的空的内联元素。</p></li><li><p>浮动参考</p><p>  指的是浮动元素对齐参考的实体</p></li></ul><blockquote><p>浮动锚点其作用就是产生“行框盒子”，因为“浮动锚点”表现如同一个空的内联元素，有内联元素自然就有“行框盒子”，于是，float元素对齐的参考实体“行框盒子”对于块状元素也同样适用了，只不过这个“行框盒子”由于没有任何内容，所以无尺寸，看不见也摸不着罢了。</p></blockquote><p>例子：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">右边新增一个a标签</span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>更多<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">a 标签设置 float: right;</span><br><span class="line"></span><br><span class="line">当标题文字出现换行时，更多 显示的位置？</span><br><span class="line">IE6/7中浮动元素会在第二行显示，IE8以上的浏览器会显示在第一行</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在CSS世界中，float元素的“浮动参考”是“行框盒子”，也就是float元素在当前“行框盒子”内定位</p><p>每一行内联元素都有一个“行框盒子”，这个例子中标题文字比较多，两行显示了，因此有上下两个“行框盒子”，而“更多”所在的<strong>a</strong>元素是在标题文字后面，位于第二行，因此，这里设置了float:right的<strong>a</strong>元素是相对于第二行的“行框盒子”对齐的。</p><p>那如果标题文字刚好够两行，那么 <strong>更多</strong>显示的位置是？</p><p>会单独展示在第三行？</p><p><strong><a href="http://demo.cssworld.cn/6/1-2.php">利用float 破坏流特性的两栏自适应布局</a></strong></p><p><strong>clear 属性</strong></p><blockquote><p>用来专门处理float 属性带来的塌陷问题</p><p>官方对clear属性的解释是：“元素盒子的边不能和前面的浮动元素相邻。”</p><p>就是设置了clear属性的元素自身如何如何，而不是让float元素如何如何</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">clear</span>: none | left| right | both;</span><br></pre></td></tr></table></figure><p>我们一般常用 both 几乎不使用 right/left,应为 用它们时肯定可以用 both 代替</p><p>因为clear属性只有块级元素才有效，而 :after的伪类元素都是内联水平， 所以需要手动设置display</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clear</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;// block/list-item</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>由于clear:both的作用本质是让自己不和float元素在一行显示，并不是真正意义上的清除浮动，因此float元素一些不好的特性依然存在，于是，会有类似下面的现象。</p></blockquote><p>由于clear:both的作用本质是让自己不和float元素在一行显示，并不是真正意义上的清除浮动，因此float元素一些不好的特性依然存在，于是，会有类似下面的现象。</p><ul><li>如果clear:both元素前面的元素就是float元素，则margin-top负值即使设成-9999px，也不见任何效果。</li><li>clear:both后面的元素依旧可能会发生文字环绕的现象</li></ul><h4 id="css世界的结界"><a href="#css世界的结界" class="headerlink" title="css世界的结界"></a><strong>css世界的结界</strong></h4><blockquote><p>BFC全称为block formatting context，中文为“块级格式化上下文”。</p><p>表现原则：如果一个元素具有BFC，内部子元素再怎么翻江倒海、翻云覆雨，都不会影响外部的元素。</p></blockquote><p><strong>触发BFC</strong></p><p>满足下面条件之一即可：</p><ul><li><html>根元素；</li><li>float的值不为none；</li><li>overflow的值为auto、scroll或hidden；</li><li>display的值为table-cell、table-caption和inline-block中的任何一个；</li><li>position的值不为relative和static。</li></ul><p>总结一下，我们对BFC声明家族大致过了一遍，能担任自适应布局重任的也就是以下几个。</p><ul><li>• overflow:auto/hidden，适用于IE7及以上版本浏览器；</li><li>• display:inline-block，适用于IE6和IE7；</li><li>• display:table-cell，适用于IE8及以上版本浏览器。</li></ul><p>最后，我们可以提炼出两套IE7及以上版本浏览器适配的自适应解决方案。</p><p>（1）借助overflow属性，如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.lbf-content</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（2）融合display:table-cell和display:inline-block，如下：[插图]</p><p>单元格有一个非常神奇的特性，就是宽度值设置得再大，实际宽度也不会超过表格容器的宽度.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.lbf-content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table-cell; <span class="attribute">width</span>: <span class="number">9999px</span>;</span><br><span class="line">    <span class="comment">/*如不需要兼容IE7 下面样式可省略*/</span></span><br><span class="line">    <span class="attribute">display</span>: inline-block; <span class="attribute">width</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于 display: table-cell; 元素内连续英文无法换行。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.word-break</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">table-layout</span>: fixed;</span><br><span class="line">    <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="最佳结界-overflow"><a href="#最佳结界-overflow" class="headerlink" title="最佳结界 overflow"></a><strong>最佳结界 overflow</strong></h4><blockquote><p>要想彻底清除浮动的影响，最适合的属性不是clear而是overflow。一般使用overflow:hidden，利用BFC的“结界”特性彻底解决浮动对外部或兄弟元素的影响</p></blockquote><p><strong>overflow-x和overflow-y</strong></p><blockquote><p>如果overflow-x和overflow-y属性中的一个值设置为visible而另外一个设置为scroll、auto或hidden，则visible的样式表现会如同auto。也就是说，除非overflow-x和overflow-y的属性值都是visible，否则visible会当成auto来解析。换句话说，永远不可能实现一个方向溢出剪裁或滚动，另一方向内容溢出显示的效果。</p></blockquote><p><strong>overflow与滚动条</strong></p><p>HTML 中默认产生滚动的条的标签： html,textarea. 应为它们的overflow 属性默认值不是 visible，而是 auto</p><p><strong>关于浏览器滚动条</strong></p><ul><li>针对PC端：无论是啥浏览器，默认滚动条均来自 html,而不是body .如需去除页面默认滚动条只需</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;<span class="attribute">overflow</span>: hidden;&#125;</span><br></pre></td></tr></table></figure><ul><li>滚动条会占用容器的可用宽度或高度。（移动端不会）</li></ul><p>实现表头固定，表格内容可滚动效果，一般使用双表格实现，但是当表格内容出现滚动条时，页面可能出现晃动，应为一开始没有滚动条后面出现滚动条，此时页面可用宽度发生变化，水平居中重新计算，导致页面发生晃动，体验非常不好。下边推荐一剂良药</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">    <span class="attribute">overflow-x</span>: hide;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">:root</span> <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>基本上药到病除，而且后遗症非常少，大家不妨试试！</p><p>对于Chrome浏览器：</p><p>• 整体部分，::-webkit-scrollbar；</p><p>• 两端按钮，::-webkit-scrollbar-button；</p><p>• 外层轨道，::-webkit-scrollbar-track；</p><p>• 内层轨道，::-webkit-scrollbar-track-piece；</p><p>• 滚动滑块，::-webkit-scrollbar-thumb；</p><p>• 边角，::-webkit-scrollbar-corner</p><p>但平时开发只用下面3个属性：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="comment">/*血槽厚度*/</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    <span class="comment">/*拖动条*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.3</span>)</span><br><span class="line">        boorder-radius: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line">::-webkit-scrollbar-track &#123;</span><br><span class="line">    <span class="comment">/*背景槽*/</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>依赖overflow 的文字溢出</strong></p><p>单行超出隐藏</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.overfolw</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">overflow</span>: hide;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最多显示2行</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ell-rows-2</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    -webkit-box-orient: vertical;</span><br><span class="line">    -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>overflow与锚点定位</strong></p><p>锚点定位： 通过 元素Id 属性，与a标签 href属性联动</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#1&quot;</span>&gt;</span>发展历程<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    发展历程</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span>&gt;</span>返回顶部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>锚点定位行为的发生，本质上是通过改变容器滚动高度或者宽度来实现的</p><p><a href="https://demo.cssworld.cn/6/4-2.php#four">URL锚链锚点定位和overflow的选项卡切换效果实例页面</a></p><blockquote><p>通过URL锚点定位有一个问题，如果页面有滚动条，切换时页面会发生滚动，而focus定位却不会（overflow:hiden;只是没有显示滚动条不影响锚点定位）</p></blockquote><p><a href="https://demo.cssworld.cn/6/4-3.php">focus锚点定位和overflow的选项卡切换效果实例页面</a></p><blockquote><p>原理其实很简单，就是在每个列表里塞入一个肉眼看不见的<input>输入框，然后选项卡按钮变成<label>元素，并通过for属性与<input>输入框的id相关联，这样，点击选项按钮会触发输入框的focus行为，触发锚点定位，实现选项卡切换效果</p></blockquote><h4 id="float的兄弟position-absolute"><a href="#float的兄弟position-absolute" class="headerlink" title="float的兄弟position:absolute"></a><strong>float的兄弟position:absolute</strong></h4><blockquote><p>都兼具“块状化”“包裹性”“破坏性”等特性，不少布局场合甚至可以相互替代</p><p>absolute和float可以看作是“同父异母”的兄弟关系</p></blockquote><p><strong>absolute的包含块</strong></p><blockquote><p>就是元素用来计算和定位的一个框</p><p>有经验的人应该都知道，普通元素的百分比宽度是相对于父元素的content box宽度计算的，而绝对定位元素的宽度是相对于第一个position不为static的祖先元素计算的。</p></blockquote><ol><li><p>根元素（大多数场景下html就是）被称为“初始包含快”，其尺寸等同于浏览器窗口大小</p></li><li><p>如果元素position: fixed; 则包含块是初始包含快</p></li><li><p>如果该元素的position是relative或者static，则“包含块”由其最近的块容器祖先盒的content box边界形成。</p></li><li><p>如果元素position:absolute，则“包含块”由最近的position不为static的祖先元素建立</p><p> 如果该祖先是纯inline元素则规则略微复杂：</p><ul><li>假设给内联元素的前后各生成一个宽度为0的内联盒子（inline box），则这两个内联盒子的padding box外面的包围盒就是内联元素的“包含块”；</li><li>如果该内联元素被跨行分割了，那么“包含块”是未定义的，也就是CSS2.1规范并没有明确定义，浏览器自行发挥。</li><li>否则，“包含块”由该祖先的padding box边界形成。如果没有符合条件的祖先元素，则“包含块”是“初始包含</li></ul></li></ol><p>和常规元素相比，absolute绝对定位元素的“包含块”有以下3个明显差异：</p><p>（1）内联元素也可以作为“包含块”所在的元素；</p><p>（2）“包含块”所在的元素不是父块级元素，而是最近的position不为static的祖先元素或根元素；</p><p>（3）边界是padding box而不是content box。</p><blockquote><p>position: absolute;<a href="http://demo.cssworld.cn/6/5-1.php">定位元素的最大宽度会受到包含块宽度的影响</a>。</p></blockquote><blockquote><p>元素padding值可能会影响 到 内部 absolute 定位元素的位置 </p></blockquote><p><strong>对 absolute 的误区</strong></p><p><a href="http://demo.cssworld.cn/6/5-4.php">一个绝对定位元素，没有任何left/top/right/bottom属性设置，并且其祖先元素全部都是非定位元素，其位置在哪里？</a></p><p>很多人都会认为是在浏览器窗口左上方，其实不是的，还是当前位置。</p><blockquote><p>正是这种错误认知导致凡是使用absolute绝对定位的地方，一定父容器position:relative，同时left/top等属性定位，甚至必同时使用z-index属性设置层级。</p></blockquote><blockquote><p>我把这种没有设置left/top/right/bottom属性值的绝对定位称为“无依赖绝对定位”</p><p>“无依赖绝对定位”本质上就是一个不占据任何空间的相对定位元素</p><p><a href="https://demo.cssworld.cn/6/5-5.php">无依赖绝对定位的强大之处</a></p><p><a href="http://demo.cssworld.cn/6/5-6.php">“无依赖绝对定位”与超越常规布局的排版实例页面</a></p><p><a href="http://demo.cssworld.cn/6/5-7.php">下拉列表定位</a></p></blockquote><p>虽然“无依赖绝对定位”好处多多，但建议只用在静态交互效果上，比方说，导航二级菜单的显示与定位。如果是动态呈现的列表，建议还是使用JavaScript来计算和定位。</p><p><strong>无依赖绝对定位 对内联，块级元素表现</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.follow</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;follow&quot;</span>&gt;</span>span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;follow&quot;</span>&gt;</span>div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>那么由于非绝对定位状态下span和div都在“标题”的下面，因此，这里最后的效果也同样是都在“标题”的下面。</p><p><strong>浮动与无依赖绝对定位 不一致的表现</strong></p><p>当“浮动”和“无依赖绝对定位”相遇的时候，就会发生一些不愉快的事情</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>+&quot;<span class="attr">nav</span>&quot;&gt;</span> 导航1 <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;new.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;follow&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span> &gt;</span>导航2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.follow</span> &#123;</span><br><span class="line">    posotion: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果在IE和Chrome浏览器下，夹在中间的<strong>img</strong>在中间显示，但是Firefox浏览器却是在最后显示</p><p>对于上述场景，如果希望各个浏览器的表现都是一样的，<strong>img</strong>外层嵌套一层标签并浮动即可，注意，是外层标签浮动。由于浮动和绝对定位水火不容，本身设置浮动是没有任何效果的。</p><hr><p><strong>absolute与text-align</strong></p><p>按道理讲，absolute 与 float 一样，都可以让元素块状化，应该不会受到内联元素对齐的text-align属性的影响。但 <a href="http://demo.cssworld.cn/6/5-8.php">text-align 可以改变absolute元素位置</a></p><ul><li><h5 id="HTML：-7"><a href="#HTML：-7" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-7"><a href="#CSS：-7" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>; <span class="attribute">height</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eef0f6</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>这里之所以产生了位置变化，本质上是“幽灵空白节点”和“无依赖绝对定位”共同作用的结果。</p></blockquote><p>img是内联水平， 所以p标签内 存在行框盒子，会存在幽灵节点。由于 img 设置了absolute 不占据位置，所以幽灵节点就居中了。根据无依赖绝对定位规则 图片就跟在幽灵节点后面。设置幽灵节点位置对齐间接影响了 img</p><p><a href="http://demo.cssworld.cn/6/5-10.php">通过幽灵节点影响定位元素实现返回顶部</a></p><ul><li><h5 id="HTML：-8"><a href="#HTML：-8" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;constr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alignright&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;follow&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;circle.png&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;backtop.png&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-8"><a href="#CSS：-8" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.constr</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f0f3f9</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.alignright</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: right;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.alignright</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\2002&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.follow</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.follow</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="absolute与overflow"><a href="#absolute与overflow" class="headerlink" title="absolute与overflow"></a><strong>absolute与overflow</strong></h4><p>上边示例代码中， 设置了hieght: 0; 又设置了overflow: hidden;那岂不是内容会被剪裁至不可见？</p><blockquote><p>官方：绝对定位元素不总是被父级overflow属性剪裁，尤其当overflow在绝对定位元素及其包含块之间的时候。</p><p>换一种方法表述就是：如果overflow 不是定位元素，同时绝对定位元素和 overflow 容器之间也没有定位元素，则overflow无法对absolute元素进行剪裁。</p></blockquote><p>下面HTML中图片不会被裁剪</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absollute;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>overflow 元素父级是定位元素也不会被裁决</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: relative;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果overflow属性所在的元素同时也是定位元素，里面的绝对定位元素会被剪裁：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden; position: relative;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absollute;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果overflow元素和绝对定位元素之间有定位元素，也会被剪裁：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: relative;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>最后，非常有必要补充一点，那就是由于position:fixed固定定位元素的包含块是根元素，因此，除非是窗体滚动，否则上面讨论的所有overflow剪裁规则对固定定位都不适用。</p><p>overflow元素自身transform的时候，Chrome和Opera浏览器下的overflow剪裁是无效的</p><p>transform除了改变overflow属性原有规则，对层叠上下文以及position:fixed的渲染都有影响</p></blockquote><h4 id="absolute与clip"><a href="#absolute与clip" class="headerlink" title="absolute与clip"></a><strong>absolute与clip</strong></h4><p>普通元素可以使用 overflow 进行裁剪，但是 fixed 元素 包含快是根元素，所以只能使用clip</p><p>clip属性要想起作用，元素必须是绝对定位或者固定定位，也就是position属性值必须是absolute或者fixed。</p><p>语法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">clip</span>: <span class="built_in">rect</span>(top right bottom left)</span><br></pre></td></tr></table></figure><p>实际语法应该是：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">clip</span>: <span class="built_in">rect</span>(top, right, bottom, left)</span><br></pre></td></tr></table></figure><blockquote><p>就顺序而言，top→right→bottom→left在CSS世界中是一脉相承的，和margin/border-width等属性的4个值的顺序一样，都是从top开始，顺时针旋转。</p><p>这里的4个值有一个明显不一样的地方，就是不能缩写，且和border-width类似，是不支持百分比值的。</p></blockquote><p>场景：很多网站左上角都有包含自己网站名称的标识（logo），而这些标识一般都是图片，为了更好地SEO以及无障碍识别，我们一般会使用&lt;h1&gt;标签写上网站的名称，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        css 世界</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如何隐藏&lt;h1&gt;标签中的“CSS世界”这几个文字，通常有以下一些技术选型。</p><ul><li><p>下策是display:none或者visibility:hidden隐藏，因为屏幕阅读设备会忽略这里的文字。</p></li><li><p>text-indent缩进是中策，但文字如果缩进过大，大到屏幕之外，屏幕阅读设备也是不会读取的。</p></li><li><p>color:transparent是移动端上策，但却是桌面端中策，因为原生IE8浏览器并不支持它。color:transparent声明，很难用简单的方式阻止文本被框选。</p></li><li><p>clip剪裁隐藏是上策，既满足视觉上的隐藏，屏幕阅读设备等辅助设备也支持得很好。</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.logo</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="comment">/*无依赖绝对定位，nice*/</span></span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">clip</span>: <span class="built_in">rect</span>(<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>这里使用的clip剪裁隐藏是我工作这么多年大浪淘沙筛选后的最佳实践，有对比才能显出好在何处</p><ul><li><p>display:none或者visibility:hidden隐藏有两个问题，一个是按钮无法被focus了，另外一个是IE8浏览器下提交行为丢失，原因应该与按钮focus特性丢失有关。</p></li><li><p>透明度0覆盖也是一个不错的实践。如果是移动端项目，建议这么做；但如果是桌面端项目，则完全没有必要。使用透明度0覆盖的问题是每一个场景都需要根据环境的不同重新定位，以保证点击区域的准确性，成本较高，但clip隐藏直接用一个类名加一下就好。</p></li><li><p>还有一种比较具有适用性的“可访问隐藏”是下面这种屏幕外隐藏：</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.abs-out</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">999px</span>;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">999px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>当一个控件元素被focus的时候，浏览器会自动改变滚动高度，让这个控件元素在屏幕内显示。假如说我们的&lt;label&gt;“提交”按钮在第二屏，则点击按钮的时候浏览器会自动跳到第一屏置顶，因为按钮隐藏在了屏幕外，于是发生了非常糟糕的体验问题。而clip就地剪裁，就不会有“页面跳动”的体验问题。于是，权衡成本和效果，clip隐藏成为了最佳选择，特别是对于桌面端项目。</p></blockquote><blockquote><p><strong>clip隐藏仅仅是决定了哪部分是可见的，非可见部分无法响应点击事件等</strong></p><p><strong>使用clip进行剪裁的元素其clientWidth和clientHeight包括样式计算的宽高都还是原来的大小</strong></p></blockquote><h4 id="absolute的流体特性"><a href="#absolute的流体特性" class="headerlink" title="absolute的流体特性"></a><strong>absolute的流体特性</strong></h4><p>当absolute遇到left/top/right/bottom属性的时候，absolute元素才真正变成绝对定位元素。此时原本的相对特性丢失</p><p>说到流体特性，我们通常第一反应就是**<div>之类的普通块级元素<strong>。实际上，绝对定位元素也具有类似的流体特性，当然，不是默认就有的，而是在</strong>特定条件下才具有<strong>，这个条件就是“</strong>对立方向同时发生定位的时候**”。</p><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>而绝对定位元素的这种流体特性比普通元素要更强大，<strong>普通元素流体特性只有一个方向</strong>，默认是水平方向，但是<strong>绝对定位元素可以让垂直方向和水平方向同时保持流动性</strong>。</p></blockquote><h4 id="position-relative"><a href="#position-relative" class="headerlink" title="position:relative"></a><strong>position:relative</strong></h4><blockquote><p>虽然说relative/absolute/fixed都能对absolute的“包裹性”以及“定位”产生限制，但只有relative可以让元素依然保持在正常的文档流中。</p><p>relative的定位有两大特性：</p><ul><li><p>一是相对自身</p><p>  相对定位元素的left/top/right/bottom的百分比值是相对于包含块计算的，而不是自身.如果包含块的高度是auto，那么计算值是0，偏移无效</p><p>  各方向的值相对自身偏移</p></li><li><p>二是无侵入</p><p>  当relative进行定位偏移的时候，一般情况下不会影响周围元素的布局。</p></li></ul></blockquote><p>当相对定位元素同时应用对立方向的定位值得时候，，也就是<strong>top/bottom和left/right同时使用</strong>的时候，其表现和绝对定位差异很大。<strong>绝对定位是尺寸拉伸，保持流体特性</strong>，但是<strong>相对定位却是“你死我活”的表现</strong>，也就是说，<strong>只有一个方向的定位属性会起作用</strong>。而孰强孰弱则是与文档流的顺序有关的，<strong>默认的文档流是自上而下、从左往右</strong>，因此<strong>top/bottom同时使用的时候，bottom被干掉</strong>；<strong>left/right同时使用的时候，right毙命</strong>。</p><p><a href="https://demo.cssworld.cn/6/6-1.php">relative定位和margin定位对比实例页面</a></p><p><strong>relative的最小化影响原则</strong></p><p>（1）尽量不使用relative，如果想定位某些元素，看看能否使用“无依赖的绝对定位”；</p><p>（2）如果场景受限，一定要使用relative，则该relative务必最小化。</p><p>最小化影响 示例：</p><p>给img添加一层相对定位盒子，而不是给最外层盒子添加相对定位</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: relative;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;top:0;left:0;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>内容4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="position-fixed固定定位"><a href="#position-fixed固定定位" class="headerlink" title="position:fixed固定定位"></a>position:fixed固定定位</h4><blockquote><p>position:fixed固定定位元素的“包含块”是根元素，我们可以将其近似看成&lt;html&gt;元素。换句话说，唯一可以限制固定定位元素的就是&lt;html&gt;根元素</p></blockquote><p>实现将目标元素定位到某个模块的右上角：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">        <span class="symbol">&amp;nbsp;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.father &#123;</span><br><span class="line">width: 300px; height: 200px;</span><br><span class="line">position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.right &#123;</span><br><span class="line">height: 0;</span><br><span class="line">text-align: right;</span><br><span class="line">overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.son &#123;</span><br><span class="line">display: inline;</span><br><span class="line">width: 40px; height: 40px;</span><br><span class="line">position: fixed;</span><br><span class="line">margin-left: -40px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>position:fixed的absolute模拟</strong></p><blockquote><p>有时候我们希望元素既有不跟随滚动的固定定位效果，又能被定位元素限制和精准定位，那该怎么办呢？</p></blockquote><p>把需要固定的元素，放置到出现滚动条元素的外面即可</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span><br><span class="line">            固定定位元素</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    hmtl, <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.page</span>: &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">overflow</span>: auto;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.fixed</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>position:fixed与背景锁定</strong></p><blockquote><p>蒙层弹窗是网页中常见的交互，其中黑色半透明全屏覆盖的蒙层基本上都是使用position:fixed定位实现的。但是，如果细致一点儿就会发现蒙层无法覆盖浏览器右侧的滚动栏，并且鼠标滚动的时候后面的背景内容依然可以被滚动，并没有被锁定，体验略打折扣。如果希望背景锁定，该如何实现呢？</p></blockquote><p>position:fixed蒙层之所以出现背景依然滚动，那是因为滚动元素是根元素，正好是position:fixed的“包含块”。所以，如果希望背景被锁定，可以借鉴“absolute模拟fixed定位”的思路，让页面滚动条由内部的普通元素产生即可。</p><p>如果是移动端项目，阻止touchmove事件的默认行为可以防止滚动；如果是桌面端项目，可以让根元素直接overflow:hidden</p><h3 id="CSS世界的层叠规则"><a href="#CSS世界的层叠规则" class="headerlink" title="CSS世界的层叠规则"></a>CSS世界的层叠规则</h3><blockquote><p>默认情况下，网页内容是没有偏移角的垂直视觉呈现，当内容发生层叠的时候，一定会有一个前后的层叠顺序产生，有点儿类似于真实世界中“论资排辈”的感觉。</p></blockquote><h4 id="z-index只是CSS层叠规则中的一叶小舟"><a href="#z-index只是CSS层叠规则中的一叶小舟" class="headerlink" title="z-index只是CSS层叠规则中的一叶小舟"></a>z-index只是CSS层叠规则中的一叶小舟</h4><p>说到层叠，很多人第一 反应就是z-index 属性。z-index属性只有和定位元素（position不为static的元素）在一起的时候才有作用，可以是正数也可以是负数。理论上说，数值越大层级越高，但实际上其规则要复杂很多。</p><p>但随着CSS3新世界的到来，z-index已并非支队定位元素有效，flex盒子的子元素也可以设置。</p><p>网页中绝大多数元素是非定位元素，并影响层叠顺序属性远不止z-index， 因此大家千万不要认为z-index 属性就可以代表css世界的层叠规则</p><h4 id="理解CSS世界的层叠上下文和层叠水平（概念）"><a href="#理解CSS世界的层叠上下文和层叠水平（概念）" class="headerlink" title="理解CSS世界的层叠上下文和层叠水平（概念）"></a>理解CSS世界的层叠上下文和层叠水平（概念）</h4><blockquote><p>层叠上下文</p><p>英文称作stacking context，是HTML中的一个三维的概念。如果一个元素含有层叠上下文，我们可以理解为这个元素在z轴上就“高人一等”。</p></blockquote><blockquote><p>层叠水平</p><p>英文称作stacking level，决定了同一个层叠上下文中元素在z轴上的显示顺序。</p></blockquote><p>需要注意的是，诸位<strong>千万不要把层叠水平和CSS的z-index属性混为一谈</strong>。尽管某些情况下z-index确实可以影响层叠水平，但是只限于定位元素以及flex盒子的孩子元素；而层叠水平所有的元素都存在。</p><h4 id="理解元素的层叠顺序（规则）"><a href="#理解元素的层叠顺序（规则）" class="headerlink" title="理解元素的层叠顺序（规则）"></a>理解元素的层叠顺序（规则）</h4><blockquote><p>在CSS 2.1的年代，在CSS3新世界还没有到来的时候（注意这里的前提），层叠顺序规则如图7-2所示</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221018082705146.png" alt="image-20221018082705146"></p><ol><li>位于最下面的background/border特指层叠上下文元素的边框和背景色。每一个层叠顺序规则仅适用于当前层叠上下文元素的小世界。</li><li>inline水平盒子指的是包括inline/inline-block/inline-table元素的“层叠顺序”，它们都是同等级别的。</li><li>单纯从层叠水平上看，实际上z-index:0和z-index:auto是可以看成是一样的。注意这里的措辞—“单纯从层叠水平上看”，实际上，两者在层叠上下文领域有着根本性的差异</li></ol><p><strong>为啥 inline水平盒子层叠顺序比浮动元素还要高？</strong></p><p>background/border为装饰属性，浮动和块状元素一般用作布局，而内联元素都是内容。网页中最重要的是什么？当然是内容了</p><p>下面这两条是层叠领域的黄金准则。当元素发生层叠的时候，其覆盖关系遵循下面两条准则：</p><ul><li><p>谁大谁上：当具有明显的层叠水平标识的时候，如生效的z-index属性值，在同一个层叠上下文领域，层叠水平值大的那一个覆盖小的那一个。</p></li><li><p>后来居上：当元素的层叠水平一致、层叠顺序相同的时候，在DOM流中处于后面的元素会覆盖前面的元素。</p></li></ul><h4 id="层叠上下文的特性"><a href="#层叠上下文的特性" class="headerlink" title="层叠上下文的特性"></a>层叠上下文的特性</h4><ul><li>层叠上下文的层叠水平要比普通元素高（原因后面会说明）。</li><li>层叠上下文可以阻断元素的混合模式（参见<a href="http://www.zhangxinxu.com/wordpress/">http://www.zhangxinxu.com/wordpress/</a>? p=5155的这篇文章的第二部分说明）。</li><li> 层叠上下文可以嵌套，内部层叠上下文及其所有子元素均受制于外部的“层叠上下文”。</li><li> 每个层叠上下文和兄弟元素独立，也就是说，当进行层叠变化或渲染的时候，只需要考虑后代元素。</li><li>每个层叠上下文是自成体系的，当元素发生层叠的时候，整个元素被认为是在父层叠上下文的层叠顺序中。</li></ul><h4 id="层叠上下文的创建"><a href="#层叠上下文的创建" class="headerlink" title="层叠上下文的创建"></a>层叠上下文的创建</h4><p>（1）天生派：页面根元素天生具有层叠上下文，称为根层叠上下文。</p><p>（2）正统派：z-index值为数值的定位元素的传统“层叠上下文”。</p><p>（3）扩招派：其他CSS3属性。</p><h4 id="根层叠上下文"><a href="#根层叠上下文" class="headerlink" title="根层叠上下文"></a>根层叠上下文</h4><p>根层叠上下文指的是页面根元素，可以看成是<html>元素。因此，页面中所有的元素一定处于至少一个“层叠结界”中。</p><h4 id="定位元素与传统层叠上下文"><a href="#定位元素与传统层叠上下文" class="headerlink" title="定位元素与传统层叠上下文"></a>定位元素与传统层叠上下文</h4><p>对于position值为relative/absolute以及Firefox/IE浏览器（不包括Chrome浏览器）下含有position:fixed声明的定位元素，当其z-index值不是auto的时候，会创建层叠上下文。</p><p>HTML：</p><p>比较图片层级谁大谁先上，结果图片在上</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:auto;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美女 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute; z-index:2;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:auto;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美景 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:1;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时 父级z-index 层级为0，创建层叠上下文。比较父级层级，相同，后来居上，背景在上</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美女 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute; z-index:2;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美景 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position:relative; z-index:1;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Chrome等WebKit内核浏览器下，position:fixed元素天然层叠上下文元素，无须z-index为数值。根据我的测试，目前IE和Firefox仍是老套路。</p></blockquote><h4 id="css3与新时代的层叠上下文"><a href="#css3与新时代的层叠上下文" class="headerlink" title="css3与新时代的层叠上下文"></a>css3与新时代的层叠上下文</h4><p>（1）元素为flex布局元素（父元素display:flex|inline-flex），同时z-index值不是auto。</p><p>（2）元素的opacity值不是1。</p><p>（3）元素的transform值不是none。</p><p>（4）元素mix-blend-mode值不是normal。</p><p>（5）元素的filter值不是none。</p><p>（6）元素的isolation值是isolate。</p><p>（7）元素的will-change属性值为上面2～6的任意一个（如will-change:opacitg、will-chang:transform等）。</p><p>（8）元素的-webkit-overflow-scrolling设为touch。</p><h4 id="层叠上下文与层叠顺序"><a href="#层叠上下文与层叠顺序" class="headerlink" title="层叠上下文与层叠顺序"></a>层叠上下文与层叠顺序</h4><p>普通元素具有了层叠上下文，其层叠顺序就会不见高，那它的层叠顺序究竟在哪个位置、哪个级别呢？</p><p>这里需要分两种情况讨论：</p><p>（1）如果层叠上下文元素不依赖z-index数值，则其层叠顺序是z-index:auto，可看成z:index:0级别；</p><p>（2）如果层叠上下文元素依赖z-index数值，则其层叠顺序由z-index值决定。</p><blockquote><p>元素一旦成为定位元素，其z-index就会自动生效，此时其z-index就是默认的auto，也就是0级别，根据上面的层叠顺序表，就会覆盖inline或block或float元素。而不支持z-index的层叠上下文元素天然是z-index:auto级别，也就意味着，层叠上下文元素和定位元素是一个层叠顺序的，于是当它们发生层叠的时候，遵循的是“后来居上”准则。</p></blockquote><p><a href="https://demo.cssworld.cn/7/5-1.php">图片淡出，文字跑到图片后面</a></p><ul><li><h5 id="HTML：-9"><a href="#HTML：-9" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>               </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>只有图片淡出，文案一直100%透明<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;fade&quot;</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-9"><a href="#CSS：-9" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> fadeIn &#123;</span><br><span class="line">  <span class="number">0%</span> &#123; <span class="attribute">opacity</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="number">100%</span> &#123; <span class="attribute">opacity</span>: <span class="number">1</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">256px</span>; <span class="attribute">height</span>: <span class="number">192px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute; <span class="attribute">left</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">5</span>);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fade</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: fadeIn <span class="number">2s</span> <span class="number">2s</span> infinite; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>opacity的值不是1的时候，是具有层叠上下文的，层叠顺序是z-index:auto级别，跟没有z-index值的absolute绝对定位元素是平起平坐的。而本实例中的文字元素在图片元素的前面，于是，只要CSS3动画不是最终一瞬间的opacity:1，位于DOM流后面的图片就会遵循“后来居上”准则而覆盖文字。</p><p>知道原因，想要解决这个问题就很简单了：</p><p>（1）调整DOM流的先后顺序；</p><p>（2）提高文字的层叠顺序，例如，设置z-index:1。</p><h4 id="z-index-的负值"><a href="#z-index-的负值" class="headerlink" title="z-index 的负值"></a>z-index 的负值</h4><blockquote><p>一开始的时候，以为一个定位元素设置z-index负值，就会跑到页面的背后，隐藏掉，看不到了。结果实际上是有时候确实隐藏了，但有时候又隐藏不掉。为什么会这样？</p></blockquote><p>z-index负值元素的层级：层叠上下文元素上面 &lt;  z-index负值  &lt; block元素的下面</p><p><a href="https://demo.cssworld.cn/7/6-1.php">一个栗子</a></p><ul><li><h5 id="HTML：-10"><a href="#HTML：-10" class="headerlink" title="HTML："></a>HTML：</h5>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* 此时图片被.box背景遮挡*/</span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>.box非层叠上下文元素<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">/* 此时图片在.box背景上方*/</span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>.box是层叠上下文元素<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box context&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><h5 id="CSS：-10"><a href="#CSS：-10" class="headerlink" title="CSS："></a>CSS：</h5>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-tag">img</span> &#123; </span><br><span class="line">    <span class="attribute">position</span>: relative; </span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>; </span><br><span class="line">    <span class="attribute">right</span>: -<span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.context</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>负值的应用：</p><ol><li><p>IE8下的多背景模拟</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: (<span class="number">1</span>.jpg);</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">0</span>; <span class="comment">/*创建层叠上下文*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:before</span>,</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: (<span class="number">2</span>.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: (<span class="number">3</span>.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 此时，就算．box元素里面是纯文字，伪元素图片照样在文字下面，如此广泛的适用场景使上面的处理几乎可以作为通用的多背景模拟实现准则来实现了</p></li><li><p><a href="http://demo.cssworld.cn/7/6-2.php">定位在元素的后面</a></p></li><li><p>可访问性隐藏</p><p> z-index负值可以隐藏元素，只需要层叠上下文内的某一个父元素加个背景色就可以</p></li></ol><h4 id="z-index-”不犯二“准则"><a href="#z-index-”不犯二“准则" class="headerlink" title="z-index ”不犯二“准则"></a>z-index ”不犯二“准则</h4><blockquote><p>对于非浮层元素，避免设置z-index值，z-index值没有任何道理需要超过2。由于z-index不能超过2，因此，我称其为“不犯二”准则。</p></blockquote><p><strong>为啥需要设置这个准则？</strong></p><p>（1）定位元素一旦设置了z-index值，就从普通定位元素变成了层叠上下文元素，相互间的层叠顺序就发生了根本的变化，很容易出现设置了巨大的z-index值也无法覆盖其他元素的问题。</p><p>（2）避免z-index“一山比一山高”的样式混乱问题。此问题多发生在多人协作以及后期维护的时候。例如，A小图标定位，习惯性写了个z-index:9; B一看，自己原来的实现被覆盖了，立马写了个z-index:99；结果比弹框组件层级还高，那还得了，立马弹框组件来一个z-index:999999；谁知后来，弹框中又要有出错提示效果……显然，最后项目的z-index层级管理就是一团糟。</p><blockquote><p>很重要的一点，我这里的“不犯二”准则，并不包括那些在页面上飘来飘去的元素定位，弹框、出错提示、一些下拉效果等都不受这一准则限制。</p><p>对于这类JavaScript驱动的浮层组件，我会借助“层级计数器”来管理</p><p>（1）总会遇到意想不到的高层级元素；</p><p>（2）组件的覆盖规则具有动态性。</p></blockquote><p><strong>层级计数器</strong></p><p>实际上就是一段JavaScript脚本，会遍历所有 <strong>body</strong> <strong>处于显示状态的子元素</strong>，并得到最大z-index值，和默认的z-index做比较。如果超出，则显示的组件的z-index自动加1，这样就不会出现有组件被其他组件覆盖的问题；如果不超出，就使用默认的z-index值，</p><h3 id="强大的文本处理能力"><a href="#强大的文本处理能力" class="headerlink" title="强大的文本处理能力"></a>强大的文本处理能力</h3><h4 id="font-size和vertical-align"><a href="#font-size和vertical-align" class="headerlink" title="font-size和vertical-align"></a>font-size和vertical-align</h4><blockquote><p>line-height的部分类别属性值是相对于font-size计算的，vertical-align百分比值属性值又是相对于line-height计算的，于是，看上去八辈子都搭不上边的vertical-align和font-size属性背后其实也有有着关联的。</p></blockquote><p>如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">vertical-align</span>: -<span class="number">25%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时 img 的vertical-align 的值是多少？</p><blockquote><p>16 * 1.5 * -25% = -6px</p></blockquote><h4 id="理解font-size与ex、em和rem的关系"><a href="#理解font-size与ex、em和rem的关系" class="headerlink" title="理解font-size与ex、em和rem的关系"></a>理解font-size与ex、em和rem的关系</h4><blockquote><p>ex是字符x高度，显然和font-size关系密切，font-size值越大，自然ex对应的大小也就大</p><p>某元素 font-size 大小是多少，其1em 就是font Size 大小，em就是’中’等汉字的高度</p><p>根元素 font-size 大小就是 1rem 的大小</p></blockquote><h4 id="font-size的关键字属性值"><a href="#font-size的关键字属性值" class="headerlink" title="font-size的关键字属性值"></a>font-size的关键字属性值</h4><ol><li><p>相对尺寸关键字</p><p> • larger：大一点，是<big>元素的默认font-size属性值。</p><p> • smaller：小一点，是<small>元素的默认font-size属性值。</p></li><li><p>绝对尺寸关键字</p><p> 与当前元素font-size无关，仅受浏览器设置的字号影响。注意这里的措辞，是“浏览器设置”，而非“根元素”，两者是有区别的。</p><p> • xx-large：好大好大，和<h1>元素计算值一样。</p><p> • x-large：好大，和<h2>元素计算值一样。</p><p> • large：大，和<h3>元素计算值近似（“近似”指计算值偏差在1像素以内，下同）。</p><p> • medium：不上不下，是font-size的初始值，和<h4>元素计算值一样</p><p> • small：小，和<h5>元素计算值近似。</p><p> • x-small：好小，和<h6>元素计算值近似。• xx-small：好小好小，无对应的HTML元素。</p></li></ol><h4 id="font-size-0与文本的隐藏"><a href="#font-size-0与文本的隐藏" class="headerlink" title="font-size:0与文本的隐藏"></a>font-size:0与文本的隐藏</h4><blockquote><p>桌面Chrome浏览器下有个12px的字号限制，就是文字的font-size计算值不能小于12px，我猜是因为中文，如宋体，要是小于12px，就会挤成成一团，略丑，Chrome看不下去，就直接禁用了。</p></blockquote><p>如果font-size:0的字号表现就是0，那么文字会直接被隐藏掉，并且只能是font-size:0，哪怕设置成font-size:0.0000001px，都还是会被当作12px处理的。</p><h4 id="字体属性家族的大家长font-family"><a href="#字体属性家族的大家长font-family" class="headerlink" title="字体属性家族的大家长font-family"></a>字体属性家族的大家长font-family</h4><p>font-family支持两类属性值，</p><p>一类是“字体名”</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: simsun; <span class="comment">/*字体名称有空格就需要引号包起来*/</span></span><br><span class="line">    <span class="comment">/* 多字体 */</span></span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;PingFang SC&#x27;</span>,<span class="string">&#x27;Microsoft Yahei&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一类是“字体族”</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-family</span>: serif;</span><br></pre></td></tr></table></figure><ul><li><p>serif：衬线字体</p><p>  通俗讲就是笔画开始、结束的地方有额外装饰而且壁画粗细会有所不同的字体</p></li><li><p>sans-serif：无衬线字体。</p></li><li><p>monospace：等宽字体。</p></li><li><p>cursive：手写字体。</p></li><li><p>fantasy：奇幻字体。</p></li><li><p>system-ui：系统UI字体。</p></li></ul><p>字体族与字体名一起时，要将字体名放在前面，不然字体名可能不会加载，应为字体族满足文本渲染就不会在往后面解析了</p><h4 id="等宽字体的实践价值"><a href="#等宽字体的实践价值" class="headerlink" title="等宽字体的实践价值"></a>等宽字体的实践价值</h4><blockquote><p>所谓等宽字体，一般是针对英文字体而言的。据我所知，东亚字体应该都是等宽的，就是每个字符在同等font-size下占据的宽度是一样的。但是英文字体就不一定了，我随便写一个单词，就iMac吧，大家很明显地发现这个字符i要比M占据的宽度小。</p></blockquote><p>首先等宽字体利于代码呈现。对于写代码的人来说，无论是什么语言，易读是第一位，使用等宽字体，我们阅读起来会更轻松舒服。因此，一般编辑器使用的字体或者Web上需要呈现源代码的字体都是等宽字体</p><p><a href="http://demo.cssworld.cn/8/2-1.php">等宽字体与图形呈现案例一则</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-family</span>: Consolas, Monaco, monospace;</span><br></pre></td></tr></table></figure><h4 id="ch单位与等宽字体布局"><a href="#ch单位与等宽字体布局" class="headerlink" title="ch单位与等宽字体布局"></a>ch单位与等宽字体布局</h4><blockquote><p>ch和em、rem、ex一样，是CSS中和字符相关的相对单位。和ch相关的字符是0，没错，就是阿拉伯数字0。1ch表示一个0字符的宽度</p></blockquote><p>但是我们网页内容的字符不可能都是0，所以这个单位乍看就显得很鸡肋。但是，如果和等宽字体在一起使用，它就可以发挥不一样的威力</p><h4 id="中文字体和英文名称"><a href="#中文字体和英文名称" class="headerlink" title="中文字体和英文名称"></a>中文字体和英文名称</h4><blockquote><p>虽然一些常见中文字体，如宋体、微软雅黑等，直接使用中文名称作为CSS font-family的属性值也能生效，但我们一般都不使用中文名称，而是使用英文名称，主要是为了规避乱码的风险。还有一些中文字体直接使用中文名称作为CSS font-family的属性值是没有效果的，如思源黑体、兰亭黑体等，需要使用字体对应的英文名称才可以生效。</p></blockquote><h4 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h4><blockquote><p>微软正黑体是一款全面支持ClearType技术的TrueType无衬线字体，用于繁体中文系统。相对应地，中国大陆地区用的是微软雅黑</p></blockquote><blockquote><p>“思源黑体”和“思源宋体”是Adobe与Google合作推出的开源字体。其设计目标是可以广泛用于多种用途的计算机字体，比如用于手机、平板或者桌面的用户界面、网页浏览或者电子书阅读等，均包含7个字重</p></blockquote><blockquote><p>文泉驿微米黑”是Google Droid的开源衍生字体。Droid字体系是Google包含在著名的开源手机平台Android系统中的默认字体，其中的Droid Sans Fallback包含CJK标准汉字16000余个，是目前所知为数不多的开源中文字体之一（也是继文泉驿正黑之后第二个开源中文黑体）</p></blockquote><h4 id="字体家族其他成员"><a href="#字体家族其他成员" class="headerlink" title="字体家族其他成员"></a>字体家族其他成员</h4><p><strong>font-weight</strong></p><p>关键字：normal 和 bold</p><p>属性值：</p><p>• 100：文字很细，细如发丝。</p><p>• 200：文字很轻，轻如鸿毛。</p><p>• 300：文字较轻，轻如飞燕。</p><p>• 400：文字正常，等同normal。</p><p>• 500：文字不粗不细，不轻不重。</p><p>• 600：文字略粗，粗如小腿。</p><p>• 700：文字加粗，等同bold。</p><p>• 800：文字超粗，粗如大腿。</p><p>• 900：文字很重，重如泰山。</p><blockquote><p>如果我们在设置属性值时发现文字没啥变化，那就是当前字体不行，可以换一个字体试试 （思源黑体）</p></blockquote><h4 id="具有近似姐妹花属性值的font-style"><a href="#具有近似姐妹花属性值的font-style" class="headerlink" title="具有近似姐妹花属性值的font-style"></a>具有近似姐妹花属性值的font-style</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-style</span></span><br><span class="line"></span><br><span class="line">italic/oblique 这两个关键字都表示“斜体”</span><br></pre></td></tr></table></figure><p>italic是使用当前字体的斜体字体，而oblique只是单纯地让文字倾斜。如果当前字体没有对应的斜体字体，则退而求其次，解析为oblique，也就是单纯形状倾斜。</p><h4 id="font属性"><a href="#font属性" class="headerlink" title="font属性"></a>font属性</h4><p>font属性进行文本相关样式的缩写。可以缩写在font属性中的属性非常多，包括font-style、font-variant、font-weight、font-size、line-height、font-family等。完整语法为：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[[font-style]</span> || <span class="attribute">font-variant</span> || <span class="attribute">font-weight</span>]? <span class="attribute">font-size</span> <span class="selector-attr">[/ line-hieght]</span>? <span class="attribute">font</span>-familly ]</span><br><span class="line"></span><br><span class="line">? 表示<span class="number">0</span>/<span class="number">1</span></span><br><span class="line">|| 表示 或</span><br><span class="line"></span><br><span class="line"><span class="attribute">font-size</span>和<span class="attribute">font-family</span>后面没有问号，也就是说是必需的</span><br></pre></td></tr></table></figure><p>font-family 不能省略，而且很长，每次写都要带一大串就很不好，有啥技巧避免？</p><ul><li><p>方法1</p><p>  可以随便找一个系统根本不存在的字体名占位，如字母a，或者特殊一点，用笑脸表情☺，然后再设置font-family:inherit来重置这个占位字体</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.font</span> &#123;</span><br><span class="line">    <span class="attribute">font</span>: <span class="number">30px</span>/<span class="number">30px</span> <span class="string">&#x27;☺&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: inherit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>利用@font face规则将我们的字体列表重定义为一个字体，这是兼容性很好、效益很高的一种解决方法</p></li></ul><p><strong>font 关键字</strong></p><p>• icon：包含图标内容所使用的字体，如所有文件夹名称、文件名称、磁盘名称，甚至浏览器窗口标题所使用的字体。</p><p>• caption：活动窗口标题栏使用的字体。</p><p>• status-bar：窗体状态栏使用的字体。</p><p>• small-caption：调色板标题所使用的字体。</p><p>• message-box：消息盒里面使用的字体。</p><p>• menu：菜单使用的字体，如文件夹菜单。</p><p>此外还有很多非标准关键字,略</p><h4 id="字体属性的应用价值"><a href="#字体属性的应用价值" class="headerlink" title="字体属性的应用价值"></a><strong>字体属性的应用价值</strong></h4><p>目前，非常多网站的通用font-family直接就是：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line"><span class="attribute">font-family</span>: <span class="string">&#x27;Microsoft YaHei&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一设置，就意味着所有操作系统下的所有浏览器都要使用“微软雅黑”字体。假如说用户的iMac或者macbook因为某些原因安装了“微软雅黑”字体，那岂不是这些系统原本更加漂亮的中文字体就不能使用了？</p><p><strong>设置让字体跟随系统</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 三选一设置 */</span></span><br><span class="line"><span class="selector-tag">html</span> &#123; <span class="attribute">font</span>: menu; &#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">16px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> &#123; <span class="attribute">font</span>: small-caption; &#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">16px</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> &#123; <span class="attribute">font</span>: status-bar; &#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123; <span class="attribute">font-size</span>: <span class="number">16px</span>; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="真正了解-font-face规则"><a href="#真正了解-font-face规则" class="headerlink" title="真正了解@font face规则"></a>真正了解@font face规则</h4><blockquote><p>很多人只要一提到@font face规则，心中就会不由自主“哦”地一声：“这个我知道，可以用来生成自定义字符小图标！”话是没错，问题在于很多人以为生成字符小图标就是@font face规则的全部，实际上这只是其功能之一，一旦真正了解@font face规则，你会发现，@font face规则可以做的事情其实非常多。</p></blockquote><p><strong>@font face的本质是变量</strong></p><blockquote><p>虽然说CSS3新世界中才出现真正意义上的变量var，但实际上，在CSS世界中已经出现了本质上就是变量的东西，@font face规则就是其中之一。@font face本质上就是一个定义字体或字体集的变量，这个变量不仅仅是简单地自定义字体，还包括字体重命名、默认字体样式设置等。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;example&#x27;</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">example.ttf</span>);</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    unicode-range: U+<span class="number">0025</span>-<span class="number">00</span>FF;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p><strong>font-family</strong></p><p> 这里的 font-family 可以看成是一个字体变量，名称可以随意设置 如 “$”</p></li><li><p><strong>src</strong></p><p> src表示引入的字体资源可以是系统字体，也可以是外链字体。如果是使用系统安装字体，则使用local()【IE9以上支持】功能符；如果是使用外链字体，则使用url()功能符</p><p> 示例：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ICON;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;icon.eot&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;eot&#x27;</span>);</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;icon.eot?#iefix&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;embeded-opentype&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.woff2&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;typetrue&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.svg#icon&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line">    <span class="attribute">font-weight</span>: normal;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>出现的格式</strong></p><p> • svg格式是为了兼容iOS 4.1及其之前的版本，考虑到现如今iOS的版本数已经翻了一番，所以svg格式的兼容代码大可舍弃。</p><p> • eot格式是IE私有的。注意，目前所有版本的IE浏览器都支持eot格式，并不是只有IE6～IE8支持。只是，IE6～IE8仅支持eot这一种字体格式。</p><p> • woff是web open font format几个词的首字母简写，是专门为Web开发而设计的字体格式，显然是优先使用的字体格式，其字体尺寸更小，加载更快。Android 4.4开始全面支持。</p><p> • woff2是比woff尺寸更小的字体，小得非常明显。因此，Web开发第一首选字体就是woff2，只是此字体目前仅Chrome和Firefox支持得比较好。</p><p> • ttf格式作为系统安装字体比较多，Web开发也能用，就是尺寸大了点儿，优点在于老版本Android也支持。</p><p> <strong>综合上面的分析，我们可以得到如下的结论。</strong></p><blockquote><p>（1）svg格式果断舍弃。</p><p>（2）如果无须兼容IE8浏览器，eot格式果断舍弃。</p><p>（3）如果无须兼容Android 4.3之前版本手机，ttf格式果断舍弃。</p></blockquote><p> 之所以存在上面的写法，就是因为 <strong>兼容性</strong> </p><p> <strong>#iefix 有什么用？</strong></p><blockquote><p>实际上没啥用，真正有用的其实是前面的问号。是这样的，IE9之前的版本解析有一个严重的问题，当src属性包含多个url()时，会把长长的字符当作一个地址解析而返回404错误。因此把eot格式放在第一位，然后在字体文件url地址后加上问号，这样IE9之前的版本会把问号之后的内容当作url的参数。、</p></blockquote><p> <strong>为什么需要两个src?</strong></p><blockquote><p>如果是原生的IE7和IE8浏览器，第一个src实际上是多余的，为什么这么讲呢？之所以要放上来，很大一部分原因是为了测试工程师。因为现在测试工程师测试低版本的IE浏览器喜欢使用兼容模式，兼容模式的IE和原生同版本的IE的解析是有区别的，其中区别之一就是兼容模式的IE7和IE8不认识问号（?）解决方案，导致第二个src无法识别，不得已才多了第一行的src。</p></blockquote><p> <strong>font-weight:normal和font-style:normal是不是多余的？</strong></p><blockquote><p>如果你没有同字体名的多字体设置，则它就是多余的，至少我在常规项目中删掉这两行CSS没有出现任何异常。</p></blockquote><p> <strong>format()功能符有什么作用，可不可以省略？</strong></p><blockquote><p>我的回答是最好不要省略。format()功能符的作用是让浏览器提前知道字体的格式，以决定是否需要加载这个字体，而不是加载完了之后再自动判断。</p></blockquote><p> 例子：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ICON;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;icon.eot&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>),</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">&#x27;icon.ttf&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这种写法只会加载ttf这一种格式字体，因为浏览器提前知道了文件格式是自己无法识别的</p></blockquote><p> 于是乎最上面那种写法可以优化成：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ICON;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;icon.eot&#x27;</span>);</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;😊&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.woff2&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>),</span><br><span class="line">     url (<span class="string">&#x27;icon.ttf&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>font-style</strong></p><blockquote><p>在Chrome浏览器下，@font face规则设置font-style:italic可以让文字倾斜，但是这并不是其作用所在。</p></blockquote><p> @font face规则中的font-style和font-weight类似，都是用来设置对应字体样式或字重下该使用什么字体。因为有些字体可能会有专门的斜体字体，注意这个斜体字体并不是让文字的形状倾斜，而是专门设计的倾斜的字体，所以很多细节会跟物理上的请求不一样:</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;FZYaoti&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-style</span>: italic;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;FZShuTi&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 制定一个字体，名叫’I’，当文字样式正常的时候，字体表现使用“方正姚体”；当文字设置了font-style:italic的时候，字体表现为“方正舒体”。</p></li><li><p><strong>font-weight</strong></p><blockquote><p>font-weight和font-style类似，只不过它定义了不同字重、使用不同字体</p></blockquote> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;QH&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;HYQihei 40S&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;QH&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;HYQihei 50S&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&#x27;QH&#x27;</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;HYQihei 60S&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 是一个全新的字体，名为’QH’。当字重font-weight为400的时候，使用“汉仪旗黑40S”字重字体；为500的时候，使用“汉仪旗黑50S”字重字体；为600的时候，使用“汉仪旗黑60S”字重字体。</p><p> <a href="https://demo.cssworld.cn/8/5-1.php">借助font-weight实现响应式图标实例页面</a></p></li><li><p><strong>unicode-range</strong></p><p> unicode-range的作用是可以让特定的字符或者特定范围的字符使用指定的字体。例如，“微软雅黑”字体的引号左右间隙不均，方向不明，实在是看着不舒服，此时我们就专门指定这两个引号使用其他字体，CSS代码如下：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: quote;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">&#x27;SimSun&#x27;</span>);</span><br><span class="line">    unicode-range: U+<span class="number">201</span>c, U+<span class="number">201</span>d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.font</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: quote, <span class="string">&#x27;Mircorosoft Yahei&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="font-face与字体图标技术"><a href="#font-face与字体图标技术" class="headerlink" title="@font face与字体图标技术"></a>@font face与字体图标技术</h4><blockquote><p>从面向未来的角度讲，字体图标技术的使用会越来越边缘化，因为和SVG图标技术相比，其唯一的优势就是兼容一些老的IE浏览器。等再过几年，IE8等浏览器彻底被淘汰了，我们就没有任何使用字体图标技术的理由了。</p></blockquote><p><strong>字体的本质是什么?</strong></p><blockquote><p>所谓字体，本质上是字符集和图形的一种映射关系</p><p>一个字体文件就好比一个巨型商品房，里面有很多房间，每个房间都有一个唯一的门牌号，然后这些房间就专门用来挂名画。这里的“门牌号”就是“字符集”，“房间里的名画”就是我们的“字体图形”</p><p>举个例子，“家”这个汉字Unicode编码是5BB6，这个5BB6就是“门牌号”，在中文字体中，这个“门牌号”对应的房间里面的画作就长得是“家”这个肉眼所见的字符形状。也就是说，一个字符编码对应一个形状。</p></blockquote><p>现在如果我们通过一定的手段，把挂5BB6这个“门牌号”房间里面的画作改成一个房屋的形状，那岂不是使用这个字体文件的时候，“家”就不是“家”，而是房子了呢？</p><p>字体图标技术就是使用类似的原理实现的，即把通常的字符映射成为另外的图标形状，于是，虽然我们眼睛看到的是个图标，但是实际上它本质上就是一个普通的字符。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line"><span class="attribute">font-family</span>: ICON;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">icon.eot</span>);</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">icon.eot?#iefix</span>) <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>),</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">icon.eot.woff2</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line">        <span class="built_in">url</span>(<span class="string">icon.eot.woff</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: ICON;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-microphone</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;\1f3a4&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里，1f3a4就是一个唯一的“门牌号”，在通常的字体下，其字符展示的是一个斜的麦克风。但是，在ICON这个字体中，1f3a4的图形被映射成了一个正立的麦克风图形。</p></blockquote><p><strong>知道了字体图标技术的原理</strong>，我们就能很好地理解一些渲染现象了。</p><p>（1）因为原始字符和最终的图形表现相差很大，所以当我们的字体文件加载缓慢的时候，可以明显看到字符变图形的过程，这种加载体验是不太友好的，字体内联在CSS文件中可以有效避免这一问题，但往往字体文件体积都比较大，这样处理得不偿失。据我所知，除此之外并没有非常好的解决方法。</p><p>（2）原始的字符x-height和最终的图形x-height往往是不一样的，这会影响内联元素的垂直对齐，因此很容易出现页面高度闪动情况，这种加载体验也是不友好的。</p><p>（3）原始字符的ch宽度，也就是水平占据的宽度和最终的图形也是不一样的，因此很容易出现内联元素水平方向晃动的问题，这种加载体验也是不友好的，为此图标就需要设定具体宽度值</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">font-family</span>: ICON;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>我可不可以把映射字符直接写在页面中，而不是放在：before伪元素中？</strong></p><blockquote><p>从技术实现的角度来讲这是完全可以的，而且不支持伪元素的IE7等浏览器都支持这样做。但是在实际开发的时候，我并不建议这么做，有两点原因：一是不好维护，如果以后字符映射关系改变，而图标HTML是散布在各个页面中的，那么我们的改动就会很麻烦；二是从语义角度考虑，图标字符往往是不包含任何意义的，应该没有必要让搜索引擎知道，也无须让辅助设备读取，而伪元素恰好有这样的功能，如果内联在HTML中，则反而成了一种干扰。</p></blockquote><h4 id="文本的控制"><a href="#文本的控制" class="headerlink" title="文本的控制"></a>文本的控制</h4><p><strong>text-indent与内联元素缩进</strong></p><blockquote><p>，text-indent就是对文本进行缩进控制。但是这种缩进对内容要求比较高，如果段落掺杂英文、数字或者图片等内容，缩进反而可能会给人以参差不齐的感觉，加上现代Web形式更加多样，text-indent在实际项目中的应用已经脱离了它原本的设计初衷。</p></blockquote><p>首先用得比较多的是text-indent负值隐藏文本内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span> CSS世界 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.logo &#123;</span><br><span class="line">width: 120px;</span><br><span class="line">background: url(logo.png);</span><br><span class="line">text-indent: -120px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有些人喜欢设置一个很大的 text-indent 负值：如 -9999em;</p><blockquote><p>我是不建议这么做的。首先，这样做在某些设备下有潜在的性能风险，体现在滚屏的时候会发生卡顿；其次，对于一些智能设备的屏幕阅读软件，如VoiceOver，如果内容缩进在屏幕之外，它是不会读取的，这样就降低了页面的无障碍访问能力。另外，text-indent负值缩进在部分浏览器下会影响元素的outline区域，通常需要再设置overflow:hidden。</p></blockquote><p><strong>如果单看最终的CSS样式效果下面代码是否等同？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">text-indent</span>: -<span class="number">120px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">text-indent</span>: -<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>答案是不等同，</p><p>text-indent的百分比值是相对于当前元素的“包含块”计算的，而不是当前元素。由于text-indent最终作用的是当前元素里的内联盒子，因此很容易让人误以为text-indent的百分比值是相对于当前元素宽度计算的。【补充：Chrome 72改变了百分比计算策略】</p><p><a href="http://demo.cssworld.cn/8/6-1.php">示例</a></p><p><a href="https://demo.cssworld.cn/8/6-2.php">实现百分比居中</a></p><p><strong>最后再说几个你可能不知道的小知识</strong>。</p><blockquote><p>（1）text-indent仅对第一行内联盒子内容有效。</p><p>（2）非替换元素以外的display计算值为inline的内联元素设置text-indent值无效，如果计算值是inline-block/inline-table则会生效。因此，如果父级块状元素设置了text-indent属性值，子inline-block/inline-table需要设置text-indent:0重置。</p><p>（3）<strong>input</strong>标签按钮text-indent值无效。</p><p>（4）<strong>button</strong>标签按钮text-indent值有效，但是存在兼容性差异，IE浏览器理解为单标签，百分比值按照容器计算，而Chrome和Firefox浏览器标签内还有其他Shadow DOM元素，因此百分比值是按照自身的尺寸计算的。</p><p>（5）<strong>input</strong>和<strong>textarea</strong>输入框的text-indent在低版本IE浏览器下有兼容问题。</p></blockquote><p><strong>letter-spacing与字符间距</strong></p><blockquote><p>letter-spacing可以用来控制字符之间的间距，这里说的“字符”包括英文字母、汉字以及空格等。</p></blockquote><p>（1）继承性。</p><p>（2）默认值是normal而不是0。虽然说正常情况下，normal的计算值就是0，但两者还是有差别的，在有些场景下，letter-spacing会调整normal的计算值以实现更好的版面布局。</p><p>（3）支持负值，且值足够大的时候，会让字符形成重叠，甚至反向排列（非IE浏览器)</p><p>（4）和text-indent属性一样，无论值多大或多小，第一行一定会保留至少一个字符。letter-spacing还有一个非常有意思的特性就是，在默认的左对齐情况下，无论值如何设置，第一个字符的位置一定是纹丝不动的。</p><p>（5）支持小数值，即使0.1px也是支持的，但并不总能看到效果，这与屏幕的密度有关。对普通的桌面显示器，设备像素比是1，最小渲染单位是1px，因此，需要至少连续10个字符，才能看到0.1px产生的1px间距变化，如果是9个字符，则不会有效果，这很可能会让人误以为letter-spacing不支持非常小的数值，实际上是支持的。</p><p>（6）暂不支持百分比值。在实际开发的时候，letter-spacing除了控制文字内容排版外，还可以修复一些布局上的问题。例如，清除inline-block列表由于换行符或者空格产生的空白间隙，使我们的布局控制更精准</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: -<span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于letter-spacing负值的字体重叠特性，我们还可以利用该属性实现一些文本动效</p><p><a href="http://demo.cssworld.cn/8/6-4.php">字符动效分步示意</a></p><p><strong>word-spacing与单词间距</strong></p><p>word-spacing和letter-spacing名称类似，其特性也有很多共通之处：</p><p>（1）都具有继承性。</p><p>（2）默认值都是normal而不是0。通常情况下，两者表现并无差异。</p><p>（3）都支持负值，都可以让字符重叠，但是对于inline-block和inline-table元素却存在兼容性差异，Chrome浏览器下可以重叠，IE和Firefox浏览器下则再大的负值也不会重叠，因此不适合使用word-spacing来清除空白间隙。</p><p>（4）都支持小数值，如word-spacing:0.5px。</p><p>（5）在目前的CSS2.1规范中，并不支持百分比值，但新的草案中新增了对百分值的支持，是根据相对于字符的“步进宽度”（advance width）计算的。这属于新世界内容，本书不做介绍。</p><p>（6）间隔算法都会受到text-align:justify两端对齐的影响。</p><p>letter-spacing作用于所有字符，但word-spacing仅作用于空格字符。注意，是作用在“空格”上，而不是字面意义上的“单词”。例如，假设有以下CSS和HTML：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.wp &#123;</span><br><span class="line">word-spacing: 20px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;wp&quot;</span>&gt;</span></span><br><span class="line">    我love前端！</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>love虽然是单词，但是没有空格，那么word-spacing 就无效</p><p><strong>如何设置CSS，让多按钮的时候中间自动有合适的间距呢？</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">word-spacing</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在IE6时代，这确实是个非常好的方法，但如今下面的做法可能要更合适些：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">button</span> + <span class="selector-tag">button</span> &#123;</span><br><span class="line"><span class="attribute">margin-left</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>了解word-break和word-wrap的区别</strong></p><blockquote><p>准确来讲是 了解word-break:break-all和word-wrap:break-word的区别</p></blockquote><p>word-break属性：</p><p>• normal：使用默认的换行规则。</p><p>• break-all：允许任意非CJK（Chinese/Japanese/Korean）文本间的单词断行。</p><p>• keep-all：不允许CJK文本中的单词换行，只能在半角空格或连字符处换行。非CJK文本的行为实际上和normal一致。【此属性兼容性不咋好】</p><p>word-wrap属性：</p><p>• normal：就是大家平常见得最多的正常的换行规则。</p><p>• break-word：一行单词中实在没有其他靠谱的换行点的时候换行。</p><blockquote><p>它之前由于和word-break长得太像，难免会让人记不住或搞混，于是在CSS3规范里，这个属性的名称被修改了，叫作overflow-wrap 【兼容性可能不佳】</p></blockquote><p><a href="http://demo.cssworld.cn/8/6-5.php">那两者的区别是什么呢？</a></p><blockquote><p>word-break:break-all的作用是所有的都换行，毫不留情，一点儿空隙都不放过，而word-wrap:break-word则带有怜悯之心，如果这一行文字有可以换行的点，如空格或CJK（中文/日文/韩文）之类的，就不打英文单词或字符的主意了，在这些换行点换行，至于对不对齐、好不好看则不关心，因此，很容易出现一片一片空白区域的情况。</p></blockquote><p><strong>white-space与换行和空格的控制</strong></p><blockquote><p>white-space属性声明了如何处理元素内的空白字符，这类空白字符包括Space（空格）键、Enter（回车）键、Tab（制表符）键产生的空白。因此，white-space可以决定图文内容是否在一行显示（回车空格是否生效），是否显示大段连续空白（空格是否生效）等。</p></blockquote><p>属性值:</p><p>• normal：合并空白字符和换行符。</p><p>• pre：空白字符不合并，并且内容只在有换行符的地方换行。</p><p>• nowrap：该值和normal一样会合并空白字符，但不允许文本环绕。</p><p>• pre-wrap：空白字符不合并，并且内容只在有换行符的地方换行，同时允许文本环绕。</p><p>• pre-line：合并空白字符，但只在有换行符的地方换行，允许文本环绕。</p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221019154123966.png" alt="image-20221019154123966"></p><p>**text-align与元素对齐 **</p><blockquote><p>因为CSS是母语为英语的人发明的，所以在早期的时候，对中文或其他东亚语言并没有考虑得那么细致，从text-align:justify的表现上就可以窥见一斑。例如，IE浏览器（至少到IE11）到目前为止使用text-align:justify都无法让中文两端对齐，而Chrome、Firefox和Safari等浏览器都是可以的。</p><p>不过，好在IE有一个私有的CSS属性text-justify（目前也写入规范草案了）可以实现中文两端对齐的。</p></blockquote><p>通过下面的CSS代码组合就可以实现全部浏览器都兼容的中文两端对齐</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.justify</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: justify;</span><br><span class="line">    <span class="attribute">text-justify</span>: inter-ideograph;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，属性值inter-ideograph的字面意思是“国际象形文字”，非官方非标准，可以放心使用，不用担心以后其他浏览器也支持之后出现新旧渲染不一致的问题。</p><p><a href="http://demo.cssworld.cn/8/6-7.php">中文的两端对齐效果实现实例页面</a></p><p>CSS世界中有一个text-align-last属性，可以规定最后一行内联内容的排列方式，这是从IE浏览器过来的</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.justify</span> &#123;</span><br><span class="line">    <span class="attribute">text-align-last</span>: justify;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>好一个及时雨！然而可惜，Safari浏览器，包括Safari 10，都不支持，以至于移动端和桌面端都不能使用，甚是遗憾。</p></blockquote><p><a href="http://demo.cssworld.cn/8/6-8.php">两端对齐案例</a></p><p><strong>如何解决text-decoration下划线和文本重叠的问题</strong></p><blockquote><p>如果对细节要求较高，就会发现，下划线经常会和中文文字的下边缘粘连在一起，英文的话甚至直接穿过，越看越有心痛的感觉。</p></blockquote><p>最佳实践就是使用 border 模拟下划线。另外，使用border-bottom模拟下划线的时候，border-color最好省略，这样就会使用文字的color颜色作为边框色，鼠标hover的时候，下划线会自动和文字一起变色</p><p>text-decoration还支持同时设置多个属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: underline overline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>一本万利的text-transform字符大小写</strong></p><blockquote><p>text-transform也是为英文字符设计的，要么全大写text-transform:uppercase，要么全小写text-transform:lowercase，似乎没什么值得挖掘的，但有一些场景使用它却会有一本万利的效果。</p></blockquote><ol><li><p>身份证输入</p><p> 我国的身份证最后一位有可能是字母X，且各种场合都是指定必须大写。如果我们给输入身份证的 <strong>input</strong> 输入框设置</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 就算我们敲小写x,出现的也是大写</p></li><li><p>验证码输入</p><p> 如果验证码不区分大小写，那么设置全转大写起步爽歪歪</p></li></ol><h4 id="first-letter-first-line伪元素"><a href="#first-letter-first-line伪元素" class="headerlink" title="first-letter/:first-line伪元素"></a><strong>first-letter/:first-line伪元素</strong></h4><blockquote><p>很多年前，Chrome浏览器和IE9浏览器还未出现，那时候first-letter叫伪类选择器，写法是前面加一个冒号，如：first-letter。那时候的语义要更直白一些，选择第一个字符，然后设置一些样式。后来，伪类和伪元素被划分得更加明确和规范了，::after、::before、::backdrop、::first-letter、::first-line、::selection等是伪元素，:active、:focus、:checked等被称为伪类，这就导致：:first-letter的语义发生了一些变化—首字符作为元素的假想子元素。</p></blockquote><p>::first-letter<strong>伪元素生效的前提</strong></p><blockquote><p>首先，元素的display计算值必须是block、inline-block、list-item、table-cell或者table-caption，其他所有display计算值都没有用，包括display:table和display:flex等。</p></blockquote><p><strong>此外，不是所有的字符都能单独作为：:first-letter伪元素存在的。什么意思呢？我们看一个简单的例子，CSS和HTML代码如下：</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p:first-letter &#123; color: silver; &#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>？？？？？？？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>按照我们的设想，第一个问号是银色，但实际上全部都是</p><blockquote><p>为什么呢？这是因为常见的标点符号、各类括号和引号在：:first-letter伪元素眼中全部都是“辅助类”字符，有点儿买东西送赠品的感觉，但是赠品本身却不能购买，这里的问号“? ”就属于赠品</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p:first-letter &#123; color: silver; &#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>？？？？？？？辅助<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这次我们发现，”？？？？？？？辅” 变成了银色。这就是<strong>赠品</strong>的表现</p><blockquote><p>有人可能会有疑问：那到底哪些字符属于“赠品”，哪些属于“商品”呢？我特意做了测试，总结下来就是，“赠品字符”包括·@#%&amp;＊()（）[]【】{}::”””; ; ‘’’》《, , .。? ? ! ! …＊、/\。</p><p>正常情况下可以直接作为伪元素的字符就是数字、英文字母、中文、$、一些运算符，以及非常容易被忽视的空格等。这里的“空格”有必要再加粗强调一下，因为它的确是很容易被忽视的一个字符。</p></blockquote><blockquote><p>最后说明一点，字符前面不能有图片或者inline-block/inline-table之类的元素存在</p></blockquote><p>如下：会导致不生效</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p:first-letter &#123;color: silver;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">style</span>=<span class="string">&quot;display:inline-block;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>银色<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>::before伪元素也参与：:first-letter伪元素</strong></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p:before &#123;</span><br><span class="line">content: &#x27;新闻&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">p:first-letter &#123;</span><br><span class="line">color: silver;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>这是新闻的标题......<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>结果“新”变成了银色,包括IE8在内的浏览器都是这样的表现。</p><p><strong>::first-letter伪元素可以生效的CSS属性</strong></p><p>• 所有字体相关属性：font、font-style、font-variant、font-weight、font-size、line-height和font-family。</p><p>• 所有背景相关属性：background-color、background-image、background-position、background-repeat、background-size和background-attachment。</p><p>• 所有margin相关属性：margin、margin-top、margin-right、margin-bottom和margin-left。</p><p>• 所有padding相关属性：padding、padding-top、padding-right、padding-bottom和padding-left。</p><p>• 所有border相关属性：缩写的border、border-style、border-color、border-width和普通书写的属性。</p><p>• color属性。</p><p>• text-decoration、text-transform、letter-spacing、word-spacing（合适情境下）、line-height、float和vertical-align（只有当float为none的时候）等属性。</p><blockquote><p>因此，如果妄图使用visibility:hidden或者display:none隐藏：:first-letter伪元素，还是省省吧。</p></blockquote><p><strong>::first-letter伪元素的一些有意思的特点</strong></p><ol><li><p>支持部分display属性值标签嵌套。::first-letter伪元素获取可以跨标签，也就是不仅能选择匿名内联盒子，还能透过层层标签进行选择，但是也有一些限制，并不是所有标签嵌套都是有用的。</p><blockquote><p>display值如果是inline、block、table、table-row、table-caption、table-cell、list-item都是可以的，但是不能是inline-block和inline-table，否则：:first-letter伪元素会直接无效；而display:flex则改变了规则，直接选择了下一行的字符内容。</p></blockquote><p> <a href="http://demo.cssworld.cn/8/7-1.php">眼见为实</a></p></li><li><p>颜色等权重总是多了一层。</p><p> 这是非常容易犯的一个错误，也是CSS世界十大不易理解问题之一。例如，下面这个问题是某同行发邮件问我的，我简单编辑了一下：</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p:first-letter &#123;</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line">p &gt; span &#123;</span><br><span class="line">color: blue!important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>第一个<span class="tag">&lt;/<span class="name">span</span>&gt;</span>字符看看会不会变红？<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p> 请问“第”这个字符的颜色是什么？</p></li></ol><blockquote><p>基本上，超过95%的前端人员会认为是blue，因为大家都是从CSS选择器权重的角度去考虑的。这个答案本身没问题，但是却忽略了很重要的一点，::first-letter伪元素其实是作为子元素存在的，或者说应当看出是子元素，于是就很好理解了。对于类似color这样的继承属性，子元素的CSS设置一定比父元素的级别要高，哪怕父级使用了重量级的！important，因为子元素会先继承，然后再应用自身设置。因此，上面CSS和HTML代码的最终结果是，第一个字符“第”字的颜色是red，红色！这就是：:first-letter伪元素的另外一个重要特性—颜色等权重总是多了一层。</p></blockquote><p><strong>::first-letter实际应用举例</strong></p><ul><li><p>电商产品经常会有价格，价格前面一般都有一个¥符号，这个符号字体往往会比较特殊，字号也比较大，同时和文字的数值有几像素的距离</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.price:first-letter &#123;</span><br><span class="line">maargin-right: 5px;</span><br><span class="line">font-size: xx-large;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    ￥399</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>故事相对较少的：first-line伪元素</strong></p><blockquote><p>它们长得类似，很多特性也类似。但是相比之下，:first-line的故事要少一些，没有“赠品字符”之类的梗存在。</p></blockquote><p>• :first-line和：first-letter伪元素一样，IE9及以上版本浏览器支持双冒号：:first-line{}写法，IE8浏览器只认识单冒号写法。</p><p>• :first-line和：first-letter伪元素一样，只能作用在块级元素上，也就是display为block、inline-block、list-item、table-cell或者table-caption的元素设置：first-line才有效，table、flex之类都是无效的。</p><p>• :first-line和：first-letter伪元素一样，仅支持部分CSS属性，例如：</p><p>所有字体相关属性；</p><ul><li><p>color属性；</p></li><li><p>所有背景相关属性；</p></li><li><p>text-decoration、text-transfor、letter-spacing、word-spacing、line-height和vertical-align等属性。</p></li></ul><p>• :first-line和：first-letter伪元素一样，color等继承属性的权重总是多了一层，毕竟称为“伪元素”，就好像里面还有个子元素。如果：first-line和：first-letter同时设置颜色，:first-letter级别比：first-line高，即使：first-line写在后面，甚至加！important（如果浏览器支持）也是如此。</p><p>• :first-line和：first-letter伪元素一样，也支持标签嵌套，但是具体细则和：first-letter出入较大，例如，它不支持table相关属性等。</p><p><a href="http://demo.cssworld.cn/8/7-2.php">眼见为实</a></p><blockquote><p>在Chrome 中inline-block 元素会阻断 first-line</p></blockquote><h3 id="元素装饰与美化"><a href="#元素装饰与美化" class="headerlink" title="元素装饰与美化"></a>元素装饰与美化</h3><h4 id="少得可怜的颜色关键字"><a href="#少得可怜的颜色关键字" class="headerlink" title="少得可怜的颜色关键字"></a>少得可怜的颜色关键字</h4><blockquote><p>CSS1的时候只支持16个基本颜色关键字</p><p>CSS2的时候，显然应该要新增一些颜色关键字。或许很多人满怀希望，总以为会有什么惊喜，结果果然很惊喜：居然只加入了一个颜色—橙色orange。</p><p>到了CSS3的时候，以为又会是“雷声大，雨点小”，结果这次却出人意料，一下子增加了100多个颜色关键字</p><p>到了CSS4的时候，以为又会有什么惊人之举，结果又仅增加了一个颜色关键字—rebeccapurple</p><p>[更多](<a href="http://www.zhangxinxu.com/wordpress/">http://www.zhangxinxu.com/wordpress/</a>? p=4859)</p></blockquote><blockquote><p>currentColor变量是个好东西，可以使用当前color计算值，即所谓颜色值。</p><p>IE9+浏览器才支持它。</p></blockquote><h4 id="CSS世界的background很单调"><a href="#CSS世界的background很单调" class="headerlink" title="CSS世界的background很单调"></a>CSS世界的background很单调</h4><blockquote><p>CSS世界中的background大部分有意思的内容都是在CSS3新世界中才出现的，如Multiple backgrounds（多背景）、background-size（背景尺寸）、background-origin（背景初始定位盒子）、background-clip（背景剪切盒子）等。</p></blockquote><p>background相关属性的集合，包括：</p><p>• background-image: none</p><p>• background-position: 0% 0%</p><p>• background-repeat: repeat</p><p>• background-attachment: scroll</p><p>• background-color: transparent</p><p>如果是IE9+浏览器，则还包括：</p><p>• background-size: auto auto</p><p>• background-origin: padding-box</p><p>• background-clip: border-box</p><p><strong>隐藏元素的background-image到底加不加载?</strong></p><blockquote><p>根据我的测试，一个元素如果display计算值为none，在IE浏览器下（IE8～IE11，更高版本不确定）依然会发送图片请求，Firefox浏览器不会，至于Chrome和Safari浏览器则似乎更加智能一点：如果隐藏元素同时又设置了background-image，则图片依然会去加载；如果是父元素的display计算值为none，则背景图不会请求，此时浏览器或许放心地认为这个背景图暂时是不会使用的。</p></blockquote><blockquote><p>如果想用background-image实现鼠标光标经过变换图片的效果（例如，灰色的关闭图片鼠标光标经过变成深色），则务必将这两张图片合并在一张图片上，除了减少请求外，这样做更重要的好处是交互体验更好了。如果图片不合在一起，当鼠标光标经过的时候，就会去请求另外一张图片的地址，如果这个图片没有被缓存，则请求发出去到图片显示是有一段时间的，很容易出现鼠标光标经过关闭图片，结果图片消失的情况，实际上图片不是消失了，而是还在请求的路上。</p></blockquote><p><strong>与众不同的background-position百分比计算方式</strong></p><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221020103129977.png" alt="image-20221020103129977"></p><p>IE8浏览器最多只支持同时出现2个值，从IE9开始支持同时出现3个值或4个值，<strong>作用是指定定位的偏移计算从哪个方位算起</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-position</span>: right <span class="number">40px</span> bottom <span class="number">20px</span>;</span><br></pre></td></tr></table></figure><p>表示距离右边缘40像素，距离底边缘20像素</p><p><strong>position值也支持百分比值</strong></p><p>position值的百分比值有着特殊的计算公式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">position = (容器的宽 - 图片的宽) * percentX</span><br><span class="line"></span><br><span class="line">position = (容器的高 - 图片的高) * percentY</span><br></pre></td></tr></table></figure><p>因此，当background-position:100% 100%时候，实际定位值就是容器尺寸和图片尺寸的差，于是就有了右下角所示的定位效果。</p><p><strong>当我们设置百分比负值时</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-position</span>: -<span class="number">50%</span> -<span class="number">50%</span>;</span><br></pre></td></tr></table></figure><p>结果他的效果类似于</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-position</span>: <span class="number">40px</span> <span class="number">10px</span>;</span><br></pre></td></tr></table></figure><blockquote><p>深受传统百分比定位迷惑的我们可能一时会想不通，明明是个负值百分比定位，怎么会是一个正值效果呢？</p><p>我们套用 <strong>position</strong> 百分比值计算公式，就豁然开朗了！此案例中容器尺寸是160×160，图片尺寸是256×192，图片尺寸大于容器尺寸，所以：</p><p>•（容器的宽度-图片的宽度）×（-50%）的结果是个正值；</p><p>•（容器的高度-图片的高度）×（-50%）的结果也是个正值。</p><p>因此，最终的表现并不是图片定位在容器外，而是定位在容器内。</p></blockquote><p>** background-repeat与渲染性能**</p><blockquote><p>background-repeat支持repeat、repeat-x、repeat-y这几个值，语义清晰，兼容性好，没什么有趣的故事。background-repeat以前用得很多，但如今设计趋势是喜欢扁平和纯色，其使用频率下降明显，反倒是在实现一些复杂纹理或者配合“蝉原则”实现随机背景这些比较新潮的地方见到的比较多。</p></blockquote><p>关于 background-repeat 性能，</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.overlay</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;alpha.png&#x27;</span>);</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, .<span class="number">75</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>有些人为了追求极致，把 alpha.png 做成了1X1像素大小，，但是遮罩背景出现的时候会有明显的卡顿，体验非常不好。究其原因，就是平铺图片尺寸太小，平铺次数太多，渲染太吃力，其实我们大可把背景图保存成100像素×100像素大小，这样一来，图片尺寸并没有大多少，但是渲染性能却有明显提升。</p></blockquote><p><strong>外强中干的background-attachment:fixed</strong></p><blockquote><p>在CSS世界中，background-attachment支持scroll和fixed两个属性值，其中scroll是默认值，就是平常使用背景图的效果表现；fixed表示背景相对于当前文档视区定位，也就是页面再怎么滚动背景图片位置依旧纹丝不动，稳若泰山。</p><p>听上去，background-attachmen:fixed应该和position:fixed声明一样，是个很厉害的角色才对。但实际上其外强中干，在某些场合它确实很厉害，但是局限太大，没法实用。</p></blockquote><ul><li><p>要实现一个图片局部动态模糊效果</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">256px</span>; hieght: <span class="number">1192px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">1.jpg</span>);</span><br><span class="line">    <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-class">.drag</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>; <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: inherit;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">5px</span>);</span><br><span class="line">    <span class="attribute">cursor</span>: grap;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>drag元素的background继承于父元素．box，同样的背景图，同样的background-attachment: fixed锁定，根本就不需要JavaScript动态改变background-position位置，因为元素都是相对于文档视区定位的。这看似美好，却有一个很大的局限性，那就是页面的高度不能超过一屏，因为页面一旦可以滚动，效果就完全被毁掉，背景图立马就显示不全了，因为元素被滚走了，但是背景图还是固定的。</p><p>而绝大多数网页都是可滚动的，这就让background-attachment:fixed只能局限于窗体背景图的使用上。当然，也有不太好的支持方法，就是background-attachment:fixed交互做出一个独立的小页面，然后主页面使用一个小的iframe嵌套。</p><p>IE9及以上版本浏览器新增了一个background- attachment属性值local，难道它就是用来解决上面的“不合乎预期”的现象的？不好意思，你想多了，它们不是一路的。local的作用是，如果．box元素可以滚动，则．box元素的背景图也可以被滚走，默认的scroll值是固定的，和fixed无半点儿关系。</p></blockquote></li></ul><p><strong>background-color背景色永远是最低的</strong></p><blockquote><p>什么意思呢？就是background无论是单背景图还是多背景图，背景色一定是在最底下的位置。</p><p>知道这一特性有什么作用呢？为了及时准确反馈用户的点击行为，我们会在链接或按钮元素上增加：active样式，通常的思路是：active时变换一下背景色，但是这样有一个很大的问题，即每个按钮的背景色都是不一样的，那岂不是要写很多个：active样式？有没有什么整站通用的简单代码呢？当然有。我们可以试试使用背景图片代替背景色</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:active</span>, <span class="selector-tag">button</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to top, <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, .<span class="number">05</span>), <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, .<span class="number">05</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为背景色一定是在最底下的位置，所以这里的background-image一定是覆盖在按钮等元素背景色之上的，不会影响按钮原来的背景色。</p><p>如果是桌面端Web项目，需要兼容IE8和IE9浏览器，我的建议是使用一个同等效果的PNG图片代替，具体代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href]</span><span class="selector-pseudo">:active</span>, <span class="selector-tag">button</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">    <span class="comment">/*IE8,IE9*/</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">xxx</span>);</span><br><span class="line">    <span class="comment">/*IE10+*/</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to top, <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, .<span class="number">05</span>), <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, .<span class="number">05</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>利用多背景的属性hack小技巧</strong></p><blockquote><p>虽然IE8浏览器并不支持多背景，但是并不表示IE8浏览器和多背景效果无缘。因为IE8浏览器支持：before和：after两个伪元素，所以配合z-index负值，我们可以实现最多3个图片的多背景效果，对绝大部分的需求来说足够了。</p></blockquote><p><strong>IE9浏览器不支持背</strong></p><blockquote><p>IE9浏览器不支持背景渐变，不过，也是有手段可以做兼容的，那就是使用IE私有的渐变滤镜。例如，一个红蓝渐变，可以使用下面的代码：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">filter</span>: progid: DXImageTransform.Micorosoft.<span class="built_in">gradient</span>(startcolorstr=red, encolorstr=blue, gradientType=<span class="number">1</span>);</span><br></pre></td></tr></table></figure><blockquote><p>这行滤镜代码主要有3个参数，依次是startcolorstr、endcolorstr和gradient Type。其中gradientType=1代表横向渐变，gradientType=0代表纵向淅渐变，startcolorstr代表渐变起始的色彩。除了使用颜色关键字，还可以使用十六进制颜色表示法，如startcolorstr=#FF0000; endcolorstr代表渐变结尾的色彩，也支持十六进制颜色表示法，如endcolorstr=#0000FF。</p></blockquote><blockquote><p>想要渐变半透明怎么办？可以使用IE浏览器的8字符的十六进制颜色表示法，其格式为#AARRGGBB, AA、RR、GG、BB均为十六进制正整数，取值范围为00～FF。RR指定红色值，GG指定绿色值，BB指定蓝色值，AA指定透明度。00表示完全透明，FF表示完全不透明。超出取值范围的值将被恢复为默认值。例如，渐变起始红色可以写成startcolorstr=#FFFF0000。</p></blockquote><p>有些人并不清楚如何将0～1的CSS3标准透明度值转换成十六进制。事实上，可以这样处理：打开浏览器控制台，假设需要转换的透明度是opacity，则可以输入下面的代码再回车：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="number">256</span>*opacity).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>综上所述，要想实现一个100%红色到50%透明度蓝色垂直渐变，可以使用如下代码组合：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.gradient</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: progid:DXImageTransform.Micorosoft.<span class="built_in">gradient</span>(startsolorstr=<span class="number">#FFFF0000</span>, endcolorstr=<span class="number">#7F0000FF</span>, gradientType=<span class="number">0</span>);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to bottom, red, <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>, .<span class="number">5</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> <span class="selector-class">.bgcolor</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在IE9浏览器下，rgba半透明和filter渐变会同时起作用，因此使用：root选择器重置了一下。</p><h3 id="元素的显示与隐藏"><a href="#元素的显示与隐藏" class="headerlink" title="元素的显示与隐藏"></a>元素的显示与隐藏</h3><blockquote><p>使用CSS让元素不可见的方法很多，剪裁、定位到屏幕外、明度变化等都是可以的。虽然它们都是肉眼不可见，但背后却在多个维度上都有差别。</p></blockquote><p><strong>总结的一些比较好的隐藏实践。</strong></p><ul><li><p>如果希望元素不可见，同时不占据空间，辅助设备无法访问，同时不渲染，可以使用 <strong>script</strong> 标签隐藏。</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  此时图片是不会有请求的，如果希望在 <strong>script</strong> 标签中再放置其他不渲染的模板内容，可以试试 <strong>textarea</strong> 元素</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1.jpg&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  图片2.jpg也是不会有请求的。另外， <strong>script</strong>  标签隐藏内容获取使用script.innerHTML, <strong>textarea</strong> 使用textarea.value。</p></li><li><p>如果希望元素不可见，同时不占据空间，辅助设备无法访问，但资源有加载，DOM可访问，则可以直接使用display:none隐藏</p></li><li><p>如果希望元素不可见，同时不占据空间，辅助设备无法访问，但显隐的时候可以有transition淡入淡出效果，则可以使用</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果希望元素不可见，不能点击，辅助设备无法访问，但占据空间保留，则可以使用visibility:hidden隐藏</p></li><li><p>如果希望元素不可见，不能点击，不占据空间，但键盘可访问，则可以使用clip剪裁隐藏</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clip</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">clip</span>: <span class="built_in">rect</span>(<span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.out</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">999em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果希望元素不可见，不能点击，但占据空间，且键盘可访问，则可以试试relative隐藏。例如，如果条件允许，也就是和层叠上下文之间存在设置了背景色的父元素，则也可以使用更友好的z-index负值隐藏。例如：</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.lover</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果希望元素不可见，但可以点击，而且不占据空间，则可以使用透明度。</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.opacity</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">Alpha</span>(opcity=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果单纯希望元素看不见，但位置保留，依然可以点可以选，则直接让透明度为0。</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.opacity</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">Alpha</span>(opcity=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>实际开发场景千变万化，上面罗列的实践不足以覆盖全部情形。例如，在标签受限的情况下希望隐藏某文字，可能使用text-indent缩进是最友好的方法。如果希望显示的时候可以加一个transition动画，就可能要使用max-height进行隐藏了</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">    <span class="attribute">max-height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在Firefox浏览器下，display:none的元素的background-image图片是不加载的，包括父元素display:none也是如此；如果是Chrome和Safari浏览器，则要分情况，若父元素display:none，图片不加载，若本身背景图所在元素隐藏，则图片依旧会去加载；对IE浏览器而言，无论怎样都会请求图片资源。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.bg1 &#123;</span><br><span class="line">    background: url(1.png);</span><br><span class="line">&#125;</span><br><span class="line">.bg2 &#123;</span><br><span class="line">    background: url(2.png);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span> <span class="attr">class</span>=<span class="string">&quot;bgl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span> &gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>我们发现只加载了1.png，因此，在实际开发的时候，如头图轮播切换效果，那些默认需要隐藏的图片作为背景图藏在隐藏元素的子元素上，微小的改动就可以明显提升页面的加载体验，可以说是非常实用的小技巧。</p></blockquote><p>还有一些属性也是天然display:none的。例如，hidden类型的 **input 输入框</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">input</span> type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;<span class="number">1</span>&quot;&gt;</span><br></pre></td></tr></table></figure><p>HTML5中新增了hidden这个布尔属性，可以让元素天生display:none隐藏。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">    看不见我</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>IE11以及其他现代浏览器都支持它，因此，如果要兼容桌面端，需要如下CSS设置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[hidden]</span> &#123;</span><br><span class="line"><span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="visibility与元素的显隐"><a href="#visibility与元素的显隐" class="headerlink" title="visibility与元素的显隐"></a>visibility与元素的显隐</h4><blockquote><p>有一些人简单地认为display:none和visibility:hidden两个隐藏的区别就在于：display:none隐藏后的元素不占据任何空间，而visibility:hidden隐藏的元素空间依旧保留。实际上并没有这么简单，visibility是一个非常有故事的属性。</p></blockquote><ol><li><p>visibility的继承性</p><p> 首先，它最有意思的一个特点就是继承性。父元素设置visibility:hidden，子元素也会看不见，究其原因是继承性，子元素继承了visibility:hidden，但是，如果子元素设置了visibility:visible，则子元素又会显示出来。这个和display隐藏有着质的区别。</p><p> <a href="http://demo.cssworld.cn/10/2-1.php">眼见为实</a></p></li><li><p>visibility与CSS计数器</p><p> visibility:hidden不会影响计数器的计数，这和display:none完全不一样</p><blockquote><p>visibility:hidden虽然让其中一个列表不可见了，但是其计数效果依然在运行。相比之下，设置display:none的列表就完全没有参与计数运算。</p></blockquote></li><li><p>visibility与transition</p><p> 下面的CSS是会让．box元素hover时显示．target子元素，但不会有过渡效果：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-class">.target</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity .<span class="number">25s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-class">.target</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 但是，下面的CSS语句却可以让．target子元素有淡出的过渡效果：</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &gt; <span class="selector-class">.target</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity .<span class="number">25s</span>;</span><br><span class="line">    visibililty: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &gt; <span class="selector-class">.target</span> &#123;</span><br><span class="line">    visibililty: visible;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> 这是为什么呢？因为CSS3 transition支持的CSS属性中有visibility，但是并没有display。</p><p> hover 列表操作出现下拉，鼠标移入第二行，但因为经过第一行导致第一行出现下拉导致第二行触发不了，这种现象。</p><p> <a href="http://demo.cssworld.cn/10/2-3.php">visibility与内容hover的延时显示实例页面</a></p></li></ol><h3 id="用户界面样式"><a href="#用户界面样式" class="headerlink" title="用户界面样式"></a>用户界面样式</h3><h4 id="和border形似的outline属性"><a href="#和border形似的outline属性" class="headerlink" title="和border形似的outline属性"></a>和border形似的outline属性</h4><blockquote><p>outline表示元素的轮廓，语法和border属性非常类似，分宽度、类型和颜色，支持的关键字和属性值与border属性一模一样</p></blockquote><p>Highlight是系统高亮色，这里用来模拟IE和Firefox浏览器的outline效果相当合适</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:focus</span> + <span class="selector-tag">label</span><span class="selector-class">.btn</span> &#123;</span><br><span class="line"><span class="attribute">outline</span>: <span class="number">1px</span> dotted Hghlight;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">5px</span> auto -webkit-focus-ring-color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>真正的不占据空间的outline及其应用</strong></p><blockquote><p>内联元素的上下padding值似乎不占据任何空间，但是一旦祖先元素overflow计算值不是visible，同时padding值足够大，滚动条就会出现，暴露出“不占据空间”其实是一个假象。但是outline属性确实不占据任何空间，轮廓宽度设置得再宽广，也不会影响任何元素的任何布局，并且outline轮廓是可穿透的。考虑到outline是一个从IE8开始就被支持的CSS属性，这就注定了outline要脱离其设计初衷，在其他方面大显神通，例如，用于实现一些看似棘手的布局效果。</p></blockquote><p><strong>头像裁剪时，只有选择范围清晰，其他区域黑色透明背景</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.crop</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.crop</span> &gt; <span class="selector-class">.crop-area</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>; <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">256px</span> solid <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,.<span class="number">5</span>);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">about:blank</span>);</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to top, transparent, transparent);</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">50</span>);</span><br><span class="line">    <span class="attribute">cursor</span>: move;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">:root</span> <span class="selector-class">.crop-area</span> &#123;</span><br><span class="line">    <span class="attribute">filter</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用一句话概括就是使用一个大大的 outline 来实现周围半透明黑色遮罩。因为 outline 宽度设置再大，也不会对布局产生任何影响，至于超出的区域，通过容器overflow:hidden 隐藏就可以了。没错，原理就是这么简单。</p><p><strong>自动填满屏幕剩余空间的应用技巧</strong></p><p>页面内容不足一屏中间高度是由内容撑开的。所以导致底部留白的现象</p><p>如何让底部背景色正好填满剩余屏幕区域呢？目前我知道的最好的办法就是巧用outline属性。假设底部HTML代码是这样的：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        Designed <span class="symbol">&amp;amp;</span> Powered by zhangxinxu</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span> &gt; <span class="selector-tag">p</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>; <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#a0b3d6</span>;</span><br><span class="line">    <span class="attribute">outline</span>: <span class="number">999px</span> solid <span class="number">#a0b3d6</span>;</span><br><span class="line">    <span class="attribute">clip</span>: <span class="built_in">rect</span>(<span class="number">0</span> <span class="number">9999px</span> <span class="number">9999px</span> <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="光标属性cursor"><a href="#光标属性cursor" class="headerlink" title="光标属性cursor"></a>光标属性cursor</h4><blockquote><p>cursor属性值几乎可以认为是当下支持的关键字属性值最多的CSS属性，没有之一。</p></blockquote><p>面就是按照功能特性对其进行的分类以及具体解释描述。</p><ol><li><p>常规</p><ul><li><p>cursor:auto:cursor默认值。</p><blockquote><p>auto表示光标形状根据内容类别浏览器自动进行处理。例如，输入框里面光标表现为cursor:text，带href属性的链接表现为cursor:pointer，而原生的 <strong>button</strong> 表现为cursor:default等。</p></blockquote></li><li><p>cursor:default：系统默认光标形状</p><blockquote><p>于是，久而久之，大家就约定俗成，所有链接和按钮都使用手形。以至于发展到现在，使用原生的<button>按钮甚至下拉框的时候，都要设置一个cursor:pointer。这种奇怪的发展史真是比小说还精彩</p></blockquote></li><li><p>cursor:none：这个声明非常有意思，可以让光标隐藏不见。</p><blockquote><p>看视频的时候，尤其全屏看视频的时候。此时鼠标一直在界面上晃着，是很碍眼、很难受的。一般可以这么处理：如果鼠标静止3秒不动，就设置页面或视频元素cursor:none隐藏光标，如果有mousemove行为，再显示即可！</p></blockquote></li></ul></li><li><p>链接和状态</p><ul><li><p>cursor:pointer：光标表现为一只伸出食指的手，类似这样</p></li><li><p>cursor:help：帮助，通常是光标头上带了个问号</p></li><li><p>cursor:progress：表示进行中的意思。从语义上讲，其适合loading处理</p><blockquote><p>有一个场景却非常适合使用cursor:progress，那就是页面加载的时候。如今进行Web开发，没有JavaScript几乎寸步难行，而JavaScript加载完毕是需要一定时间的，网络不好的时候，这个加载时间延迟可能会非常明显，于是用户就会遇到明明界面已经呈现了，但是点击“展开更多”按钮却没有任何反应，原因就是JavaScript还没有完全加载完毕。此时就非常适合cursor:progress出马了，我们默认在<body>标签上设置：</p></blockquote>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: progreess;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  js加载完毕可再设置为 auto</p></li><li><p> cursor:wait：我们先看看光标形状，可能是[插图]这样的转圈圈，或者是沙漏或者是表，总之和电脑死机时候的光标是一样的。</p></li><li><p>cursor:context-menu:cursor:context-menu兼容性比较复杂，Mac OS X和Linux系统下的Chrome和Firefox浏览器是支持的，但是Windows系统下的Chrome和Firefox浏览器却不支持。</p></li></ul></li><li><p>选择</p><ul><li>cursor:text：潜台词是文字可被选中，形状类似。默认文本字符或者可输入的单复选框的光标就表现成这样，因为文字可以被选中；反过来，如果文字是不能被选中的，光标就不应该是cursor:text。</li><li>cursor:vertical-text：潜台词是文字可以垂直选中，形状类似 |——|</li><li>cursor:crosshair：十字光标</li><li>cursor:cell:cursor:cell中的cell和display:table-cell中的cell其实可以看成是同一个东西，也就是单元格</li></ul></li><li><p>拖拽</p><ul><li>cursor:move：光标变成cursor:move，往往就意味着当前元素是可以移动的</li><li>cursor:copy：光标变成cursor:copy，往往就意味着当前元素是可以被复制的</li><li>cursor:alias：光标变成cursor:copy，往往就意味着当前元素是可以创建别名或者快捷方式的</li><li>cursor:no-drop：光标变成cursor:copy，往往就意味着当前元素放开到当前位置是不允许的</li><li>cursor:not-allowed：光标变成cursor:not-allowed，往往就意味着当前行为是禁止的，形状类似 🚫</li></ul></li><li><p>滚动</p><ul><li>cursor:all-scroll：表示上下左右都可以滚动，但有一个很糟糕的问题：Windows系统下光标表现和cursor:move一样。再考虑到本身作用场景局限，我觉得可以忽略此声明。</li></ul></li><li><p>拉伸</p><ul><li>cursor:col-resize：光标形状类似 &lt;-||-&gt; 它适用于移动垂直线条</li><li>cursor:row-resize：光标形状类似 上面的旋转90° 。它适用于移动水平线条</li><li>单向拉伸：总共8个方位8个不同的关键字属性值</li><li>双向拉伸：总共4个对立方位组合</li></ul></li><li><p>缩放</p><ul><li>cursor:zoom-in：光标形似放大镜</li><li>cursor:zoom-out：光标形似缩小镜</li></ul></li><li><p>抓取</p><ul><li>cursor:grab：光标是一个五指张开的手</li><li>cursor:grabbing：光标是一个五指收起的手</li></ul></li></ol><p><strong>自定义光标</strong></p><blockquote><p>从IE6开始，我们就可以自定义网页中的光标样式，因此，对于cursor属性，兼容性都不是问题。例如，IE8不支持上面提到的cursor:none，就是通过自定义手段实现兼容的</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.cur-none</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">transparent.cur</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于Chrome等浏览器，可以直接使用PNG图片作为光标，但是IE浏览器不行。IE仅支持专门的．cur格式的光标文件.</p><h3 id="流向的改变"><a href="#流向的改变" class="headerlink" title="流向的改变"></a>流向的改变</h3><blockquote><p>至少在我接触的这么多项目里，没有见到有谁使用过CSS的direction属性。为什么呢？是因为direction长得丑吗？虽然说direction确实其貌不扬，但是CSS世界不会有这样的歧视。那是因为兼容性吗？更不是了，direction早在IE6时代就已经被支持了</p><p>那究竟是什么原因呢？</p><p>我认为多半是因为宣传不够。要是所有前端人能够人手一本这本书，自然就不会有这样的问题了，因为本书热衷于挖掘CSS属性的潜力，可以让那些默默无闻但有能力的CSS属性熠熠生辉、焕发青春。direction就是一个典型，该属性简单且好记，属性值少，兼容性好，关键时候省心省力。</p></blockquote><h4 id="direction简介"><a href="#direction简介" class="headerlink" title="direction简介"></a><strong>direction简介</strong></h4><p>基本上只要关心这两个属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">direction</span>: ltr;// 左到右</span><br><span class="line"><span class="attribute">direction</span>: rtl// 右到左</span><br></pre></td></tr></table></figure><p>direction属性默认有这么一个特性，即可以改变替换元素或者inline-block/inline-table元素的水平呈现顺序</p><p><a href="https://demo.cssworld.cn/12/1-1.php">举个栗子</a></p><p>通常，我们让单行文字溢出用点显示，这个点通常都是在右边的，省略的都是最后的文字，配合direction属性，我们可以让这个点打在开头，让前面的文字省略</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.ell &#123;</span><br><span class="line">width: 240px;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    text-overflow: ellipsis;</span><br><span class="line">    text-ovverflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">P</span> <span class="attr">class</span>=<span class="string">&quot;ell&quot;</span> <span class="attr">dir</span>=<span class="string">&quot;ltr&quot;</span>&gt;</span></span><br><span class="line">    开头，中间，结束</span><br><span class="line"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">P</span> <span class="attr">class</span>=<span class="string">&quot;ell&quot;</span> <span class="attr">dir</span>=<span class="string">&quot;rtl&quot;</span>&gt;</span></span><br><span class="line">    开头，中间，结束</span><br><span class="line"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://demo.cssworld.cn/12/1-2.php">示例</a></p><p>direction属性还可以轻松改变表格中列的呈现顺序,将表头位置反向</p><p>directionL:rtl还可以让text-justify两端对齐元素，最后一行落单的元素右对齐显示</p><p><a href="https://demo.cssworld.cn/12/1-3.php">示例</a></p><p><strong>direction的黄金搭档unicode-bidi</strong></p><blockquote><p>direction属性似乎只能改变图片或者按钮的呈现顺序，但对纯字符内容（尤其中文）好像并没有什么效果，但实际上，我们也是可以指定中文每个字符都反向呈现的，方法就是借助direction的搭档属性unicode-bidi。</p></blockquote><blockquote><p>unicode-bidi</p><p>中文和英文夹杂，或者阿拉伯文和英文夹杂，此时就会出现文本阅读方向不一样的情况，阿拉伯文是从右往左读，英文是从左往右，而这种混合方向同时出现的现象就称为“双向性”，因此unicode-bidi作用就是明确字符出现“双向性”时应当有的表现。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">unicode-bidi</span>: normal</span><br><span class="line">unicode-bidi: embed</span><br><span class="line">unicode-bidi: bidi-override</span><br></pre></td></tr></table></figure><ul><li>normal：正常排列。假设设置了direction:rtl，则图片、按钮以及问号、加号之类的字符会从右往左显示，但是中文、英文字符还是从左往右显示。</li><li>embed:embed属性值要想起作用，只能作用在内联元素上。在通常情况下，embed属性值的表现和normal是一样的，导致很多人不明白embed到底和normal有什么区别。其实它们的区别很简单，embed属性值的字符排序是独立内嵌的，不受外部影响  <a href="https://demo.cssworld.cn/12/1-4.php">举个栗子</a></li><li>bidi-override：顾名思义，bidi-override就是“重写双向排序规则”，通常样式表现为所有的字符都按照统一的direction顺序排列，例如，若设置direction:rtl，则所有字符都会从右往左反向排列，效果强烈。</li></ul><blockquote><p>实际上我们无须设置unicode-bidi:bidi-override以及direction属性，直接在元素前后分别插入U+202E字符和U+202C字符（可缺省）也可以实现字符反向排列效果</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;#x202E;</span>123456789</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="改变CSS世界纵横规则的writing-mode"><a href="#改变CSS世界纵横规则的writing-mode" class="headerlink" title="改变CSS世界纵横规则的writing-mode"></a>改变CSS世界纵横规则的writing-mode</h4><blockquote><p>writing-mode之所以给人“生僻”的感觉，是有原因的。实际上writing-mode这个CSS属性很早就诞生了，IE5.5浏览器就已经支持它了。那就奇怪了！writing-mode既然这么厉害，出现的时间早、资格老，为什么一直沉寂了差不多20年呢？那是因为在很长一段时间里，Firefox、Chrome这些现代浏览器都不支持writing-mode, writing-mode基本上就是IE浏览器的私有产物。很多人对IE一直没什么好感，对吧？由此及彼，自然对writing-mode也不待见。</p></blockquote><blockquote><p>和float属性有些类似，writing-mode原本是为控制内联元素的显示而设计的（即所谓的文本布局）。因为在亚洲，尤其像中国这样的东亚国家，存在文字的排版不是水平而是垂直的情况，如中国的古诗文.和float属性有些类似，writing-mode原本是为控制内联元素的显示而设计的（即所谓的文本布局）。因为在亚洲，尤其像中国这样的东亚国家，存在文字的排版不是水平而是垂直的情况，如中国的古诗文</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*关键字值*/</span></span><br><span class="line"><span class="attribute">writing-mode</span>: horizontal-tb;// 水平方向</span><br><span class="line"><span class="attribute">writing-mode</span>: horizontal-rl;// 垂直方向</span><br><span class="line"><span class="attribute">writing-mode</span>: horizontal-lr;// 垂直方向</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/image-20221020173039576.png" alt="image-20221020173039576"></p><p>补充说明如下。</p><p>• 相同的writing-mode属性值并不会累加。例如，如果父子元素均设置了writing-mode:tb-rl，只会渲染一次，子元素并不会两次“旋转”。</p><p>• 在IE浏览器下，如果一个自身具有布局的元素（不是纯文本之类元素）writing-mode属性值和父元素不同，那么当子元素的布局流变化的时候，其父元素坐标系统的可用空间会被充分利用。这段文字太过术语化，我解释一下就是：在IE浏览器下，当布局元素从水平变成垂直的时候（举个例子），你就想象为元素在垂直方向是100%自适应父元素高度的。因此，IE浏览器下（不包括Edge 13及以上版本），元素vertical流的时候你会发现高度高得吓人，布局和其他现代浏览器不一样，正是这个原因。</p><p>• 虽然Chrome和Opera认识tb-rl等老的IE属性值，但也仅仅是认识而已，并没有任何实际效果！</p><p><strong>writing-mode不经意改变了哪些规则</strong></p><blockquote><p>writing-mode将页面默认的水平流改成了垂直流，颠覆了我们以往的很多认知，基于原本水平方向才适用的规则全部都可以在垂直方向适用！</p></blockquote><p><a href="http://demo.cssworld.cn/12/2-1.php">水平方向margin合并</a></p><p><a href="http://demo.cssworld.cn/12/2-2.php">普通块元素可以使用margin:auto实现垂直居中</a></p><p><a href="http://demo.cssworld.cn/12/2-3.php">writing-mode下块元素垂直居中</a></p><p><a href="http://demo.cssworld.cn/12/2-5.php">使用text-indent实现文字下沉效果</a></p><p><a href="http://demo.cssworld.cn/12/2-6.php">我们要实现小图标的旋转效果是很麻烦的，因</a></p><blockquote><p>writing-mode和direction的关系writing-mode、direction和unicode-bidi是CSS世界中三大可以改变文本布局流向的属性，其中direction和unicode-bidi属于近亲，经常一起使用，也是仅有的两个不受CSS3的all属性影响的CSS属性，基本上就是和内联元素一起使用。它貌似是为阿拉伯文字设计的。</p><p>乍一看，writing-mode似乎包含了direction和unicode-bidi的某些功能和行为，例如，vertical-rl的rl和direction的rtl值有相似之处，都是从右往左。然而，实际上两者是没有交集的。因为vertical-rl此时的文档流为垂直方向，rl表示水平方向，此时再设置direction:rtl，实际上值rtl改变的是垂直方向的内联元素的文本方向，一横一纵，没有交集。而且writing-mode可以对块状元素产生影响，直接改变了CSS世界的纵横规则，要比direction强大得多。它貌似是为东亚文字设计的。</p><p>然而，CSS的奇妙之处就在于：某些特性当初可能就是为某些图文排版设计的，但是我们可以利用它带来的特性发挥自己的创造力，实现其他很多意想不到的效果。因此，上面出现的“三剑客”都是非常好的资源。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;本章内容来自于《css的世界》-张鑫旭，类似于读书笔记吧。主要介绍css2.1的语法。本书主要用于进阶学习，不适用于初学者，书中也默认忽略一些基础的知识.&lt;/p&gt;
&lt;p&gt;CSS2.1中的CSS属性的设计初衷是展示图文&lt;/p&gt;
&lt;h3 id=&quot;css-的世界&quot;&gt;&lt;a href=&quot;#css-的世界&quot; class=&quot;headerlink&quot; title=&quot;css 的世界&quot;&gt;&lt;/a&gt;css 的世界&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;已操作系统划分世界，不同的操作系统就是平行世界。每种浏览器就是一个王国。&lt;/p&gt;
&lt;p&gt;在CSS世界中，HTML是魔法石，选择器就是选择法器，CSS属性就是魔法师，CSS各种属性值就是魔法师的魔法技能，浏览器就是他们所在的“王国”，“王国”会不断更新法律法规（版本升级），决定是否允许使用新的魔法石（HTML5新标签新属性），是否允许新的魔法师入“国籍”（CSS3新属性），或者允许魔法师使用某些新技能（CSS新的属性值），以及是否舍弃某些魔法技能（如display:run-in）；操作系统就是他们所在的世界，不同的操作系统代表不同的平行世界，所以，CSS世界有这么几个比较大的平行世界，即Windows世界、OS X世界以及移动端的iOS世界和Android世界。不同世界的浏览器王国的命运不一样，例如，在OS X世界中，IE王国是不存在的，而Safari王国却异常强大，但在Windows世界中，Safari王国却异常落寞。以上这一切就构成了完整的CSS世界的“世界观”。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;专业术语&quot;&gt;&lt;a href=&quot;#专业术语&quot; class=&quot;headerlink&quot; title=&quot;专业术语&quot;&gt;&lt;/a&gt;专业术语&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;属性&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;关键字&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;变量&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;长度单位&lt;/p&gt;
&lt;p&gt; 时间单位（如s、ms），还有角度单位（如deg、rad等）&lt;/p&gt;
&lt;p&gt; 相对长度单位：如em,rem(相对字体),vh,vw,vmin,vmax(相对视区)&lt;/p&gt;
&lt;p&gt; 绝对长度单位：px&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;功能符&lt;/p&gt;
&lt;p&gt; 值以函数的形式指定（就是被括号括起来的那种），主要用来表示颜色（rgba和hsla）、背景图片地址（url）、元素属性值、计算（calc）和过渡效果等，如rgba(0,0,0, .5)、url(‘css-world.png’)、attr(‘href’)和scale(-1)。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;属性值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;声明&lt;/p&gt;
&lt;p&gt; 属性名加上属性值就是声明&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;声明块&lt;/p&gt;
&lt;p&gt; 就是选择器 {} 区域&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;规则或规则集&lt;/p&gt;
&lt;p&gt;选择器后面的声明块就是一个规则集&lt;/p&gt;
&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;div&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ... 规则集&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;选择器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;关系选择器&lt;/p&gt;
&lt;p&gt;常见的符号有空格、&amp;gt;、～，还有+等，这些都是非常常用的选择器。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;@规则&lt;/p&gt;
&lt;p&gt;@规则指的是以@字符开始的一些规则，像@media、@font-face、@page或者@support，诸如此类&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="htmlcss" scheme="https://wyf195075595.github.io/categories/htmlcss/"/>
    
    
    <category term="CSS" scheme="https://wyf195075595.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://wyf195075595.github.io/2022/10/18/computer/%E7%94%B5%E8%84%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <id>https://wyf195075595.github.io/2022/10/18/computer/%E7%94%B5%E8%84%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</id>
    <published>2022-10-18T10:04:46.662Z</published>
    <updated>2022-10-18T10:09:14.225Z</updated>
    
    <content type="html"><![CDATA[<p>微软商店提示无法加载该页面</p><blockquote><p><a href="https://blog.csdn.net/xueyuan2016/article/details/125754410">参考</a></p><p><strong>1、代理服务器</strong>的设置问题</p><p>设置 <strong>Internet选项 -连接-局域网设置-取消勾选代理服务器</strong></p><p>2、TLS 版本过低</p><p>Internet选项-高级-勾选 tls 1.2,1.3</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;微软商店提示无法加载该页面&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/xueyuan2016/article/details/125754410&quot;&gt;参考&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1、代理服务器&lt;/st</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>插件合集</title>
    <link href="https://wyf195075595.github.io/2022/09/23/programming/vue/plugins/"/>
    <id>https://wyf195075595.github.io/2022/09/23/programming/vue/plugins/</id>
    <published>2022-09-23T00:23:10.000Z</published>
    <updated>2022-09-23T12:08:17.319Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1、VueUse"><a href="#1、VueUse" class="headerlink" title="1、VueUse"></a>1、VueUse</h3><blockquote><p>​    VueUse 是 <strong>Anthony Fu  大佬</strong>的一个开源项目，它为Vue的开发者提供了大量用于 Vue2 和Vue3 的基本 <strong>Composition API</strong> 实用工具函数。</p><p>它有几十个用于常见开发人员用例的解决方案，如跟踪<code>ref</code>更改，检测元素可见性，简化常见Vue模式，键盘/鼠标输入等。 这是真正节省开发时间的好方法，因为我们不必自己亲手添加所有这些标准功能，拿来主义，用就对了(再次感谢大佬的付出)。</p></blockquote><span id="more"></span><blockquote><p>我喜欢VueUse库，因为它在决定提供哪些实用工具时真正把开发者放在第一位，而且它是一个维护良好的库，因为它与Vue的当前版本保持同步。</p><ul><li><p>Animation(动画) - 包含易于使用的过渡、超时和计时功能</p></li><li><p>Browser (浏览器) - 可以用于不同的屏幕控件、剪贴板、首选项等等</p></li><li><p>Component (组件) - 为不同的组件方法提供简写</p></li><li><p>Sensors (传感器)- 用来监听不同的DOM事件、输入事件和网络事件</p></li><li><p>State (状态) - 管理用户状态（全局，本地存储，会话存储）</p></li><li><p>Utility （实用方法）–不同的实用方法，如<code>getters</code>、<code>conditionals</code>、<code>ref synchronization</code>等。</p></li><li><p>Watch –更高级的观察器类型，如可暂停的观察器、放弃的观察器和条件观察器</p></li><li><p>其它 - 事件、WebSockets和 Web workers  的不同类型的功能</p><p>  VueUse 的最大特点之一是，它只用一个包就能兼容 Vue2 和 Vue3!</p></li></ul></blockquote><h3 id="2、vue-print-nb"><a href="#2、vue-print-nb" class="headerlink" title="2、vue-print-nb"></a>2、vue-print-nb</h3><blockquote><p>用于代替浏览器的打印</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//安装</span><br><span class="line">npm i vue-print-nb</span><br><span class="line"></span><br><span class="line">// 注册</span><br><span class="line">import Print from &#x27;vue-print-nb&#x27;</span><br><span class="line">Vue.use(Print);</span><br><span class="line"></span><br><span class="line">//使用, 指令方式 id为要打印元素的id</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;end&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-print</span>=<span class="string">&quot;printObj&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>打印<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">printObj</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">id</span>: <span class="string">&#x27;myPrint&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3、qrcode"><a href="#3、qrcode" class="headerlink" title="3、qrcode"></a>3、qrcode</h3><blockquote><p>用于生成二维码。如果内容是地址URL 就跳转到该地址。如果是其他内容就直接展示内容</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">npm i qrcode</span><br><span class="line"></span><br><span class="line">//局部引入使用</span><br><span class="line">QrCode.toCanvas(dom, info)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 页面使用</span><br><span class="line"> <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;二维码&quot;</span> </span></span><br><span class="line"><span class="tag"> <span class="attr">:visible.sync</span>=<span class="string">&quot;showCodeDialog&quot;</span> </span></span><br><span class="line"><span class="tag">@<span class="attr">opened</span>=<span class="string">&quot;showQrCode&quot;</span> </span></span><br><span class="line"><span class="tag">@<span class="attr">close</span>=<span class="string">&quot;imgUrl=&#x27;&#x27;&quot;</span></span></span><br><span class="line"><span class="tag"> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">type</span>=<span class="string">&quot;flex&quot;</span> <span class="attr">justify</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">ref</span>=<span class="string">&quot;myCanvas&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"> <span class="title function_">showQrCode</span>(<span class="params">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// url存在的情况下 才弹出层</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (url) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">showCodeDialog</span> = <span class="literal">true</span> <span class="comment">// 数据更新了 但是我的弹层会立刻出现吗 ？页面的渲染是异步的！！！！</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 有一个方法可以在上一次数据更新完毕，页面渲染完毕之后</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 此时可以确认已经有ref对象了</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title class_">QrCode</span>.<span class="title function_">toCanvas</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">myCanvas</span>, url) <span class="comment">// 将地址转化成二维码</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 如果转化的二维码后面信息 是一个地址的话 就会跳转到该地址 如果不是地址就会显示内容</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">warning</span>(<span class="string">&#x27;该用户还未上传头像&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mitt"><a href="#mitt" class="headerlink" title="mitt"></a>mitt</h3><blockquote><p>vue3中取消了 this.$on, this.$off, this.$emit 事件，推荐使用外部插件 mitt库.来实现发布订阅功能</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install mitt</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line">mybus.<span class="property">js</span></span><br><span class="line"><span class="keyword">import</span> mitt <span class="keyword">from</span> <span class="string">&#x27;mitt&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">mitt</span>() <span class="comment">// 此为公用实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">import</span> mybus <span class="keyword">from</span> <span class="string">&#x27;./mybus.js&#x27;</span></span><br><span class="line"></span><br><span class="line">发送</span><br><span class="line">mybus.<span class="title function_">emit</span>(<span class="string">&#x27;自定义事件名称&#x27;</span>,<span class="string">&#x27;数据&#x27;</span>);</span><br><span class="line"></span><br><span class="line">接收</span><br><span class="line">mybus.<span class="title function_">on</span>(<span class="string">&#x27;自定义事件名称&#x27;</span>,<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);<span class="comment">//接收到的数据</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">移除</span><br><span class="line">mybus.<span class="title function_">off</span>(<span class="string">&#x27;自定义事件名称&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="vue-countTo"><a href="#vue-countTo" class="headerlink" title="vue-countTo"></a>vue-countTo</h3><blockquote><p>实现数字滚动效果的无依赖轻量级插件</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">安装</span><br><span class="line">npm i vue-count-to</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">eg</span>:</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">countTo</span> <span class="attr">:startVal</span>=<span class="string">&#x27;startVal&#x27;</span> <span class="attr">:endVal</span>=<span class="string">&#x27;endVal&#x27;</span> <span class="attr">:duration</span>=<span class="string">&#x27;3000&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">countTo</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">import</span> countTo <span class="keyword">from</span> <span class="string">&#x27;vue-count-to&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">components</span>: &#123; countTo &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    data () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">startVal</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">endVal</span>: <span class="number">2017</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>文档</p><table><thead><tr><th>Property</th><th>Description</th><th>type</th><th>default</th></tr></thead><tbody><tr><td>startVal</td><td>开始值</td><td>Number</td><td>0</td></tr><tr><td>endVal</td><td>结束值</td><td>Number</td><td>2017</td></tr><tr><td>duration</td><td>持续时间，以毫秒为单位</td><td>Number</td><td>3000</td></tr><tr><td>autoplay</td><td>自动播放</td><td>Boolean</td><td>true</td></tr><tr><td>decimals</td><td>要显示的小数位数</td><td>Number</td><td>0</td></tr><tr><td>decimal</td><td>十进制分割</td><td>String</td><td>.</td></tr><tr><td>separator</td><td>分隔符</td><td>String</td><td>,</td></tr><tr><td>prefix</td><td>前缀</td><td>String</td><td>‘’</td></tr><tr><td>suffix</td><td>后缀</td><td>String</td><td>‘’</td></tr><tr><td>useEasing</td><td>使用缓和功能</td><td>Boolean</td><td>true</td></tr><tr><td>easingFn</td><td>缓和回调</td><td>Function</td><td>—</td></tr></tbody></table><p>** 注意：当autoplay：true时，它将在startVal或endVal更改时自动启动**</p><p>回调钩子函数</p><table><thead><tr><th align="center">Function Name</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">mountedCallback</td><td align="center">挂载以后返回回调</td></tr><tr><td align="center">start</td><td align="center">开始计数</td></tr><tr><td align="center">pause</td><td align="center">暂停计数</td></tr><tr><td align="center">reset</td><td align="center">重置countTo</td></tr></tbody></table><h3 id="vuex-persist"><a href="#vuex-persist" class="headerlink" title="vuex-persist"></a>vuex-persist</h3><blockquote><p>在vue项目中使用vuex本地持久化能更方便我们对数据的管理，不需要写localStorage或cookie等集合方法,统一用store来管理全局数据。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eg1</span>:</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> floodPrevention <span class="keyword">from</span> <span class="string">&#x27;@/store/floodPrevention/floodPrevention&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VuexPersistence</span> <span class="keyword">from</span> <span class="string">&#x27;vuex-persist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">userInfo</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">            <span class="attr">depId</span>: <span class="string">&#x27;51515645165&#x27;</span>,</span><br><span class="line">            <span class="attr">sex</span>: <span class="string">&#x27;男&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="title function_">setUserInfo</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">            state.<span class="property">userInfo</span> = &#123;</span><br><span class="line">                ...state.<span class="property">userInfo</span>,</span><br><span class="line">                ...payload</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">getUserInfo</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">userInfo</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        floodPrevention</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">VuexPersistence</span>(&#123;</span><br><span class="line">            <span class="attr">storage</span>: <span class="variable language_">window</span>.<span class="property">sessionStorage</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure><p>属性文档</p><table><thead><tr><th align="left">属性</th><th align="left">类型</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">key</td><td align="left">string</td><td align="left">将状态存储在存储中的键。默认: ‘vuex’</td></tr><tr><td align="left">storage</td><td align="left">Storage (Web API)</td><td align="left">可传localStorage, sessionStorage, localforage 或者你自定义的存储对象. 接口必须要有get和set. <strong>默认是: window.localStorage</strong></td></tr><tr><td align="left">saveState</td><td align="left">function (key, state[, storage])</td><td align="left">如果不使用存储，这个自定义函数将保存状态保存为持久性。</td></tr><tr><td align="left">restoreState</td><td align="left">function (key[, storage]) =&gt; state</td><td align="left">如果不使用存储，这个自定义函数处理从存储中检索状态</td></tr><tr><td align="left">reducer</td><td align="left">function (state) =&gt; object</td><td align="left">将状态减少到只需要保存的值。默认情况下，保存整个状态。</td></tr><tr><td align="left">filter</td><td align="left">function (mutation) =&gt; boolean</td><td align="left">突变筛选。看mutation.type并返回true，只有那些你想坚持写被触发。所有突变的默认返回值为true。</td></tr><tr><td align="left">modules</td><td align="left">string[]</td><td align="left">要持久化的模块列表。</td></tr></tbody></table><blockquote><p>同类型插件 vuex-persistedstate 但是21年作者就不维护了</p></blockquote><h3 id="Vuetify"><a href="#Vuetify" class="headerlink" title="Vuetify"></a>Vuetify</h3><blockquote><p>一个前端基于 Material Design 的UI库</p></blockquote><h3 id="NUXTJS"><a href="#NUXTJS" class="headerlink" title="NUXTJS"></a>NUXTJS</h3><blockquote><p>vuejs+nodejs 的最佳实践</p></blockquote><h3 id="vuepress"><a href="#vuepress" class="headerlink" title="vuepress"></a>vuepress</h3><blockquote><p>方便文档编写，支持markdown语法</p></blockquote><h3 id="vue-mate"><a href="#vue-mate" class="headerlink" title="vue-mate"></a>vue-mate</h3><blockquote><p>基于vue2.0插件，用于管理html head标签，支持ssr. 头部信息双向绑定便于管理</p></blockquote><h3 id="vue-charts-js"><a href="#vue-charts-js" class="headerlink" title="vue-charts .js"></a>vue-charts .js</h3><blockquote><p>vue 图表</p></blockquote><h3 id="vue-grid-layout"><a href="#vue-grid-layout" class="headerlink" title="vue grid layout"></a>vue grid layout</h3><blockquote><p>通用vuejs栅格布局系统<br>1、可拖拽<br>2、调整大小<br>3、可序列化，还原布局<br>4、自动化 RTL 支持<br>5、支持响应式</p></blockquote><h3 id="vue-draggable"><a href="#vue-draggable" class="headerlink" title="vue draggable"></a>vue draggable</h3><blockquote><p>优秀的vue拖拽组件</p></blockquote><h3 id="vee-validate"><a href="#vee-validate" class="headerlink" title="vee validate"></a>vee validate</h3><blockquote><p>数据类型验证</p></blockquote><h3 id="vue-Toastification"><a href="#vue-Toastification" class="headerlink" title="vue Toastification"></a>vue Toastification</h3><blockquote><p>轻量级通知组件</p></blockquote><h3 id="vue-Tour"><a href="#vue-Tour" class="headerlink" title="vue Tour"></a>vue Tour</h3><blockquote><p>轻巧简单的可自定义新手指引插件</p></blockquote><h3 id="Trois-语法为three-vue3库"><a href="#Trois-语法为three-vue3库" class="headerlink" title="Trois (语法为three) vue3库"></a>Trois (语法为three) vue3库</h3><h3 id="vue-presistedstate"><a href="#vue-presistedstate" class="headerlink" title="vue-presistedstate"></a>vue-presistedstate</h3><blockquote><p>在页面重新加载之间保持并补充您的<a href="https://vuex.vuejs.org/">Vuex</a>状态。此项目已经不维护了</p></blockquote><p>用法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&quot;vuex-persistedstate&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">createPersistedState</span>()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Vux 模块示例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* module.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dataStore = &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">data</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* store.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; dataStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./module&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataState = <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">  <span class="attr">paths</span>: [<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    dataStore</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [dataState]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><blockquote><p>ajax 请求工具，<a href="http://www.axios-js.com/zh-cn/docs/#axios-create-config">看文档</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HttpRequest</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">baseURL</span> = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>? <span class="string">&#x27;https://www.fastmock.site&#x27;</span>: <span class="string">&#x27;https://www.fastmock.site&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timeout</span> = <span class="number">15000</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span> = <span class="number">0</span> <span class="comment">// 请求队列</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cache</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setInterceptor</span>(<span class="params">instance, url</span>) &#123;</span><br><span class="line">        instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 开启 loading</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">queue</span>) &#123;</span><br><span class="line">                <span class="comment">// open loading</span></span><br><span class="line">                context.<span class="property">$bus</span>.<span class="title function_">emit</span>(<span class="string">&#x27;showLoading&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 统一增加token</span></span><br><span class="line">            <span class="comment">// const token = store.getters[&#x27;user/token&#x27;]</span></span><br><span class="line">            config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = <span class="string">&#x27;tokentest&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 记录请求的取消函数</span></span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">CancelToken</span> =  axios.<span class="property">CancelToken</span></span><br><span class="line">            config.<span class="property">cancelToken</span> = <span class="keyword">new</span> <span class="title class_">CancelToken</span>(<span class="function">(<span class="params">c</span>)=&gt;</span> &#123; <span class="comment">// 存入 vux,组件销毁时执行</span></span><br><span class="line">                <span class="comment">// c 就是取消请求的token</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">push</span>(c)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">queue</span>++</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> config</span><br><span class="line">        &#125;, <span class="function">(<span class="params">err</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 响应就从队列删除 </span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">queue</span>--</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">queue</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// close loading</span></span><br><span class="line">                context.<span class="property">$bus</span>.<span class="title function_">emit</span>(<span class="string">&#x27;closeLoading&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(err);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">        instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">queue</span>--</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">queue</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// close loading</span></span><br><span class="line">                context.<span class="property">$bus</span>.<span class="title function_">emit</span>(<span class="string">&#x27;closeLoading&#x27;</span>)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;关闭 loading&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 这里判断要依据后端返回格式而定</span></span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">400200</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(res.<span class="property">msg</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="function">(<span class="params">err</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">queue</span>--</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">queue</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// close loading</span></span><br><span class="line">                context.<span class="property">$bus</span>.<span class="title function_">emit</span>(<span class="string">&#x27;closeLoading&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(err);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">request</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> instance = axios.<span class="title function_">create</span>()</span><br><span class="line">        <span class="keyword">let</span> config = &#123;</span><br><span class="line">            <span class="attr">baseURL</span>: <span class="variable language_">this</span>.<span class="property">baseURL</span>,</span><br><span class="line">            <span class="attr">timeout</span>: <span class="variable language_">this</span>.<span class="property">timeout</span>,</span><br><span class="line">            <span class="comment">// validateStatus: function (status) &#123;</span></span><br><span class="line">            <span class="comment">//     console.log(&#x27;当前请求状态:&#x27;, status);</span></span><br><span class="line">            <span class="comment">//     return status &gt;= 200 &amp;&amp; status &lt; 300; // default</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">            ...options</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setInterceptor</span>(instance, config.<span class="property">url</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">instance</span>(config) <span class="comment">// 返回 promise 对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">            url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">            <span class="attr">params</span>: data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">post</span>(<span class="params">url, data, config = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">            url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data,</span><br><span class="line">            ...config</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="eventemitter3"><a href="#eventemitter3" class="headerlink" title="eventemitter3"></a>eventemitter3</h3><blockquote><p>EventEmitter3 是一个高性能的 EventEmitter。它已经针对各种代码路径进行了微优化，使其成为 Node.js 和浏览器可用的最快 EventEmitter 之一。该模块的 API 与 Node.js 默认附带的 EventEmitter 兼容，但有一些细微差别：</p><ul><li>域支持已被删除。</li><li><code>throw</code>当您发出<code>error</code>事件并且没有人在听时，我们不会出错。</li><li>和事件已被删除<code>newListener</code>，<code>removeListener</code>因为它们仅在一些不常见的用例中有用。</li><li>、<code>setMaxListeners</code>和方法不可用 <code>getMaxListeners</code>。<code>prependListener``prependOnceListener</code></li><li>支持事件的自定义上下文，因此无需使用<code>fn.bind</code>.</li><li>该<code>removeListener</code>方法删除所有匹配的侦听器，而不仅仅是第一个。</li></ul><p>它是现有 EventEmitters 的替代品，但速度更快。免费表演，谁不想呢？EventEmitter 是用 EcmaScript 3 编写的，因此它可以在您需要支持的最旧的浏览器和节点版本中工作。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save eventemitter3</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">EE</span> = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>()</span><br><span class="line">  , context = &#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> === context); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">EE</span>.<span class="title function_">once</span>(<span class="string">&#x27;event-name&#x27;</span>, emitted, context);</span><br><span class="line"><span class="variable constant_">EE</span>.<span class="title function_">on</span>(<span class="string">&#x27;another-event&#x27;</span>, emitted, context);</span><br><span class="line"><span class="variable constant_">EE</span>.<span class="title function_">removeListener</span>(<span class="string">&#x27;another-event&#x27;</span>, emitted, context);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>EventEmitter在其原型上添加了如下方法：</p><blockquote><p>eventNames、listeners、listenerCount、emit、on / addListener、once、off / removeListener、removeAllListeners</p></blockquote><p><img src="https://raw.githubusercontent.com/wyf195075595/images/main/blog/v2-1d23d0fcb5c423d69da86237d6201af7_r.jpg" alt="preview"></p><h3 id="amfe-flexible"><a href="#amfe-flexible" class="headerlink" title="amfe-flexible"></a>amfe-flexible</h3><blockquote><p>手淘 rem适配方案，为html、body添加font-size，窗口调整时候重新设置font-size</p></blockquote><h3 id="postcss-pxtorem"><a href="#postcss-pxtorem" class="headerlink" title="postcss-pxtorem"></a>postcss-pxtorem</h3><blockquote><p>通过postcss-pxtorem来实现自动渲染px至rem的开发与生产工作<br>而不需要再手动计算。将px转换为px</p></blockquote><h3 id="GSAP（GreenSock）"><a href="#GSAP（GreenSock）" class="headerlink" title="GSAP（GreenSock）"></a><a href="https://greensock.com/">GSAP（GreenSock）</a></h3><blockquote><p>最健全的web动画库之一</p></blockquote><h3 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h3><blockquote><p>代码规范检查，建议使用文件配置得方式来编写配置。</p><p>安装 ESlint 后，通过 eslint –init  初始化配置文件</p></blockquote><p>配置规则如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line"><span class="string">&quot;规则名&quot;</span>: [规则值, 规则配置]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 规则值： &quot;off&quot;/0 表示关闭， “warn&quot;/1 表示警告，&quot;error&quot;/2 表示错误</span></span><br></pre></td></tr></table></figure><p>官方提供的可选检测规则多达200条，我们可以从中筛选出自己需要的规则。还可以通过配置项文件得 extends 字段来启用官方推的或者开源的规则集。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;extends&quot;</span>: <span class="string">&quot;eslint:recommended&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果在某些特殊场景中，需要有针对性地避开某些检测规则（而不是对整个工程禁用某项检测），则可以使用下面的语法在源代码中进行注释：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 禁止检查这一行</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&#x27;foo&#x27;</span>); <span class="comment">/* eslint-disable-line no-alert*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 禁止检查下一行</span></span><br><span class="line"><span class="comment">/*eslint-disable-next no-alert*/</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ESLint和Prettier是非常好的搭档，尽管有时候因为配置的问题可能会在检查项上出现冲突，这种时候根据实际要求关闭其中一个的检查项即可。总之，ESLint更倾向于发现和修复语言本身相关的漏洞或风险，而Prettier关注的则是格式和排版风格方面的一致性，两者各司其职。</p></blockquote><h3 id="Requirejs-与-模块化推演"><a href="#Requirejs-与-模块化推演" class="headerlink" title="Requirejs 与 模块化推演"></a>Requirejs 与 模块化推演</h3><ul><li><p>代码隔离</p><p>  第一代模块化解决方案，立即执行函数（IIFE）</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">function</span>(<span class="params">win, <span class="literal">undefined</span></span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)(<span class="variable language_">window</span>)</span><br></pre></td></tr></table></figure><p>  我们知道“undefined”在JavaScript语言中是一个关键字，不仅如此，它还是全局对象的一个属性，它的值被定义为“undefined”。在低版本的浏览器中，它是可以被赋值修改的，一旦有人恶意修改了“undefined”这个属性的值，那么你写在代码里的所有针对“undefined”的判断逻辑就会混乱。由于立即执行函数中的最后一个形参没有对应于任何值，因此其会被自动赋值为真正的“undefined”，以避免上述风险。</p></li></ul><h3 id="Loadsh-js"><a href="#Loadsh-js" class="headerlink" title="Loadsh.js"></a>Loadsh.js</h3><blockquote><p>它是一个具有一致性、模块化且高性能的JavaScript实用工具库</p></blockquote><h3 id="静态类型检查"><a href="#静态类型检查" class="headerlink" title="静态类型检查"></a>静态类型检查</h3><blockquote><p>两种流行的静态类型检查方案Flow.js和TypeScript的使用方法。 js 是一门动态类型语言，只有在运行时才会发现错误，而静态类型检查可以帮我们避免很多不必要得错误和快速定位错误</p></blockquote><p>Flow.js</p><p>优势无侵入性是Flow.js最有吸引力的特点之一，当你希望尝试它时，可以轻松地将它引入项目中，当你的项目不再需要使用它时，使用“babel”或“flow-remove-types”命令可以非常轻松地将类型信息从源代码中去除，进而得到一份纯净的源代码，它就像一个自带卸载程序的辅助工具。相较于TypeScript的学习曲线，Flow.js的上手难度几乎低到可以忽略不计。无论如何，建议尝试使用它，将它作为TypeScript或是Java的预备知识也是非常好的。</p><p>TypeScript </p><p>学习成本相对较高，但是功能更加强大。</p><h3 id="Ramda-js"><a href="#Ramda-js" class="headerlink" title="Ramda.js"></a>Ramda.js</h3><p>为开发者提供了许多实用的工具原子函数</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;1、VueUse&quot;&gt;&lt;a href=&quot;#1、VueUse&quot; class=&quot;headerlink&quot; title=&quot;1、VueUse&quot;&gt;&lt;/a&gt;1、VueUse&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;​    VueUse 是 &lt;strong&gt;Anthony Fu  大佬&lt;/strong&gt;的一个开源项目，它为Vue的开发者提供了大量用于 Vue2 和Vue3 的基本 &lt;strong&gt;Composition API&lt;/strong&gt; 实用工具函数。&lt;/p&gt;
&lt;p&gt;它有几十个用于常见开发人员用例的解决方案，如跟踪&lt;code&gt;ref&lt;/code&gt;更改，检测元素可见性，简化常见Vue模式，键盘/鼠标输入等。 这是真正节省开发时间的好方法，因为我们不必自己亲手添加所有这些标准功能，拿来主义，用就对了(再次感谢大佬的付出)。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/categories/vue/"/>
    
    
    <category term="vue" scheme="https://wyf195075595.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>react 插件</title>
    <link href="https://wyf195075595.github.io/2022/08/05/programming/react/react%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96/"/>
    <id>https://wyf195075595.github.io/2022/08/05/programming/react/react%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96/</id>
    <published>2022-08-05T03:19:28.000Z</published>
    <updated>2022-08-12T07:43:16.621Z</updated>
    
    <content type="html"><![CDATA[<h3 id="react-PureComponent-与-React-Component-区别"><a href="#react-PureComponent-与-React-Component-区别" class="headerlink" title="react.PureComponent 与 React.Component 区别"></a>react.PureComponent 与 React.Component 区别</h3><blockquote><p>唯一的区别在于 Rect.Component 没有实现 shouldComponentUpdate() *<strong>一个不太常用的生命周期方法*</strong>, 而 React.PureComponent 中以浅层对比 prop 和 state 的方式来实现了该函数。</p></blockquote><blockquote><p><strong>注意</strong></p><p>React.PureComponent 中的 <strong>shouldComponentUpdate()</strong> 仅作<strong>对象的浅层比较</strong>。如果对象中包含复杂的数据结构，则可能无法检查到深层的差别，产生错误的对比结果。所以只在props 和 state 比较简单时使用这个，或者在深层数据结构发生变化时调用<strong>forceUpdate()<strong>来确保组件被正确地更新。也可以使用</strong>immutable</strong> 对象加速嵌套数据的比较。</p><p>此外，React中 的 <strong>shouldComponentUpdate()</strong> 将跳过所有子组件树的 prop 更新。因此，确保所有子组件也是“纯的”组件。</p></blockquote><span id="more"></span><h3 id="useMemo与useCallback"><a href="#useMemo与useCallback" class="headerlink" title="useMemo与useCallback"></a>useMemo与useCallback</h3><blockquote><p>在class 组件中，内部有 state 状态管理。</p><ol><li>调用setState，就会触发组件的重新渲染，无论前后的state是否不同</li><li>父组件更新，子组件也会自动的更新</li></ol><p>基于上面的两点，我们通常的解决方案是：使用immutable进行比较，在不相等的时候调用<a href="https://so.csdn.net/so/search?q=setState&spm=1001.2101.3001.7020">setState</a>；在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新</p></blockquote><p>在 function 组件中,没有 shouldComponentUpdate 钩子函数，useEffect 不区分mount和update两个状态</p><p>因此useMemo 和useCallback就是解决性能问题的杀手锏。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">export default function WithoutMemo() &#123;</span><br><span class="line">    const [count, setCount] = useState(1);</span><br><span class="line">    const [val, setValue] = useState(&#x27;&#x27;);</span><br><span class="line"> </span><br><span class="line">    function expensive() &#123;</span><br><span class="line">        console.log(&#x27;compute&#x27;);</span><br><span class="line">        let sum = 0;</span><br><span class="line">        for (let i = 0; i &lt; count * 100; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;-&#123;val&#125;-&#123;expensive()&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+c1&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面例子中，expensive 方法在任何状态更新时都会执行一次，它应该是只依赖 count 状态。此处可使用useMemo 优化，useMemo 返回缓存的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">export default function WithoutMemo() &#123;</span><br><span class="line">    const [count, setCount] = useState(1);</span><br><span class="line">    const [val, setValue] = useState(&#x27;&#x27;);</span><br><span class="line"> </span><br><span class="line">    const expensive = useMemo(() =&gt; &#123;</span><br><span class="line">        console.log(&#x27;compute&#x27;);</span><br><span class="line">        let sum = 0;</span><br><span class="line">        for (let i = 0; i &lt; count * 100; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;, [count]);</span><br><span class="line"> </span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;-&#123;val&#125;-&#123;expensive&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+c1&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setValue(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>useCallback 它与 useMemo 相似，返回 缓存的函数. </p><p>当 count 更新时，返回新的函数，使用 Set 来判断返回函数是否更新。每次修改count，set.size就会+1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useCallback &#125; from &#x27;react&#x27;;</span><br><span class="line"> </span><br><span class="line">const set = new Set();</span><br><span class="line"> </span><br><span class="line">export default function Callback() &#123;</span><br><span class="line">    const [count, setCount] = useState(1);</span><br><span class="line">    const [val, setVal] = useState(&#x27;&#x27;);</span><br><span class="line"> </span><br><span class="line">    const callback = useCallback(() =&gt; &#123;</span><br><span class="line">        console.log(count);</span><br><span class="line">    &#125;, [count]);</span><br><span class="line">    set.add(callback);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;h4&gt;&#123;set.size&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setVal(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用场景，父子组件传值。父组件更新子组件也会更新。但大多数是没有必要的，通过 useCallback 可以优化。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useCallback, useEffect &#125; from &#x27;react&#x27;;</span><br><span class="line">// 父组件</span><br><span class="line">function Parent() &#123;</span><br><span class="line">    const [count, setCount] = useState(1);</span><br><span class="line">    const [val, setVal] = useState(&#x27;&#x27;);</span><br><span class="line"> </span><br><span class="line">    const callback = useCallback(() =&gt; &#123;</span><br><span class="line">        return count;</span><br><span class="line">    &#125;, [count]);</span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &lt;h4&gt;&#123;count&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;Child callback=&#123;callback&#125;/&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">            &lt;input value=&#123;val&#125; onChange=&#123;event =&gt; setVal(event.target.value)&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line">// 子组件</span><br><span class="line">function Child(&#123; callback &#125;) &#123;</span><br><span class="line">    const [count, setCount] = useState(() =&gt; callback());</span><br><span class="line">    useEffect(() =&gt; &#123;</span><br><span class="line">        setCount(callback());</span><br><span class="line">    &#125;, [callback]);</span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">        &#123;count&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所有依赖本地状态或props来创建函数，需要使用到缓存函数的地方，都是useCallback的应用场景。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;react-PureComponent-与-React-Component-区别&quot;&gt;&lt;a href=&quot;#react-PureComponent-与-React-Component-区别&quot; class=&quot;headerlink&quot; title=&quot;react.PureComponent 与 React.Component 区别&quot;&gt;&lt;/a&gt;react.PureComponent 与 React.Component 区别&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;唯一的区别在于 Rect.Component 没有实现 shouldComponentUpdate() *&lt;strong&gt;一个不太常用的生命周期方法*&lt;/strong&gt;, 而 React.PureComponent 中以浅层对比 prop 和 state 的方式来实现了该函数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;React.PureComponent 中的 &lt;strong&gt;shouldComponentUpdate()&lt;/strong&gt; 仅作&lt;strong&gt;对象的浅层比较&lt;/strong&gt;。如果对象中包含复杂的数据结构，则可能无法检查到深层的差别，产生错误的对比结果。所以只在props 和 state 比较简单时使用这个，或者在深层数据结构发生变化时调用&lt;strong&gt;forceUpdate()&lt;strong&gt;来确保组件被正确地更新。也可以使用&lt;/strong&gt;immutable&lt;/strong&gt; 对象加速嵌套数据的比较。&lt;/p&gt;
&lt;p&gt;此外，React中 的 &lt;strong&gt;shouldComponentUpdate()&lt;/strong&gt; 将跳过所有子组件树的 prop 更新。因此，确保所有子组件也是“纯的”组件。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="react" scheme="https://wyf195075595.github.io/categories/react/"/>
    
    
    <category term="react" scheme="https://wyf195075595.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>vue 实践与优化</title>
    <link href="https://wyf195075595.github.io/2022/08/05/programming/vue/%E5%AE%9E%E8%B7%B5%E5%8F%8A%E4%BC%98%E5%8C%96/"/>
    <id>https://wyf195075595.github.io/2022/08/05/programming/vue/%E5%AE%9E%E8%B7%B5%E5%8F%8A%E4%BC%98%E5%8C%96/</id>
    <published>2022-08-05T00:23:10.000Z</published>
    <updated>2022-08-26T09:26:01.902Z</updated>
    
    <content type="html"><![CDATA[<h3 id="在使用-element-UI-的-el-image-时，首次加载图片出现白色闪现效果"><a href="#在使用-element-UI-的-el-image-时，首次加载图片出现白色闪现效果" class="headerlink" title="在使用 element UI 的 el-image 时，首次加载图片出现白色闪现效果"></a>在使用 element UI 的 el-image 时，首次加载图片出现白色闪现效果</h3><p>这是应为 组件内 在加载前和加载中是一个类名为el-image__placeholder的div标签，在加载后和加载出错后的处理分别是一个div和img标签。</p><p>解决方法：在加载前和加载后的样式上做更改，可以<strong>重写覆盖</strong>类名<strong>el-image__placeholder</strong>和<strong>el-image__error</strong>来自定义自己想要的效果了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 将默认的白色背景去除</span><br><span class="line"></span><br><span class="line">::v-deep .el-image__placeholder,</span><br><span class="line">::v-deep .el-image__error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">background</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;在使用-element-UI-的-el-image-时，首次加载图片出现白色闪现效果&quot;&gt;&lt;a href=&quot;#在使用-element-UI-的-el-image-时，首次加载图片出现白色闪现效果&quot; class=&quot;headerlink&quot; title=&quot;在使用 elem</summary>
      
    
    
    
    <category term="vuex" scheme="https://wyf195075595.github.io/categories/vuex/"/>
    
    
  </entry>
  
  <entry>
    <title>linux 常用命令</title>
    <link href="https://wyf195075595.github.io/2022/08/02/programming/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://wyf195075595.github.io/2022/08/02/programming/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2022-08-02T02:54:10.000Z</published>
    <updated>2022-09-07T03:59:52.632Z</updated>
    
    <content type="html"><![CDATA[<h3 id="用命令netstat查侦听端口"><a href="#用命令netstat查侦听端口" class="headerlink" title="用命令netstat查侦听端口"></a>用命令netstat查侦听端口</h3><p><code>netstat</code> 是一个命令行工具，可以提供有关网络连接的信息。</p><p>要列出正在侦听的所有TCP或UDP端口，包括使用端口和套接字状态的服务，请使用以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tunlp</span><br></pre></td></tr></table></figure><p>此命令中使用的选项具有以下含义：</p><ul><li>-t - 显示TCP端口。</li><li>-u - 显示UDP端口。</li><li>-n - 显示数字地址而不是解析主机。</li><li>-l - 仅显示侦听端口。</li><li>-p - 显示监听器进程的PID和名称。仅当您以root或sudo用户身份运行命令时，才会显示此信息。</li></ul><span id="more"></span><h3 id="查询nginx主进程号"><a href="#查询nginx主进程号" class="headerlink" title="查询nginx主进程号"></a>查询nginx主进程号</h3><p>　　ps -ef | grep nginx</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;用命令netstat查侦听端口&quot;&gt;&lt;a href=&quot;#用命令netstat查侦听端口&quot; class=&quot;headerlink&quot; title=&quot;用命令netstat查侦听端口&quot;&gt;&lt;/a&gt;用命令netstat查侦听端口&lt;/h3&gt;&lt;p&gt;&lt;code&gt;netstat&lt;/code&gt; 是一个命令行工具，可以提供有关网络连接的信息。&lt;/p&gt;
&lt;p&gt;要列出正在侦听的所有TCP或UDP端口，包括使用端口和套接字状态的服务，请使用以下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo netstat -tunlp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;此命令中使用的选项具有以下含义：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;-t - 显示TCP端口。&lt;/li&gt;
&lt;li&gt;-u - 显示UDP端口。&lt;/li&gt;
&lt;li&gt;-n - 显示数字地址而不是解析主机。&lt;/li&gt;
&lt;li&gt;-l - 仅显示侦听端口。&lt;/li&gt;
&lt;li&gt;-p - 显示监听器进程的PID和名称。仅当您以root或sudo用户身份运行命令时，才会显示此信息。&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://wyf195075595.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>项目中遇到的样式问题</title>
    <link href="https://wyf195075595.github.io/2022/07/23/programming/htmlcss/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98/"/>
    <id>https://wyf195075595.github.io/2022/07/23/programming/htmlcss/%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98/</id>
    <published>2022-07-23T05:07:23.000Z</published>
    <updated>2022-08-02T02:52:41.238Z</updated>
    
    <content type="html"><![CDATA[<h3 id="scss-文件引入样式不生效"><a href="#scss-文件引入样式不生效" class="headerlink" title="scss 文件引入样式不生效"></a>scss 文件引入样式不生效</h3><blockquote><p>​    vue + sacc 项目, 公用样式 common.scss 样式嵌套写法导入不生效</p><p>现象：样式表只有最外层样式生效，嵌套样式不生效（没有解析嵌套语法）</p></blockquote><p>下面这种方式导入，样式不能嵌套写。 必须使用 层级选择器方式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import url(&#x27;@/style/common.scss&#x27;);</span><br></pre></td></tr></table></figure><p>解决：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &#x27;@/style/common.scss&#x27;;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="element-ui-表格-宽度不随父级容器变化而自适应"><a href="#element-ui-表格-宽度不随父级容器变化而自适应" class="headerlink" title="element-ui 表格 宽度不随父级容器变化而自适应"></a>element-ui 表格 宽度不随父级容器变化而自适应</h3><blockquote><p>页面布局方式为：父级 display: flex; 项目。自身宽高100%。</p><p>现象：初次加载没有问题，页面调整宽度时，不随父级宽度变化</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table</span><br><span class="line">    :data=&quot;tableData&quot;</span><br><span class="line">    :cell-style=&quot;isRed&quot;</span><br><span class="line">    height=&quot;150&quot;</span><br><span class="line">    border</span><br><span class="line">    style=&quot;width: 100%&quot;&gt;</span><br><span class="line">&lt;el-table-column prop=&quot;id&quot; label=&quot;设备编码&quot; &gt;</span><br><span class="line">&lt;el-table-column prop=&quot;id&quot; label=&quot;设备编码&quot; &gt;</span><br><span class="line">&lt;el-table-column prop=&quot;id&quot; label=&quot;设备编码&quot; &gt;</span><br><span class="line">&lt;el-table-column prop=&quot;id&quot; label=&quot;设备编码&quot; &gt;</span><br><span class="line"></span><br><span class="line">&lt;/el-table&gt;</span><br></pre></td></tr></table></figure><p>解决：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table</span><br><span class="line">  :data=&quot;tableData&quot;</span><br><span class="line">  height=&#x27;calc(100%)&#x27; border fit&gt;</span><br><span class="line">  &lt;el-table-column prop=&quot;td1&quot; label=&quot;表头1&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">  &lt;el-table-column prop=&quot;td1&quot; label=&quot;表头2&quot; &gt;&lt;/el-table-column&gt;</span><br><span class="line">  &lt;el-table-column prop=&quot;td1&quot; label=&quot;表头3&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">  &lt;el-table-column prop=&quot;td1&quot; label=&quot;表头4&quot; &gt;&lt;/el-table-column&gt;</span><br><span class="line">  &lt;el-table-column prop=&quot;td1&quot; label=&quot;表头5&quot; &gt;&lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">&lt;/el-table&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;scss-文件引入样式不生效&quot;&gt;&lt;a href=&quot;#scss-文件引入样式不生效&quot; class=&quot;headerlink&quot; title=&quot;scss 文件引入样式不生效&quot;&gt;&lt;/a&gt;scss 文件引入样式不生效&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;​    vue + sacc 项目, 公用样式 common.scss 样式嵌套写法导入不生效&lt;/p&gt;
&lt;p&gt;现象：样式表只有最外层样式生效，嵌套样式不生效（没有解析嵌套语法）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;下面这种方式导入，样式不能嵌套写。 必须使用 层级选择器方式&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@import url(&amp;#x27;@/style/common.scss&amp;#x27;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;解决：&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@import &amp;#x27;@/style/common.scss&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="htmlcss" scheme="https://wyf195075595.github.io/categories/htmlcss/"/>
    
    
  </entry>
  
</feed>
