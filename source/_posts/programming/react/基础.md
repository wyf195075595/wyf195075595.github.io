---
title: react åŸºç¡€çŸ¥è¯†
date: 2022-06-17 08:23:10
tags: åŸºç¡€çŸ¥è¯†
categories: react
---
# reacté¡¹ç›®åˆ›å»º

## 1ã€åˆ›å»ºé¡¹ç›®

```js
npx create-react-app my-app
cd my-app
npm start
```

<!--more-->

## 2ã€ç»„ä»¶

```js
import React,{useState,useEffect,useRef} from 'react';//ä»»ä½•ç»„ä»¶å¿…é¡»å¼•å…¥react
//å‡½æ•°ç»„ä»¶
//ç»„ä»¶åç§°å¤§å†™å¼€å¤´
function App(props){
    //å“åº”å¼æ•°æ®
    let [menuList,setMenuList] = useState([]);
    let myRef = useRef(null);
    //ç±»ä¼¼äºç”Ÿå‘½å‘¨æœŸå‡½æ•°
    useEffect(() => {
        console,log('ul å…ƒç´ DOM',myRef.current);
        React.axios({
            url:'/menu/getMenuList',
            // method:'GET'
        }).then(res=>{
            if(res.data.data.length){
                setMenuList(res.data.data)
            }
        })
        return () => {
            
        };
    },[]);
    return(
    	<div>
        	æˆ‘æ˜¯ç»„ä»¶App
        	<ul ref = {myRef}>
        	{
        		menuList.length && menuList.map(ele=>{
        			//key åªæ˜¯åœ¨å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¿…é¡»å”¯ä¸€
        			return <li key={ele.id}>{ele.title}</li>
        		})
        	}
            </ul>
        
        </div>
    )
}

//classç»„ä»¶
class Test extends React.Component {
    constructor(props) {
        super(props);
        //å±€éƒ¨å“åº”å¼æ•°æ®
        this.state = {a:'Test'};
        // ä¸ºäº†åœ¨å›è°ƒä¸­ä½¿ç”¨ `this`ï¼Œè¿™ä¸ªç»‘å®šæ˜¯å¿…ä¸å¯å°‘çš„
        this.test1 = this.test1.bind(this);
    }
    //ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°
    componentDidMount() {
  		console,log('div å…ƒç´ DOM',this.refs.myRef);
    }
    //æ­£å¸¸å†™æ³•
    test1(a){
        this.setState({a})
    }
    //è¿™æ˜¯ *å®éªŒæ€§* è¯­æ³•ã€‚
    test2 = (a,e)=>{
        this.setState({a})
    }
    render(){
        
        
        return(
            <>
        	<div ref = 'myRef' onClick={this.test1.bind(this, 'xxx')}>æˆ‘æ˜¯ç»„ä»¶{a}</div>
        	<div onClick={(e)=>this.test2('xxx',e)}>æˆ‘æ˜¯ç»„ä»¶{a}</div>
		   </>
        )
    }
}


//ä¸¤ç§ç»„ä»¶å¯ä»¥ç›¸äº’åµŒå¥—ä½¿ç”¨ï¼Œç»„ä»¶è¿˜èƒ½è¢«ä½œä¸ºå‚æ•°ä¼ å…¥
```

## 3ã€è¡¨å•å…ƒç´ 

```js
class EssayForm extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      value: 'è¯·æ’°å†™ä¸€ç¯‡å…³äºä½ å–œæ¬¢çš„ DOM å…ƒç´ çš„æ–‡ç« .'
    };

    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
  }

  handleChange(event) {
    this.setState({value: event.target.value});
    //ä¸ç¡®å®šé”®åæ—¶
    let name = event.target.name
    this.setState({
      [name]: value
    });
  }

  handleSubmit(event) {
    alert('æäº¤çš„æ–‡ç« : ' + this.state.value);
    event.preventDefault();
  }

  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        <label>
          æ–‡ç« :
          <textarea value={this.state.value} onChange={this.handleChange} />
        </label>
        <input type="submit" value="æäº¤" />
      </form>
    );
  }
}
```

## 4ã€è·¯ç”±

```html
//import { BrowserRouter as Router, Switch, Route,Link } from 'react-router-dom';
<Layout className="pageContent">
    //æ ¹è·¯ç”±
    <Router >
            <Layout >
            <Header style={{padding:'0'}}>
                <Head menuList={menuList}/>
            </Header>
            <Content>
                	//switchåªä¼šæ¸²æŸ“åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ 
                    <Switch >
                        <Route  path="/setup" component={SetUp}/>
                        <Route  path="/article" component={Article}/>
                        <Route  path="/articledetail" component={ArticleDetail}/>
                        <Route  path="/toPersonInfo" component={PersonInfo}/>
                        //exact è·¯ç”±ä¸¥æ ¼åŒ¹é…
                        <Route  exact path="/" component={Article} />
                        <Route  component={NotFound} />
                    </Switch>
            </Content>
            <Footer>
                <Foot  />
            </Footer>
        </Layout>
        <Sider>
                <Route   component={Login}  dispatch = {dispatch} /> 
        </Sider>
    </Router>  

</Layout>

```

### 1ã€è·¯ç”±ä¼ å‚

1. linkæ ‡ç­¾

	```js
	// é¡µé¢åˆ·æ–°å­˜åœ¨ å‚æ•°å›æ˜¾åˆ°åœ°å€æ  ç±»ä¼¼äºgetè¯·æ±‚ ä¸èƒ½ä¼ è¿‡å¤§çš„æ•°æ®
	pathname + search
	//Aé¡µé¢
	<Link to={{pathname: '/setting', search:'id=1'}}>jump --- search</Link>
	
	//Bé¡µé¢å–å‚
	this.props.history.location.search
	```

	```js
	// é¡µé¢åˆ·æ–°ä¸å­˜åœ¨ å‚æ•°ä¸å›æ˜¾åˆ°åœ°å€æ  
	pathname + ä»»æ„å€¼
	//Aé¡µé¢
	<Link to={{pathname: '/setting', abc:'id=1'}}>jump --- search</Link>
	
	//Bé¡µé¢å–å‚
	this.props.history.location.abc
	```

	```js
	// é¡µé¢åˆ·æ–°å­˜åœ¨ å‚æ•°ä¸å›æ˜¾åˆ°åœ°å€æ  
	pathname + state
	//Aé¡µé¢
	<Link to={{pathname: '/setting', state:{'id':1}}}>jump --- search</Link>
	
	//Bé¡µé¢å–å‚
	this.props.history.location.state
	```

	```js
	// åŠ¨æ€è·¯ç”±åé¢åŠ ?è¡¨ç¤ºå¯é€‰ï¼Œä¸åŠ è¡¨ç¤ºå¿…é€‰
	<Route path="/setting/:id?" component={Setting} />
	//Aé¡µé¢
	let id = 1;
	<Link to={{pathname: `/setting/${id}`}}>jump --- params</Link>
	// å–å‚
	//Bé¡µé¢
	this.props.history.match.params.id
	```

	> æ³¨æ„ã€state ä¼ å‚çš„æ–¹å¼åªæ”¯æŒBrowserrouterè·¯ç”±ï¼Œä¸æ”¯æŒhashrouterã€‘

2. è¯•è¯•

## 



## Hooks

### useRef

- å­˜å‚¨ [timeout ID](https://developer.mozilla.org/docs/Web/API/setTimeout)
- å­˜å‚¨å’Œæ“ä½œ [DOM å…ƒç´ ](https://developer.mozilla.org/docs/Web/API/Element)
- å­˜å‚¨ä¸éœ€è¦è¢«ç”¨æ¥è®¡ç®— JSX çš„å…¶ä»–å¯¹è±¡ã€‚

å¦‚æœä½ çš„ç»„ä»¶éœ€è¦å­˜å‚¨ä¸€äº›å€¼ï¼Œä½†ä¸å½±å“æ¸²æŸ“é€»è¾‘ï¼Œè¯·é€‰æ‹© refã€‚

éµå¾ªè¿™äº›åŸåˆ™å°†ä½¿ä½ çš„ç»„ä»¶æ›´å…·å¯é¢„æµ‹æ€§ï¼š

- **å°† ref è§†ä¸ºè„±å›´æœºåˆ¶**ã€‚å½“ä½ ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿæˆ–æµè§ˆå™¨ API æ—¶ï¼Œref å¾ˆæœ‰ç”¨ã€‚å¦‚æœä½ å¾ˆå¤§ä¸€éƒ¨åˆ†åº”ç”¨ç¨‹åºé€»è¾‘å’Œæ•°æ®æµéƒ½ä¾èµ–äº refï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ä½ çš„æ–¹æ³•ã€‚
- **ä¸è¦åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¯»å–æˆ–å†™å…¥ `ref.current`ã€‚** å¦‚æœæ¸²æŸ“è¿‡ç¨‹ä¸­éœ€è¦æŸäº›ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ [state](https://react.docschina.org/learn/state-a-components-memory) ä»£æ›¿ã€‚ç”±äº React ä¸çŸ¥é“ `ref.current` ä½•æ—¶å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿åœ¨æ¸²æŸ“æ—¶è¯»å–å®ƒä¹Ÿä¼šä½¿ç»„ä»¶çš„è¡Œä¸ºéš¾ä»¥é¢„æµ‹ã€‚ï¼ˆå”¯ä¸€çš„ä¾‹å¤–æ˜¯åƒ `if (!ref.current) ref.current = new Thing()` è¿™æ ·çš„ä»£ç ï¼Œå®ƒåªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´è®¾ç½®ä¸€æ¬¡ refã€‚ï¼‰

React state çš„é™åˆ¶ä¸é€‚ç”¨äº refã€‚ä¾‹å¦‚ï¼Œstate å°±åƒ [æ¯æ¬¡æ¸²æŸ“çš„å¿«ç…§](https://react.docschina.org/learn/state-as-a-snapshot)ï¼Œå¹¶ä¸” [ä¸ä¼šåŒæ­¥æ›´æ–°](https://react.docschina.org/learn/queueing-a-series-of-state-updates)ã€‚ä½†æ˜¯å½“ä½ æ”¹å˜ ref çš„ current å€¼æ—¶ï¼Œå®ƒä¼šç«‹å³æ”¹å˜ï¼š

```react
ref.current = 5;

console.log(ref.current); // 5
```

è¿™æ˜¯å› ä¸º **ref æœ¬èº«æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œ** æ‰€ä»¥å®ƒçš„è¡Œä¸ºå°±åƒå¯¹è±¡é‚£æ ·ã€‚

å½“ä½ ä½¿ç”¨ ref æ—¶ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒ [é¿å…å˜æ›´](https://react.docschina.org/learn/updating-objects-in-state)ã€‚åªè¦ä½ æ”¹å˜çš„å¯¹è±¡ä¸ç”¨äºæ¸²æŸ“ï¼ŒReact å°±ä¸ä¼šå…³å¿ƒä½ å¯¹ ref æˆ–å…¶å†…å®¹åšäº†ä»€ä¹ˆã€‚

**React ä¸å…è®¸ç»„ä»¶è®¿é—®å…¶ä»–ç»„ä»¶çš„ DOM èŠ‚ç‚¹ã€‚ç”šè‡³è‡ªå·±çš„å­ç»„ä»¶ä¹Ÿä¸è¡Œï¼**

```react
const inputRef = useRef(null);

function MyInput(props) {
  console.log(1,props)
  return <input {...props} />;
}

<MyInput ref={inputRef} />
```

**`forwardRef` API**

ä½¿ç”¨ forwardRef åå¯ä»¥è§£å†³ä¸Šé¢é—®é¢˜

```react
const MyInput = forwardRef((props, ref) => {
  return <input {...props} ref={ref} />;
});
```



### useState

```react
åˆ›å»ºä¸€ä¸ªå“åº”å¼æ•°æ®

eg1

import React, {useState} from 'react'

const LinkButton = ()=> {
    const [ like, setLike ] = useState(0);
    
    return (
    	<button onClick = {()=> {setLike(like + 1)}}>
        	{like}ğŸ‘
        </button>
    )
}

eg2

import React, { useState} from 'react'

const LinkButton = ()=> {
    const [ obj, setObj ] = useState({like: 0, on: true});

    return (
    	<>
            <button onClick={()=> { setObj({...obj, like: obj.like + 1}) }}>
                {obj.like}ğŸ‘
            </button>
            <button onClick={()=> { setObj({...obj, on: !obj.on}) }}>
                {obj.on? 'On': 'Off'}
            </button>
        </>
    )
}
```

### useEffect

â€‹	Effect æ˜¯ React èŒƒå¼ä¸­çš„ä¸€ç§è„±å›´æœºåˆ¶ã€‚å®ƒä»¬è®©ä½ å¯ä»¥ â€œé€ƒå‡ºâ€ React å¹¶ä½¿ç»„ä»¶å’Œä¸€äº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œ**æ¯”å¦‚é React ç»„ä»¶ã€ç½‘ç»œå’Œæµè§ˆå™¨ DOMã€‚å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œä½ æƒ³æ ¹æ® props æˆ– state çš„å˜åŒ–æ¥æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„ stateï¼‰ï¼Œä½ å°±ä¸åº”è¯¥ä½¿ç”¨ Effect**ã€‚ç§»é™¤ä¸å¿…è¦çš„ Effect å¯ä»¥è®©ä½ çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œè¿è¡Œå¾—æ›´å¿«ï¼Œå¹¶ä¸”æ›´å°‘å‡ºé”™ã€‚

æ¸…é™¤å‰¯ä½œç”¨å‡½æ•°ä¸€èˆ¬ä¼´éšè¿™ç¬¬äºŒæ•°ç»„å‚æ•°ä¾èµ–ï¼Œæ¯æ¬¡ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šè§¦å‘æ¸…é™¤å‰¯ä½œç”¨å‡½æ•°

```react
æ¸²æŸ“åæ‰§è¡ŒæŸæ“ä½œ
import React, {useEffect, useState} from 'react'

// åˆå§‹åŒ–ï¼Œæ›´æ–°æ—¶è°ƒç”¨
const LinkButton = ()=> {
    const [ obj, setObj ] = useState({like: 0, on: true});
    useEffect(()=> {
        document.title = `ç‚¹å‡»äº†${obj.like}æ¬¡`
    })
    return (
    	<>
            <button onClick={()=> { setObj({...obj, like: obj.like + 1}) }}>
                {obj.like}ğŸ‘
            </button>
            <button onClick={()=> { setObj({...obj, on: !obj.on}) }}>
                {obj.on? 'On': 'Off'}
            </button>
        </>
    )
}

// æ¸…é™¤å‰¯ä½œç”¨

const MouseTracker () => {
    const [ positions, setPositions] = useState({x: 0, y: 0});
    useEffect(()=> {
        const updateMouse = (e) => {
            setPositions({x: e.clientX, y: e.clientY})
        }
        document.addEventListener('click', updateMouse)
        // æ¸…é™¤å‰¯ä½œç”¨ï¼ˆæ¯æ¬¡æ›´æ–°éƒ½ä¼šå†æ¬¡ç»‘å®šäº‹ä»¶ï¼‰
        reutrn () => {
            // æ¯æ¬¡æ‰§è¡Œååœ¨æ­¤æ¸…é™¤å‰¯ä½œç”¨
            document.removeEventKistener('click', updateMouse)
        }
    })
}

// éšæœºç‹—ç‹—å›¾ç‰‡
æ¥å£ï¼š https://dog.ceo/api/breeds/image/random
è¿”å›å€¼ï¼š{"message":"https:\/\/images.dog.ceo\/breeds\/sheepdog-english\/n02105641_2138.jpg","status":"success"}

import React,{ useEffect, useState } from 'react'

const DogShow = () => {
    const [url, setUrl] = useState('');
    const [loading, setLoading] = useState(true)
    useEffect(() => {
        fetch('https://dog.ceo/api/breeds/image/random')
        .then((res)=> res.json())
        .then(res=> {
            console.log(res);
            if(res) {
                setUrl(res.message)
            }

        })
        .finally(()=>{
            setLoading(false)
        })
        return () => {
            
        };
       // ä¸‹é¢å¯ä»¥æ·»åŠ ä¾èµ–ï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ‰æ‰§è¡Œã€‚å¦‚æœä¾èµ–ä¸ºç©ºåˆ™åªæ‰§è¡Œä¸€æ¬¡
       // ä¸å†™ä¾èµ–ï¼Œåˆ™ æ‰§è¡ŒsetUrl åˆä¼šè§¦å‘æ›´æ–°ï¼Œæ— é™å¾ªç¯
    }, []);
    return (
        <>
            {
                loading? 'ğŸ•è¯»å–ä¸­': <img src={url} />
            }
        </>
    )
}


```

### useCallback

`useCallback` æ˜¯ä¸€ä¸ªå…è®¸ä½ åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°çš„ React Hookã€‚**`useCallback` ç¼“å­˜å‡½æ•°æœ¬èº«**ã€‚ä¸åƒ `useMemo`ï¼Œå®ƒä¸ä¼šè°ƒç”¨ä½ ä¼ å…¥çš„å‡½æ•°ã€‚ç›¸åï¼Œå®ƒç¼“å­˜æ­¤å‡½æ•°ã€‚ä»è€Œé™¤é `productId` æˆ– `referrer` å‘ç”Ÿæ”¹å˜ï¼Œ`handleSubmit` è‡ªå·±å°†ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚

```react
const cachedFn = useCallback(fn, dependencies)
```

```react
import { useCallback } from 'react';

function ProductPage({ productId, referrer, theme }) {
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]);
  // ...
```

å¦‚æœä½ å·²ç»ç†Ÿæ‚‰äº† [`useMemo`](https://react.docschina.org/reference/react/useMemo)ï¼Œä½ å¯èƒ½å‘ç°å°† `useCallback` è§†ä¸ºä»¥ä¸‹å†…å®¹ä¼šå¾ˆæœ‰å¸®åŠ©ï¼š

```react
// åœ¨ React å†…éƒ¨çš„ç®€åŒ–å®ç°

function useCallback(fn, dependencies) {

  return useMemo(() => fn, dependencies);

}
```



### useMemo

`useMemo` æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“çš„æ—¶å€™èƒ½å¤Ÿç¼“å­˜è®¡ç®—çš„ç»“æœã€‚

**[`useMemo`](https://react.docschina.org/reference/react/useMemo) ç¼“å­˜å‡½æ•°è°ƒç”¨çš„ç»“æœ**ã€‚

```react
const cachedValue = useMemo(calculateValue, dependencies)
```

```react
import { useMemo } from 'react';

function TodoList({ todos, tab, theme }) {
  const visibleTodos = useMemo(() => filterTodos(todos, tab), [todos, tab]);
  // ...
}
```

ä½ éœ€è¦ç»™ `useMemo` ä¼ é€’ä¸¤æ ·ä¸œè¥¿ï¼š

1. ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°çš„ calculation å‡½æ•°ï¼Œåƒè¿™æ · `() =>`ï¼Œå¹¶ä¸”è¿”å›ä»»ä½•ä½ æƒ³è¦çš„è®¡ç®—ç»“æœã€‚
2. ä¸€ä¸ªç”±åŒ…å«åœ¨ä½ çš„ç»„ä»¶ä¸­å¹¶åœ¨ calculation ä¸­ä½¿ç”¨çš„æ‰€æœ‰å€¼ç»„æˆçš„ ä¾èµ–åˆ—è¡¨ã€‚

éšåæ¯æ¬¡æ¸²æŸ“ react éƒ½ä¼š å¯¹æ¯”å‰åä¾èµ–é¡¹æ˜¯å¦ç›¸åŒï¼Ÿæ— å˜åŒ–åˆ™è¿”å›ç¼“å­˜çš„å€¼

***é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact ä¼šé€’å½’åœ°é‡æ–°æ¸²æŸ“å®ƒçš„æ‰€æœ‰å­ç»„ä»¶ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ useMemoå’ŒuseCallback é¿å…ä¸å¿…è¦çš„æ¸²æŸ“**

### è‡ªå®šä¹‰hook

```react
// çŒ«çŒ«å›¾ç‰‡
æ¥å£ï¼š http://api.thecatapi.com/v1/images/search?limit=1&category_ids=



// è·å–é¼ æ ‡çš„ä½ç½®
const useMousePosition () => {
    const [ positions, setPositions] = useState({x: 0, y: 0});
    useEffect(()=> {
        const updateMouse = (e) => {
            setPositions({x: e.clientX, y: e.clientY})
        }
        document.addEventListener('mousemove', updateMouse)
        // æ¸…é™¤å‰¯ä½œç”¨ï¼ˆæ¯æ¬¡æ›´æ–°éƒ½ä¼šå†æ¬¡ç»‘å®šäº‹ä»¶ï¼‰
        reutrn () => {
            // æ¯æ¬¡æ‰§è¡Œååœ¨æ­¤æ¸…é™¤å‰¯ä½œç”¨
            document.removeEventKistener('mousemove', updateMouse)
        }
    })
    return positions
}

// å°è£…ç‹—ç‹—å›¾ç‰‡
const useURLLoader = (url)=> {
    const [url, setUrl] = useState('');
    const [loading, setLoading] = useState(true);
    useEffect(() => {
        fetch(url)
            .then(res=> res.json())
            .then(res=> {
            	setUrl(res.message)
            	setLoading(false)
            })
    }, [url])
    return [url, loading]
}

// ä½¿ç”¨

const DogShowHook = () => {
    const { url, loading } = useURLLoader('https://dog.ceo/api/breeds/image/random')
    let style = {}
    return (
        <>
        	{loading ? <p>è¯»å–ğŸ•ä¸­</p>: <img src={url} alt="dog" style={style} />}	
        </>
    )
}
```

### Hook è§„åˆ™

```js
1ã€åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook
2ã€åªåœ¨ React å‡½æ•° ä¸­ä½¿ç”¨ Hook

æ‹“å±•ï¼š useHooks.com
```



### HOC - Higher order component

```
é«˜é˜¶ç»„ä»¶ï¼š ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶

```

### userReduce

commonContext.jsx

```react
/*
 * @Description: å…¨å±€çŠ¶æ€ç®¡ç†
 * @Author:  
 * @Date: 2023-05-31 10:20:39
 * @LastEditTime: 2023-05-31 11:15:09
 * @LastEditors:  
 */
import { createContext, useContext, useReducer } from 'react'

const UserInfoContext = createContext(null);
const UserInfoDispatchContext = createContext(null);

const initUserInfo = {
    age: "",
    gender: "",
    hobbies: [],
    intro: "",
    name: "",
    occupation: ""

};

// eslint-disable-next-line react/prop-types
export function ContextProvider ({ children }) {
    const [userinfo, dispatch] = useReducer(userInfoReducer, initUserInfo)

    return (
        <UserInfoContext.Provider value={userinfo}>
            <UserInfoDispatchContext.Provider value={dispatch}>
                { children }
            </UserInfoDispatchContext.Provider>
        </UserInfoContext.Provider>
    )
}

export function useUserInfo() {
    return useContext(UserInfoContext);
}

export function useUserInfoDispatch() {
    return useContext(UserInfoDispatchContext);
}

function userInfoReducer(userInfo, action) {
    console.log(userInfo, action);
    const { type, ...payload } = action;
    switch(type) {
        case "add": {
            return {
                ...useUserInfo,
                ...payload
            }
        }
            
        default: {
            throw Error('æœªçŸ¥æ“ä½œï¼š' + action.type);
          }
    }
}
```

main.js

```react
import { ContextProvider } from './utils/commonContext'

ReactDOM.createRoot(document.getElementById('root')).render(
  // <React.StrictMode>
  <ContextProvider>
    <App />
  </ContextProvider>
  // </React.StrictMode>,
)
```

App.jsx

```jsx
import { useUserInfo } from './utils/commonContext'
import Form from './views/form/Form'

function App() {
  const userInfo = useUserInfo();
  console.log("useUserInfo:", userInfo);
  return (
    <>
        <h2>æ ‡é¢˜</h2>
        <p>name: {userInfo.name}</p>
        <p>age: {userInfo.age}</p>
        <p>intro: {userInfo.intro}</p>
        <p>gender: {userInfo.gender}</p>
        <Form />
    </>
  )
}

export default App

```



## åœ¨çº¿ç¬”è®°é¡¹ç›®

### åŸå‹å›¾
![](https://raw.githubusercontent.com/wyf195075595/images/main/blog/%E4%BA%91%E7%AC%94%E8%AE%B0%E5%8E%9F%E5%9E%8B%E5%9B%BE.png)

### åŠŸèƒ½åˆ†æ

![](https://raw.githubusercontent.com/wyf195075595/images/main/blog/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90.png)



### å¼•å…¥å­—ä½“åº“

```react
fortawesome

// å®‰è£…
	npm i @fontawesome/free-solid-svg-icons -S
	
	
// å¼•ç”¨
	import {FontAwesomeIcon} from '@fontawesome/react-fontawesome'
	import {faCoffee} from 'fontawesome/free-solid-svg-icons'
	
//ä½¿ç”¨

<FontAwesomeIcon icon={faCoffee}></FontAwesomeIcon>

```

### å†…ç½®ç±»å‹æ£€æŸ¥

```react
-propTypes
v15.5 ä»¥ä¸Š éœ€è¦å•ç‹¬å®‰è£… prop-types åº“

// å¼•å…¥
import PropTypes from 'prop-types'

const FileSearch = ({title, onFileSearch}) => {
    const [inputActive, setInputActive] =  useState(false);
    const [value, setvalue] = useState('');

    return (
        <div className='file-search-box'>
            <div className='input-box'>
              <Input autoFocus onPressEnter={onFileSearch} />
            </div>
            <Button shape="circle" size="middle"} icon={<CloseOutlined} />
        </div>
    )
}
// ç»„ä»¶ç±»å‹æ£€æŸ¥
FileSearch.propTypes = {
    title: PropTypes.string,
    onFileSearch: PropTypes.func.isRequired
}
// ç»„ä»¶é»˜è®¤å€¼
FileSearch.defaultProps = {
    title: 'æˆ‘çš„äº‘æ–‡æ¡£'
}
```

### classnames

```react
// ä¸€ä¸ªç®€å•çš„JavaScriptå·¥å…·æœ‰æ¡ä»¶åœ°ä¸€èµ·åŠ å…¥ç±»å

npm install classnames

// react ä¸­ä½¿ç”¨
var classNames = require('classnames');

class Button extends React.Component {
  
  render () {
    var btnClass = classNames({
      btn: true,
      'btn-pressed': this.state.isPressed,
      'btn-over': !this.state.isPressed && this.state.isHovered
    });
    return <button className={btnClass}>{this.props.label}</button>;
  }
}
```

### å¼•å…¥WangEditor

```react
// v5ç‰ˆæœ¬jsåŠ¨æ€è®¾ç½®åˆå§‹åŒ–å†…å®¹æœ‰ç‚¹é—®é¢˜

éœ€å®‰è£… @wangeditor/editor å’Œ @wangeditor/editor-for-react

// FileEditer.js
import React,{useState, useEffect} from 'react'
import './FileEditer.scss'
import '@wangeditor/editor/dist/css/style.css'
import { Editor, Toolbar } from '@wangeditor/editor-for-react'

export default function FileEditer() {
    const [editor, setEditor] = useState(null) // å­˜å‚¨ editor å®ä¾‹
    const defaultContent = [] // ç¼–è¾‘å™¨é»˜è®¤å†…å®¹ï¼Œç©ºå†…å®¹
    
    const toolbarConfig = {} // èœå•æ é…ç½®
    
    // ç¼–è¾‘å™¨é…ç½®
    const editorConfig = {
        placeholder: 'è¯·è¾“å…¥å†…å®¹...',
        onCreated: (editor) => {
            // ç¼–è¾‘å™¨åˆ›å»ºä¹‹åï¼Œè®°å½• editor å®ä¾‹ï¼Œé‡è¦ ï¼ï¼ï¼ ï¼ˆæœ‰äº† editor å®ä¾‹ï¼Œå°±å¯ä»¥æ‰§è¡Œ editor APIï¼‰
            setEditor(editor)
        },
        onChange: (editor) => {
            // editor é€‰åŒºæˆ–è€…å†…å®¹å˜åŒ–æ—¶ï¼Œè·å–å½“å‰æœ€æ–°çš„çš„ content
            console.log('changed', editor.children)
        }
    }
    
    // ç»„ä»¶é”€æ¯æ—¶ï¼ŒåŠæ—¶é”€æ¯ editor å®ä¾‹ï¼Œé‡è¦ï¼ï¼ï¼
    useEffect(() => {
        return () => {
            if (editor == null) return
            editor.destroy()
            setEditor(null)
        }
    }, [editor])
    
    return (
        <div className='edit-wrap'>
            {/* æ¸²æŸ“ toolbar */}    
            <Toolbar
                editor={editor}
                defaultConfig={toolbarConfig}
                style={{ borderBottom: '1px solid #ccc',boxSize: 'border-box' }}
            />

            {/* æ¸²æŸ“ editor */}
            <Editor
                defaultConfig={editorConfig}
                defaultContent={defaultContent}
                style={{ height: 'calc(100% - 41px)' }}
            />
        </div>
    )
}
```

### å¼•å…¥wangeditor  v4ç‰ˆæœ¬

```js
// Easy-mde ç¼–è¾‘å™¨

// å®‰è£…
npm i wangeditor --save


```



### Stateè®¾è®¡åŸåˆ™

```js
1ã€æœ€å°åŒ– State åŸåˆ™
2ã€DRY - Dont Reapeat Yourself
3ã€æœ‰äº›æ•°æ®å¯ä»¥æ ¹æ®å·²æœ‰ State è®¡ç®—
4ã€ä½¿ç”¨å¤šä¸ª State å˜é‡
```

### App  state åˆ†æ

```react
1ã€æ–‡ä»¶åˆ—è¡¨			
2ã€æœç´¢åçš„æ–‡ä»¶åˆ—è¡¨
3ã€æœªä¿å­˜çš„æ–‡ä»¶åˆ—è¡¨
4ã€å·²ç»æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨
5ã€å½“å‰è¢«é€‰ä¸­çš„æ–‡ä»¶

-æ‰€éœ€æ•°ç»„
files: [{id: '1'},]
searchedFiles: [{id: '1'},..]
unsavedFiles:  [{id: '2'},...]
openedFiles:   [{id: '2'},...]
activeFile:    {id: '1',...}

-ä¼˜åŒ–
  files: [{id: '1'},..]
  unsavedFileIDs: ['1','2']
  openedFileIDs: ['2']
  activeFileID: '1'
```
![](https://raw.githubusercontent.com/wyf195075595/images/main/blog/state%E6%95%B0%E6%8D%AE%E6%B5%81.png)

![](https://raw.githubusercontent.com/wyf195075595/images/main/blog/callbackflow.png)

