---
title: å›¾ç‰‡æ‡’åŠ è½½
date: 2022-06-28 15:04:10
categories: htmlcss
---

> å›¾ç‰‡æ‡’åŠ è½½ï¼š åœ¨é¡µé¢é•¿åˆ—è¡¨å±•ç¤ºæ—¶ï¼ˆå°±è¯´é¡µé¢å¾ˆé•¿å‡ºç°æ»šåŠ¨æ¡é‚£ç§ğŸ¤¡ï¼‰ï¼Œåœ¨é¡µé¢ä¸å¯è§åŒºåŸŸçš„å›¾ç‰‡èµ„æºé»˜è®¤ä¸åŠ è½½ã€‚å½“å›¾ç‰‡å…ƒç´ æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸæ—¶å†åŠ è½½å›¾ç‰‡èµ„æºçš„è¿™ä¹ˆä¸ªæ•ˆæœ

### å®ç°æ–¹å¼ï¼š

1. ä½ç½®è®¡ç®— + æ»šåŠ¨äº‹ä»¶ (Scroll) + DataSet API

	

	é€šè¿‡å¯¹å…ƒç´ çš„ä½ç½®å±æ€§ clientTop`ï¼Œ`offsetTop`ï¼Œ`clientHeight` ä»¥åŠ `scrollTopç­‰ å†åŠ ä¸Šç›‘å¬æ»šåŠ¨æ¡çš„äº‹ä»¶æ¥åˆ¤æ–­å›¾ç‰‡èµ„æºæ˜¯å¦å‡ºç°åœ¨å¯è§†åŒºåŸŸ

	

2. getBoundingClientRect API + Scroll with Throttle + DataSet API

	<!--more-->

	**`Element.getBoundingClientRect()` æ–¹æ³•è¿”å›å…ƒç´ çš„å¤§å°åŠå…¶ç›¸å¯¹äºè§†å£çš„ä½ç½®ã€‚**æ­¤æ–¹å¼å…¶å®ä¸ç¬¬ä¸€ç§ç±»ä¼¼ï¼Œåªæ˜¯å€ŸåŠ©äº† **getBoundingClientRect** æ–¹æ³• è·å–å…ƒç´ ä½ç½®çš„å€¼ï¼Œç®€åŒ–äº†æ“ä½œ

	ä¸‹é¢çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š

	```html
	// html éƒ¨åˆ†
	
	<!DOCTYPE html>
	<html lang="en">
	  <head>
	    <meta charset="UTF-8" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	    <title>Document</title>
	    <style>
	      * {
	        margin: 0px;
	        padding: 0px;
	      }
	
	      body {
	        margin: 0px;
	        padding: 0px;
	      }
	      .demo {
	        box-sizing: border-box;
	        width: 100%;
	        height: 100%;
	      }
	      .imgbox {
	        width: 100%;
	        height: fit-content;
	        border: 1px solid skyblue;
	        box-sizing: border-box;
	      }
	      img {
	        display: block;
	        width: 100%;
	        height: fit-content;
	        min-height: 250px;
	      }
	    </style>
	  </head>
	
	  <body>
	    <div class="demo">
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2021/08/24/15/38/sand-6570980_960_720.jpg" alt="1" />
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/02/21/19/06/drink-84533_960_720.jpg" alt="2"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/07/18/20/26/sea-164989_960_720.jpg" alt="3"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885_960_720.jpg" alt="4"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2017/03/26/21/54/yoga-2176668_960_720.jpg" alt="5"/>
	      </div>
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2021/08/24/15/38/sand-6570980_960_720.jpg" alt="1" />
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/02/21/19/06/drink-84533_960_720.jpg" alt="2"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/07/18/20/26/sea-164989_960_720.jpg" alt="3"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885_960_720.jpg" alt="4"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2017/03/26/21/54/yoga-2176668_960_720.jpg" alt="5"/>
	      </div>
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2021/08/24/15/38/sand-6570980_960_720.jpg" alt="1" />
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/02/21/19/06/drink-84533_960_720.jpg" alt="2"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2013/07/18/20/26/sea-164989_960_720.jpg" alt="3"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2015/04/23/22/00/tree-736885_960_720.jpg" alt="4"/>
	      </div>
	
	      <div class="imgbox">
	        <img data-src="https://cdn.pixabay.com/photo/2017/03/26/21/54/yoga-2176668_960_720.jpg" alt="5"/>
	      </div>
	    </div>
	  </body>
	
	</html>
	```

	```js
	// js éƒ¨åˆ†
	
	  <script>
	    const demo = document.querySelectorAll("img");
	    function lazy() {
	      // éå†æ‰€æœ‰å›¾ç‰‡èµ„æº
	      for (let elem of demo) {
	        // åˆ¤æ–­æ˜¯å¦å‡ºç°åœ¨å¯è§†åŒºåŸŸ
	        // å›¾ç‰‡è·ç¦»å¯è§†åŒºåŸŸé¡¶éƒ¨è·ç¦» < å¯è§†åŒºåŸŸé«˜åº¦ï¼ˆæ–‡æ¡£èŠ‚ç‚¹å¯è§†é«˜åº¦ï¼‰
	        if ( elem.getBoundingClientRect().top < document.documentElement.clientHeight ) {
	          // æ²¡æœ‰ src å±æ€§çš„å›¾ç‰‡ æ­¤æ—¶åŠ è½½
	          if (elem.dataset.src && elem.src == "") {
	            elem.src = elem.dataset.src;
	          }
	        }
	      }
	    }
		// ä¸€ä¸ªèŠ‚æµå‡½æ•°
	    function throttle(t, fn) {
	      let time;
	      return function () {
	        if (!time) {
	          time = setTimeout(() => {
	            time = null;
	            fn();
	          }, t);
	        }
	      };
	    }
	    lazy();
	    window.addEventListener("scroll", throttle(500, lazy));
	  </script>
	```

	

3. IntersectionObserver API + DataSet API

	

	**`IntersectionObserver` APIï¼Œä¸€ä¸ªèƒ½å¤Ÿç›‘å¬å…ƒç´ æ˜¯å¦åˆ°äº†å½“å‰è§†å£çš„äº‹ä»¶ï¼Œä¸€æ­¥åˆ°ä½ï¼** æ­¤API å¤§å¤§ç®€åŒ–äº†ä¸Šè¿°ä¸€ç³»åˆ—æ“ä½œ ç›‘å¬æ»šåŠ¨å˜åŒ–ä¸åˆ¤æ–­æ˜¯å¦å‡ºç°åœ¨å¯è§†åŒºåŸŸä¸€æŠŠæ¢­ğŸ˜Š

	ç¤ºä¾‹ï¼š

	```js
	<script>
	    const observer = new IntersectionObserver((changes) => {
	        // changes: ç›®æ ‡å…ƒç´ é›†åˆ
	        changes.forEach((change) => {
	            console.log(change.isIntersecting);
	            // intersectionRatio
	            if (change.isIntersecting) {
	                const img = change.target;
	                img.src = img.dataset.src;
	                // å›¾ç‰‡åŠ è½½åæ³¨é”€ç›‘å¬
	                observer.unobserve(img);
	            }
	        });
	    }, {
	        threshold: 0.8 // å…ƒç´ ç™¾åˆ†ä¹‹å¤šå°‘æš´éœ²åœ¨å¯è§†åŒºåŸŸæ—¶æ‰è§¦å‘
	    });
	
		// 
	    document.querySelectorAll('img').forEach(img=> {
	        observer.observe(img);
	    })
	</script>
	```

	

4. LazyLoading å±æ€§

	ç»™éœ€è¦æ‡’åŠ è½½çš„å›¾ç‰‡æ·»åŠ  loading="lazy" ï¼Œæµè§ˆå™¨è‡ªå·±åšæ‡’åŠ è½½è¿™ä»¶äº‹ã€‚ä¸è¿‡ç›®å‰æµè§ˆå™¨å…¼å®¹æ€§ä¸å¤ªå¥½

	```html
	<img src="shanyue.jpg" loading="lazy" />
	```

	

> ç»“è¯­ï¼šæ€»çš„æ¥çœ‹æ–¹æ¡ˆä¸‰æœ€å¥½ä½¿äº†ï¼Œä¸è¿‡æ–¹æ¡ˆäºŒå…¼å®¹æ€§æ¯”æ–¹æ¡ˆä¸‰å¥½