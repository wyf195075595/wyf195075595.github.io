---
title: 音视频基础
date: 2023-10-31 09:23:10
tags: 音视频
categories: 音视频
---

> 需要了解下Linux和c语言基础，主要用到的工具 ffmpeg

### 安装  ffmpeg

mac 环境下推荐 brew 方式， 其他环境推荐使用源码方式下载安装

1. [下载 ffmpeg](http://ffmpeg.org/download.html)

	可以选择 git 下载，慢的话用 http方式下载快照版本

2. 编译 ffmpeg

	如果出现操作权限不够，可以同过在命令前面加 sudo 提高权限

	```shell
	// 指定安装目录 /usr/local/ffmpeg，设置debug模式3
	./configure -prefix=/usr/local/ffmpeg -enable-debug=3
	// 指定 4核模式
	make -j 4
	// 安装
	make install
	```

	<!--more-->

### 直播客户端处理流程

共享端

1. 音视频采集
2. 音视频编码

观管端

1. 音视频解码
2. 音视频渲染

### 音频数据流

> 采集的音视频数据为 PCM 数据

1. PCM  原始数据
2. acc/mp3  编码
3. mp4/flv  封装生成多媒体文件



### 声音的三要素

1. 音调  由震动的频率快慢决定
2. 音量  由振幅的高低决定
3. 音色  影响的决定因素是谐波

### 音频的原始数据格式

1. PCM
2. WAV  此格式是在PCM数据套上指定格式头部信息

### 量化基本概念

1. 采样大小：一个采样放置多少bit数据。通常16bit
2. 采样率：采样频率8k,16k,44.1k,48k（1s钟采样次数）
3. 声道数：单声道，双声道，多声道



### 码率计算

要算一个PCM音频流的码率是一件很轻松的事情，采样率x采样大小x声道数。

例如:**采样率**为44.1KHz，**采样大小**为16bit，**双声道**的 PCM 编码的**WAV文件**，它的码率为44.1Kx16x2=1411.2Kb/s.



### 音频采集

> 通过 ffmpeg 封装的api对Android，ios,pc 等端 采集，不需要了解各端的具体api

```shell
// 通过avfoundation库对 mac 端音频采集，不同端采集命令会有所不同
ffmpeg -f avfoundation -i :0 out.wav

ffplay out.wav
```

### 音频压缩

1. 有损压缩：压缩后去除冗余信息（人类听觉范围之外的频段），并且无法恢复成未压缩前的状态

2. 无损压缩：编码压缩后，可以通过解码还原会压缩前的状态

	熵编码

	- 哈夫曼编码
	- 算数编码
	- 香浓编码

### 常见的音频编码器

OPUS>AAC>Ogg>other

- OPUS 较新,比较强
- AAC  直播应用，成熟应用范围广（取代mp3）
- Ogg
- Speex
- iLBC
- AMR
- G.711 固话应用

### AAC规格描术

- AAC LC :(Low Complexity) 低复杂度规格,码流是**128k**，音质好。
- AAC HE:等于 AAC LC + SBR (Spectral Band Replication)。其核心思相是按频谱分保存。低频编码保存主要成分，高频单独放大编码保存音质。码流在**64k左右**
- AAC HE V2:等于 AAC LC + SBR + PS(Parametric Stereo)。其核心思相是双声道中的声音存在某种相似性，只需存储一个声道的全部信息，然后，花很少的字节用参数描述另一个声道和它不同的地方。

### AAC格式

- ADIF ( Audio Data Interchange Format )
	这种格式的特征是可以确定的找到这个音频数据的开始，**只能从头开始解码**，不能在音频数据流中间开始。这种格式常用在磁盘文件中
- ADTS( Audio Data Transport Stream 
	这种格式的特征是每一帧都有一个同步字，所以**可以在音频流的任何位置开始解码**。它类似于数据流格式。

### ffmpeg 生成 AAC 文件



```shell
//-vn 没有视频 指定音频编码器 libfdk_aac,-profile 设置编码器参数,  采样率 44100
ffmpeg -i xxx.mp4
	-vn -c:a libfdk_aac
	-ar 44100 -channels 2 -profile:a aac_he_v2 3.aac
```

