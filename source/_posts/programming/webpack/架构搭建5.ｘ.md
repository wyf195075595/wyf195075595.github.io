---
title: webpack é…ç½®
date: 2022-06-17 18:23:10
tags: webpack
categories: webpack
---
> æ¶‰åŠçŸ¥è¯†

- æ„å»ºå·¥å…·ï¼šWebpack5.x
- å‰ç«¯æ¡†æ¶ï¼šVue 3.x
- è·¯ç”±å·¥å…·ï¼šVue Router 4.x
- CSS é¢„ç¼–è¯‘ï¼šLess
- Git Hook å·¥å…·ï¼šhusky
- ä»£ç è§„èŒƒï¼šPrettier + Eslint + Airbnb
- è‡ªåŠ¨éƒ¨ç½²ï¼šGithub Actions

<!--more-->

## ä¸€ã€webpackåŸºç¡€é…ç½®

#### 1ã€æ¯ä¸€ä¸ªä¼Ÿå¤§çš„é¡¹ç›®ä»npm init å¼€å§‹

```js
// åˆå§‹åŒ–é¡¹ç›®
npm init

// ç›´æ¥è·³è¿‡é€‰é¡¹
npm init -y 
```

### 2ã€webpack ä¸‰ä»¶å¥—

```js
// æœ¬ä½“ï¼Œ è„šæ‰‹æ¶ï¼Œ çƒ­åŠ è½½
npm i webpack webpack-cli webpack-dev-server -D


-D ç­‰ä»·äº --save-dev; å¼€å‘ç¯å¢ƒæ—¶æ‰€éœ€ä¾èµ–
-S ç­‰ä»·äº --save; ç”Ÿäº§ç¯å¢ƒæ—¶æ‰€éœ€ä¾èµ–
```

### 3ã€åŒºåˆ†å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒ

```js
// æ–°å¢ç›®å½•ç»“æ„
â”œâ”€build
â”‚  â”œâ”€webpack.common.config.js   //å…¬å…±é…ç½®ï¼Œ
â”‚  â”œâ”€webpack.dev.config.js     //modeä¸ºdevelopmentçš„	é…ç½®
â”‚  â”œâ”€webpack.prod.config.js    //modeä¸ºproductioné…ç½®
â”‚  â”œâ”€webpack.loader.config.js  //é…ç½®loader

// å…¬å…±é…ç½®

const { resolve } = require('path')
const webpack = require('webpack')
// å¼•å…¥vueLoader æ–‡ä»¶
const { VueLoaderPlugin } = require('vue-loader/dist/index')

require('dotenv').config({ path: `.env.${process.env.envMode}` })
let env = {}
// åªæœ‰ NODE_ENVï¼ŒBASE_URL å’Œä»¥ VUE_APP_ å¼€å¤´çš„å˜é‡å°†é€šè¿‡ webpack.DefinePlugin é™æ€åœ°åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„ä»£ç ä¸­
for (const key in process.env) {
  if (key === 'NODE_ENV' || key === 'BASE_URL' || /^VUE_APP_/.test(key)) {
    env[key] = JSON.stringify(process.env[key])
  }
}

module.exports = (mode) => {
  return {
    //   å…¥å£
    entry: {
        // é»˜è®¤ä½¿ç”¨å½“å‰è·¯å¾„
        context: path.resolve(__dirname, "src"),
        home: './main.js'
    },
    // è¾“å‡º
    output: {},
    // æ¨¡å¼
    // module: '',
    // åŠ è½½å™¨
    // loader: {},
    // æ’ä»¶
    plugins: [
        new VueLoaderPlugin(),
        new webpack.DefinePlugin({
            // å®šä¹‰ç¯å¢ƒå’Œå˜é‡
            'process.env': {
            ...env
            }
        })
    ],
    // å¼€å‘ä¸­
    devServe: {},
    // å¼€å‘å·¥å…·
    devtool: {}
    ...
  }
}
```

### 4ã€å®‰è£…`dotenv`ã€`cross-env` é…ç½®ç¯å¢ƒå˜é‡

cross-env : windowsä¸æ”¯æŒNODE_ENV=developmentçš„è¿™æ ·çš„è®¾ç½®æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥åº“å®ç°å…¼å®¹
dotenv : æ”¯æŒ.env, å¯å°†ç¯å¢ƒå˜é‡ä».envæ–‡ä»¶åŠ è½½åˆ°process.envä¸­

```js
cross-env å°±æ˜¯è¿è¡Œè·¨å¹³å°è®¾ç½®å’Œä½¿ç”¨ç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚
	-æ·»åŠ åå³å¯åœ¨ package.json çš„ script ä¸­ä½¿ç”¨ NODE_ENV=development è¯­å¥
dotenv å¯å°†ç¯å¢ƒå˜é‡ä».envæ–‡ä»¶åŠ è½½åˆ°process.envä¸­
	- require('dotenv').config();å³å¯å¯ç”¨
    
cnpm i dotenv cross-env -D

// æ ¹ç›®å½•æ–°å¢

â”œâ”€.env.dev //é…ç½®å¼€å‘ç¯å¢ƒçš„å˜é‡
â”œâ”€.env.prod //é…ç½®ç”Ÿäº§ç¯å¢ƒçš„å˜é‡


// env.dev.js æ–°å¢

NODE_ENV = 'development'
VUE_SHOWCONSOLE = true  //æ˜¯å¦æ˜¾ç¤ºconsole
VUE_DEV_URL ='www.xxx.com' //å¼€å‘ç¯å¢ƒæ¥å£åœ°å€

```





### 5ã€è¿è¡Œ

```js
// åœ¨æ ¹ç›®å½•ä¸‹æ–°å¢ srcæ–‡ä»¶å¤¹,index.jsæ–‡ä»¶

æ­¤æ—¶çš„ç›®å½•

â”œâ”€build
â”‚  â”œâ”€webpack.common.config.js   //å…¬å…±é…ç½®ï¼Œ
â”‚  â”œâ”€webpack.dev.config.js     //modeä¸ºdevelopmentçš„	é…ç½®
â”‚  â”œâ”€webpack.prod.config.js    //modeä¸ºproductioné…ç½®
â”‚  â”œâ”€webpack.loader.config.js  //é…ç½®loader
â”œâ”€src
â”‚  â”œâ”€index.js   //é»˜è®¤å…¥å£æ–‡ä»¶ï¼Œ å¯ä»¥é€šè¿‡ é…ç½®æ–‡ä»¶ entry è®¾ç½®


// è¿è¡Œç¼–è¯‘
npm run dev

```

### 6ã€å®‰è£… vue3 å’Œ vue-loader

```js
// å®‰è£…vue
npm i vue@next -D

// å®‰è£… vue-loader è§£ævueè¯­æ³• 
// å®‰è£… vue/compiler-sfc ä¸»è¦æ˜¯ç”¨æ¥è§£æSFCç»„ä»¶,æˆ‘ä»¬éƒ½çŸ¥é“,ä¸€ä¸ªSFC(*.vue)æ–‡ä»¶ä¸‰å¤§è¦ç´ æ˜¯templateã€scriptã€style

npm i vue-loader@next @vue/compiler-sfc -D

// webpack.loader.config.js æ–°å¢
{
    test: /.vue$/,
    use: [
        'vue-loader'
    ]
}
```

### 7ã€Es6ä¼˜é›…é™çº§

```js
// babel ä¸‰ä»¶å¥—
npm i @babel/core @babel/preset-env babel-loader -D

// webpack.loader.config.js æ–°å¢
{
    test: /.js$/,
    exclude: /node_modules/,
    use: {
        loader: 'babel-loader',
    }
}, 
    
// babel é…ç½®æ–‡ä»¶

// babel.config.js

module.exports = {
  presets: [
    [
      '@babel/preset-env',
      {
        targets: {
          browsers: ['last 2 versions'] // æœ€è¿‘ 2 ä¸ªç‰ˆæœ¬çš„æµè§ˆå™¨
        }
      }
    ]
  ]
}
```

### 8ã€å®‰è£…html-webpack-plugin

å®‰è£… html-webpack-plugin æ’ä»¶å¤„ç† index.html æ–‡ä»¶ï¼Œæ­¤æ’ä»¶çš„åŠŸèƒ½æ˜¯æ ¹æ®æä¾›çš„æ¨¡æ¿æ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆæ­£ç¡®çš„é¡¹ç›®å…¥å£æ–‡ä»¶ï¼Œå¹¶æŠŠ webpack æ‰“åŒ…çš„ js æ–‡ä»¶è‡ªåŠ¨æ’å…¥å…¶ä¸­

```js


npm i html-webpack-plugin -D


// webpack.common.config.js
new HtmlWebpackPlugin({
 template: resolve(__dirname, '../index.html'),
 filename: 'index.html',
 title: 'nigo-cli',
 minify: {
  html5: true, // æ ¹æ®HTML5è§„èŒƒè§£æè¾“å…¥
  collapseWhitespace: true, // æŠ˜å ç©ºç™½åŒºåŸŸ
  preserveLineBreaks: false,
  minifyCSS: true, // å‹ç¼©æ–‡å†…css
  minifyJS: true, // å‹ç¼©æ–‡å†…js
  removeComments: false // ç§»é™¤æ³¨é‡Š
 },
})
```

### 9ã€æ·»åŠ vue-router

```js
npm i vueRouter@last -D

// ä¸‹é¢è¯­æ³•ä¸º vue-router4
import { createRouter, createWebHashHistory } from 'vue-router'

// æ–°å¢è·¯åŠ²

â”œâ”€src
   â”œâ”€router
   â”‚   â”œâ”€index.js   //å®šä¹‰è·¯ç”±è§„åˆ™

// ä¿®æ”¹ src/router/index.js
import { createRouter, createWebHashHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    name: 'home',
    component: () => import('@/views/home.vue')
  }
]


const router = createRouter({
  history: createWebHashHistory(),
  routes 
})

export default router

// ä¿®æ”¹ src/main.js
import { createApp } from 'vue'
import App from '@/App.vue' // å¼•å…¥ APP é¡µé¢ç»„å»º
import router from '@/router'

createApp(App).use(router).mount('#app')


```

### 10ã€æ·»åŠ  less é¢„å¤„ç†å™¨

```js
// å››ä»¶å¥—
npm i style-loader css-loader less-loader less -D

 style-loader
    - ä½œç”¨
    -style-loaderèƒ½å¤Ÿåœ¨éœ€è¦è½½å…¥çš„htmlä¸­åˆ›å»ºä¸€ä¸ª<style></style>æ ‡ç­¾ï¼Œæ ‡ç­¾é‡Œçš„å†…å®¹å°±æ˜¯CSSå†…å®¹ã€‚

 css-loader
    - ä½œç”¨
    css-loaderæ˜¯å…è®¸åœ¨jsä¸­importä¸€ä¸ªcssæ–‡ä»¶ï¼Œä¼šå°†cssæ–‡ä»¶å½“æˆä¸€ä¸ªæ¨¡å—å¼•å…¥åˆ°jsæ–‡ä»¶ä¸­ã€‚

// webpack.loader.config.js

rules: [
    {
      test: /.less$/,
      use: ['style-loader', 'css-loader', 'less-loader']
    },
]
```

### 11ã€æ·»åŠ è·¯å¾„åˆ«å

assetså’Œstaticæ–‡ä»¶å¤¹çš„åŒºåˆ«
ç›¸ä¿¡æœ‰å¾ˆå¤šäººçŸ¥é“vue-cliæœ‰ä¸¤ä¸ªæ”¾ç½®é™æ€èµ„æºçš„åœ°æ–¹ï¼Œåˆ†åˆ«æ˜¯src/assetsæ–‡ä»¶å¤¹å’Œstaticæ–‡ä»¶å¤¹,è¿™ä¸¤è€…çš„åŒºåˆ«å¾ˆå¤šäººå¯èƒ½ä¸å¤ªæ¸…æ¥šã€‚

assetsç›®å½•ä¸­çš„æ–‡ä»¶ä¼šè¢«webpackå¤„ç†è§£æä¸ºæ¨¡å—ä¾èµ–ï¼Œåªæ”¯æŒç›¸å¯¹è·¯å¾„å½¢å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ <img src="./logo.png"> 
å’Œ background: url(./logo.png)ä¸­ï¼Œâ€./logo.pngâ€ æ˜¯ç›¸å¯¹çš„èµ„æºè·¯å¾„ï¼Œå°†ç”±Webpackè§£æä¸ºæ¨¡å—ä¾èµ–ã€‚

static/ ç›®å½•ä¸‹çš„æ–‡ä»¶å¹¶ä¸ä¼šè¢«Webpackå¤„ç†ï¼šå®ƒä»¬ä¼šç›´æ¥è¢«å¤åˆ¶åˆ°æœ€ç»ˆçš„æ‰“åŒ…ç›®å½•ï¼ˆé»˜è®¤æ˜¯dist/staticï¼‰ä¸‹ã€‚å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•ç”¨è¿™äº›æ–‡ä»¶ï¼Œè¿™æ˜¯é€šè¿‡åœ¨ config.js æ–‡ä»¶ä¸­çš„ build.assetsPublicPath å’Œ build.assetsSubDirectory è¿æ¥æ¥ç¡®å®šçš„ã€‚

ä»»ä½•æ”¾åœ¨ static/ ä¸­æ–‡ä»¶éœ€è¦ä»¥ç»å¯¹è·¯å¾„çš„å½¢å¼å¼•ç”¨ï¼š/static/[filename]ã€‚

åœ¨æˆ‘ä»¬å®é™…çš„å¼€å‘ä¸­ï¼Œæ€»çš„æ¥è¯´ï¼šstaticæ”¾ä¸ä¼šå˜åŠ¨çš„æ–‡ä»¶ assetsæ”¾å¯èƒ½ä¼šå˜åŠ¨çš„æ–‡ä»¶ã€‚

```js
// webpack.common.config.js

resolve: {
    //...
    alias: {
        '@': resolve('src'),
        'static': resolve('static'),
     }
}


```

> [æ³¨æ„]ï¼š
> è¿™é‡Œç»™â€™staticâ€™èµ‹äºˆäº†ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºä¸­å¼•å…¥è·¯å¾„çš„æ—¶å€™ â€™~staticâ€™ å°±ç›´æ¥å¯ä»¥ä»£æ›¿è·¯å¾„â€™../staticâ€™

### 12ã€å¤„ç†å›¾ç‰‡ç­‰é™æ€èµ„æº

Webpack5 ä¹‹å‰æˆ‘ä»¬å¤„ç†é™æ€èµ„æºæ¯”å¦‚PNG å›¾ç‰‡ã€SVG å›¾æ ‡ç­‰ç­‰ï¼Œéœ€è¦ç”¨åˆ°url-loaderï¼Œfile-loaderï¼Œraw-loaderã€‚Webpack5 æä¾›äº†å†…ç½®çš„é™æ€èµ„æºæ„å»ºèƒ½åŠ›ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£…é¢å¤–çš„ loaderï¼Œä»…éœ€è¦ç®€å•çš„é…ç½®å°±èƒ½å®ç°é™æ€èµ„æºçš„æ‰“åŒ…å’Œåˆ†ç›®å½•å­˜æ”¾ã€‚è¿™ä¸‰ä¸ªloaderåœ¨githubä¸Šä¹Ÿåœæ­¢äº†æ›´æ–°ã€‚

webpack5ä½¿ç”¨å››ç§æ–°å¢çš„èµ„æºæ¨¡å—ï¼ˆAsset Modules[3]ï¼‰æ›¿ä»£äº†è¿™äº›loaderçš„åŠŸèƒ½ã€‚

asset/resource å°†èµ„æºåˆ†å‰²ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼Œå¹¶å¯¼å‡ºurlï¼Œå°±æ˜¯ä¹‹å‰çš„ file-loaderçš„åŠŸèƒ½. 
asset/inline å°†èµ„æºå¯¼å‡ºä¸ºdataURLï¼ˆurl(data:)ï¼‰çš„å½¢å¼ï¼Œä¹‹å‰çš„ url-loaderçš„åŠŸèƒ½. 
asset/source å°†èµ„æºå¯¼å‡ºä¸ºæºç ï¼ˆsource codeï¼‰. ä¹‹å‰çš„ raw-loader åŠŸèƒ½. 
asset è‡ªåŠ¨é€‰æ‹©å¯¼å‡ºä¸ºå•ç‹¬æ–‡ä»¶æˆ–è€… dataURLå½¢å¼ï¼ˆé»˜è®¤ä¸º8KBï¼‰. ä¹‹å‰æœ‰url-loaderè®¾ç½®asset size limit é™åˆ¶å®ç°ã€‚

```js


// é…ç½® webpack.loader.config.js

{
    test: /.(png|jpg|svg|gif)$/,
    type: 'asset/resource',
    generator: {
        // [ext]å‰é¢è‡ªå¸¦"."
        filename: 'assets/[hash:8].[name][ext]',
    },
}
   
```

### 13ã€æ¸…é™¤distç›®å½•

webpack5.20ä»¥ä¸‹ç‰ˆæœ¬æ¸…é™¤distæ–‡ä»¶å†…å®¹ä¸€èˆ¬ä½¿ç”¨æ’ä»¶ clean-webpack-pluginï¼Œ 5.20ç‰ˆæœ¬ä»¥åoutputæ–°å¢ç‰¹æ€§cleanï¼Œç”¨äºæ¸…é™¤distç›®å½•

```js


// é…ç½®webpack.prod.config.js

module.exports = {
  //...
  output: {
    clean: true, // Clean the output directory before emit.
  },
};
```

### 14ã€FileSystem Cache åŠ é€ŸäºŒæ¬¡æ„å»º

Webpack5 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ cache-loader[4] ç¼“å­˜ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„ loader ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ hard-source-webpack-plugin[5] ä¸ºæ¨¡å—æä¾›ä¸€äº›ä¸­é—´ç¼“å­˜ã€‚åœ¨ Webpack5 ä¹‹åï¼Œé»˜è®¤å°±ä¸ºæˆ‘ä»¬é›†æˆäº†ä¸€ç§è‡ªå¸¦çš„ç¼“å­˜èƒ½åŠ›ï¼ˆå¯¹ module å’Œ chunks è¿›è¡Œç¼“å­˜[6]ï¼‰ã€‚é€šè¿‡å¦‚ä¸‹é…ç½®ï¼Œå³å¯åœ¨äºŒæ¬¡æ„å»ºæ—¶æé€Ÿã€‚

```js

// é…ç½®webpack.prod.config.js

module.exports = {
    //...
    cache: {
        type: 'filesystem',
        // å¯é€‰é…ç½®
        buildDependencies: {
            config: [__filename],  // å½“æ„å»ºä¾èµ–çš„configæ–‡ä»¶ï¼ˆé€šè¿‡ require ä¾èµ–ï¼‰å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç¼“å­˜å¤±æ•ˆ
        },
        name: '',  // é…ç½®ä»¥nameä¸ºéš”ç¦»ï¼Œåˆ›å»ºä¸åŒçš„ç¼“å­˜æ–‡ä»¶ï¼Œå¦‚ç”ŸæˆPCæˆ–mobileä¸åŒçš„é…ç½®ç¼“å­˜
        //...
    },
}
```



> ä»¥ä¸Šä»‹ç»åªæ˜¯webpack5çš„æ–°ç‰¹æ€§å’Œæ¯”è¾ƒåŸºç¡€çš„é…ç½®ï¼Œåç»­è¿˜æ˜¯è¦å› åº”éœ€æ±‚å»é…ç½®ã€‚åŒ…æ‹¬cssåˆ†ç¦»ã€csså‹ç¼©ã€jså‹ç¼©ç­‰ï¼Œåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€å±•å¼€è®¨è®ºã€‚

## äºŒã€ä»£ç è§„èŒƒ

> å¦‚æœéœ€è¦å›¢é˜Ÿåˆä½œå®Œæˆæˆ‘ä»¬å°±è¦è€ƒè™‘ä»£ç è§„èŒƒçš„é—®é¢˜ï¼Œç”±äº JavaScript çš„çµæ´»æ€§ï¼Œå¾€å¾€ä¸€æ®µä»£ç èƒ½æœ‰å¤šç§å†™æ³•ï¼Œè¿™æ—¶å€™ä¹Ÿä¼šå¯¼è‡´ååŒæ—¶å·®å¼‚ã€‚å¹¶ä¸”ï¼Œæœ‰ä¸€äº›å†™æ³•å¯èƒ½ä¼šå¯¼è‡´ä¸æ˜“å‘ç°çš„ bugï¼Œæˆ–è€…è¿™äº›å†™æ³•çš„æ€§èƒ½ä¸å¥½ï¼Œå¼€å‘æ—¶ä¹Ÿåº”è¯¥é¿å…ã€‚
>
> ä¸ºäº†è§£å†³è¿™ç±»é™æ€ä»£ç é—®é¢˜ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„ JavaScript ä»£ç è§„èŒƒï¼Œå›¢é˜Ÿæˆå‘˜éƒ½éµå®ˆè¿™ä»½ä»£ç è§„èŒƒæ¥ç¼–å†™ä»£ç ã€‚å½“ç„¶ï¼Œé äººæ¥ä¿éšœä»£ç è§„èŒƒæ˜¯ä¸å¯é çš„ï¼Œéœ€è¦æœ‰å¯¹åº”çš„å·¥å…·æ¥ä¿éšœã€‚

```js
1ã€å®‰è£… Prettier

Prettier æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œæ”¯æŒ JavaScriptã€TypeScriptã€CSSã€SCSSã€Lessã€JSXã€Angularã€Vueã€GraphQLã€JSONã€Markdown ç­‰è¯­è¨€ï¼ŒåŸºæœ¬ä¸Šå‰ç«¯èƒ½ç”¨åˆ°çš„æ–‡ä»¶æ ¼å¼å®ƒéƒ½å¯ä»¥æå®šï¼Œæ˜¯å½“ä¸‹æœ€æµè¡Œçš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚

npm i prettier -D

// åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º .prettierrc æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¯ä»¥é…ç½®å›¢é˜Ÿç»Ÿä¸€çš„æ ¼å¼åŒ–é£æ ¼ã€‚

{
  "useTabs": false,
  "tabWidth": 2,
  "printWidth": 100,
  "singleQuote": true,
  "trailingComma": "none",
  "bracketSpacing": true,
  "semi": false
}
// ç¼–è¾‘å™¨å¯ä»¥è®¾ç½®æ–‡ä»¶ä¿å­˜ä¹‹åæ ¼å¼åŒ–

2ã€å®‰è£… ESLint

npm i eslint -D

ESLint å®‰è£…æˆåŠŸåï¼Œæ‰§è¡Œ npx eslint \--initï¼Œç„¶åæŒ‰ç…§ç»ˆç«¯æ“ä½œæç¤ºå®Œæˆä¸€ç³»åˆ—è®¾ç½®æ¥åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚

// å¦‚æœè‡ªåŠ¨å®‰è£…å¤±è´¥ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨å®‰è£…
npm i eslint-config-airbnb-base -D 
npm i eslint-plugin-vue -D
npm i eslint-config-prettier -D
npm i eslint-import-resolver-webpack -D
npm i eslint-plugin-import -D
npm i eslint-plugin-prettier -D
npm i eslint-webpack-plugin -D

åœ¨æ ¹ç›®å½•æ·»åŠ å¿½ç•¥æ£€æŸ¥æ–‡ä»¶.eslintignore

node_modules
dist/
build/
/*.js

ä¸‹é¢è¿™ä¸ªç¬¦å·ä¸æ˜¯å†…å®¹
*/

---------åˆ†å‰²çº¿--------

// åœ¨æ ¹ç›®å½•æ·»åŠ .eslintrc.js

module.exports = {
  root: true, // æ­¤é¡¹æ˜¯ç”¨æ¥å‘Šè¯‰eslintæ‰¾å½“å‰é…ç½®æ–‡ä»¶ä¸èƒ½å¾€çˆ¶çº§æŸ¥æ‰¾
  env: {
    browser: true,
    es2021: true
  },
  extends: ['plugin:vue/essential', 'airbnb-base', 'plugin:prettier/recommended'],
  parserOptions: {
    parser: 'babel-eslint',
    ecmaVersion: 2018,
    sourceType: 'module'
  },
  plugins: ['vue', 'prettier'],
  settings: {
    'import/resolver': {
      webpack: {
        config: 'build/webpack.dev.config.js'
      }
    }
  },
  rules: {
    'prettier/prettier': 'error'
  }
}

// webpack5.20 ä»¥åä¸éœ€è¦eslint-loaderç›´æ¥åœ¨webpack.common.config.jsæ·»åŠ å¦‚ä¸‹ä»£ç 

plugins:[
    new ESLintPlugin({
      // fix: true,
      extensions: ['js', 'json', 'vue'],
      exclude: '/node_modules/'
    })
]
```

## ä¸‰ã€æäº¤gitä»“åº“

### 1ã€åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªæäº¤å¿½ç•¥çš„æ–‡ä»¶`.gitignore`

```js
// .gitignore æ–°å¢å¿½ç•¥æäº¤çš„æ–‡ä»¶

logs/
npm-debug.log
yarn-error.log
node_modules/
dist/
package-lock.json
yarn.lock
.idea/
```

### 2ã€æäº¤è§„èŒƒ

æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å·²é›†æˆ ESLint å’Œ Prettierï¼Œåœ¨ç¼–ç æ—¶ï¼Œè¿™äº›å·¥å…·å¯ä»¥å¯¹æˆ‘ä»¬å†™çš„ä»£ç è¿›è¡Œå®æ—¶æ ¡éªŒï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½æœ‰æ•ˆè§„èŒƒæˆ‘ä»¬å†™çš„ä»£ç ï¼Œä½†å›¢é˜Ÿå¯èƒ½ä¼šæœ‰äº›äººè§‰å¾—è¿™äº›æ¡æ¡æ¡†æ¡†çš„é™åˆ¶å¾ˆéº»çƒ¦ï¼Œé€‰æ‹©è§†â€œæç¤ºâ€è€Œä¸è§ï¼Œä¾æ—§æŒ‰è‡ªå·±çš„ä¸€å¥—é£æ ¼æ¥å†™ä»£ç ï¼Œæˆ–è€…å¹²è„†ç¦ç”¨æ‰è¿™äº›å·¥å…·ï¼Œå¼€å‘å®Œæˆå°±ç›´æ¥æŠŠä»£ç æäº¤åˆ°äº†ä»“åº“ï¼Œæ—¥ç§¯æœˆç´¯ï¼ŒESLint ä¹Ÿå°±å½¢åŒè™šè®¾ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›é™åˆ¶ï¼Œè®©æ²¡é€šè¿‡ ESLint æ£€æµ‹å’Œä¿®å¤çš„ä»£ç ç¦æ­¢æäº¤ï¼Œä»è€Œä¿è¯ä»“åº“ä»£ç éƒ½æ˜¯ç¬¦åˆè§„èŒƒçš„ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° Git Hookï¼Œåœ¨æœ¬åœ°æ‰§è¡Œ `git commit` çš„æ—¶å€™ï¼Œå°±å¯¹æ‰€æäº¤çš„ä»£ç è¿›è¡Œ ESLint æ£€æµ‹å’Œä¿®å¤ï¼ˆå³æ‰§è¡Œ `eslint \--fix`ï¼‰ï¼Œå¦‚æœè¿™äº›ä»£ç æ²¡é€šè¿‡ ESLint è§„åˆ™æ ¡éªŒï¼Œåˆ™ç¦æ­¢æäº¤ã€‚

å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å€ŸåŠ© **husky**[7]

> **husky**[8] â€”â€” Git Hook å·¥å…·ï¼Œå¯ä»¥è®¾ç½®åœ¨ git å„ä¸ªé˜¶æ®µï¼ˆ`pre-commit`ã€`commit-msg`ã€`pre-push` ç­‰ï¼‰è§¦å‘æˆ‘ä»¬çš„å‘½ä»¤ã€‚

ä½¿ç”¨ `husky-init` å‘½ä»¤å¿«é€Ÿåœ¨é¡¹ç›®åˆå§‹åŒ–ä¸€ä¸ª husky é…ç½®ã€‚

```js
npx husky-init && cnpm install

```

æ‰§è¡Œå‘½ä»¤ç”Ÿæˆäº†ä¸€ä¸ª`.husky`æ–‡ä»¶å¤¹å’Œä¸€äº›æ–‡ä»¶

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwgsjN8Co5G79LfbqwjVcnrTH4V1ia0EU7ib0v1XEdp0Huic3OpibrIYMibKw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

ä¿®æ”¹ `pre-commit`

```js
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint

```

package.json æ·»åŠ å‘½ä»¤

```js
"scripts": {
  "lint": "eslint --ext .js,.vue src"
},

```

æµ‹è¯•ä¸€ä¸‹æäº¤ä»£ç ï¼Œä¼šçœ‹åˆ°æœ‰æŠ¥é”™çš„ä»£ç æ˜¯æäº¤ä¸äº†çš„

## å››ã€è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®

#### åˆ›å»º GitHub Token

åˆ›å»ºä¸€ä¸ªæœ‰ **repo** å’Œ **workflow** æƒé™çš„ **GitHub Token**[9]

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwKCNPQetyNvgDPlH6icYMicy4nen9Mq7D0ECrmplU6IXCtMcMKUOWjiaug/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

> æ³¨æ„ï¼šæ–°ç”Ÿæˆçš„ Token åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œä¿å­˜èµ·æ¥ï¼Œåé¢è¦ç”¨åˆ°ã€‚å¦‚æœ‰é—å¤±ï¼Œé‡æ–°ç”Ÿæˆå³å¯ã€‚

#### åœ¨ä»“åº“ä¸­æ·»åŠ  secret

å°†ä¸Šé¢æ–°åˆ›å»ºçš„ Token æ·»åŠ åˆ° GitHub ä»“åº“çš„ `Secrets` é‡Œï¼Œå¹¶å°†è¿™ä¸ªæ–°å¢çš„ `secret` å‘½åä¸º`NIGO_DEV` ï¼ˆåå­—æ— æ‰€è°“ï¼Œçœ‹ä½ å–œæ¬¢ï¼‰ã€‚

æ­¥éª¤ï¼šä»“åº“ -> `settings` -> `Secrets` -> `New repository secret`ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwSMMlA1icrUDQjorsQzuX4qmMRdMjZNZhef01dCtWmSYeKhiaia7Gic7HCQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

#### åˆ›å»º Actions é…ç½®æ–‡ä»¶

1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.github` ç›®å½•ã€‚
2. åœ¨ `.github` ç›®å½•ä¸‹åˆ›å»º `workflows` ç›®å½•ã€‚
3. åœ¨ `workflows` ç›®å½•ä¸‹åˆ›å»º `deploy.yml` æ–‡ä»¶ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwVBzLf6YJ7OsPOqrJ4WnoXEeIZwhn50qHIR80BAHXz8GfT20DzcdfpA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

ä¿®æ”¹ `deploy.yml` æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç 

```js
name: deploy

on:
  push:
    branches: [master] # master åˆ†æ”¯æœ‰ push æ—¶è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node.js v14.x
        uses: actions/setup-node@v1
        with:
          node-version: '14.x'

      - name: Install
        run: yarn install # å®‰è£…ä¾èµ–

      - name: Build
        run: npm run build # æ‰“åŒ…

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3 # ä½¿ç”¨éƒ¨ç½²åˆ° GitHub pages çš„ action
        with:
          publish_dir: ./dist # éƒ¨ç½²æ‰“åŒ…åçš„ dist ç›®å½•
          github_token: ${{ secrets.NIGO_DEV }} # secret å
          user_name: ${{ secrets.MY_USER_NAME }}
          user_email: ${{ secrets.MY_USER_EMAIL }}
          commit_message: Update # éƒ¨ç½²æ—¶çš„ git æäº¤ä¿¡æ¯ï¼Œè‡ªç”±å¡«å†™


```

æ¥ç€åªè¦æäº¤ä¿®æ”¹ä»£ç ï¼ŒGithub Actionså°±ä¼šè¿è¡Œè‡ªåŠ¨éƒ¨ç½²

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwIFLHABCL0sOiaCpNuCrhoVeL7YbVicPANzHLG21C7icT92uiboibITvGRIA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

è¿™é‡Œéƒ¨ç½²åçš„ä»£ç ä¼šæ”¾åˆ°`gh-pages`åˆ†æ”¯ï¼Œ`gh-pages`åˆ†æ”¯æ˜¯è‡ªåŠ¨åˆ›å»ºçš„

githubä»“åº“ -> `settings` -> `pages` è¯»å–`gh-pages`åˆ†æ”¯ï¼Œç„¶åè®¿é—®**shinewen189.github.io/nigo-cli/**[10]

![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz/H8M5QJDxMHqEXFZFXc8nTvvo11KXOkgwtoAYapbTaWOuJqINueVd8pcXhjCjEo1Pgh1NEfgtGqsUdnIvgvxT2w/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)image.png

> è‡ªåŠ¨éƒ¨ç½²åªæ˜¯ GitHub Actions åŠŸèƒ½ä¸€å°éƒ¨åˆ†ï¼ŒGitHub Actions èƒ½åšçš„äº‹è¿˜å¾ˆå¤šå¾ˆå¤šï¼Œæ„Ÿå…´è¶£çš„åŒå­¦è‡ªè¡ŒæŸ¥é˜…ã€‚

## ç äº‘é¡¹ç›®æ„å»º

```js
ç™»å½•æ³¨å†Œåï¼ˆå¯ä»¥ä½¿ç”¨å¾®ä¿¡ï¼Œqqç­‰ï¼‰

1ã€è¿›å…¥é¦–é¡µç‚¹å‡»æ–°å»ºä»“åº“
2ã€å¡«å†™ä»“åº“åï¼Œä»“åº“ä»‹ç»
3ã€é€‰æ‹©å¼€æºç§æœ‰
4ã€åˆå§‹åŒ–ä»“åº“
	-è¯­è¨€ï¼š æ ¹æ®è‡ªå·²é¡¹ç›®é€‰æ‹©å¯¹åº”çš„å¼€å‘è¯­è¨€ã€‚
	-gitignoreï¼š é€‰æ‹©å¯¹åº”çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬æäº¤ä»£ç ï¼Œå¦‚é…ç½®æ–‡ä»¶ç±»çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥ä¸ºæˆ‘ä»¬å¿½ç•¥æ‰ã€‚æˆ‘ä»¬çš„é¡¹ç›®å°±ä¸ä¼šæäº¤å¾ˆå¤šåƒåœ¾ã€‚ç›®å‰æˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ˜¯mavenå¼€å‘å°±é€‰æ‹©mavenã€‚
	-å¼€æºè®¸å¯è¯ï¼š åªæ˜¯ä¸€ä¸ªå¼€æºçš„åè®®ï¼Œæ ¹æ®è‡ªå·²çš„é¡¹ç›®æ¥ã€‚ä¸€èˆ¬é€‰æ‹©Apache-2.0 å°±å¯ä»¥äº†
	-ç”Ÿäº§/å¼€å‘æ¨¡å‹(æ”¯æŒ master/develop ç±»å‹åˆ†æ”¯)ï¼š å¼€å‘çš„æ—¶å€™åœ¨devåˆ†æ”¯ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ°masteråˆ†æ”¯ã€‚

5ã€è®¾ç½®æ¨¡æ¿
	å¯ä»¥æ·»åŠ  Readmeã€issueã€Pull Request æ¨¡æ¿æ–‡ä»¶
6ã€é€‰æ‹©åˆ†æ”¯
	

ç»è¿‡ä»¥ä¸Šæ­¥éª¤åˆ›å»ºå¥½ä»“åº“åï¼Œç‚¹å‡»å¤åˆ¶ä»“åº“åœ°å€è¿™é‡Œé€‰ç”¨httpsçš„åœ°å€å°±å¯ä»¥äº†



Gité…ç½®å¤šä¸ªSSH-Key

èƒŒæ™¯
å½“æœ‰å¤šä¸ªgitè´¦å·æ—¶ï¼Œæ¯”å¦‚ï¼š

a. ä¸€ä¸ªgiteeï¼Œç”¨äºå…¬å¸å†…éƒ¨çš„å·¥ä½œå¼€å‘ï¼›
b. ä¸€ä¸ªgithubï¼Œç”¨äºè‡ªå·±è¿›è¡Œä¸€äº›å¼€å‘æ´»åŠ¨ï¼›

è§£å†³æ–¹æ³•

ç”Ÿæˆä¸€ä¸ªå…¬å¸ç”¨çš„SSH-Key
$ ssh-keygen -t rsa -C 'xxxxx@company.com' // ä¸æŒ‡å®šè·¯å¾„ä¼šæç¤º
$ ssh-keygen -t rsa -C 'xxxxx@company.com' -f ~/.ssh/gitee_id_rsa 
// æŒ‡å®šè·¯å¾„ä¸å¯¹ä¼šæŠ¥é”™ Saving key "~/.ssh/gitee_id_rsa" failed: No such file or directory

ç”Ÿæˆä¸€ä¸ªgithubç”¨çš„SSH-Key
$ ssh-keygen -t rsa -C 'xxxxx@qq.com' -f ~/.ssh/github_id_rsa

åœ¨ ~/.ssh ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆå…¶ä¸­Hostå’ŒHostNameå¡«å†™gitæœåŠ¡å™¨çš„åŸŸåï¼ŒIdentityFileæŒ‡å®šç§é’¥çš„è·¯å¾„ï¼‰

// config
    # gitee
    Host gitee.com
    HostName gitee.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/gitee_id_rsa
    # github
    Host github.com
    HostName github.com
    PreferredAuthentications publickey
    IdentityFile ~/.ssh/github_id_rsa

    
æ·»åŠ å…¬é’¥

    
4.ç”¨sshå‘½ä»¤åˆ†åˆ«æµ‹è¯•

 ssh -T git@gitee.com
 ssh -T git@github.com

ä»¥ gitee ä»“åº“ä¸ºä¾‹ï¼Œæ·»åŠ æˆåŠŸæ˜¾ç¤º
C:\WINDOWS\system32>ssh -T git@gitee.com
Enter passphrase for key 'C:\Users\19507/.ssh/gitee_id_rsa':
Hi [36;01må…‰èƒŒå¤©ç›–ä»°å¤´æœ›[0m! You've [32msuccessfully[0m authenticated, but GITEE.COM does not provide shell access.
```



## æœ€å

ä¸€å¥—å®Œæ•´çš„å‰ç«¯å·¥ç¨‹æ¶æ„æ–¹æ¡ˆï¼Œéœ€è¦è€ƒè™‘æŠ€æœ¯é€‰å‹ã€åŒºåˆ†ç¯å¢ƒã€ä»£ç è§„èŒƒã€æäº¤è§„èŒƒã€æµ‹è¯•ã€è‡ªåŠ¨éƒ¨ç½²ç­‰ç­‰ã€‚æœ¬é¡¹ç›®å¯¹äºæ¯é¡¹æŠ€æœ¯æ ˆåªæ˜¯æä¾›è¾ƒä¸ºåŸºç¡€çš„é…ç½®ï¼ŒåŒå­¦ä»¬å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å¯¹æœ¬é¡¹ç›®æ¯ä¸ªæŠ€æœ¯æ ˆå±•å¼€ç ”ç©¶æˆ–é’ˆå¯¹æ€§é…ç½®ï¼Œæ‰¾å‡ºè‡ªå·±æœ€é€‚åˆçš„å·¥ç¨‹åŒ–æ–¹æ¡ˆã€‚

æœ€åå†è´´ä¸Šé¡¹ç›®åœ°å€

> github: **wyf195075595/github.io/github-actions-demo**
>
> gitee: https://wangyf1024.gitee.io/

