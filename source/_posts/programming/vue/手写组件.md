---
title:  vue å¤šé€‰æœˆä»½ç»„ä»¶
date: 2022-06-17 08:23:10
tags: ç»„ä»¶
categories: vue
---
ğŸ“…å¤šé€‰æœˆä»½

<!--more-->

```vue
<template>
   <div class="selectMonthBoxSquare rel clearFixed" id="boxArea">
       <!-- el-inputè¾“å…¥æ¡†ï¼šreadonlyå’Œclearableå±æ€§ä¸èƒ½åŒæ—¶ä½¿ç”¨ -->
        <el-input class="inputStyle" v-model="inputValue" type="text" placeholder="è¯·é€‰æ‹©æŸ¥è¯¢æœˆä»½" readonly @focus="showBox = true">
            <i slot="prefix" class="el-input__icon el-icon-date"></i>
            <!-- æ¸…ç©ºå›¾æ ‡ï¼šæœ‰å†…å®¹çš„æ—¶å€™æ¸²æŸ“å‡ºæ¥ï¼Œé¼ æ ‡hoveråˆ°inputæ¡†çš„æ—¶å€™å†æ˜¾ç¤ºå‡ºæ¥ï¼ˆå³ï¼šè¾“å…¥æ¡†æœ‰å†…å®¹å¹¶ä¸”é¼ æ ‡æ‚¬æµ®æ—¶æ˜¾ç¤ºè¯¥å›¾æ ‡ï¼‰ -->
            <i slot="suffix" class="el-input__icon el-icon-circle-close clearIconStyle" v-if="showClear" @click="resetMonth"></i>
        </el-input>
        <!-- å¹´ä»½æœˆä»½é€‰æ‹©å¼¹æ¡† -->
        <div class="selectContentBox" v-if="showBox">
           <div class="contentArea">
               <!-- å¹´ä»½ -->
                <div class="flex flex-wrap flex-around" style="padding: 15px 0;border-bottom: 1px solid #e5e5e5;">
                    <div class="cursor" v-if="curIndex == DateList.length - 1" style="width: 15%;"><img src="../../../images/left_icon_gray.png" alt="" /></div>
                    <div class="cursor" v-else @click="reduceYear" style="width: 15%;"><img src="../../../images/left_icon.png" alt="" /></div>
                    <div>{{OneY}}å¹´</div>
                    <div class="cursor t-r" v-if="curIndex == 0" style="width: 15%;"><img src="../../../images/right_icon_gray.png" alt="" /></div>
                    <div class="cursor t-r" v-else @click="addYear" style="width: 15%;"><img src="../../../images/right_icon.png" alt="" /></div>
                </div>
                <!-- æœˆä»½ -->
                <div class="conterList">
                    <el-checkbox-group class="flex flex-wrap" v-model="optTime[curIndex].queryTime" @change="onChange" >
                        <el-checkbox class="onSelect flex-x-center" v-for="(item,index) in DateList[curIndex].queryTime" :key="index" :label="`${DateList[curIndex].TimeYear}-${(item<=9)?`0${item}`:item}`">
                        {{monthMap[item]}}æœˆ
                        </el-checkbox>
                    </el-checkbox-group>
                </div>
            </div>
            <!-- æŒ‰é’® -->
            <div class="buttonBox t-r">
                <el-button class="buttonStyle" size="mini" type="primary" plain @click.stop="handleSubmit">ç¡®å®š</el-button>
                <el-button class="buttonStyle" size="mini" plain @click.stop="resetMonth">é‡ç½®</el-button>
            </div>
       </div>
   </div>
</template>
<script>
export default {
    data(){
        return{
            DateList: [], // å¹´ä»½æœˆä»½æ•°ç»„
            optTime: [], // æœˆä»½é€‰ä¸­ç»“æœæ•°ç»„
            OneY: '', // å½“å‰å¹´ä»½
            curIndex: 0, // å½“å‰å¹´ä»½ä¸‹æ ‡å€¼
            optTimes: [], // ç‚¹å‡»æœˆä»½æ—¶çš„æ‰€æœ‰é€‰ä¸­ç»“æœ
            resultTimes: [], // ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®åçš„é€‰æ‹©ç»“æœ
            showBox: false, // æ˜¯å¦æ˜¾ç¤ºæœˆä»½é€‰æ‹©å¼¹æ¡†
            inputValue: '', // è¾“å…¥æ¡†çš„ç»‘å®šå€¼
            showClear: false, // æ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†å³è¾¹çš„â€œæ¸…ç©ºâ€å°å›¾æ ‡
            monthMap: { // æœˆä»½æ˜¾ç¤ºä¸ºä¸­æ–‡
                '1': 'ä¸€',
                '2': 'äºŒ',
                '3': 'ä¸‰',
                '4': 'å››',
                '5': 'äº”',
                '6': 'å…­',
                '7': 'ä¸ƒ',
                '8': 'å…«',
                '9': 'ä¹',
                '10': 'å',
                '11': 'åä¸€',
                '12': 'åäºŒ',
            }
        }
    },
    created(){
        this.init();
    },
    mounted() {
        //ç‚¹å‡»å¼¹æ¡†å¤–çš„ä»»æ„ä½ç½®å…³é—­åŒºåŸŸå¼¹çª—
        document.addEventListener('click',(e) => {
            //è·å–å¼¹çª—å¯¹è±¡
            const boxArea = document.getElementById('boxArea');
            //åˆ¤æ–­å¼¹çª—å¯¹è±¡ä¸­æ˜¯å¦åŒ…å«ç‚¹å‡»å¯¹è±¡
            if(boxArea &&ã€€!boxArea.contains(e.target)) {
                // åˆ¤æ–­å½“å‰é€‰ä¸­æœˆä»½ä¸ä¸Šæ¬¡ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®æ—¶çš„é€‰æ‹©ç»“æœæ˜¯å¦ä¸€è‡´
                let equalArr = this.resultTimes.sort().toString() == this.optTimes.sort().toString()
                if(!equalArr) {
                    // å¦‚æœä¸ä¸€è‡´ï¼ˆå› ä¸ºæ˜¯å¤šé€‰ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ç‚¹å‡»äº†â€œç¡®å®šâ€æŒ‰é’®åæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢ï¼‰ï¼š
                    // å°†é€‰æ‹©ç»“æœæ¢å¤åˆ°ä¸Šæ¬¡ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®æ—¶çš„ç»“æœ
                    this.optTimes = this.resultTimes
                    // å°†è¾“å…¥æ¡†çš„å€¼æ¢å¤åˆ°ä¸Šæ¬¡ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®æ—¶çš„å€¼
                    this.inputValue = this.optTimes.join(',')
                    // æ ¹æ®è¾“å…¥æ¡†æ˜¯å¦æœ‰å€¼æ¥åˆ¤æ–­æ¸…ç©ºå›¾æ ‡æ˜¯å¦æ¸²æŸ“
                    this.showClear = this.inputValue == '' ? false : true
                    // å°†æœˆä»½é€‰ä¸­ç»“æœæ¢å¤åˆ°ä¸Šæ¬¡ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®æ—¶çš„é€‰ä¸­æœˆä»½
                    let _opt = this.resultTimes.map(v => { return v.substring(0,4) });
                    for( let item in this.optTime ){
                        this.optTime[item].queryTime = []
                        _opt.map((items,indexs)=>{
                            if( items == this.optTime[item].TimeYear ){
                                this.optTime[item].queryTime.push(this.resultTimes[indexs])
                            }
                        })
                    }
                }
                // å…³é—­å¼¹æ¡†
                this.showBox = false;
            }
        })
    },
    methods:{
        // åˆå§‹åŒ–æ•°æ®ï¼Œè·å–å‰20å¹´ï¼Œç„¶åå¾ªç¯ æ¯ä¸€å¹´é‡Œé¢éƒ½æœ‰12ä¸ªæœˆçš„ å¾—åˆ°æ•°ç»„ opTime å’Œ DateList
        init(){
            const _this = this;
            let _opt = [];
            let _optTime = []
            let arr = new Array(12);
            let optDate = this.getDateList();
            optDate.map((item,index)=>{
                // æœˆä»½é€‰æ‹©æ—¶el-checkbox-groupç»‘å®šçš„å€¼
                _optTime[index] = {
                    TimeYear: item,
                    queryTime: []
                }
                // ç»™æ¯ä¸€å¹´ä»½è®¾ç½®12ä¸ªæœˆä»½ï¼Œel-checkboxåˆå§‹åŒ–æ˜¾ç¤ºæ—¶ä½¿ç”¨
                _opt[index] = {
                    TimeYear: item, 
                    queryTime: []
                }
                for(let i = 1; i<= arr.length; i++){
                     _opt[index].queryTime.push(i)
                }
            })
            _this.optTime = _optTime
            _this.DateList = _opt;
        },
        // è·å–è¿‘20å¹´å¹´ä»½åˆ—è¡¨ï¼Œå€’åºæ’åˆ—ï¼Œæœ€æ–°ä¸€å¹´åœ¨æœ€å‰é¢
        getDateList(){
            let Dates = new Date();
            let year = Dates.getFullYear();
            this.OneY = year;
            let  optDate = [];
            for( let i = year - 20; i <= year; i++ ){
                optDate.push(i)
            }
            return optDate.reverse()
        },
        // ç¡®å®š
        handleSubmit(){
            const _this = this;
            // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
            _this.inputValue = _this.optTimes.join(',')
            // æ ¹æ®è¾“å…¥æ¡†æ˜¯å¦æœ‰å€¼æ¥åˆ¤æ–­æ¸…ç©ºå›¾æ ‡æ˜¯å¦æ¸²æŸ“
            _this.showClear = _this.inputValue == '' ? false : true
            // å°†ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®çš„é€‰æ‹©ç»“æœä¿å­˜èµ·æ¥ï¼ˆè¯¥å€¼å°†åœ¨å“ªé‡Œä½¿ç”¨ï¼šåœ¨ç‚¹å‡»å¼¹æ¡†ä»¥å¤–åŒºåŸŸå…³é—­å¼¹æ¡†æ—¶ä½¿ç”¨ï¼Œmountedä¸­ï¼‰
            _this.resultTimes = _this.optTimes
            // å…³é—­å¼¹æ¡†
            _this.showBox = false
            _this.$emit('submitBtn',_this.resultTimes)
        },
        // é‡ç½®
        resetMonth() {
            const _this = this;
            // å°†å¹´ä»½é‡ç½®åˆ°å½“å‰å¹´ä»½
            let Dates = new Date();
            let year = Dates.getFullYear();
            _this.OneY = year;
            // å°†å·²é€‰æ‹©çš„æœˆä»½æ¸…ç©º
            _this.optTimes = [];
            for( let i in _this.optTime  ){
                _this.optTime[i].queryTime =[]
            }
            // å°†è¾“å…¥æ¡†æ¸…ç©º
            _this.inputValue = ''
            // æ ¹æ®è¾“å…¥æ¡†æ˜¯å¦æœ‰å€¼æ¥åˆ¤æ–­æ¸…ç©ºå›¾æ ‡æ˜¯å¦æ¸²æŸ“ï¼Œæ­¤å¤„å¿…ç„¶ä¸æ¸²æŸ“
            this.showClear = false
            // å°†ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®çš„é€‰æ‹©ç»“æœæ¸…ç©º
            _this.resultTimes = []
            // å…³é—­æœˆä»½é€‰æ‹©å¼¹æ¡†
            _this.showBox = false
            _this.$emit('resetBtn')
        },
        // å·¦ä¸Šè§’å¹´ä»½å‡å°‘
        reduceYear() {
            const _this = this;
            // å¦‚æœå·²ç»æ˜¯æœ€åä¸€å¹´äº†ï¼Œåˆ™å¹´ä»½ä¸èƒ½å†å‡å°‘äº†
            if(_this.curIndex == _this.DateList.length - 1) return;
            // å½“å‰ä¸‹æ ‡å€¼+1ï¼Œæ ¹æ®ä¸‹æ ‡å€¼è·å–å¹´ä»½å€¼
            _this.curIndex = _this.curIndex + 1
            _this.OneY = _this.DateList[_this.curIndex].TimeYear
        },
        // å·¦ä¸Šè§’å¹´ä»½å¢åŠ 
        addYear() {
            const _this = this;
            // å¦‚æœå·²ç»æ˜¯å½“å‰å¹´ä»½äº†ï¼Œåˆ™å¹´ä»½ä¸èƒ½å†å¢åŠ äº†
            if(_this.curIndex == 0) return;
            // å½“å‰ä¸‹æ ‡å€¼-1ï¼Œæ ¹æ®ä¸‹æ ‡å€¼è·å–å¹´ä»½å€¼
            _this.curIndex = _this.curIndex - 1
            _this.OneY = _this.DateList[_this.curIndex].TimeYear
        },
        // é€‰æ‹©æœˆä»½
        onChange(){
            const _this = this;
            // éå†optTimeä¸­å·²é€‰æ‹©çš„æœˆä»½ï¼Œå°†å·²é€‰ç»“æœå¡åˆ°optTimesæ•°ç»„ä¸­
            let _opt = _this.optTime;
            let arr = [];
             for(let item in _opt ){
                if(_opt[item].queryTime.length > 0)  _opt[item].queryTime.filter( v => { arr.push(v) })
             }
            _this.optTimes = arr
            // æ›´æ–°è¾“å…¥æ¡†çš„å€¼
            _this.inputValue = _this.optTimes.join(',')
            // æ ¹æ®è¾“å…¥æ¡†æ˜¯å¦æœ‰å€¼æ¥åˆ¤æ–­æ¸…ç©ºå›¾æ ‡æ˜¯å¦æ¸²æŸ“
            _this.showClear = _this.inputValue == '' ? false : true
        }
    }
}
</script>
<style lang="scss">

.selectMonthBoxSquare {
    margin-top: 10px;
    width: 250px;
    .inputStyle {
        width: 250px;
    }
    .clearIconStyle {
        display: none;
    }
    .inputStyle:hover .clearIconStyle{
        display: block;
    }
    .selectContentBox {
        position: absolute;
        top: 35px;
        left: 0;
        z-index: 2021;
        background: #ffffff;
        border: 1px solid #e5e5e5;
        border-radius: 3px;
        
        .contentArea {
            width: 330px;
        }
    }
    .conterList{
        .onSelect{
            width: 25% !important;
            margin: 20px 0 !important;
        }
        .columWidth {
            width: 33.33%;
        }
        .el-checkbox__input {
            display: none !important;
        }
        .el-checkbox__label {
            padding-left: 0px !important;
        }
    }
    .selectBox {
        width: 100px;
        
        input {
            height: 25px;
            line-height: 25px;
        }
        .el-input .el-input__icon {
            line-height: 25px;
        }
    }
    .tagStyle {
        margin-right: 10px;
        height: 25px;
        line-height: 25px;
    }
    .lableStyle {
        font-size: 14px;
    }
    .el-button--mini {
        padding: 5px 15px;
        font-size: 12px;
        border-radius: 3px;
    }
    .buttonBox {
        border-top: 1px solid #e5e5e5;
        padding: 10px 10px 10px 0;
    }
}
</style>
```

### å¤šé€‰å¹´ä»½

```vue
<!--
 * @Description: å®ç°å¹´ä»½å¤šé€‰
 * @Author:  wyf
 * @Date: 2022-03-09 10:24:45
 * @LastEditTime: 2022-03-09 17:25:51
 * @LastEditors:  wyf
-->
<template>
   <div class="selectMonthBoxSquare" id="boxArea">
        <el-popover
            placement="bottom"
            width="290"
            trigger="focus"
            popper-class="my-selects-popper"
            :disabled="disabled"
        >
            <!-- å¹´ä»½æœˆä»½é€‰æ‹©å¼¹æ¡† -->
            <div class="selectContentBox">
                <div class="contentArea"   v-if="DateList.length">
                    <!-- æ ‡é¢˜ -->
                    <div class="title-tip" style="padding: 15px 0;border-bottom: 1px solid #e5e5e5;">
                        <div class="cursor" v-if="curIndex == DateList.length - 1" style="width: 15%;"><i class="el-icon-arrow-left" style="color:#ccc;"></i></div>
                        <div class="cursor" v-else @click="reduceYear" style="width: 15%;"><i class="el-icon-arrow-left" ></i></div>
                        <div>{{rangeYearString}}å¹´</div>
                        <div class="cursor t-r" v-if="curIndex == 0" style="width: 15%;"><i class="el-icon-arrow-right"  style="color:#ccc;"></i></div>
                        <div class="cursor t-r" v-else @click="addYear" style="width: 15%;"><i class="el-icon-arrow-right" ></i></div>
                    </div>
                    <!-- å¹´ä»½-->
                    <div class="conterList">
                        <el-checkbox-group class="flex flex-wrap"  v-model="optTime"  @change="onChange" >
                            <el-checkbox class="onSelect flex-x-center" v-for="(item) in DateList[curIndex]" :key="item" :label="item">
                            {{item}}å¹´
                            </el-checkbox>
                        </el-checkbox-group>
                    </div>
                </div>
            </div>
            <!-- el-inputè¾“å…¥æ¡†ï¼šreadonlyå’Œclearableå±æ€§ä¸èƒ½åŒæ—¶ä½¿ç”¨ -->
            <el-input slot="reference" class="inputStyle" v-model="inputValue" type="text" placeholder="è¯·é€‰æ‹©æŸ¥è¯¢æœˆä»½" readonly >
                <i slot="prefix" class="el-input__icon el-icon-date"></i>
                <!-- æ¸…ç©ºå›¾æ ‡ï¼šæœ‰å†…å®¹çš„æ—¶å€™æ¸²æŸ“å‡ºæ¥ï¼Œé¼ æ ‡hoveråˆ°inputæ¡†çš„æ—¶å€™å†æ˜¾ç¤ºå‡ºæ¥ï¼ˆå³ï¼šè¾“å…¥æ¡†æœ‰å†…å®¹å¹¶ä¸”é¼ æ ‡æ‚¬æµ®æ—¶æ˜¾ç¤ºè¯¥å›¾æ ‡ï¼‰ -->
                <i slot="suffix" class="el-input__icon el-icon-circle-close clearIconStyle" v-if="showClear" style="position: relative;z-index: 9999999999;" @click.stop="resetMonth"></i>
            </el-input>
        </el-popover>
        
   </div>
</template>
<script>
export default {
    props: {
        value: {
            type: String,
            default: ''
        },
        disabled: {
            type: Boolean,
            default: false
        }
    },
    model: {
        prop: "value",//æŒ‡å®šè‡ªå·±çš„pfooå±æ€§æ¥å—æ•°å€¼
        event: "input"//æŒ‡å®šè‡ªå·±çš„event1äº‹ä»¶å›é€æ•°æ®ç»™çˆ¶ç»„ä»¶
    },
    data(){
        return {
            DateList: [], // å¹´ä»½æ•°ç»„
            optTime: [], // å¹´ä»½é€‰ä¸­ç»“æœæ•°ç»„
            rangeYear: [], // å½“å‰å¹´ä»½èŒƒå›´
            curIndex: 0, // å½“å‰å¹´ä»½ä¸‹æ ‡å€¼
            inputValue: '', // è¾“å…¥æ¡†çš„ç»‘å®šå€¼
            showClear: false, // æ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†å³è¾¹çš„â€œæ¸…ç©ºâ€å°å›¾æ ‡
        }
    },
    mounted(){
        this.init();
    },
    computed: {
        rangeYearString: function () {
            return `${this.rangeYear[0]}~${this.rangeYear[1]}`
        }
    },
    watch: {
        value:{
            handler: function(val) {
                this.inputValue = val;
            },
            immediate: true
        },
        inputValue: {
            handler: function(val) {
                this.showClear = !!val && !this.disabled
            },
            immediate: true
        }
    },
    methods:{
        // åˆå§‹åŒ–æ•°æ®ï¼Œè·å–å‰20å¹´ï¼Œ DateList
        init(){
            const _this = this;
            let optDate = this.getDateList();
            _this.DateList = optDate;
            setTimeout(()=> {
                this.optTime = this.value?this.value.split(',').map(ele=>+ele): []
            })
        },
        // è·å–è¿‘XXXå¹´å¹´ä»½åˆ—è¡¨ï¼Œå€’åºæ’åˆ—ï¼Œæœ€æ–°ä¸€å¹´åœ¨æœ€å‰é¢
        getDateList(){
            let Dates = new Date();
            let year = Dates.getFullYear();
            this.rangeYear = [year, year+9];
            let  optDate = [];
            let pointer = 0;
            let sub = 0;
            for( let i = year - 100; i <= year + 100; i++ ){
                pointer += 1
                if(!optDate[sub]) optDate[sub] = [];
                optDate[sub].push(i)
                // è®¾ç½®å½“å‰å¹´ä»½é¡µæ•°
                if(i === year) {
                    this.curIndex = sub;
                }
                if(pointer == 10) {
                    pointer = 0
                    sub += 1
                }
            }
            return optDate.reverse()
        },
        // å·¦ä¸Šè§’å¹´ä»½å‡å°‘
        reduceYear() {
            const _this = this;
            // å¦‚æœå·²ç»æ˜¯æœ€åä¸€å¹´äº†ï¼Œåˆ™å¹´ä»½ä¸èƒ½å†å‡å°‘äº†
            if(_this.curIndex == _this.DateList.length - 1) return;
            // // å½“å‰ä¸‹æ ‡å€¼+1ï¼Œæ ¹æ®ä¸‹æ ‡å€¼è·å–å¹´ä»½å€¼
            _this.curIndex += 1
            _this.rangeYear = [_this.rangeYear[0] - 10, _this.rangeYear[0] - 1]
        },
        // å·¦ä¸Šè§’å¹´ä»½å¢åŠ 
        addYear() {
            const _this = this;
            // å¦‚æœå·²ç»æ˜¯å½“å‰å¹´ä»½äº†ï¼Œåˆ™å¹´ä»½ä¸èƒ½å†å¢åŠ äº†
            if(_this.curIndex == 0) return;
            // å½“å‰ä¸‹æ ‡å€¼-1ï¼Œæ ¹æ®ä¸‹æ ‡å€¼è·å–å¹´ä»½å€¼
            _this.curIndex -= 1
            _this.rangeYear = [_this.rangeYear[1] + 1,_this.rangeYear[1] + 10]
        },
        // é€‰æ‹©æœˆä»½
        onChange(){
            const _this = this;
            this.inputValue = this.optTime.toString()
            this.$emit('input', this.inputValue)
        },
        resetMonth() {
            this.optTime = []
            this.inputValue = ''
            this.$emit('input', '')
        }
    }
}
</script>
<style lang="scss" scoped>
.selectContentBox {
    .title-tip {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .cursor {
        text-align: center;
    }
    .contentArea {
        width: 290px;
        color: #fff;
    }
    .conterList{
        .onSelect{
            width: 25% !important;
            margin: 20px 0 !important;
        }
        .columWidth {
            width: 33.33%;
        }
        .el-checkbox__input {
            display: none !important;
        }
        .el-checkbox__label {
            padding-left: 0px !important;
        }
    }

    .buttonBox {
        border-top: 1px solid #e5e5e5;
        padding: 10px 10px 10px 0;
    }
}

</style>
<style lang="scss">
    .my-selects-popper {
        background: #0a353b !important;
        .el-checkbox__input {
            display: none;
        }
    }
</style>
```

