---
title:  vue å®è·µä¸ä¼˜åŒ–
date: 2022-08-05 08:23:10
tags: 
categories: vuex
---



### åœ¨ä½¿ç”¨ element UI çš„ el-image æ—¶ï¼Œé¦–æ¬¡åŠ è½½å›¾ç‰‡å‡ºç°ç™½è‰²é—ªç°æ•ˆæœ

è¿™æ˜¯åº”ä¸º ç»„ä»¶å†… åœ¨åŠ è½½å‰å’ŒåŠ è½½ä¸­æ˜¯ä¸€ä¸ªç±»åä¸ºel-image__placeholderçš„divæ ‡ç­¾ï¼Œåœ¨åŠ è½½åå’ŒåŠ è½½å‡ºé”™åçš„å¤„ç†åˆ†åˆ«æ˜¯ä¸€ä¸ªdivå’Œimgæ ‡ç­¾ã€‚

è§£å†³æ–¹æ³•ï¼šåœ¨åŠ è½½å‰å’ŒåŠ è½½åçš„æ ·å¼ä¸Šåšæ›´æ”¹ï¼Œå¯ä»¥**é‡å†™è¦†ç›–**ç±»å**el-image__placeholder**å’Œ**el-image__error**æ¥è‡ªå®šä¹‰è‡ªå·±æƒ³è¦çš„æ•ˆæœäº†

```css
// å°†é»˜è®¤çš„ç™½è‰²èƒŒæ™¯å»é™¤

::v-deep .el-image__placeholder,
::v-deep .el-image__error
{
    background: none !important;
}
```



### vue è·¯ç”± tabåˆ‡æ¢æ—¶ï¼ŒåŠ¨æ€åˆ¤æ–­å·¦å³åˆ‡æ¢è¿‡æ¸¡åŠ¨ç”»

> é¢„ç½®ä¸‰ç§åŠ¨ç”»
>
> 1. opacity-scale
> 2. switch-right
> 3. switch-left

```css
/**
    transition-åŠ¨ç”» [é€æ˜ç¼©æ”¾]
    name: "opacity-scale"
 */
.opacity-scale-enter-active {
    transition: all 0.65s ease;
}
.opacity-scale-leave-active {
    transition: all 0.65s ease;
}
.opacity-scale-enter {
    opacity: 0;
    transform: scale(0.9);
}
.opacity-scale-enter-to {
    opacity: 1;
    transform: scale(1);
}
.opacity-scale-leave {
    opacity: 1;
    transform: scale(1);
}
.opacity-scale-leave-to {
    opacity: 0;
    transform: scale(0.9);
}

/**
    transition-åŠ¨ç”» [é€æ˜]
    name: "opacity-scale"
 */
 .opacity-enter-active {
    transition: all 0.65s ease;
}
.opacity-leave-active {
    transition: all 0.65s ease;
}
.opacity-enter {
    opacity: 0;
}
.opacity-enter-to {
    opacity: 1;
}
.opacity-leave {
    opacity: 1;
}
.opacity-leave-to {
    opacity: 0;
}

/**
    transition-åŠ¨ç”» [å¹»ç¯ç‰‡ï¼ˆä»å·¦å‘å³ï¼‰]
    name: "switch-left"
 */
.switch-left-enter-active {
    transition: all 0.85s ease;
}
.switch-left-leave-active {
    transition: all 0.85s ease;
}
.switch-left-enter {
    transform: translateX(-100%);
    opacity: .85;
}
.switch-left-enter-to {
    transform: translateX(0);
    opacity: 1;
}
.switch-left-leave {
    transform: translateX(0);
    opacity: 1;
}
.switch-left-leave-to {
    transform: translateX(100%);
    opacity: .85;
}

/**
    transition-åŠ¨ç”» [å¹»ç¯ç‰‡ï¼ˆä»å³å‘å·¦ï¼‰]
    name: "switch-right"
 */
.switch-right-enter-active {
    transition: all 0.85s ease;
}
.switch-right-leave-active {
    transition: all 0.85s ease;
}
.switch-right-enter {
    transform: translateX(100%);
    opacity: .85;
}
.switch-right-enter-to {
    transform: translateX(0);
    opacity: 1;
}
.switch-right-leave {
    transform: translateX(0);
    opacity: 1;
}
.switch-right-leave-to {
    transform: translateX(-100%);
    opacity: .85;
}

/**
    èœå•ä¸‹æ‹‰åŠ¨ç”»
 */
.menu-upbit-anim {
    animation-duration: .3s;
    animation-fill-mode: both;
    animation-name: menu-top-to-bottom;
}

@keyframes menu-top-to-bottom{
    from{
        opacity:.3;
        margin-top: -30px;
    }
    to{
        opacity:1;
        margin-top: 0;
    }
}
```

**è®¾ç½®è·¯ç”±**

é€šè¿‡è®¾ç½®è·¯ç”±å±æ€§ meta.sort æ¥è®°å½•è·¯ç”±ä½ç½®

```js
const routers = [
	 {
    path: "/defectControl",
    name: "defectControl",
    meta: {
      keepAlive: false,
      sort: "c-1",
    },
    component: () =>
      import(
        /* webpackChunkName: "defectControl-index" */ "@/views/defectControl/index.vue"
      ),
    children: [
      {
        // é¦–é¡µ
        path: "frontPage",
        name: "defectControl-frontPage",
        meta: {
          keepAlive: false,
          sort: "c-2",
        },
        component: () =>
          import(
            /* webpackChunkName: "defectControl-frontPage" */ "@/views/defectControl/frontPage.vue"
          ),
      },
      {
        path: "defectPool",
        name: "defectControl-defectPool",
        meta: {
          keepAlive: false,
          sort: "c-3",
        },
        component: () =>
          import(
            /* webpackChunkName: "defectControl-defectPool" */ "@/views/defectControl/defectPool.vue"
          ),
      },
      {
        path: "defectCondition",
        name: "defectControl-defectCondition",
        meta: {
          keepAlive: false,
          sort: "c-4",
        },
        component: () =>
          import(
            /* webpackChunkName: "defectControl-defectCondition" */ "@/views/defectControl/defectCondition.vue"
          ),
      },
      {
        path: "defectFocal",
        name: "defectControl-defectFocal",
        meta: {
          keepAlive: false,
          sort: "c-5",
        },
        component: () =>
          import(
            /* webpackChunkName: "defectControl-defectFocal" */ "@/views/defectControl/defectFocal.vue"
          ),
      },
      {
        path: "defect",
        name: "defectControlConfiguration-defectConfig",
        meta: {
          keepAlive: false,
          sort: "c-6",
        },
        component: () =>
          import(
            /* webpackChunkName: "defectControlConfiguration-defectConfig" */ "@/views/defectControl/defectControlConfiguration/defectView.vue"
          ),
      },
    ],
  },
]
```

**ç›‘å¬è·¯ç”±å˜åŒ–**

```js
{
    data() {
        return {
            transitionName: "opacity-scale"
        }
    },
	watch: {
		$route(to, from) {
          // æŸ¥çœ‹è·¯ç”±å…ƒä¿¡æ¯ä¸­æ˜¯å¦è®¾ç½®äº†åŠ¨ç”»å
          if (to?.meta?.transitionName) {
            return (this.transitionName = to.meta.transitionName);
          }
          // å¦‚æœæ˜¯ä¸»æ¨¡å—ï¼Œä¸æ˜¯å­æ¨¡å—ä¸éœ€è¦åŠ¨ç”»
          if (from.path === "/defectControl") {
            return (this.transitionName = "none");
          }
          const toSort = to?.meta?.sort;
          const fromSort = from?.meta?.sort;
          // æœªè®¾ç½®è·¯ç”±å…ƒä¿¡æ¯ä½ç½®ï¼Œé»˜è®¤é€æ˜ç¼©æ”¾æ•ˆæœ
          if (!isString(toSort) || !isString(fromSort)) {
            return (this.transitionName = "opacity-scale");
          }
          // æ¯”è¾ƒè·¯ç”±ä½ç½®åˆ¤æ–­å·¦å³åˆ‡æ¢çš„åŠ¨ç”»åç§°
          this.transitionName =
            toSort.localeCompare(fromSort) > 0 ? "switch-right" : "switch-left";
        },
	}
}
```



### é€€å‡ºç™»å½•å†ç™»å½•æç¤ºè·¯ç”±é‡å¤é—®é¢˜

> æœ¬è´¨ä¸Šå°±æ˜¯è·¯ç”±é‡å¤æ³¨å†Œå¯¼è‡´çš„æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡ç™»å‡ºæ—¶ï¼Œæ¸…é™¤æ³¨å†Œè·¯ç”±

åœ¨ router æ–‡ä»¶ä¸­

```js
import Vue from 'vue'
import VueRouter from 'vue-router'

import BaseLayout from "@/layouts/BaseLayout.vue"
Vue.use(VueRouter)

export const constantRoutes = [
  {
    path: '/',
    redirect: '/login', // é‡å®šå‘åˆ° /home è·¯å¾„
    component: BaseLayout,
    children: [
      {
        name: 'home',
        path: '/home', 
        component: () => import(/* webpackChunkName: "Home" */ '@/views/home/Home.vue')
      },
 
    ], 
  },
  {
    path: '/login',
    name: 'login',
    component: () => import(/* webpackChunkName: "login" */ '@/views/login/Login.vue')
  },

]

const router = new VueRouter({
  routes: constantRoutes
})

// è§£å†³é‡å¤ç‚¹å‡»å¯¼èˆªæ—¶ï¼Œæ§åˆ¶å°å‡ºç°æŠ¥é”™
const VueRouterPush = VueRouter.prototype.push
VueRouter.prototype.push = function push (to) {
  return VueRouterPush.call(this, to).catch(err => err)
}
// è·¯ç”±é‡ç½®ï¼Œè§£å†³é€€å‡ºç™»å½•åè·¯ç”±é‡å¤æç¤º
const createRouter = () => new VueRouter({
  routes: constantRoutes,// æ·»åŠ é»˜è®¤è·¯ç”±ï¼Œæ‰¾ä¸åˆ°è·¯ç”±å¯èƒ½å¯¼è‡´æŠ¥é”™
})
export function resetRouter() {
  const newRouter = createRouter();
  router.matcher = newRouter.matcher;
}

export default router

```

é€€å‡ºç™»å½•æ—¶è°ƒç”¨

```js
loginOut() {
    this.$store.dispatch('globalModule/FedLogOut').then(()=> {
        resetRouter();
        // æ­¤å¤„ç¡®ä¿ login è·¯ç”±å­˜åœ¨
        this.$router.push({name: 'login'});
    })
},
```

> [å‚è€ƒé“¾æ¥](https://blog.csdn.net/shiningchen322/article/details/127958801)
>

### ç”¨æˆ·åœ¨æŒ‡å®šé¡µé¢å› tokenè¿‡æœŸè€Œå¯¼è‡´è¿”å›ç™»å½•é¡µï¼Œç™»é™†åå›åˆ°æ­¤é¡µé¢

éœ€è¦åœ¨ axios å“åº”æ‹¦æˆªæ—¶å¤„ç†

```js
if(code == 401) {
    Vue.prototype.$message.error("ç™»å½•çŠ¶æ€å·²è¿‡æœŸ,è¯·é‡æ–°ç™»å½•");
    store.dispatch('globalModule/LogOut').then(() => {
        // æ­¤å¤„è·¯ç”±åˆ°loginå¹¶æ·»åŠ æ ‡è®°
        router.push(`/login?redirect=${store.getters.activeMenu}`)
    })
    return Promise.reject('æ— æ•ˆçš„ä¼šè¯ï¼Œæˆ–è€…ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚')
}
```

åœ¨å…¨å±€è·¯ç”±å‰ç½®å®ˆå«åˆé€‚çš„åœ°æ–¹æ·»åŠ åˆ¤æ–­

```js
let redirect = new URLSearchParams(location.hash.slice(7)).get('redirect');
if(redirect) {
    location.hash = '';
    next({ path: redirect, replace: true })
} else {
    next()
}
```

### vite åŠ¨æ€å¼•å…¥å›¾ç‰‡

éœ€æ±‚ï¼šé€šè¿‡å˜é‡å½¢å¼åŠ è½½imgã€‚

```js
const getAssetsFile = (url) => {
  return new URL(`../../assets/images/common/${url}`, import.meta.url).href;
};
```

æ­¤æ–¹å¼å¼•å…¥å›¾ç‰‡å¼€å‘ç¯å¢ƒæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ‰“åŒ…å›¾ç‰‡404

![åŸå› ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75d0c12e83a04a6d97bdc9ebe29b767a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

è§£å†³æ–¹å¼1

ç›´æ¥å¯¼å…¥å†ä½¿ç”¨

```js
import icon_1 from '@/assets/icon/1.png'
import icon_2 from '@/assets/icon/2.png'
// more
const images = {
    icon_1,
    icon_2
    // more
}
```

```vue
<div v-for="(item, index) in array">
    <img :src="images[`icon_${index}`]" />
</div>
```

è§£å†³æ–¹å¼2

å…¨éƒ¨å¯¼å…¥ï¼Œé€šè¿‡è·¯å¾„å»åŒ¹é…

```js
const getAssetsFile = (name) => {
  const modules = import.meta.glob('../assets/images/common/*', { eager: true })  // è¿™é‡Œå¯ä»¥å†™ @ (è·¯å¾„åˆ«å) æˆ–è€… /src (ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„)
  const path = `../assets/images/common/${name}` // è¿™é‡Œä¸å¯ä»¥å†™è·¯å¾„åˆ«åï¼Œåªå¯ä»¥å†™ç»å¯¹æˆ–è€…ç›¸å¯¹è·¯å·²ç»
  return modules[path]?.default
}
```

> [å‚è€ƒæ–‡ç« ](https://juejin.cn/post/7229168408419909688)



### element-ui/plus å¼¹çª—ç»„ä»¶æ›¿æ¢èƒŒæ™¯

ä¹‹å‰æ›¿æ¢èƒŒæ™¯æ ·å¼æ€»æ˜¯ä¸å…ä¸€ç•ªå¤§æ”¹ï¼Œå¦‚æœèƒŒæ™¯å›¾ç©ºç™½è¾ƒå¤§ï¼Œè¿˜å¾—è°ƒæ•´ä¸‹å¼¹çª—çš„å¸ƒå±€ã€‚å¯è°“éº»çƒ¦ä¹‹æã€‚æ‰€ä»¥çªå‘å¥‡æƒ³ï¼Œæœ‰å•¥åŠæ³•å¯ä»¥ä¸€åŠ³æ°¸é€¸ï¼Œè‡³å°‘ä¸ä¼šå½±å“å¼¹çª—çš„å¸ƒå±€ï¼Œæ¯”å¦‚è®©èƒŒæ™¯å›¾åœ¨å¼¹çª—åé¢å‡ºç°ã€‚è¿™æ ·åªéœ€å°†å¼¹çª—èƒŒæ™¯è®¾ç½®ä¸ºé€æ˜å°±æ²¡æœ‰å…¶ä»–é—®é¢˜äº†ã€‚

```css
.el-dialog {
    background: transparent!important;
    &::after {
        content: '';
        background: url("@/assets/images/common/bg_dialog1.png") 0 0/100% 100% no-repeat !important;
        position: absolute;
        width: 104%;
        height: 110%;
        top: -5%;
        left: 0%;
        z-index: -1;
        transform: translateX(-2%);
    }
    &.large-dialog {
        &::after {
            content: '';
            background: url("@/assets/images/common/bg_dialog2.png") 0 0/100% 100% no-repeat !important;
            position: absolute;
            width: 104%;
            height: 110%;
            top: -5%;
            left: 0%;
            z-index: -1;
            transform: translateX(-2%);
        }
    }
}
```

åˆ©ç”¨ä¼ªç±»å°†å¼¹çª—ç­‰å¤§æ‰©å±•ä¸€ä¸‹å°†åŸæ¥çš„å¼¹çª—åŒ…è£¹è¿›å»ï¼Œè¿™æ ·å°±å¯ä»¥ç®€å•çš„å®ç°æ›¿æ¢å¼¹çª—é£æ ¼äº†

### é€šè¿‡ä¼ªç±»æ·»åŠ å›¾æ ‡

ä¼ªç±»æ”¯æŒurl, ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œç¼©æ”¾æ—¶å›¾ç‰‡çš„å°ºå¯¸ä¸å—æ§ã€‚å¦‚æœåšäº† px2rem ä¸èµ·ä½œç”¨

```css
.box {
  &::after {
    content: url("/vite.svg");
    display: inline-block;
    width: 16px;
    height: 16px;
  }
}
```

ä¿®æ”¹å¦‚ä¸‹

```css
.box {
  &::after {
    content: "";
    background-image: url("/vite.svg");
    background-size: contain;
    display: inline-block;
    width: 16px;
    height: 16px;
  }
}
```

### ä¸ºelement-è¡¨æ ¼ æ»šåŠ¨æ¡è®¾ç½®æ­¥è¿›

> ç›®çš„æ˜¯æ»šè½®æ»šåŠ¨ä¸€ä¸‹å°±å®ç°ç¿»é¡µæ•ˆæœï¼Œä¸åˆ†é¡µçš„è¡¨æ ¼æ•°æ®å±•ç¤ºä¸­

```vue
<el-table 
	:data="tableList"
	height="calc(100% - 50px)"
	ref="testTable"
>
...
</el-table>
```

```js
let testTable = ref(null);
function testScroll (e) {
    e.preventDefault();
    let step = 320;
    if (e.wheelDeltaY > 0) {
        this.scrollTop -= step;
    } else {
        this.scrollTop += step;
    }
    console.log(this.scrollTop, this);
}

onMounted(()=> {
    // è·å– el-table çš„æ»šåŠ¨ DOM å®¹å™¨å…ƒç´ 
    const tableWrapper = testTable.value.$el.querySelector('.el-table__body-wrapper .el-scrollbar .el-scrollbar__wrap');  
    // ç›‘å¬æ»šåŠ¨äº‹ä»¶  
    tableWrapper.addEventListener('wheel', testScroll);
})
```

### é€šç”¨å›¾æ ‡è§£å†³æ–¹æ¡ˆ

1. [iconfont](https://www.iconfont.cn/)

	iconfontåªæœ‰ fontawesome çš„cssæ–‡ä»¶ï¼Œæ²¡æœ‰å…¶ä»–ç”¨æ³•ï¼Œä½†æ˜¯å›¾æ ‡æ¯” fontawesome å¤šï¼Œå…¨å…è´¹ï¼Œä½†æ˜¯é£æ ¼ä¸éƒ½ç»Ÿä¸€éœ€è¦ç­›é€‰

2. [fontawesome](https://fontawesome.com.cn/v5)

	å›¾æ ‡è¾ƒå°‘ï¼ˆ6.7 freeç‰ˆæœ¬æœ‰2060ä¸ªå›¾æ ‡ï¼ŒåŒ…æ‹¬å®ä½“ï¼Œå¸¸è§„ï¼Œç½‘ç«™å›¾æ ‡ä¸‰ç§ç±»åˆ«ï¼‰ï¼Œproç‰ˆæœ¬ä¸æ˜¯å…è´¹ï¼Œç›¸æ¯”è¾ƒäº iconfont è¿™é‡Œå¾—å›¾æ ‡å°ºå¯¸é£æ ¼ç»Ÿä¸€ä¸éœ€è¦è°ƒæ•´

	```
	|-/css/       # ç”¨äºwebå¼€å‘æ—¶å€™ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€å¼•ç”¨è¿™é‡Œçš„all.min.csså³å¯æ­£å¸¸ä½¿ç”¨fontawesomeå­—ä½“å›¾æ ‡äº†ï¼‰
	|-/js/        # ç”¨äºä¸€äº›é«˜çº§ç”¨æ³•æ¯”å¦‚é…åˆsvgä½¿ç”¨ï¼Œä»¥åŠå›¾æ ‡/åŠ¨ç”»/æ—‹è½¬/è’™ç‰ˆ/ç­‰ç­‰ï¼‰
	|-/less/      # å­—ä½“å›¾æ ‡ Less æ ·å¼æ–‡ä»¶
	|-/metadata/  # å›¾æ ‡é›† Meta æ•°æ®æ–‡ä»¶
	|-/scss/      # å­—ä½“å›¾æ ‡ Scss æ ·å¼æ–‡ä»¶
	|-/sprites/   # å­—ä½“å›¾æ ‡ SVGåˆé›†æ–‡ä»¶
	|-/svgs/      # è¿™é‡Œæœ‰å…¨éƒ¨çš„å•ç‹¬çš„svgå›¾æ ‡ï¼Œå¯ä»¥ç”¨äºPPT/Axure/ç­‰åŸå‹è½¯ä»¶
	|-/webfonts/  # æ ¸å¿ƒå­—ä½“æ–‡ä»¶
	```
	
	[vueç»„ä»¶ç‰ˆæœ¬](https://docs.fontawesome.com/web/use-with/vue)
	
	

### vue3 è·¯ç”±ä¼ å‚ï¼Œå‚æ•°éšè—ä¸åœ¨åœ°å€æ æ˜¾ç¤ºï¼ˆhistoryï¼‰

è·³è½¬

```js
const SkipPage = (row) => {
    let obj = JSON.stringify(row)
    router.push({
        path: '/supplyDesc',
        state: { obj }
    })
}

```

æ¥æ”¶

```js
onMounted(()=>{
  console.log(JSON.parse(history.state.obj))
})
```

æ­¤æ–¹å¼ä¼ å‚é¡µé¢åˆ·æ–°æœ‰æ•ˆï¼Œä¸”ä¸èƒ½æ¸…ç©ºã€‚é™¤éä¿®æ”¹history

```js
// æ¸…ç©ºå½“å‰é¡µé¢çš„ history.state
history.pushState(null, null, location.href);
 
// æˆ–è€…ä½¿ç”¨ replaceState æ–¹æ³•
history.replaceState(null, null, location.href);
```



### ä¸»é¢˜ç›¸å…³å‡½æ•°

åœ¨å…¨å±€çŠ¶æ€ä¸­ä½¿ç”¨ theme å˜é‡å­˜å‚¨ä¸»é¢˜ï¼Œè¿™æ ·å°±ä¸ç”¨ä¸€ä¸ªä¸ªå¾—å»ä¿®æ”¹ç›¸å…³å¾— element ui ç»„ä»¶äº†

theme.js

```js
// å¤„ç†ä¸»é¢˜æ ·å¼

export function handleThemeStyle(theme) {

  document.documentElement.style.setProperty('--el-color-primary', theme)

  for (let i = 1; i <= 9; i++) {

â€‹    document.documentElement.style.setProperty(`--el-color-primary-light-${i}`, `${getLightColor(theme, i / 10)}`)

  }

  for (let i = 1; i <= 9; i++) {

â€‹    document.documentElement.style.setProperty(`--el-color-primary-dark-${i}`, `${getDarkColor(theme, i / 10)}`)

  }

}



// hexé¢œè‰²è½¬rgbé¢œè‰²

export function hexToRgb(str) {

  str = str.replace('#', '')

  let hexs = str.match(/../g)

  for (let i = 0; i < 3; i++) {

â€‹    hexs[i] = parseInt(hexs[i], 16)

  }

  return hexs

}



// rgbé¢œè‰²è½¬Hexé¢œè‰²

export function rgbToHex(r, g, b) {

  let hexs = [r.toString(16), g.toString(16), b.toString(16)]

  for (let i = 0; i < 3; i++) {

â€‹    if (hexs[i].length == 1) {

â€‹      hexs[i] = `0${hexs[i]}`

â€‹    }

  }

  return `#${hexs.join('')}`

}



// å˜æµ…é¢œè‰²å€¼

export function getLightColor(color, level) {

  let rgb = hexToRgb(color)

  for (let i = 0; i < 3; i++) {

â€‹    rgb[i] = Math.floor((255 - rgb[i]) * level + rgb[i])

  }

  return rgbToHex(rgb[0], rgb[1], rgb[2])

}



// å˜æ·±é¢œè‰²å€¼

export function getDarkColor(color, level) {

  let rgb = hexToRgb(color)

  for (let i = 0; i < 3; i++) {

â€‹    rgb[i] = Math.floor(rgb[i] * (1 - level))

  }

  return rgbToHex(rgb[0], rgb[1], rgb[2])

}
```

åˆå§‹åŒ–æ—¶åŠ è½½ä¸»é¢˜, å¦‚æœè¿˜æœ‰é…ç½®é¡µé¢ä¹Ÿå¯ä»¥åŠ ä¸Šè¿™ä¸ªåŠ¨ä½œ

```js
import useSettingsStore from '@/store/modules/settings'
import { handleThemeStyle } from '@/utils/theme'

onMounted(() => {
  nextTick(() => {
    // åˆå§‹åŒ–ä¸»é¢˜æ ·å¼
    handleThemeStyle(useSettingsStore().theme)
  })
})
```

### echartså®ç°å…¨å›½åœ°å›¾ä¸‹é’»åˆ°å¿çº§

æ€è·¯ï¼Œå…ˆæœ‰ä¸€ä¸ªå…¨å›½èŒƒå›´åˆ°å¿çº§ï¼ˆ3çº§ï¼‰çš„åœ°å›¾åç§°ç¼–ç æ˜ å°„[ä¸‹è½½åœ°å€](https://hxkj.vip/demo/mapData/pca-code.json)ï¼Œç„¶åå»[ä¸‹è½½æ¯ä¸ªçœä»½çš„åœ°å›¾](https://datav.aliyun.com/portal/school/atlas/area_selector#&lat=31.769817845138945&lng=104.29901249999999&zoom=4)ï¼ˆå¸‚çº§ï¼‰ï¼ŒåŠå¿çº§åœ°å›¾æ•°æ®ï¼Œæ¯ä¸ªçœä¸¤ä¸ªjsonæ•°æ®ã€ä¹‹å‰æœ‰æƒ³ä¸‹è½½ä¸€ä¸ªå…¨å›½çš„åœ°å›¾ä½œä¸ºçœçº§ï¼Œä½†æ˜¯å…¨å›½åœ°å›¾çœçº§æ²¡æœ‰å¸‚çº§çš„èŒƒå›´ï¼Œå…¶å®æ˜¯å¯è¡Œçš„ğŸ§“ğŸ½ã€‘,ç„¶åé»˜è®¤æ˜¾ç¤ºå¯¹åº”çœä»½åœ°å›¾ï¼Œæ¯æ¬¡ç‚¹å‡»ååŠ¨æ€ç»„è£…ä¸‹çº§åœ°å›¾ï¼ˆä¾‹å¦‚ï¼šç‚¹å‡»åˆè‚¥å¸‚ï¼Œå°±å°†åˆè‚¥å¸‚ä¸‹è¾¹æ‰€æœ‰å¿åŒºçº§åœ°å›¾ç»„è£…ï¼Œå¿çº§å°±ç›´æ¥æ¸²æŸ“ï¼‰ï¼Œç„¶åæ¸²æŸ“å‡ºæ¥

> [å‚è€ƒé¡¹ç›®](https://github.com/TangSY/echarts-map-demo)

```vue
<!--
 * @Description: 
 * @Author:  
 * @Date: 2025-03-31 10:23:05
 * @LastEditTime: 2025-04-03 10:39:50
 * @LastEditors:  
-->
<template>
  <div class="chart-map-box">
    <div id="map-stack">
        
        <!-- æ˜¾ç¤ºåœ°å›¾ç°åœ¨å±‚çº§å…³ç³» -->
        <span  style="color: #fff;">{{ mapStack.join(' \/ ') }}</span>
    </div>
    <div id="btn-back">
        <el-button type="primary" icon="Back" size="small"  v-if="mapStack.length > 1" @click="back">ä¸Šä¸€çº§</el-button>
    </div>
    <div id="map" ref="mapRef"></div>
  </div>
</template>
<script setup>
import * as echarts from 'echarts'
import { onBeforeMount } from 'vue';
import { getMapOption } from '@/utils/chart'
import { listDevice } from "@/api/device/device";
import mapMap from '@/assets/json/map.json'
const { proxy } = getCurrentInstance()
let mapRef = ref(null)
let mapList = {}
let mapStack = ref([])
let points = ref([])
let myChart = null
let defaultProvince = ref('å®‰å¾½çœ')
function loadJson (url, type="geo") {
    fetch(url)
    .then(res=>res.json())
    .then(function (geoJson) {
        if(type === 'geo') {
            geoJson.features.forEach(f => {
                mapList[f.properties.name] = f
            });
        }
    }).catch(function (error) {
        
    })
}
function loadMap(name, myChart) {
    let mapjson = {
        type: 'FeatureCollection',
        features: []
    }
    let [shengName = name, shiName,xianName] = mapStack.value
    let sheng = mapMap.find(f=> f.name === shengName)    
    let isZXS = sheng.children[0].name === 'å¸‚è¾–åŒº'//æ˜¯å¦ç›´è¾–å¸‚
    if(xianName) {
    let xian = mapList[xianName]
    if(xian) {
        mapjson.features.push(xian)
    }
    } else if(shiName) {
        let childrens =  isZXS? sheng.children.map(m=>m.children).flat(1) : sheng.children
        let shi = childrens.find(f=> f.name === shiName)
        if(isZXS) {
            mapjson.features.push(mapList[shi.name])
        } else {
            shi.children.forEach(c => {
                let xian = mapList[c.name]
                if(xian) {
                    mapjson.features.push(xian)
                }
            });
        }
    } else if(sheng) {
        let childrens = isZXS ? sheng.children.map(m=>m.children).flat(1) : sheng.children
        childrens.forEach(c => {
            let city = mapList[c.name]
            if(city) {
                mapjson.features.push(city)
            }
        });
    } else {
        return
    }
    myChart.hideLoading();
    echarts.registerMap('liaoning', mapjson);
    let pointSeries = {
        name: "è®¾å¤‡",
        type: "effectScatter",
        coordinateSystem: "geo",
        symbolSize: 15, // ç‚¹çš„å¤§å°
        zlevel: 9,
        data: points.value || []
    };
    let options = getMapOption([pointSeries])
    myChart.setOption(options);
}
function back() {
    if(mapStack.value.length > 1) {
        mapStack.value.pop()
        loadMap(mapStack.value[mapStack.value.length - 1], myChart)
    }
}
async function loadDevice() {
    let rs;
    try {
        rs = await listDevice({
            pageSize: Number.MAX_SAFE_INTEGER
        });
    } catch (error) {
        rs = {
            rows: []
        }
    }
    points.value = rs?.rows.map(item=>{
        let { longitude, latitude } = item;
        if(!longitude || !latitude) return false
        return [longitude, latitude, item]
    }).filter(Boolean)

}
onBeforeMount(()=> {
    proxy.getConfigKey('sys.index.provinceMap').then(rs=>{
        if(rs.msg) {
            defaultProvince.value = rs.msg
            let code = mapMap.find(item=>item.name === rs.msg).code
            let fullCode = String(code).padEnd(6, '0')
            loadJson(`/json/${fullCode}_full.json`)
            loadJson(`/json/${fullCode}_full_district.json`)
        } else {
            loadJson('/json/340000_full.json')
            loadJson('/json/340000_full_district.json')
        }
    })
})
onMounted(async () => {
    myChart = echarts.init(mapRef.value);
    myChart.showLoading();
    await loadDevice()
    setTimeout(()=> {
      mapStack.value.push(defaultProvince.value)
      loadMap(defaultProvince.value, myChart)
    }, 500)
    let timeFn;
    //å•å‡»åˆ‡æ¢åˆ°çœçº§åœ°å›¾ï¼Œå½“mapCodeæœ‰å€¼,è¯´æ˜å¯ä»¥åˆ‡æ¢åˆ°ä¸‹çº§åœ°å›¾
    myChart.on('click', function(params) {
        if(params.componentType !== "geo")return
        clearTimeout(timeFn);
        //ç”±äºå•å‡»äº‹ä»¶å’ŒåŒå‡»äº‹ä»¶å†²çªï¼Œæ•…å•å‡»çš„å“åº”äº‹ä»¶å»¶è¿Ÿ250æ¯«ç§’æ‰§è¡Œ
        timeFn = setTimeout(function() {
            var name = params.name; //åœ°åŒºname
            if(defaultProvince.value.includes('å¸‚')) {
                if(mapStack.value.length === 2) return
            }
            if(mapStack.value.length === 3) return
            mapStack.value.push(name)
            loadMap(name, myChart);
        }, 250);
    });
  
})
</script>

<style lang="scss" scoped>
.chart-map-box {
  width: 100%;
  height: 100%;
  background: url('@/assets/images/bg_map02.png') 0 0/100% 100% no-repeat;
  position: relative;
  #map {
    width: 100%;
    height: 100%;
  }
  #map-stack {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 1000;
    color: #fff;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
  }
  #btn-back {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    color: #fff;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
  }
}
</style>

```

### G6å®ç°æµç¨‹å›¾

```vue
<template>
    <span class="iconfont icon-fanhui" style="position: absolute; visibility: hidden"></span>
    <div class="box">
        <div id="draw-box" ref="drawBoxRef"></div>
    </div>
</template>

<script setup>
import { Graph, NodeEvent, EdgeEvent } from '@antv/g6'
let { proxy } = getCurrentInstance()
aph = shallowRef(null)

const getChartDatas = async () => {
  return {
    nodes: [
      {
        id: '1',
        title: 'æ–°å»ºé¡¹ç›®',
        status: idArr.includes(1) ? 1 : 0,
        style: { x: 150, y: 20, iconText: '\ue7d1' }
      },
      {
        id: '2',
        title: 'ä¸Šä¼ æ–‡ä»¶',
        status: idArr.includes(1) ? 1 : 0,
        style: { x: 150, y: 120, iconText: '\ue614' }
      },
      {
        id: '3',
        title: 'äººå·¥å®¡æ ¸',
        status: idArr.includes(2) || idArr.includes(0),
        style: { x: 150, y: 220, labelPlacement: 'right', labelOffsetY: -10, iconText: '\ue616' }
      },
      {
        id: '4',
        title: 'å®¡æ ¸æ˜¯å¦é€šè¿‡',
        status: idArr.includes(3) || idArr.includes(4) || idArr.includes(5),
        style: { x: 150, y: 320, iconText: '\ue608' }
      },
      {
        id: '5',
        title: 'å®¡æ ¸é€šè¿‡',
        status: idArr.includes(5) ? 1 : 0,
        style: { x: 150, y: 450, iconText: '\ue622' }
      },
      {
        id: '6',
        title: 'ä¸Šä¼ å¯ç ”æ‰§å¤æ ¸',
        status: idArr.includes(3) ? 1 : 0,
        style: { x: 20, y: 320, labelPlacement: 'bottom', iconText: '\ue762' }
      },
      {
        id: '7',
        title: 'é¢„å®¡é€šè¿‡',
        status: idArr.includes(0) ? 1 : 0,
        style: { x: 350, y: 220, labelPlacement: 'bottom', labelOffsetX: 0, iconText: '\ue606' }
      }
    ],
    edges: [
      { id: 'edge-1', source: '1', target: '2' },
      { id: 'edge-2', source: '2', target: '3' },
      { id: 'edge-3', source: '3', target: '4' },
      { id: 'edge-4', source: '4', target: '5', title: 'æ˜¯ï¼Œé€šè¿‡' },
      { id: 'edge-5', source: '4', target: '6', title: 'å¦ï¼Œéœ€å¤æ ¸' },
      { id: 'edge-6', source: '6', target: '3' },
      { id: 'edge-7', source: '7', target: '3', title: 'é¢„å®¡é€šè¿‡' }
    ]
  }
}
const renderChart = async () => {
  graph.value = new Graph({
    container: proxy.$refs.drawBoxRef, //document.getElementById('draw-box'), // String | HTMLElementï¼Œå¿…é¡»ï¼Œåœ¨ Step 1 ä¸­åˆ›å»ºçš„å®¹å™¨ id æˆ–å®¹å™¨æœ¬èº«
    data: await getChartDatas(),
    // width: 350,
    // height: 800,
    autoFit: 'center',
    animation: false,
    node: {
      type: 'circle',
      style: {
        size: 40,
        radius: 8,
        labelPlacement: (d) => {
          return d.style?.labelPlacement || 'right'
        },
        labelText: (d) => d.title,
        labelOffsetX: (d) => d.style.labelOffsetX ?? 10,
        fill: (d) => (d.status ? '#27a4a8' : '#b2b2b2'),
        labelFill: (d) => (d.status ? '#27a4a8' : '#b2b2b2'),
        labelFontWeight: 'bold',
        labelWordWrap: true,
        labelMaxWidth: 80,
        labelMaxLines: 4,
        iconTextBaseline: 'middle',
        iconFontFamily: 'iconfont'
      }
    },
    edge: {
      type: 'polyline',
      style: {
        endArrow: true,
        lineWidth: 2,
        stroke: '#27a4a8',
        router: {
          type: 'orth'
        },
        labelOffsetY: (d) => d.style.labelOffsetY || 10,
        labelText: (d) => d.title,
        labelFill: '#b2b2b2'
        // labelAutoRotate: '90deg'
      }
    },
    behaviors: ['drag-canvas', 'zoom-canvas']
  })
  graph.value.render() //
  graph.value.on(NodeEvent.CLICK, (e) => {
    console.log('NodeEvent.CLICK', e)
  })
  graph.value.on(EdgeEvent.CLICK, (e) => {
    console.log('EdgeEvent.CLICK', e)
  })
}
onBeforeUnmount(() => {
  if (graph.value) {
    graph.value.destroy()
    graph.value = null
  }
})
watch(isShowModel, (val) => {
  if (val) {
    if (!graph.value) {
      setTimeout(() => {
        renderChart()
      }, 100)
      console.log('ç¬¬ä¸€æ¬¡')
    } else {
      graph.value.updateData(getChartDatas())
      // console.log('æ›´æ–°æ•°æ®')
    }
  } else {
    graph.value?.destroy()
    graph.value = null
  }
})
</script>

<style lang="scss" scoped>
.box {
  width: 95%;
  margin: 0 auto;
  height: 480px;
  position: relative;
  z-index: 9999999;
  display: flex;
}
</style>

```

